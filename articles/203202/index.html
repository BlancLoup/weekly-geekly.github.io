<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing jubber server prosody 0.9.7 in the OS family of Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prosody is a lightweight, cross-platform XMPP server written in the Lua programming language. On Habr√© there are several articles on setting up prosod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing jubber server prosody 0.9.7 in the OS family of Windows</h1><div class="post__text post__text-html js-mediator-article">  Prosody is a lightweight, cross-platform XMPP server written in the Lua programming language.  On Habr√© there are several articles on setting up prosody in the standard version - in linux.  Setting in windows contains several pitfalls, which I will try to tell. <br><br><img src="https://habrastorage.org/files/b38/e22/ace/b38e22ace9594d35aef28bac08642cfc.png"><br><a name="habracut"></a><br>  First I will talk about the pros and cons of this decision.  Pros: extreme lightness. <br><br><img src="https://habrastorage.org/files/726/e8e/07c/726e8e07c095493da514605e9a0c8054.PNG">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The screenshot shows a typical resource consumption of prosody + srvany utility, which I used to create the service.  Another advantage can be attributed to the modularity and support for many XEP. <br>  And cons: the lack of a GUI (for someone it is not a minus), for setting up under windows you need to work with a file.  Setting up under windows is more difficult than setting up under linux. <br><br>  The first pitfall awaits us already at the stage of <a href="https://prosody.im/download/start">downloading the distribution</a> .  For windows, you can download both the installer and the archive with prosody.  The fact is that every single bat-file contains a line <br><br><pre><code class="dos hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exist</span></span> Uninstall.exe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> datastore=<span class="hljs-variable"><span class="hljs-variable">%APPDATA%</span></span>\Prosody</code> </pre> <br>  This means that if an uninstaller is found, then <i>all server data will be stored in% APPDATA% of the user running the server.</i>  This is not what we need, therefore, in order to store data in the same place where everything else is stored, you must either use the distribution kit with the archive instead of the installer, or rename the uninstall.exe file after installation, for example, to uninstall.bkp.exe .  Download and install the necessary distribution. <br><br>  The second pitfall - prosody under windows has no service.  We will assume that you are not satisfied every time to start prosody to log in as a user and run the <i>prosody.bat</i> bat file.  To create a prosody service, I suggest using the srvany utility, included with the <a href="http://www.microsoft.com/en-in/download/details.aspx%3Fid%3D17657">Windows Server 2003 Resource Kit Tools</a> .  Even if the OS on your server is different from server 2003, srvany should help us. <br><br><ul><li>  Install the resource kit, agree with the warnings about incompatibility with the OS, if they are. </li><li>  Open the <i>cmd</i> command line as administrator, do the following (insert your path to srvany): <br><pre> <code class="dos hljs">instsrv.exe Prosody "C:\Program Files (x86)\Windows Resource Kits\Tools\srvany.exe"</code> </pre></li><li>  Open regedit, go to " <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Prosody</i> " </li><li>  Create a section " <i>Parameters</i> ". </li><li>  In the " <i>Parameters</i> " section, create a string parameter " <i>Application</i> " with the value " <i>C: \ Program Files (x86) \ Prosody \ prosody.bat</i> " (substitute your own path). </li></ul><br>  The service has been created, you can set it to start <i>automatically</i> .  Attention!  You cannot stop the service created in this way, to stop the <i>srvany</i> and <i>lua</i> processes.  Until all settings are made, the service should not be started. <br><br>  Set up prosody.  To do this, run the <i>batch</i> file <i>editconfig.bat</i> .  All options are documented, I will not describe the entire configuration thoroughly.  Documentation on the modules can be found <a href="https://prosody.im/doc/modules">on the official website</a> . <br><br>  It is recommended to use tls to encrypt sessions.  There are several tls configuration options: <br><ul><li>  You can get a free certificate for a year from <a href="http://www.startssl.com/">StartCom</a> .  If you plan to open access to the jabber-server from the Internet. </li><li>  You can use a self-signed certificate.  When initially connecting to such a server, clients usually issue multiple warnings. <br><div class="spoiler">  <b class="spoiler_title">Generating a self-signed certificate</b> <div class="spoiler_text">  We cannot use prosodyctl to generate a certificate in windows, because  This utility is not ported.  Required <br><ul><li>  <a href="http://indy.fulgan.com/SSL/">download openssl for windows</a> </li><li>  Specify the configuration file <i>openssl.cnf</i> from the supply prosody (lies in the cert folder).  To do this, open a command prompt and perform the following (specifying your path): <br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> OPENSSL_CONF=C:\Program Files (x86)\Prosody\certs\openssl.cnf</code> </pre></li><li>  Go to the directory with the unpacked <i>openssl</i> and generate certificates: <br><pre> <code class="dos hljs">openssl req -new -x509 -days <span class="hljs-number"><span class="hljs-number">1825</span></span> -nodes -out "prosody.crt" -newkey rsa:<span class="hljs-number"><span class="hljs-number">2048</span></span> -keyout "prosody.key"</code> </pre> </li></ul></div></div></li><li>  You can simply disable the tls module (although it is labeled as <i>generally required</i> ) or not specify the path to the certificates in the configuration file.  It is suitable for a small corporate office. </li></ul><br><div class="spoiler">  <b class="spoiler_title">If you are setting up a corporate server, then you need to enable the groups module for a common roster.</b> <div class="spoiler_text">  It is necessary to uncomment the corresponding line in the config in order to load the <i>groups</i> module when starting the server, prepare a text file with the description of groups and specify the path to the file: <br><br><pre> <code class="lua hljs">modules_enabled = { <span class="hljs-comment"><span class="hljs-comment">-- Other modules "groups"; -- Enable mod_groups } groups_file = "groups.txt"</span></span></code> </pre><br>  Create <i>groups.txt</i> in the <i>data</i> subdirectory.  If you plan to use Cyrillic, then edit the file using notepad ++ or any other advanced text editor in UTF-8 mode.  The following sample file is taken from the official documentation: <br><br><pre> <code class="hljs scala"> [<span class="hljs-type"><span class="hljs-type">Support</span></span> <span class="hljs-type"><span class="hljs-type">Team</span></span>] support<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com john.doe<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com [<span class="hljs-type"><span class="hljs-type">Development</span></span> <span class="hljs-type"><span class="hljs-type">Team</span></span>] hardworkingdeveloper<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.net=<span class="hljs-type"><span class="hljs-type">Joe</span></span> <span class="hljs-type"><span class="hljs-type">Coder</span></span> other.dev<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com=<span class="hljs-type"><span class="hljs-type">Mel</span></span></code> </pre><br>  There is one nuance here.  Members of each group see only those who are in the same group.  On other cases, the official documentation is silent.  Looking at the source code of the module, you can see that if you put + in front of the group name, then it becomes common - everyone sees this group. <br><br><pre> <code class="hljs scala"> [+<span class="hljs-type"><span class="hljs-type">Support</span></span> <span class="hljs-type"><span class="hljs-type">Team</span></span>] support<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com john.doe<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com [+<span class="hljs-type"><span class="hljs-type">Development</span></span> <span class="hljs-type"><span class="hljs-type">Team</span></span>] hardworkingdeveloper<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.net=<span class="hljs-type"><span class="hljs-type">Joe</span></span> <span class="hljs-type"><span class="hljs-type">Coder</span></span> other.dev<span class="hljs-meta"><span class="hljs-meta">@example</span></span>.com=<span class="hljs-type"><span class="hljs-type">Mel</span></span></code> </pre><br>  You can even add non-existing users to the group. </div></div><br>  During configuration, you can run prosody from the prosody.bat startup script to check the result.  Run the script from the administrator to avoid problems.  After final configuration, start the previously created prosody service.  You can manage prosody on the go using the <i>admin_adhoc</i> and <i>admin_telnet modules</i> . </div><p>Source: <a href="https://habr.com/ru/post/203202/">https://habr.com/ru/post/203202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203190/index.html">Effective training for C # developers or proper C # programming from scratch</a></li>
<li><a href="../203194/index.html">How to generate a CREATE TABLE script for an existing table</a></li>
<li><a href="../203196/index.html">New winter version of ‚ÄúSimple business‚Äù (charts, access rights, formulas and more in CRM) and iOS app</a></li>
<li><a href="../203198/index.html">The book "Java. New generation of development "</a></li>
<li><a href="../203200/index.html">Data Modeling in Cassandra 2.0 in CQL3</a></li>
<li><a href="../203204/index.html">Samsung will pay Apple $ 290 million</a></li>
<li><a href="../203212/index.html">Create a map of the whole world based on OpenStreetMap data</a></li>
<li><a href="../203214/index.html">Accelerate Update and Delete Operations for the Entity Framework</a></li>
<li><a href="../203216/index.html">The implementation of online video advertising</a></li>
<li><a href="../203220/index.html">WebSphere Application Server Liberty Profile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>