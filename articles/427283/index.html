<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to ensure high availability in Kubernetes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Note trans. : The original article was written by a technical writer from Google, working on documentation for Kubernetes (Andrew Chen), and a directo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to ensure high availability in Kubernetes</h1><div class="post__text post__text-html js-mediator-article">  <i><b>Note</b></i>  <i><b>trans.</b></i>  <i>: The original article was written by a technical writer from Google, working on documentation for Kubernetes (Andrew Chen), and a director of software engineering at SAP (Dominik Tornow).</i>  <i>Its goal is to explain the basics of the organization and implementation of high availability in Kubernetes in an accessible and visual manner.</i>  <i>It seems to us that the authors succeeded, so we are happy to share the translation.</i> <br><br><img src="https://habrastorage.org/webt/wb/d-/oc/wbd-ocqfmcbwled-siw5inhw3pq.jpeg"><br><br>  Kubernetes is a container orchestration engine designed to run containerized applications on multiple nodes, commonly referred to as a cluster.  In these publications, we use a systems modeling approach to improve the understanding of Kubernetes and its underlying concepts.  Readers are advised to already have a basic understanding of Kubernetes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Kubernetes is a scalable and reliable container orchestration engine.  Scalability here is determined by responsiveness in the presence of a load, and reliability - responsiveness in the presence of failures. <a name="habracut"></a><br><br>  Note that the scalability and reliability of Kubernetes does not mean the scalability and reliability of the application running in it.  Kubernetes is a scalable and reliable platform, but each application in K8s has yet to go through certain stages in order to become such and avoid bottlenecks and single points of failure. <br><br>  For example, if an application is deployed as ReplicaSet or Deployment, Kubernetes (re-) plans and (re-) starts the sweeps affected by the node drops.  However, if the application is deployed as file, Kubernetes will not take any action in the event of a node failure.  Therefore, although Kubernetes itself remains functional, the responsiveness of your application depends on the chosen architecture solutions and deployment. <br><br>  The focus of this publication is the reliability of the Kubernetes.  She tells how Kubernetes maintains responsiveness in the presence of bounce. <br><br><h2>  Kubernetes architecture </h2><br><img src="https://habrastorage.org/webt/q3/by/cd/q3bycd1a-zac56dbjxgygulpcu8.png"><br>  <i>Scheme 1. Master and worker</i> <br><br>  At the conceptual level, the components of Kubernetes are grouped into two distinct classes: the components of the master <i>(Master)</i> and the components of the worker <i>(Worker)</i> . <br><br>  The masters are responsible for managing everything except the performance of the pods.  Wizard components include: <br><br><ul><li>  <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-controller-manager/">kube-controller-manager</a> </li><li>  <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-scheduler/">kube-scheduler</a> </li><li>  <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a> </li><li>  <a href="https://coreos.com/etcd/">etcd</a> </li></ul><br>  Workers are responsible for managing the execution of the pods.  They have one component: <br><br><ul><li>  <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">kubelet</a> </li></ul><br>  Workers are trivially reliable: a temporary or permanent failure of any worker in the cluster does not affect the master or other workers in the cluster.  If the application is deployed accordingly, Kubernetes (re-) plans and (re-) launches any one affected by the worker‚Äôs failure. <br><br><h2>  Single Master Configuration </h2><br><img src="https://habrastorage.org/webt/p7/az/2p/p7az2pdu5v6sxw10xwjgzakpl5s.png"><br>  <i>Scheme 2. Configuration with a single master</i> <br><br>  In a single master configuration, the Kubernetes cluster consists of one master and many workers.  The latter are directly connected to the kube-apiserver wizard and interact with it. <br><br>  In this configuration, the responsiveness of Kubernetes depends on: <br><br><ul><li>  the only master </li><li>  Connecting workers to a single master. </li></ul><br>  Since the only master is a single point of failure, this configuration is not in the high availability category. <br><br><h2>  Multi Wizard Configuration </h2><br><img src="https://habrastorage.org/webt/oa/5a/kv/oa5akvdoeqw0bmobcxpuifler_e.png"><br>  <i>Scheme 3. Configuration with multiple wizards</i> <br><br>  In a configuration with many wizards, the Kubernetes cluster consists of many wizards and many workers.  Workers connect to any master's kube-apiserver and interact with it through a highly available load balancer. <br><br>  In this configuration, Kubernetes <b>does not</b> depend on: <br><br><ul><li>  <i>the only</i> master </li><li>  Connecting workers to a <i>single</i> master. </li></ul><br>  Since there is no single point of failure in such a configuration, it is considered highly available. <br><br><h2>  Leader (leader) and slave (follower) in Kubernetes </h2><br>  In the configuration with many wizards, numerous kube-controller-managers and kube-schedulers are involved.  If two components modify the same objects, conflicts may arise. <br><br>  To avoid potential conflicts, a <i>leader / follower</i> pattern has been implemented for kube-controller-manager and kube-scheduler in Kubernetes.  Each group selects one lead <i>(or leader)</i> , and the rest of the group takes the role of the slave.  At any one time only one master is active, and the followers are passive. <br><br><img src="https://habrastorage.org/webt/ln/wt/9s/lnwt9svkxny8ym8jcrsjzxnsydk.png"><br>  <i>Scheme 4. Redundant Deployment wizard components in detail</i> <br><br>  This illustration shows a detailed example in which kube-controller-1 and kube-scheduler-2 are leading among kube-controller-managers and kube-schedulers.  Since each group chooses its leader, they do not have to be on the same master at all. <br><br><h2>  Lead selection </h2><br>  A new leader is chosen by the members of the group at the time of launch or in the event of a lead falling.  Lead - a member who has the so-called <i>leader lease</i> ("rented" at the moment the status of the leader). <br><br><img src="https://habrastorage.org/webt/bf/bt/ve/bfbtve8onnqwzvgwrdfsgiegzoe.gif"><br>  <i>Scheme 5. <a href="">The process of selecting the master master component</a></i> <br><br>  This illustration demonstrates the process of selecting a leader for kube-controller-manager and kube-scheduler.  The logic of this process is as follows: <br><br> <code>'   '     , : <br> -        <br> -     <br> <br> '   '     , : <br> - leader lease   <br> -      <br> -  holderIdentity  'self'</code> <br> <br><h2>  Tracking leading </h2><br>  The current leader statuses for kube-controller-manager and kube-scheduler are permanently stored in the Kubernetes object storage as <i>endpoints objects</i> in the <code>kube-system</code> namespace.  Since two Kubernetes cannot have the same name at the same time, type <i>(kind)</i> and namespace, there can be only one <i>endpoint</i> for kube-scheduler and for kube-controller-manager. <br><br>  Demonstration using the <code>kubectl</code> console utility: <br><br><pre> <code class="bash hljs">$ kubectl get endpoints -n kube-system NAME ENDPOINTS AGE kube-scheduler &lt;none&gt; 30m kube-controller-manager &lt;none&gt; 30m</code> </pre> <br>  <i>Endpoint</i> 's kube-scheduler and kube-controller-manager store information about the leader in the annotation <code>control-plane.alpha.kubernetes.io/leader</code> : <br><br><pre> <code class="bash hljs">$ kubectl describe endpoints kube-scheduler -n kube-system Name: kube-scheduler Annotations: control-plane.alpha.kubernetes.io/leader= { <span class="hljs-string"><span class="hljs-string">"holderIdentity"</span></span>: <span class="hljs-string"><span class="hljs-string">"scheduler-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"leaseDurationSeconds"</span></span>: 15, <span class="hljs-string"><span class="hljs-string">"acquireTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01T08:00:00Z"</span></span> <span class="hljs-string"><span class="hljs-string">"renewTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-01-01T08:00:30Z"</span></span> }</code> </pre> <br>  Although Kubernetes guarantees that there will be one master at a time, Kubernetes does not guarantee that two or more components of the master will not <i>mistakenly assume</i> that they are leading at this moment ‚Äî this state is known as <b>split brain</b> . <br><br>  An instructive discussion of the topic of split brain and possible ways to eliminate it can be found in the article ‚Äú <a href="https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html">How to do distributed locking</a> ‚Äù by Martin Kleppmann. <br><br>  Kubernetes does not use any split brain countermeasures.  Instead, he relies on his ability to strive for the desired state over a period of time, which mitigates the consequences of conflicting decisions. <br><br><h2>  Conclusion </h2><br>  In a configuration with many masters, Kubernetes is a scalable and reliable container orchestration engine.  In this configuration, Kubernetes provides reliability using many wizards and many workers.  Many masters work on the master / slave pattern, and the workers work in parallel.  Kubernetes has its own lead selection process in which information about the lead is stored as <i>endpoints objects</i> . <br><br>  Information on how to prepare for the Kubernetes cluster of high availability can be obtained in the <a href="https://kubernetes.io/docs/tasks/administer-cluster/highly-available-master/">official documentation</a> . <br><br><h2>  About publication </h2><br>  <i>This post is part of the joint initiative of CNCF, Google and SAP, aimed at improving the understanding of Kubernetes and its underlying concepts.</i> <br><br><h2>  PS from translator </h2><br>  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habr.com/company/flant/blog/359120/">Experiments with kube-proxy and unavailability of a node in Kubernetes</a> ‚Äù; </li><li>  " <a href="https://habr.com/company/flant/blog/326062/">Improving the reliability of Kubernetes: how to quickly notice that the node has fallen</a> "; </li><li>  ‚ÄúWe <a href="https://habr.com/company/flant/blog/424211/">understand the Container Storage Interface (in Kubernetes and not only)</a> ‚Äù; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/422801/">Understand RBAC in Kubernetes</a> ‚Äù; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/342658/">What happens in Kubernetes when starting the kubectl run?</a>  <a href="https://habr.com/company/flant/blog/342658/">Part 1</a> "; </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/335552/">How does the Kubernetes scheduler actually work?</a>  "; </li><li>  " <a href="https://habr.com/company/flant/blog/420813/">Behind the scenes of the network in Kubernetes</a> "; </li><li>  " <a href="https://habr.com/company/flant/blog/331188/">Our experience with Kubernetes in small projects</a> " <i>(video of the report, which includes an introduction to the technical device Kubernetes)</i> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/427283/">https://habr.com/ru/post/427283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427273/index.html">Can artificial intelligence leave bookmakers out of work?</a></li>
<li><a href="../427275/index.html">Information architecture on the Internet, part 3</a></li>
<li><a href="../427277/index.html">A diffraction pattern was found in the distribution of prime numbers, approximately as in quasicrystals.</a></li>
<li><a href="../427279/index.html">CoLaboratory: Android Night #Apple</a></li>
<li><a href="../427281/index.html">Development of interface classes in C ++</a></li>
<li><a href="../427285/index.html">School on the basics of digital circuitry: Novosibirsk - Ok, Krasnoyarsk - get ready</a></li>
<li><a href="../427289/index.html">Geological 3D-modeling, logging and technaton from Aramco Innovations</a></li>
<li><a href="../427291/index.html">Traffic minimization in ASP.NET Web Forms, clickable div and periodic server polling</a></li>
<li><a href="../427293/index.html">JavaScript Design Patterns</a></li>
<li><a href="../427295/index.html">JavaScript Currying</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>