<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Emergency resuscitation epmd</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(The problem seems to be extremely exotic, but in terms of ‚Äúhow it is arranged inside,‚Äù it is quite informative.) 

 Here, for example, an application...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Emergency resuscitation epmd</h1><div class="post__text post__text-html js-mediator-article"> <i>(The problem seems to be extremely exotic, but in terms of ‚Äúhow it is arranged inside,‚Äù it is quite informative.)</i> <br><br>  Here, for example, an application written on Erlang works for you (well, let's say, the same ejabberd).  It has been working for a long time, it works well, but one day you are trying to run a control script (ejabberdctl, respectively), and it gives you ‚Äúnodedown‚Äù or something else terrible in this spirit, they say, no one responds.  At the same time, the application itself responds perfectly to all client requests and never heard that it is down.  On a sudden influx, you run <code>epmd -names</code> and - oh, horror!  - get an empty list. <br><br>  Erlang programs use <code>node@host</code> notation to communicate with each other, physically, each node (read, the system process) opens a random high port for this.  The task of the <code>epmd</code> service is to interconnect logical addressing by name and physical addressing by port number.  A kind of DNS analogue, with the difference that without the registry the <code>epmd</code> cluster on the Erlang is falling apart into a handful of individual deaf-and-dumb nodes - which is what has just happened for some mysterious reason.  You can, of course, start looking for the guilty, but at first it would be nice to lift the system into place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What to do in this situation?  You can, of course, simply restart the application by force, but, on the one hand, customers will fall off, on the other hand, it‚Äôs a pity for such a beautiful uptime ... Now, if you could somehow restore the registry on a live system, huh? .. <br><br><a name="habracut"></a>  Never fear!  Crumbs of information, dug up on the Internet, reported that <code>epmd</code> supposedly enough to throw only one correct package;  For example, we quickly need to program a C program ... Well, we don‚Äôt have to go to a low level, it does a good job with sockets and on the Erlang itself, but it would be even easier.  It would be desirable - please: we come across the erl_epmd module and we see in it - glory to open source codes!  - the magic function <code>register_node/2</code> , which accepts the node name and port number. <br><br>  Using <code>netstat</code> we will find out which port is used by our application - let it be 23456 - and run the emulator in the terminal: <br><br> <code><b>$</b> erl <br></code> <br>  The node must be anonymous, because now we will manually register the name, and this (see the code of the same <code>erl_epmd</code> ) can be done only once per launch. <br><br> <code><b>&gt;</b> erl_epmd:start(). <br></code> <br>  ... but, since the node is still anonymous, you first need to manually start the gene server.  Now we call our magic function: <br><br> <code><b>&gt;</b> erl_epmd:register_node( ejabberd, 23456 ). <br></code> <br>  Now we can again communicate with the lost node.  To check, we run <code>epmd -names</code> and rada again ... <br><br>  So, stop, do not rejoice.  The thing is, even though <code>epmd</code> accepts the registration of any free name on any earl port used, it also remembers from which connection this registration request came, and as soon as the connection has fallen off, the name will be released again.  Therefore, now for the correct operation of the system, it is necessary to leave an unnecessary temporary emulator running.  Disorder?  Disorder.  We should somehow get inside the application and call <code>register_node</code> from there ... <br><br>  Elementary, Watson (when you already know how).  We start the second emulator, this time with the name: <br><br> <code><b>$</b> erl -sname repair <br></code> <br>  ... and ping the node with the application: <br><br> <code><b>repair@hostname&gt;</b> net_adm:ping( ejabberd@hostname ). <br></code> <br>  (If you received a pong, everything is according to plan. If you receive a pang, we close the article that has become useless and start running around the room with shouts.) <br>  And now the focus.  It lies in the fact that the connection between the nodes, being established ‚Äî which we have just done ‚Äî remains open further, and the <code>epmd</code> registry <code>epmd</code> no longer needed to communicate with it.  Therefore, we now go back to the first emulator and nail it down: <br><br> <code><b>&gt;</b> halt(). <br></code> <br>  What did we just do?  We, among other things, closed the connection to <code>epmd</code> , and he released the name <code>ejabberd</code> for re-registration.  (Look again at <code>epmd -names</code> if you do not believe.) <br>  Now, through our open connection, which remained hanging under the ceiling without insurance, we can, using the excellent <code>rpc</code> module, go to the application node and brilliantly end a simultaneous game session on three processes: <br><br> <code><b>repair@hostname&gt;</b> rpc:call( ejabberd@hostname, erl_epmd, register_node, [ejabberd, 23456] ). <br> <b>repair@hostname&gt;</b> halt(). <br></code> <br>  So that is all.  We close the terminals and do something for which at the very beginning they even got into the system. <br><br>  <i>Questions, clarifications, corrections are welcome.</i> </div><p>Source: <a href="https://habr.com/ru/post/49535/">https://habr.com/ru/post/49535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49529/index.html">Viliv X70</a></li>
<li><a href="../49530/index.html">Torrent TV with Myka BitTorrent</a></li>
<li><a href="../49531/index.html">It is not possible to update (UPDATE) the same table that you use in the SELECT query</a></li>
<li><a href="../49532/index.html">Mail.ru shoots horror movie</a></li>
<li><a href="../49534/index.html">Mikhail Donskoy died</a></li>
<li><a href="../49537/index.html">PHP: TO_DAYS () function port from MySQL</a></li>
<li><a href="../49538/index.html">Opera won the first round of the antitrust process against IE</a></li>
<li><a href="../49540/index.html">Perhaps the most annoying Microsoft ad</a></li>
<li><a href="../49542/index.html">Livescribe Pulse smartpen - digital pen</a></li>
<li><a href="../49543/index.html">Youtube video can now be officially downloaded</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>