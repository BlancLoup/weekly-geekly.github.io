<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backend I / O Performance: Node vs. PHP vs. Java vs. Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Understanding the I / O model of your application can lead to an understanding of the differences between the application that works with the load und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backend I / O Performance: Node vs. PHP vs. Java vs. Go</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/a57/6b2/345/a576b23456384be081137a9a24342a81.jpg" alt="image"></p><br><p>  Understanding the I / O model of your application can lead to an understanding of the differences between the application that works with the load under which it was created, and that face to face with the real way of its application.  Perhaps, if your application is small and does not create a large load, then it is not so important for it.  But as traffic grows, using an erroneous I / O model can plunge you into a world of pain. </p><br><p>  As in most other situations with several possible solutions, the matter is not which of the options is better, the point is in the understanding of compromises.  In this article, we will compare Node, Java, Go and PHP from under Apache, discuss input-output models in different languages, consider the advantages and disadvantages of each model, and run some simple benchmarks.  If you are concerned about the I / O performance of your next web application, then this article is for you. </p><a name="habracut"></a><br><h2 id="osnovy-vvodavyvoda-osvezhim-znaniya">  Basics I / O: refresh knowledge </h2><br><p>  To understand the factors related to I / O, you first need to recall some of the concepts used at the OS level.  It is unlikely that you will have to deal with many of them directly, most likely, you will work with them indirectly, through the application's runtime environment.  And the details play an important role. </p><br><h3 id="sistemnye-vyzovy">  System calls </h3><br><p>  Take first the system calls that can be described as: </p><br><ul><li><p>  Your program (in the so-called user space) must ask the operating system kernel to perform an I / O operation on behalf of your program. </p><br></li><li><p>  System calls are the way in which the program asks the kernel to do something.  The specificity of their implementation depends on the OS, but the basic principle is the same everywhere.  There must be some specific instruction for transferring control from your program through the kernel (as a function call, only with a special ‚Äúadditive‚Äù to work in such a situation).  In general, system calls are blocking, that is, the program waits until the kernel returns to your code. </p><br></li><li>  The kernel performs the basic input / output operation on the desired device (disk, network card, etc.) and answers the system call.  In real life, the kernel can perform a variety of actions after your request, including waiting for the device to be ready, updating its internal state, etc. But you need not worry about it.  These are core duties. </li></ul><br><p><img src="https://habrastorage.org/web/db8/cf5/4d4/db8cf54d418d4c8d90d1f227e44f817f.jpg" alt="image"></p><br><h3 id="blokiruyuschie-i-neblokiruyuschie-vyzovy">  Blocking and non-blocking calls </h3><br><p>  It was said above that system calls are blocking, and in general this is the case.  However, some calls can be described as non-blocking.  This means that the kernel accepts your request, puts it in a queue or some kind of buffer, and then, without any waiting, immediately returns to the currently executing I / O.  So "blocking" occurs only for a very short period of time, sufficient for placing your request in the queue. </p><br><p>  To make it clearer, here are some examples (of Linux system calls): </p><br><ul><li><code>read()</code> ‚Äî  :     (handle), ,          ;  ,      .    .</li>
<li><code>epoll_create()</code>, <code>epoll_ctl()</code>  <code>epoll_wait()</code> ‚Äî , , ,      ;     /    ;    ,    .        /     . ,    ,     .</li>
</ul><br>
<p>    .       3 ,  - ,    3     (3   ).        ,    . ,     ,    : , 200  (1/5 ).       20 ,   ‚Äî 200  .       10   .</p><br>
<p><img src="https://habrastorage.org/web/6f3/0d4/af5/6f30d4af539c492fb492af968883ccf4.jpg" alt="image"></p><br>
<p>       (¬´        ¬ª),    (¬´ ,        ¬ª) /.             .</p><br>
<h3 id="dispetcherizaciya-scheduling"> (Scheduling)</h3><br>
<p>   ,         ,   .</p><br>
<p>         .               ,          ,     .       .      ,     ,           .     300    ,     ,      :      ,     .      ,       /  .</p><br>
<p>        ‚Äî   - .     ,   100 ,     1000   ,     , / ,    . .</p><br>
<p>     ( ),    .      ,          ,     .</p><br>
<p>      : ¬´   ,           ¬ª.          /     .</p><br>
<p>    ?    :  ,         ,          ‚Ä¶    .</p><br>
<p>  :      (   ,      ).    ,    (Memcache  . .)          , ,  ,      /,     ,       .  ,   /    (PHP, Java), HTTP-           :      /,      ,   .</p><br>
<p>        .      .    ,        /,   /    ,        .</p><br>
<p> 1990-    <a href="https://www.pinterest.com/pin/414401603185852181/">Converse</a>   CGI-  Perl.   PHP,     ,        -.</p><br>
<p>PHP    .   ,   PHP-  .</p><br>
<p>    HTTP-   - Apache.       ,   ,         ( ,  ,  ). Apache  PHP      <code>.php</code>-,   . PHP-      /.    PHP <code>file_get_contents()</code>,       <code>read()</code>   . </p><br>
<p>,        ,    :</p><br>
<pre><code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php">

</span><span class="hljs-comment"><span class="php"><span class="hljs-comment">// blocking file I/O</span></span></span><span class="php">
$file_data = file_get_contents(‚Äò/path/to/file.dat‚Äô);

</span><span class="hljs-comment"><span class="php"><span class="hljs-comment">// blocking network I/O</span></span></span><span class="php">
$curl = curl_init(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'http://example.com/example-microservice'</span></span></span><span class="php">);
$result = curl_exec($curl);

</span><span class="hljs-comment"><span class="php"><span class="hljs-comment">// some more blocking network I/O</span></span></span><span class="php">
$result = $db-&gt;query(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'SELECT id, data FROM examples ORDER BY id DESC limit 100'</span></span></span><span class="php">);

</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code></pre><br>
<p>         :</p><br>
<p><img src="https://habrastorage.org/web/f99/c14/fd2/f99c14fd27834ad29238bdc3fba60524.jpg" alt="image"></p><br>
<p> :    .  /  . ?  ,   . ?  20       .    ,              / (epoll  .).   ,              ,  ,      .</p><br>
<p><em>:  Ruby    ,   ,          .</em></p><br>
<h3 id="mnogopotochnyy-podhod-java"> : Java</h3><br>
<p>Java    ,         ,          ¬´ ¬ª.  Java   (multithreading) ‚Äî   (    ).</p><br>
<p> Java -        ,          ,   ,  .</p><br>
<p> /  Java Servlet  :</p><br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpServletRequest request,
    HttpServletResponse response</span></span></span><span class="hljs-function">) throws ServletException, IOException</span></span>
{

    <span class="hljs-comment"><span class="hljs-comment">// blocking file I/O</span></span>
    InputStream fileIs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(<span class="hljs-string"><span class="hljs-string">"/path/to/file"</span></span>);

    <span class="hljs-comment"><span class="hljs-comment">// blocking network I/O</span></span>
    URLConnection urlConnection = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(<span class="hljs-string"><span class="hljs-string">"http://example.com/example-microservice"</span></span>)).openConnection();
    InputStream netIs = urlConnection.getInputStream();

    <span class="hljs-comment"><span class="hljs-comment">// some more blocking network I/O</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.println(<span class="hljs-string"><span class="hljs-string">"..."</span></span>);
}</code></pre><br>
<p>   <code>doGet</code>        ,       ,   ,     .    ,         ,         .            ,      PHP.     ,    /      ,      .   (pooled),       ,         ,    ,      .</p><br>
<p>    Java 1.4 (    1.7)      /.  , -  ,   ,     .  Java -  -    ,     Java-    ,   .</p><br>
<p><img src="https://habrastorage.org/web/fa2/a95/768/fa2a957681384cee90ff3f49650556f2.jpg" alt="image"></p><br>
<p>Java          /,       ,    ,   /    -      .</p><br>
<h3 id="neblokiruyuschiy-vvodvyvod-node"> /: Node</h3><br>
<p>Node.js         /. ,       Node, ,   ,      /.     .    ,   ,      .</p><br>
<p>  ,  Node, :    : ¬´      ¬ª,  : ¬´       ¬ª.  ,     /,      callback-,  Node    .</p><br>
<p>  Node    /    :</p><br>
<pre><code class="hljs matlab">http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span><span class="hljs-function"> {</span></span>
    fs.readFile(<span class="hljs-string"><span class="hljs-string">'/path/to/file'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, data)</span></span></span><span class="hljs-function"> {</span></span>
        response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(data);
    });
});</code></pre><br>
<p>   callback-.  ,   .  ‚Äî     .</p><br>
<p> ,   Node   /   callback-.   :     Node.       ,       :        Node callback-;         /,       ,  callback-.       /    callback-    (event loop).    .</p><br>
<p><img src="https://habrastorage.org/web/46e/903/929/46e903929e7e4f848d5d0647985a201d.jpg" alt="image"></p><br>
<p>     .        JS- V8 (JS- Chrome,  Node).  JS-,   ,    .   .  ,      /      ,  JS         ,      .   ,     :      ,     ,    .     :</p><br>
<pre><code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span><span class="hljs-function"> </span></span>{

    connection.query(<span class="hljs-string"><span class="hljs-string">'SELECT ...'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, rows)</span></span></span><span class="hljs-function"> </span></span>{

        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> err };

        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; rows.length; i++) {
            <span class="hljs-comment"><span class="hljs-comment">// do processing on each row</span></span>
        }

        response.end(...); <span class="hljs-comment"><span class="hljs-comment">// write out the results</span></span>

    })

};</code></pre><br>
<p> Node   / , , ,  <code>for</code>     ,      .     10  ,       ,    ,   .             .</p><br>
<p>     ,   / ‚Äî   ,  ,       ,        .  -   ,    . </p><br>
<p>  ‚Äî   , ‚Äî         ,  - ,      .   Node-   ,      .</p><br>
<p>     .  Node     ,        /.      ,     ,   HTTP-,  ,   ,         .</p><br>
<h2 id="estestvennoe-neblokirovanie-go"> : Go</h2><br>
<p>     Go,  ,    .       ,       ,       .</p><br>
<p> -  ,  Go    /.      ‚Äî     .            Go   .    ,  ,              ‚Äî            .  ,   HTTP- Go,    .</p><br>
<p>  :</p><br>
<p><img src="https://habrastorage.org/web/cff/bb7/378/cffbb737891c4fe49c7357940cc33865.jpg" alt="image"></p><br>
<p>         runtime- Go,    /,    //  . .,         ,    ,      .</p><br>
<p> runtime- Go  ,     ,   Node.   ,        /     .  Go    ,  - ,           : Go        ,         .   :</p><br>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServeHTTP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> {

    <span class="hljs-comment"><span class="hljs-comment">// the underlying network call here is non-blocking</span></span>
    rows, err := db.Query(<span class="hljs-string"><span class="hljs-string">"SELECT ..."</span></span>)

    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, row := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> rows {
        <span class="hljs-comment"><span class="hljs-comment">// do something with the rows,</span></span>
<span class="hljs-comment"><span class="hljs-comment">// each request in its own goroutine</span></span>
    }

    w.Write(...) <span class="hljs-comment"><span class="hljs-comment">// write the response, also non-blocking</span></span>

}</code></pre><br>
<p> ,    ,   ,     ,      /.</p><br>
<p>     ¬´    ¬ª.       /;      ,          .       Go  .    ,      ,          /.     ,    ,    . </p><br>
<p> Go   ,          /.</p><br>
<h2 id="lozh-naglaya-lozh-i-benchmarki">,    </h2><br>
<p>         .           .           HTTP-    .    ,     ¬´HTTP-/¬ª   ,         .</p><br>
<p>      ,   64- ,   ,  N        SHA-256 (N    URL-, , <code>.../test.php?n=100</code>)         .               /      . </p><br>
<p>        <a href="https://peabody.io/post/server-env-benchmarks/"></a>. </p><br>
<p>      (low concurrency).  2000   300           (N = 1):</p><br>
<p><img src="https://habrastorage.org/web/cf2/4e9/fab/cf24e9fab7ba4b2d9196b75b8b5ec8ac.jpg" alt="image"><br>
<em>       .  ,  </em></p><br>
<p>      - .   ,          ,         ,      /.  ,         ( ,  ).</p><br>
<p> N  1000,  300   ‚Äî   ,          (    ):</p><br>
<p><img src="https://habrastorage.org/web/ff7/9b7/86c/ff79b786c2f14ff5bdacbfb4d81cde0f.jpg" alt="image"><br>
<em>       .  ,  </em></p><br>
<p>    Node,   ,      ,   . ,  PHP      (   )   Java.  ,   SHA-256  PHP   ,       (execution path)    ,      1000  .</p><br>
<p>  5000   (N = 1)       .  ,       .        . </p><br>
<p><img src="https://habrastorage.org/web/755/578/efb/755578efbcaf412db5f68254f1effd54.jpg" alt="image"><br>
<em>    .  ,  </em></p><br>
<p>  .  ,    ,    PHP + Apache          ,         ,      PHP. <strong>Go  ,    Java,  Node,   ‚Äî PHP</strong>.</p><br>
<p>   ,     ,       ,            ,  .</p><br>
<h2 id="v-itoge"> </h2><br>
<p>  , ,             ,     /.</p><br>
<p> ,       ,  PHP  Java  <a href="http://reactphp.org/">  /</a>, <a href="http://undertow.io/">  </a>  <a href="https://netty.io/">-</a>.     ,   ,            .     ,       ,     .  ¬´¬ª PHP  Java -          .</p><br>
<p> ,     ,      ,    :</p><br>
<table>
<thead>
<tr>
<th><strong></strong></th>
<th><strong> vs. </strong></th>
<th><strong> I/O</strong></th>
<th><strong> </strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PHP</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Java</strong></td>
<td></td>
<td></td>
<td> </td>
</tr>
<tr>
<td><strong>Node.js</strong></td>
<td></td>
<td></td>
<td> </td>
</tr>
<tr>
<td><strong>Go</strong></td>
<td> ()</td>
<td></td>
<td>  </td>
</tr>
</tbody>
</table><br>
<p>           .    ,     /,           / .       ,    Go.</p><br>
<p>            ,          ,  ,     .             -    Node  Go.          /  ‚Äî   ,    .      15   .</p><br>
<p>,      ,        ,  ,       .    !</p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329258/">https://habr.com/ru/post/329258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329248/index.html">Clever blocking bypass in Ukraine</a></li>
<li><a href="../329250/index.html">Artists map, awkward search for links in the data and how to reinvent the wheel</a></li>
<li><a href="../329252/index.html">Golos - study in practice. First conclusions</a></li>
<li><a href="../329254/index.html">Passing type map to function</a></li>
<li><a href="../329256/index.html">Selenium under Windows: everything from the beginning</a></li>
<li><a href="../329260/index.html">And let the tests themselves and support</a></li>
<li><a href="../329262/index.html">How to create a modern CI / CD chain using free cloud services</a></li>
<li><a href="../329264/index.html">Continuous Integration (CI) for GitHub C / C ++ projects with CMake build</a></li>
<li><a href="../329266/index.html">‚ÄúI clicked something and everything disappeared‚Äù: how does technical support in retail work</a></li>
<li><a href="../329268/index.html">Microsoft will open data center in Johannesburg and Cape Town</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>