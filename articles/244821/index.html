<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Effective JSON with functional concepts and generics in Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of Tony DiPasquale 's article ‚ÄúEfficient JSON in Swift with Functional Concepts‚Äù . 

 Translator's Preface 
 The task was set be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Effective JSON with functional concepts and generics in Swift</h1><div class="post__text post__text-html js-mediator-article">  This is a translation of Tony DiPasquale <a href="http://robots.thoughtbot.com/efficient-json-in-swift-with-functional-concepts-and-generics">'s</a> article <a href="http://robots.thoughtbot.com/efficient-json-in-swift-with-functional-concepts-and-generics">‚ÄúEfficient JSON in Swift with Functional Concepts‚Äù</a> . <br><br><h3>  Translator's Preface </h3><br>  The task was set before me: upload data in JSON format from <a href="https://www.flickr.com/">Flickr.com</a> about 100 top places where photos are taken at the moment, into an array of models: <br><a name="habracut"></a><br><pre><code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//------   Places struct Places { var places : [Place] } //----- Place struct Place { let placeURL: NSURL let timeZone: String let photoCount : Int let content : String }</span></span></code> </pre> <br>  In addition to a purely pragmatic task, I wanted to see how <i>Swift</i> works ‚Äútype inference from context‚Äù (type Inference), what <i>Swift</i> features in functional programming, and I chose to parse JSON algorithms from the article Tony DiPasquale <a href="http://robots.thoughtbot.com/efficient-json-in-swift-with-functional-concepts-and-generics">‚ÄúEfficient JSON in Swift with Functional Concepts and Generics ‚Äù</a> , in which it‚Äú pulls ‚Äùthe generic <code><code>Result       :               UITableViewController . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code></code> type <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h3> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h3> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h2> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h2> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h2> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h2> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <blockquote> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </blockquote> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h2> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <pre> <code class="hljs bash"><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  <span class="hljs-string"><span class="hljs-string">" "</span></span>  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/"><span class="hljs-string"><span class="hljs-string">"Stanford CS 193P iOS 7"</span></span></a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Place.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"place_url"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"timezone"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"photo_count"</span></span> &lt;*&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"_content"</span></span> } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> Places(places: places) } static func decode(json: JSON) -&gt; Places? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _JSONParse(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Places.create &lt;^&gt; d &lt;| <span class="hljs-string"><span class="hljs-string">"places"</span></span> &lt;| <span class="hljs-string"><span class="hljs-string">"place"</span></span> } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span></span>() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> println(<span class="hljs-string"><span class="hljs-string">"\(stringResult(places))"</span></span>) } } }</code> <br> <br>   <span class="hljs-string"><span class="hljs-string">""</span></span>  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Left(A) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Left(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Right(user)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch either { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Left(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code><code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(A) }</code> <br> <br>    Swift (1.1),  <code><code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     <span class="hljs-string"><span class="hljs-string">""</span></span> <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional as? JSONDictionary { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] as AnyObject? as? Int { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] as AnyObject? as? String { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] as AnyObject? as? String { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) callback(.Value(Box(user))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> switch result { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): //     <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(boxedUser): <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON?) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = JSONObject(jsonOptional) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = JSONInt(json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = JSONString(json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = JSONString(json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>]) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   <span class="hljs-string"><span class="hljs-string">""</span></span>  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>), ,    <code>Optionals</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span> <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code> (<span class="hljs-string"><span class="hljs-string">""</span></span>);   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id = json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name = json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email = json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? String } func JSONInt(object: JSON) -&gt; Int? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   <span class="hljs-string"><span class="hljs-string">""</span></span>   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor<span class="hljs-string"><span class="hljs-string">'s fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative'</span></span>s apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> x = a { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> fx = f { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> fx(x) } } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> //   ,     callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } var jsonErrorOptional: NSError? <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = jsonErrorOptional { callback(.Error(err)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> json = jsonOptional &gt;&gt;&gt; JSONObject { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> u = user { callback(.Value(Box(u))) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } //    <span class="hljs-string"><span class="hljs-string">""</span></span> - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   <span class="hljs-string"><span class="hljs-string">"bind"</span></span> () <br> ,         <code>callback</code> .        <code><span class="hljs-built_in"><span class="hljs-built_in">return</span></span></code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code><span class="hljs-built_in"><span class="hljs-built_in">bind</span></span></code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> data: NSData <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> successRange = 200..&lt;300 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !contains(successRange, response.statusCode) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(NSError()) //        } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> a = optional { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Value(Box(a)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> user = JSONObject(json) &gt;&gt;&gt; { dict <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; dict[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; dict[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Value(x): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> f(x.value) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> .Error(error): <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Error(NSError) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> err = error { self = .Error(err) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   <span class="hljs-string"><span class="hljs-string">""</span></span>   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> id: Int <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> name: String <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> email: String static func create(id: Int)(name: String)(email: String) -&gt; User { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> JSONObject(json) &gt;&gt;&gt; { d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.create &lt;^&gt; json[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt;&gt;&gt; JSONInt &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] &gt;&gt;&gt; JSONString &lt;*&gt; json[<span class="hljs-string"><span class="hljs-string">"email"</span></span>] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code><code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift"><span class="hljs-string"><span class="hljs-string">"Real World JSON Parsing with Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/"><span class="hljs-string"><span class="hljs-string">"   JSON  Swift"</span></span></a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift"><span class="hljs-string"><span class="hljs-string">"Parsing Embedded JSON and Arrays in Swift"</span></span></a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/"><span class="hljs-string"><span class="hljs-string">"  JSON   (Arrays)  Swift."</span></span></a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/"><span class="hljs-string"><span class="hljs-string">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/"><span class="hljs-string"><span class="hljs-string">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</span></span></a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/"><span class="hljs-string"><span class="hljs-string">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</span></span></a></code></code></code></code> </pre> <code><code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> <h3> <code><code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </h3> <code><code><code><code><code>Result       :               UITableViewController</code> . <br> <br>  ,  <i>Swift</i>  " "  <i>Objective-C</i> ,     <a href="https://www.flickr.com/">Flickr.com</a>  Flickr API,      <a href="http://web.stanford.edu/class/cs193p/cgi-bin/drupal/">"Stanford CS 193P iOS 7"</a> ,   <i>Objective-C</i> . <br>      : <br> <br> <code class="objectivec">extension Place: JSONDecodable { static func create(placeURL: String)(timeZone: String)(photoCount: String)(content: String) -&gt; Place { return Place(placeURL: toURL(placeURL), timeZone: timeZone, photoCount: photoCount.toInt() ?? 0, content: content) } static func decode(json: JSON) -&gt; Place? { return _JSONParse(json) &gt;&gt;&gt; { d in Place.create &lt;^&gt; d &lt;| "place_url" &lt;*&gt; d &lt;| "timezone" &lt;*&gt; d &lt;| "photo_count" &lt;*&gt; d &lt;| "_content" } } } extension Places: JSONDecodable { static func create(places: [Place]) -&gt; Places { return Places(places: places) } static func decode(json: JSON) -&gt; Places? { return _JSONParse(json) &gt;&gt;&gt; { d in Places.create &lt;^&gt; d &lt;| "places" &lt;| "place" } } }</code> <br> ...        : <br> <br> <code class="objectivec">class ViewController: UIViewController { override func viewDidLoad() { super.viewDidLoad() //--------------- URL  places  Flickr.com ------------------------------------------ let urlPlaces = NSURLRequest( URL: FlickrFetcher.URLforTopPlaces()) performRequest(urlPlaces ) { (places: Result&lt;Places&gt;) in println("\(stringResult(places))") } } }</code> <br> <br>   ""  <i>Swift</i>  <i>Objective-C</i> -  EfficientJSONBrief-Bridging-Header.h ,    <code>FlickrFetcher.h</code>  <code>API Flickr</code> : <br> <br> <img src="//habrastorage.org/files/f8d/4e5/fc8/f8d4e5fc818143de9453b0b1a89c52c7.png"> <br> <br>     <a href="https://github.com/BestKora/EfficientJSONBrief">Github</a> . <br> <br>  <br>    Apple    , <i>Swift</i> ,          iOS  OS X.  ,    Xcode 6 Beta1,   <i>Swift</i>      ,  ,   JSON -      -      <i>Objective-C</i> . <i>Swift</i>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BE%25D0%25B2"> </a> ,   ,               ,     . ,  <i>Swift</i> ,   ,   ,      runtime .          ,    ,      ,   .      API   JSON,        ( Generics )      . <br> <br>   User <br> ,    -   ,      ,  JSON.     <code>NSJSONSerialization.JSONObjectWithData(NSData, Int, &amp;NSError)</code> ,      <code>Optional</code> JSON    ( error ),     .    JSON   Objective-C -  <code>NSDictionary</code> ,        <code></code> .  <i>Swift</i>     ,  ,     ,   .   JSON   <code>Dictionary&lt;String, AnyObject&gt;</code> . <code>AnyObject</code>  - ,  JSON    <code>String, Double, Bool, Array, Dictionary</code>  <code>null</code> .     JSON     ,    ,     JSON ,       .       <code>User</code> : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String }</code> <br> <br>  ,          : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (User) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in var jsonErrorOptional: NSError? let jsonOptional: AnyObject! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) if let json = jsonOptional as? Dictionary&lt;String, AnyObject&gt; { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(user) } } } } } task.resume() }</code> <br> <br>    <code>if-let</code> ,  -   <code>User</code> .   ,       ,         .  ,    ,     :       . ,         ,     API,      . <br>    ,     JSON      <code>typealias</code> . <br> <br> <code class="objectivec">typealias JSON = AnyObject typealias JSONDictionary = Dictionary&lt;String, JSON&gt; typealias JSONArray = Array&lt;JSON&gt;</code> <br> <br> :    <br> -,          . <br> <br>        ,  <code>Either&lt;A, B&gt;</code> .         ,    ,      .  <i>Swift</i>     <code>Either&lt;A, B&gt;</code> : <br> <br> <code class="objectivec">enum Either&lt;A, B&gt; { case Left(A) case Right(B) }</code> <br> <br>    <code>Either&lt;NSError, User&gt;</code>   ,    <code>callback</code> , ,       ""  <code>User</code> ,    ( <code>error</code> ). <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Either&lt;NSError, User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Left(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Left(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Right(user)) return } } } } //    "" - ,     callback callback(.Left(NSError())) } task.resume() }</code> <br> <br>  ,   <code>getUser</code>   <code>switch</code>   <code>Either</code> ,  -     <code>User</code>   . <br> <br> <code class="objectivec">getUser(request) { either in switch either { case let .Left(error): //     case let .Right(user): // -  user } }</code> <br> <br>    , ,  <code>Left</code>   <code>NSError</code> .     ,    <code class="objectivec">Result ,     ,   ,  .    : <br> <br> enum Result&lt;A&gt; { case Error(NSError) case Value(A) }</code> <br> <br>    Swift (1.1),  <code>Result   . <i>Swift</i>  ,        .      (constant class</code> )    generic  <code>A</code> . <br> <br> ( .     <i>Swift</i>  <code>enum</code>    generic    , ,     ,     generic,     "" <code>class box</code> ): <br> <br> <code class="objectivec">final class Box&lt;A&gt; { let value: A init(_ value: A) { self.value = value } } enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) }</code> <br> <br>  <code>Either</code>  <code>Result</code> ,   : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional as? JSONDictionary { if let id = json["id"] as AnyObject? as? Int { if let name = json["name"] as AnyObject? as? String { if let email = json["email"] as AnyObject? as? String { let user = User(id: id, name: name, email: email) callback(.Value(Box(user))) return } } } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() } getUser(request) { result in switch result { case let .Error(error): //     case let .Value(boxedUser): let user = boxedUser.value //  -  user } }</code> <br> <br>  .    . <br> <br> :     <br>        JSON     JSON    .      <code>String, Int</code>  <code>Dictionary</code> ,    3     . <br> <br> <code class="objectivec">func JSONString(object: JSON?) -&gt; String? { return object as? String } func JSONInt(object: JSON?) -&gt; Int? { return object as? Int } func JSONObject(object: JSON?) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>  JSON   : <br> <br> <code class="objectivec">if let json = JSONObject(jsonOptional) { if let id = JSONInt(json["id"]) { if let name = JSONString(json["name"]) { if let email = JSONString(json["email"]) { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>         <code>if-let</code> .      <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25B4%25D0%25B0"></a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582"></a> , <a href="http://habrahabr.ru/post/183150/"> </a>  <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a>   ""  . <br> <br> -,     <code>Maybe</code> ,   <code>Optional</code>  <i>Swift</i> .     <code>bind</code> (""), ,    <code>Optionals</code> ,   "" <code>Optional</code> c ,   <code>-Optional</code>   <code>Optional</code> .   <code>Optional</code> ,   , -  <code>.None</code> ,   <code>.None</code> ,     <code>bind</code> ""  <code>Optional</code>     . <br> <br> <code class="objectivec">infix operator &gt;&gt;&gt; { associativity left precedence 150 } func &gt;&gt;&gt;&lt;A, B&gt;(a: A?, f: A -&gt; B?) -&gt; B? { if let x = a { return f(x) } else { return .None } }</code> <br> <br>      <code>&gt;&gt;=</code>   <code>bind</code> ("");   <i>Swift</i>         ,        <code>&gt;&gt;&gt;</code> . <br> <br>    JSON , : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { if let id = json["id"] &gt;&gt;&gt; JSONInt { if let name = json["name"] &gt;&gt;&gt; JSONString { if let email = json["email"] &gt;&gt;&gt; JSONString { let user = User(id: id, name: name, email: email) } } } }</code> <br> <br>     <code>Optional</code>    : <br> <br> <code class="objectivec">func JSONString(object: JSON) -&gt; String? { return object as? String } func JSONInt(object: JSON) -&gt; Int? { return object as? Int } func JSONObject(object: JSON) -&gt; JSONDictionary? { return object as? JSONDictionary }</code> <br> <br>     <code>fmap</code>     ,    .       <code>apply</code>      ,    .    ,   ""   -  <code>Optional</code> .  ,      <code>Optional</code>   ,    <code>-Optional</code> .       <code>.Some</code> ,    ,   <code>Optional</code> .  -     <code>.None</code> ,   <code>.None</code> .       <i>Swift</i>  : <br> <br> <code class="objectivec">infix operator &lt;^&gt; { associativity left } // Functor's fmap (usually &lt;$&gt;) infix operator &lt;*&gt; { associativity left } // Applicative's apply func &lt;^&gt;&lt;A, B&gt;(f: A -&gt; B, a: A?) -&gt; B? { if let x = a { return f(x) } else { return .None } } func &lt;*&gt;&lt;A, B&gt;(f: (A -&gt; B)?, a: A?) -&gt; B? { if let x = a { if let fx = f { return fx(x) } } return .None }</code> <br> <br>  ,      ,      ( <code>init</code> )   <code>User</code> ,   <i>Swift</i>    (auto-currying).  ,            ,    ,       .   <code>User</code>    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } }</code> <br> <br>   ,  JSON    : <br> <br> <code class="objectivec">if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString }</code> <br> <br>  -     <code>.None</code> , user  <code>.None</code> .    ,     . <br>    <code>getUser</code> : <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in //   ,     callback if let err = error { callback(.Error(err)) return } var jsonErrorOptional: NSError? let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) //     JSON,    callback if let err = jsonErrorOptional { callback(.Error(err)) return } if let json = jsonOptional &gt;&gt;&gt; JSONObject { let user = User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString if let u = user { callback(.Value(Box(u))) return } } //    "" - ,     callback callback(.Error(NSError())) } task.resume() }</code> <br> <br> :   returns   "bind" () <br> ,         <code>callback</code> .        <code>return</code> ,       <code>NSError</code> .      bug        ,      3  :   ,    JSON   JSON   <code>User</code> . <br>                 .         <code>bind</code>    <code>Result</code> . <br> <br>  <code>parseResponse</code>  <code>Result</code>  <code>data</code>     . API iOS    <code>NSURLResponse</code>   <code>data</code> ,       : <br> <br> <code class="objectivec">struct Response { let data: NSData let statusCode: Int = 500 init(data: NSData, urlResponse: NSURLResponse) { self.data = data if let httpResponse = urlResponse as? NSHTTPURLResponse { statusCode = httpResponse.statusCode } } }</code> <br> <br>       <code>parseResponse</code>  <code>Response</code>      ,     <code>data</code> . <br> <br> <code class="objectivec">func parseResponse(response: Response) -&gt; Result&lt;NSData&gt; { let successRange = 200..&lt;300 if !contains(successRange, response.statusCode) { return .Error(NSError()) //        } return .Value(Box(response.data)) }</code> <br> <br>        <code>Optional</code>   <code>Result</code> ,       . <br> <br> <code class="objectivec">func resultFromOptional&lt;A&gt;(optional: A?, error: NSError) -&gt; Result&lt;A&gt; { if let a = optional { return .Value(Box(a)) } else { return .Error(error) } }</code> <br> <br>   -   <code>data</code>  JSON: <br> <br> <code class="objectivec">func decodeJSON(data: NSData) -&gt; Result&lt;JSON&gt; { let jsonOptional: JSON! = NSJSONSerialization.JSONObjectWithData(data, options: NSJSONReadingOptions(0), error: &amp;jsonErrorOptional) return resultFromOptional(jsonOptional, NSError()) //    NSJSONSerialization       }</code> <br> <br>    JSON    : <br> <br> <code class="objectivec">struct User { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; Result&lt;User&gt; { let user = JSONObject(json) &gt;&gt;&gt; { dict in User.create &lt;^&gt; dict["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; dict["name"] &gt;&gt;&gt; JSONString &lt;*&gt; dict["email"] &gt;&gt;&gt; JSONString } return resultFromOptional(user, NSError()) //     } }</code> <br> <br>      ,     <code>&gt;&gt;&gt;</code>   <code>Result</code> : <br> <br> <code class="objectivec">func &gt;&gt;&gt;&lt;A, B&gt;(a: Result&lt;A&gt;, f: A -&gt; Result&lt;B&gt;) -&gt; Result&lt;B&gt; { switch a { case let .Value(x): return f(x.value) case let .Error(error): return .Error(error) } }</code> <br> <br>      <code>Result</code> : <br> <br> <code class="objectivec">enum Result&lt;A&gt; { case Error(NSError) case Value(Box&lt;A&gt;) init(_ error: NSError?, _ value: A) { if let err = error { self = .Error(err) } else { self = .Value(Box(value)) } } }</code> <br> <br>        <code>&gt;&gt;&gt;</code> . <br> <br> <code class="objectivec">func getUser(request: NSURLRequest, callback: (Result&lt;User&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) let result = responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; User.decode callback(result) } task.resume() }</code> <br> <br> ,    .   : ‚Äú  .      !‚Äù,     - ! <br> <br> :   ""   generics <br>  ,       ,      JSON.   generics,     . <br>   <code>JSONDecodable</code>    ,       : <br> <br> <code class="objectivec">protocol JSONDecodable { class func decode(json: JSON) -&gt; Self? }</code> <br> <br>    ,     ,   <code>JSONDecodable</code> ,  <code>Result</code> : <br> <br> <code class="objectivec">func decodeObject&lt;A: JSONDecodable&gt;(json: JSON) -&gt; Result&lt;A&gt; { return resultFromOptional(A.decode(json), NSError()) // custom error }</code> <br> <br>   <code>User</code>   : <br> <br> <code class="objectivec">struct User: JSONDecodable { let id: Int let name: String let email: String static func create(id: Int)(name: String)(email: String) -&gt; User { return User(id: id, name: name, email: email) } static func decode(json: JSON) -&gt; User? { return JSONObject(json) &gt;&gt;&gt; { d in User.create &lt;^&gt; json["id"] &gt;&gt;&gt; JSONInt &lt;*&gt; json["name"] &gt;&gt;&gt; JSONString &lt;*&gt; json["email"] &gt;&gt;&gt; JSONString } }</code> <br> <br>     <code>decode</code>  <code>User</code> ,    <code>Optional User</code>  <code>Result.      ,   resultFromOptional</code>  <code>decode</code>  ,         <code>decode</code> . <br> ,        <code>performRequest</code>   .       : <code>performRequest</code>  <code>parseResult</code> : <br> <br> <code class="objectivec">func performRequest&lt;A: JSONDecodable&gt;(request: NSURLRequest, callback: (Result&lt;A&gt;) -&gt; ()) { let task = NSURLSession.sharedSession().dataTaskWithRequest(request) { data, urlResponse, error in callback(parseResult(data, urlResponse, error)) } task.resume() } func parseResult&lt;A: JSONDecodable&gt;(data: NSData!, urlResponse: NSURLResponse!, error: NSError!) -&gt; Result&lt;A&gt; { let responseResult = Result(error, Response(data: data, urlResponse: urlResponse)) return responseResult &gt;&gt;&gt; parseResponse &gt;&gt;&gt; decodeJSON &gt;&gt;&gt; decodeObject }</code> <br> <br>   <br> <br>     <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a> . <br> <br>       -  ,    ,  <a href="http://www.haskell.org/haskellwiki/Haskell">Haskell</a>   <a href="http://learnyouahaskell.com/functors-applicative-functors-and-monoids"> </a>   <a href="http://learnyouahaskell.com/">Learn You a Haskell.</a>    <a href="http://robots.thoughtbot.com/applicative-options-parsing-in-haskell">Pat Brisbin</a>   options    . <br> <br>   <br>   <a href="https://github.com/thoughtbot/FunctionalJSON-swift/tree/d3fcf771c20813e57cb54472dd8c55ee33e87ae4">GitHub</a>     .          ,    ,   ,  ,  ,     <a href="https://gist.github.com/BestKora/1a4f1581cb8fd7cf8bb2"></a> . <br> <br>     Tony DiPasquale   ,   : <br> <br> <a href="http://robots.thoughtbot.com/real-world-json-parsing-with-swift">"Real World JSON Parsing with Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/2-realnyj-mir-parsinga-json-v-swift/">"   JSON  Swift"</a> <br> <a href="http://robots.thoughtbot.com/parsing-embedded-json-and-arrays-in-swift">"Parsing Embedded JSON and Arrays in Swift"</a> -  <a href="http://www.bestkora.com/SwiftLearning/3-parsing-vlozhennyh-json-i-massivov-arrays-v-swift/">"  JSON   (Arrays)  Swift."</a> <br> <br>  -      (          ) : <br> <br> <a href="http://www.bestkora.com/SwiftLearning/swift-kod-k-statyam-avtora-tony-dipasquale/">"Swift   e Tony DiPasquale ‚Äú JSON       Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/avtory/tony-depasquale/">"Swift    Tony DiPasquale ‚Äú   JSON  Swift‚Äù"</a> <br> <br> <a href="http://www.bestkora.com/SwiftLearning/category/parsing-json/">"Swift    ‚Äú  JSON   (Arrays)  Swift.‚Äù"</a></code></code></code></code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/244821/">https://habr.com/ru/post/244821/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244807/index.html">Automate testing of iOS applications using Calabash and Cucumber</a></li>
<li><a href="../244811/index.html">The new graphical desktop shell is included in the main code base ReactOS</a></li>
<li><a href="../244813/index.html">Github is locked again</a></li>
<li><a href="../244815/index.html">Optimizing web page performance: CSS</a></li>
<li><a href="../244817/index.html">21 million measurements showed who has the fastest internet access in Moscow</a></li>
<li><a href="../244823/index.html">New monitoring point in Australia</a></li>
<li><a href="../244825/index.html">How Composer is 70% sped up</a></li>
<li><a href="../244829/index.html">VexorCI: how we prepare configuration files</a></li>
<li><a href="../244831/index.html">Stream theory: how to create a game that everyone will love</a></li>
<li><a href="../244833/index.html">USB Monitor Adapter or how I was looking for the meaning of life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>