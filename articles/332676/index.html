<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D mouse integration in Renga</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I work at Renga Software (a joint venture between ASCON and 1C), which develops BIM systems: Renga Architecture for architectural and building ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3D mouse integration in Renga</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I work at <a href="http://rengabim.com/ru/">Renga Software</a> (a joint venture between ASCON and 1C), which develops <abbr title="(Building Information Modeling or Building Information Model) - building information modeling or building information model.">BIM</abbr> systems: <a href="http://rengacad.com/ru/renga/architecture/">Renga Architecture</a> for architectural and building design and <a href="http://rengacad.com/ru/renga/structure/">Renga Structure</a> for designing the structural part of buildings and structures. <br><br>  In this article I want to share the experience of integrating a 3D mouse into the <a href="http://rengabim.com/ru/">Renga</a> system. <br><img src="https://habrastorage.org/web/138/71d/f90/13871df90edf446986428263bf5bfeb1.jpg" alt="image"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Read more about the Renga product family (Careful marketing!)</b> <div class="spoiler_text">  <a href="http://rengacad.com/ru/renga/architecture/"><b>Renga Architecture</b></a> - a system for architectural and construction design.  The program was created for maximum assistance to the designer in solving his tasks: the creation of the architectural appearance of the building, the information model and the quick layout of the drawings according to the standards of SPDS and much more. <br><br>  <a href="http://rengacad.com/ru/renga/structure/"><b>Renga Structure</b></a> - a system for designing structural parts of buildings / structures.  A program for design engineers and designers to create an information model of a building or structure and to obtain drawings of KR / KZh / KZH / KM / AU brands. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The <b>Renga</b> product <b>family is</b> designed for BIM design.  High system performance allows you to work with large projects without a visible reduction in the quality of work with the 3D model: <br><br>  <u>Object Design</u> <br>  Creation in Renga of a 3D model of a building / structure with object design tools (wall, column, window, etc.) <br><br>  <u>Teamwork</u> <br>  Sharing storage and data management is carried out using BIM-Server Pilot <br>  Interaction with estimated systems <br>  Renga integration by means of API with 1C-estimate budget systems and ABC estimates for interaction between project and budget departments. <br><br>  <u>Data exchange</u> <br>  Renga allows you to exchange data with other systems through various formats (.ifc, .dwg, .dxf, .obj, .dae, .stl, .3ds, .lwo and .csv) <br><br>  <u>Automate the receipt of specifications and statements</u> <br>  Renga has the function of receiving reports for the formation of specifications, statements and explications. <br><br>  <u>Automation of drawing</u> <br>  According to the data of the 3D model, views are automatically obtained (facades, sections and plans) and placed on the drawings in the specified scales. <br><br></div></div><br>  3D manipulators are the means of user interaction with software that provide intuitive navigation in three-dimensional space and the ability to work with both hands simultaneously.  Design engineers and companies that have implemented 3D manipulators have reported impressive performance gains. <br><br>  The article will focus on the 3D-mouse from the company 3DConnexion.  This is how it looks (picture from the Internet): <br><br><img src="https://habrastorage.org/web/1d7/986/ac4/1d7986ac43514a0aba71885b970ed2e2.jpg" alt="image"><br><br>  The 3D mouse has 6 degrees of freedom: the displacement along the X, Y, Z axes, and the rotation around the axes, respectively: Roll, Pitch, Yaw. <br><br><img src="https://habrastorage.org/web/be5/d55/69e/be5d5569e2934a5fb9680aa1d55ed3f6.png" alt="image"><br><br>  Mouse degrees of freedom: <br><br><img src="https://habrastorage.org/web/161/b03/b40/161b03b4054345cf8a800bbe755e172d.jpg" alt="image"><br><br>  To integrate a 3D mouse into your application, 3DConnexion provides an SDK.  It can be downloaded from the manufacturer‚Äôs site after registration. <br><br>  I will demonstrate how to integrate a 3D mouse into a Qt5 based application. <br>  Create a simple Qt application using the wizard of new projects in Visual Studio. <br><br>  To work with a 3D mouse, you need to include several header files from the SDK: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Mouse 3D stuff #include &lt;spwmacro.h&gt; /* Common macros used by SpaceWare functions. */ #include &lt;si.h&gt; /* Required for any SpaceWare support within an app.*/ #include &lt;siapp.h&gt; /* Required for siapp.lib symbols */ #include "virtualkeys.hpp"</span></span></code> </pre> <br>  In order for the mouse to work, it needs to transfer the window handle to where the mouse will send messages.  We write the initialization code of the mouse.  It will look something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init3DMouse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SiOpenData oData; <span class="hljs-comment"><span class="hljs-comment">/*init the SpaceWare input library */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SiInitialize() == SPW_DLL_LOAD_ERROR) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; SiOpenWinInit(&amp;oData, (HWND)winId()); <span class="hljs-comment"><span class="hljs-comment">/* init Win. platform specific data */</span></span> SiSetUiMode(mouse3DHandle, SI_UI_ALL_CONTROLS); <span class="hljs-comment"><span class="hljs-comment">/* Config SoftButton Win Display */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* open data, which will check for device type and return the device handle to be used by this function */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (mouse3DHandle = SiOpen (<span class="hljs-string"><span class="hljs-string">"HabrahabrAnd3DMouse"</span></span>, SI_ANY_DEVICE, SI_NO_MASK, SI_EVENT, &amp;oData)) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { SiTerminate(); <span class="hljs-comment"><span class="hljs-comment">/* called to shut down the SpaceWare input library */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* could not open device */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* opened device succesfully */</span></span> } }</code> </pre><br>  Now the mouse is connected to our application and will send a message loop to the message loop of our window.  The message from the mouse has the following structure: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> /* 3</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DxWare</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class"> */ {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> type; <span class="hljs-comment"><span class="hljs-comment">/* Event type */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> { SiSpwData spwData; <span class="hljs-comment"><span class="hljs-comment">/* Button, motion, or combo data */</span></span> SiSpwOOB spwOOB; <span class="hljs-comment"><span class="hljs-comment">/* Out of band message */</span></span> SiOrientation spwOrientation; <span class="hljs-comment"><span class="hljs-comment">/* Which hand orientation is the device */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> exData[SI_MAXBUF]; <span class="hljs-comment"><span class="hljs-comment">/* Exception data. Driver use only */</span></span> SiKeyboardData spwKeyData; <span class="hljs-comment"><span class="hljs-comment">/* String for keyboard data */</span></span> SiSyncPacket siSyncPacket; <span class="hljs-comment"><span class="hljs-comment">/* GUI SyncPacket sent to applications */</span></span> SiHWButtonData hwButtonEvent; <span class="hljs-comment"><span class="hljs-comment">/* V3DKey that goes with * * SI_BUTTON_PRESS/RELEASE_EVENT */</span></span> SiAppCommandData appCommandData; <span class="hljs-comment"><span class="hljs-comment">/* Application command event function data that * * goes with an SI_APP_EVENT event */</span></span> SiDeviceChangeEventData deviceChangeEventData; <span class="hljs-comment"><span class="hljs-comment">/* Data for connecting/disconnecting devices */</span></span> SiCmdEventData cmdEventData; <span class="hljs-comment"><span class="hljs-comment">/* V3DCMD_* function data that * * goes with an SI_CMD_EVENT event */</span></span> } u; } SiSpwEvent;</code> </pre><br>  We are interested in the type of event - <b>SiSpwEvent :: type</b> .  And <b>SiSpwData :: spwData</b> - there is information about the pressed buttons, movement and rotation along the axes. <br><br>  Our task is to filter messages from the mouse.  To do this, set our class as an event filter.  Inherit from QAbstractNativeEventFilter and override the nativeEventFilter function: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HabrahabrAnd3DMouse::nativeEventFilter(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QByteArray &amp;eventType, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *msg, <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> *) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!mouse3DHandle) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; MSG* winMSG = (MSG*)msg; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> handled = SPW_FALSE; SiSpwEvent Event; <span class="hljs-comment"><span class="hljs-comment">/* SpaceWare Event */</span></span> SiGetEventData EData; <span class="hljs-comment"><span class="hljs-comment">/* SpaceWare Event Data */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* init Window platform specific data for a call to SiGetEvent */</span></span> SiGetEventWinInit(&amp;EData, winMSG-&gt;message, winMSG-&gt;wParam, winMSG-&gt;lParam); <span class="hljs-comment"><span class="hljs-comment">/* check whether msg was a 3D mouse event and process it */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SiGetEvent (mouse3DHandle, SI_AVERAGE_EVENTS, &amp;EData, &amp;Event) == SI_IS_EVENT) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Event.type == SI_MOTION_EVENT) { qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by X coordinate = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_TX] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by Y coordinate = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_TY] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by Z coordinate = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_TZ] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by Yaw = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_RX] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by Pitch = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_RY] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"delta by Roll = "</span></span> &lt;&lt; Event.u.spwData.mData[SI_RZ] &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Event.type == SI_ZERO_EVENT) { <span class="hljs-comment"><span class="hljs-comment">// ZERO event } else if (Event.type == SI_BUTTON_EVENT) { // misc button events } handled = SPW_TRUE; /* 3D mouse event handled */ } return handled; }</span></span></code> </pre><br>  This completes the connection of the mouse to our application.  <a href="https://github.com/ershovdz/Qt5And3DMouse">Link</a> to the complete code of the example. </div><p>Source: <a href="https://habr.com/ru/post/332676/">https://habr.com/ru/post/332676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332664/index.html">Automata programming. Part 3. State and transition diagram. Continuation</a></li>
<li><a href="../332668/index.html">How to confuse analytics - 4. Probability and accuracy</a></li>
<li><a href="../332670/index.html">Smart IDReader SDK - add recognition to Android apps</a></li>
<li><a href="../332672/index.html">Google will soon cease to trust all certificates WoSign and StartCom</a></li>
<li><a href="../332674/index.html">Why I switched from React to Cycle.js</a></li>
<li><a href="../332678/index.html">Understanding oracles in the blockchain</a></li>
<li><a href="../332682/index.html">Oracle Data Integrator. SubstitutionAPI: The order of the substitutions. Part 1</a></li>
<li><a href="../332684/index.html">Vulnerability VKontakte: send a message with the page recovery code to someone else's number</a></li>
<li><a href="../332686/index.html">Meet Apache BookKeeper - a replicable log service</a></li>
<li><a href="../332688/index.html">Lecture about two libraries of Yandex for working with big data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>