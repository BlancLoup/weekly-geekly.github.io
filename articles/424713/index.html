<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The whole truth about the RTOS. Article # 12. Task Services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to consider RTOS services that provide additional information about tasks and operations with them. 

 Additional API calls related to tas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The whole truth about the RTOS. Article # 12. Task Services</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/o9/zb/ww/o9zbww4b41p2xgozwiihfkttd2u.jpeg"><br><br>  We continue to consider RTOS services that provide additional information about tasks and operations with them. <a name="habracut"></a><br><br>  Additional API calls related to tasks include calls to get the task ID, check the stack size, reset the task, get information about the task and determine the number of tasks in the system.  Nucleus RTOS and Nucleus SE provide 4 basic API calls for these operations, which I will discuss in this article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Previous articles in the series: <br>  <a href="https://habr.com/post/424481/">Article # 11.</a>  <a href="https://habr.com/post/424481/">Tasks: configuration and introduction to the API</a> <br>  <a href="https://habr.com/post/423967/">Article # 10.</a>  <a href="https://habr.com/post/423967/">Scheduler: additional features and context preservation</a> <br>  <a href="https://habr.com/post/422615/">Article # 9.</a>  <a href="https://habr.com/post/422615/">Scheduler: implementation</a> <br>  <a href="https://habr.com/post/422617/">Article # 8.</a>  <a href="https://habr.com/post/422617/">Nucleus SE: Inside and Deployment</a> <br>  <a href="https://habr.com/post/418601/">Article # 7.</a>  <a href="https://habr.com/post/418601/">Nucleus SE: introduction</a> <br>  <a href="https://habr.com/post/418677/">Article # 6.</a>  <a href="https://habr.com/post/418677/">Other RTOS services</a> <br>  <a href="https://habr.com/post/415429/">Article # 5.</a>  <a href="https://habr.com/post/415429/">Interaction between tasks and synchronization</a> <br>  <a href="https://habr.com/post/415427/">Article # 4.</a>  <a href="https://habr.com/post/415427/">Tasks, context switching and interrupts</a> <br>  <a href="https://habr.com/post/415329/">Article # 3.</a>  <a href="https://habr.com/post/415329/">Tasks and planning</a> <br>  <a href="https://habr.com/post/414093/">Article # 2.</a>  <a href="https://habr.com/post/414093/">RTOS: Structure and Real Time</a> <a href="https://habr.com/post/414093/"><br></a>  <a href="https://habr.com/post/414093/">Article # 1.</a>  <a href="https://habr.com/post/414093/">RTOS: introduction.</a> <a href="https://habr.com/post/414093/"><br></a> <br><h2>  Getting the ID of the current task </h2><br>  This service call returns the ID of the task being called.  For Nucleus, RTOS is a pointer to the control unit of the current task.  For Nucleus SE, the index (0-15) of the current task. <br><br>  <i><b>Call the current task in the Nucleus RTOS</b></i> <br>  Service Call Prototype: <br>  <b>NU_TASK * NU_Current_Task_Pointer (VOID);</b> <br><br>  Options: <br>  None. <br><br>  Return value: <br>  A pointer to the control unit of the current task; <br>  <b>NU_NULL</b> - no task in <b>progress</b> . <br><br>  <i><b>Calling the current task in the Nucleus SE</b></i> <br>  This API call supports the core functionality of the Nucleus RTOS API. <br><br>  Service Call Prototype: <br>  <b>NUSE_TASK NUSE_Task_Current (void);</b> <br><br>  Options: <br>  None. <br><br>  Return value: <br>  The index of the current (called) task. <br><br>  <i><b>Perform the current task in the Nucleus SE</b></i> <br>  The implementation of the API call in this case is quite simple: the value of the global variable <b>NUSE_Task_Active is returned</b> . <br><br><h2>  Check available stack size </h2><br>  This service call returns the available stack size (in bytes) for the current task.  This is only appropriate for planners, where each task has its own stack;  those.  not suitable for the Run To Completion (RTC) scheduler in the Nucleus SE. <br><br>  <i><b>Calling up stack volume information in Nucleus RTOS</b></i> <br>  Service Call Prototype: <br>  <b>UNSIGNED NU_Task_Check_Stack (VOID);</b> <br><br>  Options: <br>  None. <br><br>  Return value: <br>  The size of the available stack size for the current task in bytes. <br><br>  <i><b>Calling up stack size information in Nucleus SE</b></i> <br>  This API call supports Nucleus RTOS core API functionality.  However, the Nucleus SE requires a formal (dummy) parameter to make it easier to get the value of the pointer to the stack used. <br><br>  Service Call Prototype: <br>  <b>U16 NUSE_Task_Check_Stack (U8 dummy);</b> <br><br>  Options: <br>  <b>dummy</b> is any value because it is not actually used. <br><br>  Return value: <br>  The size of the available stack size for the current task in bytes. <br><br>  <i><b>Implementation</b></i> <br>  For such a call, the code must be portable: <br><br><img src="https://habrastorage.org/webt/ow/ub/ux/owubuxejcs5y9npqcacwkvh33t4.jpeg"><br><br>  If the RTC scheduler is used, the return value is 0 because it is not possible (using portable code) to determine the available stack space for the task. <br><br>  In other cases, the value of the stack pointer is determined by finding the address of the dummy parameter, which will be almost at the beginning of the stack.  Strictly speaking, this method depends on the development tools / compiler, but will always be working.  The return value is the difference between this value and the initial value of the stack space, translated into bytes. <br><br><h2>  Task reset </h2><br>  An API call, in this case, returns the task to its original unused state.  Such an API function is different from the normal API reset functions for other kernel objects, if only because it is a reset, and not just setting a task to its initial state (for Nucleus SE, this is either <b>NUSE_READY</b> or the <b>NUSE_Task_Initial_State []</b> entry (see Data structures in next article));  the task is placed in a suspended state ( <b>NUSE_PURE_SUSPEND</b> ) and must be resumed in order to be scheduled again.  Such logic is similar to the functionality of the corresponding API call in the Nucleus RTOS. <br><br>  <i><b>Call reset task in the Nucleus RTOS</b></i> <br>  Service Call Prototype: <br>  <b>STATUS NU_Reset_Task (NU_TASK * task, UNSIGNED argc, VOID * argv);</b> <br><br>  Options: <br>  <b>task</b> - a pointer to the task management block; <br>  <b>argc</b> is a data element that can be used to transfer information to a task; <br>  <b>argv</b> is a pointer that can be used to pass information to a task. <br><br>  Return value: <br>  <b>NU_SUCCESS</b> - the call was completed successfully; <br>  <b>NU_INVALID_TASK</b> - incorrect pointer to the task; <br>  <b>NU_NOT_TERMINATED</b> - the described task is not in a state of complete suspension (terminated) or completion (finished);  only tasks in suspended or terminated state can be reset. <br><br>  <i><b>Call reset task in the Nucleus SE</b></i> <br>  This API call supports the core functionality of the Nucleus RTOS API. <br><br>  Service Call Prototype: <br>  <b>STATUS NUSE_Task_Reset (NUSE_TASK task);</b> <br><br>  Options: <br>  <b>task</b> - an index (ID) of the task to be reset. <br><br>  Return value: <br>  <b>NUSE_SUCCESS</b> - the call was completed successfully; <br>  <b>NUSE_INVALID_TASK</b> - incorrect task index. <br><br>  <i><b>Implementing a reset task in the Nucleus SE</b></i> <br>  The main purpose of the <b>NUSE_Task_Reset ()</b> function API after checking a parameter is to re-initialize all the data structures of the task: <br><br><img src="https://habrastorage.org/webt/ao/p9/bo/aop9bolrjtw2emamibajm4-uiro.jpeg"><br><br>  If a task is blocked when calling an API to wait for access to a kernel object, the first thing to do is configure the counter of blocked tasks corresponding to the object.  This is done by the switch statement. <br><br>  Then the data structures of the task are initialized (mainly with zeros, except for its context block) by calling the initialization function <b>NUSE_Init_Task ()</b> .  Its implementation will be discussed in more detail in the next article with a description of the system initialization.  Finally, the task status is set to <b>NUSE_PURE_SUSPEND</b> . <br><br><h2>  Obtaining information about the task </h2><br>  This service call allows you to get partial information about the task.  The implementation of the Nucleus SE differs from the Nucleus PLUS, in which less information is returned, since the assignment of names to objects, the displacement of a lower priority task and the time slice are not supported, and the priority is not returned, being redundant information. <br><br>  <i><b>Calling for information about a task in Nucleus RTOS</b></i> <br>  Service Call Prototype: <br>  <b>STATUS NU_Task_Information (NU_TASK * task, CHAR * name, DATA_ELEMENT * task_status, UNSIGNED * scheduled_count, OPTION * priority, OPTION * preempt, UNSIGNED * time_slice, VOID ** stack_base, UNSIGNED * stack_size, UNSIGNED</b> <br><br>  Options: <br>  <b>task</b> - a pointer to the task, information about which is requested; <br>  <b>name</b> - pointer to the 8-character string for the task name;  includes area for null characters; <br>  <b>task_status</b> - pointer to a variable that receives the current status of the task; <br>  <b>scheduled_count</b> - pointer to the variable that receives the counter value, how many times the task was added to the scheduler; <br>  <b>priority</b> - a pointer to a variable to get the priority of the task; <br>  <b>preempt</b> - a pointer to a variable for displacing options for a lower priority task;  <b>NU_PREEMPT</b> indicates that the task can be preempted, and <b>NU_NO_PREEMPT</b> indicates that the task cannot be preempted; <br>  <b>time_slice</b> - pointer to the variable to get the value of the time slice of the task;  a value of 0 indicates that time slicing is not possible for this task; <br>  <b>stack_base</b> - a pointer to a variable to get the address of the task stack; <br>  <b>stack_size</b> - a pointer to a variable to get the size of the task stack; <br>  <b>minimum_stack</b> - a pointer to a variable to get the minimum number of bytes remaining on the stack. <br><br>  Return value: <br>  <b>NU_SUCCESS</b> - the call was completed successfully; <br>  <b>NU_INVALID_TASK</b> - incorrect pointer to the task. <br><br>  <i><b>Calling for information about a task in Nucleus SE</b></i> <br>  This call supports the core functionality of the Nucleus PLUS API. <br><br>  Service Call Prototype: <br>  <b>STATUS NUSE_Task_Information (NUSE_TASK task, U8 * task_status, U16 * scheduled_count, ADDR * stack_base, U16 * stack_size);</b> <br><br>  Options: <br>  <b>task</b> - index of the task for which information is requested; <br>  <b>task_status</b> - pointer to the <b>U8</b> variable, which receives the current status of the task (if the waiting state of the task is not available, nothing is returned); <br>  <b>scheduled_count</b> - pointer to <b>U16</b> variable, which receives the value of the counter for the number of tasks added to the scheduler (if the scheduled tasks counter is disabled, then nothing is returned); <br>  <b>stack_base</b> - a pointer to the <b>ADDR</b> variable that receives the address of the task stack (if the RTC scheduler is used, nothing is returned); <br>  <b>stack_size</b> is a pointer to a <b>U16</b> variable that receives the size of the task stack (if the RTC scheduler is used, nothing is returned). <br><br>  Return value: <br>  <b>NUSE_SUCCESS</b> - the call was completed successfully; <br>  <b>NUSE_INVALID_TASK</b> - incorrect task index; <br>  <b>NUSE_INVALID_POINTER</b> - pointer parameters (one or more) are incorrect. <br><br>  <i><b>Implementing task information in Nucleus SE</b></i> <br>  The implementation of this API call is quite simple: <br><br><img src="https://habrastorage.org/webt/yg/0v/qr/yg0vqrjrfhj3ipq2gjn5oaqllzo.jpeg"><br><br>  The function returns the status of the task, taking into account the various possibilities of configurations. <br><br><h2>  Getting the number of tasks </h2><br>  This service call returns information about the number of tasks configured in the application.  While in Nucleus RTOS this number may change, and the return value will represent the current number of tasks at the moment, in Nucleus SE, the return value is set during assembly and no longer changes. <br><br>  <i><b>The challenge of getting the number of tasks in the Nucleus RTOS</b></i> <br>  Service Call Prototype: <br>  <b>UNSIGNED NU_Established_Tasks (VOID);</b> <br><br>  Options: <br>  Absent <br><br>  Return value: <br>  The number of installed (created and not deleted) tasks in the application. <br><br>  <i><b>The challenge of getting the number of tasks in the Nucleus SE</b></i> <br>  This API call supports the Nucleus PLUS core API functionality. <br><br>  Service Call Prototype: <br>  <b>U8 NUSE_Task_Count (void);</b> <br><br>  Options: <br>  Absent <br><br>  Return value: <br>  The number of tasks configured in the application. <br><br>  <i><b>Implementation</b></i> <br>  The implementation of this API call is quite simple: the value of the <b>#define</b> <b>NUSE_TASK_NUMBER</b> directive is <b>returned</b> . <br><br>  The next article will look at the data structures in Nucleus SE associated with tasks and some standard API calls that are not supported by Nucleus SE. <br><br>  <b>About the author:</b> Colin Walls has been working in the electronics industry for more than thirty years, spending a significant amount of time on embedded software.  He is now an embedded software engineer in Mentor Embedded (a division of Mentor Graphics).  Colin Walls often speaks at conferences and seminars, author of numerous technical articles and two books on embedded software.  Lives in the UK.  <a href="http://blogs.mentor.com/colinwalls">Colin's</a> professional <a href="http://blogs.mentor.com/colinwalls">blog</a> , e-mail: colin_walls@mentor.com. <br><br>  <b>On translation:</b> this cycle of articles seemed interesting because, in spite of the outdated described approaches, the author introduces a little-prepared reader with real-time OS features in a very clear language.  I myself belong to the team of creators of the <a href="https://www.astrosoft.ru/products/development/rtos-macs/">Russian RTOS</a> , which we <a href="https://habr.com/post/423689/">intend to make free</a> , and I hope that the cycle will be useful for novice developers. </div><p>Source: <a href="https://habr.com/ru/post/424713/">https://habr.com/ru/post/424713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424699/index.html">Welcome to the hands-on workshop API Jam</a></li>
<li><a href="../424701/index.html">Non-fictional IT-stories about impostors and why these incomprehensible practices appeared during interviews</a></li>
<li><a href="../424703/index.html">And again about the depersonalization</a></li>
<li><a href="../424709/index.html">Masterpieces of the world column: 225 W RMS for 28 000 rubles</a></li>
<li><a href="../424711/index.html">From hydrogel to swine intestine: unusual materials in robotics</a></li>
<li><a href="../424717/index.html">Backup a large number of heterogeneous web-projects</a></li>
<li><a href="../424723/index.html">Friday webinars from Skillbox: useful for beginners and not only</a></li>
<li><a href="../424725/index.html">Pro version of Oracle JDK 11+ (licensing and distribution)</a></li>
<li><a href="../424729/index.html">Why did the compiler turn my loop into an infinite condition?</a></li>
<li><a href="../424731/index.html">Hot tech support history, or Why does AutoCAD remove proxies?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>