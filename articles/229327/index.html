<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Say a word about poor C ++ API!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I had a desire to write about the C ++ API for a long time, and finally I had a quiet evening. By occupation, I and my guys are writing C ++ code for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Say a word about poor C ++ API!</h1><div class="post__text post__text-html js-mediator-article">  I had a desire to write about the C ++ API for a long time, and finally I had a quiet evening.  By occupation, I and my guys are writing C ++ code for C ++ and Python programmers, a common core of functionality that is used in all of our company's products.  Of course, this implies that the code must have an intuitive API, with common logic for both low-level C ++ and high-level Python, regardless of the different interpretations in the languages ‚Äã‚Äãof some basic constructs.  I have written a lot about combining C ++ and Python <a href="http://habrahabr.ru/post/168083/">earlier in articles about Boost.Python</a> , now I am very grateful to the architecture and logic of the Python language, I understood and learned a lot in C ++ thanks to the experience of building a common API for these two such different languages, but now it's only about C ++, about the API, and what such a <s>brutal,</s> flexible language allows you to do with the interface of your wonderful library, if you ignore a number of important features of the C ++ language. <br><a name="habracut"></a><br><h4>  Present perfect coninuous </h4><br>  So, in the yard in 2014.  The C ++ language (unlike its ancestor, a subset of the C language) has all the potential of a high-level language, which for many years has been nothing more than a potential.  If a developer lacks something high-level, he will have to either invent something of his own, or try to find a ready-made solution, the benefit of sources of ready-made code is more than enough.  This is also the good old STL, which in C ++ 11 is a bit darned and updated, it is a monster Boost, with heterogeneous libraries of varying degrees of readiness, there is also Qt with its interface and not only buns, but also a sea of ‚Äã‚Äãfreely distributed software with different degrees contagion licenses.  I will not compare the richness of C ++ libraries with libraries for Java and Python languages, nevertheless, languages ‚Äã‚Äãsolve various problems, but it is obvious to everyone that it‚Äôs impossible to write something high-level without <s>hard porn</s> without spending too much time on C ++.  So, sooner or later, having defined a niche, any C ++ developer writes for himself or for society, perhaps for colleagues, some common functionality, combining the mixed colors of the API set into a single coherent structure, in the search for his own Zen API design.  There are, of course, people who prefer only to use libraries, write code for which they are paid, not interested in the beauty of building a software interface, exchanging it for worldly bustle, but this is not about them ... This article is for reaching for the light of true design of an excellent C ++ language API, Well, a little for those who are forcibly attracted to this light by the ears. <br><br><h4>  Classes </h4><br>  Oddly enough, but the classes are the weakest link in your API, if you want to make the interface of your library as transparent and predictable as possible.  And even without taking into account the templates of these classes themselves.  If you plunge into history a bit, then a class in C ++ is just an add-on to a <b>struct</b> in the C language.  It contains all its fields by value, that is, it is nothing more than the totality of its fields with some OOP superstructure.  Anyone who has ever dealt with Managed C ++ extensions to the C ++ language for the .NET platform, remember that classes can refer to their data by reference, or by reference.  We will not discuss the <s>horrors of the</s> subtleties of the interaction of the C ++ language with the .NET framework, just note that in ordinary C ++ class data is always stored by value, even if this value is a link or pointer.  So we are not very far from the C language, in which even the arguments to the function are passed by value and without options, if you want a link, pass the pointer.  All this has indisputable advantages when placing temporary variables on a stack and the same data placement by value is probably the biggest problem with the architecture of a more or less high-level library implying intensive development, the release of new versions and a compatible software interface with each subsequent version.  It doesn‚Äôt matter how you call classes, namespaces, methods and fields, the main thing is that you don‚Äôt need to know everything that you don‚Äôt need to know to .cpp or. cxx files and look at the implementation details) there‚Äôs nothing in the header file except for the API, if possible you should even remove all unnecessary #include, replacing with a forward declaration all the types used by reference ... <br>  <b>... including the data type of the class itself!</b> <br>  Yes Yes Yes!  If it is possible to keep class data by reference, the data can be declared as a separate class without being implemented in a header file and put it entirely into a .cpp file with method implementation.  That is, your class's API comes down to the following scheme: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       SOME_API  import / export   ( !) //           API ( ,   SOME_API) class SOME_API something { public: //   ,    private: class data; //     ,     SDK,   ,      std::shared_ptr&lt;data&gt; m_data; //   ,     copy-on-write       };</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The analogue of this code will be in your header file regardless of the extension: .h, .hpp, .hxx, or none at all.  Naming is not so important here as the principle is important.  Regardless of the filling of the class something :: data, we can not change the file with the API of the class something, more precisely without losing compatibility with its previous versions.  But that's not all!  ¬© The classic approach with conventional storage hides in itself a whole brood of underwater rocks, on which we are carried by the course of the C ++ language with the behavior of the objects of your class by default. <br>  To fully experience the beauty of storage by value, consider a small example: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       SOME_API  class person { public: //           const (     ) void set_name(std::string const&amp; name); // -     ,   STL  MS  std::string   //   ,    copy-on-write,    std::string const&amp; get_name() const; //     vector of child,     ,    //            m_children,     std::vector&lt;person&gt;&amp; get_children(); //           ,       API //       add_child, get_child  .. std::vector&lt;person&gt; const&amp; get_children() const; private: std::string m_name; // -  ,   person std::vector&lt;person&gt; m_children; //   ,     -  };</span></span></code> </pre><br><br>  So what do we see here?  The default constructor, which is sometimes harsh on POD types, is generated quite tolerable here, since the fields are standard STL containers, they have everything fine with initialization by default.  In general, you should keep in mind that the constructors have the property to be generated: the default constructor, the copy constructor and in C ++ 11 also the displacement constructor, the copy operator is also generated and for the C ++ 11 displacement operator. <br>  And if for initialization and movement here everything is clean thanks to STL, then with copying thanks to the same STL containers we will get the recursive copy hell. <br>  Simple operation: <br><br><pre> <code class="cpp hljs">person neighbour = granny;</code> </pre><br>  can lead to a hell of a headache for a hapless developer using your person class.  Imagine that in the granny variable there is a built object of a certain grandmother with rich offspring, she has a lot of children and for each of the children there are also an order of magnitude more grandchildren.  By all the rules, all these wonderful descendants of the grandmother will begin to clone like amoebas into a neighbor object.  It will certainly be safe for your grandmother, in terms of Zen C ++ and STL containers, but it is completely unsafe for her psyche, and to optimize the performance of basic operations when working with your class is also very, very bad. <br>  A careless developer will say: ‚Äúoh, come on, they will understand, not small ones,‚Äù and unhappy library users will think how to take that same vector inside each object, which recursively complicates the problem of implicit copying.  And most likely they will find another library that is better designed, and works more transparently and predictably. <br>  Unexpected behavior with obvious operations is a headache for the developer of the functional and the API designer, and certainly not for the unfortunate user of their library.  In the extreme case, experienced developers will bypass this problem by putting such dangerous classes in wrappers with smart pointers, but in general this cannot be done.  Let's cure grandmother and her descendants from synchronous amebic division.  Do not leave it here in this form! <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     class person { public: //     -,      person(); //  ,    void set_name(std::string const&amp; name); //      // (       !) std::string const&amp; get_name() const; //      // (       !) std::vector&lt;person&gt;&amp; get_children(); //       // (       !) std::vector&lt;person&gt; const&amp; get_children() const; private: class data; //   double dispatch   class data  protected,     std::shared_ptr&lt;data&gt; m_data; //     ,    }; //      ,     class person::data { public: void set_name(std::string const&amp; name); std::string const&amp; get_name() const; std::vector&lt;person&gt;&amp; get_children(); std::vector&lt;person&gt; const&amp; get_children() const; private: std::string m_name; std::vector&lt;person&gt; m_children; }; //     person::person() : m_data(new data) //    , . .     { } //    person    person::data //   -  ,       //  : void person::set_name(std::string const&amp; name) { //  ,      m_data-&gt;set_name(name); //    operator-&gt;    ,    }</span></span></code> </pre><br><br>  So grandmother stopped copying.  Totally.  Which is also not entirely correct in the C ++ concept, we shall deal with this separately.  In principle, you can take the Java-style as the basis and transfer all such harsh values ‚Äã‚Äãby reference and only by reference, but this means deceiving a user of your library in a situation where you can avoid deceiving it.  What prevents us from copying this grandmother's data only when the data changes? <br><br><h4>  Copy-on-write </h4><br>  The method of copying when changing is quite simple and you can implement it quite quickly yourself, moreover, thread-safe (provided that the implementation of std :: shared_ptr of the standard C ++ library is thread-safe).  The essence of the Cow method is as follows, while the object is passed to the methods as const this, the data is divided between all copies of the object generated from the same data.  However, as soon as this becomes non-constant, any of the methods (there are true exceptions) that are not marked as const first check std :: shared_ptr :: is_unique () and if more than one object refers to the same data, we detach our unique a copy of the general data and its rules.  In principle, you can even do without a mutex, in the worst case, once again copy the object, which is not fatal for a test example in explaining this topic.  This mechanism is implemented the easiest way through operator-&gt; overloading for const and the non-const case of this object of the intermediate template class, which is template-based, since the mechanism is general.  This intermediate template looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   !     ,   ! template &lt;class data&gt; class copy_on_write { public: //   ,      ,    data const* operator -&gt; () const; //  ,    //      ,  ""     data* operator -&gt; (); private: mutable std::shared_ptr&lt;data&gt; m_data; // mutable       const  void ensure_initialized() const; //    void ensure_unique(); //    }; //    template &lt;class data&gt; data const* copy_on_write&lt;data&gt;::operator -&gt; () const { ensure_initialized(); //       nullptr return m_data.get(); //        const- } template &lt;class data&gt; data* copy_on_write&lt;data&gt;::operator -&gt; () { ensure_unique(); // ,         return m_data.get(); //           } template &lt;class data&gt; void copy_on_write&lt;data&gt;::ensure_initialized() const { if (!m_data) { m_data.reset(new data); //    ,      type_traits    } } template &lt;class data&gt; void copy_on_write&lt;data&gt;::ensure_unique() { ensure_initialized(); //        if (!m_data.unique()) //  unique()   std::shared_ptr    { m_data.reset(new data(*m_data)); //        } }</span></span></code> </pre><br>  All that remains is to enable our person class to live for its own pleasure, create with impunity vectors of descendants of any length (they will be uninitialized before the first access to the data), copy, pass by value into functions (no const &amp; need, let it be a bit more expensive) ), return as a result, too, by value (again, no const &amp; and implicit errors due to this!) But the most important thing is that when we start changing the data of an object, only the object that is being modified is copied from the recursive copy  It will become only an appearance! <br>  So, person, live life to the fullest and do not deny yourself anything: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//   ,     ! private: class data; //      ,       API //              copy_on_write&lt;data&gt; m_data; };</span></span></code> </pre><br>  A small explanation for all who have not yet understood what has changed for the copy operation.  The fact is that all elements of the copy vector will refer to the same data as the elements of the source vector.  If suddenly one of the elements starts to change, he will immediately unhook his data by making his unique copy.  Therefore, a copy of the ancestor will not be so hard, although by itself, copying a vector can have quite serious overhead costs. <br><br><h4>  Constancy when calling method </h4><br>  Of course, the method of issuing a reference to a vector is an evil, extremely unfortunate solution for the Copy-on-write model, especially by overloading the method for const and non-const this.  Just because implicitly there can be copying where non-constant overload is implicitly used.  After all, the user of your API is <b>not obliged to</b> take care of the constancy of its variable, for example, starting a variable on the stack, the developer will receive a non-constant variable.  Therefore, you need to carefully monitor that the fate of copying objects of your class does not depend on constancy.  At least let it be obvious. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">person</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; name)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,        std::string get_name() const; //    std::string      API   int get_child_count() const; //           person get_child(int index) const; //    ,        void add_child(person); //   ,     void set_child(int index, person const&amp; child); //    person      private: class data; //      ,       API //              copy_on_write&lt;data&gt; m_data; };</span></span></code> </pre><br>  So, we have an obvious class interface, instances of which can be easily created and copied in large quantities, and the implementation can be changed at least every day without changing the header file. <br><br><h4>  Compile time when using your API </h4><br>  As a bonus, we get a quicker compilation, simply because the field declaration person :: data is rendered in a separate file hidden in the implementation and there is no need to compile <code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code><code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <pre> <code class="hljs objectivec"><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">#include ,           person .     std::string    forward declaration,         #include ,        .      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> //         </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdfwd&gt;</span></span></span><span class="hljs-meta"> namespace std { template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> class allocator; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> struct char_traits; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type, typename traits_type, typename allocator_type&gt;</span></span></span><span class="hljs-meta"> class basic_string; // forward declaration   std::string typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char, char_traits&lt;char&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char&gt;</span></span></span><span class="hljs-meta">&gt; string; // forward declaration   std::wstring typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t, char_traits&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">&gt; wstring; //    ,     #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt;</span></span></span><span class="hljs-meta">  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       </span></span><br><span class="hljs-meta"><span class="hljs-meta">        </span></span><a href="http://habrahabr.ru/post/153225/"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span></span></a><span class="hljs-meta"><span class="hljs-meta">    .     ,   :    ,   .    ,      ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 1)    API (   ,     ...  ,  ?) </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 2)      ,        </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 3)    -      API,     . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">     ,            . </span></span><br><span class="hljs-meta"><span class="hljs-meta">       : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">1.   </span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IAmUselessInterface&gt;</span></span></span><span class="hljs-meta"> something = UserUsefulFactory::CreateSomethingLessUseless</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;DerivedUsefulClass&gt;</span></span></span><span class="hljs-meta">(arguments);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      ,  ,    ,  </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> ,    ,          - ,         private.         C++  ,      -   ,   API  -. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">2.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;I&gt;</span></span></span><span class="hljs-meta"> something = ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">( ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42)); //      :  (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42));</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">3.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">  </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta"> ,          API        . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       Boost.Python.  </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta">  namespace boost::python     ,    Python  C++,    </span></span><b><span class="hljs-meta"><span class="hljs-meta">PyObject*</span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,     .   PyObject*      object     (     </span></span><b><span class="hljs-meta"><span class="hljs-meta">None</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  </span></span><b><span class="hljs-meta"><span class="hljs-meta">NULL</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   </span></span><b><span class="hljs-meta"><span class="hljs-meta">dict</span></span></b><span class="hljs-meta"><span class="hljs-meta">    </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta"> . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> -   ,    ,   -  ,     ++       .        ,      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;data&gt;</span></span></span><span class="hljs-meta"> m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">person president = VIP(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mr. President"</span></span></span><span class="hljs-meta">);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,        -. </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,  ,        ,         .            ,    -    ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">  </span></span><br><span class="hljs-meta"><span class="hljs-meta">    API,  ,                 . </span></span><br><span class="hljs-meta"><span class="hljs-meta">        ,      --API,    ,               ? </span></span><br><span class="hljs-meta"><span class="hljs-meta">  !  -    ,  -   ,           .   ,        ,     ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Copy-on-write"><span class="hljs-meta"><span class="hljs-meta">   (Copy-on-write).</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">  (Double dispatch)</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="https://yadi.sk/d/347rwSrEWNiCY"><span class="hljs-meta"><span class="hljs-meta">       </span></span></a><span class="hljs-meta"><span class="hljs-meta"> - , , .</span></span></code></code> </pre> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> </h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <pre> <code class="hljs objectivec"><code><code class="cpp"><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp"><span class="hljs-meta"><span class="hljs-meta">#include ,           person .     std::string    forward declaration,         #include ,        .      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> //         </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdfwd&gt;</span></span></span><span class="hljs-meta"> namespace std { template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> class allocator; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> struct char_traits; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type, typename traits_type, typename allocator_type&gt;</span></span></span><span class="hljs-meta"> class basic_string; // forward declaration   std::string typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char, char_traits&lt;char&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char&gt;</span></span></span><span class="hljs-meta">&gt; string; // forward declaration   std::wstring typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t, char_traits&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">&gt; wstring; //    ,     #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt;</span></span></span><span class="hljs-meta">  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       </span></span><br><span class="hljs-meta"><span class="hljs-meta">        </span></span><a href="http://habrahabr.ru/post/153225/"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span></span></a><span class="hljs-meta"><span class="hljs-meta">    .     ,   :    ,   .    ,      ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 1)    API (   ,     ...  ,  ?) </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 2)      ,        </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 3)    -      API,     . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">     ,            . </span></span><br><span class="hljs-meta"><span class="hljs-meta">       : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">1.   </span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IAmUselessInterface&gt;</span></span></span><span class="hljs-meta"> something = UserUsefulFactory::CreateSomethingLessUseless</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;DerivedUsefulClass&gt;</span></span></span><span class="hljs-meta">(arguments); </span></span><br><span class="hljs-meta"><span class="hljs-meta">      ,  ,    ,  </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> ,    ,          - ,         private.         C++  ,      -   ,   API  -. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">2.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;I&gt;</span></span></span><span class="hljs-meta"> something = ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">( ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42)); //      :  (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42));</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">3.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">  </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta"> ,          API        . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       Boost.Python.  </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta">  namespace boost::python     ,    Python  C++,    </span></span><b><span class="hljs-meta"><span class="hljs-meta">PyObject*</span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,     .   PyObject*      object     (     </span></span><b><span class="hljs-meta"><span class="hljs-meta">None</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  </span></span><b><span class="hljs-meta"><span class="hljs-meta">NULL</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   </span></span><b><span class="hljs-meta"><span class="hljs-meta">dict</span></span></b><span class="hljs-meta"><span class="hljs-meta">    </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta"> . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> -   ,    ,   -  ,     ++       .        ,      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;data&gt;</span></span></span><span class="hljs-meta"> m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">person president = VIP(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mr. President"</span></span></span><span class="hljs-meta">);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,        -. </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,  ,        ,         .            ,    -    ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">  </span></span><br><span class="hljs-meta"><span class="hljs-meta">    API,  ,                 . </span></span><br><span class="hljs-meta"><span class="hljs-meta">        ,      --API,    ,               ? </span></span><br><span class="hljs-meta"><span class="hljs-meta">  !  -    ,  -   ,           .   ,        ,     ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Copy-on-write"><span class="hljs-meta"><span class="hljs-meta">   (Copy-on-write).</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">  (Double dispatch)</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="https://yadi.sk/d/347rwSrEWNiCY"><span class="hljs-meta"><span class="hljs-meta">       </span></span></a><span class="hljs-meta"><span class="hljs-meta"> - , , .</span></span></code></code></code> </pre> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <pre> <code class="hljs objectivec"><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">#include ,           person .     std::string    forward declaration,         #include ,        .      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> //         </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdfwd&gt;</span></span></span><span class="hljs-meta"> namespace std { template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> class allocator; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> struct char_traits; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type, typename traits_type, typename allocator_type&gt;</span></span></span><span class="hljs-meta"> class basic_string; // forward declaration   std::string typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char, char_traits&lt;char&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char&gt;</span></span></span><span class="hljs-meta">&gt; string; // forward declaration   std::wstring typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t, char_traits&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">&gt; wstring; //    ,     #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt;</span></span></span><span class="hljs-meta">  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       </span></span><br><span class="hljs-meta"><span class="hljs-meta">        </span></span><a href="http://habrahabr.ru/post/153225/"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span></span></a><span class="hljs-meta"><span class="hljs-meta">    .     ,   :    ,   .    ,      ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 1)    API (   ,     ...  ,  ?) </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 2)      ,        </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 3)    -      API,     . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">     ,            . </span></span><br><span class="hljs-meta"><span class="hljs-meta">       : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">1.   </span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IAmUselessInterface&gt;</span></span></span><span class="hljs-meta"> something = UserUsefulFactory::CreateSomethingLessUseless</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;DerivedUsefulClass&gt;</span></span></span><span class="hljs-meta">(arguments);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      ,  ,    ,  </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> ,    ,          - ,         private.         C++  ,      -   ,   API  -. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">2.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;I&gt;</span></span></span><span class="hljs-meta"> something = ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">( ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42)); //      :  (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42));</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">3.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">  </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta"> ,          API        . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       Boost.Python.  </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta">  namespace boost::python     ,    Python  C++,    </span></span><b><span class="hljs-meta"><span class="hljs-meta">PyObject*</span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,     .   PyObject*      object     (     </span></span><b><span class="hljs-meta"><span class="hljs-meta">None</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  </span></span><b><span class="hljs-meta"><span class="hljs-meta">NULL</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   </span></span><b><span class="hljs-meta"><span class="hljs-meta">dict</span></span></b><span class="hljs-meta"><span class="hljs-meta">    </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta"> . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> -   ,    ,   -  ,     ++       .        ,      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;data&gt;</span></span></span><span class="hljs-meta"> m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">person president = VIP(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mr. President"</span></span></span><span class="hljs-meta">);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,        -. </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,  ,        ,         .            ,    -    ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">  </span></span><br><span class="hljs-meta"><span class="hljs-meta">    API,  ,                 . </span></span><br><span class="hljs-meta"><span class="hljs-meta">        ,      --API,    ,               ? </span></span><br><span class="hljs-meta"><span class="hljs-meta">  !  -    ,  -   ,           .   ,        ,     ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Copy-on-write"><span class="hljs-meta"><span class="hljs-meta">   (Copy-on-write).</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">  (Double dispatch)</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="https://yadi.sk/d/347rwSrEWNiCY"><span class="hljs-meta"><span class="hljs-meta">       </span></span></a><span class="hljs-meta"><span class="hljs-meta"> - , , .</span></span></code></code> </pre> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <pre> <code class="hljs objectivec"><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">#include ,           person .     std::string    forward declaration,         #include ,        .      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> //         </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdfwd&gt;</span></span></span><span class="hljs-meta"> namespace std { template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> class allocator; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> struct char_traits; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type, typename traits_type, typename allocator_type&gt;</span></span></span><span class="hljs-meta"> class basic_string; // forward declaration   std::string typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char, char_traits&lt;char&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char&gt;</span></span></span><span class="hljs-meta">&gt; string; // forward declaration   std::wstring typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t, char_traits&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">&gt; wstring; //    ,     #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt;</span></span></span><span class="hljs-meta">  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       </span></span><br><span class="hljs-meta"><span class="hljs-meta">        </span></span><a href="http://habrahabr.ru/post/153225/"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span></span></a><span class="hljs-meta"><span class="hljs-meta">    .     ,   :    ,   .    ,      ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 1)    API (   ,     ...  ,  ?) </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 2)      ,        </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 3)    -      API,     . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">     ,            . </span></span><br><span class="hljs-meta"><span class="hljs-meta">       : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">1.   </span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IAmUselessInterface&gt;</span></span></span><span class="hljs-meta"> something = UserUsefulFactory::CreateSomethingLessUseless</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;DerivedUsefulClass&gt;</span></span></span><span class="hljs-meta">(arguments);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      ,  ,    ,  </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> ,    ,          - ,         private.         C++  ,      -   ,   API  -. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">2.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;I&gt;</span></span></span><span class="hljs-meta"> something = ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">( ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42)); //      :  (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42));</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">3.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">  </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta"> ,          API        . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       Boost.Python.  </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta">  namespace boost::python     ,    Python  C++,    </span></span><b><span class="hljs-meta"><span class="hljs-meta">PyObject*</span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,     .   PyObject*      object     (     </span></span><b><span class="hljs-meta"><span class="hljs-meta">None</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  </span></span><b><span class="hljs-meta"><span class="hljs-meta">NULL</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   </span></span><b><span class="hljs-meta"><span class="hljs-meta">dict</span></span></b><span class="hljs-meta"><span class="hljs-meta">    </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta"> . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> -   ,    ,   -  ,     ++       .        ,      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;data&gt;</span></span></span><span class="hljs-meta"> m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">person president = VIP(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mr. President"</span></span></span><span class="hljs-meta">);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,        -. </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,  ,        ,         .            ,    -    ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">  </span></span><br><span class="hljs-meta"><span class="hljs-meta">    API,  ,                 . </span></span><br><span class="hljs-meta"><span class="hljs-meta">        ,      --API,    ,               ? </span></span><br><span class="hljs-meta"><span class="hljs-meta">  !  -    ,  -   ,           .   ,        ,     ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Copy-on-write"><span class="hljs-meta"><span class="hljs-meta">   (Copy-on-write).</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">  (Double dispatch)</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="https://yadi.sk/d/347rwSrEWNiCY"><span class="hljs-meta"><span class="hljs-meta">       </span></span></a><span class="hljs-meta"><span class="hljs-meta"> - , , .</span></span></code></code> </pre> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <pre> <code class="hljs objectivec"><code><code class="cpp"><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp"><span class="hljs-meta"><span class="hljs-meta">#include ,           person .     std::string    forward declaration,         #include ,        .      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> //         </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdfwd&gt;</span></span></span><span class="hljs-meta"> namespace std { template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> class allocator; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type&gt;</span></span></span><span class="hljs-meta"> struct char_traits; template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename char_type, typename traits_type, typename allocator_type&gt;</span></span></span><span class="hljs-meta"> class basic_string; // forward declaration   std::string typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char, char_traits&lt;char&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;char&gt;</span></span></span><span class="hljs-meta">&gt; string; // forward declaration   std::wstring typedef basic_string</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t, char_traits&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">, allocator</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wchar_t&gt;</span></span></span><span class="hljs-meta">&gt; wstring; //    ,     #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;cstddef&gt;</span></span></span><span class="hljs-meta">  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       </span></span><br><span class="hljs-meta"><span class="hljs-meta">        </span></span><a href="http://habrahabr.ru/post/153225/"><span class="hljs-meta"><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"    "</span></span></span></span></a><span class="hljs-meta"><span class="hljs-meta">    .     ,   :    ,   .    ,      ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 1)    API (   ,     ...  ,  ?) </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 2)      ,        </span></span><br><span class="hljs-meta"><span class="hljs-meta"> 3)    -      API,     . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">     ,            . </span></span><br><span class="hljs-meta"><span class="hljs-meta">       : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">1.   </span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IAmUselessInterface&gt;</span></span></span><span class="hljs-meta"> something = UserUsefulFactory::CreateSomethingLessUseless</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;DerivedUsefulClass&gt;</span></span></span><span class="hljs-meta">(arguments);</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      ,  ,    ,  </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> ,    ,          - ,         private.         C++  ,      -   ,   API  -. </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">2.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">std::unique_ptr</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;I&gt;</span></span></span><span class="hljs-meta"> something = ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">( ::Instance().</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42)); //      :  (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt;</span></span></span><span class="hljs-meta">(42));</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><b><span class="hljs-meta"><span class="hljs-meta">3.  .</span></span></b><span class="hljs-meta"><span class="hljs-meta">    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">  </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta">    </span></span><i><span class="hljs-meta"><span class="hljs-meta"></span></span></i><span class="hljs-meta"><span class="hljs-meta"> ,          API        . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">       Boost.Python.  </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta">  namespace boost::python     ,    Python  C++,    </span></span><b><span class="hljs-meta"><span class="hljs-meta">PyObject*</span></span></b><span class="hljs-meta"><span class="hljs-meta"> ,     .   PyObject*      object     (     </span></span><b><span class="hljs-meta"><span class="hljs-meta">None</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  </span></span><b><span class="hljs-meta"><span class="hljs-meta">NULL</span></span></b><span class="hljs-meta"><span class="hljs-meta"> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   </span></span><b><span class="hljs-meta"><span class="hljs-meta">dict</span></span></b><span class="hljs-meta"><span class="hljs-meta">    </span></span><b><span class="hljs-meta"><span class="hljs-meta">object</span></span></b><span class="hljs-meta"><span class="hljs-meta"> . </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">double dispatch</span></span></a><span class="hljs-meta"><span class="hljs-meta"> -   ,    ,   -  ,     ++       .        ,      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><code class="cpp"><span class="hljs-meta"><span class="hljs-meta">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;data&gt;</span></span></span><span class="hljs-meta"> m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</span></span></code><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">      : </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> person president = VIP(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mr. President"</span></span></span><span class="hljs-meta">); </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,        -. </span></span><br><span class="hljs-meta"><span class="hljs-meta">   ,     ,  ,        ,         .            ,    -    ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">  </span></span><br><span class="hljs-meta"><span class="hljs-meta">    API,  ,                 . </span></span><br><span class="hljs-meta"><span class="hljs-meta">        ,      --API,    ,               ? </span></span><br><span class="hljs-meta"><span class="hljs-meta">  !  -    ,  -   ,           .   ,        ,     ! </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta">   </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Copy-on-write"><span class="hljs-meta"><span class="hljs-meta">   (Copy-on-write).</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="http://en.wikipedia.org/wiki/Double_dispatch"><span class="hljs-meta"><span class="hljs-meta">  (Double dispatch)</span></span></a><span class="hljs-meta"><span class="hljs-meta"> </span></span><br><span class="hljs-meta"><span class="hljs-meta"> </span></span><a href="https://yadi.sk/d/347rwSrEWNiCY"><span class="hljs-meta"><span class="hljs-meta">       </span></span></a><span class="hljs-meta"><span class="hljs-meta"> - , , .</span></span></code></code></code> </pre> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> </h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> <h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> </h4> <code><code><a href="http://en.wikipedia.org/wiki/Forward_declaration"></a> <code class="cpp">#include ,           person .     std::string    forward declaration,         #include ,        .      : <br> <br> //         &lt;stdfwd&gt; namespace std { template &lt;typename char_type&gt; class allocator; template &lt;typename char_type&gt; struct char_traits; template &lt;typename char_type, typename traits_type, typename allocator_type&gt; class basic_string; // forward declaration   std::string typedef basic_string&lt;char, char_traits&lt;char&gt;, allocator&lt;char&gt;&gt; string; // forward declaration   std::wstring typedef basic_string&lt;wchar_t, char_traits&lt;wchar_t&gt;, allocator&lt;wchar_t&gt;&gt; wstring; //    ,     #include &lt;cstddef&gt;  std::nullptr_t typedef decltype(nullptr) nullptr_t; }</code> <br>        .      ,   C++        API             ,     ,           .           ,         ,     ,      .         API. <br> <br>       <br>        <a href="http://habrahabr.ru/post/153225/">"    "</a>    .     ,   :    ,   .    ,      ,    : <br> 1)    API (   ,     ...  ,  ?) <br> 2)      ,        <br> 3)    -      API,     . <br> <br>     ,            . <br>       : <br> <br> <b>1.   </b> ,   -   ,      - ,    -,    interface-    (     ).       -   .     ,    : <br> <br> <code class="cpp">std::unique_ptr&lt;IAmUselessInterface&gt; something = UserUsefulFactory::CreateSomethingLessUseless&lt;DerivedUsefulClass&gt;(arguments);</code> <br>      ,  ,    ,  <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> ,    ,          - ,         private.         C++  ,      -   ,   API  -. <br> <br> <b>2.  .</b>   .      1   .     ,            !..   ,    ,         ,     ,   -       -  !            1    : <br> <br> <code class="cpp">std::unique_ptr&lt;I&gt; something = ::Instance().&lt;&gt;( ::Instance().&lt;&gt;(42)); //      :  (&lt;&gt;(42));</code> <br> <b>3.  .</b>    :        ,   ,   .  ,  :    -  .       ,       API,     -   -   -,      ,   .   ,  C++            ,            ,         -  . ,    <i></i>  <i></i>    <i></i> ,          API        . <br> <br>       Boost.Python.  <b>object</b>  namespace boost::python     ,    Python  C++,    <b>PyObject*</b> ,     .   PyObject*      object     (     <b>None</b> -  <b>NULL</b> -  Python). ,   ,         boost::python::dict     boost::python::object    . ,        ,    ,    ,   <b>dict</b>    <b>object</b> . <br> <br>   <a href="http://en.wikipedia.org/wiki/Double_dispatch">double dispatch</a> -   ,    ,   -  ,     ++       .        ,      : <br> <br> <code class="cpp">class person { public: //    - protected: class data; data&amp; get_data_reference(); data const&amp; get_data_const_reference() const; private: copy_on_write&lt;data&gt; m_data; }; class VIP : public person { public: //      protected: class data; //  VIP::data -   person::data };</code> <br>      : <br> <br> <code class="cpp">person president = VIP("mr. President");</code> <br>   ,     ,        -. <br>   ,     ,  ,        ,         .            ,    -    ! <br> <br>  <br>    API,  ,                 . <br>        ,      --API,    ,               ? <br>  !  -    ,  -   ,           .   ,        ,     ! <br> <br>   <br> <a href="http://en.wikipedia.org/wiki/Copy-on-write">   (Copy-on-write).</a> <br> <a href="http://en.wikipedia.org/wiki/Double_dispatch">  (Double dispatch)</a> <br> <a href="https://yadi.sk/d/347rwSrEWNiCY">       </a> - , , .</code></code> </div><p>Source: <a href="https://habr.com/ru/post/229327/">https://habr.com/ru/post/229327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229313/index.html">NSA will do away with collecting American phone metadata</a></li>
<li><a href="../229319/index.html">Android problem: users don't want to spend money</a></li>
<li><a href="../229321/index.html">Holiday Gadgets: Nikon CoolPix AW120 and Sony Action Cam AS100V Operating Experience</a></li>
<li><a href="../229323/index.html">How I got a job at google</a></li>
<li><a href="../229325/index.html">AdWords: Now on Blogger</a></li>
<li><a href="../229329/index.html">Javascript modules</a></li>
<li><a href="../229331/index.html">Rally: Testing OpenStack with Tempest has become easy (easier)</a></li>
<li><a href="../229335/index.html">VirtualBox VirtualBox on btrfs</a></li>
<li><a href="../229337/index.html">Ritot: smart and stylish projection clock</a></li>
<li><a href="../229339/index.html">Adaptive layout with Restive.JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>