<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenCL: How to make this thing work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot of people who have tried to ‚Äútaste‚Äù the technology of using CUDA / OpenCL graphic accelerators did not get very good results. Yes, tests are und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenCL: How to make this thing work</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/16d/aad/a99/16daada99ab921ea5311c6418e459e18.png" alt="image"><br><br>  A lot of people who have tried to ‚Äútaste‚Äù the technology of using CUDA / OpenCL graphic accelerators did not get very good results.  Yes, tests are underway and simple examples show impressive acceleration, but when it comes to real-world algorithms, it is very difficult to get a good result. <br>  How to make this technology work? <br>  In this article, I tried to summarize my semi-annual experience of butting with OpenCL technology under Mandriva linux and MacOS X 10.6 on the tasks of complex search for string data for bioinformatics.  OpenCL was chosen because it is a ‚Äúnative‚Äù technology for Mac (some of the Macs come with AMD and CUDA graphics cards under them are not available even theoretically), but the proposed recommendations are quite versatile and suitable for NVIDIA CUDA as well. <br><br>  So, what is needed for a graphics accelerator to work? <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Code parallelism </h2><br>  1. It is necessary to remember, and for those who did not know, study the techniques of code <i>refactoring</i> .  If you have an atypical algorithm, be prepared for the fact that it will take a long time to torture before you can properly parallelize.  In the course of these torments, the results of the program should not change, therefore, without a good test case, you can not even get down to work.  The example should not be worked out for too long, since it will have to be launched often, but not too quickly - we must evaluate the speed of its work.  Optimally - 20 seconds. <br>  2. Mass parallelism at the accelerator implies that there will be <i>data arrays</i> at the input and at the output of the algorithm, and the dimension of these arrays cannot be less than the number of threads of the parallel algorithm.  An accelerated algorithm usually looks like a for loop (or several nested such cycles), each iteration of which does not depend on the result of the previous ones.  Do you have such an algorithm? <br>  3. Parallel programming in itself is not an easy thing, even without the use of graphics accelerators.  Therefore, it is highly recommended to parallelize your algorithm first with something simpler, for example using <i>OpenMP</i> .  There, parallelism is turned on by one directive ... just do not forget that if any buffer variables are used in a cycle, then in parallel execution they must be multiplied by the number of iterations or created inside the cycle! <br>  4. In order not to lose dozens of hours, you need to be 100% sure that at least the parallel part of the program's algorithm is completely free from memory errors.  This is achieved, for example, with the help of <i>valgrind</i> .  Also, this wonderful program can catch paralleling errors via OpenMP, so it‚Äôs better to catch everything in advance, until you hit the accelerator - there are a lot less tools. <br><br><h2>  Consideration of the features of the accelerator </h2><br>  1. You need to understand that the accelerator works with <i>its own memory</i> , the amount of which is limited, and the transfer to and fro is quite expensive.  Specific figures depend on the specific system, but this question will have to be ‚Äúkept in mind‚Äù all the time.  Best of all, algorithms that take not so much (but not less than the number of threads!) Data work with graphic accelerators, and mathematically process them for a long time.  It is enough, but not very long, in many systems a limit is set for the time of maximum thread execution! <br>  2. Memory back and forth is copied <i>inseparable areas</i> .  Therefore, for example, ordinary dimensional arrays for C, organized as arrays of pointers to pointers, are completely unsuitable, it is necessary to use linearly organized multidimensional data arrays. <br>  3. In the ‚Äúinternal‚Äù code executed on the accelerator, <i>there are no</i> operations for allocating and freeing memory, I / O, recursion is impossible.  I / O, temporary buffers are provided by code executed on the central processor. <br>  4. ‚ÄúPerfect‚Äù algorithm for an accelerator - when <i>the same code works for different data (SIMD)</i> , when the code does not depend on them (for example, vector addition).  Any branching, any loop with a variable, dependent on a given number of iterations gives a significant slowdown. <br><br><h2>  Some conclusions </h2><br>  Thus, most likely, to use all the power of GPGPU, you will have to rewrite the code, having the above limitations in mind, and it's far from a fact that it will work out right away and it will work out altogether.  Not all tasks are well paralleled by data, alas.  But the result is worth it, since the transfer of molecular dynamics problems to GPGPU allowed NVIDIA specialists to get <a href="http://ambermd.org/gpus/benchmarks.htm">very interesting results,</a> which in the realities of our institute would allow us to count not one month on a supercomputer in another city, but one day on a desktop machine.  And for this it is worth the work. <br><br>  Used materials: <br>  <a href="http://www.nvidia.ru/object/cuda_opencl_new_ru.html">NVIDIA OpenCL</a> <br>  <a href="http://habrahabr.ru/tag/OpenCL/">Cycle of articles on Habr√©</a> <br>  <a href="http://developer.apple.com/library/mac/">OpenCL for Mac OS X</a> </div><p>Source: <a href="https://habr.com/ru/post/116579/">https://habr.com/ru/post/116579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116574/index.html">Intelligent Information Networks and the Semantic Web</a></li>
<li><a href="../116575/index.html">Determine your location via WiFi network</a></li>
<li><a href="../116576/index.html">April 1</a></li>
<li><a href="../116577/index.html">Using the singleton pattern</a></li>
<li><a href="../116578/index.html">How to deal with pauses GC</a></li>
<li><a href="../116581/index.html">Waiting for several events in nodejs</a></li>
<li><a href="../116582/index.html">Ubuntu 11.04 Beta released</a></li>
<li><a href="../116583/index.html">Mobile thumbnails</a></li>
<li><a href="../116584/index.html">Custom social buttons</a></li>
<li><a href="../116585/index.html">New sights appeared in Google Street View</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>