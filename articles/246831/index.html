<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Eleventh grader, or we test layout bugs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In today's web, unfairly little attention is paid to at least some automated UI testing. This is especially true of static layout. On the 2GIS Online ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Eleventh grader, or we test layout bugs</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c3f/e6e/f3e/c3fe6ef3ed4f47d6a6480086917e817e.png"><br><br>  In today's web, unfairly little attention is paid to at least some automated UI testing.  This is especially true of static layout.  On the <a href="http://2gis.ru/%3Futm_source%3Dnews%26utm_medium%3Dhabr%26utm_campaign%3Dpost_11thgrade">2GIS Online</a> project we tried to partially fill this gap.  What useful practices we have acquired, and what good libraries we have learned, we will tell further. <br><a name="habracut"></a><br><h4>  Layout </h4><br>  Consider the story of one fictional button: <br><br><img src="https://habrastorage.org/files/ba6/858/cb5/ba6858cb5c8546718366afde7fcfb092.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Square button with icon.  It's simple.  Dimensions can be hardcoded in pixels - what difference does it make? <br><br>  Almost immediately, the button begins to evolve.  Users rarely click a button.  What to do?  As an option - add an explanatory inscription.  It remains only to slightly increase the width, so that the inscription is included: <br><br><img src="https://habrastorage.org/files/546/211/c88/546211c88cc44f6c81a083e9378f8c62.png"><br><br>  But what about the inscription in Russian?  Yes, and the original text may change.  So hardcoding width is not possible, it is necessary to do an arbitrary: <br><br><img src="https://habrastorage.org/files/ae7/104/345/ae710434526b4d9c9716ecf661f7d778.png"><br><br>  There can be so much text that it cannot be read in one line.  It is necessary to limit the maximum width and untie the height: <br><br><img src="https://habrastorage.org/files/ba7/046/a1b/ba7046a1bdda4e57bb5de30c48962884.png"><br><br>  The button is still little used!  You can make an auxiliary multi-line description.  To do this, add a span-chick with the appropriate styles: <br><br><img src="https://habrastorage.org/files/fa6/b33/0ad/fa6b330ad2944fb49606cfb137af13a1.png"><br><br>  It seems that everything is already taken into account, and no one is able to break this layout.  No one except the <i>eleventh grader</i> is a long word that does not fit the maximum width.  Just do the transfer of letters: <br><br><img src="https://habrastorage.org/files/92d/346/eba/92d346eba1ee424e8182563badf3df5e.png"><br><br>  Users began to complain about the obsessive large button, so it was decided to make a cross, closing the button without actually pressing.  There are some styles for the cross, a bit of indentation for the title so that it does not fall under this cross - and everything is ready: <br><br><img src="https://habrastorage.org/files/9af/980/9a9/9af9809a99384190a9a0d70635a0bffd.png"><br><br>  Do not forget that the main text may not be, we edit indents: <br><br><img src="https://habrastorage.org/files/82b/cb6/d92/82bcb6d92c8747aaae3346afff3fcf68.png"><br><br>  It seems now we have a multifunctional button for all occasions, with corrected bugs, right?  Let's look at all the cases one more time, only now at the same time: <br><br><img src="https://habrastorage.org/files/11d/047/151/11d0471513f64f6899343675e11a862e.png"><br><br>  What do we see?  Instead of a fully functional button, we see an abundance of regression bugs: the icon fell out of the button, the vertical alignment broke, an extra indent appeared for the cross ... In other words, we wanted the best, it turned out as always. <br><br>  Now imagine that this is not about a button, but about a large, constantly developing project with a multi-million audience.  Support turns into a hell, in which, unfortunately, many layout designers live. <br><br>  There are many techniques and methodologies to help support the layout of complex projects.  For example, BEM, which is widely known to all, which we also use.  But the BEM methodology itself does not solve, but only localizes the regression bugs of the layout.  How to get rid of them in principle?  In fact, it is very simple (and for this you don‚Äôt need to learn the API of a dozen new js libraries!) - you need to create one test html page with all the button states.  Let's be together, right now, create it, it will not take more than 10 seconds.  Here you even markup: <br><br><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Test page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  No js, ‚Äã‚Äãnpm-dependencies, express-servers ... Just html-file, open in the browser. <br><br>  For each evolutionary iteration, one or several new states must be entered (that is, variants of the html-code of the element under test, including content), but not old ones should be deleted.  Viewing all the old states can be called semi-automatic regression. <br><br>  We will deliberately not advise any means of automating this work, for two reasons: firstly, for most cases, every front-end can create such a page on its own;  secondly, for complex cases, and pixel-perfect cases, we are writing our own solution, which we are not yet ready to announce. <br><br><h4>  Eleventh Grade </h4><br>  More than half of the layout bugs are associated with a very simple miscalculation: the front-end does not take into account that, generally speaking, any text can get into the text nodes of its layout.  It can be multi-line, consist of long words, or it can be an empty string. <br><br>  Take a couple of any of your layouts - I bet the Russian ruble is ready to argue that even an <i>eleven-</i> grader can break them.  Insert a few <i>eleven-graders</i> in each field - the breakdown of the layout is guaranteed! <br><br>  I suggest to open any popular site and execute the following code in the debugger <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a,w=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createTreeWalker(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>,NodeFilter.SHOW_TEXT);<span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(a=w.nextNode()){<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(a.textContent.trim().length)a.textContent=<span class="hljs-string"><span class="hljs-string">'    ,   ,  ,   '</span></span>}</code> </pre> <br>  The first dozen sites that came to mind (excluding 2GIS Online, of course) were broken to such an extent that it became absolutely impossible to use them. <br><br>  Of course, this does not mean that an eleventh-grader walks every day through all the text nodes of the Internet and breaks the layout (with the same success, the site can be protected from ebolavirus), but you should consider the following factors: <br><br><ol><li>  If your project is in several languages, then another language may contain a longer phrase (Russian is longer than English, Spanish is longer than Russian, etc.) </li><li>  The user may not have a main font, and the fallback will be larger </li><li>  The user can have a custom zoom or another font rendering engine. </li><li>  The text can be changed during the support process, including by content managers who will not be sure to check the layout. </li><li>  The wrong text can fly to the field simply because of a bug in the js code </li><li>  A bug in the layout of another block can shrink your block </li><li>  Someone read this article and execute the given code in the debugger :) </li></ol><br>  We sincerely believe that in any of these cases the entire text should be visible to the user, and it should be readable.  He can uncritically change the size of the block, go to fade or break with ellipsis;  but it should not turn into the attacking neighboring monster nodes, burning out the user's eyes;  that is, it should at least not fit into another text. <br><br><h4>  Automation </h4><br>  Everything about what we wrote above cannot be called automatic testing, because it requires a human eye.  If you do not want to strain your eyes at all, the tests that we call dom tests will help you. <br><br>  A Dom test is a js code running in a browser that checks something in the isolated part of the application, or in the entire application.  Anything can be checked: from the presence of a class and an attribute in html, to the arguments with which a function was called, including an asynchronous one. <br><br>  Here you will be helped by such wonderful libraries as: <br><br>  <b>mocha</b> .  A framework for testing.  Allows you to create tests and test groups, including asynchronous;  execute some code before a test or a group of tests, and after it. <br><br>  <b>chai</b> .  Library for asserts.  In principle, you can use the native assert node.js, but the ‚Äútea‚Äù has buns, for example, a beautiful diff deepEqual. <br><br>  <b>sinon</b> .  A library that allows you to do two important things: <br><br><ul><li>  Monitor features.  You will know how many times and with what arguments the function you are following is called. </li><li>  FakeTimers.  Allows you to substitute setTimeout and setInterval and, thus, ‚Äúmanage‚Äù time.  That is, after the substitution, you can call sinon.tick (20) - and it will instantly take 20 milliseconds of time, and all timeouts registered for execution in this period will be executed. </li></ul><br>  By combining all this, you can write tests both on the entire application and on its isolated parts.  In these tests, you can do literally everything: fill out the form and click on the buttons;  change dom-tree;  make ajax requests ... In fact, inside such tests you are inside the browser debugging console, and in your hands are any js-libraries for testing that you like. <br><br>  The advantage of such tests is that they are performed in the browser, which means that they can be run in any browser with zero resources for adaptation (which cannot be said about the selenium drivers, especially in combination, say, with ie8 android 4.0).  In addition, such tests can be run in fully automatic mode on phantomJS, for example on git-push hooks. <br><br>  Just in case, it should be noted that dom tests are not an alternative to regression testing of typesetting;  this is just another code protection approach, with its own specifics and scope. <br><br><h4>  findings </h4><br>  Get a html-page for the layout regression, put an <i>eleventh-</i> grader in it, and your layout will be 10 times better.  Protect your code with js-tests, and you will be able to refuse the services of testers (who will have to retrain in automators and help you write tests).  On the 2GIS Online project, 90% of the tasks get into combat without manual testing, and this was largely made possible by the above testing approaches. <br><br>  Do not wait for the <i>eleventh</i> grader to come to you herself! <br><br>  More information can be gleaned from <a href="http://techno.2gis.ru/lectures/12">my performance</a> on Web Standards Days. </div><p>Source: <a href="https://habr.com/ru/post/246831/">https://habr.com/ru/post/246831/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246817/index.html">Another Snake is not in 30 lines on Android</a></li>
<li><a href="../246819/index.html">New track on Coursera: Mobile Cloud Computing with Android</a></li>
<li><a href="../246825/index.html">Localization for Brazil: tips and tricks</a></li>
<li><a href="../246827/index.html">REST API for a couple of minutes with Lionframe</a></li>
<li><a href="../246829/index.html">Authorization of users with AngularJS and Firebase</a></li>
<li><a href="../246835/index.html">Video Metadata Framework SDK Video Metadata Management Tool - Intel New Year Gift</a></li>
<li><a href="../246837/index.html">Introducing Pop-up Events</a></li>
<li><a href="../246839/index.html">Why employees of large companies use ‚Äúleft‚Äù software for professional communication and what to do about it</a></li>
<li><a href="../246841/index.html">Windows 8.1 Kernel Patch Protection - PatchGuard</a></li>
<li><a href="../246843/index.html">Why great achievements will not make you happier (and what to do about it!)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>