<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving the time zone problem in a web application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When launching our project in a region where the time zone was different from Moscow, we faced the problem of the difference between local time and se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving the time zone problem in a web application</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage1/1bc68cd8/368d12c7/28bca041/61995cd5.png"><br><br>  When launching our project in a region where the time zone was different from Moscow, we faced the problem of the difference between local time and server time (Moscow time zone).  I must say that the logic of the project‚Äôs work is strongly tied to dates and times and it was impossible to leave a date in Moscow time.  Almost all the dates were stored in MySQL database in DATETIME format, which, as it turned out later, is not the best way to organize the work of the application in several time zones. <a name="habracut"></a><br><br>  The data type <b>DATETIME</b> is used to store the date and time in the range 1000-01-01 00:00:00 - 9999-12-31 23:59:59.  When sampling, the date is extracted exactly the same that was recorded, regardless of the temporary settings of the database.  You can convert the date to a specific time zone using the CONVERT_TZ function or adjust it manually in other ways. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another type for storing dates, <b>TIMESTAMP</b> , is the <u>only</u> type for storing a date in MySQL, depending on the time zone.  This type of data converts the time from local to UTC while saving, and when retrieving it back, taking into account the zone.  Importantly, all operations and output are <u>similar to the DATETIME type</u> (starting with MySQL 5.0). <br>  Also this type has very convenient features - it allows you to set NOW () as a default value, as well as a value when updating a record. <br>  The disadvantage of TIMESTAMP is the limited date range (1970 - 2038).  For this reason, it is not suitable for storing historical events or events of a distant future, but here and time zones are not critical. <br><br>  So we needed to find a solution that does not require large-scale rewriting of code and SQL queries, so the options to adjust the time in queries or using PHP tools did not look good. <br>  As a result, the following was done: <br>  - All dates in the database were converted to TIMESTAMP <br>  - When initializing a user session, the following code was added that sets the locale for MySQL and PHP: <br><br> <code>&lt;?php <br> date_default_timezone_set($user-&gt;timezone); <br> db::q("SET `time_zone`='".date('P')."'"); <br> ?&gt; <br></code> <br>  The <a href="http://php.net/manual/en/function.date-default-timezone-set.php">date_default_timezone_set ()</a> function accepts a string identifier of the time zone, for example ‚ÄúEurope / Moscow‚Äù, and sets it for all date and time functions. <br>  The SQL query sets the time zone for all queries within the current connection (for more details, see the <a href="http://dev.mysql.com/doc/refman/5.0/en/time-zone-support.html">official documentation</a> ). <br>  As a result, this solution works wonderfully in different time zones and is a working way to solve the problem. <br><br>  The conclusions of this post are simple: for projects with a wide geographic coverage, you should always use the TIMESTAMP type for storing time stamps, which will allow you to avoid headaches in the future. <br><br>  <b>UPD:</b> As <a href="https://habrahabr.ru/users/homm/" class="user_link">homm</a> rightly pointed <a href="https://habrahabr.ru/users/homm/" class="user_link">out</a> , for the base it is more correct to set the time not by offset (as in the code above), but by the time zone identifier, otherwise daylight saving time transitions and other historical changes for this zone are not taken into account.  In this case, you need to load the corresponding data into the database using <a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-tzinfo-to-sql.html">mysql_tzinfo_to_sql</a> and update them in a timely manner. </div><p>Source: <a href="https://habr.com/ru/post/124297/">https://habr.com/ru/post/124297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124287/index.html">Larry Page has reported for the second quarter: a lot of numbers</a></li>
<li><a href="../124291/index.html">Microsoft creates its own social search engine?</a></li>
<li><a href="../124294/index.html">Site like Obama's: so beautiful and glowing</a></li>
<li><a href="../124295/index.html">Osmand User Guide</a></li>
<li><a href="../124296/index.html">Risk Management and Pistachios</a></li>
<li><a href="../124300/index.html">Mozilla is developing an alternative to OpenID</a></li>
<li><a href="../124302/index.html">Configure Kannel SMS Gateway</a></li>
<li><a href="../124305/index.html">Create an email newsletter that sells</a></li>
<li><a href="../124306/index.html">BitTorrent Inc will release a paid version of uTorrent</a></li>
<li><a href="../124310/index.html">DoS vulnerability in Open vSwitch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>