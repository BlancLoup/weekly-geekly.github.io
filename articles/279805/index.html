<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the source code of the game engine Serious Engine v.1.10 for the anniversary of the shooter Serious Sam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the anniversary of the release of the first-person shooter Serious Sam, which was held in March 2016, the game developers from the Croatian company...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the source code of the game engine Serious Engine v.1.10 for the anniversary of the shooter Serious Sam</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/921/2c3/8ea/9212c38ea4ef712fa28deaf16da7edff.png" align="left"><br>  On the anniversary of the release of the first-person shooter Serious Sam, which was held in March 2016, the game developers from the Croatian company Croteam decided to open the source code of the game engine Serious Engine 1 v.1.10.  He interested a lot of developers who wanted to explore and improve the engine.  I also decided to participate in improving the code and prepared an article with an overview of the errors found using the PVS-Studio static analyzer. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  Serious Engine is a game engine developed by Croatian company <a href="http://www.croteam.com/">Croteam</a> .  Version v.1.10 was used in the games Serious Sam Classic: The First Encounter and Serious Sam Classic: The Second Encounter.  Subsequently, Croteam developed more advanced game engines - Serious Engine 2, Serious Engine 3 and Serious Engine 4, and the source code for Serious Engine version 1.10 was officially <a href="https://github.com/Croteam-official/Serious-Engine">opened</a> and available under the <a href="https://ru.wikipedia.org/wiki/GNU_General_Public_License">GNU General Public License v.2</a> . <br><br>  I want to note that the project is easily assembled in Visual Studio 2013 and is easily verified using the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 6.02 static analyzer. <br><br><h2>  Typos! </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94c/81e/f55/94c81ef55e7887f094ba9f244ee26a9e.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://www.viva64.com/ru/d/0090/">V501</a> operator: tp_iAnisotropy == tp_iAnisotropy gfx_wrapper.h 180 <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CTexParams</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CTexParams tp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tp_iFilter == tp.tp_iFilter &amp;&amp; tp_iAnisotropy == tp_iAnisotropy &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= tp_eWrapU == tp.tp_eWrapU &amp;&amp; tp_eWrapV == tp.tp_eWrapV; }; .... };</span></span></code> </pre> <br>  For clarity, I changed the formatting of this code fragment.  So the defect that the analyzer found is much more noticeable.  The variable is compared to itself.  The object with the name 'tp' has the field 'tp_iAnisotropy', therefore, by analogy with the neighboring code, part of the condition should look like "tp_iAnisotropy == tp.tp_iAnisotropy". <br><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> GetShadingMapWidth () &lt;32 'There are identical sub-expressions  operator.  terrain.cpp 561 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CTerrain::SetShadowMapsSize(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GetShadowMapWidth()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span> || GetShadingMapHeight()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GetShadingMapWidth()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span> || GetShadingMapWidth()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= tr_iShadingMapSizeAspect = 0; } .... PIX pixShadingMapWidth = GetShadingMapWidth(); PIX pixShadingMapHeight = GetShadingMapHeight(); .... }</span></span></code> </pre> <br>  Here the analyzer detected a suspicious code to check the width and height of a certain card.  Only widths are more exact, because the code contains two identical checks ‚ÄúGetShadingMapWidth () &lt;32‚Äù.  Most likely, the condition should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GetShadingMapWidth()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span> || GetShadingMapHeight()&lt;<span class="hljs-number"><span class="hljs-number">32</span></span>) { tr_iShadingMapSizeAspect = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions '(vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType)' operator.  worldeditor.h 580 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> BOOL CValuesForPrimitive::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(....) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( (....) &amp;&amp; (vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType) &amp;&amp;<span class="hljs-comment"><span class="hljs-comment">//&lt;= (vfp_plPrimitive == vfpToCompare.vfp_plPrimitive) &amp;&amp; .... (vfp_bDummy == vfpToCompare.vfp_bDummy) &amp;&amp; (vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType) &amp;&amp;//&lt;= .... (vfp_fXMin == vfpToCompare.vfp_fXMin) &amp;&amp; (vfp_fXMax == vfpToCompare.vfp_fXMax) &amp;&amp; (vfp_fYMin == vfpToCompare.vfp_fYMin) &amp;&amp; (vfp_fYMax == vfpToCompare.vfp_fYMax) &amp;&amp; (vfp_fZMin == vfpToCompare.vfp_fZMin) &amp;&amp; (vfp_fZMax == vfpToCompare.vfp_fZMax) &amp;&amp; .... );</span></span></code> </pre> <br>  The condition in the overloaded comparison operator takes 35 lines.  It is not surprising that, for convenience, the author used the copying of lines to speed up the writing of code.  But with this approach it is easy to make a mistake.  Perhaps there is an extra check here, but you may have forgotten to rename the copied line, and the comparison operator now does not always return the correct result. <br><br><h2>  Many strange comparisons </h2><br>  <a href="http://www.viva64.com/ru/d/0152/">V559</a> Suspicious assignment: the operator of the condition: pwndView = 0. mainfrm.cpp 697 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CMainFrame::OnCancelMode() { <span class="hljs-comment"><span class="hljs-comment">// switches out of eventual direct screen mode CWorldEditorView *pwndView = (....)GetActiveView(); if (pwndView = NULL) { // &lt;= // get the MDIChildFrame of active window CChildFrame *pfrChild = (....)pwndView-&gt;GetParentFrame(); ASSERT(pfrChild!=NULL); } CMDIFrameWnd::OnCancelMode(); }</span></span></code> </pre> <br>  There are many suspicious comparisons in the engine code.  For example, in this fragment, the pointer ‚ÄúpwndView‚Äù is obtained, and then it is assigned a NULL, which is why the condition is always false. <br><br>  Most likely, here they wanted to write the inequality operator '! =' And the code should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwndView != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// get the MDIChildFrame of active window CChildFrame *pfrChild = (....)pwndView-&gt;GetParentFrame(); ASSERT(pfrChild!=NULL); }</span></span></code> </pre> <br>  There is another similar code snippet: <ul><li>  V559 Suspicious assignment of the operator of the condition: pwndView = 0. mainfrm.cpp 710 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always false.  Probably the '||'  operator should be used here.  entity.cpp 3537 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RenderType { .... RT_BRUSH = <span class="hljs-number"><span class="hljs-number">4</span></span>, RT_FIELDBRUSH = <span class="hljs-number"><span class="hljs-number">8</span></span>, .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CEntity::DumpSync_t(CTStream &amp;strm, INDEX iExtensiveSyncCheck) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( en_pciCollisionInfo == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { strm.FPrintF_t(<span class="hljs-string"><span class="hljs-string">"Collision info NULL\n"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (en_RenderType==RT_BRUSH &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= en_RenderType==RT_FIELDBRUSH) { // &lt;= strm.FPrintF_t("Collision info: Brush entity\n"); } else { .... } .... }</span></span></code> </pre> <br>  One variable named "en_RenderType" is compared with two different constants.  The error is that the logical multiplication operator '&amp;&amp;' is used.  A variable cannot be equal to two constants at the same time, therefore the condition is always false.  At this point, use the operator '||'. <br><br>  <a href="http://www.viva64.com/ru/d/0152/">V559</a> Suspicious assignment of the operator: _strModURLSelected = "".  menu.cpp 1188 <br><pre> <code class="cpp hljs">CTString _strModURLSelected; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JoinNetworkGame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> strModURL[<span class="hljs-number"><span class="hljs-number">256</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; _pNetwork-&gt;ga_strRequiredMod.ScanF(...., &amp;strModURL); _fnmModSelected = CTString(strModName); _strModURLSelected = strModURL; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (_strModURLSelected="") { // &lt;= _strModURLSelected = "http://www.croteam.com/mods/Old"; } .... }</span></span></code> </pre> <br>  An interesting mistake.  In this function, a certain query is executed and the result is written into the buffer with the name ‚ÄústrModURL‚Äù (url-link to ‚Äúmod‚Äù).  Further, this result is stored in an object with the name "_strModURLSelected" of the class "CTString".  This is an own implementation of the class for working with strings.  Due to a typo, in the 'if (_strModURLSelected = "")' condition, the previously received url link is triturated with an empty string instead of a comparison with it.  Next comes the string casting operator type const char *.  As a result, the condition will make a comparison with a pointer zero, which stores a reference to an empty string.  Such a pointer is always non-zero.  Therefore, the condition will always be true. <br><br>  The result of this code will always be the use of a link that is strictly prescribed in the code.  Although planned to use this link as the default. <br><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  propertycombobar.cpp 1853 <br><pre> <code class="cpp hljs">CEntity *CPropertyComboBar::GetSelectedEntityPtr(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// obtain selected property ID ptr CPropertyID *ppidProperty = GetSelectedProperty(); // if there is valid property selected if( (ppidProperty == NULL) || (ppidProperty-&gt;pid_eptType != CEntityProperty::EPT_ENTITYPTR) || (ppidProperty-&gt;pid_eptType != CEntityProperty::EPT_PARENT) ) { return NULL; } .... }</span></span></code> </pre> <br>  Here the analyzer detected an error opposite to the previous one.  Two checks on the "pid_eptType" variable for inequality always give the truth due to the use of the operator '||'.  Therefore, the exit from the function is always performed, regardless of the value of the ppidProperty pointer and the variable ppidProperty-&gt; pid_eptType. <br><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'ulUsedShadowMemory&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. gfxlibrary.cpp 1693 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CGfxLibrary::ReduceShadows(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { ULONG ulUsedShadowMemory = ....; .... ulUsedShadowMemory -= sm.Uncache(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= ASSERT( ulUsedShadowMemory&gt;=0); // &lt;= .... }</span></span></code> </pre> <br>  In this code fragment, unsafe decrement of an unsigned variable is performed, since  an overflow of the ‚ÄúulUsedShadowMemory‚Äù variable may occur.  At the same time there is Assert (), which will never issue a warning.  A very suspicious place that developers should check out. <br><br>  <a href="http://www.viva64.com/ru/d/0343/">V704</a> 'this! = 0' it should be compiled, because it can be never. NULL.  entity.h 697 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CEntity::AddReference(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>!=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= ASSERT(en_ctReferences&gt;=0); en_ctReferences++; } };</span></span></code> </pre> <br>  The engine code contains 28 comparisons of 'this' with zero.  The code was written a long time ago, but according to the modern standard of the C ++ language, the 'this' pointer cannot be zero, therefore, the compiler can perform optimization and remove the check.  In more difficult conditions, this can lead to unexpected errors.  Examples can be found in the diagnostic <a href="http://www.viva64.com/ru/d/0343/">documentation</a> . <br><br>  Specifically, Visual C ++ does not behave this way.  But this is a matter of time.  Such a code is more outlawed. <br><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'achrLine! = ""' Is always true.  To compare strings you should use strcmp () function.  worldeditor.cpp 2254 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CWorldEditorApp::OnConvertWorlds() { .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> achrLine[<span class="hljs-number"><span class="hljs-number">256</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// &lt;= CTFileStream fsFileList; // count lines in list file try { fsFileList.Open_t( fnFileList); while( !fsFileList.AtEOF()) { fsFileList.GetLine_t( achrLine, 256); // increase counter only for lines that are not blank if( achrLine != "") ctLines++; // &lt;= } fsFileList.Close(); } .... }</span></span></code> </pre> <br>  The analyzer detected an incorrect string comparison with an empty string.  The error is that the test (achrLine! = "") Is always true and the increment of the variable "ctLines" is always executed.  Although the commentary says that this should only be done for non-empty strings. <br><br>  This behavior is caused by the fact that in this condition two pointers are compared: ‚ÄúachrLine‚Äù and a pointer to a temporary empty line.  Such pointers will never be equal. <br><br>  Correct code using the strcmp () function: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(achrLine, <span class="hljs-string"><span class="hljs-string">""</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) ctLines++;</code> </pre> <br>  There are two more such wrong comparisons: <ul><li>  V547 Expression is always true.  To compare strings you should use strcmp () function.  propertycombobar.cpp 965 </li><li>  V547 Expression 'achrLine == "" is always false.  To compare strings you should use strcmp () function.  worldeditor.cpp 2293 </li></ul><br><h2>  Mistakes </h2><br>  <a href="http://www.viva64.com/ru/d/0130/">V541</a> It is dangerous to print the string 'achrDefaultScript' into itself.  dlgcreateanimatedtexture.cpp 359 <br><pre> <code class="cpp hljs">BOOL CDlgCreateAnimatedTexture::OnInitDialog() { .... <span class="hljs-comment"><span class="hljs-comment">// allocate 16k for script char achrDefaultScript[ 16384]; // default script into edit control sprintf( achrDefaultScript, ....); // &lt;= .... // add finishing part of script sprintf( achrDefaultScript, // &lt;= "%sANIM_END\r\nEND\r\n", // &lt;= achrDefaultScript); // &lt;= .... }</span></span></code> </pre> <br>  Here form a certain line in the buffer.  Then they want to get a new line, keeping the previous value of the line, and add two more words to it.  It seems simple. <br><br>  To explain why an unexpected result can be obtained here, I will quote a simple example from the documentation for this diagnostic: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> s[<span class="hljs-number"><span class="hljs-number">100</span></span>] = <span class="hljs-string"><span class="hljs-string">"test"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(s, <span class="hljs-string"><span class="hljs-string">"N = %d, S = %s"</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, s);</code> </pre> <br>  As a result of this code, I want to get the line: <br><pre> <code class="cpp hljs">N = <span class="hljs-number"><span class="hljs-number">123</span></span>, S = test</code> </pre> <br>  But in practice, the string will be formed in the buffer: <br><pre> <code class="cpp hljs">N = <span class="hljs-number"><span class="hljs-number">123</span></span>, S = N = <span class="hljs-number"><span class="hljs-number">123</span></span>, S =</code> </pre> <br>  In such situations, a similar code can lead not only to the output of incorrect text, but also to the emergency termination of the program.  The code can be corrected by using a new buffer to save the result.  Safe option: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> s1[<span class="hljs-number"><span class="hljs-number">100</span></span>] = <span class="hljs-string"><span class="hljs-string">"test"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> s2[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(s2, <span class="hljs-string"><span class="hljs-string">"N = %d, S = %s"</span></span>, <span class="hljs-number"><span class="hljs-number">123</span></span>, s1);</code> </pre> <br>  Similarly, it is worth doing in the code Serious Engine.  Although code may work due to luck, it will be safer to use an additional buffer to form a string. <br><br>  <a href="http://www.viva64.com/ru/d/0181/">It is a V579</a> .  It is possibly a mistake.  Inspect the third argument.  mesh.cpp 224 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// optimize lod of mesh void CMesh::OptimizeLod(MeshLOD &amp;mLod) { .... // sort array qsort(&amp;_aiSortedIndex[0] // &lt;= ctVertices sizeof(&amp;_aiSortedIndex[0]), // &lt;= qsort_CompareArray); .... }</span></span></code> </pre> <br>  The qsort () function takes as its third argument the size of the element of the array being sorted.  It is very suspicious that the size of the pointer is always passed there.  Most likely someone copied the first argument of the function to the third, but forgot to erase the character of taking the address. <br><br>  <a href="http://www.viva64.com/ru/d/0222/">V607</a> Ownerless expression 'pdecDLLClass-&gt; dec_ctProperties'.  entityproperties.cpp 107 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CEntity::ReadProperties_t(CTStream &amp;istrm) <span class="hljs-comment"><span class="hljs-comment">// throw char * { .... CDLLEntityClass *pdecDLLClass = en_pecClass-&gt;ec_pdecDLLClass; .... // for all saved properties for(INDEX iProperty=0; iProperty&lt;ctProperties; iProperty++) { pdecDLLClass-&gt;dec_ctProperties; // &lt;= .... } .... }</span></span></code> </pre> <br>  It is not clear what the highlighted line of code does.  Rather, it is clear that just nothing.  The class field is not used at all.  Perhaps this error occurred after refactoring, or just a line remained after debugging. <br><br>  <a href="http://www.viva64.com/ru/d/0225/">V610</a> Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '(- 2)' is negative.  layermaker.cpp 363 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CLayerMaker::SpreadShadowMaskOutwards(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ADDNEIGHBOUR(du, dv) \ </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((pixLayerU+(du)&gt;=0) \ &amp;&amp;(pixLayerU+(du)</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;pixLayerSizeU) \ &amp;&amp;(pixLayerV+(dv)&gt;=0) \ &amp;&amp;(pixLayerV+(dv)&lt;pixLayerSizeV) \ &amp;&amp;(pubPolygonMask[slOffsetMap+(du)+((dv)&lt;&lt;pixSizeULog2)])) {\ .... \ } ADDNEIGHBOUR(-2, -2); // &lt;= ADDNEIGHBOUR(-1, -2); // &lt;= .... // &lt;= }</span></span></span></span></code> </pre> <br>  The macro "ADDNEIGHBOUR" is declared in the function body and is used 28 times in a row.  Negative numbers are passed to this macro where they are shifted.  According to modern C and C ++ standards, a negative number shift leads to undefined behavior. <br><br>  <a href="http://www.viva64.com/ru/d/0265/">V646</a> Consider inspecting the application's logic.  It's possible that 'else' keyword is missing.  sessionstate.cpp 1191 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CSessionState::ProcessGameStream(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res==CNetworkStream::R_OK) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res==CNetworkStream::R_BLOCKNOTRECEIVEDYET) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... } else if (res==CNetworkStream::R_BLOCKMISSING) { .... } .... }</span></span></code> </pre> <br>  Looking at the design of the code, it can be assumed that in the cascade of conditions the 'else' keyword is indeed missing. <br><br>  Another place: <ul><li>  V646 Consider inspecting the application's logic.  It's possible that 'else' keyword is missing.  terrain.cpp 759 </li></ul><br>  V595 The 'pAD' pointer was used before it was verified against nullptr.  Check lines: 791, 796. anim.cpp 791 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAnimObject::SetData(CAnimData *pAD) { <span class="hljs-comment"><span class="hljs-comment">// mark new data as referenced once more pAD-&gt;AddReference(); // &lt;= // mark old data as referenced once less ao_AnimData-&gt;RemReference(); // remember new data ao_AnimData = pAD; if( pAD != NULL) StartAnim( 0); // &lt;= // mark that something has changed MarkChanged(); }</span></span></code> </pre> <br>  At the end of the article I want to give an example of an error with a potential dereference of a null pointer.  After reading the analyzer warning, in this small function it is easy to see how dangerous the "pAD" pointer is used.  Almost immediately after calling ‚ÄúpAD-&gt; AddReference ()‚Äù, a ‚ÄúpAD! = NULL‚Äù check is performed, indicating that a null pointer can be passed to this function. <br><br>  The entire list of found dangerous places with signs: <ul><li>  V595 The '_ppenPlayer' pointer was used before it was verified against nullptr.  Check lines: 851, 854. computer.cpp 851 </li><li>  V595 The '_meshEditOperations' pointer was used before it was verified against nullptr.  Check lines: 416, 418. modelermeshexporter.cpp 416 </li><li>  V595 The '_fpOutput' pointer was used before it was verified against nullptr.  Check lines: 654, 664. modelermeshexporter.cpp 654 </li><li>  V595 The '_appPolPnts' pointer was used before it was verified against nullptr.  Check lines: 647, 676. modelermeshexporter.cpp 647 </li><li>  V595 The 'pModelerView' pointer was used before it was verified against nullptr.  Check lines: 60, 63. dlginfopgglobal.cpp 60 </li><li>  V595 The 'pNewWT' pointer was used before it was verified against nullptr.  Check lines: 736, 744. modeler.cpp 736 </li><li>  V595 The 'pvpViewPort' pointer was used before it was verified against nullptr.  Check lines: 1327, 1353. serioussam.cpp 1327 </li><li>  V595 The 'pDC' pointer was used before it was verified against nullptr.  Check lines: 138, 139. tooltipwnd.cpp 138 </li><li>  V595 The 'm_pDrawPort' pointer was used before it was verified against nullptr.  Check lines: 94, 97. wndanimationframes.cpp 94 </li><li>  V595 The 'penBrush' pointer was used before it was verified against nullptr.  Check lines: 9033, 9035. worldeditorview.cpp 9033 </li></ul><br><h2>  Conclusion </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9d4/ebe/885/9d4ebe885c6a7fa354accb774f9a502d.png"></div><br><br>  Checking the game engine Serious Engine 1 v.1.10 showed that errors in the code of projects can live for a very long time and even celebrate the anniversary!  The article includes only some of the most interesting examples from the analyzer report.  I gave a lot of warnings just a list.  But the entire report contains quite a few warnings for such a small project.  Croteam has more advanced game engines - Serious Engine 2, Serious Engine 3 and Serious Engine 4. I am afraid to imagine how much dangerous code could migrate to the new series of the engine.  I hope that after reading the article, the developers will use the PVS-Studio static analyzer in their projects and will delight users with high-quality games.  After all, the analyzer is <a href="http://www.viva64.com/ru/pvs-studio-download/">easy to download</a> , <a href="http://www.viva64.com/ru/d/0011/">easy to run</a> in Visual Studio, and for any other build systems there is a <a href="http://www.viva64.com/ru/d/0360/">Standalone</a> utility. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0384/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0384/">Serious Sam Shooter anniversary - finding bugs in the code of the Serious Engine v.1.10</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/279805/">https://habr.com/ru/post/279805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279793/index.html">April 8 - learn everything about the Microsoft Azure cloud in one cloudy day</a></li>
<li><a href="../279797/index.html">How to use parquet and not slip</a></li>
<li><a href="../279799/index.html">Building Android applications step by step, part three</a></li>
<li><a href="../279801/index.html">IBM transferred almost 44,000 lines of code to the open-source blockchain project to the Hyperledger Project</a></li>
<li><a href="../279803/index.html">We select valid mobile numbers of VK friends in Python</a></li>
<li><a href="../279807/index.html">Record of the webinar "Managing Server and Personal Security in Kerio Connect"</a></li>
<li><a href="../279809/index.html">Douglas Engelbart: "The Mother of All Demos". Part 1</a></li>
<li><a href="../279811/index.html">Android Cuvettes, Part 1: SDK</a></li>
<li><a href="../279813/index.html">Genetic Programming ("Yet Another Bicycle" Edition)</a></li>
<li><a href="../279815/index.html">Engineering Assessment: how to measure the technical condition of the project?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>