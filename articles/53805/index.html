<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automated acceptance of webmoney payments on your site.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Introduction 

 It's no secret that lately webmoney gained enough popularity to become one of the most convenient and affordable means for cashless...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automated acceptance of webmoney payments on your site.</h1><div class="post__text post__text-html js-mediator-article"> <b>0. Introduction</b> <br><br>  It's no secret that lately webmoney gained enough popularity to become one of the most convenient and affordable means for cashless payments via the Internet.  Replenish the balance of your mobile, pay for the purchase of goods in the web store - all this can be done using webmoney. <br><br>  I would like to tell you in several ways how you can arrange to receive payment for any goods or services on your website with electronic currency webmoney.  This, by the way, is not as difficult as it might seem at first glance! <br><a name="habracut"></a><br>  <b>1. Merchant WebMoney Transfer</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is the tool that developers have provided to us to automate making payments.  Merchant WebMoney Transfer is a set of interfaces for interacting with the WebMoney system.  Below I will try to briefly describe them. <br><br>  <b>1.1 Web Merchant Interface</b> is the easiest way to organize payment for webmoney, based on a specially formed form that simply sends the user and his data to the webmoney site, where he performs the basic actions to pay for funds. <br>  All that is needed to receive payment in this way is to place on your site 3 pages - a page with a form for payment, a page of a successful payment and a page for a failed payment.  Then you set up the server-side for payment processing once and enjoy the cash flow pouring into your pocket =) A more detailed description of this interface is available here: <a href="https://merchant.webmoney.ru/conf/guide_simple.asp">https://merchant.webmoney.ru/conf/guide_simple.asp</a> . <br><br>  <b>1.2 Click &amp; Buy Merchant Interface</b> - This interface allows the buyer to pay webmoney with one click of the mouse using WM Keeper.  The point is this: the customer clicks on a special webmoney link (of the wmk type: paylink ...) and the entire payment process takes place in WM Keeper.  A more detailed description of this interface is available here <a href="https://merchant.webmoney.ru/conf/guide_pci.asp">https://merchant.webmoney.ru/conf/guide_pci.asp</a> . <br><br>  <b>1.3 WM Automation Interface</b> - Delicious =) This is a set of XML interfaces (15 pieces, from X1 to X15) based on requests to the webmoney web server using the https protocol in XML format using a special authentication module for WM Keeper Classic keys <br>  or standard x.509 certificates (WM Keeper Light certificates).  Using these interfaces, you can perform a wide range of actions in your wallet, for example: <br><br>  - Bill the customer (X1) <br>  - Receipt of history and verification of payment of bills (X4) <br>  - Getting balance (X9) <br><br>  and much more interesting.  Actually, I would like to dwell on this interface, or rather, on this set of interfaces. <br><br>  <b>2.XML - the choice of professionals!</b> <br><br>  <b>2.1 Task setting</b> - Once I needed to implement the reception and issuance of WM on the site, automatically, with logging the movement of money, in order to avoid incidents.  To ensure full automation of work, you need to use WM Automation Interface, since other types of interfaces will not give us the proper functionality. <br><br>  <b>2.2 Tool</b> - We will not invent bicycles, but use a ready-made library called WMXI.  She lives at <a href="http://my-tools.net/wmxi/">my-tools.net/wmxi</a> .  For its successful operation, the server must meet the following requirements: BCMath or GMP, MHash or Hash, CURL, MBString, Enabled XML.  To check whether your hosting meets these conditions, you can use the check.php utility from the WMXI suite. <br><br>  <b>2.3 Account statement.</b>  To begin with, let's carry out the simplest task: issuing an invoice from the store to a customer.  For these purposes, an interface X1 is provided, and we will use it.  However, one should not forget that invoice issuance does not guarantee that it will be paid =) So, it will be necessary to check the invoice payment later. <br><br>  Here is the code itself: <br> <code>&lt;?php <br> //  <br> include_once("wmxi/wmsigner.php"); <br> include_once("wmxi/wmxi.php"); <br> include_once("wmxi/wmxiparser.php"); <br> //   WMXI.  : <br> //  ,         <br> //,   .    UTF-8 <br> $wmxi = new WMXI(realpath("../WebMoneyCA.crt"), DOC_ENCODING); <br> //      <br> // Webmoney Keeper Classic.  : <br> //WMID -   <br> //       <br> //       164  <br> //     <br> $wmxi-&gt;Classic("000000000000", "password", "../keys/000000000000.kwm"); <br> //    <br> $parser = new WMXIParser(); <br> //,   <br> $response = $wmxi-&gt;X1( <br> $wm_transfer, //     ;     . <br> $_POST[wmid], //wmid  <br> "Z999988887777", //  <br> floatval($_POST[money]), //       <br> "    MYSITE.RU", //   0  255 ;        <br> "http://mysite.ru", //   0  255 ;        <br> 0, //   0  255;  0 -        <br> 1 //   0  255;  0 -     <br> ); <br> //    .  : <br> //XML-  <br> //,   .    UTF-8 <br> $structure = $parser-&gt;Parse($response, DOC_ENCODING); <br> //       . <br> //     ,      =) <br> $transformed = $parser-&gt;Reindex($structure, true); <br> //    == 0 ( ) <br> if($structure["w3s.response"]["retval"] == 0) <br> { <br> $transformed["w3s.response"]["reqn"]; //     WM <br> $transformed["w3s.response"]["invoice"]["orderid"]; //    ,     <br> echo "    !"; <br> } <br> else echo $structure["w3s.response"]["retdesc"]; // ,   . <br> ?&gt; <br></code> <br><br>  That's all =).  Account issued, it remains only to wait for the money.  Only in appearance it seems difficult, in fact, everything is super-simple! <br><br>  <b>2.4 Checking account status.</b>  The invoice is issued, and how to find out paid or not.  This is where the X4 interface comes in.  It allows you to get the history of invoices issued on the wallet, as well as check the payment of the invoice, which is what we need.  Let's see how to do it: <br> <code>&lt;?php <br> //  <br> include_once("wmxi/wmsigner.php"); <br> include_once("wmxi/wmxi.php"); <br> include_once("wmxi/wmxiparser.php"); <br> //   WMXI.  : <br> //  ,         <br> //,   .    UTF-8 <br> $wmxi = new WMXI(realpath("../WebMoneyCA.crt"), DOC_ENCODING); <br> //      <br> // Webmoney Keeper Classic.  : <br> //WMID -   <br> //       <br> //       164  <br> //     <br> $wmxi-&gt;Classic("000000000000", "password", "../keys/000000000000.kwm"); <br> //    <br> $parser = new WMXIParser(); <br> //,   <br> $response = $wmxi-&gt;X4( <br> "Z999988887777",//  <br> 0,//  &gt; 0,     WM <br> $wm_transfer,//     ;      <br> date("Ymd H:i:s", time()-86400),//      <br> date("Ymd H:i:s", time())//      <br> ); <br> //    .  : <br> //XML-  <br> //,   .    UTF-8 <br> $structure = $parser-&gt;Parse($response, DOC_ENCODING); <br> //       . <br> //     ,      =) <br> $transformed = $parser-&gt;Reindex($structure, true); <br> //    == 0 ( ) <br> if($structure["w3s.response"]["retval"] == 0) <br> { <br> $state = $transformed["w3s.response"]["outinvoices"]["outinvoice"]["state"]; <br> switch($state) <br> { <br> case 0: <br> echo " "; <br> break; <br> case 1: <br> echo "  "; <br> break; <br> case 2: <br> echo " "; <br> break; <br> case 3: <br> echo ""; <br> break; <br> } <br> else echo $structure["w3s.response"]["retdesc"]; // ,   . <br> ?&gt; <br></code> <br>  That's all.  It remains only to realize the accounting statement and payment of bills in your database, and a full-fledged web store is ready! <br><br>  <b>3.That is.</b>  I hope I‚Äôve got an easy way to explain the principles of automatic work in WM accounts, despite the fact that this is my first article on programming.  I will be glad to your questions, which I will be happy to answer! </div><p>Source: <a href="https://habr.com/ru/post/53805/">https://habr.com/ru/post/53805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../53796/index.html">Quake Live & Jabber</a></li>
<li><a href="../53801/index.html">bloGoo.ru - daily cream of the Russian blogosphere</a></li>
<li><a href="../53802/index.html">But have I fallen into hablability? :)</a></li>
<li><a href="../53803/index.html">HDtracker.ru - open registration</a></li>
<li><a href="../53804/index.html">Startup Crash Test 3.0 Beta. Kiev</a></li>
<li><a href="../53808/index.html">Extend Sizzle (pseudo selectors)</a></li>
<li><a href="../53810/index.html">Lenovo ThinkPad T60: Mistress of a Note</a></li>
<li><a href="../53816/index.html">invites brokenstones.me</a></li>
<li><a href="../53817/index.html">Why is elderly email still ideal for working communication?</a></li>
<li><a href="../53820/index.html">We cling healthy ammeters to a PC via Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>