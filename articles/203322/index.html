<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of cross-platform modular applications in C ++ with the library wxWidgets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 For a long time I have not been writing articles on development, although I really like the process of writing and allows me to bring ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of cross-platform modular applications in C ++ with the library wxWidgets</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br><br>  For a long time I have not been writing articles on development, although I really like the process of writing and allows me to bring my thoughts in order. <br><br>  And now, there is an opportunity now to talk about the developments that have appeared lately.  I hope someone this text greatly simplify life and give impetus to the conquest of new peaks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This time we will talk about creating cross-platform applications with C ++ plugins using the wxWidgets library.  Considered to be the operating systems Windows, Linux and OS X, as the most popular. <br><br>  As usual, the first part will be an overview, in order to lower the entry threshold for readers.  Some of the information from the first part will seem obvious (especially as regards the toolkit), but, nevertheless, I consider it necessary, because for beginners the information from the first part will allow organizing the development process with minimal effort. <br>  Next - a phased analysis of the test application code with explanations. <br><a name="habracut"></a><br><h3>  Tools </h3><br><h4>  wxWidgets </h4><br>  First we need: <br><br>  The wxWidgets library in source code.  I use the most recent version of SVN.  They are, of course, not without bugs, but they implemented functionality, which is usually not enough in official releases. <br><br>  Source code can be found here: <a href="http://svn.wxwidgets.org/svn/wx/wxWidgets/trunk">http://svn.wxwidgets.org/svn/wx/wxWidgets/trunk</a> <br><br>  You can read more about the library building process here: <a href="http://habrahabr.ru/post/123588/">http://habrahabr.ru/post/123588/</a> <br><br>  The difference in the build process, compared with the above article, is only that you need to use the <code>DLL Debug</code> configuration <code>DLL Debug</code> and <code>DLL Release</code> instead of <code>Debug</code> and <code>Release</code> .  In addition, it is imperative that in the settings of all projects included in the wxWidgets distribution kit, the <code>Multi-Threaded Debug DLL  Multi-Threaded DLL</code> values ‚Äã‚Äãare specified in the <code>C/C++ -&gt; Code Generation -&gt; Runtime Library</code> parameter.  It is with ‚ÄúDLL‚Äù at the end.  In this case, we will have wxWidgets compiled in the form of dynamic libraries and with dynamic CRT. <br><br>  When building <code>DLL Debug</code> configurations, <code>DLL Debug</code> and <code>DLL Release</code> can be such that not all libraries will be assembled the first time.  All this because of problems with specifying dependencies.  If not assembled, run the assembly again.  Usually 2-3 iterations are enough to get a complete set of dynamic libraries. <br><br>  I also recall that to work with wxWidgets, you must have the environment variable <code>%WXWIN%</code> (for Windows), which points to the folder with the wxWidgets source codes.  For Linux and OS X, just <code>configure &amp;&amp; make &amp;&amp; make install</code> . <br><br>  Parameters for configure: <br><ul><li>  <b>Debug:</b> <code>configure --enable-shared --disable-static --enable-unicode --disable-compat28 --disable-final --enable-debug</code> </li><li>  <b>Release:</b> <code>configure --enable-shared --disable-static --enable-unicode --disable-compat28 --enable-final --disable-debug</code> </li></ul><br><br><h4>  CMake </h4><br>  In order to facilitate the work on creating project files for different platforms on different working machines with different settings, we will use the CMake project generation system, about which, by the way, there are several quite good overview articles on Habr√©, for example: <br><ul><li>  <a href="http://habrahabr.ru/post/155467/">http://habrahabr.ru/post/155467/</a> </li><li>  <a href="http://habrahabr.ru/post/178839/">http://habrahabr.ru/post/178839/</a> </li><li>  <a href="http://habrahabr.ru/post/132313/">http://habrahabr.ru/post/132313/</a> </li></ul><br>  In general, CMake is a tool with which we can generate Visual Studio (Windows), Makefile / CodeBlocks (Linux), Makefile / XCode (OS X) project files with correct paths to source codes and third-party libraries on different machines. which will allow us to get rid of a fairly large amount of extra work on setting up the assembly. <br><br>  Download CMake here: <a href="http://www.cmake.org/cmake/resources/software.html">http://www.cmake.org/cmake/resources/software.html</a> <br><br>  If you compiled wxWidgets (Linux, OS X) with debugging information, and then you want to install the Release version, you need to make make uninstall for the Debug version and manually delete the files <br><ul><li>  / usr / local / bin / wx-config </li><li>  / usr / local / bin / wxrc </li></ul><br>  If the above files are not manually deleted, the settings from the Debug version will be used for the Release version of the library.  The application will be assembled, but will not start. <br><br>  You should also bear in mind the fact that if you installed the Debug-version of wxWidgets, then on Linux and OS X you will most likely be able to build only the Debug-version of the application.  The same goes for the release version.  And all because CMake takes the compilation and linking parameters from the wx-config script, which by default gives the parameters for one current configuration.  Or for Debug separately, or separately for Release. <br><br><h4>  Visual C ++ (Windows) </h4><br>  We will use Visual C ++ 2012 to build wxWidgets and our application from source codes in Windows. Express edition will also work.  This means that all development tools, including the IDE and the compiler, will be free. <br><br>  For those who are in the tank, the link to the free Visual C ++ 2012: <a href="http://www.microsoft.com/visualstudio/rus/products/visual-studio-express-products">http://www.microsoft.com/visualstudio/rus/products/visual-studio-express-products</a> <br><br><h4>  DialogBlocks </h4><br>  To create a user interface, in order not to write everything by hand, I recommend using the DialogBlocks application.  So, yes, it is paid, but there is a free trial version, which is enough to create simple forms.  Although again, no one bothers to write everything by hand (by the way, this is even a good thing for educational purposes and clearly has a positive effect on the understanding of the code). <br><br>  Download DialogBlocks here: <a href="http://www.anthemion.co.uk/dialogblocks/download.htm">http://www.anthemion.co.uk/dialogblocks/download.htm</a> <br><br><h3>  Start </h3><br><h4>  Folder structure </h4><br>  I understand that the taste and color of the felt-tip pens are different and imposing their directory structure is a thankless task, but after several years of work we have come to a certain structure in the company that has worked well on fairly complex projects and is quite simple to understand.  Therefore, in this article we will use it. <br><ul><li>  <b>build</b> - a folder with a common CMake script and shell scripts for generating projects </li><li>  <b>build / bin / &lt;Configuration&gt;</b> - the folder where the compiler puts the binary files </li><li>  <b>/ include</b> - folder with common headers (for example, for precompiled headers) </li><li>  <b>/ &lt;ProjectName&gt;</b> - the folder with the source codes of the project from the main solution (there may be more than one project in the solution, each has its own folder) </li><li>  <b>/ &lt;ThirdParty&gt;</b> - folder in which third-party libraries are located (in the form of source codes or compiled, each in its own subdirectory) </li><li>  <b>/ ThirdParty / build</b> - a folder with a common CMake script and shell scripts for generating projects of third-party libraries (if you decide to put them in a separate solution) </li><li>  <b>/ ThirdParty / &lt;LibName&gt;</b> - folder with source codes of the third-party library (there can be more than one) </li><li>  <b>/ &lt;ProjectName&gt; / &lt;OS-Name&gt;</b> - here CMake adds project files for each OS. </li></ul><br><br><h4>  Main CMakeList </h4><br>  The main CMake script contains general parameters and settings for all projects, as well as a description of some common variables. <br><br>  <b>build / CMakeLists.txt</b> <br><br><pre> <code class="bash hljs">cmake_minimum_required(VERSION 2.6.0) <span class="hljs-comment"><span class="hljs-comment"># We will generate both Debug and Release project files at the same time # for Windows and OS X if(WIN32 OR APPLE) set(CMAKE_CONFIGURATION_TYPES "Debug;Release" CACHE STRING "" FORCE) set(LIB_SUFFIX "") endif(WIN32 OR APPLE) # For Linux we will need to execute CMake twice in order to generate # Debug and Release versions of Makefiles if(UNIX AND NOT APPLE) set(LINUX ON) set(LIB_SUFFIX /${CMAKE_BUILD_TYPE}) endif(UNIX AND NOT APPLE) set(PROJECT_NAME wxModularHost) project(${PROJECT_NAME}) # If there are any additional CMake modules (eg module which searches # for OpenCV or for DirectShow libs), then CMake should start searching # for them in current folder set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}) if(APPLE) set(OS_BASE_NAME Mac) set(CMAKE_OSX_SYSROOT "macosx10.6") endif(APPLE) if(LINUX) set(OS_BASE_NAME Linux) endif(LINUX) if(WIN32) set(OS_BASE_NAME Win) endif(WIN32) # Here we specify the list of wxWidgets libs which we will use in our project set(wxWidgets_USE_LIBS base core adv aui net gl xml propgrid html) # Here we specify that we need DLL version of wxWidgets libs and dynamic CRT # This is a MUST for applications with plugins. Both app and DLL plugin MUST # use the same instance of wxWidgets and the same event loop. set(BUILD_SHARED_LIBS 1) # Find wxWidgets library on current PC # You should have %WXWIN% environment variable which should point to the # directory where wxWidgets source code is placed. # wxWidgets libs MUST be compiled for both Debug and Release versions find_package(wxWidgets REQUIRED) # For some reason CMake generates wrong list of definitions. # Each item should start with /D but it does not. # We need to fix that manually set(wxWidgets_DEFINITIONS_TEMP) foreach(DEFINITION ${wxWidgets_DEFINITIONS}) if(NOT ${DEFINITION} MATCHES "/D.*") set(DEFINITION "/D${DEFINITION}") endif() set(wxWidgets_DEFINITIONS_TEMP ${wxWidgets_DEFINITIONS_TEMP} ${DEFINITION}) endforeach(${DEFINITION}) set(wxWidgets_DEFINITIONS ${wxWidgets_DEFINITIONS_TEMP}) # Here we add some definitions which prevent Visual Studio from # generating tons of warnings about unsecure function calls. # See http://msdn.microsoft.com/en-us/library/ttcz0bys.aspx if(WIN32) set(wxWidgets_DEFINITIONS ${wxWidgets_DEFINITIONS}; /D_CRT_SECURE_NO_DEPRECATE; /D_CRT_NONSTDC_NO_DEPRECATE; /D_UNICODE) set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /MP /wd4996") endif(WIN32) # Since we are going to use wxWidgets in all subrojects, # it's OK to create the variable which will contain # common preprocessor definitions. This variable will be # used in subprojects. set(PREPROCESSOR_DEFINITIONS ${PREPROCESSOR_DEFINITIONS}; ${wxWidgets_DEFINITIONS}) # Variable which points to root folder of our source code set(PROJECT_ROOT_DIR ${PROJECT_SOURCE_DIR}/..) # If any ThirdParty libraries are going to be # used in our project then it would be better to put # them into separate subfolder. We will create # the variable which points to this subfolder. set(THIRD_PARTY_DIR ${PROJECT_ROOT_DIR}/ThirdParty) set(BASE_INCLUDE_DIRECTORIES ${PROJECT_ROOT_DIR}/include) # Add wxWidgets include paths to the list of # include directories for all projects. include_directories(${wxWidgets_INCLUDE_DIRS}) set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /D__WXDEBUG__=1" ) # Now we can include all our subprojects. # CMake will generate project files for them add_subdirectory (../wxModularHost ../../wxModularHost/${OS_BASE_NAME}${LIB_SUFFIX})</span></span></code> </pre><br><br><h4>  Scripts for generating projects </h4><br>  For ease of use, CMake is better to use shell or batch scripts.  This will save some time on routine operations such as calling CMake and setting environment variables. <br><br><h5>  Windows (cm.bat) </h5><br>  For convenience, it is better to use separate batch scripts to create Visual Studio projects for x86 and x64, as well as one common script that will determine under which platform the application is built: <br><br><pre> <code class="bash hljs">rem @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off IF <span class="hljs-string"><span class="hljs-string">"%1"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> GOTO NO_PARAMS IF <span class="hljs-string"><span class="hljs-string">"%1"</span></span> == <span class="hljs-string"><span class="hljs-string">"x86"</span></span> GOTO CMAKE_86 IF <span class="hljs-string"><span class="hljs-string">"%1"</span></span> == <span class="hljs-string"><span class="hljs-string">"86"</span></span> GOTO CMAKE_86 IF <span class="hljs-string"><span class="hljs-string">"%1"</span></span> == <span class="hljs-string"><span class="hljs-string">"x64"</span></span> GOTO CMAKE_64 IF <span class="hljs-string"><span class="hljs-string">"%1"</span></span> == <span class="hljs-string"><span class="hljs-string">"64"</span></span> GOTO CMAKE_64 ECHO %1 ECHO <span class="hljs-string"><span class="hljs-string">"Nothing to do"</span></span> GOTO End :CMAKE_86 ECHO <span class="hljs-string"><span class="hljs-string">"Configuring for x86"</span></span> cm86.bat GOTO End :CMAKE_64 ECHO <span class="hljs-string"><span class="hljs-string">"Configuring for x64"</span></span> cm64.bat GOTO End :NO_PARAMS ECHO <span class="hljs-string"><span class="hljs-string">"No parameters specified"</span></span> IF EXIST <span class="hljs-string"><span class="hljs-string">"%ProgramW6432%"</span></span> GOTO CMAKE_64 GOTO CMAKE_86 :End</code> </pre><br><br><h5>  Windows (cm86.bat) </h5><br><pre> <code class="bash hljs">rmdir /S /Q Win mkdir Win <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Win cmake ../ -G <span class="hljs-string"><span class="hljs-string">"Visual Studio 11"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ..</code> </pre><br><br><h5>  Windows (cm64.bat) </h5><br><pre> <code class="bash hljs">rmdir /S /Q Win mkdir Win <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Win cmake ../ -G <span class="hljs-string"><span class="hljs-string">"Visual Studio 11 Win64"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ..</code> </pre><br><br><h4>  Linux (cmLinux.sh) </h4><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash echo OS Type: $OSTYPE # ---------------------------------- # build Debug configuration makefile # ---------------------------------- echo building Debug configuration makefile echo directory "LinuxDebug" rm -dr "LinuxDebug" mkdir "LinuxDebug" cd "LinuxDebug" cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE:STRING=Debug ../ cd .. # ---------------------------------- # build Release configuration makefile # ---------------------------------- echo building Release configuration makefile echo directory "LinuxRelease" rm -dr "LinuxRelease" mkdir "LinuxRelease" cd "LinuxRelease" cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE:STRING=Release ../ cd ..</span></span></code> </pre><br><br><h3>  Minimal wxWidgets-application with CMake </h3><br>  To get started, we need an application template to which we will add functionality.  Let's create a simple application consisting of an application class (for example, wxModularHostApp) and a main form class (for example, MainFrame). <br><br>  If you use DialogBlocks, then, in addition to a pair of h / cpp files for each class, we get another .rc file with a description of application resources. <br><br>  I will not give the code.  An example can be taken from previous articles or from the <code>%WXWIN%\samples\minimal</code> folder <br><br>  Now you can proceed to create CMake-script. <br><br>  <b>wxModularHost / CMakeLists.txt</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS MainFrame.cpp wxModularHostApp.cpp) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(HEADERS MainFrame.h wxModularHostApp.h) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(INCLUDE_DIRECTORIES <span class="hljs-variable"><span class="hljs-variable">${BASE_INCLUDE_DIRECTORIES}</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> wxModularHost.rc) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PREPROCESSOR_DEFINITIONS <span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>; /D_USRDLL; /DwxUSE_NO_MANIFEST=1; /D__STDC_CONSTANT_MACROS) endif(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBS <span class="hljs-variable"><span class="hljs-variable">${wxWidgets_LIBRARIES}</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(EXECUTABLE_NAME wxModularHost) add_definitions(<span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>) include_directories(<span class="hljs-variable"><span class="hljs-variable">${INCLUDE_DIRECTORIES}</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(EXECUTABLE_TYPE WIN32) endif(WIN32) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(APPLE) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(MACOSX_BUNDLE YES) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(EXECUTABLE_TYPE MACOSX_BUNDLE) endif(APPLE) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(EXECUTABLE_TYPE <span class="hljs-string"><span class="hljs-string">""</span></span>) endif(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PROJECT_FILES <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${HFILES}</span></span>) add_executable(<span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_TYPE}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_FILES}</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(EXE_DIR bin) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(TARGET_LOCATION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${EXE_DIR}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>) set_target_properties(<span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_NAME}</span></span> PROPERTIES RUNTIME_OUTPUT_DIRECTORY <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span>) target_link_libraries(<span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${LIBS}</span></span>)</code> </pre><br><br><h3>  Precompiled Headers </h3><br>  To speed up the compilation process, it is possible to use precompiled headers ( <a href="http://en.wikipedia.org/wiki/Precompiled_header">http://en.wikipedia.org/wiki/Precompiled_header</a> ). <br><br>  To implement this feature, we need two files: <br>  <b>include / stdwx.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _STDWX_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _STDWX_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(WIN32) || defined(WINDOWS) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;windows.h&gt; #include &lt;winnt.h&gt; #define PLUGIN_EXPORTED_API WXEXPORT #else #define PLUGIN_EXPORTED_API extern "C" #endif // SYSTEM INCLUDES // For compilers that support precompilation, includes "wx/wx.h". #include "wx/wxprec.h" #ifdef __BORLANDC__ #pragma hdrstop #endif #include "wx/wx.h" #include &lt;wx/cmdline.h&gt; #include &lt;wx/config.h&gt; #include &lt;wx/defs.h&gt; #include &lt;wx/dir.h&gt; #include &lt;wx/display.h&gt; #include &lt;wx/dynlib.h&gt; #include &lt;wx/dynload.h&gt; #include &lt;wx/fileconf.h&gt; #include &lt;wx/filename.h&gt; #include &lt;wx/frame.h&gt; #include &lt;wx/glcanvas.h&gt; #include &lt;wx/hashmap.h&gt; #include &lt;wx/image.h&gt; #include &lt;wx/imaglist.h&gt; #include &lt;wx/intl.h&gt; #include &lt;wx/list.h&gt; #include &lt;wx/notebook.h&gt; #include &lt;wx/stdpaths.h&gt; #include &lt;wx/sstream.h&gt; #include &lt;wx/thread.h&gt; #include &lt;wx/treebook.h&gt; #include &lt;wx/wfstream.h&gt; #include &lt;wx/wupdlock.h&gt; #include &lt;wx/textfile.h&gt; #include &lt;wx/socket.h&gt; #include &lt;wx/mimetype.h&gt; #include &lt;wx/ipc.h&gt; #endif</span></span></span></span></code> </pre><br><br>  <b>include / stdwx.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span></span></code> </pre><br><br>  In addition to the C ++ source files, we also need to teach CMake to add the necessary rules to the Visual Studio project for working with precompiled headers.  For this we will help a special module.  I do not remember where it came from, but it seems from here ( <a href="http://public.kitware.com/Bug/file_download.php%3Ffile_id%3D901%26amp%3Btype%3Dbug">http://public.kitware.com/Bug/file_download.php?file_id=901&amp;type=bug</a> ).  The source code of the CMake module to support precompiled headers can be found here: <a href="https://github.com/T-Rex/wxModularApp/blob/master/build/PCHSupport.cmake">https://github.com/T-Rex/wxModularApp/blob/master/build/PCHSupport.cmake</a> . <br><br>  This module should be included in build / CmakeLists.txt as follows: <br><br>  <b>build / CMakeLists.txt</b> <br><br><pre> <code class="bash hljs">cmake_minimum_required(VERSION 2.6.0) include(PCHSupport.cmake) ...</code> </pre><br><br>  After connecting precompiled headers to the project, the first line in all .CPP files of the project should be the line <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span></span></code> </pre><br><br><h3>  Simplest plugin without GUI </h3><br><h4>  Library with base classes </h4><br>  To develop, in fact, the plugin, and in order for the application to skillfully load the plugins of the desired type, it is necessary to do the preparatory work.  We need to create a library that will contain the base abstract class of the plugin, the functionality of which we will have to implement in each specific plugin.  Also, our main application will contain pointers of this type, which were created inside libraries and refer to specific plug-in implementations. <br><br>  Those.  as a result, we should learn a library containing data types used in both plugins and in the main application. <br><br>  <b>wxNonGuiPluginBase / Declarations.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _DECLARATIONS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _DECLARATIONS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(__WXMSW__) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> DEMO_PLUGIN_EXPORTS #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEMO_API __declspec(dllexport) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEMO_API __declspec(dllimport) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DEMO_API #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// _DECLARATIONS_H</span></span></span></span></code> </pre><br><br>  <b>wxNonGuiPluginBase / wxNonGuiPluginBase.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Declarations.h"</span></span></span><span class="hljs-meta"> class DEMO_API wxNonGuiPluginBase : public wxObject { DECLARE_ABSTRACT_CLASS(wxNonGuiPluginBase) public: wxNonGuiPluginBase(); virtual ~wxNonGuiPluginBase(); virtual int Work() = 0; }; typedef wxNonGuiPluginBase * (*CreatePlugin_function)(); typedef void (*DeletePlugin_function)(wxNonGuiPluginBase * plugin);</span></span></code> </pre><br><br>  The Declarations.h file contains the definition of the <code>DEMO_API</code> macro, which indicates <code>wxNonGuiPluginBase</code> class exported from us or imported.  This is done with the help of <code>dllexport/dllimport</code> (see <a href="http://msdn.microsoft.com/en-us/library/3y1sfaz2(v%3Dvs.90).aspx)">http://msdn.microsoft.com/en-us/library/3y1sfaz2(v=vs.90).aspx)</a> depending on the presence of the preprocessor directive <code>DEMO_PLUGIN_EXPORTS</code> .  When building the wxNonGuiPluginBase library, we specify <code>DEMO_PLUGIN_EXPORTS</code> in the list of preprocessor directives, and when building plug-ins that depend on the wxNonGuiPluginBase library and when building the main application, we do not specify.  Thus, for the wxNonGuiPluginBase project, the DEMO_API value will contain the <code>dllexport</code> attribute, and for all other projects, the <code>dllimport</code> value. <br><br>  <b>wxNonGuiPluginBase / wxNonGuiPluginBase.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"wxNonGuiPluginBase.h"</span></span></span><span class="hljs-meta"> IMPLEMENT_ABSTRACT_CLASS(wxNonGuiPluginBase, wxObject) wxNonGuiPluginBase::wxNonGuiPluginBase() { } wxNonGuiPluginBase::~wxNonGuiPluginBase() { }</span></span></code> </pre><br><br>  <b>wxNonGuiPluginBase / CMakeLists.txt</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (SRCS wxNonGuiPluginBase.cpp) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (HEADERS Declarations.h wxNonGuiPluginBase.h) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBRARY_NAME wxNonGuiPluginBase) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-comment"><span class="hljs-comment"># Only for Windows: # we add additional preprocessor definitons set(PREPROCESSOR_DEFINITIONS ${PREPROCESSOR_DEFINITIONS}; /D_USRDLL;/DDEMO_PLUGIN_EXPORTS;/D__STDC_CONSTANT_MACROS) endif(WIN32) # Add 2 files for precompiled headers set(SRCS ${SRCS} ${HEADERS} ${PROJECT_ROOT_DIR}/include/stdwx.h ${PROJECT_ROOT_DIR}/include/stdwx.cpp) # Set preprocessor definitions add_definitions(${PREPROCESSOR_DEFINITIONS}) # Set include directories include_directories(${INCLUDE_DIRECTORIES} ${BASE_INCLUDE_DIRECTORIES}) # Set library search paths link_directories(${LINK_DIRECTORIES}) # Setup the project name and assign the source files for this project add_library(${LIBRARY_NAME} SHARED ${SRCS}) #Setup the output folder set(DLL_DIR bin) set(TARGET_LOCATION ${PROJECT_SOURCE_DIR}/${DLL_DIR}${LIB_SUFFIX}) set_target_properties(${LIBRARY_NAME} PROPERTIES RUNTIME_OUTPUT_DIRECTORY ${TARGET_LOCATION}) # Set additional dependencies target_link_libraries(${LIBRARY_NAME} ${wxWidgets_LIBRARIES}) # Setup precompiled headers set_precompiled_header(${LIBRARY_NAME} ${PROJECT_ROOT_DIR}/include/stdwx.h ${PROJECT_ROOT_DIR}/include/stdwx.cpp)</span></span></code> </pre><br><br>  As mentioned earlier, the macro <code>PREPROCESSOR_DEFINITIONS</code> contains the declaration of the macro <code>DEMO_PLUGIN_EXPORTS</code> , which is used in the file Definitions.h <br><br><h4>  First plugin </h4><br>  In the plugin, we need to make a class derived from <code>wxNonGuiPluginBase</code> , implement the working functionality in it, and also make exported functions to create an instance of the class and to delete it.  These functions will be called by the main application. <br><br>  <b>SampleNonGuiPlugin / SampleNonGuiPlugin.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wxNonGuiPluginBase.h&gt; class SampleNonGuiPlugin : public wxNonGuiPluginBase { DECLARE_DYNAMIC_CLASS(SampleNonGuiPlugin) public: SampleNonGuiPlugin(); virtual ~SampleNonGuiPlugin(); virtual int Work(); };</span></span></span></span></code> </pre><br><br>  <b>SampleNonGuiPlugin / SampleNonGuiPlugin.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SampleNonGuiPlugin.h"</span></span></span><span class="hljs-meta"> IMPLEMENT_DYNAMIC_CLASS(SampleNonGuiPlugin, wxObject) SampleNonGuiPlugin::SampleNonGuiPlugin() { } SampleNonGuiPlugin::~SampleNonGuiPlugin() { } int SampleNonGuiPlugin::Work() { return 10; }</span></span></code> </pre><br><br>  <b>SampleNonGuiPlugin / SampleNonGuiPlugin.def</b> <br><br><pre> <code class="cpp hljs">LIBRARY <span class="hljs-string"><span class="hljs-string">"SampleNonGuiPlugin"</span></span> EXPORTS CreatePlugin=CreatePlugin DeletePlugin=DeletePlugin</code> </pre><br><br>  <b>SampleNonGuiPlugin / SampleNonGuiPluginExports.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wxNonGuiPluginBase.h&gt; #include "SampleNonGuiPlugin.h" PLUGIN_EXPORTED_API wxNonGuiPluginBase * CreatePlugin() { return new SampleNonGuiPlugin; } PLUGIN_EXPORTED_API void DeletePlugin(wxNonGuiPluginBase * plugin) { wxDELETE(plugin); }</span></span></span></span></code> </pre><br><br>  <b>SampleNonGuiPlugin / CMakeLists.txt</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (SRCS SampleNonGuiPlugin.cpp SampleNonGuiPluginExports.cpp) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (HEADERS SampleNonGuiPlugin.h) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBRARY_NAME SampleNonGuiPlugin) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span>.def) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PREPROCESSOR_DEFINITIONS <span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>;/D_USRDLL;/D__STDC_CONSTANT_MACROS) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LINK_DIRECTORIES <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase/<span class="hljs-variable"><span class="hljs-variable">${OS_BASE_NAME}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>/$(ConfigurationName)) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase.lib) endif(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${HEADERS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.h <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.cpp) add_definitions(<span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>) include_directories(<span class="hljs-variable"><span class="hljs-variable">${INCLUDE_DIRECTORIES}</span></span> <span class="hljs-variable"><span class="hljs-variable">${BASE_INCLUDE_DIRECTORIES}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase) link_directories(<span class="hljs-variable"><span class="hljs-variable">${LINK_DIRECTORIES}</span></span>) add_library(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> SHARED <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DLL_DIR bin) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(TARGET_LOCATION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DLL_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${CMAKE_CFG_INTDIR}</span></span>/plugins) set_target_properties(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> PROPERTIES RUNTIME_OUTPUT_DIRECTORY <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span>) target_link_libraries(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DEMO_LIBS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${wxWidgets_LIBRARIES}</span></span>) add_dependencies(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> wxNonGuiPluginBase) set_precompiled_header(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.h <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.cpp)</code> </pre><br><br>  DEF-file is included in the list of source code files is not accidental.  Without its use, the names of the exported functions will be decorated and the application will not be able to get a pointer to these functions from the DLL.  You can read about using DEF files and exporting functions from a DLL here: <br><ul><li>  <a href="http://msdn.microsoft.com/en-us/library/office/bb687850.aspx">http://msdn.microsoft.com/en-us/library/office/bb687850.aspx</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/d91k01sh.aspx">http://msdn.microsoft.com/en-us/library/d91k01sh.aspx</a> </li></ul><br><br><h3>  Plugin control module </h3><br>  So, at the moment we have a host application and a minimal plugin.  Now you need to implement the loading and use of the plugin in the application.  With a view to universality, it is better to select the code that will be engaged in searching, loading and unloading plug-ins from memory into a separate class, and even better into a separate library. <br><br>  Remember once again the implementation of our plugins: <br><ul><li>  Plugin is a dynamic library. </li><li>  The library has exported functions <code>CreatePlugin()</code> and <code>DeletePlugin()</code> </li><li>  All the functionality of the plugin is implemented in the corresponding class inside the dynamic library, the object of this class is returned by the function <code>CreatePlugin()</code> </li><li>  The class inside the library implements the <code>wxNonGuiPluginBase</code> public interface, which the application also knows about. </li><li>  The library must be loaded into memory throughout the lifetime of the object that the application receives from the <code>CreatePlugin()</code> function. </li><li>  Upon completion of work with the plugin, we need to delete the object from memory (this is done by the <code>DeletePlugin()</code> function) and unload the library from memory. </li><li>  In addition to loading and unloading data from memory, the application should also be able to find similar plug-ins in a folder specifically designed for this. </li></ul><br>  Based on these requirements, we can come to the following conclusions: <br><ul><li>  Once plug-ins can be more than one, then you need to keep a list of loaded libraries in memory. </li><li>  Once libraries can be more than one, then you need to keep a list of objects loaded from libraries in memory </li><li>  Since the library should be unloaded from memory no earlier than the corresponding working object is removed, it is necessary to somehow ensure the ability to monitor the library for compliance with this object. </li></ul><br>  Based on these requirements and conclusions, we implement the plug-in management class and containers: <br>  <b>wxModularCore / wxModularCore.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wxNonGuiPluginBase.h&gt; // We need to know which DLL produced the specific plugin object. WX_DECLARE_HASH_MAP(wxNonGuiPluginBase*, wxDynamicLibrary*, wxPointerHash, wxPointerEqual, wxNonGuiPluginToDllDictionary); // We also need to keep the list of loaded DLLs WX_DECLARE_LIST(wxDynamicLibrary, wxDynamicLibraryList); // And separate list of loaded plugins for faster access. WX_DECLARE_LIST(wxNonGuiPluginBase, wxNonGuiPluginBaseList); class wxModularCoreSettings; class wxModularCore { public: wxModularCore(); virtual ~wxModularCore(); virtual wxString GetPluginsPath(bool forceProgramPath) const; virtual wxString GetPluginExt(); bool LoadPlugins(bool forceProgramPath); bool UnloadPlugins(); const wxNonGuiPluginBaseList &amp; GetNonGuiPlugins() const; void Clear(); private: bool LoadNonGuiPlugins(const wxString &amp; pluginsDirectory); bool UnloadNonGuiPlugins(); bool RegisterNonGuiPlugin(wxNonGuiPluginBase * plugin); bool UnRegisterNonGuiPlugin(wxNonGuiPluginBase * plugin); wxDynamicLibraryList m_DllList; wxNonGuiPluginToDllDictionary m_MapNonGuiPluginsDll; wxNonGuiPluginBaseList m_NonGuiPlugins; wxModularCoreSettings * m_Settings; };</span></span></span></span></code> </pre><br><br>  Consider the code in detail: <br><ul><li>         ( <code>wxDynamicLibraryList</code> ),     - ( <code>wxNonGuiPluginBaseList</code> ),   -,       ( <code>wxNonGuiPluginToDllDictionary</code> ) </li><li>     ,     ,      ,   ,      (   Windows  .dll,   Linux  OS X  .so) </li><li>     ,  -     . </li><li>        . </li><li>     <code>m_Settings</code> .    ,      (, ,  ,    , ,      ,         ,     ).       . </li></ul><br> <b>wxModularCore/wxModularCore.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"wxModularCore.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"wxModularCoreSettings.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wx/listimpl.cpp&gt; WX_DEFINE_LIST(wxDynamicLibraryList); WX_DEFINE_LIST(wxNonGuiPluginBaseList); wxModularCore::wxModularCore() :m_Settings(new wxModularCoreSettings) { // This will allow to delete all objects from this list automatically m_DllList.DeleteContents(true); } wxModularCore::~wxModularCore() { Clear(); wxDELETE(m_Settings); } void wxModularCore::Clear() { UnloadPlugins(); // TODO: Add the code which resets the object to initial state } bool wxModularCore::LoadPlugins(bool forceProgramPath) { wxString pluginsRootDir = GetPluginsPath(forceProgramPath); wxFileName fn; fn.AssignDir(pluginsRootDir); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); fn.AppendDir(wxT("plugins")); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); if (!fn.DirExists()) return false; return LoadNonGuiPlugins(fn.GetFullPath()); } bool wxModularCore::UnloadPlugins() { return UnloadNonGuiPlugins(); } bool wxModularCore::LoadNonGuiPlugins(const wxString &amp; pluginsDirectory) { wxFileName fn; fn.AssignDir(pluginsDirectory); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); fn.AppendDir(wxT("nongui")); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); if (!fn.DirExists()) return false; if(!wxDirExists(fn.GetFullPath())) return false; wxString wildcard = wxString::Format(wxT("*.%s"), GetPluginExt().GetData()); wxArrayString pluginPaths; wxDir::GetAllFiles(fn.GetFullPath(), &amp;pluginPaths, wildcard); for(size_t i = 0; i &lt; pluginPaths.GetCount(); ++i) { wxString fileName = pluginPaths[i]; wxDynamicLibrary * dll = new wxDynamicLibrary(fileName); if (dll-&gt;IsLoaded()) { wxDYNLIB_FUNCTION(CreatePlugin_function, CreatePlugin, *dll); if (pfnCreatePlugin) { wxNonGuiPluginBase* plugin = pfnCreatePlugin(); RegisterNonGuiPlugin(plugin); m_DllList.Append(dll); m_MapNonGuiPluginsDll[plugin] = dll; } else wxDELETE(dll); } } return true; } bool wxModularCore::UnloadNonGuiPlugins() { bool result = true; wxNonGuiPluginBase * plugin = NULL; while (m_NonGuiPlugins.GetFirst() &amp;&amp; (plugin = m_NonGuiPlugins.GetFirst()-&gt;GetData())) { result &amp;= UnRegisterNonGuiPlugin(plugin); } return result; } wxString wxModularCore::GetPluginsPath(bool forceProgramPath) const { wxString path; if (m_Settings-&gt;GetStoreInAppData() &amp;&amp; !forceProgramPath) path = wxStandardPaths::Get().GetConfigDir(); else path = wxPathOnly(wxStandardPaths::Get().GetExecutablePath()); return path; } wxString wxModularCore::GetPluginExt() { return #if defined(__WXMSW__) wxT("dll"); #else wxT("so"); #endif } bool wxModularCore::RegisterNonGuiPlugin(wxNonGuiPluginBase * plugin) { m_NonGuiPlugins.Append(plugin); return true; } bool wxModularCore::UnRegisterNonGuiPlugin(wxNonGuiPluginBase * plugin) { wxNonGuiPluginBaseList::compatibility_iterator it = m_NonGuiPlugins.Find(plugin); if (it == NULL) return false; do { wxDynamicLibrary * dll = m_MapNonGuiPluginsDll[plugin]; if (!dll) // Probably plugin was not loaded from dll break; wxDYNLIB_FUNCTION(DeletePlugin_function, DeletePlugin, *dll); if (pfnDeletePlugin) { pfnDeletePlugin(plugin); m_NonGuiPlugins.Erase(it); m_MapNonGuiPluginsDll.erase(plugin); return true; } } while (false); // If plugin is not loaded from DLL (eg embedded into executable) wxDELETE(plugin); m_NonGuiPlugins.Erase(it); return true; } const wxNonGuiPluginBaseList &amp; wxModularCore::GetNonGuiPlugins() const { return m_NonGuiPlugins; }</span></span></span></span></code> </pre><br><br>       <code>LoadNonGuiPlugins()</code> ,      <code>wxDYNLIB_FUNCTION</code>      <code>CreatePlugin()</code> .   <code>CreatePlugin_function</code>   wxNonGuiPluginBase.h. <br><br>        <code>UnRegisterNonGuiPlugin()</code> ,        ,            <code>DeletePlugin()</code>   .       (,           ),      . <br><br> <b>wxModularCore/wxModularCoreSettings.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once class wxModularCoreSettings { public: wxModularCoreSettings(); wxModularCoreSettings(const wxModularCoreSettings &amp; settings); wxModularCoreSettings &amp; operator = (const wxModularCoreSettings &amp; settings); virtual ~wxModularCoreSettings(); void SetStoreInAppData(const bool &amp; val); bool GetStoreInAppData() const; protected: virtual void CopyFrom(const wxModularCoreSettings &amp; settings); private: bool m_bStoreInAppData; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Should we store data in Application Data folder or in .exe folder };</span></span></span></span></code> </pre><br><br> <b>wxModularCore/wxModularCoreSettings.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"wxModularCoreSettings.h"</span></span></span><span class="hljs-meta"> wxModularCoreSettings::wxModularCoreSettings() : m_bStoreInAppData(false) { } wxModularCoreSettings::wxModularCoreSettings(const wxModularCoreSettings &amp; settings) { CopyFrom(settings); } wxModularCoreSettings &amp; wxModularCoreSettings::operator = (const wxModularCoreSettings &amp; settings) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (this != &amp;settings) { CopyFrom(settings); } return *this; } wxModularCoreSettings::~wxModularCoreSettings() { } void wxModularCoreSettings::CopyFrom(const wxModularCoreSettings &amp; settings) { m_bStoreInAppData = settings.m_bStoreInAppData; } void wxModularCoreSettings::SetStoreInAppData(const bool &amp; value) { m_bStoreInAppData = value; } bool wxModularCoreSettings::GetStoreInAppData() const { return m_bStoreInAppData; }</span></span></code> </pre><br><br> <b>wxModularCore/CMakeLists.txt</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (SRCS wxModularCore.cpp wxModularCoreSettings.cpp) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (HEADERS wxModularCore.h wxModularCoreSettings.h) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBRARY_NAME wxModularCore) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PREPROCESSOR_DEFINITIONS <span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>;/D__STDC_CONSTANT_MACROS) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LINK_DIRECTORIES <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase/<span class="hljs-variable"><span class="hljs-variable">${OS_BASE_NAME}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>/$(ConfigurationName)) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase.lib) endif(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${HEADERS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.h <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.cpp) add_definitions(<span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>) include_directories(<span class="hljs-variable"><span class="hljs-variable">${INCLUDE_DIRECTORIES}</span></span> <span class="hljs-variable"><span class="hljs-variable">${BASE_INCLUDE_DIRECTORIES}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase) link_directories(<span class="hljs-variable"><span class="hljs-variable">${LINK_DIRECTORIES}</span></span>) add_library(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> STATIC <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DLL_DIR bin) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(TARGET_LOCATION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DLL_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${CMAKE_CFG_INTDIR}</span></span>) set_target_properties(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> PROPERTIES RUNTIME_OUTPUT_DIRECTORY <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span>) target_link_libraries(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DEMO_LIBS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${wxWidgets_LIBRARIES}</span></span>) add_dependencies(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> wxNonGuiPluginBase) set_precompiled_header(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.h <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/include/stdwx.cpp)</code> </pre><br><br>          wxModularCore   CMakeLists.txt: <br><br> <b>build/CMakeLists.txt</b> <br><br><pre> <code class="bash hljs">... add_subdirectory (../wxModularCore ../../wxModularCore/<span class="hljs-variable"><span class="hljs-variable">${OS_BASE_NAME}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>) ...</code> </pre><br><br><h3>    GUI   </h3><br>  ,  ,    ,       . <br><br>   -  <code>wxModularCore</code>   : <br><br> <b>wxModularHost/wxModularHostApp.h</b> <br><br><pre> <code class="cpp hljs">... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wxModularHostApp</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> wxApp { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestNonGuiPlugins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ... wxModularCore * m_PluginManager; ... };</code> </pre><br><br> <b>wxModularHost/wxModularHostApp.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> wxModularHostApp::Init() { <span class="hljs-comment"><span class="hljs-comment">////@begin wxModularHostApp member initialisation m_PluginManager = new wxModularCore; ////@end wxModularHostApp member initialisation }</span></span></code> </pre><br><br>              : <br><br> <b>wxModularHost/wxModularHostApp.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> wxModularHostApp::OnInit() { ... TestNonGuiPlugins(); MainFrame* mainWindow = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainFrame( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); mainWindow-&gt;Show(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* * Cleanup for wxModularHostApp */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wxModularHostApp::OnExit() { wxDELETE(m_PluginManager); <span class="hljs-comment"><span class="hljs-comment">////@begin wxModularHostApp cleanup return wxApp::OnExit(); ////@end wxModularHostApp cleanup } void wxModularHostApp::TestNonGuiPlugins() { if(m_PluginManager) { if(m_PluginManager-&gt;LoadPlugins(true)) { for(wxNonGuiPluginBaseList::Node * node = m_PluginManager-&gt;GetNonGuiPlugins().GetFirst(); node; node = node-&gt;GetNext()) { wxNonGuiPluginBase * plugin = node-&gt;GetData(); if(plugin) { wxLogDebug(wxT("Non-GUI plugin returns %i"), plugin-&gt;Work()); } } } } }</span></span></code> </pre><br><br>   <code>TestNonGuiPlugins()</code>     <code>LoadPlugins()</code>  <code>wxModularCore</code> ,    ,             <code>Work()</code> (,     wxNonGuiPluginBase,          ). <br><br><h3>  GUI- </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to create modules containing only logic, figured out. </font><font style="vertical-align: inherit;">Now consider an example of a module that wants to create a window: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wxGuiPluginBase / wxGuiPluginBase.h</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Declarations.h"</span></span></span><span class="hljs-meta"> class DEMO_API wxGuiPluginBase : public wxObject { DECLARE_ABSTRACT_CLASS(wxGuiPluginBase) public: wxGuiPluginBase(); virtual ~wxGuiPluginBase(); virtual wxString GetName() const = 0; virtual wxString GetId() const = 0; virtual wxWindow * CreatePanel(wxWindow * parent) = 0; }; typedef wxGuiPluginBase * (*CreateGuiPlugin_function)(); typedef void (*DeleteGuiPlugin_function)(wxGuiPluginBase * plugin);</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Public virtual methods: </font></font><br><ul><li> <code>GetName()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - returns the name of the module </font></font></li><li> <code>GetId()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- returns the unique identifier of the module (you can use the GUID for this; in Visual Studio there is a special utility for these purposes. See the menu </font></font><code>Tools -&gt; Create GUID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></li><li> <code>CreatePanel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - creates a control (for demonstration, we are satisfied with any control) and returns a pointer to it. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugin implementation based on this interface: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SampleGuiPlugin1 / SampleGuiPlugin1.h</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wxGuiPluginBase.h&gt; class SampleGuiPlugin1 : public wxGuiPluginBase { DECLARE_DYNAMIC_CLASS(SampleGuiPlugin1) public: SampleGuiPlugin1(); virtual ~SampleGuiPlugin1(); virtual wxString GetName() const; virtual wxString GetId() const; virtual wxWindow * CreatePanel(wxWindow * parent); };</span></span></span></span></code> </pre><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SampleGuiPlugin1 / SampleGuiPlugin1.cpp</font></font></b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SampleGuiPlugin1.h"</span></span></span><span class="hljs-meta"> IMPLEMENT_DYNAMIC_CLASS(SampleGuiPlugin1, wxObject) SampleGuiPlugin1::SampleGuiPlugin1() { } SampleGuiPlugin1::~SampleGuiPlugin1() { } wxString SampleGuiPlugin1::GetName() const { return _(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"GUI Plugin 1"</span></span></span><span class="hljs-meta">); } wxString SampleGuiPlugin1::GetId() const { return wxT(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{4E97DF66-5FBB-4719-AF17-76C1C82D3FE1}"</span></span></span><span class="hljs-meta">); } wxWindow * SampleGuiPlugin1::CreatePanel(wxWindow * parent) { wxWindow * result= new wxPanel(parent, wxID_ANY); result-&gt;SetBackgroundColour(*wxRED); return result; }</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeLists.txt for this plugin is almost the same as the one we wrote for the plugin without a GUI. </font><font style="vertical-align: inherit;">Differences will be only in the name of the project and in the list of files included in the project.</font></font><br><br><h3>     </h3><br>         .    GUI          ,  ,  .              .       5-10,      .   <code>LoadXXXPlugins()</code> , <code>UnloadXXXPlugins()</code> , <code>RegisterXXXPlugin()</code> , <code>UnRegisterXXXPlugin()</code>    ,   -    -  <code>wxModularCore</code> ,    ,    . <br> <b>wxModularCore/wxModularCore.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// We need to keep the list of loaded DLLs WX_DECLARE_LIST(wxDynamicLibrary, wxDynamicLibraryList); class wxModularCoreSettings; class wxModularCore { public: wxModularCore(); virtual ~wxModularCore(); virtual wxString GetPluginsPath(bool forceProgramPath) const; virtual wxString GetPluginExt(); virtual bool LoadAllPlugins(bool forceProgramPath) = 0; virtual bool UnloadAllPlugins() = 0; virtual void Clear(); protected: wxDynamicLibraryList m_DllList; wxModularCoreSettings * m_Settings; template&lt;typename PluginType, typename PluginListType&gt; bool RegisterPlugin(PluginType * plugin, PluginListType &amp; list) { list.Append(plugin); return true; } template&lt;typename PluginType, typename PluginListType, typename PluginToDllDictionaryType, typename DeletePluginFunctionType&gt; bool UnRegisterPlugin( PluginType * plugin, PluginListType &amp; container, PluginToDllDictionaryType &amp; pluginMap) { typename PluginListType::compatibility_iterator it = container.Find(plugin); if (it == NULL) return false; do { wxDynamicLibrary * dll = (wxDynamicLibrary *)pluginMap[plugin]; if (!dll) // Probably plugin was not loaded from dll break; wxDYNLIB_FUNCTION(DeletePluginFunctionType, DeletePlugin, *dll); if (pfnDeletePlugin) { pfnDeletePlugin(plugin); container.Erase(it); pluginMap.erase(plugin); return true; } } while (false); // If plugin is not loaded from DLL (eg embedded into executable) wxDELETE(plugin); container.Erase(it); return true; } template&lt;typename PluginType, typename PluginListType, typename PluginToDllDictionaryType, typename DeletePluginFunctionType&gt; bool UnloadPlugins(PluginListType &amp; list, PluginToDllDictionaryType &amp; pluginDictoonary) { bool result = true; PluginType * plugin = NULL; while (list.GetFirst() &amp;&amp; (plugin = list.GetFirst()-&gt;GetData())) { result &amp;= UnRegisterPlugin&lt;PluginType, PluginListType, PluginToDllDictionaryType, DeletePluginFunctionType&gt;(plugin, list, pluginDictoonary); } return result; } template &lt;typename PluginType, typename PluginListType, typename PluginToDllDictionaryType, typename CreatePluginFunctionType&gt; bool LoadPlugins(const wxString &amp; pluginsDirectory, PluginListType &amp; list, PluginToDllDictionaryType &amp; pluginDictionary, const wxString &amp; subFolder) { wxFileName fn; fn.AssignDir(pluginsDirectory); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); fn.AppendDir(subFolder); wxLogDebug(wxT("%s"), fn.GetFullPath().data()); if (!fn.DirExists()) return false; if(!wxDirExists(fn.GetFullPath())) return false; wxString wildcard = wxString::Format(wxT("*.%s"), GetPluginExt().GetData()); wxArrayString pluginPaths; wxDir::GetAllFiles(fn.GetFullPath(), &amp;pluginPaths, wildcard); for(size_t i = 0; i &lt; pluginPaths.GetCount(); ++i) { wxString fileName = pluginPaths[i]; wxDynamicLibrary * dll = new wxDynamicLibrary(fileName); if (dll-&gt;IsLoaded()) { wxDYNLIB_FUNCTION(CreatePluginFunctionType, CreatePlugin, *dll); if (pfnCreatePlugin) { PluginType * plugin = pfnCreatePlugin(); RegisterPlugin(plugin, list); m_DllList.Append(dll); pluginDictionary[plugin] = dll; } else wxDELETE(dll); } } return true; } };</span></span></span></span></code> </pre><br><br> <b>wxModularHost/SampleModularCore.h</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wxModularCore.h&gt; #include &lt;wxNonGuiPluginBase.h&gt; #include &lt;wxGuiPluginBase.h&gt; // We need to know which DLL produced the specific plugin object. WX_DECLARE_HASH_MAP(wxNonGuiPluginBase*, wxDynamicLibrary*, wxPointerHash, wxPointerEqual, wxNonGuiPluginToDllDictionary); WX_DECLARE_HASH_MAP(wxGuiPluginBase*, wxDynamicLibrary*, wxPointerHash, wxPointerEqual, wxGuiPluginToDllDictionary); // And separate list of loaded plugins for faster access. WX_DECLARE_LIST(wxNonGuiPluginBase, wxNonGuiPluginBaseList); WX_DECLARE_LIST(wxGuiPluginBase, wxGuiPluginBaseList); class SampleModularCore : public wxModularCore { public: virtual ~SampleModularCore(); virtual bool LoadAllPlugins(bool forceProgramPath); virtual bool UnloadAllPlugins(); const wxNonGuiPluginBaseList &amp; GetNonGuiPlugins() const; const wxGuiPluginBaseList &amp; GetGuiPlugins() const; private: wxNonGuiPluginToDllDictionary m_MapNonGuiPluginsDll; wxNonGuiPluginBaseList m_NonGuiPlugins; wxGuiPluginToDllDictionary m_MapGuiPluginsDll; wxGuiPluginBaseList m_GuiPlugins; };</span></span></span></span></code> </pre><br><br> <b>wxModularHost/SampleModularCore.cpp</b> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdwx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SampleModularCore.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wx/listimpl.cpp&gt; WX_DEFINE_LIST(wxNonGuiPluginBaseList); WX_DEFINE_LIST(wxGuiPluginBaseList); SampleModularCore::~SampleModularCore() { Clear(); } bool SampleModularCore::LoadAllPlugins(bool forceProgramPath) { wxString pluginsRootDir = GetPluginsPath(forceProgramPath); bool result = true; result &amp;= LoadPlugins&lt;wxNonGuiPluginBase, wxNonGuiPluginBaseList, wxNonGuiPluginToDllDictionary, CreatePlugin_function&gt;(pluginsRootDir, m_NonGuiPlugins, m_MapNonGuiPluginsDll, wxT("nongui")); result &amp;= LoadPlugins&lt;wxGuiPluginBase, wxGuiPluginBaseList, wxGuiPluginToDllDictionary, CreateGuiPlugin_function&gt;(pluginsRootDir, m_GuiPlugins, m_MapGuiPluginsDll, wxT("gui")); // You can implement other logic which takes in account // the result of LoadPlugins() calls return true; } bool SampleModularCore::UnloadAllPlugins() { return UnloadPlugins&lt;wxNonGuiPluginBase, wxNonGuiPluginBaseList, wxNonGuiPluginToDllDictionary, DeletePlugin_function&gt;(m_NonGuiPlugins, m_MapNonGuiPluginsDll) &amp;&amp; UnloadPlugins&lt;wxGuiPluginBase, wxGuiPluginBaseList, wxGuiPluginToDllDictionary, DeleteGuiPlugin_function&gt;(m_GuiPlugins, m_MapGuiPluginsDll); } const wxNonGuiPluginBaseList &amp; SampleModularCore::GetNonGuiPlugins() const { return m_NonGuiPlugins; } const wxGuiPluginBaseList &amp; SampleModularCore::GetGuiPlugins() const { return m_GuiPlugins; }</span></span></span></span></code> </pre><br><br>    ,   GUI-    . <br><br><h3>  GUI-   </h3><br>          Docking-  wxAuiNotebook    .          wxAuiNotebook: <br> <b>wxModularHost/MainFrame.cpp</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MainFrame::AddPagesFromGuiPlugins() { SampleModularCore * pluginManager = wxGetApp().GetPluginManager(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(wxGuiPluginBaseList::Node * node = pluginManager-&gt;GetGuiPlugins().GetFirst(); node; node = node-&gt;GetNext()) { wxGuiPluginBase * plugin = node-&gt;GetData(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(plugin) { wxWindow * page = plugin-&gt;CreatePanel(m_Notebook); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(page) { m_Notebook-&gt;AddPage(page, plugin-&gt;GetName()); } } } }</code> </pre><br>       : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7d/204/bb5/a7d204bb58ab003c5192cbe2291301a0.png" alt="image"><br><br>      <code>GetName()</code>  ,      <code>CreatePanel()</code> . <br><br><h3>  CMake-  Linux </h3><br>  Windows   ,      ,      <code>RUNTIME_OUTPUT_DIRECTORY</code> .  Linux, ..  ‚Äì    ( ),   <code>LIBRARY_OUTPUT_DIRECTORY</code> .      :       bin,           .      ,               bin.         (     ): <br><br> <b>SampleGuiPlugin2/CMakeLists.txt</b> <br><pre> <code class="bash hljs">... <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DLL_DIR bin) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(TARGET_LOCATION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DLL_DIR}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>/plugins/nongui) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(TARGET_LOCATION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DLL_DIR}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${CMAKE_CFG_INTDIR}</span></span>/plugins/nongui) get_target_property(RESULT_FULL_PATH <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> LOCATION) get_filename_component(RESULT_FILE_NAME <span class="hljs-variable"><span class="hljs-variable">${RESULT_FULL_PATH}</span></span> NAME) endif(LINUX) set_target_properties(<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> PROPERTIES RUNTIME_OUTPUT_DIRECTORY <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(LINUX) add_custom_command(TARGET <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> POST_BUILD COMMAND <span class="hljs-variable"><span class="hljs-variable">${CMAKE_COMMAND}</span></span> -E make_directory <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span> COMMAND <span class="hljs-variable"><span class="hljs-variable">${CMAKE_COMMAND}</span></span> -E copy $&lt;TARGET_FILE:<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span>&gt; <span class="hljs-variable"><span class="hljs-variable">${TARGET_LOCATION}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${RESULT_FILE_NAME}</span></span> ) endif(LINUX)</code> </pre><br><br>     Linux      : <br><br> <b>SampleGuiPlugin2/CMakeLists.txt</b> <br><pre> <code class="bash hljs">... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span>.def) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PREPROCESSOR_DEFINITIONS <span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>;/D_USRDLL;/D__STDC_CONSTANT_MACROS) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LINK_DIRECTORIES <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase/<span class="hljs-variable"><span class="hljs-variable">${OS_BASE_NAME}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>/$(ConfigurationName)) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase.lib) endif(WIN32) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase) endif(LINUX) ...</code> </pre><br><br>   ,  .             (             ). <br>   ,            . , ,            ,       .       ldd: <br><br><pre> <code class="bash hljs">ldd libSampleGuiPlugin2.so | grep wxSampleGuiPluginBase</code> </pre><br><br>  ,     ,  CMake    <code>RPATH</code>  ,         : <br><br> <b>SampleGuiPlugin2/CMakeLists.txt</b> <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(WIN32) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(SRCS <span class="hljs-variable"><span class="hljs-variable">${SRCS}</span></span> <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span>.def) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(PREPROCESSOR_DEFINITIONS <span class="hljs-variable"><span class="hljs-variable">${PREPROCESSOR_DEFINITIONS}</span></span>;/D_USRDLL;/D__STDC_CONSTANT_MACROS) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LINK_DIRECTORIES <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span>/wxNonGuiPluginBase/<span class="hljs-variable"><span class="hljs-variable">${OS_BASE_NAME}</span></span><span class="hljs-variable"><span class="hljs-variable">${LIB_SUFFIX}</span></span>/$(ConfigurationName)) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase.lib) endif(WIN32) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(LINUX) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(DEMO_LIBS wxNonGuiPluginBase) SET(CMAKE_SKIP_BUILD_RPATH FALSE) SET(CMAKE_BUILD_WITH_INSTALL_RPATH TRUE) SET(CMAKE_INSTALL_RPATH <span class="hljs-string"><span class="hljs-string">".:./../../"</span></span>) endif(LINUX)</code> </pre><br><br>  Since     plugins/gui,   wxGuiPluginBase      ,     CMakeLists.txt <br><br><h3>  CMake-  OS X </h3><br>  ,    Linux,  OS X         .  OS X      ,    install_name_tool. <br>    CMakeLists.txt,       : <br><br> <b>SampleGuiPlugin2/CMakeLists.txt</b> <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(APPLE) FOREACH(DEP_LIB <span class="hljs-variable"><span class="hljs-variable">${DEMO_LIBS}</span></span>) get_filename_component(ABS_ROOT_DIR <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span> ABSOLUTE) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBNAME_FULL <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ABS_ROOT_DIR}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${OS_BASE_NAME}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LIB_SUFFIX}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(CONFIGURATION)</span></span></span><span class="hljs-string">/lib</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">.dylib"</span></span>) add_custom_command(TARGET <span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span> POST_BUILD COMMAND install_name_tool -change <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LIBNAME_FULL}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"@executable_path/../Frameworks/lib</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">.dylib"</span></span> $&lt;TARGET_FILE:<span class="hljs-variable"><span class="hljs-variable">${LIBRARY_NAME}</span></span>&gt;) ENDFOREACH(DEP_LIB) endif(APPLE)</code> </pre><br><br>  CMake-       <br><br> <b>wxModularHost/CMakeLists.txt</b> <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(APPLE) FOREACH(DEP_LIB <span class="hljs-variable"><span class="hljs-variable">${DEMO_LIBS_SHARED}</span></span>) get_filename_component(ABS_ROOT_DIR <span class="hljs-variable"><span class="hljs-variable">${PROJECT_ROOT_DIR}</span></span> ABSOLUTE) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(LIBNAME_FULL <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ABS_ROOT_DIR}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${OS_BASE_NAME}</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LIB_SUFFIX}</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(CONFIGURATION)</span></span></span><span class="hljs-string">/lib</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">.dylib"</span></span>) add_custom_command(TARGET <span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_NAME}</span></span> POST_BUILD COMMAND install_name_tool -change <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LIBNAME_FULL}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"@executable_path/../Frameworks/lib</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DEP_LIB}</span></span></span><span class="hljs-string">.dylib"</span></span> $&lt;TARGET_FILE:<span class="hljs-variable"><span class="hljs-variable">${EXECUTABLE_NAME}</span></span>&gt;) ENDFOREACH(DEP_LIB) endif(APPLE)</code> </pre><br><br><h3>  In conclusion </h3><br>     -  ,       Windows  OS X Makefile   CMake. , -    . <br>    ,   ,    GitHub: <a href="https://github.com/T-Rex/wxModularApp" title="-     wxWidgets">https://github.com/T-Rex/wxModularApp</a> <br><br> PS:        wxWidgets (3.0),   CMake     (   ,    2.9.x    3.0.         2.9: <a href="http://svn.wxwidgets.org/svn/wx/wxWidgets/tags/WX_2_9_5/">svn.wxwidgets.org/svn/wx/wxWidgets/tags/WX_2_9_5</a> </div><p>Source: <a href="https://habr.com/ru/post/203322/">https://habr.com/ru/post/203322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203310/index.html">Meeting C ++ 2013</a></li>
<li><a href="../203314/index.html">Snowfall with FFmpeg filters</a></li>
<li><a href="../203316/index.html">Country hackathon in Finland</a></li>
<li><a href="../203318/index.html">Spring Security Overview</a></li>
<li><a href="../203320/index.html">Query optimization. Basics of EXPLAIN in PostgreSQL</a></li>
<li><a href="../203324/index.html">Competition for the creation of an instant messenger for Windows Phone</a></li>
<li><a href="../203326/index.html">John Carmack leaves id Software</a></li>
<li><a href="../203328/index.html">Go load test, version 2</a></li>
<li><a href="../203334/index.html">Learning to write in the information style</a></li>
<li><a href="../203338/index.html">Stealing a password from your Gmail account</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>