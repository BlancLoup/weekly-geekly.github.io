<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Managed Extensibility Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(Sorry for my Russian in advance) 

 MEF is a new approach developed by Microsoft that allows you to download extensions for your application very eas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Managed Extensibility Framework</h1><div class="post__text post__text-html js-mediator-article">  <i>(Sorry for my Russian in advance)</i> <br><br>  <b>MEF</b> is a new approach developed by Microsoft that allows you to download extensions for your application very easily.  It allows you to detect and make up the parts that should be included in the application, all at runtime.  You can extend the behavior of the application by simply adding new plugins.  Managed Extensibility Framework will do it all for you. <br>  <b>"Hello MEF World!"</b> <br><br><a name="habracut"></a>  Suppose we already have a really simple application, and we want it to greet us with " <b>Hello MEF world!</b> ": 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><br>  class program <br>  { <br>  static void Main (string [] args) <br>  { <br>  var program = new Program (); <br>  program.Run (); <br>  } <br><br>  private void Run () <br>  { <br>  ProgrammGreeter.SayHello (); <br>  } <br><br>  protected IGreeter ProgrammGreeter {get;  set;} <br>  } <br><br><br>  public interface IGreeter <br>  { <br>  void SayHello (); <br>  } <br><br>  public class Greeter: IGreeter <br>  { <br>  public void SayHello () <br>  { <br>  Console.WriteLine ("Hello MEF World!"); <br>  } <br>  } <br>  The main problem is that the instance is owned by <b>ProgrammGreeter</b> .  We wish that this would be a Greeter instance instance. <br>  <b>Let's do it with MEF</b> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/763/b9d/4a1/763b9d4a178af21c36d22c5f6233cb9c.png"></a>  To do this, you must include a link to <b>System.ComponentModel.Composition</b> . <br><br>  Respectively with MSDN: ‚ÄúMEF is an integral part.  NET Framework 4 Beta 1, and is used wherever the .NET Framework is used. ‚Äù <br><br>  Most likely, MEF will be included in the NET Framework 4.0, while you can download it from the <b>CodePlex</b> website <a href="http://www.codeplex.com/MEF">here</a> . <br><br><br>  After we added the link, you can add <b>import (Import)</b> and <b>export (Export)</b> attributes. <br>  The export is intended to indicate some features that we want to use somewhere.  And import is in favor of indicating dependencies on any features. <br><br>  Our <b>Greeter</b> class provides some capabilities, so we add an <b>Export</b> : <br><br>  [Export (typeof (IGreeter))] <br>  public class Greeter: IGreeter <br><br>  We want to use this feature in our <b>Programm</b> class, i.e.  we depend on this functionality.  Add <b>Import</b> : <br><br>  [Import] <br>  protected IGreeter ProgrammGreeter {get;  set;  } <br><br>  Usually our capabilities live in other Assembles.  But they can also live in the called assembly.  In any case, we must tell the MEF how to configure all our dependencies. <br>  This can be done using the <b>Compose ()</b> method, which we will call before we use our capabilities, as a rule, such a setup is done somewhere at the beginning of execution: <br><br>  private void Run () <br>  { <br>  Compose (); <br>  ProgrammGreeter.SayHello (); <br>  } <br><br>  private void Compose () <br>  { <br>  var assemblyCatalog = new AssemblyCatalog (Assembly.GetExecutingAssembly ()); <br>  var compositionContainer = new CompositionContainer (assemblyCatalog); <br>  compositionContainer.ComposeParts (this); <br>  } <br><br><br>  I launched my program and got: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/59f/54e/1cd/59f54e1cdff7821a1cef5081286bcc6e.png"></a> <br><br>  <b>How does the Managed Extensibility Framework work?</b> <br><br>  I think you are somewhat interested in the <b>Compose</b> () method.  Just read the comments in the code of this method, I made the method more detailed: <br><br>  // We have a guide <br>  private void Compose () <br>  { <br>  // Where says exports live where <br>  var assemblyCatalog = new AssemblyCatalog (Assembly.GetExecutingAssembly ()); <br>  // CompositionContainer holds defined dependencies and coordinates creation <br>  var compositionContainer = new CompositionContainer (assemblyCatalog); <br><br>  // CompositionBatch object holds references <br>  var compositionBatch = new CompositionBatch (); <br>  // one of such objects is Programm instance (this), it needs to be composed <br>  compositionBatch.AddPart (this); <br><br>  // And finally the containerall composing <br>  compositionContainer.Compose (compositionBatch); <br>  } <br><br><br><br>  In the Managed Extensibility Framework there are primitives called <b>ComposablePart</b> , which contain extensions for your application collection from the <b>catalog</b> .  But it can also contain dependencies that also need to be built. <br><br>  Look at this chart from the Managed Extensibility Framework <a href="http://mef.codeplex.com/wikipage%3Ftitle%3DOverview%26amp%3BreferringTitle%3DHome">page</a> . <br><br> <a href=""><img height="300" src="https://habrastorage.org/getpro/habr/post_images/e76/272/5cb/e762725cbe337160b6006f3e339f50aa.png" width="400"></a> <br><br>  <b>More complicated example</b> <br><br>  In this example, we will have an application that analyzes XML files (which contains information about some developers).  After we have delivered our program to Clients, we want this XML to be able to check some rules, but they may differ from client to client.  To do this, the rules are developed in individual Dll, which are supplied to different customers.  We work with the rules as with plugins. <br><br><br>  We have two assemblies: <br><ul><li>  <b>MEF.DEMO</b> which defines <b>ISecurityRule</b> and <b>IDataRule</b> . </li><li>  <b>MEF.Rules</b> has the implementation of these interfaces. </li></ul><br><br>  The structure of the classes is as shown in the picture below.  I just do not want to bore you with an explanation of the logic of all the rules.  (If you need sorsy just let me know.) <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ffc/c5d/5a9/ffcc5d5a9fd276f59348af81b0cfe867.png"></a> <br><br>  Our <b>Programm</b> class wants to load rules from another assembly, so we mark them with the help of <b>Import</b> in MEF.Rules: <br><br>  [Import] <br>  public ISecurityRule SecurityRule {get;  set;  } <br><br>  [ImportMany] <br>  public IDataRule [] DataRules {get;  set;  } <br><br>  public void Run () <br>  { <br>  Console.WriteLine ("Programm run."); <br>  Compose (); <br>  Console.WriteLine ("Composition completed."); <br><br>  var document = XDocument.Load ("developer.xml"); <br>  Console.WriteLine (document.ToString ()); <br><br>  var passesValidation = SecurityRule.PassesValidation (document); <br>  Console.WriteLine (string.Format ("Rule {0}: {1}", SecurityRule.GetType (), passesValidation)); <br><br>  foreach (var d in DataRules) <br>  { <br>  var valid = d.IsValid (document); <br>  Console.WriteLine (string.Format ("Rule {0}: {1}", d.GetType (), valid)); <br>  } <br>  } <br><br>  As you noticed, we use <b>ImportMany</b> , I hope that the name speaks for itself. <br><br>  We have to change our <b>Compose</b> layout method in order for it to search for Export-s in the directory where our application is located; for this we use <b>DirectoryCatalog</b> . <br><br>  private void Compose () <br>  { <br>  var catalog = new DirectoryCatalog (Environment.CurrentDirectory); <br>  var container = new CompositionContainer (catalog); <br>  container.ComposeParts (this); <br>  } <br><br><br>  After I put these DLLs in one folder and started MEF.DEMO, I got: <br><br> <a href=""><img height="283" src="https://habrastorage.org/getpro/habr/post_images/e4c/dfd/93e/e4cdfd93ebb97751b76531917c25876f.png" width="640"></a> <br><br>  The goal of MEF is to seamlessly glue together classes that import functionality from other parts of the application, as well as classes that export this functionality.  Perhaps you decide that MEF is another DI container.  Yes, it may still be the same as DI containers, but the Managed Extensibility Framework is primarily focused on composition.  It is also important that the composition can be made during the execution of the program at any time when it is convenient for you.  You can do <b>re-composition</b> when you want to do.  You can also load on-demand features ( <b>Lazy load</b> ) or add <b>metadata</b> to the export.  Finding dependencies in a folder can be done with <b>filtering</b> .  There are also many other features not found in DI containers. <br><br><br>  <b>Managed Extensibility Framework is a</b> very interesting and necessary functionality that was added to the NET 4.0 Framework. <br><br><br>  Sources: <a href="http://depositfiles.com/files/2xq3982p3">Download MEF.DEMO.ZIP - 118.46 KB</a> </div><p>Source: <a href="https://habr.com/ru/post/83928/">https://habr.com/ru/post/83928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83921/index.html">Another way to color a laptop</a></li>
<li><a href="../83922/index.html">Visual chronology of Twitter creation</a></li>
<li><a href="../83923/index.html">Filter Forge: heart shaped frame (lesson)</a></li>
<li><a href="../83925/index.html">The new beta version of Google Chrome for Mac has extensions</a></li>
<li><a href="../83927/index.html">SDL Library Overview</a></li>
<li><a href="../83929/index.html">Memory: LOH and Chunked Lists</a></li>
<li><a href="../83931/index.html">in KDE 4 removed kdict</a></li>
<li><a href="../83934/index.html">Gift mood</a></li>
<li><a href="../83935/index.html">Swing + HTML / CSS = Profit?</a></li>
<li><a href="../83936/index.html">How many letters do you have in the Spam folder?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>