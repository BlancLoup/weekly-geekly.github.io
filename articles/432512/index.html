<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PostgreSQL: PipelineDB - aggregate queries in real time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever been asked to calculate the amount of something based on the data in the database for the last month, grouping the result by some values...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PostgreSQL: PipelineDB - aggregate queries in real time</h1><div class="post__text post__text-html js-mediator-article">  Have you ever been asked to calculate the amount of something based on the data in the database for the last month, grouping the result by some values ‚Äã‚Äãand breaking it all by day / hour? <br>  If yes, then you already imagine that you have to write something like this, only worse <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">hour</span></span>(datetime), somename, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*), <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(somemetric) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> datetime &gt; :monthAgo <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  From time to time, a wide variety of such requests begin to appear, and if you can endure and help once, alas, appeals will come in the future. <br><br>  And such requests are bad because they take the system resources well for the duration of the execution, and there can be so much data that even a replica for such requests would be a pity (and one‚Äôs own time). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And what if I say that you can create a view directly in PostgreSQL that, on the fly, will take into account only new incoming data in a directly similar query, as above? <br><br>  So - it can do the extension PipelineDB <br><br><div class="spoiler">  <b class="spoiler_title">Demo from their site, how it works</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kz/5x/mb/kz5xmbjf4yjqv_ogkuhnirwu-ve.gif"><br></div></div><br><a name="habracut"></a>  Previously, PipelineDB was a separate project, but is now available as an extension for PG 10.1 and higher. <br><br>  And although the opportunities provided for a long time already exist in other products specially created for collecting metrics in real time - PipelineDB has a significant advantage: a lower threshold for entry for developers who already know how to use SQL). <br><br>  Perhaps for someone it is irrelevant.  Personally, I am not too lazy to try everything that seems appropriate for solving a particular task, but I also don‚Äôt immediately use one new solution for all cases.  Therefore, in this note, I do not call to immediately drop everything and install PipelineDB, this is just an overview of the main functionality, since  the thing seemed curious to me. <br><br>  And so, in general, the documentation they have is good, but I want to share experiences on how to try this practice in practice and display the results in Grafana. <br><br>  In order not to litter the local machine, I deploy everything in the docker. <br>  Images used: <code>postgres:latest</code> , <code>grafana/grafana</code> <br><br><h3>  Installing PipelineDB on Postgres </h3><br>  On a postgres machine, perform the following steps: <br><br><ol><li> <code>apt update</code> </li> <li> <code>apt install curl</code> </li> <li> <code>curl -s http://download.pipelinedb.com/apt.sh | bash</code> </li> <li> <code>apt install pipelinedb-postgresql-11</code> </li> <li> <code>cd /var/lib/postgresql/data</code> </li> <li>  Open in any editor file <code>postgresql.conf</code> </li><li>  Find the <code>shared_preload_libraries</code> key, open and set the value of <code>pipelinedb</code> </li><li>  <code>max_worker_processes</code> key to 128 (docks recommendation) </li><li>  Reboot server </li></ol><br><h3>  Creating a stream and view in PipelineDB </h3><br><div class="spoiler">  <b class="spoiler_title">After reboot pg - watch logs so that there is such</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xc/6i/dz/xc6idzmydyyu2qgvpu7emd7aj2i.png"><br></div></div><br><ol><li>  The database in which we will work: <code>CREATE DATABASE testpipe;</code> </li><li>  Creating an extension: <code>CREATE EXTENSION pipelinedb;</code> </li><li>  Now the most interesting is the creation of a stream.  It is necessary to add data to it for further processing: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> flow_stream ( dtmsk <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SERVER</span></span> pipelinedb;</code> </pre> <br>  In fact, it‚Äôs very similar to creating an ordinary table, just you cannot get data from this stream with a simple <code>select</code> - you need a view </li><li>  actually how to create it: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> viewflow <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (ttl = <span class="hljs-string"><span class="hljs-string">'3 month'</span></span>, ttl_column = <span class="hljs-string"><span class="hljs-string">'m'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">minute</span></span>(dtmsk) m, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*), <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br>  They are called <a href="http://docs.pipelinedb.com/continuous-views.html">Continuous Views</a> and by default materialize, i.e.  with state preservation. <br><br>  Additional parameters are passed in the <code>WITH</code> expression. <br><br>  In my case, <code>ttl = '3 month'</code> says that you only need to store data for the last 3 months, and take the date / time from the <code>M</code> column.  The <code>reaper</code> background process <code>reaper</code> for obsolete data and deletes it. <br><br>  For those who do not know - the <code>minute</code> function returns the date / time without seconds.  Thus, all events that occurred in one minute will have the same time as a result of aggregation. </li><li>  Such a view is practically a table, because an index by date for sampling would be useful if there is a lot of data stored. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> viewflow (m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>);</code> </pre> </li></ol><br><h3>  Using PipelineDB </h3><br>  Remember: insert data into the stream, and read - from the view subscribed to it <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), <span class="hljs-string"><span class="hljs-string">'act1'</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">now</span></span>(), <span class="hljs-string"><span class="hljs-string">'act2'</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> viewflow <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Perform a manual request</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3j/rb/fy/3jrbfyanqdnf8uhrmwytpmippxa.gif"><br></div></div>  First I observe how the data changes in the 46th minute. <br>  As soon as the 47th comes, the previous one stops updating and the current minute starts ticking. <br><br>  If you pay attention to the query plan, you can see the original table with data <br><br><img src="https://habrastorage.org/webt/z8/pm/fd/z8pmfdnqxflibrane_hjpmyxupa.png"><br><br>  I recommend to go into it and find out how your data is actually stored. <br><br><div class="spoiler">  <b class="spoiler_title">C # event generator</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Npgsql; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PipelineDbLogGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Random _rnd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] _actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"yep"</span></span>, <span class="hljs-string"><span class="hljs-string">"goal"</span></span>, <span class="hljs-string"><span class="hljs-string">"ano"</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connString = <span class="hljs-string"><span class="hljs-string">"Host=localhost;port=5432;Username=postgres;Database=testpipe"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NpgsqlConnection(connString)) { conn.Open(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dt = DateTime.UtcNow; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NpgsqlCommand()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> act = GetAction(); cmd.Connection = conn; cmd.CommandText = <span class="hljs-string"><span class="hljs-string">"INSERT INTO flow_stream VALUES (@dtmsk, @action, @duration)"</span></span>; cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"dtmsk"</span></span>, dt); cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"action"</span></span>, act); cmd.Parameters.AddWithValue(<span class="hljs-string"><span class="hljs-string">"duration"</span></span>, GetDuration(act)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = cmd.ExecuteNonQuery(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{res}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{dt}</span></span></span><span class="hljs-string">"</span></span>); } Thread.Sleep(_rnd.Next(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>)); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDuration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> act</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; act.Length; i++) { c += act[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _rnd.Next(c); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _actions[_rnd.Next(_actions.Length)]; } } }</code> </pre> <br></div></div><br><h3>  Conclusion in Grafana </h3><br>  To retrieve data from postgres, add the corresponding data source: <br><br><img src="https://habrastorage.org/webt/_6/5s/lo/_65slonsdesxobympei4ty266es.png"><br><br>  Create a new dashboard and add a Graph type panel to it, and then go to the editing panel: <br><br><img src="https://habrastorage.org/webt/sm/va/ca/smvacalablhaoaohk0hamjcdrv0.png"><br><br>  Next - select the data source, switch to the writing mode of the sql query and enter this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- Grafana   time count, action from viewflow where $__timeFilter(m) --  ,     ,   col between :startdate and :enddate order by m desc, action;</span></span></code> </pre> <br>  And then we get a normal schedule, of course, if you run the event generator <br><br><img src="https://habrastorage.org/webt/y-/3j/3k/y-3j3k8kzkwu_p6ipmzovycuqe0.png"><br><br>  FYI: having an index can be very important.  Although its use depends on the volume of the resulting table.  If you plan to store a small number of lines for a small amount of time, it may very easily be that seq scan will be cheaper, and the index will only add extra.  load on updating values <br><br>  Several views can be signed for one stream. <br><br>  Suppose I want to see how many api methods are performed by percentile <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> viewflow_per <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (ttl = <span class="hljs-string"><span class="hljs-string">'3 d'</span></span>, ttl_column = <span class="hljs-string"><span class="hljs-string">'m'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">minute</span></span>(dtmsk) m, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p50, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.95</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p95, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.99</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> p99 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flow_stream <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> viewflow_per (m <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">I am doing the same trick with grafana and get:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rx/zx/kj/rxzxkjagevdpf_v82yx-81b3-7a.png"><br></div></div><br><h3>  Total </h3><br>  In general, the thing is working, behaved well, without any complaints.  Although under the docker, downloading their demo database in the archive (2.3 GB) turned out to be a bit long. <br><br>  I want to note - I did not conduct load tests. <br><br>  <a href="http://docs.pipelinedb.com/index.html">Official documentation</a> <br><br><h4>  Can be interesting </h4><br><ul><li>  Support for loading data <a href="http://docs.pipelinedb.com/integrations.html">from Apache Kafka to streams</a> </li><li>  Similar to <a href="http://docs.pipelinedb.com/integrations.html">Amazon Kinesis</a> </li><li>  You can create views only <a href="http://docs.pipelinedb.com/continuous-transforms.html">for data transformation</a> (without storage) </li><li>  <a href="https://www.pipelinedb.com/cluster">PipelineDB Cluster</a> - commercial version available.  In it it is possible to distribute views on shards.  More <a href="http://enterprise.pipelinedb.com/docs/index.html">on the cluster solution dock.</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/432512/">https://habr.com/ru/post/432512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432500/index.html">PMP Certification: Application Audit</a></li>
<li><a href="../432502/index.html">The Internet can have serious problems due to languages ‚Äã‚Äãlike C and C ++ that contribute to the appearance of vulnerabilities.</a></li>
<li><a href="../432506/index.html">Microsoft Connect (); 2018: All Cloud Conference Announcements</a></li>
<li><a href="../432508/index.html">On the barriers to the use of sign systems in artificial intelligence</a></li>
<li><a href="../432510/index.html">The market share of plug-in electric vehicles in Norway has almost reached a new maximum.</a></li>
<li><a href="../432514/index.html">Recognizing Android Things with ABBYY RTR SDK and django</a></li>
<li><a href="../432516/index.html">Broaden your horizons, Holmes! Or why physicists have a violin and culinary skills</a></li>
<li><a href="../432518/index.html">Electron and the decline of native applications</a></li>
<li><a href="../432520/index.html">How to change admin user password in Atlassian Jira and Confluence in embedded database (H2)</a></li>
<li><a href="../432524/index.html">Why you should never use Quora again</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>