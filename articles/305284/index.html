<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create your own VPS hosting from scratch and start making money on it? Simple billing with Virtuemart</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers of Habr. This material is a continuation of a series of articles on how to build a VPS hosting from scratch based on the RUVDS Whi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create your own VPS hosting from scratch and start making money on it? Simple billing with Virtuemart</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/483/274/d5c/483274d5cc9148878e5c81ac2c4aab0e.png"><br>  Hello, dear readers of Habr.  This material is a continuation of a series of articles on how to build a VPS hosting from scratch based on the RUVDS White Label API.  And today we look at the popular Joomla CMS and one of the most popular ecommerce solutions for it - <a href="https://virtuemart.net/">VirtueMart</a> . <br><br><h3>  Virtuemart </h3><br>  Generally speaking, the extension exists quite a long time ago (the first version was released in 2005). <br>  The product grew and developed together with CMS Joomla and <a href="https://virtuemart.net/news/latest-news/465-virtuemart-3-is-here">currently</a> has quite a wide functionality. <br><br>  Let's take a look at the pros and cons of the Virtuemart 3 plugin. <br><a name="habracut"></a><br><h4>  pros </h4><br><ul><li>  gratuity </li><li>  custom fields </li><li>  one-click order form </li><li>  multicurrency </li><li>  simple order process </li><li>  flexible and powerful access control system </li><li>  a lot of payment methods available out of the box </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Minuses </h4><br><ul><li>  cumbersome code and <a href="http://loadstorm.com/2014/03/e-commerce-benchmark-virtuemart/">performance issues</a> </li><li>  there is no simple API for integration with external services </li><li>  default supported payment systems are west oriented (paypal, skill, 2checkout) </li><li>  relatively small community (~ 317,127 people registered in the <a href="http://forum.virtuemart.net/">official forum</a> , the repository <a href="https://dev.virtuemart.net/projects/virtuemart/repository/statistics">is</a> not very active, and the number of developers involved is small (for comparison, 470 developers in the woocommerce repository, which is 10 times more) </li><li>  low speed of adding new functionality (a consequence including the previous paragraph) </li><li>  security issues caused by the popularity of both CMS Joomla and the virtuemart extension itself </li></ul><br><br><h3>  Features adaptation for vps-hosting </h3><br><h4>  Payment acceptance </h4><br>  The procedure is the same as when using other bundles, such as <a href="https://habrahabr.ru/company/ruvds/blog/303936/">wordpress and woocommerce</a> .  In order to integrate with the <a href="https://habrahabr.ru/company/ruvds/blog/303936/">paymaster aggregator</a> already <a href="https://habrahabr.ru/company/ruvds/blog/303936/">familiar to us</a> , download the <a href="http://info.paymaster.ru/%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D0%25B8-cms/joomla-virtuemart-cms-2/">free extension</a> .  The paymaster extension setting is described in detail at the same link. <br><br><h4>  Deactivate guest purchase mechanism </h4><br>  Go to Virtuemart&gt; Configuration&gt; Checkout and set the flag "Only registered users can checkout". <br><br><h4>  Setting pages </h4><br>  After installing the Virtuemart plugin, we have the opportunity to use specialized pages in the menu.  In order to make a showcase from the main page, go to Menus&gt; Manage and edit the menu with the home alias.  We need to change the Menu Item Type to one of the types provided by Virtuemart: <br><ul><li>  Account Maintenance </li><li>  Category Layout </li><li>  Displays vendor contact </li><li>  Displays vendor details </li><li>  Displays vendors </li><li>  Front page </li><li>  List Orders </li><li>  Manufacturer Default Layout </li><li>  Manufacturer Details Layout </li><li>  Product Details Layout </li><li>  Shopping cart </li><li>  User Edit Address </li><li>  View vendor TOS </li></ul><br>  We chose Category Layout and standard Joomla design (version 3.5) and, after adding the main <a href="https://ruvds.com/">VPS</a> configurations, the main page looks like this: <br><br><img src="https://habrastorage.org/files/f75/d40/313/f75d40313a5f44868b345d8b1eb7afc7.jpg"><br><br><h4>  Processing paid orders </h4><br>  So, we have the same tasks: <br><ul><li>  initiate server creation using the <a href="https://ruvds.com/use_api">RuVDS Whitelabel API</a> and provide the client with all the necessary information about the creation process (server ID, creation phase, creation progress, server configuration) </li><li>  after creating the server, provide the necessary data for the connection, as well as the server management capabilities and information about the end date of the calculation period </li></ul><br><br><h5>  What is available for integration </h5><br><ul><li>  automatically generated <a href="http://docs.virtuemart.net/api-vm2/">API</a> documentation for <a href="http://docs.virtuemart.net/api-vm2/">Virtuemart 2</a> (in the article we are reviewing version 3) </li><li>  <a href="https://www.api2cart.com/supported-platforms/virtuemart-integration/">api2cart</a> service - unified API for online stores (from $ 500 per month) </li><li>  free component <a href="http://www.virtuemart-datamanager.com/index.php%3Fpage%3Dshop.product_details%26flypage%3Dflypage.tpl%26product_id%3D102%26category_id%3D18%26option%3Dcom_virtuemart%26Itemid%3D29">SOAP-services for Virtuemart 3</a> (a somewhat reduced version, but its functionality is quite enough for our tasks) </li></ul><br><br>  Let's stop on the last version.  After installing this plugin, the following SOAP services are available: <br><ul><li>  VM_Categories </li><li>  VM_Order </li><li>  VM_Product </li><li>  VM_SQLQueries </li><li>  VM_Users </li><li>  VM_Upload </li></ul><br><br>  Their wsdl are available by url (an example for a service that manages product categories): <br>  http: // host / administrator / components / com_vm_soa / services /VM_CategoriesWSDL.php <br><br>  We will need 3 - VM_Order, VM_Product and VM_SQLQueries. <br><br>  Unfortunately, when using this integration method, the hooks mechanism is not available to us.  Therefore, we will periodically select orders with the appropriate status and initiate the creation of servers of the desired configuration. <br><br>  Let's write a simple script in PHP, which will create the server after paying for the order: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApplicationSettings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'login'</span></span> =&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'orderServiceWsdl'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'http://localhost/administrator/components/com_vm_soa/services/VM_OrderWSDL.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'productServiceWsdl'</span></span> =&gt;<span class="hljs-string"><span class="hljs-string">'http://localhost/administrator/components/com_vm_soa/services/VM_ProductWSDL.php'</span></span> ]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCompleteOrders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($limitStart = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $limitEnd=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $applicationSettings = getApplicationSettings(); $loginInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdClass; $loginInfo-&gt;login=$applicationSettings[<span class="hljs-string"><span class="hljs-string">'login'</span></span>]; $loginInfo-&gt;password=$applicationSettings[<span class="hljs-string"><span class="hljs-string">'password'</span></span>]; $loginInfo-&gt;isEncrypted=<span class="hljs-string"><span class="hljs-string">"Y"</span></span>; $loginInfo-&gt;lang=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $orderServiceClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoapClient($applicationSettings[<span class="hljs-string"><span class="hljs-string">'orderServiceWsdl'</span></span>]); $getOrderFromStatusRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> stdClass; $getOrderFromStatusRequest-&gt;limite_start = $limitStart; $getOrderFromStatusRequest-&gt;limite_end = $limitEnd; $getOrderFromStatusRequest-&gt;status = <span class="hljs-string"><span class="hljs-string">'F'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  $getOrderFromStatusRequest-&gt;loginInfo = $loginInfo; try { //      "" return [$orderServiceClient-&gt;GetOrdersFromStatus($getOrderFromStatusRequest)]; }catch(\SoapFault $e){ echo $e-&gt;getMessage(); return false; } } function processPayedOrder($orderId) { $applicationSettings = getApplicationSettings(); $loginInfo = new stdClass; $loginInfo-&gt;login=$applicationSettings['login']; $loginInfo-&gt;password=$applicationSettings['password']; $loginInfo-&gt;isEncrypted="Y"; $loginInfo-&gt;lang=null; $productServiceClient = new SoapClient($applicationSettings['productServiceWsdl']); $getProductsFromOrderIdRequest = new stdClass; $getProductsFromOrderIdRequest-&gt;order_id = $orderId; $getProductsFromOrderIdRequest-&gt;include_prices = true; $getProductsFromOrderIdRequest-&gt;loginInfo = $loginInfo; try { //    $products = [$productServiceClient-&gt;GetProductsFromOrderId($getProductsFromOrderIdRequest)]; } catch(\SoapFault $e){ echo $e-&gt;getMessage(); return false; } //       foreach($products as $product) createRuvdsServer($product); return true; } function createRuvdsServer($product) { //     RUVDS White-Label Api     } $orders = getCompleteOrders(); if (!$orders || count($orders)==0) return 1; foreach ($orders as $order) { $orderId=$order-&gt;Order-&gt;id; $res = processPayedOrder($orderId); if(!$res) echo 'Processing order with id '.$orderId.' failed!'; }</span></span></code> </pre> <br><br>  Next, using any task scheduler, for example, cron, we set up the launch of this script with the necessary periodicity. <br><br><h3>  Results </h3><br>  In general, a bunch of Joomla 3 + Virtuemart 3 looks like a fairly functional and powerful tool as a basis for organizing your VPS hosting.  Immediately "out of the box" is available a lot of settings of everything that you can imagine.  But is it required when reselling, say, 3-10 popular configurations of <a href="https://ruvds.com/">virtual servers</a> ? <br><br>  In the next article, we will look at CMS Drupal and one of its most popular eCommerce extensions, and perhaps the new CMS is more suitable for you for this task.  See you again! </div><p>Source: <a href="https://habr.com/ru/post/305284/">https://habr.com/ru/post/305284/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305272/index.html">Our experience in creating applications on microservices in the field of advertising technologies</a></li>
<li><a href="../305274/index.html">13 workflows for email marketing automation</a></li>
<li><a href="../305276/index.html">Floating point calculations: can you trust the results?</a></li>
<li><a href="../305280/index.html">9 ¬æ really useful tips for working on large projects</a></li>
<li><a href="../305282/index.html">Introduction to JavaFx and working with the layout in the examples</a></li>
<li><a href="../305286/index.html">In the fight against cancer: a multidisciplinary approach</a></li>
<li><a href="../305288/index.html">Replacing Android system files with adb</a></li>
<li><a href="../305290/index.html">Security Week 27: Android encryption bypass, medical Conficker resurrection, IoT botnet</a></li>
<li><a href="../305292/index.html">Making cool Single Page Application on basis.js - part 3. Client for VKontakte</a></li>
<li><a href="../305294/index.html">Summer Homework: Top 10 Microsoft Virtual Academy Courses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>