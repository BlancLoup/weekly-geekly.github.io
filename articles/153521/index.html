<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build Android x86</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many tasks that require rebuilding the kernel and the Android operating system as a whole. For example, creating and debugging your own modu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build Android x86</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/187/131/c4d/187131c4dc69e08e6be20252136e807e.png">  There are many tasks that require rebuilding the kernel and the Android operating system as a whole.  For example, creating and debugging your own modules, including support for profiling the system and simply testing your applications on the new version of Android. <br>  The ability to run Android x86 inside a virtual machine VirtualBox allows enthusiasts and creators of firmware to dig into the system settings, configure and rebuild the kernel and not ‚Äúbrick out‚Äù the real device.  VirtualBox provides the ability to use OS debugging tools familiar to the Linux developer.  For ordinary developers of Android applications, an emulator using Intel Hardware Accelerated Execution Manager technology is perfect.  (you can read more <a href="http://habrahabr.ru/company/intel/blog/146114/">here</a> ) <br>  The article provides a number of practical tips for building an Android x86 image for running under a VirtualBox virtual machine and building an emulator.  The source code for Android is taken from the official repository of the <a href="http://source.android.com/">AOSP</a> (Android Open Source Project) project; the adapted version of the Linux 2.6 kernel from Intel is used as the core. <br><a name="habracut"></a><br><h4>  Setting the build environment </h4><br>  Android build will require a 64 bit version of Linux.  Another important point: pay attention to the version of GCC that is installed on the system.  Google supports GCC version 4.4 and above.  Also on the system must be installed Java implementation from Oracle. <br>  Install additional dependencies for Ubuntu 12.04: <br><pre><code class="bash hljs">sudo -i apt-get update sudo apt-get install git-core gnupg flex bison gperf build-essential \ zip curl libc6-dev libncurses5-dev:i386 x11proto-core-dev \ libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-glx:i386 \ libgl1-mesa-dev g++-multilib mingw32 openjdk-6-jdk tofrodos \ python-markdown libxml2-utils xsltproc zlib1g-dev:i386</code> </pre> <br>  Install a symbolic link to resolve the naming conflict: <br><pre> <code class="bash hljs">sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so</code> </pre><br><h4>  Downloading the source tree </h4><br><h5>  Repo Setup </h5><br>  Repo is a repository management utility that simplifies Git for Android.  More information can be found here (http://source.android.com/source/version-control.html) <br>  To install, initialize, and configure Repo, complete the following steps: <br>  ‚Ä¢ Make sure you have the bin directory in your home directory and it is listed in the PATH: <br><pre> <code class="bash hljs">mkdir ~/bin PATH=~/bin:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span></code> </pre><br>  ‚Ä¢ Download the Repo script and set permissions for execution: <br><pre> <code class="bash hljs">curl https://dl-ssl.google.com/dl/googlesource/git-repo/repo &gt; ~/bin/repo chmod a+x ~/bin/repo</code> </pre><br><h5>  Initializing Repo Client </h5><br>  After installing Repo, configure access to the Android source repositories: <br>  ‚Ä¢ Create an empty directory for the source files and navigate to it.  For example, it might look like this: <br><pre> <code class="bash hljs">mkdir aosp <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> aosp</code> </pre><br>  ‚Ä¢ Run the repo init script to update the version of the Repo itself. <br><pre> <code class="bash hljs">repo init -u https://android.googlesource.com/platform/manifest</code> </pre><br>  This command will connect the master branch from the Android source tree.  You can specify any other using the -b switch: <br><pre> <code class="bash hljs">repo init -u https://android.googlesource.com/platform/manifest -b android-4.1.1_r6</code> </pre><br>  To view all available branches, enter the command: <br><pre> <code class="bash hljs">git --git-dir .repo/manifests/.git/ branch -a</code> </pre><br>  We are interested in the most recent versions of Android from Google: <br><ul><li>  Jelly Bean: remotes / origin / android-4.1.1_r6 </li><li>  Ice Cream Sandwich: remotes / origin / android-4.0.4_r2.1 </li></ul><br>  You can choose any to your taste, the next steps will not be different.  To demonstrate the build process under VirtualBox, take the Jelly Bean (JB) version. <br>  In case of successful initialization, you will see a message that the Repo is initialized in your directory and the folder .repo appears in it. <br><h4>  File upload </h4><br>  To download the source files from the repository to your working directory, run the following command: <br><pre> <code class="bash hljs">repo sync -j 16</code> </pre><br>  Initial synchronization may take more than an hour. <br><h4>  Kernel build </h4><br>  Android is primarily designed for gesture-driven devices and does not support the default mouse.  Therefore, as an example, we will rebuild the kernel from the source code with mouse support included. <br>  Create a directory for storing kernel sources: <br><pre> <code class="bash hljs">mkdir ~/android_kernel <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/android_kernel</code> </pre><br>  We use the pre-prepared version of the kernel from Intel: <br><pre> <code class="bash hljs">wget http://software.intel.com/sites/landingpage/android/Intel_x86_sysimg_2.3.7_Source_Files.zip unzip Intel_x86_sysimg_2.3.7_Source_Files.zip tar -xvf kernel_sdk_x86.tar.gz</code> </pre><br>  Go to the kernel directory: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kernel</code> </pre><br>  Now we have the kernel source.  It is necessary to modify the configuration file and rebuild.  To reduce the time to complete the configuration of the kernel, we use the configuration file that we prepared for the developers.  The important point - do not forget to specify the architecture for which the kernel is being built, in our case it is x86. <br><pre> <code class="bash hljs">cp arch/x86/configs/vbox_defconfig .config make ARCH=x86 menuconfig</code> </pre><br>  After a few seconds, the graphical kernel configuration menu will load.  Arrows "up", "down" you can move through the menu items, "Enter" to enter the submenu.  Everything is just like with the usual Linux kernel. <br><img src="https://habrastorage.org/storage2/102/c11/0b4/102c110b405d1ffe6e1eff80475a3396.png" alt="image"><br><br>  To enable mouse support: <br>  ‚Ä¢ Go to "Device Drivers" <br>  ‚Ä¢ Select ‚ÄúInput device Support‚Äù <br>  ‚Ä¢ Check "Mice" <br>  You can go to the ‚ÄúMice‚Äù submenu and see the advanced driver settings. <br>  Then exit the kernel configuration menu.  This can be done with a few clicks on ‚ÄúEsc‚Äù.  Do not forget to save the settings when the configuration menu prompts you to do this. <br>  After making the necessary kernel settings, we will assemble it.  This does not take much time, especially if you are using a multi-core machine ‚Äî you can specify the make command option: -j N, where N is the number of kernels (for example, make -j 32 was used to write the article). <br><pre> <code class="bash hljs">make ARCH=x86 ‚Äìj 32</code> </pre><br>  When compiling successfully, you will see the message: <br><pre> <code class="bash hljs">Kernel: arch/x86/boot/bzImage is ready</code> </pre><br>  The path to the new kernel is indicated in the last line. <br><h5>  Kernel substitution </h5><br>  The path to the kernel that will be used in the assembly for VirtualBox can be determined as follows: <br><pre> <code class="bash hljs">grep <span class="hljs-string"><span class="hljs-string">"LOCAL_KERNEL :="</span></span> ~/aosp/build/target/board/vbox_x86/device.mk</code> </pre><br>  It should look like the following: <br><pre> <code class="bash hljs">LOCAL_KERNEL := prebuilt/android-x86/kernel/kernel-vbox</code> </pre><br>  Copy the bzImage by the found path: <br><pre> <code class="bash hljs">cp ~/kernel/arch/x86/boot/bzImage ~/aosp/prebuilt/android-x86/kernel/kernel-vbox</code> </pre><br><h4>  Build Android </h4><br>  Set the build environment: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/aosp . ./build/envsetup.sh</code> </pre><br>  Now everything is ready to start compiling Android sources.  The first step is to specify the target for the assembly: <br><pre> <code class="bash hljs">lunch vbox_x86-eng</code> </pre><br>  After executing the command, you will see information about the upcoming build: <br><pre> <code class="bash hljs">============================================ PLATFORM_VERSION_CODENAME=REL PLATFORM_VERSION=4.1.1 TARGET_PRODUCT=vbox_x86 TARGET_BUILD_VARIANT=eng TARGET_BUILD_TYPE=release TARGET_BUILD_APPS= TARGET_ARCH=x86 TARGET_ARCH_VARIANT=x86 HOST_ARCH=x86 HOST_OS=linux HOST_OS_EXTRA=Linux-2.6.32-131.0.15.el6.x86_64-x86_64-with-redhat-6.1-Santiago HOST_BUILD_TYPE=release BUILD_ID=JRO03R OUT_DIR=out ============================================</code> </pre><br>  Then you need to start the source build with the make command.  It is considered good practice to save the build log, this can be done with the help of the tee utility. <br><pre> <code class="bash hljs">make ‚Äìj 16 | tee vbox_build.log</code> </pre><br>  The assembly process can take considerable time, specific figures depend on the power of the CPU and the amount of RAM in the machine.  On the system that was used to prepare the article, it took about an hour.  The recommended number of threads for an assembly can be determined at the rate of 2GB of RAM per stream. <br>  If the compilation is successful, the last line of the output will contain the path and size of the image: <br><pre> <code class="bash hljs">Install system fs image: out/target/product/vbox_x86/system.img out/target/product/vbox_x86/system.img+ total size is 268435456</code> </pre><br>  Next, you need to build a boot image for VirtualBox: <br><pre> <code class="bash hljs">make installer_vdi</code> </pre><br>  If the build was successful, the following entry should appear in the console: <br><pre> <code class="bash hljs">Done with VirtualBox bootable installer image -[ out/target/product/vbox_x86/installer.vdi ]-</code> </pre><br><h4>  Configure VirtualBox </h4><br>  Now we are going to configure VirtualBox.  We need to create a new virtual machine, call it ‚ÄúAndroid_ICS‚Äù, choose Linux as the operating system, and set the version to Other as the most suitable for Android. <br><img src="https://habrastorage.org/storage2/b3b/e65/277/b3be65277e3aeef0af4886546d828435.png" alt="image"><br>  The next step is the allocation of RAM.  512 megabytes and more are recommended.  In our case it will be gigabyte. <br><img src="https://habrastorage.org/storage2/2dd/a39/2fd/2dda392fdfed7c7dfe7e3ca41dc6774f.png" alt="image"><br>  Next, adjust the size of the hard disk.  The main thing is that after the setup is completed, all VirtualBox hard drives are connected to the IDE controller. <br>  Install the Android boot image as the second partition of our virtual machine. <br><img src="https://habrastorage.org/storage2/794/340/90b/79434090b8afc2614c8040cf1d40dce6.png" alt="image"><br>  When you first start the virtual machine, we need to start the installation of Android.  During startup, press F12 to enter the BIOS settings menu.  Select 2 ‚ÄúPrimary Slave‚Äù, this is where the Android installation image is located. <br>  If the installation is successful, you will see ‚ÄúDone processing installer config‚Äù.  Sometimes when you first install errors may occur, just run it again.  Then reboot the virtual machine into your newly installed Android! <br><img src="https://habrastorage.org/storage2/8cb/360/e45/8cb360e459f99d727b9b1d58e74acf44.png" alt="image"><br><h4>  Jelly Bean Emulator </h4><br>  Build emulator is not much different from the build version for VirtualBox.  If you already have the source code, then proceed to the assembly from the environment initialization step.  For the purity of the experiment, the process of building an emulator will be described from the very beginning.  Therefore, we will create a separate directory for the Jelly Bean Emulator and repeat the already familiar steps. <br><pre> <code class="bash hljs">mkdir ~/jb <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/jb</code> </pre><br>  Repository Initialization <br><pre> <code class="bash hljs">repo init -u https://android.googlesource.com/platform/manifest -b android-4.1.1_r6</code> </pre><br>  Download Source Code <br><pre> <code class="bash hljs">repo sync -j 16</code> </pre><br>  Initialization of the environment <br><pre> <code class="bash hljs">. ./build/envsetup.sh</code> </pre><br>  Emulator Assembly Selection <br><pre> <code class="bash hljs">lunch full_x86-eng</code> </pre><br>  If successful, you will see: <br><pre> <code class="bash hljs">============================================ PLATFORM_VERSION_CODENAME=REL PLATFORM_VERSION=4.1.1 TARGET_PRODUCT=full_x86 TARGET_BUILD_VARIANT=eng TARGET_BUILD_TYPE=release TARGET_BUILD_APPS= TARGET_ARCH=x86 TARGET_ARCH_VARIANT=x86-atom HOST_ARCH=x86 HOST_OS=linux HOST_OS_EXTRA=Linux-2.6.32-131.0.15.el6.x86_64-x86_64-with-redhat-6.1-Santiago HOST_BUILD_TYPE=release BUILD_ID=JRO03L OUT_DIR=out ============================================</code> </pre><br>  Run the build: <br><pre> <code class="bash hljs">make ‚Äìj 16 | tee emulator_build.log</code> </pre><br>  While the compilation process is in progress, copy the configuration file and build the kernel for the emulator. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kernel cp arch/x86/configs/goldfish_defconfig .config make ARCH=x86 -j16</code> </pre><br>  Now the emulator build is complete. <br>  The easiest way to run it: <br><pre> <code class="bash hljs">emulator</code> </pre><br>  For example, you can run with a newly assembled kernel, with a resolution of 480x800, 512 megabytes of RAM and hardware graphics acceleration enabled. <br><pre> <code class="bash hljs">emulator -kernel ~/kernel/arch/x86/boot/bzImage -skin WVGA800 -memory 512 -gpu on</code> </pre><br>  More details about the features and settings of the emulator can be found <a href="http://developer.android.com/tools/devices/emulator.html">here.</a> <br><img src="https://habrastorage.org/storage2/879/48b/11b/87948b11b1bf2b06c0a79853a7b66126.png" alt="image"><br><h4>  Conclusion </h4><br>  This article describes how to install the Android x86 version of Jelly Bean for VirtualBox, building a customized kernel and emulator.  There are many different tricks and approaches to the construction and configuration of various versions of Android, which remained outside the scope of this article.  Here was laid out the basic material in order to start your way into the world of the Android OS. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/153521/">https://habr.com/ru/post/153521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153499/index.html">New Brief: Samsung Launches EMMC 128GB Memory Card for Mass Production</a></li>
<li><a href="../153501/index.html">Basket in online stores. A couple of blunders</a></li>
<li><a href="../153511/index.html">Fujitsu LIFEBOOK U772 Ultrabook Video Review</a></li>
<li><a href="../153513/index.html">Zuckerberg in Moscow. Video compilation</a></li>
<li><a href="../153517/index.html">Samsung GALAXY Camera Presentation</a></li>
<li><a href="../153525/index.html">Bypass scopes or unexpected behavior of the EACH function</a></li>
<li><a href="../153527/index.html">Mailbox Simulator Appears in Amazon SES</a></li>
<li><a href="../153529/index.html">Interactive HTML5 rendering based on "Lost"</a></li>
<li><a href="../153531/index.html">Meet the new Imagine Cup 2013!</a></li>
<li><a href="../153533/index.html">Dell hardware review: U2713HM monitor, Alienware X51 desktop and Alienware TactX Mouse 570-10880 mouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>