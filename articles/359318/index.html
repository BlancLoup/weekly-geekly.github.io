<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Cloud Storage with PHP: saving files with public access</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the fact that the previous service with which I stored the images was covered with a copper basin (most likely due to the fact that it was not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Cloud Storage with PHP: saving files with public access</h1><div class="post__text post__text-html js-mediator-article">  Due to the fact that the previous service with which I stored the images was covered with a copper basin (most likely due to the fact that it was not profitable), I had to look for other options for storing images.  The servers I use are low cost and I don‚Äôt want to pay a decent price for an additional 10 GB of disk space.  Studying the market, I came across Google Cloud Storage ( <b>GCS</b> ) and decided that this product would suit me (well, at least you can test it).  In RuNet (and not only in it) little attention is paid to configure <b>GCS</b> using PHP, so I decided to contribute to this direction. <br><br>  This article will look at 2 options for configuring <b>GCS</b> for downloading files (in the example the image will be loaded) using a php client and using an existing sdk ( <b>gsutil</b> utility) using the shell.  So let's go! <br><a name="habracut"></a><br><h2>  check in </h2><br>  The first thing that needs to be done is to register with the Google Cloud Platform.  To do this, click on the <a href="https://console.developers.google.com/">link</a> .  Perhaps the action has not ended yet, and you can get $ 300 as a gift!  You should have no problems, so the registration process decided not to describe.  True, you will need to leave your phone number and credit card. <br><br>  To check, go to the "Payment" section and if you see a similar window, it means that it is desirable for you to link a payment account, otherwise you will not be able to use the <b>GCS JSON API</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/7a/wq/ql/7awqql_qpxoen4nzgvefc2yof4e.png"><br><br><h2>  Creating and setting up a project </h2><br>  In the header of the page you should see the block <b>Select a project</b> , when clicked, you will see the following window.  In my case, instead of <b>Select Project</b> , <b>Photo Project is</b> displayed, since  I have already created two projects. <br><br><img src="https://habrastorage.org/webt/af/hk/6v/afhk6v7gqg37kpyidlwe_y-ln2u.png"><br><br>  Create your new project by clicking on the button <b>CREATE A PROJECT</b> .  Enter the name of the project, and click on the <b>CREATE</b> button.  Within a few seconds, your project will be created and you can select it. <br><br>  After you have selected the created project, go to the <b>Payment</b> section using the navigation menu on the left side of the page.  Please note that in the <b>Projects section of this payment account you</b> have created your project.  In my case, a new project called <b>My Project 71698</b> was automatically added to this block. <br><br><img src="https://habrastorage.org/webt/sj/wr/u_/sjwru_ar0inj-di7aer1hzoir3a.png"><br><br>  But maybe this situation, for example, when the project was created before linking the payment account, but it will not be automatically added.  Therefore, I advise you to initially bind a payment account. <br><br>  If your project does not appear in the block, then you need to go to the <b>Storage</b> section using the navigation menu and select a payment account using the <b>Enable Payment</b> button.  In my case, the Share The Route project has not created a payment account. <br><br><img src="https://habrastorage.org/webt/cs/ih/st/csihstkdea20de-2hcffgivqroc.png"><br><br>  You can create a segment using the interface or through a query.  For now, let's create a segment using the interface by clicking the <b>Create Segment</b> button. <br><br>  Depending on the task, you can select the <b>default Storage Class</b> you need. <br><br><img src="https://habrastorage.org/webt/be/9m/lg/be9mlg14robaf1gbrxrwz2vxjdw.png"><br><br>  Briefly describe the storage classes, then: <br><br>  <i>Multi-Regional</i> - suitable for the site, which is used by the whole country <br>  <i>Regional</i> - a site that is used in most cases in one particular region. <br>  <i>Nearline</i> - for data that is used no more than once a month. <br>  <i>Coldline</i> - for data that is used no more than once a year. <br>  Having selected all the necessary settings, click the <b>Create</b> button. <br><br><h2>  Setting up a server using a php client </h2><br>  To configure the server, you can refer to <a href="https://cloud.google.com/storage/docs/reference/libraries%3Fauthuser%3D0">Cloud Storage Client Libraries</a> if you want to customize the project for another programming language. <br><br>  First, you need to download the library for working with <b>GCS</b> using composer.  If suddenly someone does not have it - <a href="https://getcomposer.org/">put it</a> . <br><br><pre><code class="bash hljs">composer require google/cloud-storage</code> </pre> <br>  Next you need to get the key. To do this, click the <a href="https://console.cloud.google.com/apis/credentials">link</a> and in the <b>Credentials</b> tab click the <b>Create credentials</b> button and select the <b>Key for the service account</b> . <br><br><img src="https://habrastorage.org/webt/n9/xi/rl/n9xirltrvfqzmgvzsxnhupurt3o.png"><br><br>  In the new window, select the <b>New service account</b> and fill in the <b>Service account name</b> field.  In Roles, specify the <b>Owner</b> (Project-&gt; Owner).  After that, a key will be created in json format.  You can save it at a convenient place for you. <br><br><img src="https://habrastorage.org/webt/qy/hj/nw/qyhjnwzvimcprnpb4se2mc1ltta.png"><br><br>  Further, according to the instructions, it is necessary to create an environment variable specifying the path to the file with the key: <br><br>  Linux / Mac OS <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> GOOGLE_APPLICATION_CREDENTIALS=<span class="hljs-string"><span class="hljs-string">"/home/user/Downloads/[FILE_NAME].json"</span></span></code> </pre> <br><br>  Windows <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> GOOGLE_APPLICATION_CREDENTIALS=<span class="hljs-string"><span class="hljs-string">"C:\Users\name\Downloads\[FILE_NAME].json"</span></span></code> </pre> <br>  But due to the fact that for some reason this didn‚Äôt work on my Mac OS Sierra, I‚Äôll show an alternative option if someone suddenly faces a similar problem. <br><br>  This completes all the necessary settings and we can proceed to writing the code: <br><br>  Create <b>index.html</b> to load the image: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>File Upload<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>File Upload<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"gcs.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inputfile"</span></span></span><span class="hljs-tag">&gt;</span></span>Upload File<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Click To Upload"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And the <b>gcs.php</b> script that will upload the file to the cloud: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#  autoloader  GCS require __DIR__ . '/vendor/autoload.php'; #      use Google\Cloud\Storage\StorageClient; # ,     if(isset($_FILES) &amp;&amp; $_FILES['file']['error'] == 0) { $allowed = array('png', 'jpg', 'gif','zip', 'jpeg'); $ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION); if(!in_array(strtolower($ext), $allowed)) { echo 'The file is not an image.'; die; } #    $projectId = 'crafty-booth-205017'; #    GCS $storage = new StorageClient([ 'projectId' =&gt; $projectId, 'keyFilePath' =&gt; '/home/user/Downloads/[FILE_NAME].json' #   ]); #   $bucketName = 'my-project-for-img'; $bucket = $storage-&gt;bucket($bucketName); #    $uploader = $bucket-&gt;getResumableUploader( fopen($_FILES['file']['tmp_name'], 'r'), [ 'name' =&gt; 'images/load_image.png', 'predefinedAcl' =&gt; 'publicRead', ] ); #     GCS try { $uploader-&gt;upload(); echo 'File Uploaded'; } catch (GoogleException $ex) { $resumeUri = $uploader-&gt;getResumeUri(); $object = $uploader-&gt;resume($resumeUri); echo 'No File Uploaded'; } } else{ echo 'No File Uploaded'; }</span></span></code> </pre><br>  Now let's break the code down a bit. <br><br>  <b>$ projectId</b> - in order to find out the identifier of your project, you can click on the drop-down list of projects in the header and see the <b>Name</b> and <b>Identifier</b> columns in a new window.  The <b>ID</b> column just contains the value we need. <br><br><img src="https://habrastorage.org/webt/us/8j/jl/us8jjlmryinkvb9f9ygysfm9kxm.png"><br><br>  <b>keyFilePath</b> is a link to our key that we downloaded.  This property must be specified if the set environment variable cannot be seen by the web service running on the server. <br>  <b>$ bucketName</b> is the name of the segment that we created through the interface.  You can see it in the Storage section. <br>  The <b>getResumableUploader</b> method can <b>also</b> be used with one parameter, then the loaded image will be saved to the segment root with the same name.  In my example, additional properties were used: <br>  <b>name</b> - is responsible for the new file name.  But here you can specify not only the name, but with it the path, relative to the segment.  In this case, the images directory has been added, which will be automatically created if it does not already exist. <br>  <b>predefinedAcl</b> - sets the level of access to the downloaded file.  The <b>publicRead</b> value indicates that this file can be accessed by reference to any user / site. <br>  In more detail the method can be studied on the following <a href="https://googlecloudplatform.github.io/google-cloud-php/">link</a> . <br><br>  Advantages of the approach: <br><br>  + library size &lt;10 MB; <br>  + can be used on third-party hosting. <br><br>  Cons of the approach: <br><br>  - the library is in beta; <br>  - difficult to understand documentation. <br><br>  Thus, I would advise this option for those people who have little free space on the server or if you use a third-party server without access to the terminal to install the <b>gsutil</b> utility. <br><br><h2>  Setting up the server using the gsutil utility </h2><br>  First you need to install this utility on the server.  To do this, download and install sdk (example for Linux / Mac OS. For Debian / Ubuntu and Windows, see the <a href="https://cloud.google.com/storage/docs/gsutil_install">link</a> ): <br><br><pre> <code class="bash hljs">curl https://sdk.cloud.google.com | bash</code> </pre> <br>  After installation, reset the shell: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -l <span class="hljs-variable"><span class="hljs-variable">$SHELL</span></span></code> </pre> <br>  If you reset the shell, you get an error saying that the node module was not found, then try removing it and installing it again through the repository. <br><br>  Perform initialization: <br><br><pre> <code class="bash hljs">gcloud init</code> </pre> <br>  During initialization, you will need to log in.  If the server supports a graphical shell, the old girl will automatically open in the browser, where you will need to confirm access, otherwise you will receive the text of the link that you need to click on.  On this page there will be a key that must be entered into the terminal. <br><br>  After the authorization, you will be asked to choose a segment with which you will work. <br><br>  Now you can use all the features of the <b>gsutil</b> utility.  You can get acquainted with all the teams by the <a href="https://cloud.google.com/storage/docs/gsutil">link</a> . <br>  To copy the images we need the command <b>cp</b> .  It has the following structure: <br><br><pre> <code class="bash hljs">gsutil cp [OPTION]... src_url dst_url</code> </pre> <br>  To send an image use the same <b>index.html</b> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>File Upload<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>File Upload<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"gcs.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inputfile"</span></span></span><span class="hljs-tag">&gt;</span></span>Upload File<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Click To Upload"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And essentially change <b>gcs.php</b> : <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># ,     if(isset($_FILES) &amp;&amp; $_FILES['file']['error'] == 0) { $allowed = array('png', 'jpg', 'gif','zip', 'jpeg'); $ext = pathinfo($_FILES['file']['name'], PATHINFO_EXTENSION); if(!in_array(strtolower($ext), $allowed)) { echo 'The file is not an image.'; die; } $name = time() . "." . $ext; $cmd = "gsutil cp -a public-read $_FILES['file']['tmp_name'] gs://my-project-for-img/images/{$name}"; $result = liveExecuteCommand($cmd); if ($result['exit_status'] !== 0) { echo 'No File Uploaded'; die; } echo 'File Uploaded'; } else{ echo 'No File Uploaded'; }</span></span></code> </pre><br>  The <b>liveExecuteCommand</b> function allows <b>you</b> to track how the transmitted command is executed with intermediate output, but you can also use <b>shell_exec</b> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">liveExecuteCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cmd, $isLog = false)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (@ ob_end_flush()); <span class="hljs-comment"><span class="hljs-comment">// end all output buffers if any $proc = popen("$cmd 2&gt;&amp;1 ; echo Exit status : $?", 'r'); $live_output = ""; $complete_output = ""; while (!feof($proc)) { $live_output = fread($proc, 4096); $complete_output = $complete_output . $live_output; if ($isLog) echo "$live_output"; @ flush(); } pclose($proc); # get exit status preg_match('/[0-9]+$/', $complete_output, $matches); # return exit status and intended output return array ( 'exit_status' =&gt; intval($matches[0]), 'output' =&gt; str_replace("Exit status : " . $matches[0], '', $complete_output) ); }</span></span></code> </pre><br>  Advantages of the approach: <br><br>  + convenient documentation; <br>  + the ability to work through the terminal; <br>  + more features. <br>  + simple syntax <br><br>  Minuses: <br><br>  - sdk weight about 280 MB; <br>  - access to the terminal on the server is required <br><br>  In my opinion, this approach is more suitable for those who do not have problems with free space on the server (since sdk is 28 times harder) or work is needed both through the shell and through the terminal. <br><br><h3>  Conclusion </h3><br>  In the article I tried to describe in detail and step by step how to use <b>GCS</b> to save images and in which case to use one or another approach.  I do not pretend to be the absolute truth, but because  There is too little information on this topic in runet - I think that the article should be interesting to those who want to add <b>GCS</b> to their project as well. </div><p>Source: <a href="https://habr.com/ru/post/359318/">https://habr.com/ru/post/359318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../359306/index.html">The world of magic PostgreSQL: an interview with Nikolai Samokhvalov</a></li>
<li><a href="../359308/index.html">Simple and powerful short-term smart contracts</a></li>
<li><a href="../359312/index.html">Google Cloud: New Platform and Machine Learning Capabilities</a></li>
<li><a href="../359314/index.html">GDPR - drop in the outgoing train</a></li>
<li><a href="../359316/index.html">HTTP (S) traffic balancing</a></li>
<li><a href="../359320/index.html">Test it all: how the Heisenbug 2018 Piter went</a></li>
<li><a href="../359322/index.html">Fintech-digest: the bill on regulation of cryptocurrency passed the first reading, investors are confident in the future of Bitcoin</a></li>
<li><a href="../359324/index.html">Bungie, Naughty Dog, Sony Santa Monica and Blizzard discuss the problem of crunch</a></li>
<li><a href="../359326/index.html">Creating a design of replayable stealth levels for Payday 2</a></li>
<li><a href="../359328/index.html">Bigdata, machine learning and neural networks - for managers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>