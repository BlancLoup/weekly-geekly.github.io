<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the script interpreter and stack machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will discuss a rather unusual project. Once I was visited by the desire to write my own interpreter of some scripting language and the ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the script interpreter and stack machine</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/45d/716/cc0/45d716cc0cfe8133e60d65f7ccb765f3.jpg" align="left"><br>  This article will discuss a rather unusual project.  Once I was visited by the desire to write my own interpreter of some scripting language and the executing machine for it.  Just to see how it works inside.  This goal does not sound very noble, and I put it off indefinitely, because  I wanted more useful wording. <br>  Once, a friend of mine complained that you need to write an automation script to WSH, but he does not know either VBScript or Javascript.  Here the "noble" wording arose by itself ... you need to help someone.  As a result, a compiler and an executing machine were written, allowing execution of scripts for Windows Script Host, without resorting to VBScript and JS.  Under the cut - a brief background of the project and its internal structure and the programming language itself. <br><a name="habracut"></a><br><h4>  Brief background </h4><br>  Gentlemen, I will reveal to you a terrible secret.  I know that I am very ashamed to admit such a sin, but I confess nonetheless.  I am one-esnik.  Yes, yes, yes, I write large and small solutions using a yellow framework and conscience does not torment me))). <br><br>  In addition to 1C, I know other languages, but I am young, I can afford it.  My friend, whom I mentioned in the introduction - on the contrary - a military retiree, a good electronics engineer, retrained as a programmer when he went out to a citizen.  For a competent technician, such retraining is a simple matter, paying in the 1C sphere is not bad, and good specialists are doing so well.  However, with age it becomes more and more difficult to chase after new technologies, it becomes more and more difficult to follow the rapidly changing world of IT.  When the said conversation took place, he said something like: ‚ÄúYes, this is a long time to learn a new language, so if such a script could be written on 1C, but so that the console was executed ...‚Äù Then I remembered my old idea of ‚Äã‚Äãwriting the interpreter, which now from a purely research one received a completely applied focus - the execution of scripts working with the WSH infrastructure, but in 1C. <br><br><h4>  A little bit about the programming language </h4><br>  About 1C language they say that this is Visual Basic, translated by promt.  It really is.  In spirit, the language is very close to VB ‚Äî it has weak typing, no OOP, lambda expressions, or closures.  It has ‚Äúverbal‚Äù, not ‚Äúsishny‚Äù syntax.  In addition, since all keywords have English analogues, the 1C code written in English terms is almost impossible to distinguish at a glance from VB.  Is that the comment character - two slashes, and not an apostrophe, as in BASIC. <br>  The language distinguishes procedures and functions, it has the classic ‚ÄúFor‚Äù and ‚ÄúWhile‚Äù cycles, as well as the iteration cycle ‚ÄúFor Each ... In‚Äù.  Appeal to the properties and methods of objects is performed "through the point", the appeal to arrays is in square brackets.  Each statement is terminated by a semicolon. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What is a stack machine and how it works </h4><br>  As far as I know, stack machines are the most common.  For example, .NET CLR and JVM virtual machines are stackable.  On Habr√© there is even a separate <a href="http://habrahabr.ru/post/138667/">article</a> about this case.  Nevertheless, in order not to chase the reader by reference, I think it is worth describing the principle of their work here.  A stack machine performs all operations on data that is organized in a stack.  Each operation extracts the required number of operands from the stack, performs actions on them and puts the result back onto the stack.  This approach allows you to create a lightweight bytecode with a minimum of commands.  In addition, it also works quite quickly. <br>  Bytecode is a set of commands that the machine will execute. <br><br><blockquote>  Each instruction is a single-byte opcode from 0 to 255, followed by parameters such as registers or memory addresses ( <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B9%25D1%2582-%25D0%25BA%25D0%25BE%25D0%25B4">wikipedia</a> ). </blockquote><br>  In our machine, the command will have a fixed length and consist of two numbers ‚Äî an operation code and an operation argument.  Each command involves a set of actions on the data in the stack. <br>  For example, the pseudo-code of the ‚Äú1 + 2‚Äù addition operation might look like this: <br><br><pre><code class="hljs pgsql">Push <span class="hljs-number"><span class="hljs-number">1</span></span> Push <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span></code> </pre> <br>  The first two teams put the items on the stack, the third team performs the addition and puts the result on the stack.  In this case, the assignment operation ‚ÄúA = 1 + 2‚Äù might look like this: <br><br><pre> <code class="hljs 1c">Push <span class="hljs-number"><span class="hljs-number">1</span></span> ;    <span class="hljs-string"><span class="hljs-string">"1"</span></span> Push <span class="hljs-number"><span class="hljs-number">2</span></span> ;    <span class="hljs-string"><span class="hljs-string">"2"</span></span> Add ;  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-string"><span class="hljs-string">"1"</span></span>  <span class="hljs-string"><span class="hljs-string">"2"</span></span>,      . LoadVar A ;   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br>  It can be seen that the Push and LoadVar commands have an argument, the Add command does not need an argument. <br>  The advantage of stack computing is that operations are performed in the order they are followed, no need to pay attention to the priorities of operations.  What is written is done.  Before performing the operation, its operands are pushed onto the stack.  This way of describing expressions is called <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B7%25D0%25B0%25D0%25BF%25D0%25B8%25D1%2581%25D1%258C">reverse polish notation</a> . <br><br>  The task of writing a stack machine comes down to the ‚Äúinvention‚Äù of the necessary set of commands that this machine will understand. <br><br><h4>  Compiler device </h4><br>  The task of the compiler is to convert the code in a given language into the byte-code of the machine that will execute it.  The classic compiler has 3 components: <br><ul><li>  Lexical Analyzer (Parser) </li><li>  Syntactical analyzer </li><li>  Code generator </li></ul><br>  The lexical analyzer breaks a chaotic stream of incoming characters into lexemes.  It selects words, numbers, string constants, signs of operations from the source text and turns them into atomic entities with which it is convenient to work further. <br><br>  The parser checks that the set of tokens that the lexical analyzer gave it is meaningful, that we have a program, and not a meaningless set of letters. <br><br>  The analyzer builds an <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B1%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2581%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE">abstract syntax tree</a> (AST), which is then fed to the input of the code generator. <br>  The code generator creates a bytecode, bypassing the nodes of the syntax tree. <br><br>  I started writing the compiler in the same three-tier scheme, but then it seemed to me to be unnecessarily correct and, in the context of this task, unnecessary.  Therefore, I refused AST and combined parsing with code generation. <br>  The compiler in the loop requests the next lexeme from the parser and, looking at it, generates a code.  Along the way, it checks that the token is legal in this context.  AST in this scheme is superfluous. <br><br><h5>  State machine </h5><br>  Parser and compiler is more convenient to implement as a finite state machine.  When extracting the next character, the conclusion is made about which mode to switch to in order to interpret this character.  For example, if a letter appeared at the input, then we switch to the word reading mode, if a number appears, then we read in the number mode, etc.  Each state defines a set of valid input symbols.  After extracting the token, the machine goes to the previous state.  With code generation - the same.  Appeared at the IF input, then we switch to the condition generation mode, and at the end - we return to the previous state. <br><img src="https://habrastorage.org/getpro/habr/post_images/9f1/90b/1d9/9f190b1d97ffbf27f691a61179dce21f.png"><br><h4>  Virtual machine device </h4><br><h5>  Contexts of visibility </h5>  All variables and methods always belong to some context.  There is a global context, a module context, and a local context inside the method.  It turns out a stack of available (visible) names that can be accessed during execution.  With this stack is active work at the time of compilation and execution. <br>  Moreover, if you develop the idea and assume that you can create <i>instances of contexts</i> , then modularity naturally arises.  If we have a certain module, as a set of methods and variables, then we have a <i>context</i> in which all the code of this module works.  Now, if we create two instances of the same module, then in fact we will create two instances of the same class.  Each of them will see their own context and have their own state. <br>  The 1C documentation does not explicitly say this, but the observed behavior allows us to conclude that the execution of modules in the 1C execution environment works in this way.  The runtime environment does not work with instances of objects, but with <i>contexts</i> that ‚Äújoin‚Äù the virtual machine as needed. <br><br><h5>  Memory </h5>  A conditional ‚Äúmemory‚Äù of a machine is a list of contexts connected to it.  Each context has its own number and state (specific values ‚Äã‚Äãof variables).  Commands for reading / writing variables have an argument in the form of a cell number in the context table.  Each entry in the table describes the context number and the variable number in this context over which the action is performed. <br><table><tbody><tr><th>  Index </th><th>  Context number </th><th>  Variable number </th></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td></tr><tr><td>  2 </td><td>  one </td><td>  3 </td></tr></tbody></table><br>  For example, if the <i>PushVar 1</i> command is <i>received</i> , then in the table at index 1, an entry is selected that says to take the variable number 1 from the context 0. <br>  Variables are a simple array that each connected context reports to the machine.  The machine writes and reads data from this array, thereby changing the state of the connected contexts.  At the same time, it does not matter what context is connected to - an instance of some class or a global context.  The machine can change variables, and what kind of variables - does not matter. <br><br><h5>  Call stack </h5><br>  The execution of the code is organized using so-called ‚Äúframes‚Äù, each of which is a set of local variables and a pointer to the current instruction.  When any method is called, the current frame is pushed onto the stack.  Thus, the state of the machine at the time of the call is saved <br><br>  Then a new frame is formed with an empty array of local variables and the instruction number equal to the beginning of the called method.  This new frame becomes current and the command execution cycle continues from there. <br>  When the <i>Return</i> command is reached, the current frame is destroyed (along with the local variable values ‚Äã‚Äãthat went out of scope), the saved frame with the previous state is retrieved from the call stack and the command execution cycle continues from the call point. <br><br>  Fragment of pseudocode with method call. <br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">0</span></span>: Push <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: Push <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: Nop <span class="hljs-number"><span class="hljs-number">5</span></span>: Nop <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: LoadVar</code> </pre><br>  Suppose that the current instruction is number 6. This is a call to address 0. Local variables and the number of the current instruction are stored in the call stack.  Further, control is transferred to the address 0, and then returns to the address 6, where the transition further occurs, to the next instruction. <br><br><h5>  Command implementation </h5><br>  All command implementations are methods of the MachineInstance class, and pointers to these methods are located in an array of operation codes.  When retrieving the next command, by its number, the pointer to the implementation is extracted from the array and this implementation is performed.  Exception processing is in progress. <br><div class="spoiler">  <b class="spoiler_title">Main command execution loop</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecuteCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MainCommandLoop(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (RuntimeException exc) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_exceptionsStack.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = _exceptionsStack.Pop(); SetFrame(handler.handlerFrame); _currentFrame.InstructionPointer = handler.handlerAddress; _lastException = exc; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainCommandLoop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (_currentFrame.InstructionPointer &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; _currentFrame.InstructionPointer &lt; _module.Code.Length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = _module.Code[_currentFrame.InstructionPointer]; _commands[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)command.Code](command.Argument); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (RuntimeException) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exc) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExternalSystemException(exc); } }</code> </pre><br></div></div><br><br><h4>  Device executable </h4><br>  This machine uses a command with one numeric argument.  Each command is determined by an operation code and an argument, the interpretation of which depends on the command itself.  On this principle, the whole system of commands and the structure of the executable module are built. <br>  To begin with, let's look at what the source module in 1C consists of. <br>  It has 3 distinct sections: <br><img src="https://habrastorage.org/getpro/habr/post_images/e3e/429/01b/e3e42901bfea9b2d045335899d45f74a.png"><br><ul><li>  In the variable section, all variables of the module level are declared, i.e.  those that are visible everywhere inside the module. </li><li>  Module methods are the actual procedures and functions with code. </li><li>  The body of the module is the code that runs when the module is loaded.  Performance begins with him. </li></ul><br>  Since the module body is essentially a method without a name, we can say that there are only two types of different types of constructions - the declaration of variables and the executable code. <br><br><h5>  Constants </h5><br>  Obviously, all operations are performed on some values.  Values, in turn, are represented by variables and constants.  Constants include literals of numbers, strings, dates, keywords <code></code> , <code></code> and <code></code> . <br>  In order to add 2 and 2 to any computer, you need to explain what ‚Äú2‚Äù is and where to get it.  For this purpose, the compiled module includes the description of all constants used in the code.  If the code says " <code> = ""</code> ", then this word "Hello" should be in the list of constants. <br><br><h5>  Variables </h5><br>  Variable names are only important at compile time to allow scopes.  At runtime, variable names are not needed.  To allocate memory for an array of variables, it is enough to know only their number.  When the machine is created, an array of variables is created, which is accessed by the number.  In the compiled module only the number of variables is indicated. <br>  With variables, however, there is a slight complication.  The fact is that in addition to the module variables, there are also global variables declared somewhere outside the module.  As mentioned above - there is a stack of visible names, and the compiler, meeting a certain name, searches for it in the stack of declared names.  Theoretically, you can connect several independent libraries with their properties and functions that will be visible to the client script. <br><img src="https://habrastorage.org/getpro/habr/post_images/39e/ef0/e27/39eef0e273e4a5e09e92623a147192fb.png"><br>  If the code uses a variable, the machine must know what context it belongs to.  Since a command has only one numeric argument, it is necessary to determine the context in which this variable is declared with the help of a single argument.  For this purpose, a <i>variable table has been</i> introduced into the module.  each entry in the table contains a context number and a variable number within the context.  The command argument is interpreted as the record number in the variable table (see the "Memory" section). <br><div class="spoiler">  <b class="spoiler_title">Variable operations on the stack</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PushVar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = _module.VariableRefs[arg]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = _scopes[vm.ContextIndex]; _operationStack.Push(scope.Variables[vm.CodeIndex]); NextInstruction(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadVar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vm = _module.VariableRefs[arg]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scope = _scopes[vm.ContextIndex]; scope.Variables[vm.CodeIndex].Value = BreakVariableLink(_operationStack.Pop()); NextInstruction(); }</code> </pre></div></div><br><h5>  Methods </h5><br>  Methods are divided into <i>procedures</i> and <i>functions</i> .  The latter can return values.  By default, parameters in methods are passed by reference.  To pass by value, the method parameter must be designated by the ‚ÄúValue‚Äù keyword (analogous to ByVal in BASIC). <br>  The compiled module contains information about the parameters of the method, their binding, the presence of return values, etc.  Each method has its own number.  In addition, for each method, the number of local variables of this method is indicated. <br>  Methods, like variables, can be external to the module (i.e., declared somewhere globally).  Calling to methods is organized in the same way as in variables ‚Äî via a matching table that defines the context in which the method to be called is located. <br><br><h5>  The final structure of the module </h5><br>  Combine all of the above and get the following structure of the compiled module: <br><img src="https://habrastorage.org/getpro/habr/post_images/ac1/d32/557/ac1d3255779a4fdfa1a0cc4009dfa6a9.jpg"><br>  After compilation, the module is a structure that includes: <br><ol><li>  Number of module level variables </li><li>  List of constants </li><li>  List of method signatures </li><li>  Module byte code </li><li>  Variable map </li><li>  Method map </li><li>  The number of the method that is the entry point to the module (module body) </li></ol><br><br><h4>  Work with values </h4><br>  1C language does not have strict typing.  The variable gets the type at the moment of assigning it a value.  Any value is essentially a universal type VARIANT.  When performing operations, the universal value is given with the desired type.  For example, arithmetic operations are reduced to a number, and for Boolean operations, to a boolean value. <br>  The following basic value types exist: <br><ol><li>  Undefined </li><li>  Line </li><li>  Number </li><li>  date </li><li>  Boolean </li><li>  An object </li><li>  Type of </li></ol><br>  The latter is a primitive type for working with types (similar to <code>System.Type</code> in .NET) <br>  The universal value is represented by the <code>IValue</code> interface: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IValue</span></span> : <span class="hljs-title"><span class="hljs-title">IComparable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">IValue</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IEquatable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">IValue</span></span>&gt; { DataType DataType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } TypeDescriptor SystemType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">DateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsDate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsBoolean</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">TypeDescriptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">IRuntimeContextInstance </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br>  The interface allows you to find out the actual type of the value, as well as perform a cast to the basic types.  Such a cast is necessary, for example, to perform arithmetic operations.  A class that implements a specific type of value itself tries to cast its value to each of the basic types. <br>  When evaluating an expression, the type of the final result is determined by the type of the first operand.  Thus, the expression <code>"12345" + 10</code> should produce a string result.  When performing the addition, the second argument will be cast to a string and concatenated. <br>  In contrast, operation <code>10 + "12345"</code> will attempt to cast the string "12345" to a number.  If this casting is impossible - the exception ‚Äúcasting error to the type Number‚Äù arises. <br>  In the examples, the class implementing the type ‚ÄúNumber‚Äù calls the method AsString (), and the class implementing the type ‚ÄúString‚Äù calls the method AsNumber (). <br><br><div class="spoiler">  <b class="spoiler_title">Addition operation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op2 = _operationStack.Pop(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = _operationStack.Pop(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type1 = op1.DataType; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type1 == DataType.String) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = op1.AsString() + op2.AsString(); _operationStack.Push(ValueFactory.Create(result)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type1 == DataType.Date &amp;&amp; op2.DataType == DataType.Number) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = op1.AsDate(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = date.AddSeconds(op2.AsNumber()); _operationStack.Push(ValueFactory.Create(result)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    . var result = op1.AsNumber() + op2.AsNumber(); _operationStack.Push(ValueFactory.Create(result)); } NextInstruction(); }</span></span></code> </pre></div></div><br><br><h5>  Access to object properties and methods </h5><br>  Each object can have properties and methods that can be accessed "through the point".  Appeal performed by name.  The mechanics of addressing by name are represented by a special interface that allows you to find out if the object has the necessary members and access to them. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRuntimeContextInstance</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsIndexed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">IValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIndexedValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IValue index</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetIndexedValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IValue index, IValue val</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsPropReadable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propNum</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsPropWritable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propNum</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPropValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propNum</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPropValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propNum, IValue newVal</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">MethodInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMethodInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodNumber</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallAsProcedure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodNumber, IValue[] arguments</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallAsFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodNumber, IValue[] arguments, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IValue retValue</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  When accessing a property or method, the object is requested the number of this property / method.  Further, by this number, a request is made about the readability and readability of the property, the number of method parameters, the presence of a return value, etc.  After clarifying this information, the call is made. <br>  For properties, this is setting or reading a value.  For methods, call as a procedure or call as a function.  In the latter case, the returned value is pushed onto the virtual machine stack. <br><br><h5>  Working with objects as contexts and vice versa </h5><br>  Above, I mentioned modularity and the creation of objects as <i>context instances</i> .  Let's take a closer look at what was meant and how the access to objects ‚Äúthrough the point‚Äù is organized. <br><br>  Imagine that we have a certain library of functions.  We can call functions from this library and enjoy the result.  Now imagine that a library is an instance of a class, with a set of public methods and properties.  This instance is inconspicuously ‚Äúembedded‚Äù in our scope so that we invoke instance methods directly, as if they were global functions. <br><br>  If an instance of the class " <code>MathLibrary</code> " is connected to the stack of scopes, then the functions Sin, Cos and Sqrt can be called by direct access.  They will be visible, as the usual methods declared somewhere at the level of libraries. <br><br><pre> <code class="1c hljs"> = <span class="hljs-built_in"><span class="hljs-built_in">Sin</span></span>(X); <span class="hljs-comment"><span class="hljs-comment">//  Sin   ,      ,       .</span></span></code> </pre><br><br>  And now we do the reverse operation.  If we wrote a script, then it is in itself the context.  It provides the scope in which the code works.  But what if we create an <i>instance of</i> this script and write it into a variable?  It turns out that our script is a class, with its properties and methods and you can work with it as with an object.  This principle is the basis for the ability to connect (import) external script files, and work with them as with objects ‚Äî create instances, call methods, etc. <br>  Moreover, when script A calls script B, script B is connected to the machine‚Äôs memory, as the <i>context</i> and execution of code B goes as if B were the only script.  When returning from module B, it is disconnected and execution again goes to script A. <br><br><h4>  Byte code examples </h4><br>  Below are examples of how the execution of certain operations in bytecode is organized. <br><br><div class="spoiler">  <b class="spoiler_title">Addition and Assignment</b> <div class="spoiler_text"><pre> <code class="1c hljs"> = <span class="hljs-number"><span class="hljs-number">1</span></span>;  = <span class="hljs-number"><span class="hljs-number">2</span></span>;  =  + ;</code> </pre> <br><pre> <code class="hljs haskell">.constants <span class="hljs-number"><span class="hljs-number">0</span></span> :<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 1 1 :</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 2 .code 0 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) ;   0   1 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 0) ;       0 2 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 1) ;   1   3 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 1) ;       1 4 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushLoc</span></span></span><span class="hljs-class"> 0) ;     0 5 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushLoc</span></span></span><span class="hljs-class"> 1) ;     1 6 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class"> 0) ;       7 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 2) ;       2</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Precondition loop (While)</b> <div class="spoiler_text"><pre> <code class="1c hljs"> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  =  + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>;</code> </pre> <br><pre> <code class="hljs haskell">.constants <span class="hljs-number"><span class="hljs-number">0</span></span> :<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 1 1 :</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 5 .code 0 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) 1 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 0) ;      2 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushLoc</span></span></span><span class="hljs-class"> 0) ;   ( ) 3 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 1) 4 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Less</span></span></span><span class="hljs-class"> 0) ;   ""   ‚Ññ1 ( 5) 5 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JmpFalse</span></span></span><span class="hljs-class"> 11) ;    - ,      ( 11) 6 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushLoc</span></span></span><span class="hljs-class"> 0) ;   =  + 1 7 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) 8 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class"> 0) 9 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 0) 10 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Jmp</span></span></span><span class="hljs-class"> 2) ;        11 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nop</span></span></span><span class="hljs-class"> 0) ;  </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Condition</b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>;</code> </pre> <br><pre> <code class="hljs haskell">.constants <span class="hljs-number"><span class="hljs-number">0</span></span> :<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 1 1 :</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 2 2 :</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Number</span></span></span><span class="hljs-class">, val: 0 .code 0 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) 1 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 1) 2 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Greater</span></span></span><span class="hljs-class"> 0) ;   "" 3 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JmpFalse</span></span></span><span class="hljs-class"> 7) ;    -    "" 4 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) ;    5 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 0) 6 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Jmp</span></span></span><span class="hljs-class"> 9) ;   ,     7 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 2) ;    8 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LoadLoc</span></span></span><span class="hljs-class"> 0) 9 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Nop</span></span></span><span class="hljs-class"> 0);  </span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Method call</b> <div class="spoiler_text"><pre> <code class="1c hljs"><span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>);</code> </pre> <br><pre> <code class="hljs haskell">.constants <span class="hljs-number"><span class="hljs-number">0</span></span> :<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">, val:  .code 0 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PushConst</span></span></span><span class="hljs-class"> 0) ;     1 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ArgNum</span></span></span><span class="hljs-class"> 1) ;      2 :(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CallProc</span></span></span><span class="hljs-class"> 1) ;  ,        1 .procmap 0 :(1,2) 1 :(0,4) ;  1    0     4.</span></span></code> </pre></div></div><br><br><h4>  What was there about WSH? </h4><br>  The WSH scripting infrastructure is represented by a number of COM objects.  These objects can be accessed from scripting languages ‚Äã‚Äãby referring to their members by name using IDispatch.  Nothing like? <br>  It is enough to make a small wrapper on IDispatch, which will allow the machine to work with these COM objects through the IRuntimeContextInstance interface mentioned. <br><br>  The figure shows the test application window that I used to debug scripts.    ,       Scripting.FileSystemObject <br><img src="https://habrastorage.org/getpro/habr/post_images/7f9/426/9db/7f94269db7a824b417dc8ef74209127b.png"><br><br> ,       WSH           . ,     WSH   ,    ,      .   ,    ,   ,    . <br><br><h4>    </h4><br>        dll   . <br>  TestApp ‚Äî   GUI-based ,      ,       . <br>   oscript       . <br>   oscript  ,     . <br>            ,    exe-.       . <br>     <a href="https://bitbucket.org/EvilBeaver/1script/overview">bitbucket</a> .  ,  wiki    . <br>   ,  ,       ‚Äî <a href="">setup.exe</a> <br><br><h4>   </h4><br>         1,      ,      1  -  . <br>      .  ,    ,  ¬´ ¬ª,  , ,   . -       .         ,      . <br> ,     .  , ,   .  Good luck. <br><br> PS      1     ¬´      ?¬ª :) </div><p>Source: <a href="https://habr.com/ru/post/223887/">https://habr.com/ru/post/223887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223869/index.html">MBLOK Wireless Storage on Kickstarter</a></li>
<li><a href="../223873/index.html">Distribution of scientific software. Is free</a></li>
<li><a href="../223877/index.html">How Host-tracker helped to quickly detect malicious code</a></li>
<li><a href="../223883/index.html">Electric for regular airlines</a></li>
<li><a href="../223885/index.html">DevConf 2014: Andrei Aksenov, author of Sphinx - will tell you how the repositories are arranged inside NoSQL</a></li>
<li><a href="../223889/index.html">Why does business need a cloud: an overview of real IaaS usage scenarios</a></li>
<li><a href="../223893/index.html">Web Layer Layer Modes</a></li>
<li><a href="../223895/index.html">Highscreen Spider LTE smartphone review</a></li>
<li><a href="../223897/index.html">What is the platform Docsvision and our four principles of its development</a></li>
<li><a href="../223901/index.html">WebMoney.ru does not work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>