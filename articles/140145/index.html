<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The path to SQL injection in the Zend Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps a slightly loud title of the article, but this question is raised. 

 First moment 
 If you follow all the rules, i.e. use the internal mechan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The path to SQL injection in the Zend Framework</h1><div class="post__text post__text-html js-mediator-article">  <i>Perhaps a slightly loud title of the article, but this question is raised.</i> <br><br><h4>  First moment </h4><br>  If you follow all the rules, i.e.  use the internal mechanisms of Zend, prepare the parameters in the methods - then at the moment there is no information about the possibility of a sql injection.  We are talking about similar structures: <br><pre><code class="php hljs">$select-&gt;order($value);</code> </pre> <br>  Which somehow meet in practice. <br><br><h4>  Second moment </h4><br>  What is the salt?  The fact is that even with the input of parameters to such methods without any preparation, the internal mechanisms still prepare them.  But not all (and some partially) - this is what they mean. <br><a name="habracut"></a><br>  Although we have the source code of this library, we will consider this topic as a ‚Äúblack box‚Äù, it will be clearer and clearer.  More specifically, the MySQL adapter, the <i>Zend_Db_Select</i> class (the same was tested on PgSQL) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Third moment </h4><br>  In order to conduct an injection in Zend, we need to close the previous back quote (for example, in the case of the syntax from = <b>select * from `table`</b> ), or the apostrophe - ( <b>where id = '1'</b> ), since Zend follows the rules when specifying the parameter opens the desired "frame".  In the first case, when passing to the <b>tab`ble</b> input, we should have <b>ta``ble</b> at the output, in the second <b>case</b> : at the input <b>1'2</b> , at the output <b>1''2</b> . <br>  Once again, we are talking about the "raw" sending data to the method. <br><br>  We have three cases: <br><ol><li>  <b>FQ</b> - all parameters are prepared (fully quoted) </li><li>  <b>NQ</b> - the data is not prepared, everything will ‚Äúgo away‚Äù to the database, as it was transmitted (no quoted) </li><li>  <b>PQ</b> - some parameters are being processed, some are not (partially quoted) </li></ol><br><br>  Let's go in order, in order in the syntax of SQL <br><br><h5>  1) -&gt; from - <b>FQ</b> </h5><br>  Code: <br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_use`rs"</span></span>; $select-&gt;from($table);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_use``rs`.* FROM `wp_use``rs`</code> <br> <br><h5>  2) -&gt; join - <b>PQ</b> </h5><br><pre> <code class="php hljs">$table1 = <span class="hljs-string"><span class="hljs-string">'tab`le1'</span></span>; $table2 = <span class="hljs-string"><span class="hljs-string">'tab`le2'</span></span>; $key = <span class="hljs-string"><span class="hljs-string">'i`d'</span></span>; $data = <span class="hljs-string"><span class="hljs-string">'da`ta'</span></span>; $select = $db-&gt;select()-&gt;from($table1)-&gt;join($table2, $table1.<span class="hljs-string"><span class="hljs-string">'.'</span></span>.$key.<span class="hljs-string"><span class="hljs-string">' = '</span></span>.$table2.<span class="hljs-string"><span class="hljs-string">'.'</span></span>.$key, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($data));</code> </pre><br> <code>[queryString] =&gt; SELECT `tab``le1`.*, `tab``le2`.`da``ta` FROM `tab``le1` INNER JOIN `tab``le2` ON tab`le1.i`d = tab`le2.i`d</code> <br> <br><h5>  3) -&gt; joinUsing - <b>PQ</b> </h5><br><pre> <code class="php hljs">$table1 = <span class="hljs-string"><span class="hljs-string">'tab`le1'</span></span>; $table2 = <span class="hljs-string"><span class="hljs-string">'tab`le2'</span></span>; $key = <span class="hljs-string"><span class="hljs-string">'i`d'</span></span>; $column = <span class="hljs-string"><span class="hljs-string">'c`ol\'u;m"n'</span></span>; $select = $db-&gt;select()-&gt;from($table1)-&gt;joinUsing($table2, $column);</code> </pre><br> <code>[queryString] =&gt; SELECT `tab``le1`.*, `tab``le2`.* FROM `tab``le1` INNER JOIN `tab``le2` ON `tab``le2`.c`ol'u;m"n = `tab``le1`.c`ol'u;m"n</code> <br> <br><h5>  4) -&gt; where - <b>NQ</b> </h5><br><pre> <code class="php hljs">$select-&gt;from($table); $value = <span class="hljs-string"><span class="hljs-string">"1)2'3 --"</span></span>; $select-&gt;where($value);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` WHERE (1)2'3 --)</code> <br> <br><h5>  5) -&gt; group - <b>FQ</b> </h5><br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_users"</span></span>; $value = <span class="hljs-string"><span class="hljs-string">'i`d'</span></span>; $select = $db-&gt;select()-&gt;from($table)-&gt;group($value);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` GROUP BY `i``d`</code> <br> <br><h5>  6) -&gt; having - <b>NQ</b> </h5><br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_users"</span></span>; $value = <span class="hljs-string"><span class="hljs-string">'some_count &gt; 0); hello habr -- 10'</span></span>; $select = $db-&gt;select()-&gt;from($table)-&gt;having($value);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` HAVING (some_count &gt; 0); hello habr -- 10)</code> <br> <br><h5>  7) -&gt; order - <b>FQ</b> </h5><br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_users"</span></span>; $value = i`d<span class="hljs-string"><span class="hljs-string">'; $select = $db-&gt;select()-&gt;from($table)-&gt;order($value);</span></span></code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` ORDER BY `i``d` ASC</code> <br> <br><h5>  8) -&gt; limit - <b>FQ</b> </h5><br>  There is not even FQ, but simply - type conversion (to int) <br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_users"</span></span>; $limit1 = <span class="hljs-string"><span class="hljs-string">'1; hello -- '</span></span>; $limit2 = <span class="hljs-string"><span class="hljs-string">'2; hello -- '</span></span>; $select = $db-&gt;select()-&gt;from($table)-&gt;limit($limit1, $limit2);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` LIMIT 1 OFFSET 2</code> <br>  Here -&gt; limitPage (), similar work <br><br><h5>  9) -&gt; union - <b>NQ</b> </h5><br>  $ db-&gt; select + string <br><pre> <code class="php hljs">$table = <span class="hljs-string"><span class="hljs-string">"wp_users"</span></span>; $select = $db-&gt;select()-&gt;from($table); $select2 = <span class="hljs-string"><span class="hljs-string">"select * from ta\"b'le`2"</span></span>; $select3 = $db-&gt;select()-&gt;union(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($select, $select2)); $db-&gt;query($select3);</code> </pre><br> <code>[queryString] =&gt; SELECT `wp_users`.* FROM `wp_users` UNION select * from ta"b'le`2</code> <br> <br><h4>  Summary </h4><br>  FQ: -&gt; from, -&gt; group, -&gt; order, -&gt; limit, -&gt; limitPage <br>  PQ: -&gt; join, -&gt; joinUsing <br>  NQ: -&gt; where, -&gt; having, -&gt; union <br><br>  In practice, non-filtered data can be found, for example, in ajax handlers. <br><br>  PS Among other things, perhaps someone will take this data to himself in CTF. <br><br>  <b>UPD:</b> Moment 4: An article more for pentesters who may encounter an application on Zend. </div><p>Source: <a href="https://habr.com/ru/post/140145/">https://habr.com/ru/post/140145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140137/index.html">NetApp FAS2240</a></li>
<li><a href="../140139/index.html">Avast Mobile Security for Android Review</a></li>
<li><a href="../140140/index.html">First KnockoutJS training from Roman Gomolko in Dnepropetrovsk</a></li>
<li><a href="../140141/index.html">TOP-3 Hi-tech: Unrecognized gadgets!</a></li>
<li><a href="../140144/index.html">Droider Chart. 91 release, navigational</a></li>
<li><a href="../140147/index.html">Fiddler - JavaScript debugging helper</a></li>
<li><a href="../140148/index.html">Open competition of St. Petersburg in robotics</a></li>
<li><a href="../140149/index.html">March 28 is declared the day of free document circulation</a></li>
<li><a href="../140150/index.html">Part number 1. Introduction to folding biochemistry. From proteins to RNA</a></li>
<li><a href="../140152/index.html">If ... else conditions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>