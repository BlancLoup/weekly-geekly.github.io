<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Inertia in JavaScript on the example of OL3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The modern world dictates developers and designers fairly high standards of quality and ease of use of web applications. As a rule, a good impression ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Inertia in JavaScript on the example of OL3</h1><div class="post__text post__text-html js-mediator-article">  The modern world dictates developers and designers fairly high standards of quality and ease of use of web applications.  As a rule, a good impression of the application consists of many small things that should be harmoniously combined with each other.  One of such trifles can be the inertial movement of ‚Äúdraggable‚Äù (draggable) objects on the page - we will talk about this in today's small article.  The feature is especially relevant when the user interacts with the application via touch devices, since the screen size of such devices is limited, and you want to move an object from one point to another with one ‚Äúflick of the wrist‚Äù and not multiple screen touches. <br><br>  We once asked ourselves a similar question as part of developing <a href="http://api.2gis.ru/about/features/">the 2GIS map API</a> , and today we decided to share our modest experience. <br><a name="habracut"></a><br>  Before considering the details of the implementation of inertia, let's take a look at the ready-made examples: <br><ul><li>  <a href="http://cubiq.org/dropbox/iscroll4/examples/simple/">inertial scroll</a> ; </li><li>  <a href="http://www.annefrank.org/en/Subsites/Timeline/">inertial motion of the carousel of photographs</a> ; </li><li>  <a href="http://maps.2gis.ru/%3Futm_source%3Dnews%26utm_medium%3Dhabr%26utm_campaign%3Dpost_inercia">inertial movement of the 2GIS map</a> . </li></ul><br>  Ok, now to the point. <br><br><h4>  Experiment space </h4><br>  As a test example, add inertial movement to one of the mapping APIs that still do not have such a feature.  Thus, we: a) learn something;  b) inflict irreversible benefits on someone. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's look for such a ‚Äúdeprived‚Äù API.  <a href="http://www.bing.com/maps/">Bing</a> , <a href="https://maps.google.com.ua/">google</a> ?  No, these guys are fine with dragging a card.  Let's see how things are with <a href="https://github.com/openlayers/ol3">OpenLayers 3</a> .  Yes, our ‚Äúpatient‚Äù, we will set up experiments on him. <br><br>  Despite the youth of the ‚Äútest subject‚Äù, the installation did not cause any difficulties, just like in the <a href="https://github.com/AndreyGeonya/ol3">documentation</a> : <br><br><img src="https://habrastorage.org/storage2/8ec/719/035/8ec719035d8c765a5f2161dd4d6d75e1.jpeg"><br><br>  The source code of all html, js and css examples files can be found in the folder ol3 / examples. <br><br><h4>  Outline Algorithm </h4><br>  In fact, everything is quite simple. <br><br>  Preparation for inertial movement: <br><ul><li>  we catch the moment of the start of dragging the card and record the current time; </li><li>  we catch the moment of the end of dragging (the user released the mouse button) and at this moment: <br><ul><li>  measure the duration of the drag (in ms.); </li><li>  measure the distance that was traveled along the X axis and along the Y axis (in pix.); </li><li>  read the speed of dragging the map on the X axis and on the Y axis (in pixels. per ms.): <br><ul><li>  speed = distance / duration. </li></ul></li><li>  we consider the initial pulse along the X axis and along the Y axis: <br><ul><li>  impulse = mass * speed, where mass is just a constant. </li></ul></li></ul></li><li>  call the method that is responsible for the inertial movement of the card at the end of the drag, let's call it inertiaMove. </li></ul><br>  The inertiaMove method is called once a certain period (every 16 ms., For example).  In this method we: <br><ul><li>  we shift the center of the map by a pulse value along the X axis and along the Y axis; </li><li>  reduce the impulse by dividing it by the attenuation coefficient (constant); </li><li>  we check if the impulse has "rolled down" along the X axis and along the Y axis to a certain limit (also constant), if it has "rolled down", we stop the movement. </li></ul><br><img src="https://habrastorage.org/storage2/5a3/9e6/676/5a39e6676eaadcbbb9d515771ea1aed4.png"><br><br>  ‚ÄúEmergency‚Äù stop dragging.  The card must forcibly stop moving in two cases: <br><ul><li>  if the user clicked on the map; </li><li>  if the user has changed the scale of the map. </li></ul><br><h4>  Code </h4><br>  Since OpenLayers 3 is made on the basis of the <a href="https://developers.google.com/closure/library/%3Fhl%3Dru">Closure library</a> , we will write code according to its rules. <br><br>  Looking at the file structure, we will see that in the interactions catalog there are all objects that are responsible for interacting with the map.  Among them is the <a href="">ol.interaction.DragPan</a> object, which is responsible for dragging, we will create and inherit our <a href="">ol.interaction.DragPanInertia</a> from it and implement the inertial motion of the map in it. <br><br>  Also for convenience <a href="">, a</a> polyfill implementation has <a href="">been added</a> for the <a href="http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating">Erik M√∂ller</a> <a href="https://developer.mozilla.org/en-US/docs/DOM/window.requestAnimationFrame">requestAnimationFrame</a> method. <br><br>  As for the forced stopping of the movement of the card, this is done by a very simple subscription to the corresponding events: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventType = ol.BrowserFeature.HAS_TOUCH ? goog.events.EventType.TOUCHEND : goog.events.EventType.MOUSEDOWN; <span class="hljs-comment"><span class="hljs-comment">// mouse down goog.events.listen(this._map.getViewport(), eventType, this.stopInertiaMove, false, this); // zoom changed goog.events.listen(this._map, ol.Object.getChangedEventType(ol.MapProperty.RESOLUTION), this.stopInertiaMove, false, this);</span></span></code> </pre> <br>  In order for the map to start using the objects we have implemented, they must be registered in the <a href="">create.teractions</a> method of the <a href="">ol.Map</a> object. <br><br>  First we hook up our implementation, replacing <br><pre> <code class="javascript hljs">goog.require(<span class="hljs-string"><span class="hljs-string">'ol.interaction.DragPan'</span></span>);</code> </pre>  on <pre> <code class="javascript hljs">goog.require(<span class="hljs-string"><span class="hljs-string">'ol.interaction.DragPanInertia'</span></span>);</code> </pre><br>  And then the string <br><pre> <code class="javascript hljs">interactions.push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ol.interaction.DragPan(ol.interaction.condition.noModifierKeys));</code> </pre>  replace with <pre> <code class="javascript hljs">interactions.push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ol.interaction.DragPanInertia(ol.interaction.condition.noModifierKeys));</code> </pre><br>  As you have probably noticed, the code implemented by us lies <a href="https://github.com/AndreyGeonya/ol3">on github</a> , and, thanks to <a href="http://pages.github.com/">github pages</a> , you can <a href="http://andreygeonya.github.com/inertiaDemo/">see in action</a> an example of a map with inertia when moving.  An example is best viewed in Google Chrome, since it has not been optimized for various browsers and devices, this is not the main purpose of the article.  As for the OpenLayers 3 itself, the library is under active development and is not yet used in ‚Äúcombat‚Äù applications (there are problems when <a href="https://github.com/openlayers/ol3/issues/109">working with touch devices</a> , as well as with the <a href="https://github.com/openlayers/ol3/pull/96">stability of the API itself</a> ).  Nevertheless, we wish developers time, inspiration and good pull requests into a project that is so useful to users. </div><p>Source: <a href="https://habr.com/ru/post/166061/">https://habr.com/ru/post/166061/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166051/index.html">AnnotatedSQL: schema + content provider</a></li>
<li><a href="../166053/index.html">Localization and globalization</a></li>
<li><a href="../166055/index.html">PicUntu: Ubuntu for a mini PC based on Rockchip RK3066</a></li>
<li><a href="../166057/index.html">The first game I just wrote for myself</a></li>
<li><a href="../166059/index.html">PR-manager, as the "steering" ship-company</a></li>
<li><a href="../166063/index.html">At CES 2013, a laptop powered by a 100-watt USB 3.0 data cable was shown</a></li>
<li><a href="../166065/index.html">Several performance tests Sparkov R500 and R1000 from the MCST</a></li>
<li><a href="../166069/index.html">OPPO on Habr√©</a></li>
<li><a href="../166071/index.html">Cloudy future or data storage system in the coming year</a></li>
<li><a href="../166073/index.html">Anatomy of Blogger templates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>