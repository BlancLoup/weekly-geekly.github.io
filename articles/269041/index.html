<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving common problems when building an Xcode project generated by Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes some typical problems that arise when building / running on a device / display in the App Store of the Xcode project for iOS, g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving common problems when building an Xcode project generated by Unity3D</h1><div class="post__text post__text-html js-mediator-article">  This article describes some typical problems that arise when building / running on a device / display in the App Store of the Xcode project for iOS, generated through Unity3D, as well as their causes and solutions.  From personal experience, these problems occur quite often and not just me.  For the most part, the article can help those who are not very familiar with native iOS development. <br><br>  At the time of this writing, Unity3d version 5.1.2f and XCode 7.0.1 were used.  When using Unity3D versions 5.2 and above, the problems listed later in the article will also be repeated.  Some of the problems are related to innovations in iOS 9.0.  Attention under the cut a lot of graphics. <br><a name="habracut"></a><br><h3>  Bitcode </h3><br>  Technology Apple, introduced with the release of iOS 9. It is part of the <a href="https://developer.apple.com/library/watchos/documentation/IDEs/Conceptual/AppDistributionGuide/AppThinning/AppThinning.html">App Thinning</a> technology, used to split the application package into several packages, depending on the architecture of the device.  In order for the application to use Bitcode, it is necessary not only that the application itself be written with Bitcode support, but all third-party libraries must be built using Bicode. <br><br>  If one of the libraries does not support Bitcode, XCode will generate an error at the linking stage, and it will look something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/2cf/024/a19/2cf024a19eb9428b8dfa53ca6151af1a.png"><br><br>  In this case, the library with which the problem arose - GameCenter. <br><br>  You can fix the error in two ways: <br><ul><li>  Understand what's the matter.  The library may be outdated and need to be updated.  After the upgrade, rebuild the Xcode project from Unity. </li><li>  Disable Bitcode in the application settings </li></ul><br>  With the first option, everything is very clear.  The second way is now easier.  To switch off, you need to find the necessary option in the project settings and set its value to NO. <br><br><img src="https://habrastorage.org/files/eb2/3cd/ca4/eb23cdca4fa540d8872c1c9f720bb7cf.png"><br><br><h3>  ipad multitasking </h3><br>  This <a href="">technology is</a> used to split the iPad screen into 2 parts, each of which has a separate application. <br><br>  When developing games, this technology does not make sense, since during the game it is necessary to use the entire screen of the device for maximum user immersion.  In this matter, Apple stands with us: <br><blockquote>  Consider opting out only these categories: <br><ul><li>  Camera-centric apps, where is your primary feature? </li><li>  Full-device apps such as games </li></ul></blockquote><br>  When testing an application and building it on a device, there are no problems with multitasking, errors do not appear.  However, problems may begin when you submit a package to the App Store. <br><br><img src="https://habrastorage.org/files/e69/932/aa0/e69932aa09cf4741a8c84ef4477817e7.png"><br><br>  ITMS-90475 and ITMS-90474 errors occur at the very last moment when the application was sent to the store, when you already think that everything is fine.  It is better to get rid of them in advance, because the assembly and dispatch of a package can take a very long time (in practice, it took up to 20 minutes). <br><br>  The problem is solved quite simply, again, through the project settings: <br><br><img src="https://habrastorage.org/files/c7c/931/87c/c7c93187c04b4b4a809e7ed6ecc13d45.png"><br><br>  It is necessary to tick off ‚ÄúRequires full screen‚Äù. <br><br><h3>  Error when using categories in objective-C </h3><br>  <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html">Categories</a> are a convenient way to extend the functionality of an existing, or even one of the built-in classes in Objective-C without changing the existing class code. <br><br>  When generating a project, Unity itself does not use categories.  Errors related to categories can appear only in the case of using native iOS plug-ins in a project.  This is due to the dynamic nature of Objective-C.  The error itself creeps in at the stage of linking the application.  At the compilation stage, if the source code file contains calls to functions or methods of another class, the undefined symbol is written to the object file at the place where the class is called.  Then, when linking the executable file, the linker inserts an object file with the required method for the undefined symbol location.  If it is built using static libraries (or iOS frameworks), the linker tries to reduce the size of the executable file, not including the entire library, but choosing the necessary parts. <br><br>  Due to the dynamic nature of Objective-C, symbols are defined only for classes, and not defined for methods.  For this reason, if the class that was inserted by the linker for the undefined symbol does not have the desired method, then an exception of type unrecognized selector to instance will occur at runtime. <br><br>  It will look something like this: <br><br><img src="https://habrastorage.org/files/287/724/05b/28772405be2f457b83a31de519028c95.png"><br><br>  In the example from the screenshot, the NSSting class attempted to call the MD5 method, which was not found because it was implemented in a category from a third-party library. <br><br>  This is due to the fact that the supplier of the library has collected it is not quite right, so you can write a letter of support and ask to correct an annoying misunderstanding.  There are cases when the library supplier does not want to correct the defect.  In this case, you can correct the project settings in such a way as to avoid this error. <br><br>  In more detail the problem is painted <a href="https://developer.apple.com/library/mac/qa/qa1490/_index.html">here</a> . <br><br>  You need to add an additional flag linker and rebuild the project.  There are 2 flags that can help in this situation: -all-load and -ObjC.  You should first try -all-load, and, if it doesn‚Äôt help, -ObjC (in practice there was a case when the rest of the native project stopped gathering when using -ObjC). <br><br>  Flags are added in settings, in the Build Settings tab of the Xcode project: <br><br><img src="https://habrastorage.org/files/bf3/08a/9d0/bf308a9d0cf64c969e08f34aeafc0b52.png"><br><br><h3>  Error sending request to any URL </h3><br>  The situation looks like this: in Unity Editor or on Android requests go without problems, the answer is correct, everything is fine.  Even all is well on a device with iOS &lt;9.0.  On iOS 9.0, the answer does not come or a connection error.  In this case, it will not necessarily be exception, if the draft provides for a case when the response from the server did not come or came with an error.  In this case, the problem comes from <a href="https://developer.apple.com/library/prerelease/ios/technotes/App-Transport-Security-Technote/">App Transport Security</a> . <br><br>  The problem has 2 solutions: <br><ul><li>  The documentation lists the requirements your servers must meet in order for requests to pass without problems.  + Apple insists on using https </li><li>  Add URL to application exclusion list </li></ul><br>  Project exceptions are set in the .plist file with the project's Xcode settings.  You need to know what requirements the domain does not meet in order to correctly make an exception using the values ‚Äã‚Äãspecified in the documentation.  You can edit the .plist file as the source code, you can add the necessary fields using the Xcode editor as you like. <br><br>  An example of an exception in the form of source code (a piece of code is added to an existing Info.plist file): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSAppTransportSecurity<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSExceptionDomains<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>your_domain.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSIncludesSubdomains<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSExceptionRequiresForwardSecrecy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">false</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSExceptionAllowsInsecureHTTPLoads<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  After these manipulations, the request passes without problems, and earlier versions of iOS ignore the NSAppTransportSecurity keys in the project‚Äôs .plist. <br><br><h3>  Missing arm64 architecture </h3><br>  The error known as itms-90533.  Appears when trying to send a packet to the stop that does not contain the arm64 architecture. <br><br><img src="https://habrastorage.org/files/ec1/ebc/13c/ec1ebc13cf194f4fbe47d6437066375a.jpeg"><br><br>  Make sure that when building the project in Unity, in the Project Settings -&gt; Player for iOS section, the IL2CPP was used as the Scripting Backend (the second mono2x option is not able to arm64). <br><br><img src="https://habrastorage.org/files/899/21f/042/89921f0427434dfdbdb0435e8fd0d8af.png"><br><br>  If mono2x was used, the Xcode project needs to be exchanged. <br><br><h3>  Problem with trampolines </h3><br>  An error occurs at the application runtime, the application crashes and something like ‚ÄúRan out of trampolines of type 0/1/2‚Äù appears in the log.  This error is also specific to iOS.  Trampolines is a thing that is used inside Mono.  You can learn more about them <a href="http://www.mono-project.com/docs/advanced/runtime/docs/trampolines/">here</a> and <a href="http://www.kurokatta.org/grumble/2012/02/out-of-trampolines">here</a> . <br><br>  In short, trampolines are small pieces of assembly code written to perform various tasks in mono runtime.  They are generated at runtime using the native macro used by the JIT compiler.  You can consider trampolines as a tool to call JIT-code from runtime and vice versa.  For example, JIT code can be considered generic methods using interfaces in C # for Unity. <br><br>  The problems begin with the fact that iOS does not support JIT, only AOT.  This is possible for several reasons: iOS does not allow the use of memory pages that are both writable and executable, Apple may prohibit JIT compilation, as a result of the application being prohibited from executing code that was not in the build at the time it was sent to the review. <br><br>  In total, there are 3 types of trampolines in mono, whose alleged roles are as follows: <br><br><ul><li>  type 0 - generic methods </li><li>  type 1 - recursive generics </li><li>  type 2 - interfaces </li></ul><br>  For iOS, trampolines are set in advance, and if your project tries to use them more than is created at the time of launch, the application will crash with a ran out of trampolines error.  By default, the application creates 1024 trampoline type 0, 1024 type 1, and 128 type 2. <br><br>  To solve this error, you just need to increase the number of trampolines you need for your project type by more.  The number of trampolines required in a project can only be determined experimentally by gradually increasing this value.  This is done using the AOT Compilation Options in Unity (Project Settings -&gt; Player). <br><br>  You can increase the number of trampolines using the following parameters: <br><br><ul><li>  type 0 - ntrampolines = xxxx </li><li>  type 1 - nrgctx-trampolines = xxxx </li><li>  type 2 - nimt-trampolines = xxxx </li></ul><br><img src="https://habrastorage.org/files/1f6/222/3c3/1f62223c3e6f464eaa2b50a926bdf28c.png"><br><br>  It is worth paying attention to the fact that the project may lack several types of trampoline.  In this case, the keys must be specified with ";"  no spaces, otherwise the keys will be ignored. </div><p>Source: <a href="https://habr.com/ru/post/269041/">https://habr.com/ru/post/269041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269027/index.html">Comparison of MaxMind and Sypex bases</a></li>
<li><a href="../269029/index.html">Hibernate Developer Documentation - Chapter IV. Batch processing</a></li>
<li><a href="../269035/index.html">Volkswagen TDD</a></li>
<li><a href="../269037/index.html">Program modification and what is better to change: executable code or AST program?</a></li>
<li><a href="../269039/index.html">PHP Digest 72 - interesting news, materials and tools (October 5 - 18, 2015)</a></li>
<li><a href="../269045/index.html">Phone numbers in email clients</a></li>
<li><a href="../269049/index.html">Serge - the solution for continuous localization from Evernote</a></li>
<li><a href="../269055/index.html">Pulling information from the URL, in the style of Slack and Twitter</a></li>
<li><a href="../269057/index.html">Very handy abstract adapter for RecyclerView do it yourself</a></li>
<li><a href="../269061/index.html">Steam Protocol v2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>