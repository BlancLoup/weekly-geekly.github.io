<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hyper-V Extensible Switch in Windows Server 2012</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hyper-V Extensible Switch, a key component of Hyper-V in Windows Server 2012 , is an extensible, managed second-level switch. Extensibility means the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hyper-V Extensible Switch in Windows Server 2012</h1><div class="post__text post__text-html js-mediator-article">  Hyper-V Extensible Switch, a key component of Hyper-V in <a href="http://technet.microsoft.com/ru-ru/evalcenter/hh670538.aspx%3Fwt.mc_id%3DTEC_108_1_5">Windows Server 2012</a> , is an extensible, managed second-level switch.  Extensibility means the ability of developers to create modules embedded in Hyper-V and modifying / expanding the regular functionality of analysis, filtering and forwarding packages.  Manageability implies the presence of a whole set of settings available to the administrator through PowerShell or the Hyper-V Manager console, providing the required level of isolation, security, and monitoring of running virtual machines (VM).  In one of the previous posts I described the implementation of the <a href="http://habrahabr.ru/company/microsoft/blog/148734/">Private VLAN</a> technology <a href="http://habrahabr.ru/company/microsoft/blog/148734/">(PVLAN)</a> in the Hyper-V Extensible Switch.  Today we look at a number of additional features. <a name="habracut"></a><br><br>  In terms of terminology, the concept of Hyper-V Switch (or Virtual Switch) has replaced the concept of a virtual network (Virtual Network) in Windows Server 2008/2008 R2.  If earlier, to ensure the interaction of the VM with each other or with the outside world, you created a virtual network of one of three types - External, Internal, Private - then you are creating a Virtual Switch, which can be of the same three types and has all the features described below .  Moreover, these capabilities are defined for a specific port of a virtual switch (see fig.), And the port, in turn, is identified by the name of the virtual machine that is connected to this port, more precisely, by the name of the virtual network adapter, since there may be several adapters in the VM. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b54/1d9/04e/b541d904ed1e0684c266cbf217d82881.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, I considered the Hyper-V Extensible Switch settings into three categories: security and isolation, monitoring, and fault tolerance. <br><br><h1>  Safety and isolation </h1><br>  In the Hyper-V Manager console, a new subsection of Advanced Features has appeared in the properties of the virtual network adapter.  The first three settings in this window are directly related to security and isolation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2f/5c9/ff6/b2f5c9ff6e0002f720d35920af3144db.png" alt="image"><br><br>  <b>MAC address spoofing</b> <br><br>  By default, Hyper-V does not allow MAC address spoofing.  In other words, if the VM tries to replace the sender's MAC address in the outgoing packets, that is, its MAC address associated with the virtual network adapter of this machine with another MAC address, Hyper-V blocks such packets.  Installing the top checkbox, respectively, allows spoofing.  As always, everything that can be done in the Hyper-V Manager console and even more can be done in PowerShell.  For the VM named SRV4 shown in the figure, enabling MAC spoofing is implemented by the following command: <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-VMNetworkAdapter -VMName srv4 -MacAddressSpoofing On</code> </pre> <br><br>  <b>DHCP security (DHCP Guard)</b> <br><br>  This setting must be used to block an unauthorized DHCP server running inside the VM.  Technically, when installing this checkbox, Hyper-V blocks DHCP packets to acknowledge from this VM and prevents DHCP clients from getting IP settings from this VM. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-VMNetworkAdapter -VMName srv4 -DhcpGuard On</code> </pre> <br><br>  <b>Router Guard</b> <br><br>  By analogy with DHCP Guard, the installation of this checkbox blocks redirection and router advertisements (redirection and router advertisement) from this VM.  Thus, the VM will not be able to affect the routing tables of other computers on the network. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-VMNetworkAdapter -VMName srv4 -RouterGuard On</code> </pre> <br><br>  <b>Port Access Control List (Port ACL)</b> <br><br>  For each Hyper-V Extensible Switch port, you can configure one or more Access Control Lists (ACLs) to specify additional security rules and VM isolation level.  All ACL settings are set only via PowerShell; in the Hyper-V Manager console, list management is not available.  You can view the current status of the lists with the command: <br><br><pre> <code class="javascript hljs">Get-VMNetworkAdapterAcl -VMName srv4</code> </pre> <br>  Adding and deleting a list is done by the <i>Add-VMNetworkAdapterAcl</i> and <i>Remove-VMNetworkAdapterAcl commands,</i> respectively.  The syntax of both commands is the same.  For each ACL, you must specify: <br><ul><li>  Local or remote IP address or MAC address </li><li>  Direction: inbound traffic, outbound traffic, both directions (Inbound, Outbound, Both) </li><li>  Actually action: allow, prohibit, measure (Allow, Deny, Meter) </li></ul><br>  By default, no ACLs are set, and thus all traffic is allowed.  The example below prohibits for the VM with the name SRV4 any traffic from / to the IP address 192.168.1.143: <br><br><pre> <code class="javascript hljs">Add-VMNetworkAdapterAcl -VMName srv4 -RemoteIPAddress <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.143</span></span> -Direction Both -Action Deny</code> </pre> <br>  With regard to IP addresses, you can specify not only a specific address, but also a subnet: <br><br><pre> <code class="javascript hljs">Add-VMNetworkAdapterAcl -VMName srv4 -RemoteIPAddress <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> -Direction Both -Action Deny</code> </pre> <br>  If ACLs are set for both the subnet and a specific address from that subnet, then the ACL for the address has higher priority, that is, the ‚Äúmore specific‚Äù rule has more power.  For example, the following shows the result of the <i>Get-VMNetworkAdapterAcl command</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/290/6d7/b7e/2906d7b7e38b97005ec659f949500e59.png" alt="image"><br><br>  As you can see, the ban on the subnet 192.168.1.0/24 is set, and traffic is allowed for the address 192.168.1.143.  As a result, IP traffic is possible only on one 143rd address from the entire subnet. <br><br>  The Meter allows you to measure the amount of incoming and / or outgoing traffic for a specified IP or MAC address since the creation of the corresponding ACL, for example, the following command enables the measurement of incoming traffic from 192.168.1.143: <br><br><pre> <code class="javascript hljs">Add-VMNetworkAdapterAcl -VMName srv4 -RemoteIPAddress <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.143</span></span> -Direction Inbound -Action Meter</code> </pre> <br>  The result can be seen using the same <i>Get-VMNetworkAdapterAcl</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/ba4/605/f0cba4605903713199ef725e2156edc3.png" alt="image"><br><br><h1>  Monitoring </h1><br>  Traffic monitoring can be implemented through the port mirroring mechanism.  To configure mirroring, you need to specify the source of information; in the Hyper-V Manager, this is done here: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4bd/92f/bfd/4bd92fbfddf74cde3cf61597f277953e.png" alt="image"><br><br>  And then in the settings of the necessary VM, which will monitor the traffic, select the value Destination in the same field.  In PowerShell, this is done with the parameters of the <i>Set-VMNetworkAdapter command</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-VMNetworkAdapter -VMName srv4 -PortMirroring Destination</code> </pre> <br>  After that, all traffic, incoming and outgoing, to the VM port of the SRV3 is copied and redirected to the VM port of the SRV4.  You only need to install the necessary traffic analysis software in SRV4.  An important condition is that both VMs must be connected to the same virtual switch. <br><br><h1>  fault tolerance </h1><br>  The last option in the advanced properties of the virtual network adapter relates to fault tolerance, namely to the network adapter grouping technology (NIC Teaming). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3d/627/76a/d3d62776a3ab43e094fdadec35dce71e.png" alt="image"><br><br>  NIC Teaming is a full-featured Windows Server 2012 feature that deserves, generally speaking, a separate post.  This feature allows you to combine several physical network adapters into a group and, on the one hand, to ensure the fault tolerance of network traffic when any network card fails, on the other hand, to aggregate the bandwidth of the adapters included in the group. <br><br>  For various reasons, you may not want to enable timing on the host machine.  However, if the host has more than one physical network adapter, you can use NIC Teaming inside the guest OS.  Imagine that the host has two network cards.  If in some VM there are two virtual network adapters, these adapters are connected via two virtual external switches to two physical cards, respectively, and Windows Server 2012 is installed inside the VM, then you can configure NIC Teaming inside the guest OS.  And such a VM can take advantage of timing, and fault tolerance, and increased throughput.  But in order for Hyper-V to understand that when a single physical adapter fails, the traffic for this VM needs to be transferred to another physical adapter, you just need to install the mentioned checkbox in the properties of each virtual NIC included in the timing.  In PowerShell, a similar setting is made as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Set</span></span>-VMNetworkAdapter -VMName srv4 -AllowTeaming On</code> </pre> <br>  All the settings discussed above can be set for running VMs and take effect immediately.  Of course, this is not all the functionality of the Hyper-V Extensible Switch.  After reviewing the list of <a href="http://technet.microsoft.com/en-us/library/hh848559.aspx">cmdlets available in Hyper-V</a> , you can find many more interesting things. <br><br>  In conclusion, I would like to note that on November 26, a free <a href="https://msevents.microsoft.com/CUI/EventDetail.aspx%3FEventID%3D1032537501%26Culture%3Dru-RU%26community%3D0">IT Camp</a> series on Windows Server 2012 and System Center 2012 will be held in Moscow. My colleagues, Georgy Hajiyev and Simon Perriman (Redmond) will conduct the seminar.  You can look at the products alive and ask any questions. <br><br>  Hope the material was helpful. <br>  Thank! </div><p>Source: <a href="https://habr.com/ru/post/159391/">https://habr.com/ru/post/159391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159373/index.html">Solitaire.exe offline</a></li>
<li><a href="../159377/index.html">Monkey programming language</a></li>
<li><a href="../159381/index.html">A young, dynamic company ...</a></li>
<li><a href="../159387/index.html">uLogin a year later. Social Authorization Facts</a></li>
<li><a href="../159389/index.html">We write our std :: function (boost :: function)</a></li>
<li><a href="../159393/index.html">Faxes in Freeswitch without fax</a></li>
<li><a href="../159395/index.html">Reader Pocketbook BASIC 613: first impressions</a></li>
<li><a href="../159401/index.html">Convenient interface Habra?</a></li>
<li><a href="../159403/index.html">The final version of Firefox for Android now supports devices with ARMv6 architecture</a></li>
<li><a href="../159405/index.html">Disposal of printed circuit boards in hot water</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>