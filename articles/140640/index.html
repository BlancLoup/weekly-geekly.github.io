<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Casket with music lock</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 What only locks have come up with! And with a cunning key, and a combination of numbers, and with the recognition of body parts. Howe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Casket with music lock</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br><img src="https://habrastorage.org/storage2/b3c/2e5/4db/b3c2e54db179ae50b83de55a67dedfea.jpg" align="left"><br><br>  What only locks have come up with!  And with a cunning key, and a combination of numbers, and with the recognition of body parts.  However, I wanted to make a lock, which I have not yet met.  Since I am fond of playing the piano, I did not have to go far for the idea: it was decided to make a box that opens only after ‚Äúhearing‚Äù a familiar melody. <br><br>  In this post I would like to tell you about the algorithm for recognizing the melody, about the control scheme and about the process of creating the box. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  What happened </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ae5B43IOb-Q%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhjEXjpP47qQtvMDxtYCLYps4kjVsA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Melody recognition </h4><br>  As you know, what we perceive as sound can be considered as air pushing into the eardrum.  Air pressed - nerve registered.  What we perceive as a note can be considered as an impulse with a constant period.  In other words, if this nerve is tickled 130 times per second, we will ‚Äúhear‚Äù the ‚Äúbefore‚Äù note. <br>  A device that recognizes notes, tries to understand how many times a second a microphone tickled him and what frequency it turned out (and, therefore, a note).  The transition from frequency to note is a simple thing, there is a <a href="http://en.wikipedia.org/wiki/Piano_key_frequencies">table ‚Äúfrequency ‚Üí note‚Äù</a> . <br><br>  There are several different algorithms that convert microphone data into frequencies.  The most famous is <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25A4%25D1%2583%25D1%2580%25D1%258C%25D0%25B5">the Fourier transform</a> .  The principle of operation is as follows: at the entrance, with what force, the air was pushed on the microphone at each moment of time.  At the output - how much what frequency was contained.  His work is best explained by a picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/203/ccb/095/203ccb095b88916d74381604aa8aef08.png"></div><br><br>  So it would be possible to realize the recognition of notes.  At each time point, determine which frequency is loudest.  If it coincides with the expected, go to the recognition of the next note or open the lock, if the melody is over. <br><br>  However, we will go the other way.  It is not necessary for us to know exactly which notes play.  We just need to find out if the note we are waiting for is playing at the moment.  <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%2593%25D1%2591%25D1%2580%25D1%2586%25D0%25B5%25D0%25BB%25D1%258F">G√∂rtsel's algorithm</a> comes to the rescue.  This algorithm is used in telephony when it is necessary to determine the tone.  The essence is simple: the algorithm is given the desired frequency and data from the microphone, and he answers what the ‚Äúloudness‚Äù of the desired frequency is. <br><br>  You can look at the implementation of the algorithm in the <a href="">NoteDetector.cpp</a> file. <br><br><h4>  Component selection </h4><br>  I stopped at pretty standard components.  That's what helped me: <br><br>  <b>ATMega328P</b> with a crystal at 16Mhz - the "brain" of the device.  The choice fell on him, since it was too easy to work with him. <br><br>  <b>Electret microphone</b> with an <b>OPA344</b> amplifier - these two devices were sold as a kit on a single board on <a href="http://www.sparkfun.com/products/9964">the Sparkfun website</a> .  Data from this device can be read directly from the analog input of the microcontroller. <br><br> <a href="http://www.spektrumrc.com/Products/Default.aspx%3FProdID%3Dspmas2000l"><img src="https://habrastorage.org/storage2/93e/210/606/93e21060680e605f6fd8b73e2cb523d8.jpeg" align="left"></a>  <b>Servo Spektrum SPMAS2000L</b> - this servo opens and closes the lock.  I was very glad I found such a detail.  Servo works from 3.3V and supports the usual protocol.  This is a linear actuator, that is, instead of a rotating head, the actuator has a slider that moves about an inch to the right and left.  On the sides - ears for attachment. <br>  This motor is usually used in the world of aeromodelling.  As far as I understand, they regulate the deviations of the ailerons.  You can read about it on <a href="http://www.spektrumrc.com/Products/Default.aspx%3FProdID%3Dspmas2000l">the manufacturer's website</a> . <br><br>  <b>The TPS2020</b> is an excellent switch with very low power consumption when it is turned off (10 ŒºA).  It will control the power of the servo. <br><br>  <b>The LM2936Z</b> regulator is a 3.3V linear regulator with a small current at the operating point (‚â§ 15 ŒºA).  What you need for our device, which will be powered by a battery. <br><br>  <b>The MAX1555 charger</b> is a chip that controls battery charging and flashes a light when the battery is full. <br><br><h4>  Scheme </h4><br>  There is nothing especially difficult in the device scheme.  <a href="http://code.google.com/p/music-lock/source/browse/trunk/">Here</a> you can find the complete scheme.  And here is a simplified diagram that explains which components are involved in: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/ada/85c/c20/ada85cc209336646445d7ab63414f069.png"></div><br><br>  Quite an interesting thing turned out to be to arrange the board so that it fit into a small box.  Since I decided to do everything myself, at home, options with a multilayer board did not fit.  So I had to invent a fake multilayer board: the device consists of two levels, which are connected as shields for the Arduino.  It turned out something like this: <br><br><img src="https://habrastorage.org/storage2/837/28c/59f/83728c59f158ac657ecda0f017e36282.png"><br><br>  Blue connections are those that will be on the board itself.  Red - those that will be added later, either by shield connectors, or by wires on top of the board. <br><br><h4>  Creating a board </h4><br>  I decided to use the photoresistive creation method.  I <a href="http://habrahabr.ru/post/134834/">described it in Habr√©</a> , so I‚Äôll just give you a couple of pictures. <br><br>  We print the scheme on a transparent film and cut out the basis for the board: <br><img src="https://habrastorage.org/storage2/e34/2ea/7d4/e342ea7d47f0ccddf828e2554c95a17a.jpg"><br><br>  Fee before tinning and making holes: <br><img src="https://habrastorage.org/storage2/b0f/6ff/424/b0f6ff4244473db75dff1c80c6f319a3.jpg"><br><br>  Fees on one side: <br><img src="https://habrastorage.org/storage2/eeb/943/7a3/eeb9437a3e597e800c3fce90b4405189.jpg"><br><br>  Fees on the other hand: <br><img src="https://habrastorage.org/storage2/60f/545/9c4/60f5459c47664dba69659b96fd9435dc.jpg"><br><br>  Fees collected: <br><img src="https://habrastorage.org/storage2/476/352/10d/47635210d08a13f68c9b8cf426feb41e.jpg"><br><br>  On the other hand: <br><img src="https://habrastorage.org/storage2/74b/9c3/e5a/74b9c3e5a936a9cf1550bc6c7156d943.jpg"><br><br><h4>  Making a box </h4><br>  The box consists of the box itself and the walls surrounding the circuit and motor.  I decided to buy an unprocessed box to cover it with paint and varnish myself.  I ordered the walls and auxiliary parts on the <a href="http://www.ponoko.com/">Ponoko</a> website: they can send a drawing to SVG, and they will cut it out with a laser on a thin plywood.  Drawing can be found <a href="">here</a> .  Here is what this drawing and its implementation looks like: <br><img src="https://habrastorage.org/storage2/7c8/80a/97e/7c880a97e64b558776e658a416503f5d.png"><br><br>  Plus three weeks: <br><img src="https://habrastorage.org/storage2/95f/aaa/360/95faaa36036e8eddb55fafb0b64e7eca.jpg"><br><br>  After these parts were integrated into the box, it turned out like this: <br><img src="https://habrastorage.org/storage2/b6b/f63/c83/b6bf63c834066020af1c0b95987ea552.jpg"><br><br>  Now you can paint the box and varnish it.  I applied two coats of paint and two coats of lacquer to last for ages.  Perhaps there is nothing particularly difficult in this process.  Unless it is necessary to sand the wood very high quality: the places where the shalturil are clearly visible.  Here's what happened: <br><img src="https://habrastorage.org/storage2/6d0/374/176/6d0374176f70b6443d37ed703f5164ff.jpg"><br><br>  The lock mechanism looks like this: <br><img src="https://habrastorage.org/storage2/3bd/253/d84/3bd253d84de7d98f2092df1b0daac274.jpg"><br><br><h4>  Result </h4><br>  As a result, the scheme perfectly fit into the box: <br><img src="https://habrastorage.org/storage2/9c2/6a7/2e6/9c26a72e6038aa356e5c357937f7601d.jpg"><br><br>  I took the craft to several of my acquaintances: the correct melody is recognized on different pianos: on electronic pianos, and on ordinary pianos, and on the piano.  Recognition accuracy: half tone. <br><br>  The source code of the controller, the circuit and the drawing of the board can be found on <a href="http://code.google.com/p/music-lock/source/browse/trunk/">Google Code</a> .  I will be happy to answer any questions, listen to criticism and suggestions. <br><br><img src="https://habrastorage.org/storage2/5a5/26b/6a2/5a526b6a2c05df3aa7e871f35817b0a9.jpg" align="left"></div><p>Source: <a href="https://habr.com/ru/post/140640/">https://habr.com/ru/post/140640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140634/index.html">Sony patents new fingerprint sensor for smartphone display</a></li>
<li><a href="../140635/index.html">Android: reader with synchronization between devices</a></li>
<li><a href="../140636/index.html">How to tell your game about an asshole</a></li>
<li><a href="../140638/index.html">DirectX Debugging - Easy.</a></li>
<li><a href="../140639/index.html">Game Way: play with a stranger</a></li>
<li><a href="../140641/index.html">Part number 5. Biochemistry on folding. One fundamental problem</a></li>
<li><a href="../140643/index.html">Installation of userscripts in Opera in general cases and for secure pages (https)</a></li>
<li><a href="../140644/index.html">Using mental maps for teaching with the example of Cisco CCNA Exploration</a></li>
<li><a href="../140645/index.html">Asterisk + FreePBX + 7937G</a></li>
<li><a href="../140647/index.html">XBMC 11 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>