<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing for Apple Watch something harder Hello, world</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Much time has passed since the release of Apple's new product - the Apple Watch. Watch out for the final version of the operating system for them - Wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing for Apple Watch something harder Hello, world</h1><div class="post__text post__text-html js-mediator-article">  Much time has passed since the release of Apple's new product - the Apple Watch.  Watch out for the final version of the operating system for them - Watch OS 2.0.  And on Habr√©, there is still no more or less detailed article on how to write something more complicated than ‚ÄúHello, world!‚Äù For the Apple Watch.  And in this article we will try to fix it and write an application from several screens with a list, data loading and interaction with the main application. <br><a name="habracut"></a><br>  In those articles that have already written about the Apple Watch, the principle of the work has already been described in detail, charts were drawn, advantages and disadvantages were sorted out.  Therefore, I suggest not to dwell on this in detail, but to get to work right away! <br>  The only thing worth mentioning is that the application runs on the phone, and the clock simply displays the user interface.  In general, all this is explained by the picture from the official documentation.  I think those who are interested in developing for Apple Watch have already seen it many times :) <br><img src="https://habrastorage.org/files/653/43c/eb3/65343ceb3297490aa9f0237e7d2797b9.png"><br><br>  And now you can start, and the first thing in our application, we need to create an extension to work with Watch Watch Kit Extension.  It makes it very simple: in the list of Targets, click on the plus sign, find the WatchKit App there.  On the next screen, we check that our main application is there, the correct BundleID is written and click Finish. <br><img src="https://habrastorage.org/files/40e/f3c/ca1/40ef3cca19394e1998ea8e9bffa7c7ed.png"><br><br>  After these manipulations, two new Targets will appear in the project: an extension for our main application and an application for watches. <br>  Also, two folders have been added in the project tree (for the extension and for the application, respectively) and in the folder for the application there is the Interface.storyboard familiar to us. <br><img src="https://habrastorage.org/files/092/abd/f99/092abdf99eb6422db277d77c2d504792.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are controllers familiar to us, which are now inheritors of the WKInterfaceController class, there are UI components (which, unfortunately, are very few) and there are transitions between the Segue screens. <br><img src="https://habrastorage.org/files/02c/0e1/2a2/02c0e12a2ce4434fb80f0a9e7095a42b.png"><br><br>  The main point to which you should pay attention - if there was one entry (Initital controller) on iOS, now there are three of them at once - the initial screen, notifications and ‚Äúglance‚Äù (another one of the notification options). <br>  On our main controller, we add a button (drag it to the right-bottom from the Object Library. This is where the next feature of the clock comes in - the developers have maximally simplified the interface and components can be placed only one after another, from top to bottom. If you need to place components in a line, then for You have provided for the Group component, which is a container of other components and which has a parameter Layout (either vertical or horizontal). <br>  In addition, the component inside the parent container can be aligned vertically and horizontally, as well as giving it an absolute and relative size. <br><img src="https://habrastorage.org/files/5cd/779/bd3/5cd779bd39254c9f976dd542dc6684cd.png"><br><br>  In general, a simple concept that, if you think about it, allows you to cover most of the needs. <br>  Add a couple of buttons to the main screen and switch from one of them to the next screen, where we will try to make a list.  Transitions between screens occur in the same way as in iOS through segue.  But there is one interesting feature: on the Connections Inspector tab for the controller there is the Next page property.  By connecting it to another controller, you can make transitions between them by brushing it like on a Page View Controller. <br>  On the next screen, we will create a list of data downloaded over the network.  The clock has no analogue UITableViewController, because  everything is inherited from the only WKInterfaceController, so we simply transfer the Table component to our screen and associate it with the controller's outlet property.  By default, the component creates a prototype of the TableRow row. <br><img src="https://habrastorage.org/files/d45/4b0/470/d454b047030f4527b65026c389b6212b.png"><br><br>  Now let's take a closer look at the inside of the controller.  By default, three methods are created there.  Consider them in more detail. <br>  The screen initialization method, here with the help of the context parameter, data from other screens are transferred, here it is necessary to initialize the data and load it. <br><pre><code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)awakeWithContext:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)context { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> awakeWithContext:context]; }</code> </pre> <br>  Method that is called after displaying the screen.  Here you can run animations, make simple data updates. <br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)willActivate { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> willActivate]; }</code> </pre><br>  The method of unloading the screen, where you need to clean everything up, save and remove. <br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)didDeactivate { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> didDeactivate]; }</code> </pre><br>  Now in the awakeWithContext method we will try to fill our list with data.  To do this, you need to write the class of the list cell, and you must inherit it from the usual NSObject.  I have it looks like this: <br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@interface</span></span> <span class="hljs-type"><span class="hljs-type">WKRow</span></span> : <span class="hljs-type"><span class="hljs-type">NSObject</span></span> <span class="hljs-meta"><span class="hljs-meta">@property</span></span> (weak, nonatomic) <span class="hljs-type"><span class="hljs-type">IBOutlet</span></span> <span class="hljs-type"><span class="hljs-type">WKInterfaceLabel</span></span> *rowTitle; <span class="hljs-meta"><span class="hljs-meta">@end</span></span></code> </pre><br>  And in InterfaceBuilder, we specify it as a cell class and associate properties with UI components.  Also, the cell in InterfaceBuilder needs to specify the Identifier by which it will be created. <br>  After that, the code for adding data to the table will look like this: <br><pre> <code class="hljs pgsql"> [self.<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> setNumberOfRows:items.count withRowType:@"itemRow"]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Item *itm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items){ WKRow *<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = [self.<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> rowControllerAtIndex:i]; [<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>.rowTitle setText:itm.title]; }</code> </pre><br>  setNumberOfRows creates in the table the number of cells we need with the necessary identifier, which we specified in IB.  And then we can access each cell using the rowControllerAtIndex method, which will return our cell controller class to us. <br>  There used to be such a bug that when you frequently called setNumberOfRows, the clock interface started to behave very strangely (slow down and glitch).  But in the latest version it was corrected, at least I could not repeat it myself. <br><br>  Now, the question arises - can we take the data that is already loaded into our main application, and which we do not want to load again into the Extension? <br>  And here you can tell about another basic concept - the interaction of WatchKit applications with the parent application iOS.  The point is this: we send the ‚Äúrequest‚Äù to the parent application, it gets the data from the database, or loads it from the network, and returns it to us. <br>  It all works with the controller's openParentApplication method.  As a parameter, we transfer the dictionary with the action parameter and in the reply we indicate the block in which we process the answer. <br><pre> <code class="hljs objectivec"> [WBridgeInterfaceController openParentApplication:@{ <span class="hljs-string"><span class="hljs-string">@"action"</span></span>:<span class="hljs-string"><span class="hljs-string">@"remind"</span></span> } reply:^(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *replyInfo, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error){ <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"Result: %@"</span></span>, [replyInfo objectForKey:<span class="hljs-string"><span class="hljs-string">@"result"</span></span>]); }];</code> </pre><br>  In the parent application, in the application delegate, we override the handleWatchKitExtension method.  In it we get the dictionary sent from the clock, after processing which, we can return the result to the processing unit in the same way using the dictionary. <br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application handleWatchKitExtensionRequest:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)userInfo reply:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(^)(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *replyInfo))reply{ [BridgeReminder setRemind]; reply(@{ <span class="hljs-string"><span class="hljs-string">@"result"</span></span>: <span class="hljs-string"><span class="hljs-string">@"ok"</span></span> }); }</code> </pre><br>  After loading and displaying data, we will try to process the tap on the line of the list and display the next screen, for example, with detailed information about the object. <br>  The easiest way to open the screen when tapping into a line is to open the Storyboard and in the Connection Inspector to associate the selection item on the line component with the controller to which you want to go. <br>  Next, in the Attribute Inspector, we specify an Identifier with him so that we can refer to the transition when triggered and transfer the data. <br>  In the controller itself, we override the contextForSegueWithIdentifier method, which is triggered by the segue and in it, checking by the identifier that this is the transition we need, returning a pointer to the data to be passed to the next screen.  For example: <br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)contextForSegueWithIdentifier:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)segueIdentifier inTable:(<span class="hljs-built_in"><span class="hljs-built_in">WKInterfaceTable</span></span> *)table rowIndex:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)rowIndex{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([segueIdentifier isEqualToString:<span class="hljs-string"><span class="hljs-string">@"openCard"</span></span>]){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [items objectAtIndex:rowIndex]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; }</code> </pre><br>  In the next screen controller, in the awakeWithContext method already familiar to us, we can get and use this data as we like, for example, display :) <br><pre> <code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)awakeWithContext:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)context { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> awakeWithContext:context]; Item *b = context; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.itemTitle setText: b.title]; }</code> </pre><br>  In the process of writing the article, I noticed such a strange ‚Äúfeature‚Äù of Xcode - if you write a Segue identifier with capital letters, for example, ‚ÄúshowInfo‚Äù, you cannot catch it using the contextForSegueWithIdentifier method, since  such an identifier will not be saved and the transition will have the name generated by the IDE itself. <br>  Another of the features of the development, for the first time I had to face the fact that some pods are not intended for use in extensions and begin to swear during assembly.  For example, AFNetworking wrote that he doesn‚Äôt know what [UIApplication sharedApplication] is, because  In extensions this class is not available. <br>  Everything is solved very simply - add the AF_APP_EXTENSIONS = 1 parameter to the assembly macros. <br><img src="https://habrastorage.org/files/3ed/13a/f4c/3ed13af4cdc24279b5775296843cf425.png"><br><br>  Each pod of the parameter name can have its own and is usually either registered in the documentation, or it can be before the line on which the compiler swears when building. <br><br>  On this, I suggest to stop and try to write your first application for Apple Watch.  And in the next part I will explain in more detail how the notifications and the Glance screen work. </div><p>Source: <a href="https://habr.com/ru/post/262075/">https://habr.com/ru/post/262075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262065/index.html">Combining offices in 3CX (Part 2. Use Session Boarder Controller)</a></li>
<li><a href="../262067/index.html">Plot chat, or how we won first place on wth.by</a></li>
<li><a href="../262069/index.html">RabbitMQ Spring tutorial</a></li>
<li><a href="../262071/index.html">How to correctly select and buy Backup Exec 15</a></li>
<li><a href="../262073/index.html">Horizontal scaling of database servers for OLTP systems, or what is on the market</a></li>
<li><a href="../262077/index.html">Digest of grocery design, June 2015</a></li>
<li><a href="../262079/index.html">Visualization of static and dynamic networks on R, part 1</a></li>
<li><a href="../262081/index.html">My encryption algorithm</a></li>
<li><a href="../262083/index.html">Wallix vs balabit. Comparison of admin control software [rdp]</a></li>
<li><a href="../262085/index.html">We are looking for speakers! AndroidDevs Meetup 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>