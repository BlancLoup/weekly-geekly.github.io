<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data-Driven MS-Test Tests for Unit and Acceptance Testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would immediately like to emphasize the fact that the world of unit tests and the world of acceptance tests through the user interface are very diff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data-Driven MS-Test Tests for Unit and Acceptance Testing</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/256/734/927/2567349277b1c1f5ce36cafabcfbd482.png" align="right">  I would immediately like to emphasize the fact that the world of unit tests and the world of acceptance tests through the user interface are very different worlds: with their own laws, different capabilities and limitations.  And if the world of unit tests works to cover each part of the application separately and in isolation, tests through the user interface is an emulation of the user's work with the system, mostly by pressing buttons and typing, which eventually merge into larger business scenarios . <br><br>  It rarely happens that even if the tool provides very good opportunities for unit tests, then these possibilities turn out to be practically inapplicable for UI tests. <br><br>  It happened in my practice when I decided to use data-driven tests in the Ms-Test framework.  In this article I will describe in more detail the problem and my solution, for which I still do not understand - I need to be proud or ashamed. <br><a name="habracut"></a><br><h4>  Data-driven approach in the world of unit tests </h4><br>  Suppose we have an int method ConvertToNumber (string input), which accepts a string with a number and returns the same number, only in an integer type. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let us write one positive test, ( <a href="http://blog.zhariy.com/2012/07/blog-post_11.html">which brings joy</a> ), for example, for input = ‚Äú3‚Äù and check that the result will also be 3. <br><br>  What else?  Of course, the boundary values ‚Äã‚Äãand equivalence classes: ‚Äú-1‚Äù, ‚Äú0‚Äù, ‚ÄúMaxInt‚Äù, ‚Äú- (MaxInt)‚Äù. <br>  Well, what if the input gets a decimal?  And if the line starts with a number, followed by the characters? <br><br>  What should be the right decision in such different situations? <br>  And the right decision is not. <br><br>  Please note that different programming languages ‚Äã‚Äãhandle such situations differently.  For example, JavaScript as a result of the operation {‚Äú10‚Äù + 1} returns the string ‚Äú101‚Äù, and as a result {‚Äú10‚Äù - 1} will be the number 9. And Perl will say: 11 and 9, respectively.  But the absence of a ‚Äútrue‚Äù answer does not at all prevent us from coming up with the right behaviors and saying that from now on, this is the truth, and punching this truth with unit tests in stone. <br><br>  But, have you really gathered to accumulate a dozen unit tests for one unfortunate method with a single parameter? <br>  And why not create a table of input and expected values, and pass each row of such a table as a parameter into one single test. <br>  At the beginning, I myself was very surprised that Ms-Test provides quite rich possibilities for this. <br><br><h4>  Example data-driven unit test for Ms-Test </h4><br>  For clarity of the example, in the implementation of ConvertToNumber, I will not use Convert.ToInt32 () - it would be too simple.  Instead, I will offer my implementation: <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertToNumber</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (input.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) result = (input[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt;= <span class="hljs-string"><span class="hljs-string">'0'</span></span> || input[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= <span class="hljs-string"><span class="hljs-string">'9'</span></span>) ? (result * <span class="hljs-number"><span class="hljs-number">10</span></span>) + input[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-string"><span class="hljs-string">'0'</span></span> + (((input = input.Remove(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)).Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  Unfortunately, in Ms-Test, it is not yet possible to set the incoming and expected values ‚Äã‚Äãdirectly in the code, using attributes.  But there is an alternative - to use data sources.  And as such a source, you will not believe, we will use an Excel file. <br><br>  Although, in fact, you can use any data source that can be accessed from .NET.  Including CSV, XML and others. <br>  But working with Excel is great!  For example, our table might look like this: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/79d/c55/8b6/79dc558b6ecae16c1a0f55c200855930.png"></a> <br><br>  The main thing - do not forget to select the desired fragment and format it as a "table with the title."  Otherwise, magic will not work. <br><br>  Then the unit test with the implementation of the connection with the Excel-table and the reading of the data will look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> dataDriver = <span class="hljs-string"><span class="hljs-string">"System.Data.OleDb"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> connectionStr = <span class="hljs-string"><span class="hljs-string">"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=C:\\matrix.xlsx;Extended Properties=\"Excel 12.0 Xml;HDR=YES\";"</span></span>; [TestMethod] [DataSource(dataDriver, connectionStr, <span class="hljs-string"><span class="hljs-string">"Shit1$"</span></span>, DataAccessMethod.Sequential)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestMe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> rowInput = TestContext.DataRow[<span class="hljs-string"><span class="hljs-string">"Input"</span></span>].ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> rowExpected = TestContext.DataRow[<span class="hljs-string"><span class="hljs-string">"Expected Result"</span></span>].ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> rowException = TestContext.DataRow[<span class="hljs-string"><span class="hljs-string">"Exception"</span></span>].ToString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> rowComment = TestContext.DataRow[<span class="hljs-string"><span class="hljs-string">"Comment"</span></span>].ToString(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> actualResult = ConvertToNumber(rowInput); Assert.AreEqual(rowExpected, actualResult.ToString()); }</code> </pre><br><br>  Yes, I had to spend a little effort on setting up the connection and transforming the input data, but look at what visual results we got. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/174/29a/196/17429a196a7a4ba8fac5be430363c13a.png"></a> <br><br>  And to add a new test - just add a new line in Excel.  And you don‚Äôt need to go into the code to see what exactly is covered with tests and what isn‚Äôt. <br><br>  In addition, you can go to any of the tests to see the details of the error or the log. <br><br>  Please note that even on my low-performing machine, all 14 tests passed in less than 1 second. <br><br>  I don‚Äôt know about you, but I was just impressed with such features and visual results. <br>  <u>Note:</u> In order for it to work, do not forget to copy the matrix.xlsx file to the root of the C: \ drive. <br><br><h4>  Data-driven approach in the world of testing through the user interface </h4><br>  To my great regret, after I took up the UI tests using Selenium WebDriver - my admiration for the mega-cool feature of Ms-Test came to an end. <br><br>  The fact is that UI tests in any implementation are, by their nature, very slow compared to modular ones.  It is impossible to simply take and call a function from the core of the system, easily juggling context and parameters.  No ... in order to implement a complex user script - you need to click a lot of buttons. <br><br>  Therefore, with all possible optimizations, one UI test can go from 30 seconds to tens of minutes.  It all depends on the complexity of the script. <br><br>  For example, if we assume that 1 out of 14 data-driven tests takes one minute, then the entire set will pass in 14 minutes. <br>  Now imagine that one test will fall for some reason, for example, because the button on the page did not have time to appear ... <br>  It does not matter, you say, because you can fix and get rid of only fallen tests. <br>  Not.  Ms-Test considers a pack of data-driven tests as one test.  Therefore, in order to overtake 1 test - you have to run all 14 again.  And not the fact that those tests that took place earlier - suddenly will not fall.  And in the case of debugging, you will not only have to set a breakpoint, but set up a conditional breakpoint: Visual Studio allows this ... but it takes extra effort and time. <br><br>  It was necessary to find a way that would allow only the fallen test to override.  And I found such a way. <br><br><h4>  Problem solving: "cycle through inheritance" </h4><br>  To solve the problem, you need to add 2 files to the project: <a href="">TestBase.cs</a> and <a href="">TestRows.cs</a> . <br><br>  Then in the namespace ‚ÄúMsTestRows.Rows. *‚Äù, The classes TestRows_ <b>01</b> ... TestRows_ <b>100</b> will appear, which contain from one to one hundred generated methods. <br><br>  Inherit your TestClass from TestRows_NN with the required number of methods (NN). <br><br>  Further, Visual Studio will ask you to implement two methods: <br><ul><li>  GetNextDataRow () - which will return data for the next test </li><li>  TestMethod () - which will be called from the test with data obtained from GetNextDataRow (). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Full sample code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.VisualStudio.TestTools.UnitTesting; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HabraDrivenTests</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Custom Data Row public class HabrDataRow { public string Input { get; set; } public int Expected { get; set; } public Type ExpectedException { get; set; } public string Comment { get; set; } } [TestClass] public class HabrTestInherienceLoop : MsTestRows.Rows.TestRows_04&lt;HabrDataRow&gt; { // Production-ready method static int ConvertToNumber(string input) { int result = 0; while (input.Length &gt; 0) result = (input[0] &gt;= '0' || input[0] &lt;= '9') ? (result * 10) + input[0] - '0' + (((input = input.Remove(0, 1)).Length &gt; 0) ? 0 : 0) : 0; return result; } // Test Data static HabrDataRow[] testData = new HabrDataRow[] { #region Data new HabrDataRow() { Input = "0", Expected = 0, ExpectedException = null, Comment = " ", }, new HabrDataRow() { Input = "1", Expected = 1, ExpectedException = null, Comment = " ", }, new HabrDataRow() { Input = "-1", Expected = -1, ExpectedException = null, Comment = " ", }, new HabrDataRow() { Input = "2147483647", Expected = 2147483647, ExpectedException = null, Comment = "int.MaxValue", }, #endregion }; // Data Generator public override HabrDataRow GetNextDataRow(int rowIndex) { return testData[rowIndex]; } // Test Implementation public override void TestMethod(HabrDataRow dataRow, int rowIndex) { int actualResult = ConvertToNumber(dataRow.Input); Assert.AreEqual(dataRow.Expected, actualResult); } } }</span></span></code> </pre><br></div></div><br>  As a result, using such a perverted maneuver, I managed to achieve an opportunity to restart only the fallen test. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7b2/59c/ba9/7b259cba94d95172a9606b390b47f078.png" alt="image"></a> <br><br><h4>  Source Code and Links </h4><br><ul><li>  <a href="https://github.com/dzhariy/mstest-rows">Github project repository</a> </li><li>  <a href="https://github.com/dzhariy/mstest-rows/tree/master/habrahabr-article">Demo code</a> </li></ul><br>  <b>Other materials on the topic:</b> <br><ul><li>  <a href="http://codeclimber.net.nz/archive/2008/01/18/How-to-simulate-RowTest-with-MS-Test.aspx">How to simulate RowTest with MS Test</a> </li><li>  <a href="http://blog.drorhelper.com/2011/09/enabling-parameterized-tests-in-mstest.html">Enabling parameterized tests in MSTest using PostSharp</a> </li><li>  <a href="http://neimke.blogspot.com/2011/03/mstest-data-driven-tests-using-excel.html">MSTest data driven tests - Using Excel 2007 as a data source</a> </li><li>  <a href="http://haydenking.co/blog/2013/03/14/nunit-v-mstest-parameterized-tests/">NUnit vs.</a>  <a href="http://haydenking.co/blog/2013/03/14/nunit-v-mstest-parameterized-tests/">MSTest: Parameterized Tests</a> </li></ul><br><hr><br>  <b>Note 1:</b> The TestRows.cs file contains 30,000 lines of code.  If your salary bonus depends on the number of written lines of code, and the system will automatically charge you a bonus of $ 1 million, I think it will be fair if you send me at least 5% of this amount. <br><br>  <b>Note 2:</b> Try to implement ConvertToNumber so that it passes all the tests. <br>  Attention: stick to the ‚Äúauthor's style‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/192720/">https://habr.com/ru/post/192720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192710/index.html">Japanese robot cosmonaut says hello from space</a></li>
<li><a href="../192712/index.html">Another version of the top panel for Habr + button on the Google Chrome panel</a></li>
<li><a href="../192714/index.html">Mars Pole: high resolution photo</a></li>
<li><a href="../192716/index.html">Repositories for Windows, or how to install programs faster</a></li>
<li><a href="../192718/index.html">Is there life after blocking Roskomnadzor? there is</a></li>
<li><a href="../192722/index.html">Snowden has shed light on the cryptographic hacking situation. Everything is bad</a></li>
<li><a href="../192724/index.html">Creating a video editor - useful avconv recipes (ffmpeg)</a></li>
<li><a href="../192726/index.html">An example of developing a blog on Zend Framework 2. Part 3. Working with users</a></li>
<li><a href="../192728/index.html">A look at the problems of higher IT education from the teacher</a></li>
<li><a href="../192730/index.html">Sony PRS-T3 - a new reader with a higher resolution display</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>