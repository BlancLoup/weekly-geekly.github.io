<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Opera Unite for developers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And do not write us any service under Opera United? Here I will talk about the features of programming a novelty from the Opera on the example of my s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Opera Unite for developers</h1><div class="post__text post__text-html js-mediator-article"><img src="http://unite.opera.com/images/default_icon_64.png" alt="image" align="left">  And do not write us any service under Opera United?  Here I will talk about the features of programming a novelty from the Opera on the example of my service " <a href="http://unite.opera.com/service/322/">Stream media</a> ".  Official documentation is still incomplete and contains many errors, and in this article we will try to get around them. <br><img src="https://habrastorage.org/getpro/habr/post_images/7a5/09b/8a3/7a509b8a3f0bd3e03848bd78ef33a19f.jpg" alt="image" align="right"><br>  Further, we will delve into the technology gradually.  It is advisable that you have already read the <a href="http://dev.opera.com/articles/view/opera-unite-developer-primer-ru/">manual for creating the first application</a> , since some obvious facts are omitted here. <br><a name="habracut"></a><br><br><h2>  config.xml </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/192/2.1/" alt="image" align="left">  The main file of your service.  After installation it is cached and its changes do not lead to changes in real time.  You can only remove the service and reinstall it.  This is different from the server-side javascript behavior (it helps on-off service) and even more so from client-side javascript and html (they change in real time). <br><br> <b><code>&lt;widget network="public private"&gt; <br> &lt;widgetname&gt;Stream media&lt;/widgetname&gt; <br> &lt;description&gt;Stream media online from your own computer with Opera Unite! Audio, video and etc.&lt;/description&gt; <br> &lt;author&gt; <br> &lt;name&gt;avenu&lt;/name&gt; <br> &lt;organisation&gt;&lt;/organisation&gt; <br> &lt;/author&gt; <br> &lt;feature name="http://xmlns.opera.com/webserver"&gt; <br> &lt;param name="type" value="service"/&gt; <br> &lt;param name="servicepath" value="stream"/&gt; <br> &lt;/feature&gt; <br> &lt;feature name="http://xmlns.opera.com/fileio"&gt; <br> &lt;param name="folderhint" value="home" /&gt; <br> &lt;/feature&gt; <br> &lt;/widget&gt;</code></b> <br> <br>  Pay attention to the network = "public private" attribute of the widget tag - I recommend to enable it if you work with external sites.  Consider, because of the peculiarities of AJAX, you cannot connect to them in a simple way.  But with the help of this attribute the widget itself will be able to connect to the Internet using the same AJAX on the server. <br>  In addition, the File I / O API is connected here: <br> <b><code>&lt;feature name="http://xmlns.opera.com/fileio"&gt; <br> &lt;param name="folderhint" value="home" /&gt; <br> &lt;/feature&gt;</code></b> <br> <br>  and how the address of the service will look like: <br> <b><code>&lt;param name="servicepath" value="stream"/&gt;</code></b> <br> <br><h2>  Javascript </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/132/2.1/" alt="image" align="left">  To begin with, we‚Äôll enter into our brains the information that Opera Unite service is a special kind of widget (yes, those very widgets from Opera) with a number of features.  From this it follows that the widget API functions are applicable to it. <br>  Javascript is divided into server and client.  On the server, the entire logic of Opera United (regards, an analogue of PHP / Ruby / Python / etc.) Is prescribed; on the client, the logic of the site that the user sees is implemented.  For example, you can use jQuery.  HTML in Unite resembles a view from MVC (respectively, server-side javascript is an analogue of a controller).  UNITE generates HTML depending on the variables that the script passed to it. <br>  Accordingly, client scripts, CSS, files are put in the default folder public_html.  The server-side script and HTML can be put in any folders, you specify the path to them yourself.  To do this, in the root, next to the future configuration file, the index.html file is created, it indicates the construction of the type: <br> <b><code>&lt;!DOCTYPE html&gt; <br> &lt;script src="script/markuper.js"&gt;&lt;/script&gt; <br> &lt;script src="script/functions.js"&gt;&lt;/script&gt; <br> &lt;script src="script/operafunctions.js"&gt;&lt;/script&gt; <br> &lt;script src="script/script.js"&gt;&lt;/script&gt;</code></b> <br> <br>  HTML will be connected later with the help of markup mechanisms. <br>  Next, in one of the javascript created and connected, for example script.js from the script folder, we enable the handling of the "server turned on" event, and add request processing (URL) to the scripts: <br> <b><code>window.onload = function () <br> webserver = opera.io.webserver <br> if (webserver) <br> { <br> //Handle requests for various URLs <br> webserver.addEventListener('_index', showEntryList, false); <br> webserver.addEventListener('shared', download, false); <br> } <br> }</code></b> <br> <br>  _index is the identifier of the initial page of the service.  This name is the default.  In the above code, the showEntryList function will be called to access the site root.  Similarly, I added a call to the download function to access an address of the / service-name / shared / bla / bla / bla / bla / bla type in order to resolve some features of sharing files in Unite. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A variable of type Event will be available in the functions, from which you can get various useful objects: <br> <b><code>var response = e.connection.response; <br> var request = e.connection.request;</code></b> <br> <br>  However, you can get the Request or Respone object using the global opera object, but at the time of accessing it, the Request may already be new: <br> <b><code>opera.io.webserver.connections.request <br> opera.io.webserver.connections.response</code></b> <br> <br>  Using Request, we can pull data from a GET / POST (respectively) request: <br> <b><code>var index = request.queryItems['id'][0]; <br> var password = request.bodyItems.passwords[0];</code></b> <br> <br>  Reponse will display a user page: <br> <b><code>response.write( '&lt;!DOCTYPE html&gt;' <br> + '&lt;html&gt;&lt;head&gt;&lt;title&gt;Entries&lt;/title&gt;&lt;/head&gt;' <br> + '&lt;body&gt;&lt;ul&gt;' <br> );</code></b> <br> <br>  However, this is not the most convenient way to work with HTML.  Consider the Markuper mechanism. <br><br><h2>  HTML </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/142/2.1/" alt="image" align="left">  Markuper allows you to create HTML files with server logic.  This is something like a template engine a la Tidy.  To start working with it, we need in index.html in the root of the service folder to add a link to the markuper.js file, which will be located next to your server scripts.  Download it here: <a href="">dev.opera.com/libraries/markuper/markuper.js</a> .  Please note - the mark caper _ needs to be saved in the service folder and connect _! .. It is not available by default. <br>  Now you can create a template file, for example, index-template.html and add it to some folder in the root (or deeper), for example, templates.  Then in the script a new Markapper object will look like this: <br> <b><code>var template = new Markuper( 'templates/index-template.html');</code></b> <br>  The file itself will look something like this: <br> <b><code>&lt;!doctype html&gt; <br> &lt;html&gt; <br> &lt;head&gt; <br> &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt; <br> &lt;title&gt;Tutorial&lt;/title&gt; <br> &lt;/head&gt; <br> &lt;body&gt; <br> &lt;h1&gt;{{name}} Tutorial&lt;/h1&gt; <br> &lt;p&gt; <br> This variable is further down the data object hierarchy: <br> '{{further.down.the.hierarchy}}' <br> &lt;/p&gt; <br> &lt;/body&gt; <br> &lt;/html&gt;</code></b> <br>  {{path.to.variable}} is the path in the variable by its properties.  We will transfer it from the script like this: <br> <b><code>function handleRequest( event ) <br> { <br> <br> var response = event.connection.response; <br> <br> var data = <br> { <br> name : 'Template', <br> further : {down: {the : {hierarchy: 'yes it is!' } } } <br> }; <br> var template = new Markuper( 'templates/tutorial.html', data ); <br> <br> response.write( template.parse().html() ); <br> response.close(); <br> <br> }</code></b> <br> <br>  Pay attention to the need to parse the Markaper: template.parse () and convert the object to HTML: template.parse (). Html (). <br><br><h2>  File sharing </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/162/2.1/" alt="image" align="left">  The most important function, about which very little is said in the API and there is nothing at all in the examples.  So, having specified the following construction in config.xml, we force, after installing the service, to ask the user which folder he wants to share. <br> <b><code>&lt;feature name="http://xmlns.opera.com/fileio"&gt; <br> &lt;param name="folderhint" value="home" /&gt; <br> &lt;/feature&gt;</code></b> <br> <br>  home is the user folder on the disk (such as Documents and Settings / user).  Other examples of folders are in the API.  However, just the path to the folder will not be given to you.  Cross-platform, you see. <br>  This is where the difficulties begin.  The folder is shared, but there are no files in it (!).  Although from the manuals to Unite indirectly follows the opposite.  Besides the fact that the files will have to be shared, there is another difficulty.  Due to the instability of the service, it is impossible to rely on the fact that a file that was once shared will be shared during the session.  Therefore, I recommend to process access to files as requests are received.  The user requested the file - shared, downloaded - removed the status of the shared.  Another complication is, unfortunately, the unshareFile and shareFile functions that throw out a fatal error, if you slip them into an already unshared file or shared file, respectively.  Those.  Double share not something that does not work, you also get a non-working server. <br>  The shared folder has a shared alias.  In addition to it, there is an application (service folder), storage (a folder dedicated to service data).  Let's connect shared to our server: <br> <b><code>window.onload = function () { <br> webserver = opera.io.webserver; <br> if (webserver) <br> { <br> opera.io.filesystem.mountSystemDirectory('shared'); <br> webserver.addEventListener('shared', download, false); <br> webserver.addEventListener('_index', showEntryList, false); <br> } <br> }</code></b> <br> <br>  After turning on the server and service, we will mount our shared folder.  Considering the above about the instability of the Opera, we suggest that the server manually process the request. <br>  Now create the download function itself: <br> <b><code>function download(e) { <br> var req = e.connection.request; <br> var res = e.connection.response; <br> var mp = opera.io.filesystem.mountPoints; <br> var filePath = fullPathWithoutServiceName(req.uri); <br> var file = mp.resolve(filePath); <br> if(file.exists) { <br> if(file.isFile) { <br> opera.io.webserver.shareFile( file, filePath ); <br> res.closeAndRedispatch(); <br> opera.io.webserver.unshareFile(file); <br> } <br> if(file.isDirectory) { <br> //deep inside... folders, folders, folders. total commander :) <br> showEntryList(e); <br> res.closeAndRedispatch(); <br> } <br> } <br> else { <br> res.closeAndRedispatch(); <br> } <br> res.close(); <br> }</code></b> <br> <br>  We will not stop here for a long time, everything is clear about the names of API functions.  Mount the path after the name of the service in urla.  fullPathWithoutServiceName is my samopisnaya function, parsit url.  If a file really exists on it, check if it is a folder or just hang out here.  In the case of a folder, we pass the action to our showEntryList handler, which simply lists the files and folders in the directory.  In the case of a file, we share it, transfer the reins to the server, and returning, we subtract the rights from the file.  Before displaying the file names, please note that all characters are encoded there and you need to wrap them in the unescape function before outputting them.  Otherwise, in the simplest case, instead of the spaces of the file name, the user will see% 20. <br>  Using the closeAndRedispatch function, we return its functions to the server and it continues its work.  So  I configured work with multi-level folders and files. <br><br><h2>  Version update </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/331/2.0/" alt="image" align="left">  There are no similar notification mechanisms for updates, as in Firefox.  Alternatively, you can use the information about the latest version of the application through the DOAP file, which lies on the site of United.  So, for example, if the service has the address: <br>  <a href="http://unite.opera.com/service/322/">unite.opera.com/service/322</a> <br>  Then its DOAP file is located at: <br>  <a href="http://unite.opera.com/service/doap/322/">unite.opera.com/service/doap/322</a> <br>  Since this is plain XML, you can parse it, check the version and suggest it in a popup window.  Here is an example of processing: <br> <b><code>function getLastVersion() { <br> try { <br> var req = new XMLHttpRequest(); <br> req.onreadystatechange = function(x) { <br> if (this.readyState == 4) { <br> if(this.status == 200) { <br> var xml = this.responseXML; <br> var release = xml.getElementsByTagName('release').item(0); <br> var version = release.getElementsByTagName('Version').item(0); <br> var revision = version.getElementsByTagName('revision').item(0).firstChild.data; <br> var lastCheckedVersion = getLastCheckedVersion(); <br> if(revision &amp;&amp; lastCheckedVersion &amp;&amp; revision!=lastCheckedVersion) { <br> widget.showNotification("New version "+revision+" is available. Click here to update.", function() { <br> widget.openURL(globalSettings.url);}); <br> setLastCheckedVersion(revision); <br> } } } }; <br> req.open('GET', globalSettings.doap); <br> req.send(null); <br> } <br> catch(e) { <br> } <br> } <br> <br> function getLastCheckedVersion() { <br> return widget.preferenceForKey('last_checked_version'); <br> } <br> <br> function setLastCheckedVersion(version) { <br> widget.setPreferenceForKey(version, 'last_checked_version'); <br> } <br></code> <br></b> <br><br>  Please note that access to external resources is used, you need to correct the config.xml, as described earlier. <br>  The <a href="http://unite.opera.com/service/322/">URL unite.opera.com/service/322</a> can <a href="http://unite.opera.com/service/322/">also</a> be obtained automatically in theory, by attaching the service directory and digging into the config.xml file ‚Äî the URL will be entered there in the form of an ID.  But I had a lot to dig into this, if someone writes and opens the code - I will be happy :) And so, at the time of writing this function, I already knew this URL. <br><br><h2>  Debag </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/332/1.1/" alt="image" align="left">  Error handling is still zero.  Often the server is cut off from fatal errors, often these errors are unclear which means that there are no manuals, and abstract names speak little.  You can‚Äôt make any alerts on server javascript, the only way out to people is the function opera.postError ('error');  which reports an error to the Opera developer console. <br><br><h2>  Ratings on Unite.opera.com </h2><br><img src="http://unite.opera.com/service/screenshot/icon64/342/1.1/" alt="image" align="left">  Fucking done ... Firstly, there is no way to check the version number of the application.  By default, after verification, the service receives version 1.0.  When updating, you can only indicate that the changes are minor (version 1.1) or significant (version 2.0).  Please note, with this, the race rating for the last 7 days is reset and you fall sharply down to the last place.  So  the developer has no incentive to upload new ads, because no one will notice the next version, in the ranking you will be at zero.  An application that has not been updated for a hundred years can always hang around in the top and not leave it at the expense of hamsters.  So at the moment I recommend that you do not update the version until a significant number of errors are fixed. <br><br><h2>  Stream media </h2><br><img src="http://unite.opera.com/service/screenshot/large/322/1.5/" alt="image"><br>  The result of my efforts was the service Stream media, which allows you to do something like YouTube for your people once or twice.  You can play video and audio.  Of course, if they were limited only to MP3 and FLV formats, everything would be cross browser friendly.  But the majority stores video in AVI, etc., therefore cross-browser compatibility and cross-platform issues arise.  Here I can not help with anything, and so everything is maximally ‚Äúcross‚Äù due to the jQuery plugin.  However, with AVI in Windows Media Player you will have to wait until it completely downloads the file.  The maximum that I can offer, either convert to FLV, then the flash player will start, or download the file to the client before viewing. <br>  You can download it here: <br>  <a href="http://unite.opera.com/service/322/">unite.opera.com/service/322</a> <br><br>  So it was a little messy, I had to climb into the field of activities of the official manuals, but without a repetition of the past, I could not tell about the features that are not described on the website of Unite.  If you have questions, write, try to figure it out together. <br><br>  PS I think it makes no sense to monetize the service.  Therefore, I hope that soon there will be a better version with design, I communicate with one person on this topic, on altruistic foundations :) </div><p>Source: <a href="https://habr.com/ru/post/66869/">https://habr.com/ru/post/66869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66860/index.html">Brief history of web publishing</a></li>
<li><a href="../66862/index.html">First beta ¬µTorrent 2.0</a></li>
<li><a href="../66863/index.html">Microsoft banned from selling Word</a></li>
<li><a href="../66865/index.html">How to open an animated gif in Photoshop</a></li>
<li><a href="../66867/index.html">Rename users with an underscore</a></li>
<li><a href="../66870/index.html">Wayfinder + UltimateParent = separate display of menus and submenus</a></li>
<li><a href="../66871/index.html">Print number</a></li>
<li><a href="../66874/index.html">A lamp for those who suffer from a lack of positive</a></li>
<li><a href="../66875/index.html">Create sliders with animated scrolling using Javascript</a></li>
<li><a href="../66876/index.html">Sleep after work, for further work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>