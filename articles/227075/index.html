<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Importing open geo data from OpenGeoDB to Elasticsearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever thought about finding a neat public database, how good would it be to include it in your application in order to optimize any functional...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Importing open geo data from OpenGeoDB to Elasticsearch</h1><div class="post__text post__text-html js-mediator-article">  Have you ever thought about finding a neat public database, how good would it be to include it in your application in order to optimize any functionality, even if only slightly?  Of course!  This post will tell you how to use Logstash to turn an external dataset into the desired format, check the result in Kibana and make sure that the data is correctly indexed in Elasticsearch so that it can be used with heavy loads on live servers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b6/dc0/338/5b6dc0338cf6a59112d772fd791b1fcb.png"><a name="habracut"></a><br><br><h1>  Download data </h1>  I will assume that you have already installed the current version of Elasticsearch and Logstash.  I will use <a href="http://www.elasticsearch.org/blog/elasticsearch-1-1-0-released/">Elasticsearch 1.1.0</a> and <a href="http://www.elasticsearch.org/blog/logstash-1-4-0-ga-unleashed/">Logstash 1.4.0</a> in the following examples. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://opengeodb.org/wiki/OpenGeoDB">OpenGeoDB</a> is a German website that contains geo-data for Germany in SQL and CSV formats.  Since we want to store data in Elasticsearch, then SQL does not suit us, just like CSV.  However, despite this, we can use Logstash to convert and index data in Elasticsearch.  The file we are going to index contains a list of cities in Germany, including all of their zip codes.  This data is available for download from the <a href="">OpenGeoDB</a> website (download file) under the <a href="http://opengeodb.org/wiki/OpenGeoDB_Lizenz">public domain</a> license. <br><br><h1>  Data format </h1>  After reviewing the data, you can see that they consist of the following columns: <ul><li>  <b>loc_id:</b> unique identifier (inside the database) </li><li>  <b>ags:</b> state administrative code </li><li>  <b>ascii:</b> short title in capital letters </li><li>  <b>name:</b> entity name </li><li>  <b>lat:</b> latitude (coordinates) </li><li>  <b>lon:</b> longitude (coordinates) </li><li>  <b>amt:</b> not used </li><li>  <b>plz:</b> zip code (if more than one, then separated by a comma) </li><li>  <b>vorwahl:</b> phone code </li><li>  <b>einwohner:</b> population </li><li>  <b>flaeche:</b> square </li><li>  <b>kz:</b> car license plate series </li><li>  <b>typ:</b> type of administrative unit </li><li>  <b>level:</b> an integer that determines the location of the area in the hierarchy </li><li>  <b>of:</b> terrain identifier of which this locality is </li><li>  <b>invalid:</b> column is invalid </li></ul><br><br>  We are interested in the <i>name, lat, lon, area, population and license tag</i> fields.  We will return to them soon ... <br><br><h1>  We index entries in Elasticsearch </h1><br><h2>  use csv logstash filter </h2><br>  The next step is to put the data into Elasticsearch.  First we set up Logstash.  Copy the config below to the opengeodb.conf file.  Please note that we use the ‚Äúcsv‚Äù filter (comma-separated values), even though the separator is tabulation, not comma. <br><br><pre><code class="bash hljs">input { stdin {} } filter { <span class="hljs-comment"><span class="hljs-comment"># Step 1, possible dropping if [message] =~ /^#/ { drop {} } # Step 2, splitting csv { # careful... there is a "tab" embedded in the next line: # if you cannot copy paste it, press ctrl+V and then the tab key to create the control sequence # or maybe just tab, depending on your editor separator =&gt; ' ' quote_char =&gt; '|' # arbitrary, default one is included in the data and does not work columns =&gt; [ 'id', 'ags', 'name_uc', 'name', 'lat', 'lon', 'official_description', 'zip', 'phone_area_code', 'population', 'area', 'plate', 'type', 'level', 'of', 'invalid' ] } # Step 3, possible dropping if [level] != '6' { drop {} } # Step 4, zip code splitting if [zip] =~ /,/ { mutate { split =&gt; [ "zip", "," ] } } # Step 5, lat/lon love if [lat] and [lon] { # move into own location object for additional geo_point type in ES # copy field, then merge to create array for bettermap mutate { rename =&gt; [ "lat", "[location][lat]", "lon", "[location][lon]" ] add_field =&gt; { "lonlat" =&gt; [ "%{[location][lon]}", "%{[location][lat]}" ] } } } # Step 6, explicit conversion mutate { convert =&gt; [ "population", "integer" ] convert =&gt; [ "area", "integer" ] convert =&gt; [ "[location][lat]", "float" ] convert =&gt; [ "[location][lon]", "float" ] convert =&gt; [ "[lonlat]", "float" ] } } output { elasticsearch { host =&gt; 'localhost' index =&gt; 'opengeodb' index_type =&gt; "locality" flush_size =&gt; 1000 protocol =&gt; 'http' } }</span></span></code> </pre> <br><br>  Before continuing, pay attention, this is how we will run Logstash to index the data.  Elasticsearch must be running. <br><br><pre> <code class="bash hljs">cat DE.tab | logstash-1.4.0/bin/logstash -f opengeodb.conf</code> </pre><br><br>  At this stage, quite a lot of things happen (indexing can take a minute or more, it all depends on your equipment).  The first thing you can notice is that in the Logstash configuration, input is not used in the ‚Äúfile‚Äù instruction.  This is because this input method behaves like ‚Äútail -f‚Äù on UNIX systems, that is, it expects new data to be added to the file.  Our file, on the other hand, has a fixed size, so it would be more reasonable to read all its data using the ‚Äústdin‚Äù input. <br><br>  The ‚Äúfilter‚Äù section consists of six steps.  Let's take a closer look at them and explain what each of them does. <br><br><h3>  step 1 - ignore comments </h3>  In the first step, we get rid of comments.  They can be identified by the pound symbol at the beginning of a line.  This must be done because the first line in our file is just such a comment, which contains the names of the columns.  We do not need to index them. <br><br><h3>  step 2 - disassemble csv </h3>  The second step does all the hard work of parsing CSV.  You need to override ‚Äúseparator‚Äù with ‚Äútab‚Äù (tab), ‚Äúquote_char‚Äù is one quote by default ‚Äù, which is present in the values ‚Äã‚Äãof our data and therefore must be replaced with another symbol. The‚Äú columns ‚Äùproperty defines the names of the columns that will be used later as field names. <blockquote>  <b>Attention!</b>  When copying a file from here, you will need to replace the ‚Äúseparator‚Äù character, since instead of a tab, it will be copied as several spaces.  If the script does not work as it should, check it first. </blockquote><br><h3>  step 3 - skip unnecessary records </h3>  We need only records that display information about cities (those with a ‚Äúlevel‚Äù field in the value of 6).  We simply ignore the rest of the entries. <br><br><h3>  step 4 - we process the zip code </h3>  The fourth step is needed for proper zip code handling.  If a record has more than one zip code (for example, in large cities), they are all contained in one field, but are separated by commas.  To save them as an array, rather than one large string, use the ‚Äúmutate‚Äù filter to separate the values ‚Äã‚Äãof this field.  Here, for example, the content of this data in the form of an array of numbers will allow us to use the search for a range of numerical values. <br><br><h3>  Step 5 - Geo Data Structure </h3>  The fifth step will save the geo-data in a more convenient format.  When reading from the DE.dat file, separate lat and lon fields are created.  However, the meaning of these fields is only when they are stored together.  This step writes both fields to two data structures.  One looks like the Elasticsearch <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-geo-point-type.html">geo_point</a> type and, as a result, the {"location": {"lat": x, "lon": y}} structure.  The other one looks like a simple array and contains longitude (latitude) (in that order!).  So we can use the Kibana component bettermap to display the coordinates. <br><br><h3>  Step 6 - explicit type conversion </h3>  The last filter step explicitly assigns data types to some fields.  Thus, Elasticsearch will be able to perform numeric operations with them in the future. <br><br>  The ‚Äúoutput‚Äù section is only available in Logtash from version 1.4, so make sure you have a version no less.  In the previous version you need to explicitly specify the output "elasticsearch_http".  Looking ahead, I‚Äôll say that there will be only one ‚Äúelasticsearch‚Äù output and you can specify protocol =&gt; http to use HTTP via port 9200 to connect to Elasticsearch. <br><br><br><h1>  We use Kibana and Elasticsearch for data visualization </h1>  When the data is indexed, we can use Kibana for further analysis.  Using the bettermap widget and a simple search query like population: [10000 TO *] we can display every big city in Germany. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b6/dc0/338/5b6dc0338cf6a59112d772fd791b1fcb.png"><br><br>  You can use this, for example, for such purposes: <ul><li>  Find the cities with the largest population </li><li>  Find cities that use a common series of license plates (for example, GT is used in G√ºtersloh and its surroundings) </li><li>  Use the aggregation script to find areas with the most dense or sparse population per square kilometer.  You can also pre-calculate these figures in Logstash. </li></ul><br>  All this is very good, but it does not help us to improve existing applications.  We need to go deeper. <br><br><h2>  Customize autocompletion </h2><br>  Let us digress for a moment and see what useful things you can do with this data.  We have cities, postal codes ... and a lot of cases in web applications where you need to enter this particular data. <br><br>  A good example is the checkout process.  Not every store has user data in advance.  This may be a store in which orders are often disposable or an order can be made without registration.  In this case, it may be appropriate to help the user speed up the checkout process.  In this case, the "free" bonus will be to prevent the loss of the order or cancellation due to the complexity of the order. <br><br>  Elasticsearch has a very fast prefix search functionality called ‚Äúcompletion suggester‚Äù.  But this search has a flaw.  You need to slightly supplement your data before indexing, but for this we have Logstash.  To better understand this example, you may need to read the introduction to the <a href="http://www.elasticsearch.org/blog/you-complete-me/">‚Äúcompletion suggester‚Äù</a> (eng). <br><br><h2>  Tips </h2><br>  Suppose we want to help the user enter the name of the city in which he or she lives.  We would also like to provide a list of zip codes to make it easier to find a suitable one for the selected city.  You can also do the opposite, first letting the user enter a zip code, and then automatically fill in information about the city. <br><br>  It's time to make a few changes to the configuration of Logstash to make it work.  Let's start with a simple configuration inside the filter.  Add this configuration snippet to your opengeodb.conf, immediately after step 5 and before step 6. <br><br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># Step 5 and a half # create a prefix completion field data structure # input can be any of the zips or the name field # weight is the population, so big cities are preferred when the city name is entered mutate { add_field =&gt; [ "[suggest][input]", "%{name}" ] add_field =&gt; [ "[suggest][output]", "%{name}" ] add_field =&gt; [ "[suggest][payload][name]", "%{name}" ] add_field =&gt; [ "[suggest][weight]", "%{population}" ] } # add all the zips to the input as well mutate { merge =&gt; [ "[suggest][input]", zip ] convert =&gt; [ "[suggest][weight]", "integer" ] } # ruby filter to put an array into the event ruby { code =&gt; 'event["[suggest][payload][data]"] = event["zip"]' }</span></span></code> </pre><br>  Now Logstash will write the data in a structure that is compatible with the ‚Äúcompletion suggester‚Äù when it will again index the data.  However, you also need to configure the field matching pattern so that the hint function is configured in Elaticsearch.  Therefore, you also need to explicitly specify the template in the Logstash settings in the output&gt; elastichsearch section. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># change the output to this in order to include an index template output { elasticsearch { host =&gt; 'localhost' index =&gt; 'opengeodb' index_type =&gt; "locality" flush_size =&gt; 1000 protocol =&gt; 'http' template_name =&gt; 'opengeodb' template =&gt; '/path/to/opengeodb-template.json' } }</span></span></code> </pre><br>  This template is very similar to the default Logstash template, but it includes the suggest and geo_point fields. <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"template"</span></span> : <span class="hljs-string"><span class="hljs-string">"opengeodb"</span></span>, <span class="hljs-string"><span class="hljs-string">"settings"</span></span> : { <span class="hljs-string"><span class="hljs-string">"index.refresh_interval"</span></span> : <span class="hljs-string"><span class="hljs-string">"5s"</span></span> }, <span class="hljs-string"><span class="hljs-string">"mappings"</span></span> : { <span class="hljs-string"><span class="hljs-string">"_default_"</span></span> : { <span class="hljs-string"><span class="hljs-string">"_all"</span></span> : {<span class="hljs-string"><span class="hljs-string">"enabled"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-string"><span class="hljs-string">"dynamic_templates"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"string_fields"</span></span> : { <span class="hljs-string"><span class="hljs-string">"match"</span></span> : <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"match_mapping_type"</span></span> : <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"mapping"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-string"><span class="hljs-string">"analyzed"</span></span>, <span class="hljs-string"><span class="hljs-string">"omit_norms"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span> : { <span class="hljs-string"><span class="hljs-string">"raw"</span></span> : {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-string"><span class="hljs-string">"not_analyzed"</span></span>, <span class="hljs-string"><span class="hljs-string">"ignore_above"</span></span> : <span class="hljs-number"><span class="hljs-number">256</span></span>} } } } } ], <span class="hljs-string"><span class="hljs-string">"properties"</span></span> : { <span class="hljs-string"><span class="hljs-string">"@version"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span>: <span class="hljs-string"><span class="hljs-string">"not_analyzed"</span></span> }, <span class="hljs-string"><span class="hljs-string">"location"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"geo_point"</span></span> }, <span class="hljs-string"><span class="hljs-string">"suggest"</span></span> : { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"completion"</span></span>, <span class="hljs-string"><span class="hljs-string">"payloads"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"analyzer"</span></span> : <span class="hljs-string"><span class="hljs-string">"whitespace"</span></span> } } } } }</code> </pre><br>  Now it's time to delete the old data (including the index) and start re-indexing. <br><br><pre> <code class="bash hljs">curl -X DELETE localhost:9200/opengeodb cat DE.tab | logstash-1.4.0/bin/logstash -f opengeodb.conf</code> </pre><br>  Now you can perform a query to the "sagzhester" <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">'localhost:9200/opengeodb/_suggest?pretty'</span></span> -d <span class="hljs-string"><span class="hljs-string">'{ "places" : { "text" : "B", "completion" : { "field" : "suggest" } } }'</span></span></code> </pre><br>  And here is the result: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"_shards"</span></span> : { <span class="hljs-string"><span class="hljs-string">"total"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"successful"</span></span> : <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">"failed"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"places"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"B"</span></span>, <span class="hljs-string"><span class="hljs-string">"offset"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"length"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"options"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"Berlin"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">3431675.0</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span> : {<span class="hljs-string"><span class="hljs-string">"data"</span></span>:[<span class="hljs-string"><span class="hljs-string">"Berlin"</span></span>,<span class="hljs-string"><span class="hljs-string">"10115"</span></span>,<span class="hljs-string"><span class="hljs-string">"10117"</span></span>,<span class="hljs-string"><span class="hljs-string">"10119"</span></span>,<span class="hljs-string"><span class="hljs-string">"10178"</span></span>,<span class="hljs-string"><span class="hljs-string">"10179"</span></span>,<span class="hljs-string"><span class="hljs-string">"10243"</span></span>,<span class="hljs-string"><span class="hljs-string">"10245"</span></span>,<span class="hljs-string"><span class="hljs-string">"10247"</span></span>,<span class="hljs-string"><span class="hljs-string">"10249"</span></span>,<span class="hljs-string"><span class="hljs-string">"10315"</span></span>,<span class="hljs-string"><span class="hljs-string">"10317"</span></span>,<span class="hljs-string"><span class="hljs-string">"10318"</span></span>,<span class="hljs-string"><span class="hljs-string">"10319"</span></span>,<span class="hljs-string"><span class="hljs-string">"10365"</span></span>,<span class="hljs-string"><span class="hljs-string">"10367"</span></span>,<span class="hljs-string"><span class="hljs-string">"10369"</span></span>,<span class="hljs-string"><span class="hljs-string">"10405"</span></span>,<span class="hljs-string"><span class="hljs-string">"10407"</span></span>,<span class="hljs-string"><span class="hljs-string">"10409"</span></span>,<span class="hljs-string"><span class="hljs-string">"10435"</span></span>,<span class="hljs-string"><span class="hljs-string">"10437"</span></span>,<span class="hljs-string"><span class="hljs-string">"10439"</span></span>,<span class="hljs-string"><span class="hljs-string">"10551"</span></span>,<span class="hljs-string"><span class="hljs-string">"10553"</span></span>,<span class="hljs-string"><span class="hljs-string">"10555"</span></span>,<span class="hljs-string"><span class="hljs-string">"10557"</span></span>,<span class="hljs-string"><span class="hljs-string">"10559"</span></span>,<span class="hljs-string"><span class="hljs-string">"10585"</span></span>,<span class="hljs-string"><span class="hljs-string">"10587"</span></span>,<span class="hljs-string"><span class="hljs-string">"10589"</span></span>,<span class="hljs-string"><span class="hljs-string">"10623"</span></span>,<span class="hljs-string"><span class="hljs-string">"10625"</span></span>,<span class="hljs-string"><span class="hljs-string">"10627"</span></span>,<span class="hljs-string"><span class="hljs-string">"10629"</span></span>,<span class="hljs-string"><span class="hljs-string">"10707"</span></span>,<span class="hljs-string"><span class="hljs-string">"10709"</span></span>,<span class="hljs-string"><span class="hljs-string">"10711"</span></span>,<span class="hljs-string"><span class="hljs-string">"10713"</span></span>,<span class="hljs-string"><span class="hljs-string">"10715"</span></span>,<span class="hljs-string"><span class="hljs-string">"10717"</span></span>,<span class="hljs-string"><span class="hljs-string">"10719"</span></span>,<span class="hljs-string"><span class="hljs-string">"10777"</span></span>,<span class="hljs-string"><span class="hljs-string">"10779"</span></span>,<span class="hljs-string"><span class="hljs-string">"10781"</span></span>,<span class="hljs-string"><span class="hljs-string">"10783"</span></span>,<span class="hljs-string"><span class="hljs-string">"10785"</span></span>,<span class="hljs-string"><span class="hljs-string">"10787"</span></span>,<span class="hljs-string"><span class="hljs-string">"10789"</span></span>,<span class="hljs-string"><span class="hljs-string">"10823"</span></span>,<span class="hljs-string"><span class="hljs-string">"10825"</span></span>,<span class="hljs-string"><span class="hljs-string">"10827"</span></span>,<span class="hljs-string"><span class="hljs-string">"10829"</span></span>,<span class="hljs-string"><span class="hljs-string">"10961"</span></span>,<span class="hljs-string"><span class="hljs-string">"10963"</span></span>,<span class="hljs-string"><span class="hljs-string">"10965"</span></span>,<span class="hljs-string"><span class="hljs-string">"10967"</span></span>,<span class="hljs-string"><span class="hljs-string">"10969"</span></span>,<span class="hljs-string"><span class="hljs-string">"10997"</span></span>,<span class="hljs-string"><span class="hljs-string">"10999"</span></span>,<span class="hljs-string"><span class="hljs-string">"12043"</span></span>,<span class="hljs-string"><span class="hljs-string">"12045"</span></span>,<span class="hljs-string"><span class="hljs-string">"12047"</span></span>,<span class="hljs-string"><span class="hljs-string">"12049"</span></span>,<span class="hljs-string"><span class="hljs-string">"12051"</span></span>,<span class="hljs-string"><span class="hljs-string">"12053"</span></span>,<span class="hljs-string"><span class="hljs-string">"12055"</span></span>,<span class="hljs-string"><span class="hljs-string">"12057"</span></span>,<span class="hljs-string"><span class="hljs-string">"12059"</span></span>,<span class="hljs-string"><span class="hljs-string">"12099"</span></span>,<span class="hljs-string"><span class="hljs-string">"12101"</span></span>,<span class="hljs-string"><span class="hljs-string">"12103"</span></span>,<span class="hljs-string"><span class="hljs-string">"12105"</span></span>,<span class="hljs-string"><span class="hljs-string">"12107"</span></span>,<span class="hljs-string"><span class="hljs-string">"12109"</span></span>,<span class="hljs-string"><span class="hljs-string">"12157"</span></span>,<span class="hljs-string"><span class="hljs-string">"12159"</span></span>,<span class="hljs-string"><span class="hljs-string">"12161"</span></span>,<span class="hljs-string"><span class="hljs-string">"12163"</span></span>,<span class="hljs-string"><span class="hljs-string">"12165"</span></span>,<span class="hljs-string"><span class="hljs-string">"12167"</span></span>,<span class="hljs-string"><span class="hljs-string">"12169"</span></span>,<span class="hljs-string"><span class="hljs-string">"12203"</span></span>,<span class="hljs-string"><span class="hljs-string">"12205"</span></span>,<span class="hljs-string"><span class="hljs-string">"12207"</span></span>,<span class="hljs-string"><span class="hljs-string">"12209"</span></span>,<span class="hljs-string"><span class="hljs-string">"12247"</span></span>,<span class="hljs-string"><span class="hljs-string">"12249"</span></span>,<span class="hljs-string"><span class="hljs-string">"12277"</span></span>,<span class="hljs-string"><span class="hljs-string">"12279"</span></span>,<span class="hljs-string"><span class="hljs-string">"12305"</span></span>,<span class="hljs-string"><span class="hljs-string">"12307"</span></span>,<span class="hljs-string"><span class="hljs-string">"12309"</span></span>,<span class="hljs-string"><span class="hljs-string">"12347"</span></span>,<span class="hljs-string"><span class="hljs-string">"12349"</span></span>,<span class="hljs-string"><span class="hljs-string">"12351"</span></span>,<span class="hljs-string"><span class="hljs-string">"12353"</span></span>,<span class="hljs-string"><span class="hljs-string">"12355"</span></span>,<span class="hljs-string"><span class="hljs-string">"12357"</span></span>,<span class="hljs-string"><span class="hljs-string">"12359"</span></span>,<span class="hljs-string"><span class="hljs-string">"12435"</span></span>,<span class="hljs-string"><span class="hljs-string">"12437"</span></span>,<span class="hljs-string"><span class="hljs-string">"12439"</span></span>,<span class="hljs-string"><span class="hljs-string">"12459"</span></span>,<span class="hljs-string"><span class="hljs-string">"12487"</span></span>,<span class="hljs-string"><span class="hljs-string">"12489"</span></span>,<span class="hljs-string"><span class="hljs-string">"12524"</span></span>,<span class="hljs-string"><span class="hljs-string">"12526"</span></span>,<span class="hljs-string"><span class="hljs-string">"12527"</span></span>,<span class="hljs-string"><span class="hljs-string">"12529"</span></span>,<span class="hljs-string"><span class="hljs-string">"12555"</span></span>,<span class="hljs-string"><span class="hljs-string">"12557"</span></span>,<span class="hljs-string"><span class="hljs-string">"12559"</span></span>,<span class="hljs-string"><span class="hljs-string">"12587"</span></span>,<span class="hljs-string"><span class="hljs-string">"12589"</span></span>,<span class="hljs-string"><span class="hljs-string">"12619"</span></span>,<span class="hljs-string"><span class="hljs-string">"12621"</span></span>,<span class="hljs-string"><span class="hljs-string">"12623"</span></span>,<span class="hljs-string"><span class="hljs-string">"12627"</span></span>,<span class="hljs-string"><span class="hljs-string">"12629"</span></span>,<span class="hljs-string"><span class="hljs-string">"12679"</span></span>,<span class="hljs-string"><span class="hljs-string">"12681"</span></span>,<span class="hljs-string"><span class="hljs-string">"12683"</span></span>,<span class="hljs-string"><span class="hljs-string">"12685"</span></span>,<span class="hljs-string"><span class="hljs-string">"12687"</span></span>,<span class="hljs-string"><span class="hljs-string">"12689"</span></span>,<span class="hljs-string"><span class="hljs-string">"13051"</span></span>,<span class="hljs-string"><span class="hljs-string">"13053"</span></span>,<span class="hljs-string"><span class="hljs-string">"13055"</span></span>,<span class="hljs-string"><span class="hljs-string">"13057"</span></span>,<span class="hljs-string"><span class="hljs-string">"13059"</span></span>,<span class="hljs-string"><span class="hljs-string">"13086"</span></span>,<span class="hljs-string"><span class="hljs-string">"13088"</span></span>,<span class="hljs-string"><span class="hljs-string">"13089"</span></span>,<span class="hljs-string"><span class="hljs-string">"13125"</span></span>,<span class="hljs-string"><span class="hljs-string">"13127"</span></span>,<span class="hljs-string"><span class="hljs-string">"13129"</span></span>,<span class="hljs-string"><span class="hljs-string">"13156"</span></span>,<span class="hljs-string"><span class="hljs-string">"13158"</span></span>,<span class="hljs-string"><span class="hljs-string">"13159"</span></span>,<span class="hljs-string"><span class="hljs-string">"13187"</span></span>,<span class="hljs-string"><span class="hljs-string">"13189"</span></span>,<span class="hljs-string"><span class="hljs-string">"13347"</span></span>,<span class="hljs-string"><span class="hljs-string">"13349"</span></span>,<span class="hljs-string"><span class="hljs-string">"13351"</span></span>,<span class="hljs-string"><span class="hljs-string">"13353"</span></span>,<span class="hljs-string"><span class="hljs-string">"13355"</span></span>,<span class="hljs-string"><span class="hljs-string">"13357"</span></span>,<span class="hljs-string"><span class="hljs-string">"13359"</span></span>,<span class="hljs-string"><span class="hljs-string">"13403"</span></span>,<span class="hljs-string"><span class="hljs-string">"13405"</span></span>,<span class="hljs-string"><span class="hljs-string">"13407"</span></span>,<span class="hljs-string"><span class="hljs-string">"13409"</span></span>,<span class="hljs-string"><span class="hljs-string">"13435"</span></span>,<span class="hljs-string"><span class="hljs-string">"13437"</span></span>,<span class="hljs-string"><span class="hljs-string">"13439"</span></span>,<span class="hljs-string"><span class="hljs-string">"13442"</span></span>,<span class="hljs-string"><span class="hljs-string">"13465"</span></span>,<span class="hljs-string"><span class="hljs-string">"13467"</span></span>,<span class="hljs-string"><span class="hljs-string">"13469"</span></span>,<span class="hljs-string"><span class="hljs-string">"13503"</span></span>,<span class="hljs-string"><span class="hljs-string">"13505"</span></span>,<span class="hljs-string"><span class="hljs-string">"13507"</span></span>,<span class="hljs-string"><span class="hljs-string">"13509"</span></span>,<span class="hljs-string"><span class="hljs-string">"13581"</span></span>,<span class="hljs-string"><span class="hljs-string">"13583"</span></span>,<span class="hljs-string"><span class="hljs-string">"13585"</span></span>,<span class="hljs-string"><span class="hljs-string">"13587"</span></span>,<span class="hljs-string"><span class="hljs-string">"13589"</span></span>,<span class="hljs-string"><span class="hljs-string">"13591"</span></span>,<span class="hljs-string"><span class="hljs-string">"13593"</span></span>,<span class="hljs-string"><span class="hljs-string">"13595"</span></span>,<span class="hljs-string"><span class="hljs-string">"13597"</span></span>,<span class="hljs-string"><span class="hljs-string">"13599"</span></span>,<span class="hljs-string"><span class="hljs-string">"13627"</span></span>,<span class="hljs-string"><span class="hljs-string">"13629"</span></span>,<span class="hljs-string"><span class="hljs-string">"14050"</span></span>,<span class="hljs-string"><span class="hljs-string">"14052"</span></span>,<span class="hljs-string"><span class="hljs-string">"14053"</span></span>,<span class="hljs-string"><span class="hljs-string">"14055"</span></span>,<span class="hljs-string"><span class="hljs-string">"14057"</span></span>,<span class="hljs-string"><span class="hljs-string">"14059"</span></span>,<span class="hljs-string"><span class="hljs-string">"14089"</span></span>,<span class="hljs-string"><span class="hljs-string">"14109"</span></span>,<span class="hljs-string"><span class="hljs-string">"14129"</span></span>,<span class="hljs-string"><span class="hljs-string">"14163"</span></span>,<span class="hljs-string"><span class="hljs-string">"14165"</span></span>,<span class="hljs-string"><span class="hljs-string">"14167"</span></span>,<span class="hljs-string"><span class="hljs-string">"14169"</span></span>,<span class="hljs-string"><span class="hljs-string">"14193"</span></span>,<span class="hljs-string"><span class="hljs-string">"14195"</span></span>,<span class="hljs-string"><span class="hljs-string">"14197"</span></span>,<span class="hljs-string"><span class="hljs-string">"14199"</span></span>]} }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bremen"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">545932.0</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span> : {<span class="hljs-string"><span class="hljs-string">"data"</span></span>:[<span class="hljs-string"><span class="hljs-string">"Bremen"</span></span>,<span class="hljs-string"><span class="hljs-string">"28195"</span></span>,<span class="hljs-string"><span class="hljs-string">"28203"</span></span>,<span class="hljs-string"><span class="hljs-string">"28205"</span></span>,<span class="hljs-string"><span class="hljs-string">"28207"</span></span>,<span class="hljs-string"><span class="hljs-string">"28209"</span></span>,<span class="hljs-string"><span class="hljs-string">"28211"</span></span>,<span class="hljs-string"><span class="hljs-string">"28213"</span></span>,<span class="hljs-string"><span class="hljs-string">"28215"</span></span>,<span class="hljs-string"><span class="hljs-string">"28217"</span></span>,<span class="hljs-string"><span class="hljs-string">"28219"</span></span>,<span class="hljs-string"><span class="hljs-string">"28237"</span></span>,<span class="hljs-string"><span class="hljs-string">"28239"</span></span>,<span class="hljs-string"><span class="hljs-string">"28307"</span></span>,<span class="hljs-string"><span class="hljs-string">"28309"</span></span>,<span class="hljs-string"><span class="hljs-string">"28325"</span></span>,<span class="hljs-string"><span class="hljs-string">"28327"</span></span>,<span class="hljs-string"><span class="hljs-string">"28329"</span></span>,<span class="hljs-string"><span class="hljs-string">"28355"</span></span>,<span class="hljs-string"><span class="hljs-string">"28357"</span></span>,<span class="hljs-string"><span class="hljs-string">"28359"</span></span>,<span class="hljs-string"><span class="hljs-string">"28717"</span></span>,<span class="hljs-string"><span class="hljs-string">"28719"</span></span>,<span class="hljs-string"><span class="hljs-string">"28755"</span></span>,<span class="hljs-string"><span class="hljs-string">"28757"</span></span>,<span class="hljs-string"><span class="hljs-string">"28759"</span></span>,<span class="hljs-string"><span class="hljs-string">"28777"</span></span>,<span class="hljs-string"><span class="hljs-string">"28779"</span></span>,<span class="hljs-string"><span class="hljs-string">"28197"</span></span>,<span class="hljs-string"><span class="hljs-string">"28199"</span></span>,<span class="hljs-string"><span class="hljs-string">"28201"</span></span>,<span class="hljs-string"><span class="hljs-string">"28259"</span></span>,<span class="hljs-string"><span class="hljs-string">"28277"</span></span>,<span class="hljs-string"><span class="hljs-string">"28279"</span></span>]} }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bochum"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">388179.0</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span> : {<span class="hljs-string"><span class="hljs-string">"data"</span></span>:[<span class="hljs-string"><span class="hljs-string">"Bochum"</span></span>,<span class="hljs-string"><span class="hljs-string">"44787"</span></span>,<span class="hljs-string"><span class="hljs-string">"44789"</span></span>,<span class="hljs-string"><span class="hljs-string">"44791"</span></span>,<span class="hljs-string"><span class="hljs-string">"44793"</span></span>,<span class="hljs-string"><span class="hljs-string">"44795"</span></span>,<span class="hljs-string"><span class="hljs-string">"44797"</span></span>,<span class="hljs-string"><span class="hljs-string">"44799"</span></span>,<span class="hljs-string"><span class="hljs-string">"44801"</span></span>,<span class="hljs-string"><span class="hljs-string">"44803"</span></span>,<span class="hljs-string"><span class="hljs-string">"44805"</span></span>,<span class="hljs-string"><span class="hljs-string">"44807"</span></span>,<span class="hljs-string"><span class="hljs-string">"44809"</span></span>,<span class="hljs-string"><span class="hljs-string">"44866"</span></span>,<span class="hljs-string"><span class="hljs-string">"44867"</span></span>,<span class="hljs-string"><span class="hljs-string">"44869"</span></span>,<span class="hljs-string"><span class="hljs-string">"44879"</span></span>,<span class="hljs-string"><span class="hljs-string">"44892"</span></span>,<span class="hljs-string"><span class="hljs-string">"44894"</span></span>]} }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bielefeld"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">328012.0</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span> : {<span class="hljs-string"><span class="hljs-string">"data"</span></span>:[<span class="hljs-string"><span class="hljs-string">"Bielefeld"</span></span>,<span class="hljs-string"><span class="hljs-string">"33602"</span></span>,<span class="hljs-string"><span class="hljs-string">"33604"</span></span>,<span class="hljs-string"><span class="hljs-string">"33605"</span></span>,<span class="hljs-string"><span class="hljs-string">"33607"</span></span>,<span class="hljs-string"><span class="hljs-string">"33609"</span></span>,<span class="hljs-string"><span class="hljs-string">"33611"</span></span>,<span class="hljs-string"><span class="hljs-string">"33613"</span></span>,<span class="hljs-string"><span class="hljs-string">"33615"</span></span>,<span class="hljs-string"><span class="hljs-string">"33617"</span></span>,<span class="hljs-string"><span class="hljs-string">"33619"</span></span>,<span class="hljs-string"><span class="hljs-string">"33647"</span></span>,<span class="hljs-string"><span class="hljs-string">"33649"</span></span>,<span class="hljs-string"><span class="hljs-string">"33659"</span></span>,<span class="hljs-string"><span class="hljs-string">"33689"</span></span>,<span class="hljs-string"><span class="hljs-string">"33699"</span></span>,<span class="hljs-string"><span class="hljs-string">"33719"</span></span>,<span class="hljs-string"><span class="hljs-string">"33729"</span></span>,<span class="hljs-string"><span class="hljs-string">"33739"</span></span>]} }, { <span class="hljs-string"><span class="hljs-string">"text"</span></span> : <span class="hljs-string"><span class="hljs-string">"Bonn"</span></span>, <span class="hljs-string"><span class="hljs-string">"score"</span></span> : <span class="hljs-number"><span class="hljs-number">311938.0</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span> : {<span class="hljs-string"><span class="hljs-string">"data"</span></span>:[<span class="hljs-string"><span class="hljs-string">"Bonn"</span></span>,<span class="hljs-string"><span class="hljs-string">"53111"</span></span>,<span class="hljs-string"><span class="hljs-string">"53113"</span></span>,<span class="hljs-string"><span class="hljs-string">"53115"</span></span>,<span class="hljs-string"><span class="hljs-string">"53117"</span></span>,<span class="hljs-string"><span class="hljs-string">"53119"</span></span>,<span class="hljs-string"><span class="hljs-string">"53121"</span></span>,<span class="hljs-string"><span class="hljs-string">"53123"</span></span>,<span class="hljs-string"><span class="hljs-string">"53125"</span></span>,<span class="hljs-string"><span class="hljs-string">"53127"</span></span>,<span class="hljs-string"><span class="hljs-string">"53129"</span></span>,<span class="hljs-string"><span class="hljs-string">"53173"</span></span>,<span class="hljs-string"><span class="hljs-string">"53175"</span></span>,<span class="hljs-string"><span class="hljs-string">"53177"</span></span>,<span class="hljs-string"><span class="hljs-string">"53179"</span></span>,<span class="hljs-string"><span class="hljs-string">"53225"</span></span>,<span class="hljs-string"><span class="hljs-string">"53227"</span></span>,<span class="hljs-string"><span class="hljs-string">"53229"</span></span>]} } ] } ] }</code> </pre><br>  Now, as you may have noticed, it is logical to use the population of the city as its weight.  Big cities will be at a higher tip than smaller cities.  The returned result contains the name of the city and all its postal codes, which can be used to automatically fill out the form (especially if only one postal code is found). <br><br>  And that's all for today!  However, remember that this is not only suitable for publicly available databases.  I am absolutely sure that somewhere, deep inside your company, someone has already collected useful data that are just waiting to be added and used in your applications.  Ask your colleagues.  You will find such databases in any company. <br><br><h1>  From translator </h1>  This is my first translation.  Therefore, thanks in advance to everyone who will help improve it and point out my mistakes. <br>  Thank. <br><br></div><p>Source: <a href="https://habr.com/ru/post/227075/">https://habr.com/ru/post/227075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227063/index.html">The developer spent 13 years to complete the game.</a></li>
<li><a href="../227065/index.html">Nokia Lumia 930: the flagship smartphone in detail</a></li>
<li><a href="../227067/index.html">The invention of social networks</a></li>
<li><a href="../227069/index.html">Some interesting and useful things for web developer # 19</a></li>
<li><a href="../227073/index.html">Video recordings of the Golang Moscow conference reports</a></li>
<li><a href="../227081/index.html">Metalworking - 2014, or the story of these robots</a></li>
<li><a href="../227083/index.html">The first jump into space the United States</a></li>
<li><a href="../227087/index.html">A little sunday infographic</a></li>
<li><a href="../227093/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ114 (June 15 - 21, 2014)</a></li>
<li><a href="../227095/index.html">Drones banned from flying in US national parks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>