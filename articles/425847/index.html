<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of using Microsoft Flow or How to give a wife flowers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Here I will demonstrate a not quite simple example of using Microsoft Flow to solve one practical problem. 

 Formulation of the problem 
 Sometimes t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of using Microsoft Flow or How to give a wife flowers</h1><div class="post__text post__text-html js-mediator-article">  Here I will demonstrate a not quite simple example of using <a href="https://emea.flow.microsoft.com/en-us/">Microsoft Flow</a> to solve one practical problem. <br><a name="habracut"></a><br><h2>  Formulation of the problem </h2><br>  Sometimes tasks for the programmer arise from everyday life.  It was one of those cases.  I wanted to give my wife flowers from time to time, say once a month.  But at the same time I did not want to do this on any particular date, for example, on the first day of the month.  Then it would not be a surprise.  I wanted randomization.  For example, the next time I give flowers should be a month after the previous one, plus / minus a couple of days. <br><br>  There is nothing special about these requirements.  It's easy enough to write a program that reminds me of these events.  But the desktop application has a significant drawback.  It will work only on one machine, while I have several (at home, at work, ...).  And there is a smartphone ... Wouldn't it be great to receive notifications on any of my devices? <br><br>  Well, you can save information about events in any online storage (for example, <a href="https://mlab.com/">Mlab</a> ).  In this case, all instances of my application will work with the same information, which will allow them to be synchronized with each other.  However, I will need to install these applications on all my computers.  In addition, I use Windows on computers and Android on a smartphone, so I have to write several different applications if I really want to receive my notifications everywhere.  How to overcome this problem?  Using the Web, of course. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If I create a Web application, I can use it on almost any device.  Wonderful!  But still not great enough.  Let me explain my point.  Although it is not so difficult to write a Web application that solves my problem, nevertheless, in this case, I will have to take care of a lot of things.  We need to think about hosting, about data storage, about storing code, ... And why?  Virtually all of the required functionality is already implemented in modern Web calendars, such as <a href="https://calendar.google.com/">Google Calendar</a> .  He can create events, make them repetitive, send me notifications about their occurrence, etc.  The only thing there isn't is randomization required by me.  Wouldn't it be great if I could just add this feature and use all the other features already available? <br><br>  When I thought about this problem, I came across the site <a href="https://ifttt.com/">IFTTT.com</a> .  The idea of ‚Äã‚Äãthis site is simple, but productive.  If something happens, he does something.  I know this sounds strange, so let me give you a number of examples.  If I received an email from a specific person, send me an SMS.  If my favorite author has posted a new article on his blog, let me know in Slack.  Or if it's time for a specific event in the Google Calendar, send me an email.  I hope now I understand what I am leading to.  This service can monitor certain events (they are called triggers) and perform some actions when these events occurred.  IFTTT supports a huge number of possible triggers and actions.  I could track my events in the Google Calendar, and when a certain event occurs, I would send myself a letter, delete the old event and add a new one for a later time.  Great!  Exactly what is required!  But not really. <br><br>  First of all, IFTTT allows only one action per trigger.  This is not such a big problem, because  You can create multiple applets with identical triggers (an applet is a combination of a trigger and an action in IFTTT).  One will send me a letter, the other will delete the old event, the third will create a new event.  But there is a more serious obstacle.  For the new event, I need to create a response time with randomization.  And I have not found how to do this in IFTTT.  This means that this service cannot solve my problem.  But maybe the Internet has other similar services?  Yes there is. <br><br>  The next site I reviewed was <a href="https://zapier.com/">Zapier</a> .  Here we can use several actions for one trigger, which is good.  But it is available only for money, which is not so good.  I have not played with Zapier for a long time, but I got the impression that it also does not provide the opportunity for randomization required by me.  Although here I may be wrong.  In any case, I moved on to the next candidate. <br><br>  It was <a href="https://emea.flow.microsoft.com/">Microsoft Flow</a> .  This service allows me to track 750 trigger triggerings per month for free.  It is more than enough for my needs.  Moreover, it has support for expressions, among which is the <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">rand ()</a> function!  This is exactly what you need.  Now let me show you how to solve the described problem using Microsoft Flow. <br><br><h2>  Decision </h2><br>  First you need to create a new flow.  A thread is a combination of a trigger and an action.  To do this, register on the site and in the main menu click on <b>My flows</b> , and then on <b>Create from blank</b> : <br><br><img src="https://habrastorage.org/webt/ta/ot/md/taotmd9huuab6qf0um9gm0fxtdg.png"><br><br>  Click the Create from blank button: <br><br><img src="https://habrastorage.org/webt/wj/pu/ff/wjpuffttc9rkemhmfqs6usxkzro.png"><br><br>  You will be asked to select a trigger.  Enter "calendar" in the search field and select <b>Google Calendar</b> : <br><br><img src="https://habrastorage.org/webt/zs/js/a4/zsjsa4t7lk5bnu4dlkm_jz3fjwc.png"><br><br>  In the list of available triggers for Google Calendar, select <b>When an event starts</b> : <br><br><img src="https://habrastorage.org/webt/nr/9d/an/nr9danjh88wvrwrrle1w24gr-k4.png"><br><br>  Here you may be asked to allow access from Microsoft Flow to the Google Calendar on your behalf. <br><br>  Now the trigger is ready.  Its only parameter is the calendar: <br><br><img src="https://habrastorage.org/webt/fp/cq/ku/fpcqkunselkoc8tawevzuq-8ofy.png"><br><br>  Yes, you can create multiple calendars in Google Calendar.  Each event belongs to one of the calendars, and you need to select a calendar whose events will trigger your actions. <br><br>  There is nothing wrong with creating a new calendar and putting into it all the events for which your actions should work.  But if not all events in the calendar need to be processed, you can use filtering.  Click <b>New step</b> and then <b>Add a condition</b> : <br><br><img src="https://habrastorage.org/webt/pm/3t/mx/pm3tmxubofw9vphcumof7y2lrja.png"><br><br>  This will create a filter for you.  Now we need to decide exactly how we want to filter the events.  For example, I want to process only those events that contain the text "[RANDOM]" in the "location" field.  To do this, click on the input field <b>Choose value</b> .  Microsoft Flow will show you a list of possible values ‚Äã‚Äãwith which you can work: <br><br><img src="https://habrastorage.org/webt/sc/in/m6/scinm6bjhlteamy_zepipipinaa.png"><br><br>  Click on <b>Event List Event Location</b> .  And fill in the remaining fields with the appropriate values: <br><br><img src="https://habrastorage.org/webt/wg/gr/ck/wggrckymb33gdbxkf4acc1gpgre.png"><br><br>  Pay attention to the link <b>Edit in advanced mode</b> .  She is very helpful.  If you click on it, you will get a representation of the same condition in the form of a text expression: <br><br><img src="https://habrastorage.org/webt/gi/wd/qm/giwdqm1tuuol4_6toyyqftuexjm.png"><br><br>  This is very helpful when it comes time to write your own expressions. <br><br>  Now you can add actions to our events.  In the <b>If yes</b> branch of your filter, click the <b>Add an action</b> link.  Here I‚Äôll create an action that will send me an event notification on Gmail: <br><br><img src="https://habrastorage.org/webt/dq/cb/mr/dqcbmr0elo1jl9e69ohquhugeee.png"><br><br>  As you can see, you can use data from your event to fill in the Subject, Body, and other properties of this action. <br><br>  Now we have notifications.  It's time to delete the old event in the calendar and create a new one for a later time.  Use the <b>Add an action</b> link to create the <b>Delete an event</b> action for Google Calendar: <br><br><img src="https://habrastorage.org/webt/ig/4l/fn/ig4lfnruxaspuotfva6e78fjs20.png"><br><br>  It should be said that it is quite possible to simply change the event in the calendar instead of deleting the old one and creating a new one.  But here I‚Äôll still stick to the last one to show you another possibility of Microsoft Flow.  Suppose I want to create a new event in the calendar did not happen after removing the old, but in parallel with this.  Hover the mouse over the arrow between the actions <b>Send email</b> and <b>Delete an event</b> .  A plus sign will appear on the screen.  Click on it and select <b>Add a parallel branch ‚Üí Add an action</b> in the context menu: <br><br><img src="https://habrastorage.org/webt/im/60/ho/im60homvgpu-3c1k32dfat2mwyu.png"><br><br>  Now we can add a parallel action <b>Create an event</b> from <b>Google Calendar</b> .  For this action, we will take the title, description, and location from our original event.  The only thing left to do is to set the start and end time of the new event: <br><br><img src="https://habrastorage.org/webt/xk/pn/_6/xkpn_6ubqnl6rusndzhbrbd2iqe.png"><br><br>  Now we come to the really interesting part.  We need to somehow add a random number of days to the start of the current event.  We will use this new date as the beginning of the event being created.  For example, I want to add 30 days plus / minus 2 days.  Documentation on the available features can be found <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">here</a> .  I admit, this is not a very simple reading.  I had a lot of questions, especially about how to extract the start time from the original event so that it can be used in functions.  Some help can be obtained from our filter.  Remember the link <b>Edit in advanced mode</b> : <br><br><img src="https://habrastorage.org/webt/wg/gr/ck/wggrckymb33gdbxkf4acc1gpgre.png"><br><br>  A click on it shows the corresponding expression: <br><br><img src="https://habrastorage.org/webt/m4/nq/ua/m4nquarjfn1lc_6x3vbnnfnncbu.png"><br><br>  This gave me some clue in writing my expressions.  Now click on the <b>Start time</b> field of the <b>Create an event event</b> and select the <b>Expression</b> tab: <br><br><img src="https://habrastorage.org/webt/4f/ox/iq/4foxiq439q8gqvobx8yx37nxe7w.png"><br><br>  In the input box, write the following expression: <br><br> <code>addDays(triggerBody()?['start'], add(30, rand(mul(2, -1), add(2, 1))))</code> <br> <br>  and click <b>Ok</b> .  This expression exactly solves our problem: it adds 30 days plus / minus 2 days to the start time of the original event.  But what if I need some flexibility?  What if I want to have several types of events?  For events of the first type, I will increase the start time by 30 days plus / minus 2 days, for events of the second type - by 14 days plus / minus 3 days, etc.  How is it possible to achieve this? <br><br>  Here is one way.  Remember that we store the string "[RANDOM]" in the "location" field of our events?  Now we will write additional information in this field.  Its content will be text in the format of "[RANDOM], NN, MM", where NN is two digits and MM is also two digits.  We will increase the time of occurrence of events for NN days plus / minus MM days.  When using this format, I can be sure that the characters in positions 9 and 10 (starting from 0) the lines will represent NN, and the characters in positions 12 and 13 will represent MM.  And here is an expression using this new information storage format to increase the start time of an event: <br><br> <code>addDays(triggerBody()?['start'], add(int(substring(triggerBody()?['location'], 9, 2)), rand(mul(int(substring(triggerBody()?['location'], 12, 2)), -1), add(int(substring(triggerBody()?['location'], 12, 2)), 1))))</code> <br> <br>  It uses the <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">substring</a> function to select the desired parts from the string, and the <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">int</a> function to convert them to integer form. <br><br>  Great!  We almost reached our goal.  It remains only to set the end time of the new event.  And here we meet our last obstacle.  It is necessary that the end time of an event be equal to the time of its beginning plus 15 minutes.  Microsoft Flow supports the <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">addMinutes</a> function, and one would write an expression like: <br><br> <code>addMinutes(&lt; &gt;, 15)</code> <br> <br>  However, due to the nature of the <a href="https://docs.microsoft.com/ru-ru/azure/logic-apps/workflow-definition-language-functions-reference">rand</a> function, as a result we will get a value that is not related to the value for the start time of the event.  Instead, it would be nice to have the 'nextStart' variable that stores the value of our expression.  Then you could use its value for the start time of the event, and use <br><br> <code>addMinutes(&lt;  'nextStart'&gt;, 15)</code> <br> <br>  for the time of its end.  And you know what?  Microsoft Flow supports variables.  First we need to initialize it.  Move the mouse over the arrow between the trigger and the filter.  Click the plus sign and select <b>Add action</b> : <br><br><img src="https://habrastorage.org/webt/wu/uu/7w/wuuu7wegtal_8pcblfewzycuvjk.png"><br><br>  Enter ‚ÄúVariables‚Äù in the search field and select <b>Initialize variable</b> : <br><br><img src="https://habrastorage.org/webt/ox/i-/mn/oxi-mnoo_8dp-b6ifc7uf5nmqgo.png"><br><br>  Specify the variable name 'nextStart' and the type "String".  Microsoft Flow does not have a separate type for dates and times, it uses strings everywhere. <br><br><img src="https://habrastorage.org/webt/zj/nq/yy/zjnqyyuztfp0vpdaw08qlkrhnqm.png"><br><br>  Now you need to set the value for this variable.  This cannot be done right here, since it is not yet known whether this event is correct.  Only after the filter can we be sure.  Therefore, we add another action like <b>Set variable</b> after sending the email notification: <br><br><img src="https://habrastorage.org/webt/8j/dq/v8/8jdqv8xv9e7t4y5whwmey-eifdk.png"><br><br>  Here we set the value of the created variable to our long expression.  It remains only to reuse this variable in the expressions for the start and end time of the event.  You can refer to a variable in an expression like this: <br><br> <code>variables('nextStart')</code> <br> <br>  Therefore, the expression for the end time of the event will be: <br><br> <code>addMinutes(variables('nextStart'), 15)</code> <br> <br><img src="https://habrastorage.org/webt/7_/jp/fm/7_jpfmmy8j-f7mw_lsuv-plxgwi.png"><br><br><h2>  Conclusion </h2><br>  That's the end of the story.  You just need to save the flow, and Microsoft Flow will launch it for us. <br><br>  I hope this article will be useful for you.  For me, Microsoft Flow has been a great task automation tool. </div><p>Source: <a href="https://habr.com/ru/post/425847/">https://habr.com/ru/post/425847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425835/index.html">"Breaking Bugs" in Sberbank: how to fix the seven-day rate of bugs per day</a></li>
<li><a href="../425837/index.html">Copy semantics and resource management in C ++</a></li>
<li><a href="../425839/index.html">Atlassian Conference Overview</a></li>
<li><a href="../425843/index.html">Python for the child: the choice of tutorial</a></li>
<li><a href="../425845/index.html">Auto-blocking apps on Google Play</a></li>
<li><a href="../425849/index.html">Amazon gave up and raised employee salaries</a></li>
<li><a href="../425851/index.html">Infer.NET: a powerful machine learning system is now OpenSource</a></li>
<li><a href="../425853/index.html">All conversational AI at the first Conversations conference</a></li>
<li><a href="../425855/index.html">Twitch made me better and helped me survive for the three darkest months in my life</a></li>
<li><a href="../425859/index.html">Regional operators oppose the abolition of roaming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>