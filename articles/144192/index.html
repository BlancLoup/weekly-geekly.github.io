<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimizing SQLite with NSCalendar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we solved the problem of incorrect use of the SQLite week based calendar by writing our own extension for this DBMS. 

 Our c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimizing SQLite with NSCalendar</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/754/bda/d60/754bdad602d6270475afdaa22396c2a7.png"><img src="https://habrastorage.org/getpro/habr/post_images/b73/5bb/70f/b735bb70fbf91c2aedf9ef0a46d34ce6.jpg"><br><br>  In the <a href="http://habrahabr.ru/post/144450/">previous article,</a> we solved the problem of incorrect use of the SQLite week based calendar by writing our own extension for this DBMS. <br><br>  Our calculation came together, but the speed of its work left much to be desired.  Processing a table containing only 2500 records took about 6 seconds.  While queries using strftime () were executed in tenths of a second. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before starting, I want to note that here and later, to simplify the presentation, error handling and the allocation of some classes are omitted.  Before discussing the code in the comments, do not be lazy to look at the page of the project dodikk / ESLocale. <br><br>  In the first approximation, our function looked like this: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { //       argc_, argv_ <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); //  ,   crash     NSString <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } //    NSString NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li></li><li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; //   .   en_US_POSIX    yyyy-MM-dd NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; //   .    ,   NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; // ,   NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li></li><li></li><li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; //   <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } else { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> ObjcFormatAnsiDateUsingLocale( sqlite3_context* ctx_, <font color="#0000ff">int</font> argc_, sqlite3_value** argv_ ) { assert( ctx_ ); <font color="#008000">//   </font> @autoreleasepool <font color="#008000">//   ObjC .</font> { <font color="#008000">//       argc_, argv_</font> <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawFormat_ = sqlite3_value_text( argv_[0] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawDate_  = sqlite3_value_text( argv_[1] ); <font color="#0000ff">const</font> unsigned <font color="#0000ff">char</font> * rawLocaleIdentifier_ = sqlite3_value_text( argv_[2] ); <font color="#008000">//  ,   crash     NSString</font> <font color="#0000ff">if</font> ( NULL == rawFormat_ || NULL == rawDate_ || NULL == rawLocaleIdentifier_ ) { sqlite3_result_error( ctx_, <font color="#A31515">"ObjcFormatAnsiDate - NULL argument passed"</font> , 3 ); <font color="#0000ff">return</font> ; } <font color="#008000">//    NSString</font> NSString* strDate_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawDate_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawDate_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* format_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawFormat_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawFormat_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; NSString* localeIdentifier_ = [ [ NSString alloc ] initWithBytesNoCopy: ( <font color="#0000ff">void</font> *)rawLocaleIdentifier_ length: strlen( ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)rawLocaleIdentifier_ ) encoding: NSUTF8StringEncoding freeWhenDone: NO ]; <font color="#008000">//   .   en_US_POSIX    yyyy-MM-dd</font> NSDateFormatter* ansiFormatter_ = [ ESLocaleFactory ansiDateFormatter ]; <font color="#008000">//   .    ,  </font> NSLocale* locale_ = [ [ NSLocale alloc ] initWithLocaleIdentifier: localeIdentifier_ ]; NSDateFormatter* targetFormatter_ = [ ESLocaleFactory gregorianDateFormatterWithLocale: locale_ ]; targetFormatter_.dateFormat = format_; <font color="#008000">// ,  </font> NSDate* date_ = [ ansiFormatter_ dateFromString: strDate_ ]; NSString* result_ = [ targetFormatter_ stringFromDate: date_ ]; <font color="#008000">//  </font> <font color="#0000ff">if</font> ( nil == result_ || [ result_ isEqualToString: <font color="#A31515">@""</font> ] ) { sqlite3_result_null( ctx_ ); } <font color="#0000ff">else</font> { sqlite3_result_text ( ctx_, ( <font color="#0000ff">const</font> <font color="#0000ff">char</font> *)[ result_ cStringUsingEncoding     : NSUTF8StringEncoding ], ( <font color="#0000ff">int</font> )[ result_ lengthOfBytesUsingEncoding: NSUTF8StringEncoding ], SQLITE_TRANSIENT <font color="#008000">//  SQLite   -</font> ); } } }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Having driven through the profiler, we saw that most of the time it took not the formatting of the text, but the creation of instances of NSDateFormatter (line 39..45). <br><br>  The model of using this function assumes a change of locale and format only between requests.  Within the limits of one request these parameters most likely will not change.  This leads us to a simple optimization idea. <br><br>  We will put the resource-intensive NSDateFormatter in some Singletone object.  Then the formatter will look like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  SqlitePersistentDateFormatter * fmt_ = [SqlitePersistentDateFormatter instance];  <font color="#008000">// create singletone</font> </li><li>  NSString * result_ = nil; </li><li>  @synchronized (fmt_) <font color="#008000">// formatting must be atomic and thread safe</font> </li><li>  { </li><li>  <font color="#008000">// update the format and locale if necessary</font> </li><li>  [fmt_ setFormat: format_ </li><li>  locale: localeIdentifier_]; </li><li></li><li>  <font color="#008000">// format the result</font> </li><li>  result_ = [fmt_ getFormattedDate: strDate_]; </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  And now it's time to look under the hood.  The implementation of thread-safe singletone is omitted as a classic task.  In the rest we get the following: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  @implementation SqlitePersistentDateFormatter </li><li>  { </li><li>  @ <font color="#0000ff">private</font> <font color="#008000">// our heavy objects</font> </li><li>  NSDateFormatter * ansiFormatter; </li><li>  NSDateFormatter * targetFormatter; </li><li>  } </li><li></li><li>  <font color="#008000">// ansiFormatter does not change, because it is standard</font> </li><li>  <font color="#008000">// therefore create it inside init.</font> </li><li>  - (id) init </li><li>  { </li><li>  self = [super init]; </li><li>  <font color="#0000ff">if</font> (nil == self) </li><li>  { </li><li>  <font color="#0000ff">return</font> nil; </li><li>  } </li><li></li><li>  self-&gt; ansiFormatter = [ESLocaleFactory ansiDateFormatter]; </li><li></li><li>  <font color="#0000ff">return</font> self; </li><li>  } </li><li></li><li></li><li>  <font color="#008000">// the most interesting thing here</font> </li><li>  - (BOOL) setFormat :( NSString *) dateFormat_ </li><li>  locale :( NSString *) locale_ </li><li>  { </li><li>  NSParameterAssert (nil! = Locale_); </li><li></li><li>  BOOL isNoFormatter_ = (nil == self-&gt; targetFormatter); </li><li>  BOOL isOtherLocale_ =! [Self-&gt; targetFormatter.locale.localeIdentifier isEqualToString: locale_]; </li><li></li><li></li><li>  <font color="#008000">// create a new NSDateFormatter only if the locale has changed</font> </li><li>  <font color="#0000ff">if</font> (isNoFormatter_ || isOtherLocale_) </li><li>  { </li><li>  NSCalendar * cal_ = [ESLocaleFactory gregorianCalendarWithLocaleId: locale_]; </li><li></li><li>  self-&gt; targetFormatter = [NSDateFormatter <font color="#0000ff">new</font> ]; </li><li>  [ESLocaleFactory setCalendar: cal_ </li><li>  forDateFormatter: self-&gt; targetFormatter]; </li><li>  } </li><li></li><li>  <font color="#008000">// set the date</font> </li><li>  self-&gt; targetFormatter.dateFormat = dateFormat_; </li><li></li><li>  <font color="#0000ff">return</font> YES; </li><li>  } </li><li></li><li></li><li>  <font color="#008000">// the main work has already been done.</font> </li><li>  <font color="#008000">// It remains only to apply harvested NSDateFormatter</font> </li><li>  - (NSString *) getFormattedDate :( NSString *) strDate_; </li><li>  { </li><li>  NSDate * date_ = [self-&gt; ansiFormatter dateFromString: strDate_]; </li><li>  NSString * result_ = [self-&gt; targetFormatter stringFromDate: date_]; </li><li></li><li>  <font color="#0000ff">return</font> result_; </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  So, we have a thread-safe, almost pure in terms of the FP function (pure function), which works in a time comparable to strftime. <br>  You can find the full version of the code on <a href="https://github.com/dodikk/ESLocale">github.</a> </div><p>Source: <a href="https://habr.com/ru/post/144192/">https://habr.com/ru/post/144192/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144186/index.html">How many daily downloads does an app need to get to the Top on the App Store?</a></li>
<li><a href="../144187/index.html">PHDays 2012 Master Classes: From Wi-Fi Network Protection to SAP and Web 2.0 Security</a></li>
<li><a href="../144188/index.html">About startups</a></li>
<li><a href="../144189/index.html">Analysis of the length of string data in web development: paranoia or necessity?</a></li>
<li><a href="../144190/index.html">Mailings on segments on the basis of MailChimp</a></li>
<li><a href="../144193/index.html">Optimization and Generics in the CLR</a></li>
<li><a href="../144195/index.html">Intel Architecture Code Analyzer 2.0.1</a></li>
<li><a href="../144196/index.html">CAT - Processor Cache Size Management</a></li>
<li><a href="../144197/index.html">Indexing AJAX sites by the Yandex search robot</a></li>
<li><a href="../144198/index.html">How I walked behind the backtrace</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>