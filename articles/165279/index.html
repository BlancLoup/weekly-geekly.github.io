<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A bit about creating demos, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 This article is primarily for beginners, those who only decided to take up the demoscene, if the article is positively accepted by the commun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A bit about creating demos, part 1</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  This article is primarily for beginners, those who only decided to take up the demoscene, if the article is positively accepted by the community, I will make a cycle of several articles on the creation of demos.  Each article will be short, but at the end of each article will be quite a working example. <br>  I'll warn you right away that this article is not about how to do Demo using OpenGL, DirectX, and millions of shaders. There are a lot of good articles about this, I will write about drawing in memory. <br><a name="habracut"></a><br><br><h4>  What to write? </h4><br>  First you need to figure out how and on what we will write a demo. <br>  We will write in C using Visual Studio 2008. <br><br><h4>  Several organizational moments </h4><br>  Let's first describe the TImage structure in the Images.h module; it will store information about the image: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TImage</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pBitMap; };</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Images.h, Images.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once struct TImage { int width; int height; unsigned char *pBitMap; }; void imgClearRGBA(struct TImage Image, unsigned char R, unsigned char G, unsigned char B, unsigned char A ); void imgClear(struct TImage Image, unsigned long color );</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Images */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Images.h"</span></span></span><span class="hljs-meta"> void imgClearRGBA(struct TImage Image, unsigned char R, unsigned char G, unsigned char B, unsigned char A ) { int i; for(i=0;i!=Image.width*Image.height*4;i=i+4) { Image.pBitMap[ i ] = B; Image.pBitMap[ i+1 ] = G; Image.pBitMap[ i+2 ] = R; Image.pBitMap[ i+3 ] = A; } } void imgClear(struct TImage Image, unsigned long color ) { unsigned long *pBitMap; int i; pBitMap = (unsigned long*)Image.pBitMap; for(i=0;i!=Image.width*Image.height;i++) { pBitMap[ i ] = color; } }</span></span></code> </pre><br></div></div><br><br>  And the image bitmap itself will be stored in the array to which pBitMap will point. <br><br>  Since we will not use OpenGL and DirectX, we must decide how we will display the pixels on the screen. <br>  The variant with SetPixel () does not suit us because of its slowness. <br>  The WinApi StretchDIBits () function comes to the rescue, it displays an array of pixels on the Handle, scaling in parallel, if necessary. <br>  Here is the function that displays an array, where each pixel consists of 4 bytes, on the screen: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct TImage Image)</span></span></span><span class="hljs-function"> </span></span>{ BITMAPINFO BitMapInfo; DC=GetDC(Wnd); BitMapInfo.bmiHeader.biSize=<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(BITMAPINFOHEADER); BitMapInfo.bmiHeader.biWidth=Image.width; BitMapInfo.bmiHeader.biHeight=Image.height; BitMapInfo.bmiHeader.biPlanes=<span class="hljs-number"><span class="hljs-number">1</span></span>; BitMapInfo.bmiHeader.biBitCount=<span class="hljs-number"><span class="hljs-number">32</span></span>; BitMapInfo.bmiHeader.biCompression=BI_RGB; StretchDIBits( DC, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, Image.width*PIXEL_SIZE, Image.height*PIXEL_SIZE, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, Image.width, Image.height, Image.pBitMap, &amp;BitMapInfo, DIB_RGB_COLORS, SRCCOPY ); ReleaseDC(Wnd, DC); }</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">SystemUtils.h, SystemUtils.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PIXEL_SIZE 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DISP_WIDTH 640 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DISP_HEIGHT 480 void DrawBuffer(struct TImage Image); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"windows.h"</span></span></span><span class="hljs-meta"> void SetHWND( HWND _Wnd );</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* SystemUtils */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"windows.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Images.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SystemUtils.h"</span></span></span><span class="hljs-meta"> static HWND Wnd; void SetHWND( HWND _Wnd ) { Wnd = _Wnd; } void DrawBuffer(struct TImage Image) { BITMAPINFO BitMapInfo; HDC DC; DC = GetDC(Wnd); BitMapInfo.bmiHeader.biSize = sizeof(BITMAPINFOHEADER);</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   BitMapInfo.bmiHeader.biWidth = Image.width;//   BitMapInfo.bmiHeader.biHeight = -Image.height;//  ,        BitMapInfo.bmiHeader.biPlanes = 1;//   -  1 BitMapInfo.bmiHeader.biBitCount = 32;// -    BitMapInfo.bmiHeader.biCompression = BI_RGB;//  BitMapInfo.bmiHeader.biSizeImage = Image.width*Image.height*32/8;//   StretchDIBits( DC, 0, 0, Image.width*PIXEL_SIZE, Image.height*PIXEL_SIZE, //    0, 0, Image.width, Image.height, //    Image.pBitMap, //     &amp;BitMapInfo, //  DIB_RGB_COLORS, //   SRCCOPY ); //   ReleaseDC(Wnd, DC); }</span></span></span></span></code> </pre><br></div></div><br><br>  The classic loop looks like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { ;   ; Pause(); }</code> </pre><br>  But we work in Windows, therefore we constantly have to process window messages, otherwise the user will get the impression that the program is frozen, because in any case we will call Pause (), why not process window messages in it? <br>  No, of course, you can use the State Machine, but who needs a giant and clumsy State Machine in the demo (I'm not talking about games). <br>  Look like pause.c will be like this: <br><br><div class="spoiler">  <b class="spoiler_title">Pause.h, Pause.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"windows.h"</span></span></span><span class="hljs-meta"> void SetMsg( MSG _Msg ); void SetPause( DWORD value ); void Pause(void);</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">//  timeGetTime   GetTickCount #define _USE_TIMEGETTIME #include "windows.h" #ifdef _USE_TIMEGETTIME #include "mmsystem.h" #pragma comment (lib,"winmm") #endif static MSG Msg; DWORD Time; DWORD OldTime; void SetMsg( MSG _Msg ) { Msg = _Msg; } void SetPause( DWORD value ) { if(value == 0)value = 1; Time = value; #ifdef _USE_TIMEGETTIME timeBeginPeriod(1);//    timeGetTime OldTime = timeGetTime()+Time; #else OldTime = GetTickCount()+Time; #endif } void Pause(void) { //   while (PeekMessage(&amp;Msg, 0, 0, 0, PM_NOREMOVE) != 0 ) { if (GetMessage(&amp;Msg, 0, 0, 0) ) { TranslateMessage(&amp;Msg); DispatchMessage(&amp;Msg); } } #ifdef _USE_TIMEGETTIME while( timeGetTime()&lt;OldTime)Sleep(1);//       OldTime = timeGetTime()+Time; #else while( GetTickCount()&lt;OldTime)Sleep(1);//       OldTime = GetTickCount()+Time; #endif }</span></span></code> </pre><br></div></div><br><br>  It is not very beautiful, but it works quite reliably. <br>  Lovers of multithreading can simply make a separate thread. <br><br>  It remains to create a window: <br><div class="spoiler">  <b class="spoiler_title">Main.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*           */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"windows.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"windowsx.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Demo.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SystemUtils.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Pause.h"</span></span></span><span class="hljs-meta"> static HWND Wnd; static MSG Msg; static WNDCLASS wndclass; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*    , ..     Windows          "".  -    */</span></span></span><span class="hljs-meta"> static POINT MouseInWin; static RECT WinRect; static int MoveWin = 0; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// window procedure LONG WINAPI WndProc ( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam) { LONG lRet = 1; POINT point; switch (uMsg) { case WM_LBUTTONDOWN: MoveWin = 1;//move window=true GetWindowRect( Wnd, &amp;WinRect ); point.x = GET_X_LPARAM(lParam); point.y = GET_Y_LPARAM(lParam); ClientToScreen( Wnd, (LPPOINT)&amp;point ); MouseInWin.x = point.x-WinRect.left; MouseInWin.y = point.y-WinRect.top; SetCapture(Wnd); break; case WM_MOUSEMOVE: GetCursorPos( (LPPOINT)&amp;point ); if(MoveWin)SetWindowPos( Wnd,0, point.x-MouseInWin.x, point.y-MouseInWin.y, WinRect.right-WinRect.left, WinRect.bottom-WinRect.top, 0); break; case WM_LBUTTONUP: MoveWin = 0;//move window=false ReleaseCapture(); break; case WM_RBUTTONUP: PostMessage(Wnd, WM_DESTROY, 0, 0); break; case WM_DESTROY: PostQuitMessage (0); ExitProcess( 0 ); break; default: lRet = DefWindowProc (hWnd, uMsg, wParam, lParam); break; } return lRet; } void CreateWin( HINSTANCE hInstance, HWND *Wnd) { const int ClientWidth = DISP_WIDTH*PIXEL_SIZE;//resolution * pixel size const int ClientHeight = DISP_HEIGHT*PIXEL_SIZE; RECT Rect = {0,0,ClientWidth,ClientHeight}; wndclass.style = CS_BYTEALIGNCLIENT; wndclass.lpfnWndProc = &amp;WndProc; wndclass.cbClsExtra = 0; wndclass.cbWndExtra = 0; wndclass.hInstance = 0; wndclass.hIcon = LoadIcon(0, L"idi_Application"); wndclass.hCursor = LoadCursor (0,IDC_ARROW); wndclass.hbrBackground = (HBRUSH)GetStockObject(GRAY_BRUSH); wndclass.lpszMenuName = L""; wndclass.lpszClassName = L"MainWindow"; RegisterClass(&amp;wndclass); *Wnd=CreateWindow( L"MainWindow", L"Demo", WS_POPUPWINDOW, // CW_USEDEFAULT,//x CW_USEDEFAULT,//y ClientWidth,//width ClientHeight,//height 0,// parent win 0,//menu hInstance, 0//other ); GetWindowRect(*Wnd,&amp;Rect); Rect.bottom = Rect.left+ClientHeight;//ClientHeight Rect.right = Rect.top+ClientWidth;//ClientWidth AdjustWindowRect(&amp;Rect, GetWindowLong(*Wnd,GWL_STYLE) ,0); SetWindowPos(*Wnd,0,Rect.left,Rect.top, Rect.right-Rect.left, Rect.bottom-Rect.top,0); ShowWindow(*Wnd, SW_SHOW ); UpdateWindow (*Wnd); } int WINAPI WinMain( HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) { CreateWin(hInstance, &amp;Wnd);//  SetHWND(Wnd); SetMsg(Msg); StartDemo(); return 0; }</span></span></span></span></code> </pre><br></div></div><br>  And create a module Demo.c, where the demo itself will be: <br><div class="spoiler">  <b class="spoiler_title">Demo.h, Demo.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDemo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;</code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Pause.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SystemUtils.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Images.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"math.h"</span></span></span><span class="hljs-meta"> static unsigned char BitMap[640*480*4];</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   static struct TImage Disp = {640,480,BitMap};// void StartDemo(void) { SetPause(16);//fps ~= 60 while(1) { // AARRGGBB imgClear(Disp,0xFF000000);//  DrawBuffer(Disp);//   Pause(); } }</span></span></span></span></code> </pre><br></div></div><br>  Now you can run! <br><img src="https://habrastorage.org/storage2/d8c/321/5ea/d8c3215ea423d5b4734b15436f0502ad.png"><br>  But for now, except for an empty window, we will not see anything, that's right, because in the cycle we only clear the buffer and copy it to the screen: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDemo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ SetPause(<span class="hljs-number"><span class="hljs-number">16</span></span>);<span class="hljs-comment"><span class="hljs-comment">//fps ~= 60 while(1) { // AARRGGBB imgClear(Disp,0xFF000000);//  DrawBuffer(Disp);//   Pause(); } }</span></span></code> </pre><br><br><h4>  Draw a point </h4><br><img src="https://habrastorage.org/storage2/7a7/c41/b9f/7a7c41b9f0fbbe1a4804911b11906b5e.png"><br>  Let's first draw a red point with coordinates x = 1, y = 1. <br>  The screen for us will look like this: <br><img src="https://habrastorage.org/storage2/bdf/342/384/bdf342384c84132d61cba03a66355702.png"><br>  Where each pixel of the image can be represented in the form of 4 unsigned char or one unsigned long: <br><img src="https://habrastorage.org/storage2/25b/888/af8/25b888af8444db06e0387b7fdfa5d0ce.png"><br><img src="https://habrastorage.org/storage2/1b4/a5f/8d4/1b4a5f8d430acf039b9c81887488df9b.png"><br>  The fact that gray is alpha, we will not touch it for now. <br><br>  Now we need to calculate by the formula (x + y * disp.width) &lt;&lt; 2 the position of the point in the array and add to it the offset for the red color, in our case it is equal to the 2nd.  (&lt;&lt; 2 is just a quick multiplication by 4 shift) <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDemo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x=<span class="hljs-number"><span class="hljs-number">1</span></span>, y=<span class="hljs-number"><span class="hljs-number">1</span></span>; SetPause(<span class="hljs-number"><span class="hljs-number">16</span></span>);<span class="hljs-comment"><span class="hljs-comment">//fps ~= 60 while(1) { // AARRGGBB imgClear(Disp,0xFF000000);//  Disp.pBitMap[( (x + y*Disp.width)&lt;&lt;2 )+2] = 255;//   DrawBuffer(Disp);//   Pause(); } }</span></span></code> </pre><br>  Now when you start you really see the red dot. <br><br><h4>  Draw gradient </h4><br><img src="https://habrastorage.org/storage2/235/7b5/e6c/2357b5e6c3e7b3c34bea24c74b17c57d.png"><br>  Now let's draw a gradient. <br>  To do this, we walk through all the pixels in the array using two nested loops, <br>  and using the formula Value = X / (Max_X / Max_Value), draw a gradient, and for the red and blue channel its own, which will give a beautiful picture. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDemo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x,y,line; SetPause(<span class="hljs-number"><span class="hljs-number">16</span></span>);<span class="hljs-comment"><span class="hljs-comment">//fps ~= 60 imgClear(Disp,0xFF000000);//  while(1) { for(y=0;y!=Disp.height;y++) { line = y*Disp.width; for(x=0;x!=Disp.width;x++) { Disp.pBitMap[( (x + line)&lt;&lt;2 )+0] = (unsigned char)( y/(Disp.height/256.0) );//B Disp.pBitMap[( (x + line)&lt;&lt;2 )+2] = (unsigned char)( x/(Disp.width/256.0) );//R } } DrawBuffer(Disp);//   Pause(); } }</span></span></code> </pre><br>  It immediately becomes obvious that this code can be highly optimized; you can do this if you want. <br><br><h4>  Simplest plasma </h4><br><img src="http://habrastorage.org/storage2/624/856/347/62485634702480fbfacc17f07e82e8bd.png"><br>  Let's draw the simplest plasma, however, until I explain the principle of its work, this is the topic of the next article.  I will only note that instead of the sin () function, a sine table is used here, which increases the speed several times. <br><div class="spoiler">  <b class="spoiler_title">Demo.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Pause.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SystemUtils.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Images.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"math.h"</span></span></span><span class="hljs-meta"> static unsigned char BitMap[640*480*4];</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   static struct TImage Disp = {640,480,BitMap};// static unsigned char SinT[256];//  static void CreatetSinT(void) { int i; for(i=0;i!=256;i++) { SinT[i] = (int)( sin( (i*3.14*2.0)/256.0) *128+128 ); } } void StartDemo(void) { int x,y,line; int tx1=0,ty1=0,tx2=0,ty2=0,tx3=0,ty3=0; int px1,py1,px2,py2,px3,py3; SetPause(16);//fps ~= 60 CreatetSinT(); imgClear(Disp,0xFF000000);//  while(1) { py1=ty1; py2=ty2; py3=ty3; for(y=0;y!=Disp.height;y++) { line = y*Disp.width; px1=tx1; px2=tx2; px3=tx3; for(x=0;x!=Disp.width;x++) { px1=px1+1; px2=px2+1; px3=px3+1; Disp.pBitMap[( (x + line)&lt;&lt;2 )+2] = (SinT[ px1&amp;255 ]+SinT[ py1&amp;255 ])&gt;&gt;1;//R Disp.pBitMap[( (x + line)&lt;&lt;2 )+1] = (SinT[ px2&amp;255 ]+SinT[ py2&amp;255 ])&gt;&gt;1;//G Disp.pBitMap[( (x + line)&lt;&lt;2 )+0] = (SinT[ px3&amp;255 ]+SinT[ (py3+63)&amp;255 ])&gt;&gt;1;//B } py1=py1+1; py2=py2+1; py3=py3+1; } tx1=tx1+1; ty1=ty1+1; tx2=tx2+2; ty2=ty2+2; tx3=ty3+3; ty3=ty3+3; DrawBuffer(Disp);//   Pause(); } }</span></span></span></span></code> </pre><br></div></div><br>  Download the source: <br>  <a href="">Empty window</a> <br>  <a href="">Point</a> <br>  <a href="">Gradient</a> <br>  <a href="">Plasma</a> <br>  In the next article we will talk about drawing plasma. <br>  I hope you were interested. <br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/165279/">https://habr.com/ru/post/165279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165265/index.html">Microsoft HDInsight. The cloudy (and not only) future of Hadoop</a></li>
<li><a href="../165269/index.html">Mouse Wheel Speed ‚Äã‚ÄãCounter</a></li>
<li><a href="../165273/index.html">Seven years of WPF: what has changed?</a></li>
<li><a href="../165275/index.html">The key difference between AngularJS and Knockout</a></li>
<li><a href="../165277/index.html">Latest news from KickStarter: the best of 2012 (in the form of infographics)</a></li>
<li><a href="../165283/index.html">Data Mining: Primary data processing using DBMS. Part 3 (Pivot Tables)</a></li>
<li><a href="../165285/index.html">How we ported the Silverlight application to Windows 8</a></li>
<li><a href="../165289/index.html">The course of the young soldier "Sell services web designer." Part 2 "The client is always wrong"</a></li>
<li><a href="../165293/index.html">VM Depot launched - a repository of virtual machine images on Linux for the Windows Azure community</a></li>
<li><a href="../165295/index.html">Catalana numbers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>