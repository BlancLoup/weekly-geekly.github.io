<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúDigital Lab‚Äù - communication with a smartphone via Bluetooth</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first two reviews ( 1 , 2 ), we introduced you to the composition and main features of the NR05 Digital Lab Kit from the Alphabet of the Electr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúDigital Lab‚Äù - communication with a smartphone via Bluetooth</h1><div class="post__text post__text-html js-mediator-article">  In the first two reviews ( <a href="https://geektimes.ru/company/masterkit/blog/269372/">1</a> , <a href="https://geektimes.ru/company/masterkit/blog/270714/">2</a> ), we introduced you to the composition and main features of the <a href="http://masterkit.ru/shop/studygoods/2016109">NR05</a> Digital Lab <a href="http://masterkit.ru/shop/studygoods/2016109">Kit</a> from the Alphabet of the Electronic Engineer series. <br><br><img src="https://habrastorage.org/files/60d/cd0/eda/60dcd0edaa2440eeaa5c8de7d6eb5117.jpg" width="600"><br><br>  We have repeatedly said that the possibilities of recruitment are not limited to the experiences and projects that comprise the training manual.  The possibilities of recruitment are much wider! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider how you can implement control of executive devices from your smartphone or tablet using the Digital Laboratory. <br><a name="habracut"></a><br>  The connection between the smartphone and the Arduino module installed on the expansion card will be carried out using Bluetooth technology.  Of course, this will limit the possibility of wireless control of a distance of about 10 meters, but at home, often more is not required.  Based on this technology, simple robots or home automation devices can be successfully controlled, and a telephone or a smartphone will serve as a free universal control panel, which can easily be reprogrammed to best solve the problem. <br><br>  There are several projects on the Internet that allow you to connect Arduino with a phone via Bluetooth, and such projects will certainly help to master the principle of such a connection, but their main drawback is the inability to adapt the control program functionality and its appearance to the specific needs of the user. <br><br>  We will take the path slightly more complicated, but more universal - we will write programs for the phone and for Arduino on our own.  This will help you understand the principle of writing such applications and use it in your own designs. <br>  To begin, let us explain the principle on which the link is based, which we will use.  As you know, when the Arduino module is connected to a computer, a virtual serial port is configured on the computer ‚Äî the COM port.  It is used to fill the sketches in Arduino, as well as for the exchange of information between the computer and the Arduino microcontroller.  Also on the Arduino board there are two contacts combined with pins D1 and D0 and denoted by RX and TX - respectively, the Receive and the Transmit of the standard UART interface. <br><br>  By connecting a Bluetooth-UART adapter to these contacts (the HC-05 module is at our disposal, it is not included in the kit) we will receive a hardware communication channel between the device connected via Bluetooth to the adapter and Arduino. <br>  Thus, by writing information from one device to the serial port and reading it from another (this can be done in two directions), we can organize the exchange of information between devices.  The speed of such an exchange between Arduino and the smartphone in the case of the use of the module HC-05 will be 57600 baud. <br><br>  For clarity, we use the RGB-LED and the servo as the actuators - both are controlled by PWM signals. <br><br>  Here is the wiring diagram of the project components: <br><br><img src="https://habrastorage.org/files/170/c42/377/170c4237756842c792d960bc99262a2d.jpg"><br><br>  To control the actuators, we will transmit a letter from the smartphone that determines which element the command is intended for and the number that corresponds to the command parameter.  The parameter can be a digit that determines whether it is necessary to enable or disable an actuator, or a digit that defines the PWM parameter. <br><br>  We give the text of the program for Arduino.  The program accepts data from the Bluetooth adapter, decrypts it and performs the necessary actions: turns the LED on or off, adjusts its brightness or the angle of rotation of the servo shaft. <br><br>  The text is supplied with a sufficient number of comments to understand the logic of the program: <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  // connect the libraries of the servo and LCD-indicator <br>  #include &lt;Servo.h&gt; <br>  #include &lt;LiquidCrystal.h&gt; <br>  // set 5 values ‚Äã‚Äãto determine the number of the pressed button <br>  // in the get_key function <br>  #define NUM_KEYS 5 <br>  int adcKeyVal [NUM_KEYS] = {30, 150, 360, 535, 760}; <br>  // create an instance of the LCD indicator object <br>  LiquidCrystal lcd (A1, A2, A3, 2, 4, 7); <br>  // create an instance of the servo object <br>  Servo servo; <br><br>  int btValue;  // variable to store the data received from the BT adapter <br>  char command;  // command coming from the COM port <br><br>  void setup () { <br><br>  // open the bluetooth COM port, clear it, set the timeout <br>  Serial.begin (57600); <br>  Serial.flush (); <br>  Serial.setTimeout (4); <br>  // initialize the LCD (16 characters, 2 lines) <br>  lcd.begin (16, 2); <br>  lcd.clear (); <br>  lcd.print ("Master Kit-READY"); <br>  delay (2000); <br>  lcd.clear (); <br>  // assign the 3rd digital pin to the servo <br>  servo.attach (3); <br><br>  pinMode (5, OUTPUT); <br>  pinMode (6, OUTPUT); <br>  pinMode (9, OUTPUT); <br>  digitalWrite (5, LOW); <br>  digitalWrite (6, LOW); <br>  digitalWrite (9, LOW); <br><br>  } <br><br>  void loop () { <br><br>  int key = get_key ();  // check if the button is pressed on the board and determine its number <br>  // if the button is pressed, send its number to the COM port <br>  // this number will be read by the smartphone <br>  if (key&gt; 0) { <br>  Serial.print (key); <br>  delay (500); <br>  } <br><br>  // if there is data that came via bluetooth, remember them <br>  if (Serial.available ()&gt; 0) { <br>  // read the first byte from the port (command) <br>  command = Serial.read (); <br>  // read the numbers from the port (command parameter) <br>  btValue = Serial.parseInt (); <br><br>  // display data received via bluetooth on LCD <br>  lcd.setCursor (0,0); <br>  lcd.print (command); <br>  lcd.print (''); <br>  lcd.print (btValue); <br>  lcd.print (""); <br><br>  delay (10); <br><br>  switch (command) { <br>  case 'P': // if the P command is received, then switch the colors of the LED <br>  pinSwitch (btValue); <br>  break; <br>  case 'S': // S - slider 1 (PWM red color) <br>  pwm5 (btValue); <br>  break; <br>  case 'M': // M - slider 2 (PWM servo) <br>  servo3 (btValue); <br>  break; <br><br><br>  } <br>  } <br>  } <br>  // function changes the state of the digital pin to the opposite <br>  void pinSwitch (int pin) { <br>  digitalWrite (Pin,! digitalRead (Pin)); <br>  } <br>  // function changes the PWM on pin 5 (the red color of the LED) <br>  void pwm5 (int pwmValue) { <br>  analogWrite (5, pwmValue); <br>  } <br>  // function changes the PWM on pin 3 <br>  void servo3 (int angleValue) { <br>  int angle = map (angleValue, 0, 180, 5, 180); <br>  servo.write (angle); <br>  } <br>  // function returns the number of the pressed button on the board <br>  int get_key () <br>  { <br>  int input = analogRead (A6); <br>  int k; <br>  for (k = 0; k &lt;NUM_KEYS; k ++) <br>  if (input &lt;adcKeyVal [k]) <br>  return k + 1; <br>  return 0; <br>  } <br><br></div></div><br><br>  Now let's do a program for the smartphone, which should send a command with a parameter.  We will use the MIT App Inventor project features for this. <br><br>  The MIT App Inventor is a programming environment developed at the Massachusetts Institute of Technology (MIT).  It serves to develop applications for mobile devices (smartphones and tablet computers) running on the Android operating system. <br><br>  This is not really a programming language in the conventional sense; when using it, it is not necessary to write textual code in the form of lines.  The program is formed in the form of blocks shown on the screen, which are simply dragged and folded like puzzles.  If the blocks fit together according to the logic of the program, they ‚Äústick together‚Äù; if they do not fit, then they cannot be joined.  Initially, this programming method was developed for teaching schoolchildren, so it is quite simple to learn.  Of course, as in every language it has its own subtleties and techniques, but the site has enough information and examples for mastering the language.  Many programs are posted on the site in the public domain. <br><br>  In order to use the App Inventor programming environment, available at ai2.appinventor.mit.edu, you must have a Google account with which you authorize on the project website.  Creating a program is made in any browser.  The computer running this browser must be constantly connected to the Internet.  The smartphone or tablet on which the program created using App Inventor will be installed must have Android OS version 4.0 or higher. <br><br>  In the browser, you create the design (appearance) and the logic of the program in the form of blocks, in the same place the finished project is compiled into an executable file with the apk extension.  This file can be downloaded and run on a mobile device in several ways.  Perhaps the most convenient of these methods is to install the MIT AI2 Companion application on the mobile device (it is in the Play Market).  App Inventor generates a QR code containing a link to the application you created, and AI2 Companion reads and installs (or updates) it.  You can even draw and load your icon to launch your application.  Thus, App Inventor allows you to create quite workable and visual applications for Android.  Let their code is not optimal, but the convenience, simplicity and speed of creating such applications in many cases completely compensate for this drawback. <br><br>  The application that works in our project is uploaded to the MIT AI2 Appiventor gallery under the name BToothHC05. <br>  The application allows you to find a Bluetooth device, connect to it, it forms commands with parameters and sends them to the connected device, reads data from the device and displays the number of the button pressed on the expansion card. <br><br>  The screen design looks like this: <br><br><img src="https://habrastorage.org/files/8a6/5b3/5d1/8a65b35d18c24c9ab9f5a52366085494.jpg"><br><br>  There are elements (green squares, symbolizing the inserted images) that do not carry functionality, but serve as separators to improve the appearance. <br><br>  If you have visited the AppInventor website and are in the programming environment in Designer mode, then when you right-click on the corresponding design element, you will see its properties on the right.  Turning to Blocks mode, you can see all the blocks of the developed application. <br><br>  Almost all of the blocks are essentially event handlers: pressing a button on the touchscreen, shifting the slider's slider, triggering a timer, changing the tilt of the phone (yes, almost all mobile device sensors can be used in App Inventor!). <br><br>  Consider the functionality of each block. <br><br><img src="https://habrastorage.org/files/beb/88e/151/beb88e151dac427e9596e8fd675bda70.jpg"><br><br>  In this block, when you press the Connect / Disconnect screen button (Button4Connect.Click event), the Bluetooth device disconnects (call BluetoothClient1.Disconnect) if it is already connected (BluetoothClient1.IsConnected), changes the text on the button to ‚ÄúDisconnected‚Äù and its color to gray, or calling the list of possible devices for connection (ListPicker1.Open) if there is no connection.  As you can see, the block is quite readable from the point of view of even a novice programmer! <br><br><img src="https://habrastorage.org/files/f77/5f8/cbc/f775f8cbc2f547abb95e25a09622f0ef.jpg"><br><br>  In these three blocks (from top to bottom): <br><br>  - assign a global variable (all blocks will ‚Äúsee‚Äù it) switch1 to switch operating modes: slider or tilt; <br>  - when you call up the list of ListPicker1 devices for connection, we need to display their addresses and names; <br>  - when selecting a device from the ListPicker1 list, connect to it, change the color of the button and display the text Connected to DeviceName.  The DeviceName is formed from a long character sequence;  8 characters starting from the 18th. <br><br><img src="https://habrastorage.org/files/aaa/3bc/fae/aaa3bcfae0354f6d952d2d7bd8d24bf0.jpg"><br><br>  The three blocks depicted above send the symbols ‚ÄúP5‚Äù, ‚ÄúP9‚Äù and ‚ÄúP6‚Äù through the established connection, which should turn on or off the red, green or blue color of the LED, respectively. <br><br><img src="https://habrastorage.org/files/70b/036/863/70b036863a85446eb05f60c6e777c14a.jpg"><br><br>  When the Slider1 slider, which controls the brightness of the red LED, is shifted, this block sends an ‚ÄúS‚Äù symbol and numbers corresponding to the position of the slider. <br><br><img src="https://habrastorage.org/files/ecc/817/d9f/ecc817d9f4c24bef8147df44b2a6b259.jpg"><br><br>  When Slider2, which controls the servo, is shifted, if the corresponding mode is on (switch1 = 0), we send the character M and the position of the slider. <br><br><img src="https://habrastorage.org/files/439/e7a/ba2/439e7aba25d14916af02f2ddef2ee1f7.jpg"><br><br>  If the tilt sensor mode of operation is enabled, the block sends M and a tilt angle of + 90 degrees to control the servo drive. <br><br><img src="https://habrastorage.org/files/b19/37e/91c/b1937e91c8194914b568094416d8b915.jpg"><br><br>  This block switches the operating modes of the servo drive from the slider or tilt sensor and accordingly changes the inscription on the button (Text) and its color (BackgroundColor). <br><br><img src="https://habrastorage.org/files/58f/f6c/5ec/58ff6c5ec8ce4a6d922a26f2fb3deae0.jpg"><br><br>  These two blocks are triggered by a timer event.  The first block (Clock1) every 0.1 seconds (this interval is set in the properties of Clock1 timer) checks for the presence of data on whether the button was pressed on the expansion card.  If the button was pressed, then for 1 second (the second block - Clock2) information about the number of the pressed button is displayed on the smartphone screen. <br>  Now let's take a look at the video of how the LED and the servo drive from the smartphone are actually controlled in accordance with our programs. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/YyiOyuXXTFo%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgWGmdtPmXaioqGGp2EQe6ZoVhMag" frameborder="0" allowfullscreen=""></iframe><br><br>  In the same way, a sufficiently large number of actuators connected to the Arduino can be controlled.  This does not require any tremendous work by the programmer when using AppInventor, and the programming of Arduino is quite simple and intuitive.  You can easily add or remove unnecessary program blocks and get the functionality you need. <br>  As can be seen from this material, an expansion board from the Digital Laboratory set allows using the Arduino add-on modules quite comfortably and visually. <br><br>  Application. <br><br>  Getting started in the MIT AppInventor programming environment. <br><br>  As we have already written, you need a Google account to work in the AppInventor project.  If you have a smartphone on Android, then you most likely already have such an account.  If not, you can get it by accessing Google on the following <a href="https://accounts.google.com/signup">link</a> . <br><br>  Next, go to the <a href="http://appinventor.mit.edu/">AppInventor</a> website and click the Create Apps! Link, which is located in the upper right corner of the main page of the site, go to the programming environment website. <br><br>  As an illustration, below is a link to a small video demonstrating the creation of a simple program that displays text when you click on a button formed on the touchscreen of a smartphone. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/zd2RBySCihc%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyy5gTLeJF889-5xp-l-ed8RYVzw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/391383/">https://habr.com/ru/post/391383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../391373/index.html">The U8 Nucleus smart watch sends encrypted data to an unknown Chinese IP address</a></li>
<li><a href="../391375/index.html">Personal experience: gaming peripherals</a></li>
<li><a href="../391377/index.html">Project Soli: type the text using the "radar for the fingers" from Google</a></li>
<li><a href="../391379/index.html">Astronomers have detected repetitive fast radio pulses - possibly from different types of sources.</a></li>
<li><a href="../391381/index.html">What is ili pika?</a></li>
<li><a href="../391385/index.html">First tour of Blue Origin Headquarters</a></li>
<li><a href="../391387/index.html">Why is the solar system flat? [Vert Dider Voice]</a></li>
<li><a href="../391389/index.html">Happy man who managed to realize all his dreams and intentions. Admiral-engineer and academician A.I. Berg and Ki-Berg-Netika</a></li>
<li><a href="../391393/index.html">Wrong honey: French beekeeper has learned to make hemp honey</a></li>
<li><a href="../391395/index.html">PCB Ruler. The ruler of radio amateur and crowdfunding in Vkontakte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>