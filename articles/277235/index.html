<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Preparing ASP.NET Core: how to present static content as resources</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue our column on the topic ASP.NET Core by another publication from Dmitry Sikorsky ( DmitrySikorsky ) - the head of the company ‚ÄúYubreinians...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Preparing ASP.NET Core: how to present static content as resources</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>We continue our column on the topic ASP.NET Core by another publication from Dmitry Sikorsky ( <a href="https://habrahabr.ru/users/dmitrysikorsky/" class="user_link">DmitrySikorsky</a> ) - the head of the company ‚ÄúYubreinians‚Äù from Ukraine.</i>  <i>In his article, Dmitry talks about the experience of working with static content in the form of resources outside the main project assembly in ASP.NET Core.</i>  <i>Previous articles from the column can always be read on the link <a href="http://habrahabr.ru/search/%3Fq%3D%255B%2523aspnetcolumn%255D%26target_type%3Dposts">#aspnetcolumn</a> - Vladimir Yunev</i> </blockquote>  Sometimes it is necessary that static content (such as JS, CSS files or images) be located, for example, outside the main assembly of a web application as resources.  In this small article I will talk about two approaches to solving this problem. <br><br><h3>  Preparing a project with resources </h3><br>  First, we need a project with resources.  For example, let's add one CSS file to the resources (which will make all the text on the page red) and one picture.  For this we need the files themselves, as well as, approximately the following line in the project.json file of our project: <br><br><pre><code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"resource"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Styles/**"</span></span>, <span class="hljs-string"><span class="hljs-string">"Images/**"</span></span> ]</code> </pre> <br>  That's all, now after the project is assembled, the entire contents of the Styles and Images folders will turn into resources (obviously, you can specify really specific files, and not entire folders, if there is a need for this). <br><blockquote> <a href="https://github.com/DmitrySikorsky/AspNet5Resources"><img title="aspnetcolumngithub" alt="aspnetcolumngithub" src="https://habrastorage.org/files/e5a/eff/108/e5aeff1080f44ada899062dee76a3e24.png" width="240" align="right" height="88"></a>  <b>Tip!</b>  You can try everything yourself or by downloading the source code from GitHub <a href="https://github.com/DmitrySikorsky/AspNet5Resources">https://github.com/DmitrySikorsky/AspNet5Resources</a> . </blockquote>  By the way, when adding files to resources, the ‚Äútree‚Äù of their location becomes ‚Äúflat‚Äù, and all the characters ‚Äú\‚Äù in the file path turn into points.  That is, the information about the original location is lost (given that file names may contain dots).  For example, the file \ Styles \ test.css added to the resources in the AspNet5Resources.Resources project will have the following name (register has a value): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>AspNet5Resources.Resources.Styles.test.css</i> <br><br>  Fortunately, we do not need to write the name of the assembly each time (in this case, AspNet5Resources.Resources) when retrieving content from resources.  To do this, when creating the EmbeddedFileProvider, it is specified as the base namespace (see below). <br><a name="habracut"></a><br><h3>  Resource usage </h3><br>  We can use the content added to the project in the form of resources in at least two ways: implement everything yourself or use a ready-made implementation.  Both ways are very simple. <br><br>  To implement everything yourself, you need to add to the project using the content from the resources (it does not matter if the resources are located in this assembly or another), the controller that will extract the requested resources by their names and write them to the output stream: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ResourceController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { Assembly assembly = Assembly.Load(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AssemblyName(<span class="hljs-string"><span class="hljs-string">"AspNet5Resources.Resources"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fullName = assembly.GetName().Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + name; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (assembly.GetManifestResourceNames().Contains(fullName)) { Stream stream = assembly.GetManifestResourceStream(fullName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Stream(stream); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.HttpNotFound(); } }</code> </pre><br>  To simplify the work with the output stream, our own StreamResult class, inherited from ActionResult, is used here: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StreamResult</span></span> : <span class="hljs-title"><span class="hljs-title">ActionResult</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Stream stream; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StreamResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream stream</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stream = stream; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecuteResultAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ActionContext actionContext</span></span></span><span class="hljs-function">)</span></span> { HttpResponse httpResponse = actionContext.HttpContext.Response; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.stream.CopyToAsync(httpResponse.Body); } }</code> </pre><br>  This is enough to be able to display a picture of the resources in this way: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/resource?name=Images.test.png"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Now we will use the out-of-the-box implementation. <br><br>  First of all, we need to implement the IFileProvider interface so that, as a result, our class (let's call it CompositeFileProvider) can combine several different providers.  The whole class can be viewed in the source code (link at the end of the article), but the key point is the following: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IFileInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFileInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> subpath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (IFileProvider fileProvider <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fileProviders) { IFileInfo fileInfo = fileProvider.GetFileInfo(subpath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; fileInfo.Exists) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fileInfo; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NonexistentFileInfo(subpath); }</code> </pre><br>  That is, in fact, when searching for a file, our class simply goes through all the available providers in search of the one in which this file exists. <br><br>  So that our application can use both physically existing files and files from resources, let's create an instance of our CompositeFileProvider in this way: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IFileProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFileProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { IEnumerable&lt;IFileProvider&gt; fileProviders = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IFileProvider[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhysicalFileProvider(path) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompositeFileProvider( fileProviders.Concat( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Assembly[] { Assembly.Load(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AssemblyName(<span class="hljs-string"><span class="hljs-string">"AspNet5Resources.Resources"</span></span>)) }.Select(a =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmbeddedFileProvider(a, a.GetName().Name)) ) ); }</code> </pre><br>  Next, we need to "register" our provider when starting the application in the Startup class: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Startup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationEnvironment applicationEnvironment, IHostingEnvironment hostingEnvironment</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.applicationBasePath = applicationEnvironment.ApplicationBasePath; hostingEnvironment.WebRootFileProvider = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetFileProvider(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.applicationBasePath); }</code> </pre><br>  After that, we can use content from resources in a more familiar way: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Styles.test.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><h3>  findings </h3><br>  Personally, I prefer the second option, since it is more like the use of regular files (despite the fact that files are extracted from resources).  If, for example, do not use dots in the file names, then you can even replace all the dots in the resource names, except the last one, with the ‚Äú\‚Äù symbol and thus ‚Äúrestore‚Äù the original location and have a more visual URL, but this is not so important. <br><br>  As always, I prepared a small test project so that you can immediately start everything and see with your own eyes: <a href="https://github.com/DmitrySikorsky/AspNet5Resources">github.com/DmitrySikorsky/AspNet5Resources</a> . <br><br><h3>  To authors </h3><br>  Friends, if you are interested in supporting the column with your own material, please write to me at <a href="">vyunev@microsoft.com</a> to discuss all the details.  We are looking for authors who can interestingly tell about ASP.NET and other topics. <br><br><img align="right" width="250" src="https://habrastorage.org/files/afc/bc1/126/afcbc1126db747c8977cf60207b9c6fa.jpg"><h3>  about the author </h3><br>  <b>Sikorsky Dmitry Alexandrovich</b> <br>  Jubreynians Company (http://ubrainians.com/) <br>  Owner, Head <br>  <a href="https://habrahabr.ru/users/dmitrysikorsky/" class="user_link">DmitrySikorsky</a> </div><p>Source: <a href="https://habr.com/ru/post/277235/">https://habr.com/ru/post/277235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277209/index.html">Installing and configuring Yii2 on a shared hosting</a></li>
<li><a href="../277221/index.html">Nominal rows for JavaScript and GOST-28884-90</a></li>
<li><a href="../277229/index.html">Professional programming for artificial intelligence systems in PROLOG</a></li>
<li><a href="../277231/index.html">Training courses. Training</a></li>
<li><a href="../277233/index.html">How graph databases help fight e-commerce fraud</a></li>
<li><a href="../277237/index.html">How do we decide what to do?</a></li>
<li><a href="../277239/index.html">How not to recover data, or so lucky for you too</a></li>
<li><a href="../277241/index.html">Pattern recognition. Beginning theory</a></li>
<li><a href="../277243/index.html">Useful links for warranty verification</a></li>
<li><a href="../277245/index.html">Implementing multi-level undo / redo functionality using the example of a spreadsheet prototype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>