<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kubernetes 1.9: a review of major innovations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The next release of the system Kubernetes, 1.9, should happen this week. According to the current plan , it will happen today (December 13). We alread...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kubernetes 1.9: a review of major innovations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/48b/c2d/ec0/48bc2dec061e42928e98c92cbbadf968.png"><br><br>  The next release of the system Kubernetes, 1.9, should happen this week.  According to the <a href="">current plan</a> , it will happen today (December 13).  We already know about the main innovations that this issue will bring: just like <a href="https://habrahabr.ru/company/flant/blog/338230/">last time</a> , there are really a lot of them.  We present an overview of the most significant changes that come to Kubernetes with the upcoming release of 1.9. <a name="habracut"></a><br><br>  When writing this article were used: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  official draft <a href="https://docs.google.com/document/d/1veHHyDH9VoNTwP6yy9u2Q7Jj1hnBJGVPv3NPHInImgU/edit">K8s 1.9 Release Notes</a> ; </li><li>  table for <a href="https://docs.google.com/spreadsheets/d/1WmMJmqLvfIP8ERqgLtkKuE_Q2sVxX8ZrEcNxlVIJnNc/edit">Kubernetes Features OSS tracking board</a> developers <i>(note that some of its data disagree with reality, because not all of the features listed there managed to be completed for release)</i> ; </li><li>  <a href="">CHANGELOG-1.9</a> . </li></ul><br>  ... and, of course, endless issues and pull requests in the project's GitHub repositories. <br><br><h2>  API </h2><br><h3>  Redesign Event API </h3><br>  The event API architecture (and the <i>EventRecorder</i> library) <a href="https://github.com/kubernetes/features/issues/383">implements</a> changes aimed at improving in two ways: <br><br><ol><li>  Reduce the impact of events on overall <b>cluster performance</b> . </li><li>  To make the <code>Event</code> object <b>more structured</b> in order to simplify further work with it (‚Äúthe first and necessary step for being able to automate its analysis‚Äù). </li></ol><br>  Among the problems solved by these changes: <br><br><ul><li>  Now events send too many messages (for example, the impossibility of scheduling a submission generates an event every few seconds); </li><li>  the semantics of events is not always clear (for example, there is no distinction between the reasons for generating an event and the reasons for taking any action related to the event); </li><li>  increased load on the cluster due to events in case of any problems (for example, the user has created much more pods than the cluster is able to withstand, which leads to repeated errors in their planning); </li><li>  ... </li></ul><br>  Comparison of old and new <code>Event</code> objects: <br><br><img src="https://habrastorage.org/webt/lj/ie/my/ljiemy7dqprlv0sqa3xend_eqxc.png"><br><br>  In detail, all this is described in design-proposals: <a href="">events-redesign</a> .  The current status is alpha version. <br><br><h3>  Admission webhooks </h3><br>  <a href="https://github.com/kubernetes/features/issues/492">A</a> beta version of a mechanism called <i>admission webhooks has been added</i> that allows you to <b>modify and / or accept and reject</b> API <b>requests</b> .  It refers to the <i>admission control</i> phase and is triggered at the last request processing steps before they are saved to the database (etcd).  At their core, these webhooks are similar to initializers <i>(we wrote about them in the translation article ‚Äú <a href="https://habrahabr.ru/company/flant/blog/342658/">What happens in Kubernetes when starting the kubectl run? Part 1</a> ‚Äù)</i> , however: <br><br><ul><li>  apply to all actions (creation, modification, deletion); </li><li>  performed synchronously (i.e., long delays are not allowed); </li><li>  Objects for which hooks are executed are not available until they are executed. </li></ul><br>  An example of using <i>admission webhooks</i> from documentation is to check one object field and set a value for its other field.  Another example is the automatic addition of a service container (for example, performing a backup) according to the annotation of the sub.  For example, we have a sub under MySQL, with one container (in which MySQL itself), and this pod has a special annotation.  When we create a request, the request comes to the Kubernetes API, which sends the request to our application via <i>admission webhook</i> , and the application sees the request, sees what is created under, sees its special annotation and does just <i>rewrite</i> - it adds to the second container. <br><br>  A detailed description of <i>admission webhooks</i> published <a href="">here</a> . <br><br><h3>  Workload API </h3><br>  Workload API was introduced in the last Kubernetes release and combined the workload-related interfaces: <code>DaemonSet</code> , <code>Deployment</code> , <code>ReplicaSet</code> , <code>StatefulSet</code> .  For them, a separate API group called <code>apps</code> was allocated, and with the release of K8s 1.9, all these changes <b>received a stable status</b> . <br><br>  The main changes in the Workload API, presented in the releases Kubernetes 1.8 and 1.9, are summarized in the <a href="https://kubernetes.io/docs/reference/workloads-18-19/">project documentation</a> . <br><br><h3>  Other </h3><br><ul><li>  Condition support has been <a href="https://github.com/kubernetes/kubernetes/pull/55268">added to the</a> <code>StatefulSet</code> (and <code>DaemonSet</code> ) state, making them compatible with other <code>core/v1</code> controllers. </li><li>  The <code>--chunk-size={SIZE}</code> flag has <code>--chunk-size={SIZE}</code> added to <code>kubectl get</code> , and the support for restricting data output by the API (API chunking) has generally received beta status. </li></ul><br><h2>  Storage </h2><br><h3>  Out-of-Tree Volume Plugins (CSI) </h3><br>  The available volume plug-ins are included in Kubernetes: they are called ‚Äúin-tree‚Äù, because all the code is included in the main project repository, and in compiled form they are distributed as part of the K8s binaries.  This approach has an obvious disadvantage: the <b>support of third-party repositories by</b> their manufacturers / developers depends on the release cycles of Kubernetes (besides, all the source code must be Open Source).  In part, this problem is solved by the <a href="">Flexvolume</a> plugin, but this mechanism does not guarantee backward compatibility and (when installing the driver) requires deploying its files to specific locations on nodes and wizards. <br><br>  The new approach is called <a href="https://github.com/kubernetes/features/issues/178">Out-of-Tree CSI Volume Plugins</a> <i>(CSI is the Container Storage Interface, which defines how container orchestration systems can use third-party storage)</i> .  It is designed to implement a full-fledged API in Kubernetes, which allows you to: <br><br><ul><li>  create volumes ‚Äúout of the tree‚Äù (Kubernetes repository); </li><li>  do not require the inclusion of compiled code in K8s binary files; </li><li>  do not require direct access to Kubernetes machines to deploy these plug-ins (drivers). </li></ul><br>  The authors proposed the following recommended mechanism for deploying CSI drivers in Kubernetes: <br><br><img src="https://habrastorage.org/webt/z8/uz/jm/z8uzjmms4dtd_sau5yrtucar0hm.png"><br><br>  The explanations for this scheme and the details of the project as a whole are published in <a href="">this document</a> .  Implementation status in Kubernetes 1.9 - alpha version. <br><br><h3>  Running mount inside the deck </h3><br>  The <a href="https://github.com/kubernetes/features/issues/278">feature</a> called <a href="https://github.com/kubernetes/features/issues/278">Containerized mounts</a> introduces to Kubernetes the ability to run mount utilities <b>on the sub, and not on the host machine</b> .  Thus, the host system can remain a minimal GNU / Linux distribution without third-party software: to create Ceph RBD ( <code>/usr/bin/rbd</code> ), mount GlusterFS ( <code>mount.glusterfs</code> ), etc., and all utilities for working with volumes (operations provision / delete, attach / detach, mount / unmount) are placed in the slots. <br><br>  Details about this feature are published in design-proposals: <a href="">containerized-mounter-pod</a> .  The current status is alpha version. <br><br><h3>  Resizing volumes </h3><br>  Basic <a href="https://github.com/kubernetes/features/issues/284">support</a> for the resize operation for existing PV ( <code>PersistentVolume</code> ) appeared in Kubernetes 1.8.  By 1.9, it still did not reach the beta version, however, significant progress is evident: added support for resizing for file systems, and with it for <b>GCE, EBS, Cinder, and also <a href="https://github.com/kubernetes/kubernetes/pull/52767">Ceph RBD</a></b> volumes.  A beta version is expected for release 1.10. <br><br><h3>  Other </h3><br><ul><li>  The removal of <code>PersistentVolumeClaims</code> used by any of the pods is now <a href="https://github.com/kubernetes/features/issues/498">prevented</a> (alpha version). </li><li>  The <code>volumeMode</code> and <code>volumeDevice</code> for PV ( <code>PersistentVolume</code> ) options <a href="https://github.com/kubernetes/features/issues/351">allow you to</a> directly use block raw devices instead of the file system (alpha version). </li></ul><br><h2>  Network </h2><br><h3>  IPv6 support </h3><br>  <a href="https://github.com/kubernetes/features/issues/508">Implemented</a> basic IPv6 support, providing "all Kubernetes capabilities on an IPv6 network instead of IPv4."  At the moment, this <b>implementation is in the alpha version</b> and includes: <br><br><ul><li>  support for deploying Kubernetes clusters in the ‚ÄúIPv6 only‚Äù mode; </li><li>  support for deployment of a cluster with IPv6 via <i>kubeadm</i> ; </li><li>  support K8s control plane and data plane; </li><li>  iptables <i>kube-proxy</i> backend support using ip6tables; </li><li>  use of CNI 0.6.0 assembly for the IPv6 network; </li><li>  IPv6 support in <i>kube-dns</i> via SRV records </li><li>  restrictions: only <code>bridge</code> and <code>local-ipam</code> were checked from CNI plugins;  lack of support for HostPorts;  The netmask for the sub / cluster must be / 66 or more. </li></ul><br><h3>  Other </h3><br><ul><li>  An experimental mode has <i>been</i> <a href="https://github.com/kubernetes/kubernetes/pull/52501">added to</a> <i>kubeadm</i> , in which <b>CoreDNS is</b> used instead of <i>kube-dns</i> .  More details about the progress of the project CoreDNS we wrote <a href="https://habrahabr.ru/company/flant/blog/344098/">here</a> . </li><li>  The IPVS mode in <i>kube-proxy</i> , first introduced in K8s 1.8, has switched to beta status. </li></ul><br><h2>  Other components and changes </h2><br><h3>  Scheduler </h3><br>  The cluster resource release mechanism ( <i>pod preemption</i> ) has been improved thanks to the support of <a href="https://github.com/kubernetes/kubernetes/pull/56178"><code>PodDisruptionBudget</code></a> and <a href="https://github.com/kubernetes/kubernetes/pull/55933"><i>nominated pods</i></a> .  In addition, the scheduler added support for a new type of queue, <a href="https://github.com/kubernetes/kubernetes/pull/55109">based</a> on priorities (the first will be scheduled pods with the highest priority). <br><br>  When <a href="https://kubernetes.io/docs/concepts/configuration/overview/">using</a> <a href="https://kubernetes.io/docs/api-reference/v1.8/"><code>hostPort</code></a> , the pod <a href="https://github.com/kubernetes/website/pull/5931/files">has the</a> opportunity to listen to the same port on different IP addresses. <br><br><h3>  Authentication and Security </h3><br>  An important innovation from SIG Auth is <a href="https://github.com/kubernetes/features/issues/502"><b>ClusterRole Aggregation</b></a> for the ability to add <i>permissions</i> to existing ones, i.e.  roles built into RBAC ( <code>admin</code> , <code>edit</code> , <code>view</code> ). <br><br>  You can also note that: <br><br><ul><li>  Support for <code>*/subresource</code> format has been <a href="https://github.com/kubernetes/kubernetes/pull/53722">added to</a> RBAC policy rules (for example, <code>*/scale</code> will include <code>replicationcontroller/scale</code> ; </li><li>  In <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/"><code>PodSecurityPolicy</code></a> , noticeable improvements have been made, including a multiple <a href="https://github.com/kubernetes/kubernetes/pull/55643">increase in performance</a> when using a large number of policies in a cluster <i>(authorization now only takes place for valid sub-policies, not all cluster policies)</i> and <a href="https://github.com/kubernetes/kubernetes/pull/55509">support for</a> <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">K8s add-ons</a> . </li></ul><br><h3>  CLI </h3><br>  The feature name <a href="https://github.com/kubernetes/features/issues/491">kubectl diff</a> speaks for itself: this is a new command that allows you to <b>view the differences</b> between the locally described Kubernetes object and the current state of the real object (in the cluster).  The current status is alpha version. <br><br>  The option <code>--etcd-upgrade</code> added to <code>kubeadm upgrade apply</code> , which performs an <b>upgrade to etcd</b> in sub-versions to a version that is officially supported by the target release Kubernetes (3.1.10 in the case of K8s 1.9). <br><br>  <i>Kubeadm</i> <a href="https://github.com/kubernetes/kubernetes/pull/55803">has</a> <i>added</i> support for <i>Kubelet Dynamic Configuration</i> , which means that it is possible to <i>roll out kubelet</i> configurations to a working cluster (the feature itself first <a href="https://github.com/kubernetes/features/issues/281">appeared</a> in the previous version of Kubernetes and retains the status of the alpha version with the prospect of increasing to beta in K8s 1.10). <br><br><h3>  Windows </h3><br><ul><li>  Through <i>kubeadm</i> , <a href="https://github.com/kubernetes/kubernetes/pull/53553">you can</a> now <a href="https://github.com/kubernetes/kubernetes/pull/53553">add</a> work nodes with <b>Windows</b> to the cluster. </li><li>  <i>Kubelet now</i> <a href="https://github.com/kubernetes/kubernetes/pull/51240">has</a> support for specifying mount paths in Windows format, not just absolute Linux paths, as it was before. </li></ul><br><h3>  Openstack </h3><br>  Improved integration with the cloud platform: <br><br><ul><li>  Cinder v3 API support added and Cinder version detection fixed; </li><li>  OpenStack LBaaS v2 Provider has become customizable; </li><li>  OpenStack Octavia v2 (not only Neutron LBaaS v2) can now be used for load balancing; </li><li>  extended support for OpenStack security groups. </li></ul><br><h3>  Other changes </h3><br><ul><li>  Validation of third-party resources defined through <i>Custom Resource Definition (CRD)</i> , received the status of a beta version, and also <a href="https://github.com/kubernetes/kubernetes/pull/52753">added a</a> sample of the CRD controller. </li><li>  A <i>cloud-controller-manager has been</i> <a href="https://github.com/kubernetes/kubernetes/pull/54197">added to the</a> <a href="https://github.com/kubernetes/kubernetes/tree/master/cluster/images/hyperkube"><b>hyperkube</b></a> (a binary file that includes all Kubernetes server components). </li><li>  Upgrading cAdvisor to 0.28.1 added support for monitoring containerd. </li><li>  AppArmor can now be disabled by setting the profile to <code>unconfined</code> . </li><li>  When you start <i>kubelet</i> , the dependency on Docker is no longer checked. </li><li>  The format of container logs in <b>CRI has</b> learned to break long lines into several lines, and fluentd has added support for logs in CRI format. </li></ul><br><h2>  Compatibility </h2><br><ul><li>  The supported <b>etcd</b> version is 3.1.10 (in Kubernetes 1.8 was 3.0.17). </li><li>  Proven <b>Docker</b> versions range from 1.11.2 to 1.13.1 and 17.03.x. </li><li>  <b>Go</b> version - 1.9.2 (instead of 1.8.3), minimum supported - 1.9.1. </li><li>  <b>CNI</b> version is 0.6.0. </li></ul><br><h2>  PS </h2><br>  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/344098/">Four releases 1.0 from CNCF and major announcements about Kubernetes from KubeCon 2017</a> ‚Äù; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/338230/">Kubernetes 1.8: review of major innovations</a> ‚Äù; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/332160/">Docker 17.06 and Kubernetes 1.7: key innovations</a> ‚Äù; </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/331188/">Our experience with Kubernetes in small projects</a> " <i>(video of the report, which includes an introduction to the technical device Kubernetes);</i> </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/341760/">Infrastructure with Kubernetes as an affordable service</a> ." </li></ul></div><p>Source: <a href="https://habr.com/ru/post/344220/">https://habr.com/ru/post/344220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344204/index.html">Performance mdadm raid 5,6,10 and ZFS zraid, zraid2, ZFS striped mirror</a></li>
<li><a href="../344206/index.html">Reflection in C ++ 14</a></li>
<li><a href="../344210/index.html">How to find out what the program for Linux will do without actually doing it?</a></li>
<li><a href="../344214/index.html">Strike iron: hot hardware startups</a></li>
<li><a href="../344216/index.html">What's new in DataGrip 2017.3</a></li>
<li><a href="../344222/index.html">How to build an image classifier based on a pre-trained neural network</a></li>
<li><a href="../344224/index.html">How and why to determine voice mail</a></li>
<li><a href="../344226/index.html">Tanchiki in the console, the first article: "From the dispute to writing code"</a></li>
<li><a href="../344228/index.html">‚ÄúIs it a good design or not?‚Äù - how do I answer this question with the help of 3 categories</a></li>
<li><a href="../344230/index.html">Oracle Open World 2017: Announcements of ‚ÄúAutonomous AI‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>