<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Advanced Ruby Enumerations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Enumeration, by definition, is ‚Äúthe act of mentioning a certain amount of something one by one.‚Äù In programming, instead of mentioning, we choose any ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Advanced Ruby Enumerations</h1><div class="post__text post__text-html js-mediator-article">  Enumeration, by definition, is ‚Äúthe act of mentioning a certain amount of something one by one.‚Äù  In programming, instead of mentioning, we choose any action that we want to perform, be it simple display on a monitor or performing some kind of sampling and / or conversion on an element. <br><br>  In programming, we have many ways to sample and process a collection per unit of time, by adding an additional transformation function to the chain at each step.  And each step can either consume the entire collection before passing the processing results to the next step, or it can handle the collection ‚Äúlazily‚Äù by passing one or more elements of the collection through all the transformation steps. <br><a name="habracut"></a><br><h3>  How Ruby Enums Work </h3><br>  In this post, I will give you a brief overview of what blocks ( <b>block</b> ) and <b>yield do</b> .  <b>The blocks</b> we are interested in in Ruby are pieces of code defined inside methods or <b>proc</b> / <b>lambda</b> .  You can think of <b>yield</b> as the current block of code where another <b>block of</b> code is inserted from somewhere else.  Let me demonstrate. <br><br><pre><code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_printer</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">puts</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hello</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">World!</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thrice</span></span></span><span class="hljs-function"> 3.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">times</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thrice</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&amp;</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:my_printer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment"># Hello World! # Hello World! # Hello World! thrice { puts "Ruby" } # Ruby # Ruby # Ruby</span></span></code> </pre> <br>  Methods take two forms of blocks for the <b><i>yield</i></b> command: proc's or blocks.  The <b><i>method method</i></b> transforms the <b><i>method</i></b> definition into <b>proc</b> , which can then be passed inward as a <b>block</b> , as in the example <b><i>my_printer</i></b> above. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Above at the place where the <b><i>yield</i></b> command is written, it is the same as if the code transmitted as a block would be at the <b><i>yield</i></b> point.  So in the first case, imagine calling <b>yield</b> , replaced with <b><i>puts ‚ÄúHello World!‚Äù</i></b> And the second <b><i>yield</i></b> replaced with <b><i>puts ‚ÄúRuby‚Äù</i></b> . <br><br>  <b>yield</b> can also work as a simple enumerator.  You can pass any value inwards as a parameter to <b>block</b> / <b>proc by</b> adding them after <b>yield</b> . <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simple_enum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> 4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> 3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simple_enum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">puts</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment"># 4 # 3 # 2 # 1 # 0</span></span></span></span></code> </pre><br><h3>  Minimum enumerator requirements </h3><br>  The standard way to create an enumerator in Ruby is - <b><i>each</i></b> , yields / yildit values.  With this in mind, you can declare the <b><i>each</i></b> method on any Ruby object and get all the benefits of more than 50 methods for processing and executing collections from the <a href="https://ruby-doc.org/core-2.4.1/Enumerable.html">Enumerable</a> module.  Just add <b><i>include Enumerable</i></b> inside the object that has the valid <b><i>each</i></b> method, and you can fully use all these methods (meaning the methods of the Enumerable module). <br><br>  The enumerators are not limited to simple <b><i>Array</i></b> collections <b><i>(arrays)</i></b> , they can work with any collections that have the <b><i>each</i></b> method declared in them (and will usually have an Enumerable module in their ‚Äúgrandparents / ancestors‚Äù). <br><br><pre> <code class="ruby hljs">Array.ancestors <span class="hljs-comment"><span class="hljs-comment"># =&gt; [Array, Enumerable, Object, Kernel, BasicObject] Hash.ancestors # =&gt; [Hash, Enumerable, Object, Kernel, BasicObject] Hash.method_defined? :each # =&gt; true require "set" Set.ancestors # =&gt; [Set, Enumerable, Object, Kernel, BasicObject]</span></span></code> </pre><br><h3>  "Lazy" and not "lazy" enumerators </h3><br>  Lazy enumerators are usually regarded as the best way to handle collections, because  they allow you to go around step by step endless sequence, as far as you need. <br><br>  Imagine an assembly line where people collect pizza, where each person is responsible only for one step in cooking / transforming pizza.  The first person throws the dough into the correct shape, the next one adds the sauce, the next cheese, according to the person for each additive (sausages, peppers, tomatoes), another one puts everything in the oven, and the last person delivers the finished pizza to you.  In this example, the ‚Äúlazy‚Äù version of the assembly in Ruby is to have any number of orders for pizza, but everyone else will wait until the first pizza passes through all the processing steps / steps before continuing to make the next pizza. <br><br>  If you are not using a ‚Äúlazy‚Äù enumerator, then each step / stage could wait until it has completed one step per unit of time throughout the collection.  For example, if you have 20 pizza orders, the person who throws the dough will have to make them 20 before someone can add the sauce to the next person on the line.  And each step in the queue waits in a similar manner.  Now, the more collection you need to process, the more ridiculous it seems to keep the rest of the assembly line waiting. <br><br>  A more vital example: processing a list of letters that you need to send to all users.  If the error in the code and the entire list is not lazily processed, then it is likely that no one will receive emails.  In the case of "lazy" performance, potentially, you would send letters to most users before, say, an incorrect postal address would cause a problem / error.  If the submission record contains the submission success status, it is easier to track which record (where) the error occurred. <br><br>  Creating a ‚Äúlazy‚Äù enumerator in Ruby is as simple as calling <b><i>lazy</i></b> on an object with the <b><i>Enumerable</i></b> module included in it, or calling <b><i>to_enum.lazy</i></b> on an object, with the <b><i>each</i></b> method declared inside it. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yield</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">winning</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yield</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">not</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">winning</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_enum</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lazy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enumerable</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lazy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; "winning" b.next # =&gt; "winning"</span></span></span></span></code> </pre><br><blockquote>  Calling <b><i>to_enum</i></b> returns an object that is both an <b><i>Enumerator</i></b> and an <b><i>Enumerable</i></b> , and which will have access to all of their methods. <br></blockquote><br>  It is important to pay attention to which methods of the enumerator will ‚Äúconsume‚Äù the entire collection at a time, and which will ‚Äúconsume‚Äù (carry out) it - ‚Äúlazily‚Äù.  For example, the <b><i>partition</i></b> method consumes the entire collection at once, so that it is not acceptable for infinite collections.  The best choice for lazy execution might be methods like <b><i>chunk</i></b> or <b><i>select</i></b> . <br><br><pre> <code class="ruby hljs">x = (<span class="hljs-number"><span class="hljs-number">0</span></span>..Flot::INFINITY) y = x.chunk(&amp;<span class="hljs-symbol"><span class="hljs-symbol">:even?</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; #&lt;Enumerator::Lazy: #&lt;Enumerator: #&lt;Enumerator::Generator:0x0055eb840be350&gt;:each&gt;&gt; y.next # =&gt; [true, [0]] y.next # =&gt; [false, [1]] y.next #=&gt; [true, [2]] z = x.lazy.select(&amp;:even?) # =&gt; #&lt;Enumerator::Lazy: #&lt;Enumerator::Lazy: 0..Infinity&gt;:select&gt; z.next # =&gt; 0 z.next # =&gt; 2 z.next # =&gt; 4</span></span></code> </pre><br>  In the case of using <b><i>select</i></b> with infinite collections, you must first call the <b><i>lazy</i></b> method from preventing the entire collection from being consumed by the <b><i>select</i></b> method, and force the program to terminate because of its infinite execution. <br><br><h3>  Creating a ‚Äúlazy‚Äù enumerator </h3><br>  Ruby has an <b><i>Enumerator :: Lazy</i></b> class that allows you to write your own enumerator methods as <b><i>take</i></b> to Ruby. <br><br><pre> <code class="ruby hljs">(<span class="hljs-number"><span class="hljs-number">0</span></span>..Float::INFINITY).take(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; [0, 1]</span></span></code> </pre><br>  For a visual example, we are implementing FizzBuzz, which can be run on any number and which will allow you to get endless FizzBuzz results. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divisible_by?</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span></span> -&gt;input{ (input % num).zero? } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fizzbuzz_from</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span></span> Enumerator::Lazy.new(value..Float::INFINITY) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|yielder, val|</span></span> yielder &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> divisible_by?(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"FizzBuzz"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> divisible_by?(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"Fizz"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> divisible_by?(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-string"><span class="hljs-string">"Buzz"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> x = fizzbuzz_from(<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; #&lt;Enumerator::Lazy: 7..Infinity:each&gt; 9.times { puts x.next } # 7 # 8 # Fizz # Buzz # 11 # Fizz # 13 # 14 # FizzBuzz</span></span></code> </pre><br>  With the help of <b><i>Enumerator :: Lazy</i></b> , no matter what you submit to <b><i>yielder</i></b> - there will be a value returned at each step in the sequence.  The enumerator keeps track of current progress when you use <b><i>next</i></b> .  But when you call <b><i>each</i></b> after several <b><i>next</i></b> calls, it will start from the very beginning of the collection. <br><br>  The parameter that you pass to <b><i>Enumerator :: Lazy.new</i></b> is the collection through which we will go through the enumerator.  If you wrote this method for an <b><i>Enumerable</i></b> or a compatible object, you can simply pass <b><i>self</i></b> as a parameter.  <b><i>val</i></b> will be the only value produced per unit of time by the collection method <b><i>each</i></b> , and <b><i>yielder</i></b> will be the only entry point for any block of code you want to pass, as if it were with <b><i>each</i></b> . <br><br><h3>  Advanced use of enumerator </h3><br>  When processing a collection of data, it is recommended to set restrictive filters first, and then the code processing of your data will take much less time.  If you get data to process from a database, set restrictive filters in the internal database language, if possible, before transferring the data further to Ruby.  So it will be much more effective. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"prime"</span></span> x = (<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">34</span></span>).lazy.select(&amp;Prime.method(<span class="hljs-symbol"><span class="hljs-symbol">:prime?</span></span>)) x.<span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-comment"><span class="hljs-comment"># =&gt; 2 x.next # =&gt; 3 x.next # =&gt; 5 x.next # =&gt; 7 x.next # =&gt; 11</span></span></code> </pre><br>  After the <b><i>select</i></b> method above, you can add other methods to the data processing.  These methods will deal only with a limited set of data inside primes, not all primes. <br><br><h3>  Grouping </h3><br>  One great way to process data for dividing it into columns is to use <b><i>group_by</i></b> to convert the result into an associative array of groups.  After that, just pull the results as if you were interested in all the results. <br><br><pre> <code class="ruby hljs">[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>].group_by.with_index {<span class="hljs-params"><span class="hljs-params">|_,index|</span></span> index % <span class="hljs-number"><span class="hljs-number">3</span></span> }.values <span class="hljs-comment"><span class="hljs-comment"># =&gt; [[0, 3, 6], [1, 4, 7], [2, 5, 8]]</span></span></code> </pre><br>  If you display the results on a web page, the data will be arranged in the following order: <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre><br>  Calling <b><i>group_by</i></b> above passes both the value and the index to the inside of the block.  We use the underscore for the value from the array to indicate that we are not interested in this value, but only in the index.  What we get as a result is an associative array with keys 0, 1, and 2 indicating each group of values ‚Äã‚Äãthat we have grouped.  Since we do not have to worry about keys, we call <b><i>values</i></b> on this associative array to get an array of arrays and further map how we should. <br><br>  If we wanted to arrange the results from left to right in the form of columns, we could do the following: <br><br><pre> <code class="ruby hljs">threes = (<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">2</span></span>).cycle [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>].slice_when { threes.<span class="hljs-keyword"><span class="hljs-keyword">next</span></span> == <span class="hljs-number"><span class="hljs-number">2</span></span> }.to_a <span class="hljs-comment"><span class="hljs-comment"># =&gt; [[0, 1, 2], [3, 4, 5], [6, 7, 8]]</span></span></code> </pre><br>  The <b><i>threes</i></b> enumerator simply runs infinitely from 0 to 2, in a ‚Äúlazy‚Äù manner.  As a result, we get the following conclusion: <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span></code> </pre><br>  Ruby also has a <b><i>transpose</i></b> method that reverses the results from one view to another. <br><br><pre> <code class="ruby hljs">x = [[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], [<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>], [<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>]] x = x.transpose <span class="hljs-comment"><span class="hljs-comment"># =&gt; [[0, 3, 6], [1, 4, 7], [2, 5, 8]] x = x.transpose # =&gt; [[0, 1, 2], [3, 4, 5], [6, 7, 8]]</span></span></code> </pre><br><h3>  "Folding" </h3><br>  Let's look at how to build collections into the result.  In other languages, this is usually done through the <b><i>fold</i></b> method.  In Ruby, this has long been done with <b><i>reduce</i></b> and <b><i>inject</i></b> .  A more recent solution, and the preferred way to do this is with <b><i>each_with_object</i></b> .  The main idea is the processing of one collection to another, acting as a result. <br><br>  Summing integers is as simple as: <br><br><pre> <code class="ruby hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>].reduce(<span class="hljs-symbol"><span class="hljs-symbol">:+</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; 6 [1,2,3].inject(:+) # =&gt; 6 class AddStore def add(num) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@value</span></span></span><span class="hljs-comment"> = </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@value</span></span></span><span class="hljs-comment">.to_i + num end def inspect </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@value</span></span></span><span class="hljs-comment"> end end [1,2,3].each_with_object(AddStore.new) {|val, memo| memo.add(val) } # =&gt; 6 # As of Ruby 2.4 [1,2,3].sum # =&gt; 6</span></span></code> </pre><br>  <b><i>each_with_object</i></b> usually requires an object that can be updated.  You cannot change an integer object from itself, which is why for this trivial example we created an AddStore object. <br><br>  These methods can be better demonstrated in the work, if you take data from one collection and put them in another collection.  Notice that <b><i>inject</i></b> and <b><i>reduce</i></b> are the same method aliases in Ruby and must return such a value at the end of the block in order to continue to build an enumerator based on it. <br><br>  <b><i>each_with_object</i></b> does not need the last piece of the block to return an element on which it will continue to build the enumerator. <br><br><pre> <code class="ruby hljs">collection = [<span class="hljs-symbol"><span class="hljs-symbol">:a</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:p</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:p</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:l</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:e</span></span>] collection.reduce(<span class="hljs-string"><span class="hljs-string">""</span></span>) { <span class="hljs-params"><span class="hljs-params">|memo, value|</span></span> memo &lt;&lt; value.to_s <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value.is_a? Symbol memo <span class="hljs-comment"><span class="hljs-comment"># Note the return value needs to be the object/collection we're building } # =&gt; "apple" collection.each_with_object("") { |value, memo| memo &lt;&lt; value.to_s if value.is_a? Symbol } # =&gt; "apple"</span></span></code> </pre><br><h3>  Structures </h3><br>  Object structures in Ruby are also enumerated objects, which you can use to create convenient objects to describe methods in them. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pair</span></span></span><span class="hljs-class"> &lt; Struct.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">same?</span></span></span><span class="hljs-class">;</span></span> inject(<span class="hljs-symbol"><span class="hljs-symbol">:eql?</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">;</span></span> inject(<span class="hljs-symbol"><span class="hljs-symbol">:+</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subtract</span></span></span><span class="hljs-function">;</span></span> inject(<span class="hljs-symbol"><span class="hljs-symbol">:-</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiply</span></span></span><span class="hljs-function">;</span></span> inject(<span class="hljs-symbol"><span class="hljs-symbol">:*</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-function">;</span></span> inject(<span class="hljs-symbol"><span class="hljs-symbol">:/</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap!</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">members</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entries.reverse)</span></span></span></span> {<span class="hljs-params"><span class="hljs-params">|a,b|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>[a] = b} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> x = Pair.new(<span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>) x.same? <span class="hljs-comment"><span class="hljs-comment"># =&gt; false x.first # =&gt; 23 x.swap! x.first # =&gt; 42 x.multiply # =&gt; 966</span></span></code> </pre><br>  Structures are usually not used for large collections, but are used more as useful data objects, as a way to organize data together, which in turn encourages transparent use of data rather than overgrowth of data. <br><blockquote>  Data bins are when two or more variables are always used in a group, but they would not make any sense if they were used separately.  This group of variables must be grouped into an object / class. <br></blockquote><br>  So, structures in Ruby are usually small collections of data, but at the same time, nothing suggests that the data itself could represent a completely different collection of data.  In this case, the structure can be a way to implement transformations on the same data collections, which most likely you would do the same by writing your own class. <br><br><h3>  Summarize </h3><br>  Ruby is a pretty wonderful language that allows you to work as well as manipulate collections of data.  Studying every bit of what Ruby offers will allow you to write more elegant code, as well as test and optimize code for better performance. <br><br>  If performance is important, then measure the performance of individual implementations and be sure to set the filters and limits / limits on the processing as early as possible, of course, if possible.  Consider limiting your input to small chunks using the <b><i>readline</i></b> method on files rather than <b><i>read</i></b> or <b><i>readlines</i></b> or use the <b><i>LIMIT number</i></b> in SQL. <br><br>  Lazy iteration can be of great help in separating tasks into different threads or background processing tasks.  The concept of "lazy" iterations does not really have flaws, so you can choose them for consumption of any collection in any place.  It offers flexibility, and some languages, like Rust with iterators, have been taken for the standard to be ‚Äúimplemented lazily‚Äù. <br><br>  The possibilities are endless when we are faced with how to manipulate and manipulate data.  And this is a fun process, examine and create every way of manipulating data sets in programming.  Ruby has well documented examples for each of its <a href="https://ruby-doc.org/core-2.4.1/Enumerable.html">enumerable</a> methods, so it helps to learn from them.  I support you to experiment and discover many new things that will help make the programming process more enjoyable and enjoyable. </div><p>Source: <a href="https://habr.com/ru/post/335072/">https://habr.com/ru/post/335072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335058/index.html">Puzzle game Neo Angle. Continuing development history and release in Appstore</a></li>
<li><a href="../335060/index.html">How to stand on the shoulders of a giant. Allowance for fintech startups</a></li>
<li><a href="../335064/index.html">GitLab 9.4 released: Related tasks and web monitoring applications</a></li>
<li><a href="../335066/index.html">Hackathon "Budget-Pro": the first step to winning the competition</a></li>
<li><a href="../335068/index.html">Warned means intellectual callback</a></li>
<li><a href="../335074/index.html">We write and collect Android applications in the linux console</a></li>
<li><a href="../335076/index.html">JetBrains Rider 2017.1 - the first release of the new cross-platform .NET IDE</a></li>
<li><a href="../335080/index.html">Optimization of presentation templates in the Codeigniter Framework using AST transformations</a></li>
<li><a href="../335082/index.html">Visual Plugin Pack in OBIEE: what it is eaten with and how it is prepared</a></li>
<li><a href="../335084/index.html">5G Through the Eyes of Huawei</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>