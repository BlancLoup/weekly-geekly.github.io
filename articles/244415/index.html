<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Project Miranda NG receives the ‚ÄúWild Signs‚Äù award (part two)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We will continue to consider the errors that were found in the Miranda NG project using the PVS-Studio static code analyzer. Last time, we talked abou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Project Miranda NG receives the ‚ÄúWild Signs‚Äù award (part two)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f94/308/5e5/f943085e50bc0f9467a0575713302607.png" alt="Miranda NG" align="left"><br>  We will continue to consider the errors that were found in the Miranda NG project using the PVS-Studio static code analyzer.  Last time, we talked about pointers and working with memory.  Now let's talk about general errors that are mainly related to inaccuracy and typos. <br><a name="habracut"></a><br><h2>  Continue checkout </h2><br>  The previous part of the Miranda NG code review is available <a href="http://habrahabr.ru/company/pvs-studio/blog/244097/">here</a> . <br><br><h3>  Typos </h3><br>  I'll start here with such a beautiful typo.  Next to the '=' key is the '-' key.  That's what happened because of this: <br><pre><code class="cpp hljs">CBaseTreeItem* CMsgTree::GetNextItem(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Order = TreeCtrl-&gt;hItemToOrder(TreeView_GetNextItem(....)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Order =- <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0152/">warning</a> : <a href="http://www.viva64.com/ru/d/0152/">V559</a> Suspicious assignment: operator: Order = - - 1. NewAwaySys msgtree.cpp 677 <br><br>  Naturally, it should be written here: if (Order == -1). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And here they forgot the asterisk '*': <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HWND WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateRecentComboBoxEx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dbv.ptszVal != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; dbv.ptszVal != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) { .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0090/">warning</a> : <a href="http://www.viva64.com/ru/d/0090/">V501</a> operator: dbv.ptszVal! = 0 &amp;&amp; dbv.ptszVal! = '\ 0' SimpleStatusMsg msgbox.cpp 247 <br><br>  We wanted to check that the pointer is nonzero and that the string is not empty.  But forgot to dereference pointer.  It turned out that two times checked the pointer to equality to zero. <br><br>  The correct option is: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dbv.ptszVal != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; *dbv.ptszVal != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) {</code> </pre> <br>  This error is also detected with the help of another diagnostic: <a href="http://www.viva64.com/ru/d/0117/">V528</a> It is odd that the pointer to 'wchar_t' type is compared with the L '\ 0' value.  Probably meant: * dbv.ptszVal! = L '\ 0'.  SimpleStatusMsg msgbox.cpp 247 <br><br>  This is often the case when 2, or even 3 diagnostics indicate one error.  It turns out that the error makes the code suspicious from several points of view. <br><br>  There are some more V528 and I suggest checking the appropriate code: <ul><li>  options.cpp 759 </li><li>  exportimport.cpp 425 </li><li>  exportimport.cpp 433 </li><li>  exportimport.cpp 441 </li></ul><br>  Some array of headers is copied to itself.  Most likely, there is some typo here: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InternetDownloadFile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *szUrl)</span></span></span><span class="hljs-function"> </span></span>{ .... CopyMemory(nlhr.headers, nlhr.headers, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(NETLIBHTTPHEADER)*nlhr.headersCount); .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0139/">warning</a> : <a href="http://www.viva64.com/ru/d/0139/">V549</a> The first argument of the memcpy function is equal to the second argument.  NimContact http.cpp 46 <br><br>  Here is another similar situation: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">TCHAR* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TCHAR* dst, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dstlen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num)</span></span></span><span class="hljs-function"> </span></span>{ .... TCHAR *tmp, *src = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... src = (TCHAR*)<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(MAX_BUFFER_LENGTH * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(TCHAR)); .... _tcscpy(src, src); .... }</code> </pre> <br>  PVS-Studio warning: V549 wcscpy function is equal to the second argument.  Spamotron utils.cpp 218 <br><br>  The string is copied to itself.  I suspect that the pointer 'dst' should have been used as one of the arguments. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TTBBF_ISLBUTTON 0x0040 INT_PTR TTBAddButton(WPARAM wParam, LPARAM lParam) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!(but-&gt;dwFlags &amp;&amp; TTBBF_ISLBUTTON) &amp;&amp; nameexists(but-&gt;name)) return -1; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0153/">warning</a> : <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of conditional expression is always true: 0x0040.  TopToolBar toolbar.cpp 307 <br><br>  Most likely, the hand twitched and instead of '&amp;' it turned out '&amp;&amp;'. <br><br>  And the last case, where assignment occurs instead of comparison: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_REPLACES 15 INT_PTR CALLBACK DlgProcCopy(....) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (string == newString[k]) k--; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (k = MAX_REPLACES) break; string = oldString[++k]; i+=2; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0152/">warning</a> : <a href="http://www.viva64.com/ru/d/0152/">V559</a> Suspicious assignment: operator: k = 15. NimContact contactinfo.cpp 339 <br><br><h3>  Unfinished code </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">INT_PTR </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SVC_OTRSendMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WPARAM wParam,LPARAM lParam)</span></span></span></span>{ .... CCSDATA *ccs = (CCSDATA *) lParam; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otr_context_get_trust(context) &gt;= TRUST_UNVERIFIED) ccs-&gt;wParam; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0222/">warning</a> : <a href="http://www.viva64.com/ru/d/0222/">V607</a> Ownerless expression 'ccs-&gt; wParam'.  MirOTR svcs_proto.cpp 103 <br><br>  If the condition is fulfilled, nothing will happen.  Perhaps they wanted to assign a value to the variable ‚Äúccs-&gt; wParam‚Äù.  A similar warning is also issued here: bandctrlimpl.cpp 226. <br><br>  And here is the unfinished cycle: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> __declspec(dllexport) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = MAX_PATH; <span class="hljs-number"><span class="hljs-number">5</span></span>; i--){ .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/0275/">warning</a> : <a href="http://www.viva64.com/ru/0275/">V654</a> The condition '5' of loop is always true.  Xfire main.cpp 1110 <br><br>  There is something wrong with the cycle.  I think they forgot to compare the 'i' with the number '5'.  Plus, this loop is copied to another place in the program: variables.cpp 194. <br><br><h3>  Inattention </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *positionInOldString)</span></span></span><span class="hljs-function"> </span></span>{ .... *positionInOldString ++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (linesInFile - <span class="hljs-number"><span class="hljs-number">1</span></span>); } .... }</code> </pre> <br>  V532 Consider inspecting the statement of '* pointer ++' pattern.  Probably meant: '(* pointer) ++'.  NimContact namereplacing.cpp 92 <br><br>  There is a great suspicion that they wanted to change the variable referenced by the 'positionInOldString' pointer.  But it turned out that they changed the pointer itself. <br><br>  Most likely, the code should be changed as follows: <br><pre> <code class="cpp hljs">(*positionInOldString)++;</code> </pre> <br><h3>  "Overwrite" values </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">INT_PTR </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTBSetState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(WPARAM wParam, LPARAM lParam)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">mir_cslock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(csButtonsHook)</span></span></span></span>; TopButtonInt *b = idtopos(wParam); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; b-&gt;bPushed = (lParam &amp; TTBST_PUSHED) ? TRUE : FALSE; b-&gt;bPushed = (lParam &amp; TTBST_RELEASED) ? FALSE : TRUE; b-&gt;SetBitmap(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0108/">warning</a> : <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'b-&gt; bPushed' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 358, 359. TopToolBar toolbar.cpp 359 <br><br>  It is strange that at the beginning some value was placed in a variable, and then unexpectedly it is overwritten by another value. <br><br>  One more example: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> INT_PTR CALLBACK </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sttOptionsDlgProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... rc.left += <span class="hljs-number"><span class="hljs-number">10</span></span>; rc.left = prefix + width * <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  V519 The 'rc.left' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 583, 585. Miranda hotkey_opts.cpp 585 <br><br>  Of course, writing two different values ‚Äã‚Äãto one variable in a row is not always an error.  Sometimes, just in case, the variable is initialized to zero, and then used.  There are other correct situations.  However, I wrote <b>14 warnings</b> that indicate, in my opinion, the suspicious code: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-519.txt">MirandaNG-519.txt</a> . <br><br>  Sometimes a warning V519 indirectly reveals a situation when the 'break' operator is forgotten: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnApply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ACC_FBOOK: m_proto-&gt;m_options.IgnoreRosterGroups = TRUE; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ACC_OK: m_proto-&gt;m_options.IgnoreRosterGroups = TRUE; m_proto-&gt;m_options.UseSSL = FALSE; m_proto-&gt;m_options.UseTLS = TRUE; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ACC_TLS: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ACC_LJTALK: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ACC_SMS: m_proto-&gt;m_options.UseSSL = FALSE; m_proto-&gt;m_options.UseTLS = TRUE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  PVS-Studio warning: V519 The 'm_proto-&gt; m_options.IgnoreRosterGroups' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1770, 1773. Jabber jabber_opt.cpp 1773 <br><br><h3>  Same code snippets </h3><br>  There are places where, regardless of the conditions, the same actions will be performed. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build_RTF_Header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dat-&gt;dwFlags &amp; MWF_LOG_RTL) AppendToBuffer(buffer, bufferEnd, bufferAlloced, <span class="hljs-string"><span class="hljs-string">"{\\rtf1\\ansi\\deff0{\\fonttbl"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> AppendToBuffer(buffer, bufferEnd, bufferAlloced, <span class="hljs-string"><span class="hljs-string">"{\\rtf1\\ansi\\deff0{\\fonttbl"</span></span>); .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0112/">warning</a> : <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  TabSRMM msglog.cpp 439 <br><br>  Perhaps the code was written using Copy-Paste.  At the same time, one of the lines was forgotten. <br><br>  There <b>are 9 more</b> such suspicious places: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-523.txt">MirandaNG-523.txt</a> . <br><br>  Something in this place I felt tired.  The abundance of errors that need to be described, I was tired.  I am already writing the second article, and the warnings have no end in sight.  I'll go drink coffee. <br><br>  (time passed) <br><br>  So let's continue.  Copy-Paste can manifest itself even more like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RoomWndResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., UTILRESIZECONTROL *urc)</span></span></span><span class="hljs-function"> </span></span>{ .... urc-&gt;rcItem.top = (bToolbar &amp;&amp; !bBottomToolbar) ? urc-&gt;dlgNewSize.cy - si-&gt;iSplitterY : urc-&gt;dlgNewSize.cy - si-&gt;iSplitterY; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0186/">warning</a> : <a href="http://www.viva64.com/ru/d/0186/">V583</a> The '?:' Operator, regardless of its conditional expression, always returns the same value: urc-&gt; dlgNewSize.cy - si-&gt; iSplitterY.  TabSRMM window.cpp 473 <br><br>  Why is the "?:" Operator needed if the same expression is evaluated? <br><br>  <b>11 more</b> meaningless ternary operators: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-583.txt">MirandaNG-583.txt</a> . <br><br>  Suspicious division operations <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CSkin::setupAeroSkins() { .... BYTE alphafactor = <span class="hljs-number"><span class="hljs-number">255</span></span> - ((m_dwmColor &amp; <span class="hljs-number"><span class="hljs-number">0xff000000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>); .... fr *= (alphafactor / <span class="hljs-number"><span class="hljs-number">100</span></span> * <span class="hljs-number"><span class="hljs-number">2.2</span></span>); .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0254/">warnings</a> : <a href="http://www.viva64.com/ru/d/0254/">V636</a> The 'alphafactor / 100' expression was implicitly casted from 'int' type to 'float' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  TabSRMM themes.cpp 1753 <br><br>  I suspect that the programmer wanted the alphafactor / 100 division to be non-integer.  Now it turns out that by dividing a variable of type BYTE by 100, you can get only three values: 0, 1 and 2. <br><br>  Probably need to divide like this: <br><pre> <code class="cpp hljs">fr *= (alphafactor / <span class="hljs-number"><span class="hljs-number">100.0</span></span> * <span class="hljs-number"><span class="hljs-number">2.2</span></span>);</code> </pre> <br>  In the same file you can find 2 more suspicious division operations in line 1758 and 1763. <br><br><h3>  WTF? </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> INT_PTR CALLBACK </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DlgProc_EMail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> WM_COMMAND: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (LOWORD(wParam)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HIWORD(wParam) == BN_CLICKED) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> IDOK: .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0239/">warning</a> : <a href="http://www.viva64.com/ru/d/0239/">V622</a> Consider inspecting the 'switch' statement.  It's possible that the operator is missing.  UInfoEx ctrl_contact.cpp 188 <br><br>  What is this line "if (HIWORD (wParam) == BN_CLICKED) {" before "case IDOK"?  She will never get control.  What did the programmer want to say? <br><br>  Another such place is slightly lower (in line 290). <br><br><h3>  Strangely formatted code </h3><br>  There is something wrong with the code below.  But it is not clear that.  Whether it is unsuccessfully formatted, or not written. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractURI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( msg[i] &amp;&amp; !_istspace(msg[i])) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( IsDBCSLeadByte(msg[i] ) &amp;&amp; msg[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]) i++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> &lt;&lt;&lt;--- <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _istalnum(msg[i]) || msg[i]==_T(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)) { cpLastAlphaNum = charCount; iLastAlphaNum = i; } charCount++; i++; } .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0344/">warning</a> : <a href="http://www.viva64.com/ru/d/0344/">V705</a> It is possible that 'else' block was forgotten or commented out, thus the program's operation logics.  LinkList linklist_fct.cpp 92 <br><br>  Notice the weird 'else'. <br><br>  Here is met: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CInfoPanel::renderContent(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> HDC hdc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_height &gt;= DEGRADE_THRESHOLD) rc.top -= <span class="hljs-number"><span class="hljs-number">2</span></span>; rc.bottom -= <span class="hljs-number"><span class="hljs-number">2</span></span>; .... }</code> </pre> <br>  PVS-Studio Warning: V640 The code's operational logic does not correspond with its formatting.  The second statement will always be executed.  It is possible that curly brackets are missing.  TabSRMM infopanel.cpp 370 <br><br>  It is very likely that the programmer forgot to write braces here.  The deuce is always deducted from 'rc.bottom'. <br><br>  This terrible stories do not end there.  Need to look more here: <ul><li>  msn_p2p.cpp 385 </li><li>  crypt_lists.cpp 13 </li><li>  crypt_lists.cpp 44 </li><li>  common.c 273 </li><li>  common.c 307 </li></ul><br><h3>  Stop the cycle at the most interesting place </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> PopupSkin::load(LPCTSTR dir) { .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (hFind != INVALID_HANDLE_VALUE) { loadSkin(ffd.cFileName); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FindNextFile(hFind, &amp;ffd)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0228/">warning</a> : <a href="http://www.viva64.com/ru/d/0228/">V612</a> An unconditional 'break' within a loop.  Popup skin.cpp 807 <br><br>  Why do you need a 'break' in the middle of a loop?  The consequence of unsuccessful refactoring?  And unfortunately, not the only thing: <ul><li>  icq_servlist.cpp 226 </li><li>  rawping.cpp 159 </li><li>  main.cpp 304 </li><li>  gfileutils.c 266 </li></ul><br><h3>  Always true or false conditions. </h3><br>  This error is most often associated with checks of the form (UNSIGNED &lt;0) or (UNSIGNED&gt; = 0).  But there are more exotic options.  The pointer is compared with the string: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yahoo_process_search_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cp != <span class="hljs-string"><span class="hljs-string">"\005"</span></span>) .... }</code> </pre> <br>  Warning PVS_Studio: <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'cp! = "\ 005"' is always true.  To compare strings you should use strcmp () function.  Yahoo libyahoo2.cpp 4486 <br><br>  But back to the classics of the genre.  I will give only one example, and the remaining warnings will be, as usual, a list. <br><pre> <code class="cpp hljs">ULONG_PTR itemData; <span class="hljs-function"><span class="hljs-function">LONG_PTR CALLBACK </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HotkeyHandlerDlgProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dis-&gt;itemData &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... }</code> </pre> <br>  PVS-Studio warning: V547 Expression 'dis-&gt; itemData&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. TabSRMM hotkeyhandler.cpp 213 <br><br>  Promised list: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-547.txt">MirandaNG-547.txt</a> . <br><br><h3>  Someone does not know how the functions strchr () and strrchr () work </h3><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> mir_strchr(s,c) (((s)!=0)?strchr((s),(c)):0) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> mir_strrchr(s,c) (((s)!=0)?strrchr((s),(c)):0) BYTE CExImContactBase::fromIni(LPSTR&amp; row) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (cchBuf &gt; 10 &amp;&amp; (p1 = mir_strrchr(pszBuf, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'*{'</span></span></span><span class="hljs-meta">)) &amp;&amp; (p2 = mir_strchr(p1, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'}*'</span></span></span><span class="hljs-meta">)) &amp;&amp; p1 + 2 &lt; p2) { .... }</span></span></code> </pre> <br>  PVS-Studio warnings: <ul><li>  V575 The 'strrchr' function processes value '10875'.  Inspect the second argument.  UInfoEx classeximcontactbase.cpp 177 </li><li>  V575 The 'strchr' function processes value '32042'.  Inspect the second argument.  UInfoEx classeximcontactbase.cpp 177 </li></ul>  Apparently someone wanted to find a piece of text, framed by the characters "* {" and "} *".  But it turned out some nonsense. <br><br>  First, the strchr () and strrchr () functions look for a single character, not a substring. <br><br>  Secondly, '* {' is interpreted as the number 10875. Functions expect the value of the 'int' type as the second argument, but this means nothing.  They use only the low byte of this argument. <br><br>  And unfortunately, this is not a random, but a systematic error. <br><br>  There are <b>10</b> of the same incorrect calls: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-575.txt">MirandaNG-575.txt</a> . <br><br><h3>  Undefined behavior </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FacebookProto::UpdateLoop(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">-1</span></span>; !isOffline(); i = ++i % <span class="hljs-number"><span class="hljs-number">50</span></span>) .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0162/">warning</a> : <a href="http://www.viva64.com/ru/d/0162/">V567</a> Undefined behavior.  I'm variable is variable  Facebook connection.cpp 191 <br><br>  Every time there is someone who starts saying that you can write like that, because there is no post-increment.  This has been discussed more than once in other articles.  No, you can't write like that. <br><br>  It would be more correct and understandable to write like this: i = (i + 1)% 50. <br><br>  Another dangerous place here: dlg_handlers.cpp 883. <br><br>  Now consider a more interesting example: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">importSettings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MCONTACT hContact, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *importstring )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>[<span class="hljs-number"><span class="hljs-number">256</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>, setting[<span class="hljs-number"><span class="hljs-number">256</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>, *end; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (end = <span class="hljs-built_in"><span class="hljs-built_in">strpbrk</span></span>(&amp;importstring[i+<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"]"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((end+<span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) *end = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>, &amp;importstring[i+<span class="hljs-number"><span class="hljs-number">1</span></span>]); } .... }</code> </pre> <br>  Warning PVS_Studio: <a href="http://www.viva64.com/ru/d/0330/">V694</a> The condition ((end + 1)! = '\ 0') is only false if there is a pointer overflow which is undefined behavior anyway.  DbEditorPP exportimport.cpp 425 <br><br>  Generally, there is a banal typo.  We wanted to check that the 'end' pointer points to the character in front of the terminal zero.  The mistake is that you forgot to dereference the pointer.  It should be written: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*(end+<span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)</code> </pre> <br>  And where is the indefinite behavior?  We will discuss this now. <br><br>  In general, this error is also diagnosed by another diagnosis ( <a href="http://www.viva64.com/ru/d/0117/">V528</a> ).  But it is interesting to me to talk about the indefinite behavior.  I want to show that even when the analyzer says something unintelligible, you should not hurry, but you should think that it is embarrassing in the code. <br><br>  So, adding 1 to the pointer, we always get a value other than NULL.  Except for one single case: if an overflow occurs, we get NULL.  But the language standard says that this is an indefinite behavior. <br><br>  Thus, the analyzer found a condition that is either always true, or leads to undefined behavior.  And this means that something is wrong with the code. <br><br>  Other incorrect checks: <ul><li>  exportimport.cpp 433 </li><li>  exportimport.cpp 441 </li><li>  openfolder.cpp 35 </li><li>  skype.cpp 473 </li></ul>  And the last on the topic of indefinite behavior.  Let's talk about shifts: <br><pre> <code class="cpp hljs">METHODDEF(boolean) decode_mcu_AC_refine (....) { .... m1 = (<span class="hljs-number"><span class="hljs-number">-1</span></span>) &lt;&lt; cinfo-&gt;Al; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0117/">warning</a> : <a href="http://www.viva64.com/ru/d/0117/">V610</a> Undefined behavior.  Check the shift operator '&lt;&lt;.  The left operand '(- 1)' is negative.  AdvaImg jdarith.c 460 <br><br>  A plus: <ul><li>  jdhuff.c 930 </li><li>  cipher.c 1529 </li></ul><br><h3>  No virtual destructor </h3><br>  There is a base class CNetClient: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CNetClient</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CNetClient(): Stopped(FALSE) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* servername,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port)</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *query)</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf=</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">NULL</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buflen=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">65536</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Disconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Connected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SSLify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; .... };</code> </pre> <br>  As you can see, it has virtual functions, but no virtual destructor.  Some other classes are inherited from it: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CNLClient</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CNetClient { .... };</code> </pre> <br>  And the final touch.  For example, there is such a class: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CPop3Client</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CNetClient</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NetClient</span></span></span><span class="hljs-class">;</span></span> ~CPop3Client() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NetClient != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> NetClient; } .... };</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0210/">Warnings</a> : <a href="http://www.viva64.com/ru/d/0210/">V599</a> The virtual destructor is not present, although the class contains virtual functions.  YAMN pop3.h 23 <br><br>  I think the consequences are clear.  A question about virtual destructors is asked at every second interview. <br><br>  Similarly, this is not the case with the following classes: <ul><li>  CUpdProgress </li><li>  FactoryBase </li><li>  ContactCompareBase </li></ul><br><h3>  Incorrect formatting of strings </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertAnyTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FITAG *tag)</span></span></span><span class="hljs-function"> </span></span>{ .... UINT64 *pvalue = (UINT64 *)FreeImage_GetTagValue(tag); <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(format, <span class="hljs-string"><span class="hljs-string">"%ld"</span></span>, pvalue[<span class="hljs-number"><span class="hljs-number">0</span></span>]); .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0176/">warning</a> : <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider checking the sprintf function.  The argument is expected to be not greater than 32-bit.  AdvaImg tagconversion.cpp 202 <br><br>  How to do it correctly is written here: " <a href="http://www.viva64.com/ru/k/0046/">How to print a value of type __int64, size_t and ptrdiff_t</a> ". <br><br>  Additionally, you need to correct these places in the code: <a href="http://www.viva64.com/external-pictures/txt/MirandaNG-576.txt">MirandaNG-576.txt</a> . <br><br><h3>  miscellanea </h3><br>  Strange comparison: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CPN_COLOURCHANGED 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CBN_SELCHANGE 1 INT_PTR CALLBACK DlgPopupOpts(....) { .... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (wNotifyCode == CPN_COLOURCHANGED) { .... } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (wNotifyCode == CBN_SELCHANGE) { .... } .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0106/">warning</a> : <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 243, 256. PluginUpdater options.cpp 243 <br><br>  Incorrect use of ZeroMemory () function: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ScanFolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... __except (EXCEPTION_EXECUTE_HANDLER) { ZeroMemory(szMyHash, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">// smth went wrong, reload a file from scratch } .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0175/">warning</a> : <a href="http://www.viva64.com/ru/d/0175/">V575</a> The 'memset' function processes '0' elements.  Inspect the third argument.  PluginUpdater dlgupdate.cpp 652 <br><br>  The function does not reset anything, since the second argument is zero.  Another such wrong call is here: shlipc.cpp 68. <br><br>  Double check: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">LONG_PTR CALLBACK </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HotkeyHandlerDlgProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (job-&gt;hContact &amp;&amp; job-&gt;iAcksNeeded &amp;&amp; job-&gt;hContact &amp;&amp; job-&gt;iStatus == SendQueue::SQ_INPROGRESS) .... }</code> </pre> <br>  PVS-Studio Warning: <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions of the '&amp;&amp;' operator.  TabSRMM hotkeyhandler.cpp 523 <br><br>  It seems to me that the second verification of 'job-&gt; hContact' is just superfluous and can be deleted.  Nevertheless, I suggest to check this place and these: <ul><li>  ekhtml_mktables.c 67 </li><li>  affixmgr.cxx 1784 </li><li>  affixmgr.cxx 1879 </li><li>  ac.c 889 </li></ul>  Dual resource release: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> INT_PTR </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServiceCreateMergedFlagIcon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ HRGN hrgn; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hrgn!=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { SelectClipRgn(hdc,hrgn); DeleteObject(hrgn); .... DeleteObject(hrgn); } .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/d/0189/">warning</a> : <a href="http://www.viva64.com/ru/d/0189/">V586</a> The 'DeleteObject' function is called.  Check lines: 264, 273. UInfoEx svc_flagsicons.cpp 273 <br><br><h3>  What is not included in the article </h3><br>  I have no more strength.  Much, irrelevant, I was too lazy to describe.  Well, for example, like: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MF_BYCOMMAND 0x00000000L void CMenuBar::updateState(const HMENU hMenu) const { .... ::CheckMenuItem(hMenu, ID_VIEW_SHOWAVATAR, MF_BYCOMMAND | dat-&gt;bShowAvatar ? MF_CHECKED : MF_UNCHECKED); .... }</span></span></code> </pre> <br>  This code does not work as the programmer assumes.  But, nevertheless, it works correctly. <br><br>  The condition of the ternary operator is not (dat-&gt; bShowAvatar), but the expression (MF_BYCOMMAND | dat-&gt; bShowAvatar).  Due to luck, the constant MF_BYCOMMAND is zero and does not affect the result. <br><br>  And in general, I looked diagnostic inattentively.  I almost immediately realized that I would have enough problems with a large article and I couldn‚Äôt pay much attention to it. <br><br>  Therefore, do not consider this article as a guide to action.  It advertises well the power of the PVS-Studio analyzer, but it is rather superficial to correct the errors described in it and calm down on this.  I suggest the developers to start PVS-Studio themselves and carefully study all the warnings. <br><br><h2>  Conclusion </h2><br>  I hope I once again managed to show how static code analysis can be useful.  Even a one-time check reveals a lot of errors, although this is the wrong scenario using a static analyzer. <br><br>  Analysis must be performed regularly, and then many errors will be found at the earliest stages.  This will significantly reduce the time for their search and elimination. <br><br>  I invite you to immediately <a href="http://www.viva64.com/ru/pvs-studio-download/">download PVS-Studio</a> and try it on your project. <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0292/">Miranda NG Project to Get the "Wild Pointers" Award (Part 2)</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/244415/">https://habr.com/ru/post/244415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244395/index.html">Samsung EYECAN + - mouse for people with disabilities</a></li>
<li><a href="../244397/index.html">Monetization of Oculus Rift and Leap motion in quests in reality</a></li>
<li><a href="../244405/index.html">Expressive JavaScript: Project: Platformer game</a></li>
<li><a href="../244407/index.html">We build robotboks with Wifi control, camera, gun, blackjack, etc.</a></li>
<li><a href="../244413/index.html">Update the app and get a comprehensive promotion package.</a></li>
<li><a href="../244417/index.html">Development of the game in 115 kb - hacks, bugs and annoyance</a></li>
<li><a href="../244419/index.html">Productivity without slaps</a></li>
<li><a href="../244421/index.html">PHPStamp - fair generation of DOCX documents from a template</a></li>
<li><a href="../244423/index.html">Notifications based on the builder with custom layout and picture</a></li>
<li><a href="../244427/index.html">"Raspberry Eye" - webcam on the servo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>