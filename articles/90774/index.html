<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to the development of USB peripherals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the last six months I have been involved in the development of the first USB device in my life and the application software for it, and now I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to the development of USB peripherals</h1><div class="post__text post__text-html js-mediator-article">  For the last six months I have been involved in the development of the first USB device in my life and the application software for it, and now I want to share my understanding of how everything works there: a microcontroller, a driver, an application software.  I will also raise the issue of choosing the VID / PID.  The list of useful links for those who want to understand the topic in more detail is attached. <br><a name="habracut"></a><br><h4>  Context </h4><br>  An electronic device is being developed, which, when connected to the sensor, performs microdisplacement measurement and transmits the result to a PC, where it is displayed in an operator-friendly graphical form.  The scope of the measuring device is mechanical engineering. <br><br><h4>  A little bit about how it works </h4><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7bd/bc2/486/7bdbc24867d87dda668c460418a563ac.gif" alt="The main participants of USB peripherals"><br><br>  The diagram shows the main actors involved in the life of the developed device. <br>  The microcontroller is the main element of the device, which sends control signals to the sensor and receives the response, which calculates the measurement result.  With the help of the implemented USB stack, data exchange with the host is practically reduced to working with read and write buffers.  Due to the fact that the measuring algorithm does not require large computational powers and the period of one measurement is 100-150 ms, the <a href="http://atmel.com/dyn/products/product_card_v2.asp%3Fpart_id%3D4097">at90usb162</a> microcontroller (8 bits, 16 MHz, 16 kB) is selected.  This MK has hardware support for USB, which greatly simplifies the software implementation of the USB stack.  In other matters, I didn‚Äôt have to implement the stack and initialize the MK due to the example of the USB Generic HID Implementation from the accompanying <a href="http://atmel.com/dyn/products/tools_card_v2.asp%3Ftool_id%3D4440">software package</a> .  Alternatives to branded AVR examples include the <a href="http://www.fourwalledcubicle.com/LUFA.php">LUFA</a> framework (MIT license) for AT90USBxxxx and ATMEGAxxUx and the fully software implementation of the <a href="http://www.obdev.at/products/vusb/index.html">V-USB</a> stack (GPL or commercial license), which allows you to work with AVRs without USB hardware. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A little bit about the abbreviation <a href="http://comvcon.blogspot.com/search/label/HID" title="Human Interface Device">HID</a> .  This is a class of USB devices designed for human input: keyboard, mouse, game controllers.  It is assumed that such devices have a small amount of information transmitted, as well as the device being developed: packets of 8 bytes with an interval of 100-150 ms.  The main convenience of working with devices of this class is the presence of a standard driver in the OS, which frees you from writing your own. <br><br>  The host (master, master) in my case is the PC, or rather the USB controller built into the motherboard.  According to the descriptor (description) of my device, the host polls it for new parcels with a period of about 20 ms.  The application software collects the data received by the host, carries out a small processing and draws indicators resembling automotive speedometers, which show the measured values.  A list of connected sensors and their settings that can be changed are displayed: the changes will be transferred to the device and saved in non-volatile memory. <br><br>  One of the ideas of the application is cross-platform, so it is developed in the <a href="http://qt.nokia.com/products">Qt</a> framework in C ++, and the OS calls for reading and transmitting data are made through the <a href="http://www.libusb.org/">libusb</a> library.  The last few months there has been an active development of the libusb v1.0 <a href="http://www.libusb.org/wiki/windows_backend">backend for blame</a> , they are already writing about the pre-release status and, more importantly, everything seems to work with it for me.  There is also a libusb v0.1 port for Windows - <a href="http://libusb-win32.sourceforge.net/">LibUsb-Win32</a> .  The topic of work through WinAPI is detailed and with examples on Visual Basic and Visual C # disclosed in the book USB Complete ( <a href="http://www.lvr.com/usbc.htm">about the book</a> ).  I tried WinAPI and did not like it. <br><br><h4>  VID and PID </h4><br>  When releasing your USB device to the light, the company should assign it a manufacturer identifier (vid - vendor id) and product (pid - product id, not to be confused with the serial number).  Formally, uniqueness is necessary to prevent conflicts between device drivers in the OS.  Although I have a suspicion that this is more likely one of the ways to make money for the creators of the standard than the only possible technical solution.  However, I, of course, will not condemn them for their desire to earn money on the standard they have created. <br>  So, for the manufacturer of the periphery, there are <a href="http://www.usb.org/developers/vendor/">two ways</a> to get your own vid: <ul><li>  pay $ 2000 for vid at a time </li><li>  or become a member of USB-IF for $ 4000 per year. </li></ul>  For those who are not able to pay such money, chip manufacturers provide various options for using their vid and pid: <br><ul><li>  <b>Atmel</b> .  The faq lists the <a href="http://support.atmel.no/bin/customer%3F%3D%26action%3DviewKbEntry%26id%3D220">rules by</a> which you can use the vid / pid chip for your device. </li><li>  <b>FTDI</b> .  In addition to using the built-in vid / pid, the company <a href="http://www.ftdichip.com/Support/Knowledgebase/index.html%3Fbasicdetails.htm">offers</a> to send a request for a free allocation of pid. </li><li>  <b>Microcip</b> also offers to send a <a href="http://ww1.microchip.com/downloads/en/AppNotes/Application%2520for%2520USB%2520Vendor%2520ID%2520Sublicense.pdf">request</a> for the allocation of pid. </li><li>  <b>Silicon Labs</b> .  Here is what they <a href="http://electronix.ru/forum/lofiversion/index.php/t37856.html">write on the forums</a> : <br><ul><li>  "SiLabs provides a ready-made package for generating a driver with your own description of the device, but the vid / pid will be from SiLabs (vid 10C4, pid EA60)." </li><li>  ‚ÄúIf the usb-com adapter is from Sylabs, then you can get vid / pid for free from them.  We have already received two.  It is necessary to write a letter in English, in response they will send a questionnaire.  Answers to the questionnaire - by letter again to the Silabs, and two days later send a vid / pid.  But it is necessary, of course, to describe the project in detail (start date, volumes) and indicate your site (preferably * .com). ‚Äù </li><li>  Chips that implement the usb protocol only hardware can use the built-in hardware vid and pid.  For example, this applies to FTDI chips. </li></ul></li></ul><br><h4>  Main sources of information </h4><br>  A great introduction to USB ( <a href="http://www.beyondlogic.org/usbnutshell/">eng.</a> , <a href="http://microsin.ru/content/view/1107/44/">P.</a> <a href="http://microsin.ru/content/view/1108/44/">P.</a> ) For peripheral developers - 30 pages instead of many hundreds in the <a href="http://www.usb.org/developers/docs/">standard</a> .  More information about the development of USB peripherals and drivers for it can be found on the <a href="http://www.lvr.com/usb.htm">Lakeview Research</a> website, especially I want to mention the book <a href="http://www.lvr.com/usbc.htm">USB Complete: The Developer's Guide, by Jan Axelson</a> . </div><p>Source: <a href="https://habr.com/ru/post/90774/">https://habr.com/ru/post/90774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../90761/index.html">To the issue of cross-browser Data URI</a></li>
<li><a href="../90763/index.html">Thin clients: how to make them</a></li>
<li><a href="../90766/index.html">KIN: 2 new phones from Microsoft</a></li>
<li><a href="../90768/index.html">We write games for Windows Phone</a></li>
<li><a href="../90771/index.html">Excess information. Reflections</a></li>
<li><a href="../90777/index.html">Visual Studio 2010 is available for download.</a></li>
<li><a href="../90778/index.html">Man, do not let humiliate yourself!</a></li>
<li><a href="../90781/index.html">ISEF Israel, or a few words about our children who live in Israel and are preparing to raise local high-tech</a></li>
<li><a href="../90783/index.html">Online store</a></li>
<li><a href="../90784/index.html">About recursive procedures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>