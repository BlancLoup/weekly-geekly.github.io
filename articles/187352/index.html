<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About kPHP: how kittens speed up VKontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habrovchane. Many already had time to read about kPHP from VKontakte in the past , and somewhere else, but of course there were few details. To sa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About kPHP: how kittens speed up VKontakte</h1><div class="post__text post__text-html js-mediator-article">  Hi, habrovchane.  Many already had time to read about kPHP from VKontakte in the <a href="http://habrahabr.ru/post/187214/">past</a> , and somewhere else, but of course there were few details.  To satisfy our own curiosity and interest from the community, we turned for comments to the original source, that is, Pavel Durov, who recommended me to talk about kPHP with the guys from the team - Oleg Illarionov and Vasily Babich, who were responsible for transferring the VC to the latest development. <br><br>  First of all, I asked those questions that sounded in the comments to the announcement: what's with the PLO, who is faster - an <s>elephant or whale</s> Java C # Go or kPHP, in which projects the kPHP will be most useful, and so on.  In addition, we talked about development plans and, a little, about other developments and the ‚Äúcode‚Äù VK kitchen. <br><a name="habracut"></a><br>  <b>Oleg, Vasily, hello.</b>  <b>So what is kPHP?</b>  <b>What is its essence?</b> <br><br>  Oleg Illarionov: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hello!  kPHP - PHP translator in C ++, which, among other things, analyzes the code, displays the types of variables, and where it could not be unambiguously derived - uses universal variables in which data of any type can be stored. <br>  Of course, kPHP is not a thing that will compile any PHP code and it will work - in fact, kphp is a very good static code analyzer that finds errors, both potential and actual.  By the way, when translating the site <i>(we are talking about VKontakte),</i> even a few small innovations were launched that were made a long time ago, but because of bugs in the code they were not available to the general public. <br><br>  <b>Many questions are related both to the support of the basic PHP methods and to the OOP.</b>  <b>In addition to the already voiced - both about the standard and limited support for the PLO, can you add something?</b> <br><br>  OI: <br>  In kPHP There is a huge mass of everything, even things that we ( <i>VKontakte</i> ) do not use, but so far there are not some very serious pieces - for example, a DOMDocument. <br>  As for OOP, it is currently not supported in kPHP, with the exception of a few standard PHP objects.  One of the tasks when translating a site to kPHP was to completely get rid of OOP.  But this absence was made more like a feature, speed was the main vector in the development of kPHP, It plays not in favor of supporting OOP and, moreover, OOP is good in the first place when you have a hundred developers on the project or there is an abundance of interfaces in it. <br><br>  <b>The classic question in the comments was: "Is kPHP faster than Java C # Go?"</b> <br><br>  OI: <br>  Depends on what exactly to test and how to write the code.  With kPHP it is very interesting: for example, the speed depends on how it displays the type of individual variables.  In general, kPHP was planned as incompatible with PHP language, there are a number of constructs that, for example, allow you to explicitly set the types of variables to speed up execution.  But due to the fact that we have a lot of code (the compiled binary weighs about 300 megabytes), the compilation takes not a few seconds as planned, and the minutes - despite the fact that kPHP recompiles only the changed part of the code - you have to develop features on regular PHP , and it still does not allow us to use all the advantages. <br><br>  Vasily Babich: <br>  Comparison with Java C # Go is difficult - the speed of kPHP, as Oleg has already noted, is very dependent on the code that they compile - if it's good, then the speed is much higher than that of Java / C # - in fact, this is pure C ++.  But if the code is not very good, then it works more slowly.  Probably, if you try hard, you can come up with a synthetic example, where the code is similar, but kPHP is slower - but we didn‚Äôt ask ourselves for this purpose :) <br><br>  <b>We have already seen beautiful graphics accelerating the loading of the main pages of VKontakte due to the transition to kPHP.</b>  <b>What other benefits can kPHP bring?</b> <br><br>  OI: <br>  A significant advantage in the use of memory. <br><br>  WB: <br>  Yes, with kPHP significantly less CPU and RAM usage.  As far as I know, we began to use almost two times fewer servers for processing requests, despite the fact that they are not only doing this - some other systems sometimes work on them, like memcache.  Of course, kPHP is primarily intended for highload projects, which is not surprising, given the tasks for which we are developing it. <br><br>  <b>Some habrovchane critically reacted to the double speed increase VKontakte, indicating that the acceleration of 10 times would be, of course, a much more impressive result.</b>  <b>So, 2 times in total?</b> <br><br>  OI: <br>  It should be understood that the fact that the site is accelerated by 2 times does not mean that kPHP is twice as fast as PHP, this is not so.  The fact is that in addition to executing the code, a very substantial part of the time is spent on accessing databases, engines, and so on.  I think the code execution itself has accelerated more than 10 times. <br>  And also about speed: a web server is built into kPHP, that is, in combination with it, Apache is not needed. <br><br>  WB: <br>  Yes, most of the time the page is generated now is not the execution of the PHP code, but the waiting for a response to requests for data (to other servers).  Of course, we try to use this waiting time somehow, but it really turns out that there are still a lot of expectations, its kPHP does not speed up.  As Oleg said, the actual growth rate is much higher. <br><br>  <b>Oleg, you mentioned the bases and in this regard, the question about them: do you use your own work or something standardly doped?</b> <br><br>  OI: <br>  Now we practically do not use MySQL, except perhaps only where there is a small load and have not yet reached out to transfer our hands to our own engines.  Where data is stored a lot they have been used for a long time.  There are a huge number of them written, it is now difficult to imagine a task that cannot be solved without MySQL. <br>  In general, a number of our standard functions, which we have prudently brought into a separate library, are implemented in C ++. <br>  However, we used this solution even before kPHP - as you know, new functions written in C can also be added to PHP. <br><br>  <b>Are there plans to accelerate or (suddenly!) Reveal engines to the public</b> ? <br><br>  WB: <br>  Those written by our guys (instead of MySQL) and working on the memcache protocol are already quite strongly accelerated.  However, this protocol does not allow speeding up everything as much as we could.  Therefore, we gradually move away from the memcache protocol to our own, which is similar to mtproto, described in the <a href="http://vk.com/androidchallenge">contest for Android</a> - but for the server side (for communication between the servers that respond to the request and servers with data). <br>  About the opening of the public - yes, we planned to open engines on the memcache protocol, but so far we have not reached our hands. <br><br>  <b>Returning to kPHP, what are your plans for its development and support?</b>  <b>Will you cut or give away to the community?</b> <br><br>  OI: <br>  From the nearest - the guys are planning to add OOP, since if we want to embed mtproto, the developers will need it. <br><br>  <b>Thank!</b>  <b>And finally, the most important question: what is k?</b> <br><br>  WB: <br>  K is a prefix from the word kitten, which has already become a tradition in the development of our guys :) <br><br><hr><br><br>  We got this kPHP interview, Habr, thank you for reading this wall of the text without a single picture.  To smooth this awkwardness, I add a little prefix to the topic: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f0/62a/b5f/8f062ab5f2dc4c00c21a235ee4699baa.jpg" alt="image"><br><br>  And, of course, if there are questions on the topic, <a href="http://www.roem.ru/">Roem.ru</a> would be happy to ask the guys about other details of interest to the community. </div><p>Source: <a href="https://habr.com/ru/post/187352/">https://habr.com/ru/post/187352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187336/index.html">"The practice of creating trademarks" - a book about how to create an identity and intelligently use it</a></li>
<li><a href="../187344/index.html">What is it like to be weak in math</a></li>
<li><a href="../187346/index.html">ASUS N750JV Multimedia Notebook Review</a></li>
<li><a href="../187348/index.html">We buy Asus Zenbook ultrabook in the USA for 7300 rubles cheaper!</a></li>
<li><a href="../187350/index.html">Sattelite Reign - the spiritual heir of the Syndicate</a></li>
<li><a href="../187354/index.html">New Opera Next 16</a></li>
<li><a href="../187358/index.html">On the properties of elementary particles. Anti-science speculation arrogant and ignorant accountant</a></li>
<li><a href="../187362/index.html">Unigine Open Air 2013. How it was (a look of one development)</a></li>
<li><a href="../187366/index.html">Which domain zones are safer?</a></li>
<li><a href="../187368/index.html">Effeckt.css from the HTML5 Boilerplate team: selected effects and CSS transitions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>