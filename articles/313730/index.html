<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Problems installing a bootloader on a flash drive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article contains 5 questions and answers on the following topics: 

 1. Cleaning mbr flash drives in Windows 
 2. Convert an ISO file to a hybrid ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Problems installing a bootloader on a flash drive</h1><div class="post__text post__text-html js-mediator-article">  The article contains 5 questions and answers on the following topics: <br><br>  <strong>1.</strong> Cleaning mbr flash drives in Windows <br>  <strong>2.</strong> Convert an ISO file to a hybrid ISO file (Linux only) <br>  <strong>3.</strong> Creating a bootable flash drive with saving changes (Linux, Windows, Mac OS X) <br>  <strong>4.</strong> Creating a multiboot flash drive (Windows) <br>  <strong>5.</strong> Restore partition table and loader mbr (Hiren's BootCD). <br><a name="habracut"></a><br>  To use all the solutions described in the article (except 2 - it works only on Linux), Microsoft Windows and Linux (or Mac OS X) operating systems, Windows USB DVD Download Tool and RMPrepUSB (Windows), dd (Linux, Mac OS X) utilities are required. , isohybrid (Linux), Unetbootin (Windows, Linux, Mac OS X), md5sum (Linux, Mac OS X), an empty flash drive of at least 8 GB, as well as a rescue flash drive Hiren's BootCD 15.2. <br><br>  <strong>1.</strong> Question.  When I got a new job, the first days were devoted to learning.  During training, all students were issued a hard disk containing instructions and software.  One of the instructions provided an example of using the utility Windows 7 USB / DVD Download tool.  With its help, in this example, a special ISO image of the Windows 7 operating system was recorded on a flash drive. In practice, this method did not work.  What to do? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Answer.  Of course, to diagnose and solve the problem.  It may be in a faulty ISO file (the md5sum utility will help to check it), a faulty flash drive (does it open in the Windows file manager?) And the wrong mbr code.  In the latter case, it is useful to clear mbr before using WUDT.  This can be done using the command line using the following commands: <br><br><pre><code class="hljs pgsql">diskpart list disk <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> disk N clean <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> active <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> FS=FAT32 QUICK assign <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br>  Here N is the number of the flash drive in the list of all devices displayed using the list disk command <br><br>  <strong>2.</strong> I wanted to install another operating system on my home computer - Mageia4.1.  To do this, I downloaded an ISO CD image from the official website and burned it to a USB flash drive using the dd command.  But when you try to boot the computer with it, you receive an error message: isolinux.bin is missing or corrupt. <br><br>  Answer.  It looks like the ISO image you downloaded is not a hybrid, i.e.  it is intended only for recording on CD and is not suitable for recording on a flash drive.  This problem can be solved using the isohybrid utility included with syslinux.  It allows you to convert the specified ISO image for CD / Dvd into a hybrid ISO image with the same name. <br><br>  <strong>3.</strong> In the night shift there is a time when there is no work and nothing to do.  In order to occupy myself somehow, I decided to take Linux-LiveUSB with me in order to use my free time with benefits (which is prohibited by the rules).  Writing down with the command <br><br><pre> <code class="hljs pgsql">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=elementaryos<span class="hljs-number"><span class="hljs-number">-0.4</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">stable</span></span>-amd64<span class="hljs-number"><span class="hljs-number">.20160909</span></span>.iso <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>=/dev/sdb bs=<span class="hljs-number"><span class="hljs-number">4096</span></span>,  /dev/sdb -  </code> </pre><br>  On the USB flash drive, the hybrid ISO image of ElementaryOS 0.4 'Loki', I downloaded this operating system on my computer.  Next, I created an empty file in the Documents directory to find out if it will remain after reboot, as was the case with the openSUSE 13.1 GNOME bootable flash drive, created in a similar way, with which I was able not only to create such a file, but also to install the necessary programs that did not disappear after rebooting the computer.  But with Elementary OS 0.4 such a trick did not work.  Can I make sure that when using a bootable flash drive with Elementary OS 0.4, changes are saved as well as in the case of using openSUSE 13.1 GNOME?  Why does it work in openSUSE, but not in Elementary OS? <br><br>  When you first load an openSUSE flash drive, a new partition is created named hybrid, which contains a file system in which all changes made when working with LiveUSB are saved, including the files created and the installed programs.  Elementary OS 0.4 does not know how to do this on its own, but it can be helped in this. <br><br>  First, you can create such a partition using the Unetbootin utility to write an Elementary OS 0.4 iso-image to a USB flash drive.  To do this, you can specify the place used to save the changes after a reboot (only for ubuntu and distributions based on it), for example 4096 MB (see the picture). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a1/caa/dd6/7a1caadd628e0841c4badecc8b478405.jpg" alt="image"></div><br>  <em>Image 1. Unetbootin window</em> <br><br>  The second way is to manually create a second partition on the flash drive with the name ‚Äúcasper-rw‚Äù (for example, using GParted) and specify the keyword ‚Äúpersistent‚Äù in the kernel boot parameters, as was done in the next answer. <br><br>  <strong>4.</strong> I learned how to burn hybrid ISO images of the ElementaryOS 0.4, Mageia4.1 and openSUSE 13.1 GNOME distributions using the dd command, but this method is not suitable for creating a multi-boot flash drive.  How to create such a flash drive? <br><br>  Answer.  This can be done by adding a new operating system to the boot menu of the operating system loader installed on the USB flash drive.  Such loaders are different, as well as ways to install them on a flash drive.  Using the bootloader's configuration file, you can make the selector in the operating system menu transfer control to its kernel and create a temporary file system using its initial ramdisk, and the kernel load the operating system using the operating system iso-image file .  To do this, you can copy the iso-image, kernel and initial ram-disk files of this operating system to the USB flash drive.  Thus, the number of operating systems loaded using such a flash drive that the boot loader installed on it can load is limited only by its capacity. <br><br>  Kernel and initial ramdisk files can usually be obtained by unpacking them from an operating system iso-image file using an archiver.  In Elementary OS, as well as in Ubuntu, they are called casper / vmlinuz and casper / initrd.lz <br><br>  One way to install the operating system bootloader on a USB flash drive is to use the RMPrepUSB utility.  This utility has a graphical interface and works in Windows.  It allows you to install the grub4dos and syslinux loaders, reset the partition table, create a primary partition, format it, and even check the performance of the bootable flash drive in the QEMU emulator. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f17/2be/5da/f172be5da514f4cecd3ba2229382bd21.png" alt="image"></div><br>  <em>Image 2. RMPrepUSB window</em> <br><br>  In order to load Elementary OS 0.4 by the grub4dos bootloader installed using RMPrepUSB, you need to add an item to the boot menu that, when selected, starts the loading of this operating system.  To do this, create the grub4dos bootloader menu configuration file, which is called menu.lst, and, assuming that the iso image, the kernel files and the initial ramdisk are on a flash drive in the elementaryos directory, we add the following lines to it: <br><br><pre> <code class="hljs dos">timeout <span class="hljs-number"><span class="hljs-number">10</span></span> default <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> Elementary OS <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span> 'Loki' <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-root /elementaryos/elementaryos-<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>-stable-amd64.<span class="hljs-number"><span class="hljs-number">20160909</span></span>.iso kernel /elementaryos/vmlinuz file=/cdrom/preseed/ubuntu.seed boot=casper persistent iso-scan/filename=/elementaryos/elementaryos-<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>-stable-amd64.<span class="hljs-number"><span class="hljs-number">20160909</span></span>.iso splash initrd /elementaryos/initrd.lz <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> Reboot reboot</code> </pre> <br>  In openSUSE, the kernel and initial ramdisk files are called boot / i386 / loader / linux and boot / i386 / loader / initrd.  To add openSUSE 13.1 to the boot menu, it is enough to add the following lines to the configuration file before the title Reboot line (assuming that the iso image, the kernel files and the initial ramdisk are on a flash drive in the opensuse directory): <br><br><pre> <code class="hljs ruby">title openSUSE-<span class="hljs-number"><span class="hljs-number">13.1</span></span>-GNOME-Live-i686.iso uuid () &gt; nul set UUID=%?% set ISO=openSUSE-<span class="hljs-number"><span class="hljs-number">13.1</span></span>-GNOME-Live-i686.iso kernel /opensuse/linux isofrom=<span class="hljs-regexp"><span class="hljs-regexp">/dev/disk</span></span><span class="hljs-regexp"><span class="hljs-regexp">/by-uuid/</span></span>%UUID%<span class="hljs-symbol"><span class="hljs-symbol">:/opensuse/%ISO%</span></span> isofrom_device=<span class="hljs-regexp"><span class="hljs-regexp">/dev/disk</span></span><span class="hljs-regexp"><span class="hljs-regexp">/by-uuid/</span></span>%UUID% isofrom_system=<span class="hljs-regexp"><span class="hljs-regexp">/opensuse/</span></span>%ISO% loader=syslinux splash=silent quiet initrd /opensuse/initrd</code> </pre><br>  In such a boot menu, you can add not only operating systems, but also utilities to check the computer‚Äôs RAM, hard disk surface, reset or change Windows password, etc.  For example, you can add the MemTest86 + program call to it by copying the memtest.img file to the root directory of the flash drive and adding the following lines to the menu.lst configuration file before the title Reboot: <br><br><pre> <code class="hljs swift">title memtest86+ v5.<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-root /memtest.img <span class="hljs-built_in"><span class="hljs-built_in">map</span></span> /memtest.img (fd0) <span class="hljs-built_in"><span class="hljs-built_in">map</span></span> --hook chainloader (fd0)+<span class="hljs-number"><span class="hljs-number">1</span></span> rootnoverify (fd0) <span class="hljs-built_in"><span class="hljs-built_in">map</span></span> --floppies=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The memtest.img file can be downloaded from the memtest.org website in a compiled bootable .iso file contained in a zip or gz archive. <br><br>  <strong>5.</strong> I used the parted utility to do this to clean the partition table in the mbr flash drives, but I mistakenly cleared the partition table of my hard disk.  After reboot, the system did not boot.  Fortunately, I had several bootable flash drives containing various Linux distributions.  How to restore the system? <br><br>  Answer.  This situation could have been avoided by calling parted immediately by specifying the device with which you will work, for example: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> parted /dev/sdb</code> </pre><br>  To restore the partition table, you can use the TestDisk utility, which is included with some of the "rescue" Linux distributions, such as Parted Magic LiveCD or SystemRescueCD.  Now the Parted Magic distribution is paid, but you can use its free, obsolete version, which is included with Hiren's BootCD.  In the Hiren's BootCD menu, it is called ‚ÄúLinux based rescue environment (Parted Magic 2012-10-10)‚Äù.  Using these distributions, you can restore not only the partition table, but also the mbr loader using the chroot command. <br><br>  Using chroot to restore the Linux bootloader is quite popular and details about this can be found on various resources on the Internet, including YouTube videos. <br><br>  Sources used: <br><br>  1. <a href="https://ru.wikipedia.org/wiki/Live_USB">LiveUSB</a> <br>  2. <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D1%2583%25D0%25BB%25D1%258C%25D1%2582%25D0%25B8%25D0%25B7%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B0">Multiboot</a> <br>  3. The "Questions and Answers" column in Russian LINUX FORMAT # 203 (12/2015), # 205 (3/2016) and # 207 (5/2016) <br>  4. <a href="https://habrahabr.ru/post/67270/">Installing Linux from an iso image under Windows</a> <br>  5. <a href="https://en.opensuse.org/SDB:Create_a_Live_USB_stick_using_Windows">SDB: Create a Live USB stick using Windows</a> <br>  6. <a href="http://www.rmprepusb.com/tutorials/memtest86">20 - Add MEMTEST86 + memory test program to your grub4dos menu.lst file</a> <br>  7. <a href="https://help.ubuntu.com/community/LiveCD/Persistence">LiveCD / Persistence</a> </div><p>Source: <a href="https://habr.com/ru/post/313730/">https://habr.com/ru/post/313730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313718/index.html">Nine secrets about UX from practicing experts</a></li>
<li><a href="../313722/index.html">The battle of psychics in technical support, or how to help the user correctly put the priority of the incident</a></li>
<li><a href="../313724/index.html">15 best Telegram bots for business</a></li>
<li><a href="../313726/index.html">Interview with Max Stoiber and Sergey Lapin: Choosing a state management solution for React.js</a></li>
<li><a href="../313728/index.html">IT bulldogs under the carpet</a></li>
<li><a href="../313732/index.html">Gamification forum on the engine XenForo</a></li>
<li><a href="../313736/index.html">What applications, games and online stores do the Chinese use?</a></li>
<li><a href="../313740/index.html">Acceleration of the library HeatonResearchNeural (neural network) 30 times</a></li>
<li><a href="../313742/index.html">Used servers: exposing the purchase with the hands</a></li>
<li><a href="../313744/index.html">The opening of a mobile development studio from scratch in St. Petersburg - 3.5 years later. Reincarnation. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>