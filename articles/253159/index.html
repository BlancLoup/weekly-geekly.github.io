<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of participation in the competition "Flying robots". Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 In 2013, in order to popularize robotics in Russia and create an environment for programmers and engineers focused on this topic, CROC (Mos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of participation in the competition "Flying robots". Part 1</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Foreword</b> </h4><br>  In 2013, in order to popularize robotics in Russia and create an environment for programmers and engineers focused on this topic, CROC (Moscow) organized the Flying Robots competition.  Our team ‚ÄúiKar‚Äù (3 people from Barnaul and 1 from Moscow) participated in 2013 (the ‚ÄúFly and Return‚Äù competition) and 2014 (‚ÄúCatch up and overtake Krok‚Äù) did not win, but achieved quite good results. <br><br><h4>  <b>1. How it all began or the conditions of the competition</b> </h4><br>  Being a profession programmer 1C, often have to use the forum forum.mista.ru.  One of my friends, colleagues, was the first to notice an ad on ‚ÄúWho is Lemon,‚Äù and offered to participate. <br><br>  The conditions of the competition looked tempting: it was necessary to build or buy a flying robot and teach it to move / orient around the training area, automatically take off and land, and recognize the landing markers.  The term for the whole work is 1 year, and the prize is 1 million rubles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/495/541/3ce/4955413ceaea4cf99f1edad0f35f3c5e.jpg"><br><br>  There was experience in building helicopters and quadcopters, both for hobbies and for professional use in aerial photography.  There were many questions about the various settings, PID coefficients, code and algorithms of flight controllers.  Using the motivation of the competition, it was possible to understand everything deeply. <br><br>  Since childhood, the dream was to engage in robotics, participation in the competition allowed us to take the first steps in this direction.  Belief in one's own forces, a ‚Äúright‚Äù business and a ‚Äútasty‚Äù prize, did their job, the whole family budget plus the available credit funds were used to build a ‚Äúbudget‚Äù drone robot and go to Moscow for a competition. <br><a name="habracut"></a><br><h4>  <b>2. Choosing an aircraft platform</b> </h4><br><img src="https://habrastorage.org/files/85a/6f4/76a/85a6f476a75f4f5489871a070bcb1075.jpg" width="250" align="right">  As an aircraft (LA) you could use: <br><br>  1) a finished drone, for example, ‚ÄúAR.Drone‚Äù, already able to fly and many buns, of the minuses: <br><br>  - low iron productivity; <br>  - low payload. <br><br>  2) Build your own aircraft of the desired capacity and with the required flight time. <br><br>  The second point did not cause doubts, a hexakopter (6 motor kopter) with an estimated carrying capacity of 2 kg and an estimated time of 20 minutes with a load from the camera and the necessary electronics was an excellent option.  For the tests, it was decided to make a small quadrocopter - ‚Äúwhipping boy‚Äù. <br><br><img src="https://habrastorage.org/files/c12/d40/9cc/c12d409cc0984719b205076d52157350.jpg"><br>  <i>Geksakopter on the basis of the frame Tarot-680</i> <br><br><img src="https://habrastorage.org/files/8dd/e6b/e83/8dde6be83ba642d6b5c3c6e562c78bd9.jpg"><br>  <i>Quadcopter for "whipping"</i> <br><br>  Special attention was paid to the issue of security - all copters were equipped with screw protection.  Thus, after a collision with a wall or when falling, everything remained intact.  This saved money and repair time. <br><br><h4>  <b>3. Scheme of electrical equipment drone 2013</b> </h4><br>  For a faster solution of the task and reduction of labor costs, it was decided to build drons from ready-made modules than, for example, to do everything on the basis of a single-board computer that would perform all the calculations.  For example, you can buy a flight controller that can hold the aircraft in the horizon and stabilize the flight, and control using another device (microcontroller, computer) ‚Äîthe autopilot, which receives data from the sensors, and the radio modem (more on that later), and transmit commands to the flight controller for moving forward, backward, etc.  Autopilot also performs all the intellectual work (navigation, etc.). <br><br>  Since analyzing an image (determining landing markers) is quite a resource-intensive task, calculations should be performed either on board on a powerful microcomputer, or analysis should be performed outside the drone at the base station (laptop), and the image from the drone should be transmitted to the base station via Wifi, or via analog video transmitter.  Thus, by recognizing the markers, such a scheme was obtained (with an analog video transmitter): <br><br>  1) the image from the video camera from the side of the drone was transmitted through the video transmitter; <br><br>  2) taken by the video receiver at the base station; <br><br>  3) the analog video signal came to the laptop through video capture (VIDEO-&gt; USB); <br><br>  4) on the laptop, the image was recognized using the program (OpenCV); <br><br>  5) the radio coordinates of the ‚Äúseen‚Äù marker (X, Y) were transmitted via radio modem to the autopilot; <br><br>  6) according to the obtained screen coordinates, the autopilot determined the location of the landing pad marker relative to the drone and made the decision on landing or navigation for landing. <br><br><img src="https://habrastorage.org/files/ac3/d3e/47c/ac3d3e47cd1340a3bc9ea95c000e76c8.jpg"><br>  <i>2013 drone electrical equipment layout</i> <br><br><h4>  <b>4. Choose a flight controller</b> </h4><br>  Flight controller was available - MultiWii ALL-IN-ONE;  was removed from the existing FPV quadrocopter: <br><br><img src="https://habrastorage.org/files/c1c/42c/a4b/c1c42ca4b0694359b440659d7b69275d.jpg"><br><br>  In terms of flight characteristics, this flight controller is not bad with manual control, but it is significantly inferior in quality to stabilization to professional controllers with more powerful hardware and mathematics. <br><br>  When used for a robot with standard firmware, it was not possible to configure MultiWii, because the firmware was adjusted. <br><br>  Using professional controllers with open firmware like OpenPilot or PixHawk for the project would be more reasonable, but at that time it was impossible. <br><br><h4>  <b>5. Select the sensors</b> </h4><br>  For orientation in space, it was necessary to choose sensors for the drone. <br><br>  Selection list: <br><br><img src="https://habrastorage.org/files/8b9/5e2/784/8b95e27845fe409cb7e48497dc111dc9.jpg"><br><br>  Ultrasonic sonars and infrared sensors were among the available and easy-to-use sensors.  Since the budgetary ultrasonic measurement range was longer (up to 4.5 meters) than the infrared (up to 1.5 meters), they were chosen as the main sensors for the drone. <br><br>  It took a total of 5 pieces: 1 sonar was directed down to maintain height, and 4 pieces.  around the perimeter for orientation from the walls. <br><br><img src="https://habrastorage.org/files/ce4/692/314/ce4692314b6b4523ae88adf041081b2c.jpg"><br><br>  I had to study the ultrasound sensors well to make them work correctly.  For a deeper and safer study, a ground-based robot tank was built with installed sonar.  The tank kept a given distance to an obstacle, for example, a piece of paper that could be moved, and the robot moved behind it.  The data was logged and then it was not difficult to analyze and determine the nuances. <br><br><img src="https://habrastorage.org/files/9d3/89a/e2e/9d389ae2e82341de8a7b43d2d51c699f.jpg" width="300" align="right">  Ultrasound sonars can be classified according to various characteristics, such as effective angle (directivity pattern), distance measurement distance, and so on.  Moreover, the quality of measurement strongly depends on the various characteristics of the sensors.  For example, wide directional sonars work well for large angles of deviation from the surface to which the distance is measured, while narrowly focused ones are lost.  Also, wide-directional ‚Äúbeat‚Äù further (depending on the model) and measure the distance from almost any surface (asphalt, fabric, etc.).  But they have a small drawback - the results of the measurements slightly ‚Äújump‚Äù, unlike narrowly focused ones, respectively, the obtained values ‚Äã‚Äãneed to be filtered. <br><br><img src="https://habrastorage.org/files/23c/d25/67e/23cd2567e3014ea4a749038bfa41d215.jpg" width="300" align="right">  Any sonar demanded a "quality" food, otherwise their testimony "jumped" and it was impossible to navigate by them.  For quality power, you need to use power filters or have a separate DC-DC, full recommendations can be found <a href="http://www.maxbotix.com/articles/067.htm">here</a> .  After the tank was no longer needed, it became a toy.  With the camera installed on board (sonar removed), it was possible to skate around the apartment on FPV. <br><br><img src="https://habrastorage.org/files/66c/b37/38a/66cb3738a88c4afb8ed6ffb13053d9df.jpg"><br><br>  More information about the tank: <a href="http://forum.rcdesign.ru/blogs/45616/">forum.rcdesign.ru/blogs/45616</a> <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/A2HvrcaXl1Q%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhiNe6-r21Mi5_7EoUyF9acNcs-PTg" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  <b>6. Choosing the autopilot, or rather - popayaya a little</b> </h4><br>  In order to read the data from the sonars, make decisions on navigation and send data to the flight controller, a separate calculator was needed - the autopilot.  Since there was knowledge of the Atmega family of controllers, for 2 pm I soldered the poll fee to Atmega162 (the only controller in the DIP package and having 2 UART ports, which could be bought at the local radio store), and which was later replaced by Atmega128 (the firmware grew and did not fit in the memory of the controller). <br><br><img src="https://habrastorage.org/files/af1/ae1/a3d/af1ae1a3dfc941c9b360c9d4bcfd6006.jpg"><br><br>  The pins on the board are connectors for connecting sonars.  The main advantage of using these controllers in comparison with controllers on the Arduino was that the code could be debugged (debugged) with a debugger via JTAG!  That is, at any time, you can stop the program and see everything that interests - the values ‚Äã‚Äãof variables, counters, and others, as well as in case of an error, step by step to find where it originated. <br><br><h4>  <b>7. Learn to keep the height</b> </h4><br>  In order to speed up development / testing in a short time, it was decided to conduct tests in an apartment instead of going somewhere and losing valuable time.  Without thinking twice, a stand was created for testing in a room of 12 square meters.  meters <br><br><img src="https://habrastorage.org/files/516/9ce/04e/5169ce04e6f646229f5e18bcf03fed1b.jpg" width="200" align="right">  Hooks were screwed in the ceiling and in the field, and a strong paraglider sling was stretched between them.  In the drone frame was installed vertical guide - carbon tube.  On top there was a limiter, not allowing the copter to rest against the ceiling.  As a result, the rotor could only move vertically, as required, in order to adjust the PID height-retention factors safely for yourself and the rover. <br><br><img src="https://habrastorage.org/files/a7b/3ae/54f/a7b3ae54fa154daa9bf15f5cd8853d1e.jpg"><br><br>  More information about the landfill can be viewed in the video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/GaGUA33uTsk%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhgcdi8hImjnl1q2HQEXncEs5RjhzQ" frameborder="0" allowfullscreen=""></iframe><br><br>  It took a lot of time to tune the PIDs, but managed to get a good handle on the regulatory mechanism through personal experience and practice.  I also decided on a model of sonars to keep the heights that were acceptable working - these are widely-directed DYP-ME 007 v1.0.  Popular HC-SR04 worked worse - ‚Äúhung‚Äù on a bad surface. <br><br>  Thanks to the work on the stand "live", we managed to achieve a good result, the copter perfectly kept the given height. <br><br><h4>  <b>8. Hold a course or a bit of compass.</b> </h4><br>  One of the following problems was holding the course (Yaw axis), that is, so that the copter does not spin around its own axis.  The decision to use the compass, which was on board the flight controller, turned out to be simple at first glance, but subsequently unacceptable, because the compass refused to work in Moscow at the organizers training ground (power lines, etc.).  However, this decision made it possible to continue testing in my apartment and move on to the following tasks - move on. <br><br><img src="https://habrastorage.org/files/774/e3b/e22/774e3be227e2490582243d4542c67b58.jpg" width="200" align="right"><br>  In Moscow, after finding out on a test that it was impossible to navigate the compass, it turned out to turn off the compass and write your own Yaw hold algorithm.  For this, I entered the value of the calculated angle Yaw (by the way, this angle is also calculated on the Open Pilot CCD3 flight controllers, since there is no compass on board at all, and the angle of rotation can be seen in the setup program).  The value of the angle was calculated according to the data from the gyroscope (angular acceleration along the Yaw axis), the formula was chosen empirically.  Then I measured in a stationary state how much this value runs off in 5 minutes (there was a slight drift in one direction), and corrected this angle at regular intervals to reduce the resulting drift to zero.  On the table, everything worked perfectly, on the copter, in the absence of strong vibrations, this also had to work. <br><br><h4>  <b>9. Keeping distance from one wall</b> </h4><br>  Fixed one sonar (focused HY-SRF-05) in front of the copter to automatically hold the position back and forth (along the pitch axis).  From the control panel, manually controlled moving the copter left and right (along the Roll axis), and in case of unsuccessful PID adjustment (PID) of the regulator, corrected the displacement of the copter back and forth, when the stick stick rejected 10% from the center, the copter switched to manual control by axes back and forth (pitch). <br><br><img src="https://habrastorage.org/files/f11/eb3/b4f/f11eb3b4fdf8473a9f514f1e4cb42c22.jpg"><br><br>  Having suffered a lot with tuning the PID (PID) of the regulator and enumerating its coefficients, I got 3 control coefficients, at which the device almost ‚Äúheld‚Äù tolerably by the wall: <br><br>  P-position (P position), when the regulation error is considered, as the difference between the desired distance from the wall and the current data from the sonar. <br><br>  D - position (D position), the speed of movement from \ to the wall. <br><br>  D for speed (D-velocity), the acceleration of movement from \ to the wall. <br><br>  And (I) - the non-speed position factor was not taken into account = 0. <br><br>  Further searches for truth have already translated into the code of the flight controller.  As it turned out in the MultiWii code, many of the settings in the code are chosen empirically.  You can fly with your hands, but for the robot everything was not very well formed.  I decided to rewrite the PID controller and do the same: P and D position + D velocity, conjured with filters, which I borrowed from the code of the flight controller ArduPilot and got the result to ‚Äúgood‚Äù, but I certainly don‚Äôt compare with professional controllers. <br><br>  When I combined everything, I got a good result for the first time: retention in the range of 1 meter horizontally at a height of 50 cm. I tried to make the height higher, the range of the bumper also increased. <br><br><h4>  <b>10. Connecting the rest of the sonars and setting up joint work of the sonars.</b> </h4><br>  Since sound tends to be reflected, then in order not to catch the reflected signal from one sonar to another, I interrogate the sonars sequentially.  The maximum polling frequency of the used sonars is 20 Hz; it turns out that if you scan the sonars sequentially in succession (and there are 5 of them), then everyone will be polled at a frequency of 4 Hz.  Thanks to the cunning algorithm, in short, the essence of which was to interrogate "uninteresting" sonars (for example, back when moving forward) less often - I received 5 Hz (5 times per second, in principle, not bad!) <br><br>  Concerning stability there were the following thoughts: <br><br><img src="https://habrastorage.org/files/aee/88c/b92/aee88cb9264d4a2eaa72a0c99ecc0a48.jpg" width="200" align="right">  Obviously, the more frequently the sonars are polled (the higher the polling rate), the more accurately the copter can be positioned, but not only the frequency is important, but also the system response time or the delay between direct measurement, for example, the distance to the wall and the impact on the motors taking into account measured distance. <br><br>  How quickly does the current system react to the received values, how quickly (in what time) does the drone react to the measurement - will the control signal to the engines give, after calculating the PID, transfer data from the autopilot to the flight controller and read the distance from the sensor? <br><br><img src="https://habrastorage.org/files/d24/2ac/e93/d242ace93b5447d48264a84602b0c028.jpg" width="300" align="right">  It is easy to imagine such a situation, for example, if information from a video camera came into our eyes (through a monitor or glasses) with a delay of 1-2 seconds, would it be easy to move, despite the fact that the frequency would remain 25 frames per second?  I would have to go very slowly so as not to fall.  Well, if you try to walk this way, for example? <br><br>  Here is another example: the signal from the moon rover from the moon comes with a delay of 3 seconds, while from Mars this time is measured in minutes, and it is simply impossible to control it from the earth (or the speed of the rover would be very, very slow). <br><br>  Calculate the response time for the resulting drone system: <br><br><img src="https://habrastorage.org/files/180/6b5/651/1806b56515a641de81bbe42fb7daff40.jpg"><br><br>  TOTAL pre-delay: 3..29 + 0 + 25 + 2 + 14 = 44..70 ms. <br><br>  Detailed description: <br><br>  1) After a signal is sent to the sonar to measure the distance (trig), the ultrasound module emits an ultrasonic signal, a certain time elapses until the signal-sound returns after reflection from an obstacle.  This time is fixed in the sensor-sonon and output via the analog or digital output of the sensor. <br><br><img src="https://habrastorage.org/files/cb6/048/424/cb6048424f314b4abdaa747ed4b04de1.jpg"><br><br>  2) Since I used the digital output (Echo) of the sonar, on which the signal (+) is generated by receiving the reflected echo, it is recorded immediately on the autopilot controller (by interruption) - in fact, the transmission of the measured distance occurs without delay, unlike, for example, UART or I2C transmissions, when the sonar controller would have to transmit the data sequentially, and the autopilot controller would have to receive it. <br><br>  3) The value obtained by the autopilot controller is calculated and filtered.  The calculated distance to the wall or floor is ‚Äúfed‚Äù to the autopilot PID controller by holding from the wall or floor.  As a result, it receives a new value for controlling the crank on roll (pitch), pitch (pitch) and ‚Äúgas‚Äù (throttle). <br><br>  4) The obtained control values ‚Äã‚Äã(Roll, Pitch, Throttle) are transmitted via the UART port to the flight controller (MultiWii). <br><br>  5) The flight controller reads the data into the ring buffer and after a certain time (50 times per second) ‚Äúfeeds‚Äù it to the PID controller (which, in fact, is a multi wii stabilization system), after which the new value of the control actions are mixed (depending on the scheme LA (quadcopter, hexakopter, etc.) and served on the engine controllers. <br><br>  <u>Since the successive cycle of the survey of sonars is 20 Hz</u> , the time that can be spent on each sonar is no more than 50 ms.  The definition of the distance by the sonar takes up to 29 ms, and accordingly, 21 ms is left for the calculations (filters, PID and path selection algorithms). <br><br>  This time (21 ms) was not enough for a slow 8-bit controller, so the option was invented when the 50 ms interval is used to calculate the control actions from the previous sonar value, and the current cycle simply reads the value of the current sonar.  This solution increased the response time of the system by 50 msec, but allowed it to exist in such a configuration of low-performance iron. <br><br>  <b>TOTAL delay (lag) = 44..70 ms + 50 ms = 94..120 ms, in essence, this delay is the response of the current system to the measured distance.</b> <br><br>  Obviously, the slower the response, the less stable the device will behave at any PID controller and the sensor sampling frequency.  That is, the stability of the device depends not only on the sampling frequency of the sensors, but also on the ‚Äúresponse‚Äù of the aircraft system to the measured distance (lag values ‚Äã‚Äãor response time). <br><br><h4>  <b>11. Possible optimization</b> </h4><br>  How was it possible to reduce the lag value in the current system?  Optimization options: <br><br><img src="https://habrastorage.org/files/491/1e8/713/4911e8713dcb4d06928ac480a4d54159.jpg" width="150" align="right">  1) Using a faster controller for autopilot, for example AWP (172 MHz 32 bits) <br>  a value of 25 ms - which includes the calculation of the distance and the PID controller with transmission can be reduced to 2 ms (- 23 ms). <br>  Due to this, it would be possible to read and perform the calculation in one survey cycle, and this is still (- 50 ms) <br><br>  <b>TOTAL delay (lag) with optimization = 94..120 ms - 23 ms - 50 ms = 21..47 ms</b> <br><br><img src="https://habrastorage.org/files/ea7/cc2/483/ea7cc24838bc4032a589fe90b9e31259.jpg" width="220" align="right">  2) An even more advantageous solution, if the flight controller and autopilot are one fast controller or computer, the scheme would be even faster, as it would save time on transferring information from the autopilot to the flight controller, as well as increase the frequency of the flight controller stabilization system ( in MultiWii, this frequency is about 300 Hz) <br><br><h4>  <b>12. Standalone hanging (holding distance from walls + holding height)</b> </h4><br><img src="https://habrastorage.org/files/eb3/aaa/67d/eb3aaa67d1d846bd929188cc43f948a5.jpg"><br><br>  After we managed to keep the height of the sonar and more or less keep the distance from one of the walls, it was possible to cling the 3rd sonar to the left or right side of the copter, and learn to hang in the room in automatic mode.  But the kopter dangled along each axis and eventually spun counterclockwise, gaining amplitude.  The downside was also that the drone "sluggishly" held the course (Yaw axis), especially strongly twisted the apparatus near the wall.  Also moving from one wall to another, the device lost a bit of height, further slowing down in front of the wall, he tried to gain height, thereby almost firing in the opposite direction.  When installing large PID values ‚Äã‚Äãfor yaw, the device tried to level out as much as possible at the moment of spinning near the wall, thus, working on almost two diagonal engines (a feature for controlling multi-rotor systems along the yaw axis), lost controllability (since in fact only 2 of 4 engines were spinning in quadcopter) and flew into the wall. <br><br>  A lot of time was spent on the stabilization of the apparatus along the course (Yaw axis), the selection of the PIDs of the autopilot and the flight controller.  I also had to come up with a couple of tricks of the apparatus‚Äôs behavior in order to prevent the buildup.  The result was a more or less stable behavior: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/KJhSxbCEQ_k%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhj6vMmDeiRwOnn_vTIcxmtpq1q6Pw" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  <b>13. Navigation in the maze</b> </h4><br>  For the passage of the competitive landfill there was no need to use complex algorithms and construct maps; the simplest rule of the maze ‚Äúright hand rule‚Äù approached the maze.  Slightly modified it and made it on the state machine.  In short, the essence lies in a few simple traffic rules: <br><br><img src="https://habrastorage.org/files/02f/301/d6d/02f301d6d4054ae0bce20a74a73e1182.jpg"><br><br>  To move the drone forward / backward / right / left, the autopilot sends the appropriate commands to the flight controller to tilt the platform in the appropriate direction.  If the walls in the direction of motion are not "visible" on the sonon, the platform bends by 5 degrees (selected the angle manually).  In order for the drone not to accelerate, at regular intervals of time, it assumes a horizontal position and moves by inertia (without tilting in any direction).<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additionally, for rough speed control, I used a GPS receiver, while fixing the speed exceeding the critical one (it was also chosen empirically), the drone slows down, that is, it deviates in the opposite direction from the direction of movement. </font><font style="vertical-align: inherit;">For movement within sight of the distance sensor - sonar, the hold distance from the wall simply changes.</font></font><br><br><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14. Detection of landing point markers</font></font></b> </h4><br><img src="https://habrastorage.org/files/80d/3f6/c59/80d3f6c5962949bfa56b2b0a408106b4.jpg" width="200" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A camera was installed on the drone, the image was transmitted via a video transmitter to a laptop. And further, if the marker was determined (recognized), then the data on the screen coordinates of the marker was transmitted to the autopilot on the radio modem. On the basis of the data obtained, the autopilot calculated the distance to the ‚Äútarget‚Äù relative to the kopter and the visible walls (described in detail in paragraph 3). Then he tried to maintain this distance, and the landing program was turned on, consisting in a slow decrease in the height of the hover.</font></font><br><br><img src="https://habrastorage.org/files/dbf/176/b09/dbf176b09f734909a1aaa2065e7659e6.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the final version of the robot, it was possible to implement a pivoting mechanism for the camera (the camera turned up and down along the Pitch axis). </font><font style="vertical-align: inherit;">Thus, the target tracking mechanism was organized, and when approaching the cross, the camera turned down, keeping the center of the landing pad at the center of attention of the camera. </font><font style="vertical-align: inherit;">Thus, the time of "target tracking" was increased and, therefore, the accuracy of landing, too. </font></font><br><br><img src="https://habrastorage.org/files/c37/582/3da/c375823daf644c7b84b994b7fc7ecdcf.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The recognition of the cross marker in the circle was done using Open CV, the algorithm used to find the intersection of straight lines was used by an individual person in the team who joined the project at the last project dates, so it could not be included in the list of participants (according to the rules of the contest organizers).</font></font><br><br><img src="https://habrastorage.org/files/cf5/6a5/283/cf56a52839d145e3a31e11412e13334a.jpg" width="200" align="right"><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15. Trip to Moscow</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Having passed all control points for participation in the competition, our team was allowed to participate in the final. At the time of the trip, not everything was ready in the new platform based on the hexacopter, because it was decided to finalize the preparations in Moscow at the test site. </font></font><br><br><img src="https://habrastorage.org/files/db6/8a9/a91/db68a9a9176a4d97b90900dd59edfee7.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The landfill was completed in the testing process. </font></font><br><br><img src="https://habrastorage.org/files/24d/01f/632/24d01f6320f54b7ca0e67d0e81cc11dd.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Competitions were divided into 2 days, some photos can be viewed </font></font><a href="http://habrahabr.ru/company/croc/blog/192704/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the website of the organizers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/files/e0e/5a4/bb4/e0e5a4bb44f84330afeb0a411d18b4be.jpg"><br><br><img src="https://habrastorage.org/files/134/de6/676/134de66769a34778bb1eabd94abb6e8b.jpg"><br><br><img src="https://habrastorage.org/files/e6d/94c/4cd/e6d94c4cd3d64cfda9fd95df12fd4a4b.jpg"><br><br><img src="https://habrastorage.org/files/b4c/5fb/92e/b4c5fb92e654498cb2c3b82affc84fd5.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before the start: </font></font><br><br><img src="https://habrastorage.org/files/7e5/728/b0e/7e5728b0e3bd4fecb7d754734e3dbd31.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Waiting area in the parking lot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first attempt of our team failed, the robot flew past, but hooked the fence and touched the floor, but took off and bravely got back.</font></font><br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/6UOZISRv-2Y%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhgjgt6Ni7x6BDh4GTnH2Br5bE1_IA" frameborder="0" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the second attempt to navigate everything went well, the robot did not touch the walls, but did not land on the landing markers, although the markers were well recognized at the base station on the laptop. </font></font><br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/o_gRvMViJqA%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhg9pnF4auVxKkLs2ZI_C2AcRqejKg" frameborder="0" allowfullscreen=""></iframe><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And after the competition turned out to be an almost ideal version of the span, with a landing at both ends. </font></font><br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/u9PLM1T5bPQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhhzJO2jTrHIlKl243sleJDjfJgRBQ" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  <b>Results</b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 people participated in the work on the project of the flying robot in our team. One person was responsible for recognition, one was an excellent specialist in the C language and well versed in AVR controllers, advised in difficult moments of the project. I, as the team captain, designed the drones, programmed and tested, my wife dealt with organizational issues when traveling to Moscow. Also for testing the robot required premises - testing grounds. Thanks to friends who provided their homes, garages and offices. Despite the seemingly small result, a lot of work was done. 90% of the time was spent on learning something new, organizational issues, testing and overcoming difficulties, without which the project would not move.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The competition of 2013 gathered a lot of participants, in the finals on tests and during the competition it was possible to talk a bit with colleagues (the rest of the time was spent on refining and tuning the drone). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the competitions, the weather conditions spoiled the picture a bit and there were problems with wireless communication (wifi) for most of the participants, including the organizers. </font><font style="vertical-align: inherit;">For many people, including us, it was a surprise on the tests that the compass doesn‚Äôt work on a real range (power cables, etc.). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, for the first competition for "adults" it turned out very well. </font></font><br><br><img src="https://habrastorage.org/files/dd2/bd0/f7d/dd2bd0f7d68c481bb7b3f821003d67be.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List of sources about the competition: </font></font><br> <a href="http://www.robots.croc.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.robots.croc.ru </font></font></a> <br> <a href="http://habrahabr.ru/company/croc/blog/192704"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrahabr.ru/company/croc/blog/192704 </font></font></a> <br> <a href="http://habrahabr.ru/post/193304"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">habrahabr.ru/post/193304</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/253159/">https://habr.com/ru/post/253159/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253149/index.html">Corporate search</a></li>
<li><a href="../253151/index.html">The Groovy project intends to join the Apache Software Foundation</a></li>
<li><a href="../253153/index.html">Brutfors passwords of the engineering menu of the radio station</a></li>
<li><a href="../253155/index.html">How are we tested</a></li>
<li><a href="../253157/index.html">Haskell Range Control Arithmetic with Type-Level Literals</a></li>
<li><a href="../253163/index.html">The tenth issue of the magazine TsODy.RF</a></li>
<li><a href="../253167/index.html">3D systems - a selection of great ways to mingle with content</a></li>
<li><a href="../253169/index.html">Open courses Android Study Jams now in Moscow</a></li>
<li><a href="../253171/index.html">New Yandex.Disk sync algorithm: how not to choke 900,000 files</a></li>
<li><a href="../253175/index.html">Bluetooth voltmeter based on arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>