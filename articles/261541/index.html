<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Expanding the functionality of the "notebook"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we explore the equivalent of one very famous Windows program called Notepad and write a DLL that extends its capabilities. Analog is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Expanding the functionality of the "notebook"</h1><div class="post__text post__text-html js-mediator-article">  In this article, we explore the equivalent of one very famous Windows program called Notepad and write a DLL that extends its capabilities.  Analog is called NFOPad. <br><a name="habracut"></a><br>  <b>Source codes not included</b> <br><br><img src="https://habrastorage.org/files/937/daa/4bf/937daa4bfeda4dc1b78f325d40cb5a84.jpg"><br><br>  This program can process text files and search, replace text, that is, the functionality is in no way inferior to the world famous Notepad.  Now we will teach him to process encrypted files.  There are no plug-ins for this miracle of technological progress either, and therefore we will need: Assembler knowledge, debugger, brains and compiler capable of breaking the code into a DLL. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we will teach him to create encrypted files, and first we need to find the place where the file is written to when it is saved. <br><br>  Open NFOPad in the debugger (I personally use the Cheat Engine) and go to the WriteFile function: <br><br><img src="https://habrastorage.org/files/3a0/231/655/3a0231655c26488d9d5af6e5563c02fa.jpg"><br><br>  Here we are in the body of the function WriteFile.  Now we need to find where this function will be called from when saving the file, and for this we set a breakpoint on the <b>ret</b> command <br><br><img src="https://habrastorage.org/files/c8f/d91/3f4/c8fd913f463d400aa61c92d68893e5f6.jpg"><br><br>  Now we will print some nonsense in a notebook and save: <br><br><img src="https://habrastorage.org/files/769/211/bf8/769211bf87db43bb873634a033ac9fef.jpg"><br><br>  After we ordered the notepad to save the text, the breakpoint worked and after pressing F8 we go to the return address: <br><br><img src="https://habrastorage.org/files/11d/cbe/833/11dcbe83390c45cfa4483ef9cc9fd9fc.jpg"><br><br>  What is highlighted in red is a call to the WriteFile function that saves the entered text to a text file. <br><br>  Here is a further action plan.  We will create a DLL library in which there will be a function with identical arguments as in WriteFile and when loading it will replace the address of the function call that is highlighted in red with its own. <br><br>  Open Visual Studio and create a DLL project.  First of all, let's write a function that will be called instead of WriteFile and call it CrackWriteFile.  It will encrypt the transmitted text and then call WriteFile and pass its arguments to it. <br><br><img src="https://habrastorage.org/files/320/ca7/b2b/320ca7b2bbe04724a17edd6d41570730.jpg"><br><br>  Now we will write a function that will replace the address: <br><br><img src="https://habrastorage.org/files/da6/a91/352/da6a9135293246cb9005be13ac237999.jpg"><br><br>  At the entry point still need to register a call to this function. I think everything is clear and proceed to testing.  Inject the compiled DLL into the notepad process and enter the following text into the editor: <br><br><img src="https://habrastorage.org/files/011/6db/e80/0116dbe8007c4461a2b6ddaab63dab34.jpg"><br><br>  Now in the saved file we see not a beautiful poem, and here it is: <br><br><img src="https://habrastorage.org/files/e0a/406/44e/e0a40644e02e46449179c03bc74499e7.jpg"><br><br>  This is in fact the poem, but encrypted by our algorithm.  Now we will teach him also to read the encrypted files.  To do this, we also set brekpoint, but this bryak will work on the ReadFile function and when opening any file.  Then, according to the script we have already worked out, go to the return address and find out where the function was called from. <br><br>  Now we add the CrackReadFile function to our project, which will be called when the notepad opens the file. <br><br><img src="https://habrastorage.org/files/493/811/929/4938119293304002b01953e1da27786c.jpg"><br><br>  Now we change the OnInject function: <br><br><img src="https://habrastorage.org/files/841/1cc/e4e/8411cce4e6a345a7a7323a532c60ad26.jpg"><br><br>  Now, if after the DLL injection into the process, the encrypted file is displayed normally, then everything is done correctly.  In this article, we have expanded the functionality of the analog notebook.  Of course, if desired, it was possible to significantly modify our extension, for example, to make the checkbox appear in the program's interface and only if it is installed, the program encrypts files, or the encryption algorithm can be improved, but this is not the point, since the purpose of the article was to tell that using reverse -engineering can expand the capabilities of programs.  As time will be, I will continue to write similar articles, and since it is summer now, I‚Äôm full of it. <br><br>  I hope my article was interesting to you. </div><p>Source: <a href="https://habr.com/ru/post/261541/">https://habr.com/ru/post/261541/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261531/index.html">Push notifications via Telegram</a></li>
<li><a href="../261533/index.html">Implementing the infrastructure of the Internet of things for a smart office - the experience of Microsoft Technology Center</a></li>
<li><a href="../261535/index.html">Automatic reorganization of arrays in the memory of the graphics accelerator</a></li>
<li><a href="../261537/index.html">Manage dependencies in iOS applications correctly: Typhoon modularity</a></li>
<li><a href="../261539/index.html">Alt key for mouse gestures, as well as various important fixes in Vivaldi 1.0.212.3</a></li>
<li><a href="../261543/index.html">We continue to expand the functionality of the browser Vivaldi</a></li>
<li><a href="../261547/index.html">Announcement Joker 2015 University Day: Celebration on student street</a></li>
<li><a href="../261549/index.html">Distributed cryptoprocessing</a></li>
<li><a href="../261551/index.html">Another smart home, in three parts. Part Three, User Interface</a></li>
<li><a href="../261553/index.html">Version 15.1 of DevExpress components for VCL released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>