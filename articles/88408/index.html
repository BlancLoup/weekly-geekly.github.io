<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ReSharper: search code by pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are two types of searches that you often use: ‚ÄúFind Text‚Äù and ‚ÄúFind Usages‚Äù. But none of them allows you to search for complex language construc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ReSharper: search code by pattern</h1><div class="post__text post__text-html js-mediator-article"> There are two types of searches that you often use: ‚ÄúFind Text‚Äù and ‚ÄúFind Usages‚Äù.  But none of them allows you to search for complex language constructs, for example, all the places in your code that use the expression " <code>s == null || s == String.Empty</code> ".  You can use regular expressions and try to make Find Text, but such regular expressions will look monstrous and, for sure, contain many errors (for example, they will not take into account the possibility of comments at almost every point of the program).  Obviously, to solve this problem, you need some other type of search, which would know about the syntax of the language, the type system and would not force the developer to learn some new syntax of the query language. <br><a name="habracut"></a><br><br><h1>  Smart search </h1><br>  ReSharper 5.0 has a new search type ‚ÄúSearch With Pattern‚Äù, which allows you to search for pieces of code by pattern, and you can impose restrictions on parts of this pattern.  For example, for expressions, you can specify the type, and for the arguments of their estimated number. <br><br>  Let's look at a specific example.  We will search in your code for all the expressions " <code>enumerable.Count() &gt; 0</code> . <code>enumerable.Count() &gt; 0</code> ", where <code>enumerable</code> is any expression of type <code>IEnumerable</code> . <br><blockquote>  If you solved this problem through Find Usages, then you would make the calls of the <code>Count()</code> method, and accordingly you would have to look through the tents or hundreds of calls - this is tedious and fraught with errors.  Find Text looks a little better, but if you think that the searched expression can be written with line feeds, comments, and the <code>Count()</code> method in your project implements objects of different types, it becomes clear that it is not suitable either. <br></blockquote><br>  Open the ‚ÄúSearch With Pattern‚Äù window (Resharper -&gt; Find -&gt; Search With Pattern) and enter the following pattern in the text field: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>$enumerable$.Count() &gt; 0</code> <br> <br>  The <code>$enumerable$</code> will be highlighted in red.  The fact is that the names of placeholders are enclosed in "$" signs; during a search on the place of such a placeholder, any text that meets the specified constraints will be expected: the type of placeholder and its parameters.  In our case, any <code>IEnumerable</code> expression can be in place of <code>$enumerable$</code> .  But first we need to define this placeholder.  To do this, click "Add Placeholder", select "Expression", in the "Name" field, enter " <code>enumerable</code> " (placeholder name without dollar signs).  In "Expression Type", enter " <code>IEnumerable</code> " (start typing the name of the type, and the resolver will prompt you the options).  Do not forget to tick "Or derived type". <br><br>  In just a few seconds, without knowledge of regular expressions, we created a pattern for the search.  But there is one more pleasant and very powerful thing: notice that under the template editing field there is a tick ‚ÄúMatch similar constructs‚Äù.  If this checkbox is checked, then there is a search for not only exact matches with the sample, but also semantically identical structures.  For example, the constructs " <code>a &gt; 0</code> " and " <code>0 &lt; a</code> " are semantically identical.  In our case, this checkbox is reasonably left set, because you don't care how the result of the <code>Count()</code> method is compared with zero. <br><br>  All is ready!  Now you can click the ‚ÄúFind‚Äù button and look at the results. <br><br><h1>  Smart Replacement </h1><br>  Such a powerful search without the replacement function would not be complete, because it is interesting not only to find all the bad places in the program, but also to replace them with the correct code.  To do this, in the ‚ÄúSearch With Pattern‚Äù window, click the ‚ÄúReplace‚Äù button.  A field for entering a replacement pattern appears.  In this field, you can write any text that is correct in terms of language, you can also use placeholders.  Enter in this field: <br><br> <code>$enumerable$.Any()</code> <br> <br>  Now press the Replace button! <br><br><h1>  Make the search pattern backlight and QuickFix </h1><br>  You now have a search pattern and a replacement pattern.  It is logical to make this backlight and QuickFix.  To do this, in the pattern editing window, simply click the ‚ÄúSave‚Äù button.  Your pattern will be saved in the ‚ÄúPatterns Catalog‚Äù.  This directory can be simply used to store frequently used templates, and you can make it a powerful tool for creating your own analyzes. <br><br>  If you open the catalog (ReSharper -&gt; Tools -&gt; Patterns Catalog), you can customize your pattern to customize the text of the tooltip, the text that will be displayed in QuickFix and the type of backlight.  Set all your parameters for your pattern. <br><br>  Everything!  The backlight works!  Now all the code that matches your template will be highlighted on the fly!  And the corresponding QuickFix will appear on the backlight! <br><br><h1>  Examples of search patterns </h1><br>  A search pattern that simplifies expressions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c1/18c/3bb/8c118c3bb365e943a797787be6629bc2.png"><br><br>  In this example, we used placeholders for type, expression, and identifier.  It did not set any restrictions on them, but used them in the replacement pattern.  The only constrained placeholder is <code>$seq$</code> , it is limited to the <code>IEnumrable</code> type. <br><br>  But a pattern that implements highlighting and QuickFix ‚ÄúReplace 'if' with '?:'‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf2/1d7/908/cf21d7908164683c02810fd6ae8a061b.jpg"><br><br>  If you have ideas for useful patterns, then tell us about them in the comments.  This will be useful for the community, and perhaps the most interesting patterns will be included in the next delivery of ReSharper. <br><br><h1>  We write extensions to ReSharper easily and quickly </h1><br>  But that is not all.  In fact, the mechanism that performs pattern matching is much more powerful than the end user can see.  The current restrictions are related to the fact that the ReSharper team is not clear how to properly express certain aspects in the UI.  For example, in the current implementation it is impossible to find a construct in which something is missing (for example, a method call without any verification, or a method of a certain type, but without an attribute).  But this can be done through the API. <br><br>  Moreover, if you write Highlighting or QuickFix using this API, then you save a lot of your time, i.e.  You do not have to seriously understand the source code model and other intricacies.  You describe the sample in terms of the C # syntax, set the parameters and get the result, for example, for ‚ÄúReplace 'if' with '?:'‚Äù It is enough to write such code: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> myMatcher = searcherFactory <br> .CreatePattern( <font color="#A31515">"if ($condition$) { $x$ = $expr1$; } else { $x$ = $expr2$; }"</font> ) <br> .AddExpressionPlaceholder( <font color="#A31515">"condition"</font> ) <br> .AddIdentifierPlaceholder( <font color="#A31515">"x"</font> ) <br> .AddExpressionPlaceholder( <font color="#A31515">"expr1"</font> ) <br> .AddExpressionPlaceholder( <font color="#A31515">"expr2"</font> ) <br> .CreateStatementMatcher();</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Very simple, and most importantly, it is clear without explanation, and does not require knowledge of the internals of ReSharper.  If you started writing this code without using the Search With Pattern API, then you would need knowledge of how the syntax tree is organized, <code>IIfStatement</code> , how <code>IExpression</code> differs from <code>IReferenceExpression</code> , how to compare expressions for equivalence (you need to compare two occurrences of the expression <code>$x$</code> ), and many other complex things. <br><br>  You are looking for a code on the model, do additional checks (for example, ineffable through the Search With Pattern API API) and can hang the lights! <br><br>  Search With Pattern API is available through the <code>StructuralSearchEngine</code> interface.  If there are enough interested people, then in the next article I can give a small example of how you can easily create your own backlights and QuickFix with it. </div><p>Source: <a href="https://habr.com/ru/post/88408/">https://habr.com/ru/post/88408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../88399/index.html">Soyuz-Telecom mobile WiMAX will appear in forty-two settlements of the Moscow region. (Terms not yet named.)</a></li>
<li><a href="../88403/index.html">The epic of personal data continues</a></li>
<li><a href="../88404/index.html">Startup: compilation of tourist routes</a></li>
<li><a href="../88405/index.html">Installing and configuring rTorrent in Debian</a></li>
<li><a href="../88406/index.html">Russian Post: write complaints. How to</a></li>
<li><a href="../88410/index.html">Opera Mobile 10 - the solution to the problem of displaying Gmail</a></li>
<li><a href="../88416/index.html">Mimo 720S usb display overview</a></li>
<li><a href="../88417/index.html">TSLab - trading systems laboratory</a></li>
<li><a href="../88419/index.html">We add devices in the sealed case or "How to cram in nevi"</a></li>
<li><a href="../88422/index.html">Programmers got to the newborns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>