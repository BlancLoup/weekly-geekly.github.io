<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Veeam solution for backup and recovery of virtual machines on the Nutanix AHV platform. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If someone has not heard, then we inform: in the past year, the company Veeam Software has implemented support for backup and recovery of virtual mach...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Veeam solution for backup and recovery of virtual machines on the Nutanix AHV platform. Part 1</h1><div class="post__text post__text-html js-mediator-article">  If someone has not heard, then we inform: in the past year, the company Veeam Software has implemented support for backup and recovery of virtual machines on the Nutanix Acropolis Hypervisor (AHV) platform.  For this purpose, a special infrastructure component Veeam Backup was developed - a secondary proxy server (proxy appliance), which received a beautiful name proper <b>Veeam Availability for Nutanix AHV</b> . <br><br>  It is a virtual module that allows you to backup and restore VMs on Nutanix AHV clusters, leveraging the capabilities of Veeam Backup &amp; Replication.  The solution functions at the hypervisor level: without implementing agents into the guest OS, it creates a backup VM at the image level, as of the current time (including the OS, application data, etc.) and stores it in the Veeam repository. <br><br>  From these backups, you can then recover in any scenario: restore the entire VM as a whole or individual disks, files, application objects.  Both Microsoft Azure recovery, disk export, and instant recovery to VM on the Hyper-V platform are supported. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All interested in asking under the cat. <br><br><img src="https://habrastorage.org/webt/v2/d4/f9/v2d4f9nig2ezbksoj9vscebj87i.png"><br><a name="habracut"></a><br><h1>  A few words about architecture </h1><br>  As already mentioned, the main integration component is implemented as a proxy.  This is a Linux OS virtual machine that coordinates the interaction between Nutanix AHV and the Veeam backup server.  To work with AHV, this proxy uses the Nutanix RESTful API, and performs the following proxy operations: <br><br><ul><li>  Assigns resources needed for backup and restore </li><li>  Reads / writes data to AHV datastores. </li><li>  Transfers VM data to / from Veeam repository </li><li>  Monitors backup jobs </li><li>  Performs data compression and deduplication </li><li>  Monitors storage policy compliance for backups </li><li>  And, of course, is actively working when performing recovery. </li></ul><br>  The proxy is deployed as a virtual machine on a Nutanix AHV cluster, one machine per cluster (so if you plan to back up VMs from two clusters, you will need to deploy two proxies).  To deploy, you need to specify the VMDK file, specially prepared by Veeam and downloaded from the site, as a boot disk for VMs in the Nutanix AHV Cluster cluster. <br><br><img src="https://habrastorage.org/webt/x1/sv/vg/x1svvgmlu58vuskvjngpla2zehy.png"><br><br>  An integrated solution is managed using a web portal in which a variety of operations are available to the user: <br><br><ul><li>  Configuring Connections to Veeam Backup Infrastructure Components </li><li>  Setting up and running backup tasks for VM on Nutanix AHV </li><li>  Restore VMs to Nutanix AHV Clusters </li><li>  Recover VM disks and connect them to machines hosted on Nutanix AHV clusters </li></ul><br>  But there is also the Veeam Backup &amp; Replication console, from which recovery actions are controlled: <br><br><ul><li>  Restore guest OS files </li><li>  Application object recovery </li><li>  Export VM disks to VMDK, VHD and VHDX files </li><li>  Recovery in Microsoft Azure </li></ul><br>  <i>Note:</i> Architecture details are discussed in <a href="https://www.veeam.com/nutanix-veeam-backup-replication-best-practices_wpp.pdf">Veeam Availability for Nutanix AHV Best Practices</a> (in English). <br><br><h1>  System requirements </h1><br>  As already mentioned, to deploy a proxy, it is enough to specify the prepared Veeam VMDK disk as a boot disk for VMs in the Nutanix AHV Cluster cluster. <br><br>  Supported versions of Nutanix AOS: <br><br><ul><li>  Paid - Nutanix AOS 5.1.1.1 or higher </li><li>  Free Edition Community Edition - 2017/07/20 (AOS v 2017/07/08) </li></ul><br><h3>  Virtual hardware requirements for this VM </h3><br>  <b>Processor:</b> x86-64;  4 cores minimum, plus 1 core for each additionally running task in parallel execution (by default, you can start processing 3 machines at the same time). <br>  <b>RAM:</b> 4 GB of RAM plus 1 GB of RAM for each additional task. <br>  Disk space: 1 GB. <br>  <b>Required ports:</b> listed <a href="https://helpcenter.veeam.com/docs/van/userguide/used_ports.html%3Fver%3D10">here</a> . <br><br>  <b>Access Settings:</b> <br><br>  By default, SSH is disabled for the solution, and the web interface in this version does not provide the ability to enable it.  Therefore, we will have to use the AHV console - we go to it from the machine on which our proxy is deployed, and execute one of the following commands: <br><br><ul><li> To enable SSH for one session, run the command <br> <code>sudo /etc/init.d/ssh start</code> <br> </li><li>  To permanently enable SSH, issue the command <br> <code>sudo systemctl enable ssh.socket</code> <br> <code>sudo /etc/init.d/ssh restart</code> <br> </li></ul><br><h1>  Licensing </h1><br>  Licensed objects are virtual machines that will be backed up (we call them ‚Äúprotected VMs‚Äù).  Wherein: <br><br><ul><li>  VM templates are considered ordinary machines. </li><li>  The machines for which only archiving to tape (tape job) or transfer to a backup site (backup copy job) is performed are not considered </li></ul><br>  As it should be, there is a commercial license and a trial license for solving. <br><br><ul><li>  <b>The trial is</b> valid for 30 days, you can download it <a href="http://www.veeam.com/availability-nutanix-ahv-download.html">from here</a> . </li><li>  <b>Paid</b> is 2 types: <br><br><ul><li>  Subscription (subscription) - for a period of 1 to 5 years. </li><li>  Rental (rent) - for a period of 1 to 12 months with the possibility of extension. </li></ul><br></li></ul><br>  There is also a free license for non-commercial use - the <b>NFR license</b> - you can read about it <a href="https://www.veeam.com/blog/ru/how-to-get-free-veeam-nfr-key.html">here</a> . <br><br>  <i>Important!</i>  After the expiration of the full (trial or paid) license you can only restore VMs from backups, backup will not be available. <br><br>  Since the solution includes Veeam Backup &amp; Replication, after downloading the license you have 2 files: <br><br><ol><li>  Veeam Availability for Nutanix AHV license, Veeam Agent for Linux and Veeam Agent for Windows. </li><li>  License for Veeam Backup &amp; Replication. </li></ol><br>  The path to the first file will need to be specified in the web console Veeam Availability for Nutanix AHV (after the setup has completed): <br><br><ol><li>  In the main menu, click on the settings icon (this is the gear, as usual) and select the <b>Appliance Settings</b> item. </li><li>  Go to the <b>Summary</b> tab and click <b>License</b> . <br><br><img src="https://habrastorage.org/webt/vs/ht/pn/vshtpnkdzxuhurwvijytaisgox0.png"><br></li><li>  In the dialog that opens, click <b>Install License</b> and specify the path to the file. </li></ol><br><h1>  Deploy Solution </h1><br>  Deployment takes place in several stages: <br><br><ol><li>  First you need to install Veeam Backup &amp; Replication (as described <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/installation.html">here</a> ).  I note that you can also use Veeam Backup &amp; Replication that is already working in your infrastructure. <br><br>  <i>Important!</i>  Veeam Availability for Nutanix AHV integrated solution is supported only for Veeam Backup &amp; Replication 9.5 Update 3a and higher.  Only 1 Veeam Backup &amp; Replication server can be connected to Veeam Availability for Nutanix AHV infrastructure. <br></li><li>  You need to set up a backup repository (as described <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/setup_backup_repository.html">here</a> ). <br><br>  <i>Important!</i>  You can use a regular repository, a scalable repository or a repository on the ExaGrid storage system.  Devices with built-in deduplication HPE StoreOnce and Dell EMC Data Domain as a repository will not be supported. <br></li><li>  Then, on the AHV cluster, where the machines to be backed up are running, you need to deploy the VM where the proxy software will work - Veeam Availability for Nutanix AHV itself. </li><li>  Next, you need to add the Veeam backup server to the Veeam Availability for Nutanix AHV infrastructure. </li><li>  And in the final, you need to configure access rights to the Veeam repository for the accounts, under which the AHV machines will be backed up. </li></ol><br>  Consider the third and subsequent stages in more detail.  The third stage consists of several steps: <br><br><ol><li>  Disk Image Upload for Proxy VM </li><li>  Creating VM for proxy </li><li>  Login to the web proxy console </li><li>  Installing software on VM proxy </li></ol><br><h3>  Step 1. Download the disk image for the proxy VM </h3><br>  First of all, we need to download the image from the Veeam website and then upload it to Nutanix AHV. <br><br><ol><li>  We download the disk image Veeam Availability for Nutanix AHV <a href="https://www.veeam.com/availability-nutanix-ahv-download.html">from here</a> . </li><li>  Go to the web console Nutanix Prism. </li><li>  Go to the <b>Explore</b> tab and in the left panel select <b>Images</b> . </li><li>  Click <b>Add Image</b> . <br><br><img src="https://habrastorage.org/webt/pl/md/ig/plmdigb3i4nqjje9nw_p9-mplku.png"><br></li><li>  Then click <b>Add File</b> and specify our downloaded VMDK file. </li><li>  Enter the name and short description for our image and click <b>Save</b> . </li></ol><br><h3>  Step 2. Create a clean Nutanix VM </h3><br><ol><li>  On the same <b>Explore</b> tab, in the left pane, select <b>VMs</b> . </li><li>  Click the <b>Create VM</b> button. <br><br><img src="https://habrastorage.org/webt/py/qi/6j/pyqi6jh8q-gjoy207w3x70rnmqm.png"><br></li><li>  In the window that opens, enter the name of the new machine and specify the computational characteristics ( <b>Compute Details</b> ).  Remember the system requirements! <br><br><img src="https://habrastorage.org/webt/g-/b2/ec/g-b2ecmoekkj4rhwesnphhvf-bc.png"><br></li><li>  Now we will indicate what will become the boot disk for this machine.  In the <b>Disks</b> section, click <b>Add New Disk</b> . <br><br></li><li>  In the window that opens, configure the settings for the boot disk: <br><br><ul><li>  From the <b>TYPE</b> list, select <b>DISK</b> . </li><li>  From the <b>OPERATION</b> list, select <b>Clone from Image Service</b> (clone from image). </li><li>  From the <b>IMAGE</b> list, select our VMDK file that we downloaded in the previous step. </li><li>  Click <b>Add</b> . </li></ul><br><br><img src="https://habrastorage.org/webt/y-/q3/cx/y-q3cxjghwbrvwdazv5-hnwdxo8.png"><br></li><li>  Go to the <b>Network Adapters (NIC)</b> section and click <b>Add New NIC</b> to add a new network adapter. </li><li>  Select the desired VLAN and click <b>Add</b> . <br><br>  <i>Note:</i> Check that the specified VLAN has access to the DHCP server, as well as to the Veeam Backup &amp; Replication server and the Nutanix cluster. <br><br><img src="https://habrastorage.org/webt/up/vc/pp/upvcppfgvie4fw3mbxrkgkoskoc.png"><br></li><li>  Click <b>Save</b> .  New car is ready. </li></ol><br>  If something is not obvious, you can read the <a href="https://portal.nutanix.com/">documentation</a> for working with the Nutanix Prism console. <br><br><h3>  Step 3. Logging in to the Veeam Web Console Availability for Nutanix AHV </h3><br>  We are still on the <b>Explore</b> tab in the <b>VMs</b> section of the Nutanix Prism console.  Now we need to complete these steps: <br><br><ol><li>  From the list of virtual machines, select the newly created machine designed for our proxy. </li><li>  Click <b>Actions</b> and select the <b>Power On</b> command to turn on the machine. <br><br><img src="https://habrastorage.org/webt/a_/uu/8v/a_uu8vwlcuir8miz3o0otqznuro.png"><br></li><li>  Go to the selected machine and open the TTY console. </li><li>  After the OS starts, the screen displays the URL of the web console that we need to access.  Open this URL in a browser. <br><br>  <i>Note: You</i> may have to wait 10 seconds and then press <b>ENTER</b> . <br><br><img src="https://habrastorage.org/webt/yg/je/ta/ygjeta8pwxjoopg4tqf6tbgt5tk.png"><br></li><li>  If you do not have a DHCP server configured, then you will have to set a static IP address for the VM. <br></li></ol><br>  For this: <br><br><ol><li>  Log into the console with the initial account (login: <b>veeam</b> ; password: <b>veeam</b> ). </li><li>  Run the command <br><br> <code>sudo nano /etc/network/interfaces</code> </li> <li>  In the file that opens, find the fragment: <br><br> <code>auto eth0 <br> iface eth0 inet dhcp</code> <br> <br>  And replace it with this (specifying the necessary network parameters): <br><br> <code>auto eth0 <br> iface eth0 inet static <br> address &lt;your_IP_address&gt; <br> netmask &lt;your_netmask&gt; <br> gateway &lt;your_gateway&gt; <br></code> <br></li><li>  Save the file.  Restart the Veeam Network Service and Service: <br><br> <code>sudo service networking restart <br> sudo service VeeamBackupAgent restart <br></code> <br></li></ol><br>  Now open a browser URL of the form <b>https: // &lt;your_IP_address&gt;: 8100</b> - this is the URL of the web console of the integrated solution on the proxy VM: <br><br><img src="https://habrastorage.org/webt/kv/eg/4a/kveg4ayn8hgaq1mibmqksrou2mg.png"><br><br>  For login use admin account (login: <b>admin</b> ; password: <b>admin</b> ). <br><br>  <i>Note:</i> Parallel sessions of two or more users are not supported ‚Äî someone else's login will terminate your console session. <br><br><h3>  Step 4. Install the Veeam Software for Nutanix AHV </h3><br>  After you log into the web console on the VM proxy, the Veeam Availability Software for Nutanix AHV installation wizard will start.  Follow his steps: <br><br><ol><li>  Click <b>Install</b> . <br><br><img src="https://habrastorage.org/webt/us/oq/wy/usoqwy2pxnf_tmndohxgrqamvks.png"><br></li><li>  Read and agree to use. </li><li>  In the <b>Credentials</b> step, change the default admin password to your own.  It must contain at least 6 alphanumeric characters and be different from the old one. </li><li>  In the <b>Network Settings</b> step, specify the name of the machine on which the proxy is running and its network settings.  Another option is to select the option to automatically obtain the IP address <b>Obtain an IP address automatically</b> . <br><br><img src="https://habrastorage.org/webt/lc/2t/dh/lc2tdhrbblytiotbfmjzve2-gkq.png"><br></li><li>  In the <b>Summary</b> step, check the settings and click <b>Finish</b> . </li></ol><br>  You will be redirected to the login screen again.  Enter the new admin password to access the web console.  Hurray, we almost finished this stage!  It remains a little bit. <br><br><h3>  Step 5. Add the Nutanix AHV cluster </h3><br>  First, carefully review the limitations: <br><br><ul><li>  You can specify only 1 Nutanix AHV cluster for one proxy. </li><li>  When specifying the cluster settings, you cannot specify the IP addresses of Prism Central. </li><li>  [For Nutanix Community Edition 2017.07.20] For authentication, use the built-in admin account. </li></ul><br>  Then follow the procedure for adding a cluster: <br><br><ol><li>  We go to the web console of our proxy. </li><li>  In the main menu, click on the settings icon (traditionally gear) and select <b>Manage Nutanix Clusters</b> . <br><br><img src="https://habrastorage.org/webt/th/mu/cu/thmucuxwjf_ecozttsxyoicsasw.png"><br></li><li>  Click the <b>Add</b> button. </li><li>  Specify the settings for the Nutanix AHV cluster: <br><br><ul><li>  In the <b>Cluster name or IP</b> field, specify the IP address or FQDN of the Nutanix AHV server. </li><li>  In the <b>Port</b> field, specify the port through which the proxy will communicate with Nutanix AHV (by default <b>9440</b> ). </li><li>  [optional] In the <b>Description</b> field, enter the description of the Nutanix cluster. </li><li>  In the <b>User Name</b> and <b>Password</b> fields, enter the username and password to access the Nutanix AHV cluster. <br><br>  <i>Important!</i>  This account must have the <i>Cluster Admin</i> role. <br></li><li>  Click <b>Save</b> . <br><br><img src="https://habrastorage.org/webt/n8/z0/7a/n8z07abwqdnr6-vkmc9jwq1c868.png"><br></li></ul><br>  On this for today, perhaps, everything.  Next time, we‚Äôll finish with the configuration and learn how to back up and restore the VM.  But it will be in the new, 2019 year. <br>  Happy New Year, dear colleagues and readers!  All the best to you and your loved ones! </li></ol></div><p>Source: <a href="https://habr.com/ru/post/434402/">https://habr.com/ru/post/434402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434380/index.html">Basics of dependency injection</a></li>
<li><a href="../434382/index.html">Migrate Alpine Linux to RISC-V</a></li>
<li><a href="../434384/index.html">About the responsibility of performers</a></li>
<li><a href="../434386/index.html">Douglas Engelbart: "Augmenting Human Intellect: A Conceptual Framework"</a></li>
<li><a href="../434394/index.html">Bugatti Automobiles successfully tested a brake caliper printed on a 3D printer</a></li>
<li><a href="../434404/index.html">SAP Single Sign On Implementation Project</a></li>
<li><a href="../434406/index.html">Notes phytochemist. Sunset era Habra-banana</a></li>
<li><a href="../434408/index.html">Malta project: storing energy with molten salt reaches a new level</a></li>
<li><a href="../434410/index.html">Disposable chargers. Why do we need it?</a></li>
<li><a href="../434412/index.html">Removal of the rocket before launch on the East</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>