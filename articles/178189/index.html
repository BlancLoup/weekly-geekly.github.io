<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy way to detect Guardant dongle emulators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working with the Guardant protection key (no matter which model), the developer uses the corresponding APIs, while the mechanism for working with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy way to detect Guardant dongle emulators</h1><div class="post__text post__text-html js-mediator-article">  When working with the Guardant protection key (no matter which model), the developer uses the corresponding APIs, while the mechanism for working with the device is hidden from it, not to mention the exchange protocol.  It does not have a valid device handle, using only the gateway address (the so-called GuardantHandle) through which all the work goes.  If a key emulator is present in the system (especially for models up to Guardant Stealth II inclusive), using this gateway, the developer cannot determine whether it works with a real physical key, or its emulation. <br><br>  Having asked at one time the question: ‚Äúhow to determine the presence of a physical key?‚Äù, I had to write a little superbly submitted material written by Pavel Agurov in the book ‚Äú <a href="http://rouse.drkb.ru/books.php">USB Interface. Practice of Using and Programming</a> ‚Äù.  After that, spend time analyzing the API function calls from a three megabyte object manager linked to the application, which actually hides the whole ‚Äúmagic‚Äù of working with the key. <br><br>  As a result, there appeared a fairly simple solution to this problem that does not require the use of the original Guardant API. <br>  The only drawback is that all this is terribly undocumented and technical support from Asset will not even consider your questions related to the use of Guardant keys. <br>  And of course, at some point all this code may simply stop working due to changes in the Guardant drivers. <br>  But so far, on April 27, 2013, all this material is relevant and its performance has been tested on drivers from version 5.31.78, up to the current actual 6.00.101. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  The procedure will be something like this: <br><ol><li>  Through SetupDiGetClassDevsA () we will receive the list of all present devices. </li><li>  Check if the device is related to Guardant keys by checking the device GUID.  (At Guardant, this parameter is {C29CC2E3-BC48-4B74-9043-2C6413FFA784}) </li><li>  Get a symbolic link to each device by calling SetupDiGetDeviceRegistryPropertyA () with the parameter SPDRP_PHYSICAL_DEVICE_OBJECT_NAME. </li><li>  Let's open the device with ZwOpenFile () (CreateFile () here unfortunately will not work, because there will be difficulties when working with symbolic links). </li></ol><br>  Now that we have a real key handle on our hands, instead of the pseudo-handle (gateway) provided by the Guardant API, we can get a description of its parameters by sending the corresponding IOCTL request.  True, there is a small nuance. <br><br>  Starting with Guardant Stealth III and higher, the key handling protocol has changed, as a result, the IOCTL query constants and the contents of the incoming and outgoing buffer have changed.  For normal operation of the algorithm, it is desirable to support the capabilities of both old and new keys, so I will describe the differences: <br><br>  To begin with, the IOCTL constants look like this: <br><br><pre><code class="delphi hljs">GetDongleQueryRecordIOCTL = $E1B20008; GetDongleQueryRecordExIOCTL = $E1B20018;</code> </pre> <br>  First for keys from Guardant Stealth I / II <br>  Second for Guardant Stealth III and above (Sign / Time / Flash / Code) <br><br>  By sending the first request to the device, we will expect the driver to return the following buffer to us: <br><br><pre> <code class="delphi hljs"> TDongleQueryRecord = <span class="hljs-keyword"><span class="hljs-keyword">packed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> dwPublicCode: DWord; <span class="hljs-comment"><span class="hljs-comment">// Public code byHrwVersion: Byte; //    byMaxNetRes: Byte; //    wType: WORD; //    dwID: DWord; // ID  byNProg: Byte; //   byVer: Byte; //  wSN: WORD; //   wMask: WORD; //   wGP: WORD; //   GP/  wRealNetRes: WORD; //   , .. &lt;= byMaxNetRes dwIndex: DWord; //     end;</span></span></code> </pre><br>  In the case of more new keys and given the fact that the protocol has changed, sending the first request will not give us anything.  More precisely, the query will of course be executed, but the buffer will come empty (filled out).  Therefore, we send a second request to the new keys, which will return the data in a slightly different format: <br><br><pre> <code class="delphi hljs"> TDongleQueryRecordEx = <span class="hljs-keyword"><span class="hljs-keyword">packed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> Unknown0: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">341</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Byte; wMask: WORD; <span class="hljs-comment"><span class="hljs-comment">//   wSN: WORD; //   byVer: Byte; //  byNProg: Byte; //   dwID: DWORD; // ID  wType: WORD; //    Unknown1: array [354..355] of Byte; dwPublicCode: DWORD; Unknown2: array [360..375] of Byte; dwHrwVersion: DWORD; //   dwProgNumber: DWORD; //   Unknown3: array [384..511] of Byte; end;</span></span></code> </pre><br>  Here the block is already returned to 512 bytes containing more detailed information about the key.  Unfortunately for some reason I cannot give you a complete description of this structure, but I left the fields necessary for this article. <br><br>  The general code for obtaining data about installed keys is as follows: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TEnumDonglesEx</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dwRequired: DWord; hAllDevices: H_DEV; dwInfo: DWORD; Data: SP_DEVINFO_DATA; Buff: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. <span class="hljs-number"><span class="hljs-number">99</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; hDeviceHandle: THandle; US: UNICODE_STRING; OA: OBJECT_ATTRIBUTES; IO: IO_STATUS_BLOCK; NTSTAT, dwReturn: DWORD; DongleQueryRecord: TDongleQueryRecord; DongleQueryRecordEx: TDongleQueryRecordEx; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetLength(FDongles, <span class="hljs-number"><span class="hljs-number">0</span></span>); DWord(hAllDevices) := INVALID_HANDLE_VALUE; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> InitSetupAPI <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; UpdateUSBDevices; hAllDevices := SetupDiGetClassDevsA(<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, DIGCF_PRESENT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> DIGCF_ALLCLASSES); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DWord(hAllDevices) &lt;&gt; INVALID_HANDLE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FillChar(Data, Sizeof(SP_DEVINFO_DATA), <span class="hljs-number"><span class="hljs-number">0</span></span>); Data.cbSize := Sizeof(SP_DEVINFO_DATA); dwInfo := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> SetupDiEnumDeviceInfo(hAllDevices, dwInfo, Data) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> dwRequired := <span class="hljs-number"><span class="hljs-number">0</span></span>; FillChar(Buff[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">#0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> SetupDiGetDeviceRegistryPropertyA(hAllDevices, @Data, SPDRP_PHYSICAL_DEVICE_OBJECT_NAME, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, @Buff[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">100</span></span>, @dwRequired) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> CompareGuid(Data.ClassGuid, GrdGUID) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> RtlInitUnicodeString(@US, StringToOleStr(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(Buff))); FillChar(OA, Sizeof(OBJECT_ATTRIBUTES), <span class="hljs-string"><span class="hljs-string">#0</span></span>); OA.Length := Sizeof(OBJECT_ATTRIBUTES); OA.ObjectName := @US; OA.Attributes := OBJ_CASE_INSENSITIVE; NTSTAT := ZwOpenFile(@hDeviceHandle, FILE_READ_DATA <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> SYNCHRONIZE, @OA, @IO, FILE_SHARE_READ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> FILE_SHARE_WRITE <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> FILE_SHARE_DELETE, FILE_SYNCHRONOUS_IO_NONALERT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NTSTAT = STATUS_SUCCESS <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DeviceIoControl(hDeviceHandle, GetDongleQueryRecordIOCTL, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, @DongleQueryRecord, SizeOf(TDongleQueryRecord), dwReturn, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (DongleQueryRecord.dwID &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetLength(FDongles, Count + <span class="hljs-number"><span class="hljs-number">1</span></span>); FDongles[Count - <span class="hljs-number"><span class="hljs-number">1</span></span>].Data := DongleQueryRecord; FDongles[Count - <span class="hljs-number"><span class="hljs-number">1</span></span>].PnPParentPath := GetPnP_ParentPath(Data.DevInst); Inc(dwInfo); <span class="hljs-keyword"><span class="hljs-keyword">Continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Move(FlashBuffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], DongleQueryRecordEx.Unknown0[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">512</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DeviceIoControl(hDeviceHandle, GetDongleQueryRecordExIOCTL, @DongleQueryRecordEx.Unknown0[<span class="hljs-number"><span class="hljs-number">0</span></span>], SizeOf(TDongleQueryRecordEx), @DongleQueryRecordEx.Unknown0[<span class="hljs-number"><span class="hljs-number">0</span></span>], SizeOf(TDongleQueryRecordEx), dwReturn, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> DongleQueryRecordEx.wMask := htons(DongleQueryRecordEx.wMask); DongleQueryRecordEx.wSN := htons(DongleQueryRecordEx.wSN); DongleQueryRecordEx.dwID := htonl(DongleQueryRecordEx.dwID); DongleQueryRecordEx.dwPublicCode := htonl(DongleQueryRecordEx.dwPublicCode); DongleQueryRecordEx.wType := htons(DongleQueryRecordEx.wType); SetLength(FDongles, Count + <span class="hljs-number"><span class="hljs-number">1</span></span>); ZeroMemory(@DongleQueryRecord, SizeOf(DongleQueryRecord)); DongleQueryRecord.dwPublicCode := DongleQueryRecordEx.dwPublicCode; DongleQueryRecord.dwID := DongleQueryRecordEx.dwID; DongleQueryRecord.byNProg := DongleQueryRecordEx.byNProg; DongleQueryRecord.byVer := DongleQueryRecordEx.byVer; DongleQueryRecord.wSN := DongleQueryRecordEx.wSN; DongleQueryRecord.wMask := DongleQueryRecordEx.wMask; DongleQueryRecord.wType := DongleQueryRecordEx.wType; FDongles[Count - <span class="hljs-number"><span class="hljs-number">1</span></span>].Data := DongleQueryRecord; FDongles[Count - <span class="hljs-number"><span class="hljs-number">1</span></span>].PnPParentPath := GetPnP_ParentPath(Data.DevInst); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> ZwClose(hDeviceHandle); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Inc(dwInfo); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DWord(hAllDevices) &lt;&gt; INVALID_HANDLE_VALUE <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> SetupDiDestroyDeviceInfoList(hAllDevices); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  This procedure enumerates all keys and enters information about them into an array of TDongleQueryRecord structures, after which you can output this data to the user, or use them in any way directly in your application. <br><br><img src="http://4.bp.blogspot.com/-pvC1Rp7Zdcs/UEen6hcMJuI/AAAAAAAAADA/cPz4FjR9Lp8/s1600/6.png" alt="image"><br><br>  As you can see, everything is quite simple, but in Guardant API object modules this code is placed under a rather serious stack virtual machine and is practically not available for analysis by an ordinary developer.  In principle, there is nothing secret, as you can see, the calls do not even use encryption of the transmitted and received buffers, but for some reason the developers of the Guardant SDK did not consider it necessary to publish this information (though I could still get permission to publish this code, because as a result, there are not affected any critical aspects of the key exchange protocol). <br><br>  But let's not get distracted, you probably noticed in the above procedure a call to the function GetPnP_ParentPath ().  This function returns the full path to the device from the root.  Its implementation looks like this: <br><br><pre> <code class="delphi hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPnP_ParentPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value: DWORD)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hParent: DWORD; Buffer: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">1023</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; Len: ULONG; S: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> CM_Get_Parent(hParent, Value, <span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Len := Length(Buffer); CM_Get_DevNode_Registry_PropertyA(hParent, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, @Buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], @Len, <span class="hljs-number"><span class="hljs-number">0</span></span>); S := <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(PAnsiChar(@Buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> CM_Get_Parent(hParent, hParent, <span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Len := Length(Buffer); CM_Get_DevNode_Registry_PropertyA(hParent, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>, @Buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], @Len, <span class="hljs-number"><span class="hljs-number">0</span></span>); S := <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(PAnsiChar(@Buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>])); Result := S + <span class="hljs-string"><span class="hljs-string">'#'</span></span> + Result; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Result = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Result := <span class="hljs-string"><span class="hljs-string">' '</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Actually (you will laugh) the emulator will be detected on the basis of this line. <br>  Usually the device path looks like this: <br><blockquote>  \ Device \ 00000004 # \ Device \ 00000004 # \ Device \ 00000044 # \ Device \ 00000049 # \ Device \ NTPNP_PCI0005 # \ Device \ USBPDO-3 # </blockquote><br>  It will at least contain the text NTPNP_PCI or USBPDO. <br>  Those.  A PCI bus or HCD hub will at least be one of the ancestors. <br>  Since  the emulator is a virtual device, the path to it will look something like this: <br><blockquote>  \ Device \ 00000040 # \ Device \ 00000040 </blockquote><br>  Accordingly, based on this information, you can implement a simple function: <br><br><pre> <code class="delphi hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsDonglePresent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := Pos(<span class="hljs-string"><span class="hljs-string">'NTPNP_PCI'</span></span>, Value) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Result <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Result := Pos(<span class="hljs-string"><span class="hljs-string">'USBPDO'</span></span>, Value) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Well, in conclusion I will describe a few more nuances that can be seen in the de-example attached to the article: <br><br><ul><li>  Relatively recently, new Guardant Flash keys appeared, which are two devices in one.  Those.  This is both a security key and a regular flash drive.  In the UpdateUSBDevices () function, you can see how you can determine which of the DRIVE_REMOVABLE disks in the system are located in the key.  In general, nothing new, the general principle was shown in the <a href="http://rouse.drkb.ru/winapi.php">de-example of safe shutdown of Flash devices</a> . </li><li>  An example of obtaining a string representation of a PublicCode key is given (naturally, without the terminating check character, to avoid). </li><li>  An example of getting a key release date based on its ID is given. </li></ul><br>  A small nuance: <br>  The method described in the article will give a false / positive response when a user uses your product of the Anywhere platform: <a href="http://www.digi.com/products/usb/anywhereusb">http://www.digi.com/products/usb/anywhereusb#overview</a> <br><br>  Take an example <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/178189/">https://habr.com/ru/post/178189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178177/index.html">Unchanging F # queue</a></li>
<li><a href="../178179/index.html">MacBANG magazine!</a></li>
<li><a href="../178181/index.html">New NemoMobile image with UI MeeGo Harmattan</a></li>
<li><a href="../178183/index.html">We study the debugger, part three</a></li>
<li><a href="../178185/index.html">VDS lineup update!</a></li>
<li><a href="../178191/index.html">Kickstarter + Flattr + Open Source = perhaps the best software support we can have</a></li>
<li><a href="../178193/index.html">How to hold a two-day online developer conference for $ 10?</a></li>
<li><a href="../178195/index.html">Hack Skype? Easy!</a></li>
<li><a href="../178197/index.html">Linux / Cdorked.A: Chronicles of the New Apache Backdoor</a></li>
<li><a href="../178199/index.html">We open Ukrainian development office - FAQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>