<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart home, I still made you</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A smart house, quite a hackneyed topic in our time and in this publication I will not tell you about new technologies, manufacturers and current trend...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart home, I still made you</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/rc/pi/ap/rcpiaplfihjycjb82knoboywbs4.jpeg"><br><br>  A smart house, quite a hackneyed topic in our time and in this publication I will not tell you about new technologies, manufacturers and current trends of this topic, everything is written to me once a hundred.  I will try to briefly describe the process of creating a smart home (hereinafter UD) without deep technical narratives.  If this topic will be interesting to readers, I will lay out completely all the listings of programs, MK firmware, diagrams and everything necessary to make this miracle the heart of your home. <br><a name="habracut"></a><br>  The main concepts in the development of a DD are the complete absence of a ‚Äúcollective farm‚Äù, in other words, the electronic stuffing should not stand out aesthetically (ordinary sockets, switches, light bulbs) and not burden users (duplicating the main functionality in usual ways: any light source can be turned on either from the switch and from the phone, and not as with smart lamps, who is in the subject, he will understand).  I will even apply the picture for clarity: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kj/78/ez/kj78ez2owrbmnv3pesjm1xar1b8.png"></div><br>  Last supplement and finish with lyrics.  I could buy a ready-made smart home system, but in the recent past I was well versed in circuit engineering, electronics, programming, and I had a car of time, and at that time I started building a country house, which I really wanted to endow with a brain.  In general, this is how to ask the fisherman why you fish if you can go buy it!  For the pleasure of the guys, for the pleasure, the understanding that you can automate your home, and put your soul, your ideas, your logic in it, really makes your home somehow alive.  Let's go! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, I defined the DD functional, which is really needed: <br><br><ul><li>  Control of all light sources, both from the switch and from the application </li><li>  Lamp brightness control </li><li>  Various lighting modes: automatic shutdown, presence mode, light in the night - this mode I thought up when you turn it on, it lights your way at night to the toilet.  You do not iron your hands on the wall in search of a switch, you can think of something else. </li><li>  Control of certain sockets where the iron, curling iron, hair dryer, hob, etc. is connected  The ideology is as follows: left, forgot turned it off or not, turned it off through the application. </li><li>  It follows from the previous point that it is necessary to manage the house from anywhere in the world and there remains a lightning: <br><br>  - temperature and humidity in the house, on the street and in the basement <br>  -temperature and pressure in the heating system (private house, without it nowhere) <br>  -protection against leaks, smoke, even more precisely not protection, but notification. </li></ul><br><h2>  From words to deeds </h2><br>  Divided the system into three blocks: <br><br><ul><li>  Lighting and power control unit </li><li>  Monitoring unit (various sensors) </li><li>  Mini computer (Primary brain, OS server core, .Net) </li></ul><br>  <b>9-channel control unit for lighting and power load</b> <br><br>  The basis of MK from Atmel atmega1284 is no arduino, only hardcode, only C, the ethernet module ENC28J60 was selected as the communication channel with the brain (UART is boring, limiting the length of the wire, hangs even from fumes), a few words about the ENC28J60 module, in fact, a dubious microcircuit : errata has more datasheets, but for the month of work it has never hung up, so for now I have no complaints about it.  He promised without technical narratives, but this is not floor cleaning, completely without terminology, nowhere.  7 switches and 7 lighting devices are connected to the unit, two channels go to contactors of 25A each, one to the outlet where the wife strokes my trousers for work, and the second to the nursery, there are two for parallel sockets.  First I collected everything on my knee in my laboratory. <br><br><img src="https://habrastorage.org/webt/j5/ni/bg/j5nibgoaxs10wzoladnb0mejbya.jpeg"><br><br>  Grass board by LUT method <br><br><img src="https://habrastorage.org/webt/rf/bh/yl/rfbhyl53ica3mhfcxva6mdkc2og.jpeg"><br><br><img src="https://habrastorage.org/webt/sm/31/oc/sm31ocrqok26zcj5d_8oig8vexa.jpeg"><br><br>  After the board was tested for efficiency, I ordered several copies of the circuit boards in Novosibirsk <br><br><img src="https://habrastorage.org/webt/mm/03/mj/mm03mjsycbzieajbn9ddir9lbtc.jpeg"><br><br>  I collected two copies of the control unit, one to test the loads of the second already for installation in a country house.  It is terrible to install equipment in which I am not sure of the house.  Each channel in theory withstands a current of 12 amperes, but 2-3A is enough to illuminate or control the contactors.  No matter how I tried to burn the test board, I did not succeed, I even connected a 3 kW heat gun, the triacs warmed up almost to red, but none of them failed.  Summarize the board passed the test as well as possible. <br><br>  The microcontrollers on the board were programmed and installed in the house, the light could already be turned on through the switches, but the smart house still did not smell. <br><br>  <b>Mini-computer</b> <br><br>  At work, I discovered a thin client with 1GB RAM and 8GB ROM, on Amazon, the price for it is slightly more than 100 bucks.  I chose Server Core as the OS, because I am a C # oriented person).  I don‚Äôt know how to write native software for android and apple and for a long time I decided for myself that my bot on the Pashka Durov platform would manage the smart home (Telegram who didn‚Äôt understand) for a week I sat behind the laptop under spaten and the bot is ready.  It's nice to work with smart people, this is about telegrams, the bot was written in one breath, clear documentation, working libraries, no glitches.  One well-known sad moment: the Roskomnadzor wants to block the cart with all its might, and it works on smartphones as it worked, but with the bots the situation is slightly different, they connect to the servers one time and in order not to tempt fate I picked up on AWS (Amazon Web Services) openvpn server (and for free, in the Amazon there is a payment for the traffic, and the traffic through the bot is minimal).  After downloading, the thin client connects to the vpn server and, already bypassing all Roscomnadzor blocking, quietly processed requests. <br><br><h2>  Total </h2><br>  The system works for a month in real conditions without a single glitch.  In the telegrams on the android there is a bun that you can bring the bot directly to the desktop and open as a separate application.  Yes, I am far from being a creative person and called the bot Jarvis <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l4/ot/tj/l4ottjtc_lwqs6t9jpamdpmq3yc.jpeg" width="350"></div><br>  Very pleased with the bot and there is simply no need to write native software for mobile devices <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/ap/uk/nxapukjpdt8zilon-2ll2w2nqnq.jpeg" width="350"></div><br>  Some information from the monitoring unit <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zm/ty/5i/zmty5i89jgwl7qnjqaczenusasq.jpeg" width="350"></div><br>  Ask questions, I repeat, if the topic is interesting, then I‚Äôll post all project sources on github as well as all the schemes so that you can, like KIT, put in all the firmware and work with a bang without much knowledge of programming and circuit design. <br><br>  Ps.  There are flaws in the circuit board (too small gaps between power paths, contacts, there are tracks divorced at right angles).  I will pay a fee, the benefit of making a new one is worth a penny.  Thanks to everyone who pointed out these errors. </div><p>Source: <a href="https://habr.com/ru/post/432538/">https://habr.com/ru/post/432538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432518/index.html">Electron and the decline of native applications</a></li>
<li><a href="../432520/index.html">How to change admin user password in Atlassian Jira and Confluence in embedded database (H2)</a></li>
<li><a href="../432524/index.html">Why you should never use Quora again</a></li>
<li><a href="../432526/index.html">Evaluation of new projects</a></li>
<li><a href="../432536/index.html">Air quality in the house in winter</a></li>
<li><a href="../432540/index.html">50 years later. The mother of all demos</a></li>
<li><a href="../432542/index.html">Chinese scientists have developed practical rewritable thermal paper</a></li>
<li><a href="../432544/index.html">The math in Gamedev is simple. Matrices and Affine Transformations</a></li>
<li><a href="../432546/index.html">The digest of interesting materials for the mobile developer # 278 (December 3 - 9)</a></li>
<li><a href="../432548/index.html">An example of using Java-library to create Telegram-bot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>