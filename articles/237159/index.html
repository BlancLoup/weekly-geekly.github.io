<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Static sites: customization and optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of publications about static sites based on our cloud storage (see previous publications here and here ). Today we will discuss ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Static sites: customization and optimization</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/4ba/b9b/392/4bab9b392dd34caa3c594b6ed5c71c8a.png" alt="static sites" width="100%" height="100%"><br><br>  We continue the cycle of publications about static sites based on our <a href="http://storage.selectel.ru/">cloud storage</a> (see previous publications <a href="http://habrahabr.ru/company/selectel/blog/216983//">here</a> and <a href="http://habrahabr.ru/company/selectel/blog/236441/%2522">here</a> ).  Today we will discuss in detail the issues of their fine-tuning and optimization. <br><br>  The main criterion for the excellent work of the site from the user's point of view is, of course, the download speed of the components.  If the site is loaded for some reason for too long, it inevitably leads to the loss of visitors who are tired of waiting.  To make the site fast and convenient, you need to do some work on its optimization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below we will give a number of recommendations with which you can increase the speed of a static site hosted in our repository. <a name="habracut"></a><br><br><h2>  Tip 1. Use the power of CDN </h2><br>  We have already <a href="http://blog.selectel.ru/podklyuchenie-cdn-k-oblachnomu-xranilishhu/">written</a> about connecting to our CDN cloud storage from Akamai.  CDN stores all static content (images, text files, JS, CSS, and so on) on caching servers scattered around the world (see the map <a rel="nofollow" href="http://wwwnui.akamai.com/gnet/globe/index.html">here</a> ). <br><br>  When accessing a web page or its resources, the request will be processed by a cache server geographically closest to the client.  The use of CDN helps to increase the download speed of the site for both stationary and mobile devices. <br><br>  By default, all data is cached in the CDN for 24 hours.  Recently, a new function has been added to the repository, with which you can clear the CDN cache at any time: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b1/c30/44d/7b1c3044d256c53e3ff76ca95589dfed.png" alt="CDN cache" width="100%" height="100%"><br><br>  To do this, simply go to the tab shown in the figure and enter in the form of the address of the pages whose cache you want to clear.  The cache will not be cleared immediately, but approximately 15 minutes after the form is submitted. <br><br><h2>  Tip 2. Don't forget about caching settings. </h2><br>  Any web page includes many different elements: images, scripts, style files, and so on.  The user visiting the page for the first time receives all these elements by performing a series of HTTP requests.  To avoid reloading a large number of files, caching is used. <br><br>  The caching model used in the HTTP protocol is based on the so-called validators - special headers used by the client to make sure that the cached document is still relevant.  Thanks to the validators, the client can check the status of the document without sending the entire cached copy to the server.  In turn, the server sends a document in the response only if the validator received by it indicates an obsolete copy in the client‚Äôs cache. <br><br>  Validators are divided into strong and weak.  Strong validators appeared in HTTP / 1.1.  They are called so because they change whenever a file changes.  These include the so-called ETags (entity tags).  ETag is the content ID of the document;  it changes if at least one bit changes in the document.  As an identifier, for example, MD5-sum of the document content can be used.  When a client requests a document from the server, the ETag value is transmitted in the response, for example: <br><br><pre> HTTP / 1.1 200 OK
 Server: Selectel_Storage / 1.0
 Accept-Ranges: bytes
 Last-Modified: Mon, Aug 18, 2014 12:25:38 GMT
 X-Timestamp: 1408364738.80296
 Content-Type: image / jpeg
 Content-Length: 458073
 Access-Control-Allow-Origin: *
 Access-Control-Expose-Headers: Last-Modified, ETag, X-Timestamp
 ETag: "ebef3343a7b152ea7302eef75bea46c3"
 Date: Wed, 20 Aug 2014 11:52:48 GMT
</pre><br>  When you re-request the same document, the saved value of the validator is already transmitted in the If-None-Match header: <br><br><pre> GET / HTTP / 1.1
 Host: example.org
 If-None-Match: "ebef3343a7b152ea7302eef75bea46c3"
</pre><br>  If the document has not been modified, then the server will return only the headers and the 304 Not Modified code in the response.  Otherwise, the server will return the code 200 and transmit a new version of the document, as well as a new ETag value for it. <br><br>  In our repository and ETag is generated immediately after downloading the file.  It is an MD5 hash of content.  If the content changes, then the ETag changes. <br><br>  Weak validators are called, which do not necessarily change with every file change. <br><br>  An example of a weak validator is the Last-Modified header.  The value of this header is the date the file was last modified.  In our storage, it is installed automatically.  If you specify a date in the If-Modified-Since header not earlier than the one currently contained in the Last-Modified header, then the response will also be 304 Not Modified. <br><br>  Strong validators can be used in any context.  Weak validators are used in a context that does not depend on the exact contents of the file. <br><br>  For example, validators of both types can be used in GET requests with a condition (If Modified Since or If None Match).  However, when downloading files in parts, only strong validators can be used - otherwise the client will receive the file in a non-consistent form. <br><br><h2>  Tip 3. Notice the Cache-Control header. </h2><br>  To set the storage time in the browser cache for a copy of the file whose original is in the storage, use the Cache-Control header with the max-age directive.  Thanks to this header, you can significantly increase the speed of loading the site - if the file is cached, the browser will instantly display the content from the cache, without making any request to the site. <br>  The file storage time is indicated in seconds: <br><br><pre> Cache-Control: max-age = 7200
</pre><br>  In the example above, it is 7200 seconds (2 hours).  Usually, CSS, JS and graphic files are cached this way.  It is desirable to cache them forever, and when changing the content, change the links to them in HTML.  RFC 2616 for such files is recommended to specify the caching time not exceeding 1 year: <br><br><pre> Cache-Control: max-age = 31536000
</pre><br>  If you want a specific file not to be cached, but always to be ‚Äúfresh‚Äù, the following value is set for the Cache-Control header: <br><br><pre> Cache-Control: no-cache
</pre><br>  It indicates that the item should not be cached at all and that the client should request it each time the storage is accessed (the file loading time will increase in this case, since you will have to download the file body). <br><br>  Another way you can always get a file in the current version is to add a checksum to the file name. <br><br>  If the content of the file changes by at least one bit, then the checksum will also change.  If there were no changes, the browser uses the file from the cache.  When a file changes, the link to it will change, and a new version will be downloaded. <br><br>  You can get a checksum using either standard md5sum or sha1sum utilities, or using special utilities. <br><br>  You can also add an arbitrary set of characters to the links to the files ‚Äî for example, a timestamp (http://example.com/script.js?timestamp_here),- and update the links every time the site is added.  When using this method, however, there is no guarantee that the browser will not make unnecessary requests: even for files whose contents have not been changed, there will be another link (the caching key is the entire link along with the query parameters). download them again. <br><br>  For HTML pages, it is preferable to set the Cache-Control header to no-cache.  If you need to urgently change something on the page, and the client has already cached this page (modern browsers do this by default), then the client may not see the changes at all. <br><br>  This is especially important when using a CDN: By default, the Akamai DN caches files without corresponding headers for 24 hours.  You can, of course, clear the cache (see above), but you have to wait at least 15 minutes after sending the corresponding request.  Setting the same value to no-cache will help avoid potential problems - the page will always be loaded in its current form.  In this case, browsers will still use If-None-Match headers (or If-Modified-Since), and a page that has not been changed will not load again. <br><br>  In some cases, it is better to specify the time for caching HTML pages based on the frequency of changes.  For example, if the page with news on the site is updated every hour, then for max-age you can set the value to 3600 (1 hour). <br><br>  The value of the Cache-Control header (as well as other HTTP headers) in our repository can be set via the web interface: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aba/502/504/aba502504ba56a3980ad1bed3b504f6f.png" alt="static site" width="100%" height="100%"><br><br>  Through the web interface, header values ‚Äã‚Äãare set only for the container as a whole.  Header values ‚Äã‚Äãfor individual files can only be set via the API or using third-party clients. <br><br>  Instead of Cache-Control, you can use the Expires header.  Its value indicates the date in the format of RFC 1123 date format, after which the file ceases to be relevant (for example: Tue, 31 Jan 2012 15:02:53 GMT).  Until this date, the browser will not make requests to the site, but will receive the file from the cache.  After this date, the file will be downloaded again. <br><br><h2>  Tip 4. Use gzip compression </h2><br>  With the help of compression, you can significantly speed up the site loading.  Starting with HTTP / 1.1, clients report supported compression methods in the Accept-Encoding header: <br><br><pre> Accept-Encoding: gzip, deflate
</pre><br>  In the server's response, information about the compression method used is transmitted in the Content-Encoding header: <br><br><pre> Content-Encoding: gzip
</pre><br>  One of the most popular and most commonly used methods today is, of course, gzip.  With it, you can significantly reduce the load time.  Gzip especially effectively works with text files: HTML, CSS, JS.  Due to compression, the size of text files (and, accordingly, the volume of transmitted traffic) is reduced by an average of 5-10 times.  This allows you to significantly increase the speed of loading the page, which is especially important for mobile clients with slow connections. <br><br>  There is no point in using gzip for graphic files: compression does not help to significantly reduce their size, and often even increases it. <br><br>  In Akamai CDN, gzip is used for most text files by default. <br><br><h2>  Tip 5. Minify JS and CSS </h2><br>  Minification is the removal of unnecessary / optional characters from a file in order to reduce its size and reduce loading time.  Due to this, the file size is reduced on average by 1.5-3 times.  Today, the practice of minifying not only JS and CSS, but also other types of files (HTML, graphic files, etc.) is becoming widespread. <br><br>  For minification, special tools are used, in particular: <br><ul><li>  <a rel="nofollow" href="https://github.com/mishoo/UglifyJS2">UglifyJS 2</a> </li><li>  <a rel="nofollow" href="https://github.com/google/closure-compiler">Google Closure Compiler</a> </li><li>  <a rel="nofollow" href="http://crockford.com/javascript/jsmin">YUI Compressor</a> </li><li>  <a rel="nofollow" href="http://crockford.com/javascript/jsmin">Jsmin</a> </li><li>  <a rel="nofollow" href="http://cleancss.com/">Clean CSS</a> </li><li>  <a rel="nofollow" href="http://cssminifier.com/">CSS Minifier</a> </li><li>  <a rel="nofol<!--/noindex-->low" href="https://www.npmjs.org/package/html-minifier">html-minifier</a> </li><li>  <a rel="nofollow" href="https://www.npmjs.org/package/imagemin">imagemin</a> </li></ul><br><br>  Using minification, you can not only remove insignificant spaces and line breaks (they are optional in CSS and JS), but also perform more complex operations.  For example, in the JS function of the form: <br><br><pre> function summ (first_param, second_param) {
   return (first_param + second_param);
 }
</pre><br>  You can turn it into function s (a, b) {return (a + b)} and then everywhere in the code you can use s instead of summ, while retaining the logic of its operation.  You can see how the JavaScript minification procedure works at <a href="http://lisperator.net/uglifyjs/" rel="nofollow">http://lisperator.net/uglifyjs/</a> in the Open Demo section. <br><br><h2>  Tip 6. Use concatenation </h2><br>  Modern browsers make an average of 6 parallel domain requests.  If the site contains many small files, its download time may be delayed - this is especially noticeable with a slow or unstable connection. <br><br>  Here concatenation can help - combining several files of the same type (for example, JS or CSS) into one.  It allows you to reduce the number of requests and thereby increase the speed of loading pages. <br><br>  Concatenation can also be used to speed up the loading of images.  It can be done in two ways: using data embedding in a URL and using sprites. <br><br>  The implementation of the data is carried out using a special type of URL - data: URI.  The Universal Resource Identifator URI can be used both in the src attribute of the img tag and in the background image URL in CSS. <br><br>  There are online tools for converting images into data: URI (see, for example, <a href="http://websemantics.co.uk/online_tools/image_to_data_uri_convertor/" rel="nofollow">here</a> and <a href="http://dataurl.net/" rel="nofollow">here</a> ). <br><br>  Sprite is a collection of images, combined into one image.  For the formation of sites using various software tools.  With CSS, you can access the desired part of a large image and place it in the right place on the site. <br><br>  Sprites help to increase download speed, but it should be noted that working with them is often fraught with difficulties.  To make even a small change to the sprite, you will need to make related changes in the CSS. <br><br>  In modern tools to build projects on JS ( <a href="http://brunch.io/" rel="nofollow">Brunch</a> , <a href="http://gruntjs.com/" rel="nofollow">Grunt</a> , <a href="http://gulpjs.com/" rel="nofollow">Gulp,</a> and others).  minification and concatenation procedures can be automated.  In order to perform all the necessary file operations (including the final deploy on the server) using a single command, it is enough to create a small configuration file that describes the order and properties of the assembly. <br><br><h2>  For those who want to learn more </h2><br>  Features of the development and configuration of static sites - an extensive topic, and in future publications, we will continue it.  For those who want to explore this topic deeper, both in theory and in practice, here are some useful links: <br><br><ul><li>  <a href="https://developers.google.com/speed/docs/best-practices/caching" rel="nofollow">https://developers.google.com/speed/docs/best-practices/caching/</a> - recommendations for optimizing caching from Google; </li><li>  <a href="https://developers.google.com/speed" rel="nofollow">https://developers.google.com/speed/</a> - a set of tools for analyzing and optimizing the speed of web pages from Google.  Checks sites online (simply enter the address in the appropriate form) and gives recommendations on how to optimize the speed of downloading files.  Also includes plugins for Chrome and Firefox, with which you can diagnose sites directly from the browser; </li><li>  <a href="http://tools.pingdom.com/fpt/" rel="nofollow">http://tools.pingdom.com/fpt/</a> - online tool for measuring the speed of loading the site and diagnose problems; </li><li>  <a href="https://developer.yahoo.com/performance/rules.html" rel="nofollow">https://developer.yahoo.com/performance/rules.html</a> - recommendations for increasing the speed of work of websites from the company Yahoo! </li><li>  <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html" rel="nofollow">http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html</a> - the head of RFC2616 (it describes the operation of the HTTP protocol) on caching settings. </li></ul><br><br>  All questions and comments will be answered in the comments.  For our part, we promise to talk about current trends in the development of static sites in one of the upcoming publications. <br><br>  Readers who for one reason or another can not leave comments here are invited to our <a href="http://blog.selectel.ru/staticheskie-sajty-nastrojka-i-optimizaciya/">blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/237159/">https://habr.com/ru/post/237159/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237141/index.html">Cosmetic gastrocnemius prosthesis printed on a 3D printer</a></li>
<li><a href="../237143/index.html">From a hobby to a company worth 2.5 billion dollars in less than 6 years: the history of Minecraft in numbers and dates</a></li>
<li><a href="../237151/index.html">Published code of the game Commander Keen</a></li>
<li><a href="../237153/index.html">How to conduct CTA testing so that the conversion increased by 13%?</a></li>
<li><a href="../237155/index.html">Habrahabra extension for Google Chrome</a></li>
<li><a href="../237161/index.html">More AirFiber, good and different</a></li>
<li><a href="../237165/index.html">Internet by sms</a></li>
<li><a href="../237167/index.html">What can help a project manager to work with programmers?</a></li>
<li><a href="../237169/index.html">Why am I waiting for smartphones on Android One</a></li>
<li><a href="../237171/index.html">PT Reporting Portal: how to see the main security threats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>