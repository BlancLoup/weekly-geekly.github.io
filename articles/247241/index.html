<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Attempt to make friends with STM32</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The last time I scoffed at ATtiny 85 microcontrollers, matching poor octopus chips with an Arduino IDE. And then I wanted to see what a miracle is - S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Attempt to make friends with STM32</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6cc/428/9bf/6cc4289bf37d4a4c93b7cc9a05d06c76.jpg"><br><br>  The <a href="http://habrahabr.ru/post/245429/">last time</a> I scoffed at ATtiny 85 microcontrollers, matching poor octopus chips with an Arduino IDE.  And then I wanted to see what a miracle is - STM32, whose fans look at AVR programmers (not to mention the arduinschiki) with some disapproval.  In a quick googling process, it turned out that the STM32 ‚Äúfor idiots‚Äù exists - there is a <a href="http://leaflabs.com/docs/hardware/maple.html">Leaf Maple</a> project, within which there are two boards on the STM32F103 and a development environment that is a clone of the Arduino IDE. <br><br>  The decisive factor was the cost.  The Chinese version of the Leaf Maple Mini sells for $ 4, which is a little more expensive than the Arduino Nano.  Having ordered three pieces, I began to wait. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Perhaps, with a bet on Maple, I hurried a little - the project is more likely dead than alive.  IDE does not develop, there are no drivers without a tambourine under Windows 8, libraries are in embryo, complete despondency and desolation.  For the sake of interest, I blinked the LED, running Maple IDE under OS X (it worked out of the box), and then began to think which side to approach the board for further study. <br><br><a name="habracut"></a><br>  For starters, I found this.  In the STM32F103CBT6 microcontroller (the name of the ST, I note, severe) on the Leaf Maple Mini board is sewn loader that works via USB with Maple IDE.  It is located in flash memory.  How to program the naked STM32?  In a good way, you need to use ST-Link, because it allows you not only to ‚Äúflash‚Äù the firmware, but also to debug it.  And without this piece of iron what to do?  Use the "system" loader STM32, working on the UART.  Mini-board on the CP2102 chip in the bins there, you can start to kink. <br><br>  The IDEs that are used to program the STM32 drive me longingly.  The fact is that I am not a programmer, and the multiple windows with tabs and a bunch of scary letters cause a hidden reluctance to delve into all this.  But it seems necessary.  The least confused of the trinity (Keil, IAR, Coocox) seemed to me last. <br><br>  So, the sequence of actions.  We put Coocox, to it is the GCC compiler for ARM.  Writing a masterpiece project - Blink.  Then on the mounting board we assemble the structure from Maple Mini and CP2102.  We find out that to fill the firmware you need something else, because the "coconut" wants ST-Link.  Directly compiled code is easily flashed over UART using the utility from ST - Flash Loader Demonstrator.  Now more. <br><br>  <b>Coconut with rake</b> <br><br><img src="https://habrastorage.org/files/20a/96b/285/20a96b2857e04b8d9277861aa1c88827.png"><br><br>  I have no rake.  The very first "ambush" - the current version of IDE (2.0) - is something strange, which suddenly does not support STM32F1xx.  We delete, we put version 1.7.7, now we can create the project.  We connect the GPIO to the project, take an example from this module with the Blink we need and rework it a bit to use the Maple Mini LED (PORT B ‚Äã‚ÄãPIN 1).  The initialization of the ports here is a whole song (understandable, but more complicated than on the AVR).  That is, you need not just say, this port is the way out.  This port - it must be turned on and clocked, and it will be a way out with a bow and a plushy, and not with a squiggle and a stud‚Ä¶ <br><br>  <b>Iron assembly</b> <br><br><img src="https://habrastorage.org/files/a40/22c/6bd/a4022c6bd17943b9b18131b745c0cd6a.jpg"><br><br>  Everything is simple - we take the module on the CP2102 and connect it with the STM32. <br><br>  STM - 2102 <br><br>  RX1 - TX <br>  TX1 - RX <br>  GND - GND <br>  Vin - VCC <br><br>  One trick is how to make the STM32F103 run in the UART bootloader mode.  The process is well described on the Leaf Labs website in the section ‚ÄúWhat to do if you ruin the USB bootloader‚Äù.  We connect the BOOT1 leg to the ground, press the RESET and the second button, release the RESET, release the second button.  Hi, loader! <br><br>  <b>We burn!</b> <br><br>  It remains to run Flash Loader Demonstrator and feed the bin-file to it, dangling after compilation somewhere in the depths of the project.  It is curious how the operations in this utility are called.  Download is Chip.  And Upload is from the chip.  My perception revolts, but maybe it‚Äôs accepted here. <br><br>  <b>Total</b> <br><br>  You can not just take and blink the LED on the STM32.  Make it two clicks of the mouse (as in the Arduino) or a pair of commands avr-gcc and avrdude will not work here.  Attempt (Maple IDE) was, but was blown away.  Therefore, you have to really sit down and figure out how things work here. <br><br>  UPD.  Added a poll. </div><p>Source: <a href="https://habr.com/ru/post/247241/">https://habr.com/ru/post/247241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247225/index.html">Physical and functional objects (continued)</a></li>
<li><a href="../247227/index.html">10 new year questions for the startup creator</a></li>
<li><a href="../247229/index.html">JavaScript Trends for 2015</a></li>
<li><a href="../247235/index.html">Interpolation: draw smooth graphs using Bezier curves</a></li>
<li><a href="../247237/index.html">Roslyn: The .Net Community Meeting at CLRium # 2</a></li>
<li><a href="../247243/index.html">Conferences that are waiting for us in 2015</a></li>
<li><a href="../247247/index.html">All about versions of Windows 8.1 and how to legally download the latest image without a subscription</a></li>
<li><a href="../247249/index.html">Zsh: fucky new year</a></li>
<li><a href="../247251/index.html">Programming Philosophy - Three-Way Programming</a></li>
<li><a href="../247253/index.html">Java Check State</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>