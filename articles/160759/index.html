<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hetzner may unexpectedly shut down your server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are a small group of web developers, we write websites to order, we host either from ourselves or from different providers around the world. We hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hetzner may unexpectedly shut down your server</h1><div class="post__text post__text-html js-mediator-article">  We are a small group of web developers, we write websites to order, we host either from ourselves or from different providers around the world.  We have a small department of those.  support, we try to respond to the problems that arise as far as possible.  The article is written by those who have their own servers on Hetzner, so that they are ready for certain features of support. <br><a name="habracut"></a><br><br>  There are also such cases as described below.  We were not ready for it, both morally and technically.  And we are faced with the fact that the server can be turned off, and to understand or eliminate the cause of the shutdown is impossible in operation. <br><br><h4>  10.36 GMT +2 </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The site stopped pinging.  Our support team immediately tried to figure out the reason. <br><br>  The customer of this site is in the US (he sleeps at night), the support team is in Ukraine, Hetzner is in Germany.  The site went down at the most opportune time, when it was night in the USA, and in Ukraine and in Germany normal working hours, which, in theory, should give us the opportunity to restore the site‚Äôs work.  Oh, ... <br><br>  When trying to enter Rescue Mode, we stumbled upon a strange message: <br><br>  "The Ip is locked" with reference to: " <a href="http://wiki.hetzner.de/index.php/Leitfaden_bei_Serversperrung/en">wiki.hetzner.de/index.php/Leitfaden_bei_Serversperrung/en</a> " <br><br>  We read ... Tips like: "First of all, please check the log files of the server" I was somewhat puzzled. <br><br>  Q: How to check log files if access is disabled? <br><br>  Further, more interesting: <br><br><blockquote>  "Before the server can go back online,  We require a signed statement <br>  from the problem, explaining how you have solved the problem <br>  " </blockquote><br><br>  Q: There is no access, the server is disabled, you can turn it on only if you fix it, but to fix it, you need to go in? .. <br><br>  It turned out that this type of problem should (according to the Hetzner rules) be resolved through KVM.  Requested KVM, but it is not clear <b>what to</b> repair.  In the admin there is no mention of specifics, there is only a link to a general document about possible problems. <br><br>  Well, it is logical, if nothing is clear, you need to ask for support: <br><br><blockquote>  Question to Hetzner 11:36&gt; I can not ping and login to the server <br>  Reply from Hetzner 12:25&gt; please check your mails, you should have received a mail. <br></blockquote><br><br>  The support works, but the situation reminds me of an anecdote about the programmers in the balloon, when the answer turned out to be correct and completely useless, and time goes on.  Each question / answer is about an hour of delay. <br><br>  I urgently call our client in the USA, asking them to check and forward all mail from hetzner.  Finally, I get a less clear explanation: <br><br><pre> Dear Sir or Madam<font></font>
<font></font>
 IPs from the same sub net in
 addition to the main IP mentioned in the above subject line.<font></font>
<font></font>
 This is not the case.
 deactivated.<font></font>
<font></font>
 May be found at
 http://wiki.hetzner.de/index.php/Leitfaden_bei_Serversperrung/en.<font></font>
<font></font>
 Yours faithfully<font></font>
<font></font>
 Your Hetzner Support Team<font></font>
<font></font>
 09: 29: 55.027863 a8: be: dd: 56: e7: 15&gt; cf: 40: 04: 22: 32: 1f, ethertype IPv4 (0x0800), 
 length 66: 188.40.25.34.42709&gt; 5.9.xx.xx.80: Flags [.], ack16154, win 661, 
 options [nop, nop, TS val 1003012 ecr 2687744519], length 0
</pre><br><br><h4>  13:21 </h4><br><br>  KVM (LARA) gave (+1 h), 3 hours later after downtime, finally we start to do something and there is hope to deal with the problem.  We get access to the server through Lara. <br><br>  Considering that there is no network, it is not possible to install the root kit check.  We check what we can check, but even tcpdump cannot be started - the port is down and the packets are refused to be sent. <br><br>  Our system architecture: <br><br><img src="https://habrastorage.org/storage2/598/9b4/ff9/5989b4ff97666f8da51e69f6a001292d.png"><br><br>  The host system with KVM, kernel 3.5.2, regular updates GLSA, port only SSH is on guard of borders (I lie, there was still nrpe, checked, it seems there are no references to the fact that nagios-nrpe broke). <br><br>  Understanding that on the Web part of the project a ‚Äúhodgepodge‚Äù of different technologies is installed, including PHP code, therefore the virtual machines are physically separated from the outside world, and they certainly cannot capture a foreign IP address in any way. <br><br>  A study of the basic host of the Gentoo system did not show any changes.  In the messages, dmesg, last file, everything is fine too. <br><br>  In general, after a series of studies, they wrote in support of them that we cannot find anything ourselves and we <i>need help</i> from them to identify the problem.  We also asked to make sure that incomprehensible traffic comes specifically from our VLAN. <br><br><h4>  15:40 </h4><br><br>  Received the answer: <br>  Hetzner&gt; Please follow us through fax or email: <br>  Hetzner&gt; <a href="http://www.hetzner.de/pdf/en/Comment_Serversuspension.pdf">www.hetzner.de/pdf/en/Comment_Serversuspension.pdf</a> <br><br>  Hmm ... Then I get a little type.  It took 4 hours, we did not move a jot, soon morning in the US, adequate (in my opinion) help from Hetzner did not follow, and instead of helping, they ask to send them a fax.  Che is sad ... <br><br>  Q: what to subscribe in the form of "on the elimination of the problem," if we could not find the problem, and accordingly did not fix anything (and said about it)? .. Asked a question.  He received the answer that they have no right to turn on the server for any proceedings until they receive a fax / scan with a signature. <br><br>  Considering that we have already decided to recover from backups at this point (it took a lot of time to ask questions / answers and attempts to understand what the problem was), there was no more rush, we calmly filled out the form and began to expect results. <br><br>  After some time, we get the answer: <br><br><blockquote>  &gt; Dear Client, <br>  &gt; <br>  &gt; it seems <br>  &gt; that you‚Äôre answering MAC‚Äôs.  So please check <br>  &gt; your server again and solve this issue. <br></blockquote><br><br>  Ok ... Considering that the server was turned on for about a minute, we didn‚Äôt have time to see anything. <br><br>  After that, we asked what can now be done with the server, without having network access to it, we were advised to format the server and <b>install a new system</b> by mounting the remote ISO image. <br><br>  We tried to do it, but we were not technically ready (there wasn‚Äôt a small ISO on hand, all were large for the desktop, tried to load X, and were not very suitable for installation via KVM).  The story ended around 10 pm, when KVM was chopped off during the installation of the system (the rule in Hetzner - free KVM is given for no more than 2 hours). <br><br><h4>  In a few days </h4><br><br><img src="https://habrastorage.org/storage2/41c/8b4/6bd/41c8b46bd2b22654426dee01e3349786.png"><br><br>  In a relaxed atmosphere, on Monday morning, they made an application for KVM, got access, installed a small system on sda1 (raid collapsed) via Lara / ISO mount image, sent a fax scan about problem solving, and received an answer that the server is activated.  But for some reason he did not ping ... <br><br>  After re-applying for activation, the site finally stopped, we logged off the network, and the first thing I did was a full tar cjvpf backup of the old main system, download it to myself for experiments and deployed locally. <br><br>  Locally also could not find the problem.  I picked up a separate machine as the default router, turned it on to the one on which the copy was running, looked at the tcpdump traffic at both ends, raised the NAT from the gw address for the grid.  No strange packages found. <br><br>  We checked on the root kit, checked all the packages and files - there is not a single modified MD5, there are no extra processes, and so on. <br><br>  What was the problem?  One can only guess.  Perhaps they have the same MAC addresses on the network, maybe something else ... Who else can tell? <br><br>  In general, even if there were problems with us (which I doubt), it is impossible to find out.  And they, for their part, are hardly recognized or will be able to provide a specialist for help. <br><br><h4>  Conclusions (and by the way, we have many other clients already / still being hosted on Hetzner). </h4><br><br>  1) Always have a small ISO image of your system at hand, so that at the request of hetzner you can quickly format your server.  It is desirable that the main section and services / data are separated. <br><br>  2) It is highly desirable to stream netflow outside Hetzner, so that you can check the charges later. <br><br>  3) Always be prepared for the fact that the server can disappear for good (which, incidentally, is the right strategy). <br><br>  PS Admins tell me that this is normal: first we chop off the problem, then we understand what it is.  But if the former occurs promptly, then the proceedings must follow. </div><p>Source: <a href="https://habr.com/ru/post/160759/">https://habr.com/ru/post/160759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160749/index.html">How search tips save human life every day</a></li>
<li><a href="../160751/index.html">Yandex money began to carry out part of the Internet payments on the plastic card of the poison as withdrawals from an ATM</a></li>
<li><a href="../160753/index.html">Microsoft launches Google-criticized Bing ad campaign</a></li>
<li><a href="../160755/index.html">AWS: IAM Roles for Servers</a></li>
<li><a href="../160757/index.html">In Syria, turned off the Internet</a></li>
<li><a href="../160761/index.html">A look into the future of CAD</a></li>
<li><a href="../160763/index.html">iTunes 11 is finally available for download.</a></li>
<li><a href="../160769/index.html">MSP430 LaunchPad and DHT11</a></li>
<li><a href="../160779/index.html">Happy holidays, security men!</a></li>
<li><a href="../160783/index.html">DevCon 2013 Conference - Two Days of Technical Buzz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>