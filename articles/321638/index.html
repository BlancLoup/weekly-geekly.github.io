<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Continuous Integration UWP Applications in Visual Studio Team Services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With VSTS, you can automate software deployment and testing in a variety of environments. The essence of Continuous Integration is to perform frequent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Continuous Integration UWP Applications in Visual Studio Team Services</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/cb9/5ee/abf/cb95eeabfc894c31ad03b6e9e58a8367.png"></div><br><br>  With VSTS, you can automate software deployment and testing in a variety of environments.  The essence of Continuous Integration is to perform frequent automated project builds to quickly identify and solve integration problems.  In particular, CI allows you to automate the regression testing of applications. <br><br>  As an introduction to VSTS features, I propose to publish and configure Continuous Integration with Unit tests with a simple UWP application. <br><a name="habracut"></a><br>  Create a simple UWP application project in which we will have one method: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalcSquere</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> res = Convert.ToDouble(t); res = res * res; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> <br>  In the solution, add a project with unit tests (Unit Test App).  It is recommended to name the test project under the convention, adding to the end Tests.  Thus, it will be easier to configure test launches in VSTS and TFS.  Add a link to the main project: <br><br><img src="https://habrastorage.org/files/edf/65e/e9e/edf65ee9e5a54d91b67f452ddc4cac5a.PNG"><br><br>  Rename UnitTest.cs to MainPageTests.cs.  If the file is named this way, it will become easier to understand exactly what this class is testing. <br><br>  Add a method: <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">TestMethod</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalcSquere_5_Result25</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Windows.ApplicationModel.Core.CoreApplication.MainView.CoreWindow.Dispatcher.RunAsync(CoreDispatcherPriority.Normal, () =&gt; { SimpleApp.MainPage mp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleApp.MainPage(); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expected = mp.CalcSquere(<span class="hljs-string"><span class="hljs-string">"5"</span></span>); Assert.AreEqual(expected, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-string"><span class="hljs-string">"Wrong"</span></span>); }).AsTask().Wait(); }</code> </pre> <br>  Method code is run from a UI stream.  Do not forget to add the namespace <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows.UI.Core;</code> </pre> <br>  If during the creation of the project we did not add a version control system, then we need to do it now. <br><br><img src="https://habrastorage.org/files/fcd/e8d/389/fcde8d38974f4dc1b8f2ec7be42be2d9.PNG"><br><br>  You must remove the certificates of both projects from the gitignore list (otherwise the VSTS build will fail). <br><br>  We publish on VSTS.  Go to the Team Explorer window and click Sync. <br><table><tbody><tr><td><img src="https://habrastorage.org/files/1bb/ca6/fae/1bbca6faed6d44c09913113d62ffb8a5.PNG"></td><td><img src="https://habrastorage.org/files/1b6/9a9/172/1b69a91728ae4673a0a530b5da56c00c.PNG"></td></tr></tbody></table><br>  After the publication we can create Build Definition.  But before that we need to configure the build agent.  The fact is that in order to run Unit tests it is necessary that a custom agent be created. <br><br>  By default, there are 3 agent pools: <br>  <b>Default pool is</b> used for agents that are installed on remote servers. <br>  <b>Hosted pool is</b> used for agents that are installed by default on VSTS and TFS servers. <br>  <b>Hosted Linux pool</b> allows you to work with Linux machines without any configuration of your agent.  Works in a Ubuntu Linux host inside the vsts-agent-docker container docker. <br><br>  The table below shows possible scenarios that indicate that we need a custom agent: <br><table><tbody><tr><td>  Scenario </td><td>  Custom Agent </td><td>  Hosted build agent </td></tr><tr><td>  Main features of UWP builds (including .NET native) </td><td>  X </td><td>  X </td></tr><tr><td>  Creating packages for sideloading </td><td>  X </td><td>  X </td></tr><tr><td>  Creating Packages for Windows Store </td><td>  X </td><td>  X </td></tr><tr><td>  Using third-party certificates </td><td>  X </td><td></td></tr><tr><td>  Build for a special version of the Windows SDK </td><td>  X </td><td></td></tr><tr><td>  Running unit tests </td><td>  X </td><td></td></tr><tr><td>  Using incremental build </td><td>  X </td><td></td></tr></tbody></table><br>  To create your build agent, you need to create a personal token.  Click on the profile icon and go to Security. <br><br><img src="https://habrastorage.org/files/e1d/75e/2ef/e1d75e2ef0594546a778c4ba6c9727f8.PNG"><br><br>  Click Add.  We select only Agent pools (read, manage) <br><br><img src="https://habrastorage.org/files/4fa/350/a3f/4fa350a3f3524f92a01fcb2ba46969fd.png"><br><br>  Click Create token (below) and copy the value, saving it on your computer <br><br><img src="https://habrastorage.org/files/5d8/7f6/6e9/5d87f66e98c947419ce4326cc4c953a3.png"><br><br>  The message warns us that if we do not save the value of the token now, then later we will not be able to get it.  Go to the agents <br><br><img src="https://habrastorage.org/files/38c/821/b3d/38c821b3da014bb3a2e8814aa0bd12ff.png"><br><br>  It is in this window that our agent will appear after we create it, but for now, it is empty. <br><br>  Click Download agent. <br><br><img src="https://habrastorage.org/files/9b5/592/956/9b55929569624387a7ca374aad0f3f16.png"><br><br>  You download the archive vsts-agent-win7-x64-2.110.0.zip.  Unpack it into the C: \ agent folder (the name and location do not have to be exactly that) <br><br>  It is not necessary to install the agent on the same machine on which you are developing.  It can be installed on any machine.  Theoretically, it can be installed on the Azure virtual machine.  A prerequisite - you must have a 64-bit version of Windows.  Most scenarios require that Visual Studio along with NuGet be installed on the machine. <br><br>  Start PowerShell and go to the directory C: \ agent.  Configurable.  Execute the batch file <b>. \ Config.cmd</b> and respond to requests.  Enter the server URL and select the type of authentication.  For VSTS, the only available option is PAT (Personal Access Token).  This is exactly the same token that we created a little earlier.  Next comes the selection of the pool and agent name.  These values ‚Äã‚Äãin my case were left by default. <br><br><img src="https://habrastorage.org/files/a09/8f1/d5b/a098f1d5bfc44b93ba2385a36fc7250b.PNG"><br><br>  The final configuration step is whether you need to start the agent as a service.  If testing is necessary, the agent is started manually, i.e.  as a service, you do not need to install it. <br><br>  Remark: You can remove the agent using <b>. \ Config remove</b> This will need to enter the PAT token. <br><br>  Read more about configuring here: <a href="https://www.visualstudio.com/en-us/docs/build/admin/agents/v2-windows">Deploy an agent on Windows</a> <br><br>  Now let's create a build <br><br><img src="https://habrastorage.org/files/c27/bce/54b/c27bce54bdec4c3e9530ab0b8f58c81e.PNG"><br><br>  Choose a template for a universal platform <br><br><img src="https://habrastorage.org/files/662/6fd/a3e/6626fda3e3174990819f113defcc4039.PNG"><br><br>  And configure Continous integration (tick the opposite).  Agent pool, select Default <br><br><img src="https://habrastorage.org/files/a96/855/9bc/a968559bc0274f7488f1fca8311f844f.PNG"><br><br>  As a result, we get the following window: <br><br><img src="https://habrastorage.org/files/413/e7c/b6e/413e7cb6e3dc418bb85e6cc85f96bda9.PNG"><br><br>  The step of publishing artifacts (Publish Artifact: drop) can be skipped or even deleted to save time if you are not going to make a copy of the files obtained as a result of building the application (you can, for example, send this copy to the client, send it to a release or test it manually). <br><br>  To speed up the build (if you only need to make sure that the tests pass) at the Build solution step you can specify one platform - x64.  This is recommended for CI. <br>  In this case, change the MSBuild Arguments line in the build settings.  AppxBundle set the Never setting: <br><br><blockquote>  / p: AppxBundlePlatforms = "$ (BuildPlatform)" / p: AppxPackageDir = "$ (Build.ArtifactStagingDirectory) \ AppxPackages \\" / p: AppxBundle = Never / p: UapAppxPackageBuildMode = StoreUpload </blockquote><br>  In this line, $ (Build.ArtifactStagingDirectory) is a variable that denotes the path to the folder with artifacts.  If on my machine the agent is installed on drive C in the agent folder and if during its configuration I chose the directory called _work as the working folder, then the path to this folder is as follows: <br><br>  C: \ agent \ _work \ 1 \ a <br>  Here 1 is the serial number of the project. <br><br>  A list of all variables can be found on the following page: <a href="https://www.visualstudio.com/en-us/docs/build/define/variables">Use build variables</a> <br><br>  Basic settings: <br><br><img src="https://habrastorage.org/files/908/f77/132/908f771329f34333a393aa91a72951af.PNG"><br><br>  If you want to generate a bundle (a file containing application packages for different processor architectures), then you need to make changes in the project settings.  Or rather, open the .csproj project files and make the following changes. <br>  In the project file, the unit test at the end of the first element <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  add: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxBundle</span></span></span><span class="hljs-tag">&gt;</span></span>Never<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxBundle</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And in the project file add: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxBundle</span></span></span><span class="hljs-tag">&gt;</span></span>Always<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxBundle</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  After these changes, the AppxBundle parameter can be safely removed from the MSBuild Arguments line along with its value (or set to Auto - / p: AppxBundle = Auto) <br>  This option is suitable for CD. <br><br>  Since there is a desire to test (and in our case it is), it is necessary to add a step <br><br><img src="https://habrastorage.org/files/8b8/847/c54/8b8847c54d9f4c3193fb64215e06c01c.PNG"><br><br>  In the task selection window, add Visual Studio Test.  Specify the path to the test assembly <br>  In my case it is: <br><br>  $ (Build.ArtifactStagingDirectory) \ AppxPackages \ SimpleAppTests_1.0.0.0_x64_Test \ SimpleAppTests_1.0.0.0_x64.appx <br><br>  Other possible test settings are described at the following link: <a href="https://www.visualstudio.com/en-us/docs/build/steps/test/visual-studio-test">Visual Studio Test</a> <br><br>  For unit tests, it is necessary for the agent to be run interactively (that is, using the script <b>. \ Run.cmd</b> ). <br><br>  In addition, it is necessary that application certificates (both the main application and the unit test application) are installed in the Local Machine - Trusted People storage (installation is possible by simply double clicking on the * .pfx file).  You need to install certificates on the same machine where the agent is installed. <br><br>  Sometimes, when running tests, an error may occur: <br><br>  <i>... (0x5B4) Operation timed out.</i>  <i>Unable to install Windows app package in 30 sec ..</i> <br><br>  In this case, you can artificially increase the launch time.  This is done by creating a <b>.runsettings</b> file.  The minimum content of the file in this case may be as follows: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RunSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Configurations that affect the Test Framework --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RunConfiguration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- [x86] | x64 - You can also change it from menu Test, Test Settings, Default Processor Architecture --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetPlatform</span></span></span><span class="hljs-tag">&gt;</span></span>x64<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetPlatform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RunConfiguration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Adapter Specific sections --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- MSTest adapter --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MSStoreTest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxInstallTimeout</span></span></span><span class="hljs-tag">&gt;</span></span>240000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AppxInstallTimeout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MSStoreTest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RunSettings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Here we select the package for which architecture we will test and set the time limit for installing the application to 240 seconds. <br><br>  The file is usually created in the root directory of the application and is specified in the VSTS build settings: <br><br><img src="https://habrastorage.org/files/4f1/1ac/57f/4f11ac57f9bc4e1a8f51caf4fc33354c.PNG"><br><br>  The result of the successful construction and execution of the test is displayed below: <br><br><img src="https://habrastorage.org/files/6c8/4c4/23c/6c84c423cabb42f996b6e762d9648bed.PNG"><br><br>  Test Details Window: <br><br><img src="https://habrastorage.org/files/47d/c9c/981/47dc9c981d4c4d92a7f23598397e219a.PNG"><br><br>  From this window, you can create a new bug or associate a test with a development task. <br><br>  The price of the question: most of the functions for small development teams are free (and even there is no need to link a credit card to an account).  Unlimited private repositories, creating tasks.  In addition, a private pipeline ( <a href="https://www.visualstudio.com/en-us/docs/build/concepts/licensing/concurrent-pipelines-ts">concurrent pipeline</a> ) is provided, which allows you to run one build and one release at the same time.  You can run several builds at the same time, but they will be executed sequentially one after the other.  In addition, you can use the hosted agent for 240 minutes per month for free (each build or release should not last longer than 30 minutes). <br>  For prices for large development teams, see here: <a href="https://www.visualstudio.com/ru/team-services/pricing/">Prices for using Visual Studio Team Services</a> . <br><br>  Official manual: <a href="https://docs.microsoft.com/ru-ru/windows/uwp/packaging/auto-build-package-uwp-apps">Setting up automatic builds for a UWP application</a> </div><p>Source: <a href="https://habr.com/ru/post/321638/">https://habr.com/ru/post/321638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321628/index.html">Aggressive energy saving when running on Windows on battery</a></li>
<li><a href="../321630/index.html">Another Brainfuck interpreter</a></li>
<li><a href="../321632/index.html">OpenPapyrus: [yet another] ERP-system open source</a></li>
<li><a href="../321634/index.html">PROTEQ - multigigabit exchange protocol for Xilinx FPGA</a></li>
<li><a href="../321636/index.html">Automount afuse</a></li>
<li><a href="../321640/index.html">Facebook Audience Network - a new word in the monetization of sites and applications</a></li>
<li><a href="../321644/index.html">Using expressions to filter data from a database</a></li>
<li><a href="../321646/index.html">Automatic 3CX configuration using the setupconfig.xml answer file</a></li>
<li><a href="../321648/index.html">J-bird</a></li>
<li><a href="../321652/index.html">UNIX-like systems contain a bunch of crutches. The collapse of the "UNIX philosophy"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>