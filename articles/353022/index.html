<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Metalsmith static site generator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every year there is a development of technologies used by front-end developers. And here we are talking not only about specific frameworks and archite...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Metalsmith static site generator</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ra/hu/04/rahu0481nuldvamzdytsr4h7xfo.jpeg"><br><br>  Every year there is a development of technologies used by front-end developers.  And here we are talking not only about specific frameworks and architectural patterns for implementing client logic in browsers, but also about various alternative tools, such as, for example, static site generators.  Their main goal is to simplify the process of creating static sites.  Of course, they are not a universal tool, but in some cases they fit perfectly: <br><br><ul><li>  Web interface prototype </li><li>  A blog with infrequently updated content. </li><li>  Separate static part of another web application </li><li>  Site card or landing-page </li><li>  Online documentation </li></ul><a name="habracut"></a><br>  A more detailed comparative analysis of various generators can be found in <a href="https://habrahabr.ru/company/selectel/blog/236441/">this article</a> , as well as a <a href="https://www.staticgen.com/">rating</a> based on the activity of the relevant projects on github.  We will consider, though not the most popular, but, nevertheless, an elegant and simple representative of this class of tools - <a href="http://www.metalsmith.io/">metalsmith</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Metalsmith </h4><br>  This generator is entirely written in javascript, the source code can be found in the <a href="https://github.com/segmentio/metalsmith">official repository</a> .  The concept of work can be divided into several stages: reading template files from the source folder of the site, sequentially processing them with plugins, and writing the results to the target directory. <br><br><img src="https://habrastorage.org/webt/i4/cv/ma/i4cvmawqd62--vzh887nhtprqg4.png" title="work concept"><br><br>  At the moment <a href="https://www.npmjs.com/search%3Fq%3Dmetalsmith">there are</a> about 670 different plug-ins.  If you still have not found something, writing your own plugin is completely easy thanks to a simple and understandable plugin-API.  For example, a plugin that displays file names at a particular step might look like this: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plugin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files, metalsmith, done</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(files).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name)); done(); }; }</code> </pre> <br>  Although, if you need (for example for debugging), you can use my plug-in - <a href="https://www.npmjs.com/package/metalsmith-inspect-files">metalsmith-inspect-files</a> , which renders the tree of files and directories at the time of its use in the plug-in chain. <br><br><h4>  Make a simple blog </h4><br>  In order to demonstrate the capabilities of the tool, we will create a simple static blog with its help, all the code is available in the <a href="https://github.com/risentveber/metalsmith-simple-blog">repository</a> .  The configuration for the assembly is either in the metalsmith.json file, or directly in the script, and the latter, in my opinion, is most preferable, because it allows you to more flexibly configure the assembly process: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Metalsmith = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> timer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./plugins/timer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jade = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-jade'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> layouts = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-layouts'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> permalinks = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-permalinks'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> collections = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-collections'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> less = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-less'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ignore = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-ignore'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cleanCss = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-clean-css'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> metalsmithInspectFiles = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-inspect-files'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> partial = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'metalsmith-partial'</span></span>); Metalsmith(__dirname) .source(<span class="hljs-string"><span class="hljs-string">'./source'</span></span>) .metadata({ <span class="hljs-comment"><span class="hljs-comment">//       title: 'Example blog', layout: 'index.jade', menuLinks: [ {title:'Home', url: '/'}, {title:'Articles', url: '/articles/'}, {title:'About', url: '/about/'} ] }) .destination('./build') .clean(true) .use(collections({ //     articles: { pattern: [ 'articles/**', '!articles/index.jade' ], sortBy: 'title' }, })) .use(partial({ //      directory: './partials', engine: 'jade' })) .use(jade({ //  useMetadata: true })) .use(permalinks({ //  url /about.html =&gt; /about/index.html relative: false })) .use(layouts({ // -     engine: 'jade', default: 'index.jade', pattern: '**/*.html' })) .use(less()) //  less  css .use(cleanCss()) //  css .use(ignore([ //   '**/*.less' ])) .use(metalsmithInspectFiles()) .build((err, files) =&gt; { if (err) { throw err; } timer('Build time: ')(); });</span></span></code> </pre><br>  Our blog consists of several separate separate pages and one collection of similar pages.  Source directory structure (without external directories layouts and partials): <br><br><pre> <code class="hljs ruby"> <span class="hljs-params"><span class="hljs-params">|-articles |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-one.jade |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-three.jade |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-two.jade |</span></span> -index.jade <span class="hljs-params"><span class="hljs-params">|-assets |</span></span> <span class="hljs-params"><span class="hljs-params">|-images |</span></span> <span class="hljs-params"><span class="hljs-params">| -favicon.png |</span></span> <span class="hljs-params"><span class="hljs-params">|-js |</span></span> <span class="hljs-params"><span class="hljs-params">| -turbolinks.min.js |</span></span> -stylesheets <span class="hljs-params"><span class="hljs-params">| -main.less |</span></span>-about.jade -index.jade</code> </pre><br>  And this is the result of the work (the contents of the build daddy): <br><pre> <code class="hljs ruby"> <span class="hljs-params"><span class="hljs-params">|-about |</span></span> -index.html <span class="hljs-params"><span class="hljs-params">|-articles |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-one |</span></span> <span class="hljs-params"><span class="hljs-params">| -index.html |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-three |</span></span> <span class="hljs-params"><span class="hljs-params">| -index.html |</span></span> <span class="hljs-params"><span class="hljs-params">|-article-two |</span></span> <span class="hljs-params"><span class="hljs-params">| -index.html |</span></span> -index.html <span class="hljs-params"><span class="hljs-params">|-assets |</span></span> <span class="hljs-params"><span class="hljs-params">|-images |</span></span> <span class="hljs-params"><span class="hljs-params">| -favicon.png |</span></span> <span class="hljs-params"><span class="hljs-params">|-js |</span></span> <span class="hljs-params"><span class="hljs-params">| -turbolinks.min.js |</span></span> -stylesheets <span class="hljs-params"><span class="hljs-params">| -main.css -index.html</span></span></code> </pre><br>  Immediately noticeable is the work of the <a href="https://github.com/segmentio/metalsmith-permalinks">metalsmith-permalinks</a> plugin, which converts * .html files, whose name is different from index.html, to the corresponding directories with index.html, so that the url of these pages looks more pleasant.  The main features of any static site generator are templates (layouts and partials), as a means to comply with the DRY principle (Don't repeat yourself).  <a href="http://jade-lang.com/">Jade</a> (or pug), popular among representatives of the javascript community, is used as a template language.  So in our case, the main layout looks like, representing the page frame: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">doctype html html head </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">meta</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">charset=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'utf-8'</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">meta</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'description'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> content=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'Simple metalsmith blog'</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">meta</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'viewport'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> content=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'width=device-width, initial-scale=1.0'</span></span></span></span></span><span class="hljs-function">) title</span></span>=<span class="hljs-function"><span class="hljs-function">title </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">link</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">href=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'/assets/stylesheets/main.css'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, rel=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'stylesheet'</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">link</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rel=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"icon"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> href=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/assets/images/favicon.png"</span></span></span></span></span><span class="hljs-function">) body .container nav!</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">partial</span></span>(<span class="hljs-string"><span class="hljs-string">'menu.jade'</span></span>, {menuLinks, currentPath: path}) section.page-content!=contents footer!=<span class="hljs-keyword"><span class="hljs-keyword">partial</span></span>(<span class="hljs-string"><span class="hljs-string">'footer.jade'</span></span>) script(src=<span class="hljs-string"><span class="hljs-string">'/assets/js/turbolinks.min.js'</span></span>)</code> </pre><br>  He, in turn, uses partials templates, the functionality of which is implemented by the <a href="https://github.com/anatoo/metalsmith-partial">metalsmith-partial</a> plugin (note the explicit transfer of variables for drawing the template).  The included menu template is as follows: <br><br><pre> <code class="hljs cs">ul.menu each page <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> menuLinks - isActive = (<span class="hljs-string"><span class="hljs-string">'/'</span></span>+currentPath+<span class="hljs-string"><span class="hljs-string">'/'</span></span>).startsWith(page.url) &amp;&amp; (page.url != <span class="hljs-string"><span class="hljs-string">'/'</span></span> || page.url === currentPath + <span class="hljs-string"><span class="hljs-string">'/'</span></span>) li(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=(isActive ? <span class="hljs-string"><span class="hljs-string">'active'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>)) a(href=page.url)=page.title</code> </pre><br>  For iteration through the collection pages (articles), the <a href="https://github.com/segmentio/metalsmith-collections">metalsmith-collections</a> plugin is used, the pages themselves for generating the list are available in an array variable with the collection name. <br><br><h4>  Turbolinks </h4><br>  The <a href="https://github.com/turbolinks/turbolinks">turbolinks</a> library allows <a href="https://github.com/turbolinks/turbolinks">you</a> to 'animate' the content sent by the server with statics by adding the SPA behavior when clicking on links inside our website, loading the contents of each new page with AJAX and replacing the current one with it.  In case if for some reason the request was long (more than 500 ms), a progress bar will be shown, which will inform the user that switching to another page is taking place (standard means by which the browser shows this when you simply click on the link will not be used due to the absence of a page reload), albeit slowly.  Turbolinks in this example is connected in the form of a miniified distribution file, so to say ‚Äúfor the sake of simplicity‚Äù.  If the javascript part of the site is not so simple, you should use something <a href="https://github.com/leviwheatcroft/metalsmith-webpack-2">like metalsmith-webpack-2</a> or <a href="https://github.com/jelz/gulp-metalsmith">gulp-metalsmith</a> . <br><br><h4>  Useful links and conclusions </h4><br>  Despite the fact that metalsmith is not the most popular of the generators, in my opinion, it deserves attention, because it is simple and flexible (almost any third-party tool can be embedded in the plugin-pipeline with a few lines of code), which means it can be used to create different sites, although, of course, it is not a 'silver bullet' and has its drawbacks.  For example, most plug-ins do not have detailed documentation, so in order to understand the details of their work, you often need to study the source code, since they are almost always a simple facade, designed to adapt other popular tools with good documentation under metalsmith plugin-API. <br><br><ul><li>  <a href="http://www.metalsmith.io/">Official metalsmith documentation</a> </li><li>  <a href="http://prgssr.ru/development/pochemu-generatory-staticheskih-sajtov-budut-populyarny.html">Why static site generators will be popular</a> </li><li>  <a href="https://www.evocode.com/blog/mastering-metalsmith-best-practices-for-static-sites/">Mastering metalsmith: best practices for static sites</a> </li><li>  <a href="https://github.com/risentveber/wise">Sources of a real site made with its help</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/353022/">https://habr.com/ru/post/353022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353012/index.html">Do I need to collect NAS?</a></li>
<li><a href="../353014/index.html">Introducing the new dialog item</a></li>
<li><a href="../353016/index.html">More than a state: British East India Trading Company</a></li>
<li><a href="../353018/index.html">Unit testing interfaces in Headless Chrome. Yandex lecture</a></li>
<li><a href="../353020/index.html">Check incoming data. The root cause of the vulnerability and attacks on Cisco IOS</a></li>
<li><a href="../353024/index.html">Operating systems from scratch; level 2 (upper half)</a></li>
<li><a href="../353026/index.html">"Japan - Guam - Australia": Google is laying a new submarine cable</a></li>
<li><a href="../353028/index.html">Another example of automation or PowerShell + Google Apps Script</a></li>
<li><a href="../353030/index.html">Using rrd4j for OpenHab2 persistence</a></li>
<li><a href="../353034/index.html">An alternative look at the problem from Odnoklassniki with JPoint 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>