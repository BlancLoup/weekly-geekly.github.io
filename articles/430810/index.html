<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Load testing with locust. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For those who liked my previous article , I continue to share my impressions of the tool for load testing Locust. 

 I will try to visually show the b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Load testing with locust. Part 2</h1><div class="post__text post__text-html js-mediator-article">  For those who liked my <a href="https://habr.com/company/infopulse/blog/430502/">previous article</a> , I continue to share my impressions of the tool for load testing Locust. <br><br>  I will try to visually show the benefits of writing a python load test code in which you can conveniently prepare any data for the test and process the results. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/decfhwQPd9E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h2>  Processing server responses </h2><br>  Sometimes in load testing it is not enough just to get an HTTP 200 OK from the server.  It happens, you still have to check the contents of the response to make sure that under load the server provides the correct data or performs accurate calculations.  Just for such cases, Locust added the ability to override the server response success parameters.  Consider the following example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rnd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_albums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> photo_id = rnd.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">f'/photos/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{photo_id}</span></span></span><span class="hljs-string">'</span></span>, catch_response=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, name=<span class="hljs-string"><span class="hljs-string">'/photos/[id]'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> response: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: album_id = response.json().get(<span class="hljs-string"><span class="hljs-string">'albumId'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> album_id % <span class="hljs-number"><span class="hljs-number">10</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>: response.success() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'album id cannot be </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{album_id}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'status code is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{response.status_code}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  It has only one request, which will create a load in the following scenario: <br><blockquote>  From the server, we request photos with random id in the range from 1 to 5000 and check the album id in this object, assuming that it cannot be a multiple of 10 <br></blockquote>  Here you can immediately give a few explanations: <br><br><ul><li>  the awesome <i>with request ()</i> construction <i>as response:</i> you can successfully replace with <i>response = request ()</i> and work quietly with the response object </li><li>  The URL is formed using the string format syntax added in python 3.6, if I'm not mistaken, <i>f '/ photos / {photo_id}'</i> .  In previous versions, this design will not work! </li><li>  The new argument, which we have not used before, <i>catch_response = True</i> , indicates to Locust that we ourselves will determine the success of the server response.  If you do not specify it, we will receive the response object in the same way and will be able to process its data, but not override the result.  Below is a detailed example. </li><li>  Another argument <i>name = '/ photos / [id]'</i> .  It is needed for grouping rekvestov in statistics.  The name can be any text, it is not necessary to repeat the url.  Without it, each request with a unique address or parameters will be recorded separately.  Here's how it works: <br></li></ul><br><img src="https://habrastorage.org/webt/ai/fm/ca/aifmcaycbzv9khpohj5sxjcohgo.png"><br>  Using the same argument, you can perform another trick - sometimes it happens that one service with different parameters (for example, different contents of POST requests) performs different logic.  So that the test results are not mixed up, you can write several separate tasks, specifying your own <i>name</i> argument for each. <br><br>  Next we do the checks.  I have two of them. First we check that the server returned the answer to us if <i>response.status_code == 200</i> : <br><br>  If yes, then check if the album id is a multiple of 10. If not multiple, then mark this answer as successful <i>response.success ()</i> <br><br>  In other cases, we indicate why the response failed <i>response.failure ('error text')</i> .  This text will be displayed on the Failures page during the test run. <br><br><img src="https://habrastorage.org/webt/52/se/dt/52sedt-fqe0jhasmdnq3k94ia7m.png"><br><br>  Also attentive readers could notice the absence of exception handlers (Exceptions), characteristic of the code that works with network interfaces.  Indeed, in the case of timeout, connection error and other unforeseen incidents, Locust itself will handle the errors and still return the answer, indicating, however, the status of the response code is 0. <br><br>  If the code still generates an Exception, it will be written on the Exceptions tab at runtime so that we can process it.  The most typical situation is that in json'e the answer did not return the value we were looking for, but we are already doing the following operations on it. <br><br>  Before, close the topic - in the example I use the json server for clarity, as it is easier to handle the answers.  But you can work with the same success with HTML, XML, FormData, file attachments, and other data used by HTTP-based protocols. <br><br><h2>  Work with complex scenarios </h2><br>  Almost every time the task is set to conduct load testing of a web application, it quickly becomes clear that it is impossible to provide adequate coverage with GET services alone - which simply return data. <br><br>  A classic example: to test an online store, it is desirable that the user <br><br><ol><li>  Opened the main store </li><li>  I was looking for goods </li><li>  Opened the details of the goods </li><li>  Add item to cart </li><li>  Paid </li></ol><br>  From the example, we can assume that it‚Äôs impossible to call services in a random order, only sequentially.  Moreover, the goods, baskets and forms of payment can have unique identifiers for each user. <br><br>  Using the previous example, with minor modifications, you can easily implement testing of such a scenario.  Adapt the example to our test server: <br><br><ol><li>  User writes a new post </li><li>  The user writes a comment to the new post. </li><li>  User reads comment </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlowException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># step 1 new_post = {'userId': 1, 'title': 'my shiny new post', 'body': 'hello everybody'} post_response = self.client.post('/posts', json=new_post) if post_response.status_code != 201: raise FlowException('post not created') post_id = post_response.json().get('id') # step 2 new_comment = { "postId": post_id, "name": "my comment", "email": "test@user.habr", "body": "Author is cool. Some text. Hello world!" } comment_response = self.client.post('/comments', json=new_comment) if comment_response.status_code != 201: raise FlowException('comment not created') comment_id = comment_response.json().get('id') # step 3 self.client.get(f'/comments/{comment_id}', name='/comments/[id]') if comment_response.status_code != 200: raise FlowException('comment not read') class WebsiteUser(HttpLocust): task_set = UserBehavior min_wait = 1000 max_wait = 2000</span></span></code> </pre> <br>  In this example, I added a new class <b>FlowException</b> .  After each step, if it didn‚Äôt go as expected, I‚Äôll throw this exception class in order to interrupt the script ‚Äî if the post failed to create, then there‚Äôs nothing to comment, etc.  If desired, the construction can be replaced with a normal <b>return</b> , but in this case, during execution and when analyzing the results, it will not be so clearly seen at which step the execution script falls on the Exceptions tab.  For the same reason, I do not use the <b>try ... except</b> construction. <br><br><h2>  Making the load realistic </h2><br>  Now I can be reproached - in the case of the store, everything is really linear, but the example of posts and comments is too far-fetched - they read posts 10 times more often than they create.  Reasonably, let's make the example more vital.  And there are at least 2 approaches: <br><br><ol><li>  You can ‚Äúhardcore‚Äù the list of posts that users read, and simplify the test code, if there is such a possibility and the backend functionality does not depend on specific posts </li><li>  Save created posts and read them if it is not possible to preset a list of posts or the realistic load depends strongly on what posts are read (I removed the creation of comments from the example to make its code smaller and clearer) </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> created_posts = [] @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> new_post = {<span class="hljs-string"><span class="hljs-string">'userId'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-string"><span class="hljs-string">'my shiny new post'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello everybody'</span></span>} post_response = self.client.post(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, json=new_post) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post_response.status_code != <span class="hljs-number"><span class="hljs-number">201</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = post_response.json().get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.created_posts.append(post_id) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.created_posts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = r.choice(self.created_posts) self.client.get(<span class="hljs-string"><span class="hljs-string">f'/posts/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{post_id}</span></span></span><span class="hljs-string">'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'read post'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  In the <b>UserBehavior</b> class <b>,</b> I created a <b>created_posts</b> list.  Pay special attention - this is an object and it was not created in the class constructor <b>__init __ (),</b> therefore, unlike the client session, this list is common for all users.  The first task creates a post and writes its id to the list.  The second - 10 times more often, reads one, randomly selected post from the list.  An additional condition of the second task is to check whether there are any posts created. <br><br>  If we need each user to operate only with his own data, we can declare it in the constructor as follows: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent)</span></span></span><span class="hljs-function">:</span></span> super(UserBehavior, self).__init__(parent) self.created_posts = list()</code> </pre> <br><h2>  Some more features </h2><br>  For the sequential launch of tasks, the official documentation suggests that we also use the task annotation @seq_task (1), indicating the sequence number of the task in the argument <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTaskSequence</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSequence)</span></span></span><span class="hljs-class">:</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">3</span></span>) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  In this example, each user will first execute <b>first_task</b> , then <b>second_task</b> , then 10 times <b>third_task</b> . <br><br>  Frankly speaking, the presence of such an opportunity pleases, but, unlike the previous examples, it is not clear how to transfer the results of the first task to the second if necessary. <br><br>  Also, for particularly complex scenarios, it is possible to create nested sets of tasks, in essence, creating several TaskSet classes and connecting with each other. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Todo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/todos"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.interrupt() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {Todo: <span class="hljs-number"><span class="hljs-number">1</span></span>} @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  In the example above, with a probability of 1 to 6, the <b>Todo</b> script will be run, and it will be executed until, with a probability of 1 to 4, it returns to the <b>UserBehavior</b> script.  The presence of the <b>self.interrupt ()</b> call is very important <b>here</b> - without it, testing will loop on the subtask. <br><br>  Thank you for reading.  In the final article I will write about distributed testing and testing without UI, as well as the difficulties encountered in the testing process using Locust and how to get around them. </div><p>Source: <a href="https://habr.com/ru/post/430810/">https://habr.com/ru/post/430810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430800/index.html">Creating a game "Like Coins" on Godot Engine. Part 2</a></li>
<li><a href="../430802/index.html">PMI RU: Study on the salaries of project managers in Russia for 2017</a></li>
<li><a href="../430804/index.html">Tesla / Panasonic batteries are the most affordable batteries for electric vehicles on the market.</a></li>
<li><a href="../430806/index.html">We started to learn English - we wrote the application: EWM - the experience of creating a learning project</a></li>
<li><a href="../430808/index.html">Theory of acoustic systems: 16 materials about how the speakers and speakers are arranged</a></li>
<li><a href="../430812/index.html">What does developer.android.com say about RecyclerView</a></li>
<li><a href="../430818/index.html">Accelerate SQLAlchemy for architectural astronauts</a></li>
<li><a href="../430820/index.html">Black Friday 2018 - VDS in Moscow and Amsterdam</a></li>
<li><a href="../430822/index.html">Information security of the Internet of things: who is the thing and who is the owner?</a></li>
<li><a href="../430824/index.html">Search for a damaged object by the number of the damaged page in MS SQL Server 2005</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>