<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MSLibrary. JUST: declare global variables using the singleton class, for iOS and not only ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The developers of the MSLibrary for iOS library continue a series of very compact articles on how to just implement a particular function. No theory, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MSLibrary. JUST: declare global variables using the singleton class, for iOS and not only ...</h1><div class="post__text post__text-html js-mediator-article">  The developers of the <a href="https://habrahabr.ru/users/mslibrary/" class="user_link">MSLibrary</a> for iOS library continue a series of very compact articles on how to just implement a particular function.  No theory, just practice ... <br><br>  So, how to correctly declare global variables?  By global, we mean variables that are declared externally (non-static) and have a global lifetime. <br><br>  If we declare a variable in one of the header files, for example, in the file MyClass.h, in such a seemingly logical way: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *myGlobalVariable;</code> </pre> <br>  and then import the MyClass.h file with the help of the #import directive into several files, for example, MyClass1.h, MyClass2.h, MyClass3.h and MyClass4.h, then as a result we are likely to get something like this error message: <br><br><pre> <code class="xml hljs">duplicate symbol _myGlobalVariable in: /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass.o /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass1.o duplicate symbol _myGlobalVariable in: /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass.o /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass2.o duplicate symbol _myGlobalVariable in: /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass.o /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass3.o duplicate symbol _myGlobalVariable in: /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass.o /Users/L/Library/Developer/Xcode/DerivedData/‚Ä¶/MyClass4.o ld: 4 duplicate symbols for architecture x86_64 clang: error: linker command failed with exit code 1 (use -v to see invocation)</code> </pre><br>  This will happen due to the fact that as a result of the import, the variable myGlobalVariable will be declared in each of the connected files. <a name="habracut"></a><br><br>  You can declare a global variable using the ‚Äúmagic‚Äù word extern.  In this case, we will most likely avoid error messages, but for variables with global lifetime and scope, the entire application space, there is a danger of trying to simultaneously change its value from different streams, from which the extern cannot provide guaranteed protection.  Unfortunately, inexperienced programmers do not take into account this important fact.  Extern can be safely used when declaring global constants, in this case there are no problems. <br><br>  We need to declare a global variable so that it is not duplicated under any circumstances.  To solve this simple task, it suffices to recall what can exist in the program only in a single copy?  That's right, this is singleton.  A global variable can be set using the singleton class (singleton), or rather, as its property.  A lot of literature has been written about the merits of this approach, and all those who are interested can read about it, and also about when such merits are fully manifested.  Our task is to show how this is done. <br><br><blockquote>  Pattern Singleton: Verifies that there is only one instance of the class and provides a single point of access to it.  <i>(GoF Design Patterns (Addison-Wesley, 1994)).</i> <br></blockquote><br>  Below is an example of code - we create a class sington, for example, GlobalVariable and add the property myGlobalVariable to it, which will be our global variable: <br><br>  Header file, GlobalVariable.h <br><br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> &lt;Foundation/Foundation.h&gt;; <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> GlobalVariable : NSObject <span class="hljs-meta"><span class="hljs-meta">@property(nonatomic, strong)</span></span> NSString *myGlobalVariable; +(instancetype)sharedGlobalVariable; <span class="hljs-meta"><span class="hljs-meta">@end</span></span></code> </pre><br>  GlobalVariable.m file <br><br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"GlobalVariable.h"</span></span> <span class="hljs-meta"><span class="hljs-meta">@implementation</span></span> GlobalVariable <span class="hljs-meta"><span class="hljs-meta">@synthesize</span></span> myGlobalVariable; +(instancetype)sharedGlobalVariable { static id _singletonInstance = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ _singletonInstance = [[<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> allocWithZone:NULL] <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>]; }); return_singletonInstance; } +(id) allocWithZone:(NSZone*)zone { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [self sharedGlobalVariable]; } -(id) copyWithZone:(NSZone*)zone { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self; }</code> </pre><br>  The reference to the variable is as follows: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[GlobalVariable sharedGlobalVariable]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.myGlobalVariable</span></span>;</code> </pre><br>  For convenience, you can use the macro: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#define</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MY_GLOBAL_VARIABLE</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[GlobalVariable sharedGlobalVariable]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.myGlobalVariable</span></span>;</code> </pre><br>  The dispatch_once_t function is responsible for the thread safety of this code implementation. <br>  As you can see, the issue is solved in just a few simple lines, and when using the <a href="https://habrahabr.ru/users/mslibrary/" class="user_link">MSLibrary</a> for iOS library, the amount of code will decrease several times. <br><br><hr><br>  We hope that the material was useful to you, the <a href="https://habrahabr.ru/users/mslibrary/" class="user_link">MSLibrary</a> for iOS team <br><br>  Other articles: <br>  <a href="https://habrahabr.ru/post/278345/"><b>Capture and verify phone numbers using regular expressions, for iOS and not only ... Part 1</b></a> <br>  <a href="https://habrahabr.ru/post/278359/"><b>Capture and verify phone numbers using regular expressions, for iOS and not only ... Part 2</b></a> <br>  <a href="https://habrahabr.ru/post/279441/"><b>Implementing multiple selection of conditions using bitmasks, for iOS and not only ...</b></a> <br>  <a href="https://habrahabr.ru/post/279563/"><b>SIMPLE: remove unnecessary characters from strings using regular expressions for iOS and not only ...</b></a> <br>  <a href="https://habrahabr.ru/post/280286/"><b>Creating and compiling cross-platform (universal) libraries in Xcode</b></a> </div><p>Source: <a href="https://habr.com/ru/post/282169/">https://habr.com/ru/post/282169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282159/index.html">Profiling JS code from functions. Yandex experience</a></li>
<li><a href="../282161/index.html">GTD: write a thesis and stay alive</a></li>
<li><a href="../282163/index.html">Using arduino to automate device testing</a></li>
<li><a href="../282165/index.html">The results of the selection for the section Young School</a></li>
<li><a href="../282167/index.html">As I wrote the book 'Python Machine Learning'</a></li>
<li><a href="../282173/index.html">You Telegramma: SPARQL-injections and CSRF via Telegram-messages in the NeoQUEST-2016 task</a></li>
<li><a href="../282175/index.html">ITMO University Digest: # 1 Education and Science</a></li>
<li><a href="../282179/index.html">How I hacked Facebook and found someone else's backdoor</a></li>
<li><a href="../282181/index.html">Features of national management</a></li>
<li><a href="../282183/index.html">3D printer calibration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>