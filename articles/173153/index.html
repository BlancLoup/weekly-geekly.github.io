<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple configuration file editor for Yii</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening, Habrahabr. 

 Today I will talk about a small form component that I have written for the wonderful PHP framework Yii. This component (or...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple configuration file editor for Yii</h1><div class="post__text post__text-html js-mediator-article">  Good evening, Habrahabr. <br><br>  Today I will talk about a small form component that I have written for the wonderful PHP framework Yii.  This component (or rather, the form model) allows you to edit config files directly from the web.  The article is inspired by a recent <a href="http://habrahabr.ru/post/172737">post</a> about similar functionality, but that implementation is based on a DB.  This is not entirely valid for the Yii configuration files.  In addition, for such a decision you will have to pay extra requests to the database / cache, and you need to save them in projects with high attendance. <br><br>  The article will have a lot of code, but I will try to divide it into logical pieces. <br><a name="habracut"></a><br><h4>  Idea </h4><br>  The configuration file in Yii is a regular php script that returns an array. <br>  For example: <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My Awesome Web Site'</span></span>, <span class="hljs-string"><span class="hljs-string">'lang'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'sourceLang'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'en'</span></span>, );</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The configuration sometimes indicates some static parameters of the site, which change once a year or do not change at all.  For example, take the administrator's E-mail or phone number that appears next to the logo.  These parameters definitely need to be allowed to edit the site administrator, but do not let him climb into the code, right?  (: <br><br><h4>  Implementation </h4><br>  The implementation itself is fairly simple, but at the same time confusing.  I will try to sort everything out. <br><br><h5>  Model </h5><br>  A model is data.  And what data have config files?  Correct, array configuration.  Here for him we need to create a model. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConfigForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CFormModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array ,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_config = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $config    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $scenario   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $scenario = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($scenario); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setConfig($config); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config = $config; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config; } }</code> </pre><br>  While everything is simple, is not it? <br>  <i>In fact, there is no need for privacy of the $ _config variable, but this will not be superfluous if you suddenly want to change the rules of the game.</i> <br><br>  Next, we need to establish the rules by which attribute names will be formed.  You do not want to add a new field to the model each time (although, nevertheless, you will have to add something, but more on that later).  So, let's say we have this configuration array: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'My Awesome Site'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   ,    -   'params' =&gt; array( 'adminEmail' =&gt; 'admin@example.com', 'phoneNumber' =&gt; '555-555-555', 'motto' =&gt; 'the best of the most awesome', ), );</span></span></code> </pre><br><br>  The following attributes should be obtained from this array: <b>name</b> , <b>params [adminEmail]</b> , <b>params [phoneNumber]</b> , <b>params [motto]</b> .  Accordingly, this should be done recursively, and here is my solution: <br><br><div class="spoiler">  <b class="spoiler_title">My decision</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAttributes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config, $output); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output; } <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributeNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config, $output); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_keys($output); } <span class="hljs-comment"><span class="hljs-comment">/** *      * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $config * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $output * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributesRecursive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config, &amp;$output = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($config <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $attribute) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($name == <span class="hljs-string"><span class="hljs-string">''</span></span>) $paramName = $key; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $paramName = $name . <span class="hljs-string"><span class="hljs-string">"[{$key}]"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($attribute)) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive($attribute, $output, $paramName); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $output[$paramName] = $attribute; } }</code> </pre><br></div></div><br>  At the output we get the required array, to which it would be nice to create validation rules: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $rules = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $attributes = array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config); $rules[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $attributes), <span class="hljs-string"><span class="hljs-string">'safe'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $rules; }</code> </pre><br>  It's simple.  In order for <b>params [motto]</b> type attributes to be considered safe, it suffices to make only the parent attribute safe. <br>  <i>It should be understood that in fact you can write anything into the params array, but adding an additional root attribute to the config will not work.</i>  <i>I can try to explain this point in the comments if any questions arise.</i> <br><br>  To have direct access to these attributes through the expression <b>$ model -&gt; $ attribute,</b> we extend the __set () and __get () methods: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      -  .   -      if (isset($this-&gt;_config[$name])) return $this-&gt;_config[$name]; else return parent::__get($name); } public function __set($name, $value) { //      -    if (isset($this-&gt;_config[$name])) $this-&gt;_config[$name] = $value; else parent::__set($name, $value); }</span></span></code> </pre><br>  What could be easier? <br><br>  So, the frame model is ready.  Now she is able to say what attributes she has and eat attributes from the form.  To test this model, you can write a simple action to handle the POST request and build the form: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $path = YiiBase::getPathOfAlias(<span class="hljs-string"><span class="hljs-string">'application.config'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/params.php'</span></span>; $model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigForm(<span class="hljs-keyword"><span class="hljs-keyword">require</span></span>($path)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'ConfigForm'</span></span>])) { $model-&gt;setAttributes($_POST[<span class="hljs-string"><span class="hljs-string">'ConfigForm'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($model-&gt;save($path)) { Yii::app()-&gt;user-&gt;setFlash(<span class="hljs-string"><span class="hljs-string">'success config'</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;controller-&gt;refresh(); } } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;controller-&gt;render(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, compact(<span class="hljs-string"><span class="hljs-string">'model'</span></span>)); }</code> </pre><br>  <i>This action is given for example, you should not copy it completely, just enough to grasp the essence</i> <br><br>  Something?  Does the save () method have a CFormModel?  True, but we will write it here to save the result to a file.  As in the construction of attributes here, we will need recursion: <br><br><div class="spoiler">  <b class="spoiler_title">Save to file</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($path)</span></span></span><span class="hljs-function"> </span></span>{ $config = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateConfigFile(); <span class="hljs-comment"><span class="hljs-comment">//    ,       if(!is_writable($path)) throw new CException("Cannot write to config file!"); file_put_contents($path, $config, FILE_TEXT); return true; } public function generateConfigFile() { $this-&gt;generateConfigFileRecursive($this-&gt;_config, $output); $output = preg_replace('#,$\n#s', '', $output); //    return "</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment">\nreturn " . $output . ";\n"; } public function generateConfigFileRecursive($attributes, &amp;$output = "", $depth = 1) { $output .= "array(\n"; foreach ($attributes as $attribute =&gt; $value) { if (!is_array($value)) $output .= str_repeat("\t", $depth) . "'" . $this-&gt;escape($attribute) . "' =&gt; '" . $this-&gt;escape($value) . "',\n"; else { $output .= str_repeat("\t", $depth) . "'" . $this-&gt;escape($attribute) . "' =&gt; "; $this-&gt;generateConfigFileRecursive($value, $output, $depth + 1); } } $output .= str_repeat("\t", $depth - 1) . "),\n"; //  ,     } private function escape($value) { /** *   ,       (php-injection). *  ,   php  -  , *   ,       */ return str_replace("'", "\'", $value); }</span></span></code> </pre><br></div></div><br>  <i>Kind <a href="http://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> suggested in the comments that you can use the php function <a href="http://php.net/manual/ru/function.var-export.php">var_export ()</a> to generate, which I did not know about before writing this bike <s>generator</s></i> <br><br>  We also need a View file, in which the form itself is generated by the existing attributes. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $form = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;beginWidget(<span class="hljs-string"><span class="hljs-string">'CActiveForm'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'config-form'</span></span>, <span class="hljs-string"><span class="hljs-string">'enableAjaxValidation'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Ajax-  Client-    , ..     'enableClientValidation' =&gt; false, )); foreach ($model-&gt;attributeNames() as $attribute) { echo CHtml::openTag('div', array('class' =&gt; 'row')); { echo $form-&gt;labelEx($model, $attribute); echo $form-&gt;textField($model, $attribute); } echo CHtml::closeTag('div'); } echo CHtml::submitButton(''); $this-&gt;endWidget();</span></span></code> </pre><br>  In order for us to have beautiful signatures of the attributes, we will have to strictly define them in the model. <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributeLabels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[adminEmail]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Email '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[phoneNumber]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[motto]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, ); }</code> </pre><br>  This is ugly and rude, however, I have not found another normal way to do this.  You can put them into an additional file, but this will not change the essence - anyway, to add an option, you will have to edit 2 files. <br><br>  That's basically it.  I give the full model code without detailed comments: <br><br><div class="spoiler">  <b class="spoiler_title">Full model code</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConfigForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CFormModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_config = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** *   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $config    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $scenario   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $scenario = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($scenario); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setConfig($config); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config = $config; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config[$name])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config[$name]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__get($name); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config[$name])) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config[$name] = $value; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__set($name, $value); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($path)</span></span></span><span class="hljs-function"> </span></span>{ $config = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateConfigFile(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_writable($path)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CException(<span class="hljs-string"><span class="hljs-string">"Cannot write to config file!"</span></span>); file_put_contents($path, $config, FILE_TEXT); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateConfigFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateConfigFileRecursive(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config, $output); $output = preg_replace(<span class="hljs-string"><span class="hljs-string">'#,$\n#s'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $output); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;?php\nreturn "</span></span> . $output . <span class="hljs-string"><span class="hljs-string">";\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateConfigFileRecursive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attributes, &amp;$output = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $depth = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $output .= <span class="hljs-string"><span class="hljs-string">"array(\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($attributes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $attribute =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_array($value)) $output .= str_repeat(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>, $depth) . <span class="hljs-string"><span class="hljs-string">"'"</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape($attribute) . <span class="hljs-string"><span class="hljs-string">"' =&gt; '"</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape($value) . <span class="hljs-string"><span class="hljs-string">"',\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $output .= str_repeat(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>, $depth) . <span class="hljs-string"><span class="hljs-string">"'"</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape($attribute) . <span class="hljs-string"><span class="hljs-string">"' =&gt; "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateConfigFileRecursive($value, $output, $depth + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } $output .= str_repeat(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>, $depth - <span class="hljs-number"><span class="hljs-number">1</span></span>) . <span class="hljs-string"><span class="hljs-string">"),\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">escape</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str_replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">"\'"</span></span>, $value); } <span class="hljs-comment"><span class="hljs-comment">/** *       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAttributes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config, $output); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $output; } <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributeNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config, $output); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_keys($output); } <span class="hljs-comment"><span class="hljs-comment">/** *      * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $config * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $output * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributesRecursive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($config, &amp;$output = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($config <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $attribute) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($name == <span class="hljs-string"><span class="hljs-string">''</span></span>) $paramName = $key; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $paramName = $name . <span class="hljs-string"><span class="hljs-string">"[{$key}]"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($attribute)) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;attributesRecursive($attribute, $output, $paramName); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $output[$paramName] = $attribute; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attributeLabels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[adminEmail]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Email '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[phoneNumber]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'params[motto]'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, ); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $rules = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $attributes = array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_config); $rules[] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $attributes), <span class="hljs-string"><span class="hljs-string">'safe'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $rules; } }</code> </pre><br></div></div><br>  Errors and typographical errors, please report through private messages.  I apologize for typos in advance - for a long time I didn‚Äôt write anything except code in such volumes </div><p>Source: <a href="https://habr.com/ru/post/173153/">https://habr.com/ru/post/173153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173141/index.html">WebKit for developers</a></li>
<li><a href="../173143/index.html">.SITE i.ONLINE - Cyrillic domains for all</a></li>
<li><a href="../173147/index.html">MapReduce for processing semistructured data in HDInsight</a></li>
<li><a href="../173149/index.html">IRIScan Mouse - mouse and scanner in one bottle</a></li>
<li><a href="../173151/index.html">Blocked by devblog.blackberry.com</a></li>
<li><a href="../173157/index.html">Programming Arduino from the console, gentoo-way, nothing more</a></li>
<li><a href="../173159/index.html">Network Virtualization in Hyper-V. Concept</a></li>
<li><a href="../173161/index.html">Launcher 8 - WP8 Desktop on Android</a></li>
<li><a href="../173163/index.html">How I used Google Glass: the future, but with monthly updates (part 2)</a></li>
<li><a href="../173165/index.html">Spring replenishment of the Xperia line: Xperia SP and Xperia L smartphones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>