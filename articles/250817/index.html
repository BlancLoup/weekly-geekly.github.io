<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The mathematical problem of 100 boxes and the rescue of prisoners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I offer the readers of Habrahabr a translation of the publication ‚Äú100 Prisoners Escape Puzzle‚Äù , which I found on the website of the DataGenetics com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The mathematical problem of 100 boxes and the rescue of prisoners</h1><div class="post__text post__text-html js-mediator-article">  <i>I offer the readers of Habrahabr a translation of the publication <a href="http://datagenetics.com/blog/december42014/index.html">‚Äú100 Prisoners Escape Puzzle‚Äù</a> , which I found on the website of the DataGenetics company.</i>  <i>All errors on this article, please send in private messages.</i> <br><br>  According to the condition of the task, there are 100 prisoners in the prison, each of whom has a personal number from 1 to 100. The jailer decides to give the prisoners a chance for release and offers to pass the test invented by them.  If all the prisoners manage, they are free, if at least one fails, everyone will die. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/765/1d9/e3a/7651d9e3a92a8dc3685caa10558a36a8.png"><br><a name="habracut"></a><br><h4>  Task </h4><br>  The jailer goes to the secret room and prepares 100 boxes with lids.  On each box he puts the numbers numbered from 1 to 100. Then he brings 100 paper plates, according to the number of prisoners, and numbers these plates from 1 to 100. After that, he shuffles 100 plates and places one box on each box, closing the lid .  Prisoners do not see the jailer perform all these actions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/3df/131/598/3df131598b558e7ca3a5aef72c254ec2.png"><br><br>  The competition begins, the jailer takes each prisoner one by one to the room with the boxes and tells the prisoner that they must find the box in which there will be a sign with the prisoner's number.  Prisoners try to find a sign with their number by opening the boxes.  Everyone is allowed to open up to 50 boxes;  if each of the prisoners finds their number, then the prisoners will be released, if at least one of them does not find his number in 50 attempts, then all the prisoners will die. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae9/69b/727/ae969b727a15ef1baa29272144f67ddf.png"><br><br>  In order for prisoners to be released, ALL prisoners must pass the test successfully. <br><br>  <strong>So what is the chance that prisoners have mercy?</strong> <br><br><ul><li>  After the prisoner opens the box and checks the plate with it, it is placed back in the box and the lid is closed again; </li><li>  Places can not be changed; </li><li>  Prisoners cannot leave tips to each other or somehow interact with each other after starting the test; </li><li>  Prisoners are allowed to discuss the strategy before the test. </li></ul><br><br>  <strong>What is the optimal strategy for prisoners?</strong> <br><br><blockquote><h6>  Additional question: </h6>  If a fellow prisoner (not a trial participant) will have the opportunity to enter the secret room before the test begins, examine all the plates in all the boxes and (optionally, but not necessarily) swap two plates from the two boxes (while the comrade will not have the opportunity to inform prisoners about the result of his actions, then what strategy should he take to increase the prisoners' chances of salvation? </blockquote><br><br><h4>  Solution unlikely? </h4><br>  At first glance, this task seems almost hopeless.  It seems that the chance for each prisoner to find his own plate is microscopically small.  In addition, prisoners cannot exchange information with each other during the trial. <br><br>  The odds of one prisoner are 50:50.  Only 100 boxes and he can open up to 50 boxes in search of his nameplate.  If he opens the boxes at random and opens half of all the boxes, he will find his plate in the open half of the boxes, or his plate will remain in the closed 50 boxes.  His chances of success are ¬Ω. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a6a/ffd/474/a6affd4741ee9473bc38a9d19f321183.png"><br><br>  Take two prisoners.  If both choose boxes at random, for each of them the odds are ¬Ω, and for two ¬Ωx¬Ω = ¬º. <br>  (for two prisoners, the success will be in one case out of four). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/250/d83/419/250d8341954f845c9353cc296b83ef2e.png"><br><br>  For three prisoners, the odds are ¬Ω √ó ¬Ω √ó ¬Ω = ‚Öõ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/679/cda/6fe/679cda6fe6c1f2570b153451b22b9887.png"><br><br>  For 100 prisoners, the odds are as follows: ¬Ω √ó ¬Ω √ó‚Ä¶ ¬Ω √ó ¬Ω (multiplication 100 times). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d5/098/17d/6d509817d374c0799464b14a481b1893.png"><br><br>  It equals <br><h6>  Pr ‚âà 0.00000000000000000000000000008 </h6><br><br>  That is a very small chance.  In this scenario, most likely, all prisoners will be dead. <br><br>  <em>It is recommended to ponder before reading the decision further.</em> <br><br><h4>  Incredible answer </h4><br>  If every prisoner opens the boxes at random, they are unlikely to pass the test.  There is a strategy in which prisoners can count on success in more than 30% of cases.  This is a stunningly incredible result (if you haven't heard about this math problem before). <br><br>  More than 30% for all 100 prisoners!  Yes, it is even more than the chances for two prisoners, provided that they open the boxes at random.  But how is this possible? <br><br>  It is clear that one in each prisoner the chances cannot be higher than 50% (there is no way for communication between prisoners).  But do not forget that the information is stored in the location of the plates inside the boxes.  No one mixes signs between individual prisoners' visits to the room, so we can use this information. <br><br><h4>  Decision </h4><br>  To begin with, I will tell the solution, then I will explain why it works. <br><br>  The strategy is extremely easy.  The first prisoner opens the box with the number that is written on his clothes.  For example, the prisoner number 78 opens the box with number 78. If he finds his number on the plate inside the box, then that's great!  If not, he looks at the number on the plate in ‚Äúhis‚Äù box and then opens the next box with that number.  Opening the second box, he looks at the number plate inside this box and opens the third box with this number.  Then simply transfer this strategy to the remaining boxes.  For clarity, look at the picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1c/66c/2d4/e1c66c2d4b578aa6e2708eaafd0c2b33.png"><br><br>  In the end, the prisoner will either find his number, or reach a limit of 50 boxes.  At first glance, this seems pointless compared to a simple box selection at random (and this is the case for one individual prisoner), but since all 100 prisoners will use the same set of boxes, this makes sense. <br><br><h6>  The beauty of this mathematical task is not only to know the result, but also to understand <u>why</u> this strategy works. </h6><br><br><h4>  So why does the strategy work? </h4><br>  There is one plate in each box - and this plate is unique.  This means that the tablet is in the box with the same number, or it points to another box.  Since all the plates are unique, then for each box there is only one tablet pointing to it (and just one way to get to this box). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd3/c0f/14b/fd3c0f14bd1d36fd0ef9e7cf2e6cfd9d.png"><br><br>  If you think about it, the boxes form a closed circular chain.  One box can be part of only one chain, since inside the box there is only one pointer to the next and, accordingly, in the previous box, only one pointer to this box (programmers can see the analogy with linked lists). <br><br>  If the box does not point to itself (the box number is equal to the number of the plate in it), then it will be in the chain.  Some chains may consist of two boxes, some longer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b26/0d4/3f5/b260d43f581d578d89a75559f258f0d9.png"><br><br>  Since all prisoners start with a box with the same number as on their clothes, they, by definition, fall on a chain that contains their nameplate (there is only one nameplate that points to this box). <br><br>  Exploring the boxes along this chain in a circle, they are guaranteed to eventually find their nameplate. <br><br>  The only question remains is whether they will find their plate in 50 moves. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdd/030/119/fdd0301195eb8ef6b8c499e399aee12b.png"><br><br><h4>  Chain length </h4><br>  In order for all prisoners to pass the test, the maximum length of the chain must be less than 50 boxes.  If the chain is longer than 50 boxes, prisoners with numbers from these chains will fail the test - and all prisoners will be dead. <br><br><h6>  If the maximum length of the longest chain is less than 50 boxes, then all prisoners will pass the test! </h6><br><br>  Think about it for a second.  It turns out that there can be only one chain that is longer than 50 boxes in any case of plates (we have only 100 boxes, so if one chain is longer than 50, the rest will be shorter than 50 in the end). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aff/109/729/aff109729a02694888da2b3a77cef895.png"><br><br><h4>  Chances of deal with a long chain </h4><br>  Once you have convinced yourself that to achieve success, the maximum chain length must be less than or equal to 50, and there can be only one long chain in any set, we can calculate the success rate of passing the test: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/576/c54/fd7576c5428f2bece4e43cb77ae34a03.png"><br><br><h4>  More math </h4><br>  So, what do we need to figure out the probability of the existence of a long chain? <br><br>  For a chain with a length l, the probability that the boxes will be outside this chain is equal to: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9da/3f6/ec3/9da3f6ec354fad55f05a802d2106bcb6.png"><br><br>  In this collection of numbers there is (l-1)!  ways to arrange labels. <br><br>  The remaining plates can be located (100-l)!  ways (do not forget that the length of the chain does not exceed 50). <br><br>  Given this, the number of permutations that contain a chain of exact length l: (&gt; 50) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/802/892/7f1/8028927f1b15f8dc7ddb958ff4aca512.png"><br><br>  It turns out that there are 100 (!) Ways of plate layout, so the probability of the existence of a chain of length l is 1 / l.  By the way, this result does not depend on the number of boxes. <br><br>  As we already know, there can be only one option in which there is a chain of length&gt; 50, so the probability of success is calculated using this formula: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce3/a72/ff6/ce3a72ff653c6bb976974fae4e6ab79c.png"><br><br><h4>  Result </h4><br>  31.18% - the probability that the size of the longest chain will be less than 50 and each of the prisoners will be able to find his own plate, taking into account the limit of 50 attempts. <br><br><h6>  <em>The probability that all prisoners will find their tablets and pass the test of 31.18%</em> </h6><br><br>  Below is a graph showing the probabilities (along the y-axis) for all chains of length l (on the x-axis).  Red color means all ‚Äúfailures‚Äù (this curve here is just a 1 / l plot).  Green color means ‚Äúsuccess‚Äù (the calculation is a little more difficult for this part of the graph, since there are several ways to determine the maximum length &lt;50).  The overall probability is made up of green columns at a 31.18% chance of escape. <br><br><img src="http://big-lab.com/images/articles/prisoners_escape_100boxes/graph1.png"><br><br><h4>  Harmonic number (this part of the article for geeks) </h4><br>  In mathematics, the nth harmonic number is the sum of the reciprocals of the first n consecutive numbers of the natural series. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94a/15d/5ed/94a15d5ed38f9cd4b452481de7815245.png"><br><br>  We can calculate the jailbreak probability by adding the corresponding harmonic numbers. <br><br>  We calculate the limit if instead of 100a boxes we have an arbitrary large number of boxes (let's assume that we have 2n boxes in total). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/310/e20/6ce310e20268b626e432efc43cde5f79.png"><br><br>  The Euler ‚Äì Mascheroni constant is a constant defined as the limit of the difference between the partial sum of the harmonic series and the natural logarithm of a number. <br><br><h6>  <em>As the number of prisoners increases, provided that the supervisor permits prisoners to open half of all the boxes, the chance for salvation tends to be 30.685%</em> </h6><br><br>  (If you made a decision in which prisoners randomly guess boxes, then with an increase in the number of prisoners, the probability of salvation tends to zero!) <br><br><h4>  Additional question </h4><br>  Does anyone else remember an additional question?  What can our helpful comrade do to increase the chances of survival? <br><br>  Now we already know the solution, so the strategy here is simple: he must study all the signs and find the longest chain of boxes.  If the longest chain is less than 50, then it does not need to change the plates at all, or change them so that the longest chain does not become longer than 50.  However, if he found a chain longer than 50 boxes, all he needs is to change the contents of the two boxes from this chain in order to break this chain into two shorter chains. <br><br>  As a result of this strategy, there will be no long chains and all prisoners will be guaranteed to find their tablet and salvation.  So, swapping the two tablets, we reduce the probability of salvation to 100%! </div><p>Source: <a href="https://habr.com/ru/post/250817/">https://habr.com/ru/post/250817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250807/index.html">Visual brute force on the example of solving a 3D puzzle</a></li>
<li><a href="../250809/index.html">Using an alternative memory allocator in a C / C ++ project</a></li>
<li><a href="../250811/index.html">Apache Spark Introduction</a></li>
<li><a href="../250813/index.html">Spatial positioning system for aviation (using FPGA)</a></li>
<li><a href="../250815/index.html">Lock-free data structures. Concurrent maps: skip list</a></li>
<li><a href="../250819/index.html">Black Swift - at Embedded World Conference</a></li>
<li><a href="../250821/index.html">The quality of data networks. Software and hardware measurements</a></li>
<li><a href="../250823/index.html">Pebble: accelerometer, example of use</a></li>
<li><a href="../250825/index.html">Web technologies through the eyes of a C ++ programmer</a></li>
<li><a href="../250829/index.html">Computer Interfaces in Cinema - Evolution of Imagination</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>