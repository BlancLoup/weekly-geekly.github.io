<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bad Rabbit ransomware Trojan: Bad, Bad Rabbit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On October 24, notifications of mass attacks with the help of the Bad Rabbit Trojan ransomware fell on us. The main goal is Russian organizations and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bad Rabbit ransomware Trojan: Bad, Bad Rabbit</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/f0/73/59f073eb0b542313951212.png" width="300" align="right"><br>  On October 24, notifications of mass attacks with the help of the Bad Rabbit Trojan ransomware fell on us.  The main goal is Russian organizations and consumers, but there are reports of victims from Ukraine. <br><br>  Here‚Äôs what the ransom demand for hapless victims looks like: <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb59f87465676141.png"><br><br><h3>  What a view </h3><br>  Bad Rabbit (translated as ‚Äúbad rabbit‚Äù) is a previously unknown family of ransovari. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  How to multiply </h3><br>  <a href="https://securelist.com/threats/dropper-glossary">The dropper of the</a> extortioner is distributed due to <a href="https://securelist.com/threats/drive-by-attack-glossary/">drive-by downloads</a> .  The goal is visited by a completely legitimate site, while the malicious dropper is loaded from the infrastructure of the attacker.  No exploits are used, the victim launches the dropper manually - he pretends to be an Adobe Flash installer. <br><br>  We found a number of compromised websites, all of which are news or media. <br><br><h3>  Whom the tooth sharpens </h3><br>  Most of the targets are located in Russia.  Similar, but smaller volumes of attacks were observed in other countries - Ukraine, Turkey and Germany. <br><br><h3>  When did Kaspersky Lab detect the threat? </h3><br>  We fixed the initial attack vector in the morning of October 24th.  The attack continued until noon, but we still detect isolated cases of infection. <br><br><h3>  What is the difference with ExPetr?  Or is it the same malware? </h3><br>  Our observations show that this was a targeted attack on corporate networks using methods similar to the <a href="https://securelist.com/schroedingers-petya/78870/">ExPetr toolkit</a> . <br><br><h3>  Technical details </h3><br>  According to our telemetry, this evil rabbit breeds by passing loading. <br>  The ransomware dropper is loaded from hxxp: // 1dnscontrol [.] Com / flash_install.php <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb6740b216944370.png"><br><br>  According to our data, victims are redirected to a malicious resource from legitimate and harmless news sites. <br><br>  The downloaded file named <b>install_flash_player.exe is</b> launched by the victim manually.  In order to work correctly, it needs elevated administrative privileges, which it is trying to get using the standard UAC request.  When launched, it will save the malicious DLL as <b>C: \ Windows \ infpub.dat</b> and launch it using rundll32. <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb7b931861384942.png"><br>  <i>Pseudo-code for installing a malicious DLL file</i> <br><br>  <b>infpub.dat</b> brute-force NTLM authentication manager credentials on Windows machines with pseudo-random IP addresses. <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb892d0319694275.png"><br>  <i>Hard-coded list of accounts</i> <br><br>  <b>infpub.dat</b> also installs the malicious utility dispci.exe on C: \ Windows and creates a task to start it. <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdad81e7898460344.png"><br>  <i>Pseudocode of the procedure that creates the task that starts the malware</i> <br><br>  Moreover, <b>infpub.dat</b> acts as a typical extortionist-cryptographer: through the built-in list of extensions, it finds the victim's data files and encrypts them using the RSA-2048 public key. <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdaf40f6069506164.png"><br>  <i>Open cyber villain key and list of extensions</i> <br><br>  Parameters of the villainous public key: <br><br><img src="https://habrastorage.org/webt/59/f1/5e/59f15e4054418310358191.png"><br><br>  Apparently, the executable file <b>dispci.exe was</b> created based on the code of the harmless utility DiskCryptor.  It acts as a disk encryption module, which also installs a modified bootloader and interferes with the normal boot process of an infected machine. <br><br>  The sample of the analyzed threat turned out to be with a twist: it seems that its authors are ardent fans of the ‚ÄúGame of Thrones‚Äù.  Some lines of code contain the names of various characters in the series (or books). <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb141e6756658975.png"><br>  <i>The name of the dragon from the ‚ÄúGame of Thrones‚Äù</i> <br><br><img src="https://habrastorage.org/webt/59/f0/5b/59f05bdb49357226059858.png"><br>  <i>Character Name ‚ÄúGame of Thrones‚Äù</i> <br><br>  A bad rabbit encrypts files and a hard disk according to a typical cryptographic scheme, using the AES-128-CBC and RSA-2048 algorithms.  Interestingly, the Trojan compares the hashes of the names of running processes with a given table.  And the hashing algorithm is similar to the one used by the famous exPetr. <br><br><img src="https://habrastorage.org/webt/59/f0/cd/59f0cd5595dd7215700841.png"><br>  <b>Comparison of Bad Rabbit and ExPetr hashing procedures</b> <br><br><img src="https://habrastorage.org/webt/59/f0/cd/59f0cd55c1ecf643276749.png"><br>  <b>Special branch of the program</b> <br><br><img src="https://habrastorage.org/webt/59/f0/cd/59f0cd55ca911627874710.png"><br>  <b>Procedure for initialization of runtime flags</b> <br><br>  Full list of hashes from process names: <br><br><img src="https://habrastorage.org/webt/59/f0/ce/59f0cefced8a0581275817.png"><br><br>  The rabbit sends the DiskCryptor driver (originally called dcrypt.sys, and the Trojan disguises it as cscc.dat and puts it in C: \ Windows \) IOCTL codes to encrypt the hard disk partitions.  Some functions are simply taken from the DiskCryptor sources, from the drv_ioctl.c file, others are developed by the authors of the rabbit. <br><br><img src="https://habrastorage.org/webt/59/f0/cd/59f0cd55818da000704565.png"><br>  <b>Pseudocode procedure that generates a password and encrypts disk partitions</b> <br><br>  Kaspersky Lab experts carefully prepare the ‚Äúbad rabbit‚Äù for possible loopholes in its cryptographic algorithms. <br><br>  Our clients can feel protected if they have activated all the protective mechanisms of the products (KSN and System Watcher are not disabled), as well as updated bases. <br><br>  As an extra precaution, it makes sense to block the execution of the files <b>C: \ Windows \ infpub.dat</b> and <b>C: \ Windows \ cscc.dat</b> . <br><br>  <b>IOCs:</b> <br>  <a href="http://1dnscontrol/">1dnscontrol</a> [.] Com / <br>  fbbdc39af1139aebba4da004475e8839 - install_flash_player.exe <br>  1d724f95c61f1055f0d02c2154bbccd3 - C: \ Windows \ infpub.dat <br>  b14d8faf7f0cbcfad051cefe5f39645f - C: \ Windows \ dispci.exe </div><p>Source: <a href="https://habr.com/ru/post/340944/">https://habr.com/ru/post/340944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340934/index.html">Autumn changes on Habr√© and Geektimes</a></li>
<li><a href="../340936/index.html">Agile in Russia - 82.9% of companies report that they use at least something from Agile. First poll results</a></li>
<li><a href="../340938/index.html">New virus Reaper infected 2 million IoT devices</a></li>
<li><a href="../340940/index.html">Windows Defender removes the bootloader from DiskCryptor</a></li>
<li><a href="../340942/index.html">Big migration</a></li>
<li><a href="../340946/index.html">Jaeger Opentracing and Microservices in a real PHP and Golang project</a></li>
<li><a href="../340950/index.html">Why does one NGINX process take care of all the work?</a></li>
<li><a href="../340952/index.html">13 surprises by a non-company</a></li>
<li><a href="../340954/index.html">Cisco Sales Associate Program</a></li>
<li><a href="../340956/index.html">Requirements analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>