<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Range, TextRange and Selection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many JavaScript developers have had to deal with the objects listed in the header, for example, when solving the following tasks: 
 - creation of visu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Range, TextRange and Selection</h1><div class="post__text post__text-html js-mediator-article">  Many JavaScript developers have had to deal with the objects listed in the header, for example, when solving the following tasks: <br>  - creation of visual editors (wysiwyg), <br>  - search in the browser window, <br>  - setting BB-code <br>  etc. <br><br>  In this article, the author attempts to collect the translation of documentation about these objects in one place + to write small accompanying examples.  The translation is free, not literal, so if you find inaccuracy or clumsy wording - write in the comments. <br><br>  In general, the post is for reference only, and I hope that someone will simplify the development. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h2>  1. Range </h2><br>  <strong>Range</strong> is an object corresponding to a document fragment, which may include nodes and sections of text from this document.  Most details about Range-objects are set out in the <a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">DOM Range</a> . <br><br>  In order to understand what this is about, let us turn to the simplest case of Range-objects, which will be discussed in detail below, - to selections.  In the example below, highlight a few words in a sentence.  This will create objects similar to Range.  In our example, we will get the text content of the area that you select. <br><br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">Example link</a> <br><br>  But such areas can be created not only with the help of a custom selection, but also from a JavaScript script, performing certain manipulations with them.  However, to write a simple illustrating code will not work right away, since  there is one BUT - Internet Explorer.  Micsosoft created its own implementation, <a href="http://msdn.microsoft.com/en-us/library/ms535872.aspx">a TextRange object</a> .  Let's sort each implementation separately. <br><br><h3>  1.1 DOM implementation of a Range <img src="https://habrastorage.org/getpro/habr/post_images/d86/306/e47/d86306e474a89377a537d48d365846da.gif" width="16" height="16" alt="Mozilla Firefox supported"><img src="https://habrastorage.org/getpro/habr/post_images/576/500/807/57650080760b39c44fb782b7193c9005.gif" width="16" height="16" alt="Chrome supported"><img src="https://habrastorage.org/getpro/habr/post_images/b2d/f7a/89d/b2df7a89dcf08d3344528b3282d5ff71.gif" width="16" height="16" alt="Opera supported"><img src="https://habrastorage.org/getpro/habr/post_images/32b/3fa/755/32b3fa7553da67019db6d386f590713e.gif" width="16" height="16" alt="Safari supported"></h3><br>  Range consists of two boundary points (boundary-points) corresponding to the beginning and end of the region.  The position of any boundary point is defined in the document using two properties: node (node) and offset (offset).  A container is a node that contains a boundary point.  The container itself and all its ancestors are called the parent containers (ancestor containers) for the boundary point.  A parent container that includes both boundary points is called a root container. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c14/a5b/8b5/c14a5b8b526c93bd88904c1cfcaa646e.gif" width="358" height="35" alt="Range nodes"><br><br>  In the image above, the selection boundary points lie in text nodes (# text1 and # text2), which are containers.  For the left border, the parent containers are # text1, H1, BODY, for the right border - # text2, P, BODY.  The common parent for both boundary points is BODY, this element is a root container. <br><br>  If the container is a text node, the offset is defined in characters from the beginning of the node.  If the container is an element (Document, DocumentFragment, Element ...), then the offset is determined in the child nodes. <br><br>  We look at the illustration ( <a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">source</a> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05e/bc5/3dc/05ebc53dc9a35802d729f0d81ed5a5d6.gif" width="357" height="343" alt="Range Example"><br><br>  The boundary points of the Range-object <b>s1</b> lie in the text nodes, so the offset is specified in characters from the beginning of the node.  For <b>s2, the</b> boundary points are arranged so that they include the entire &lt;p&gt; Blah xyz &lt;/ p&gt; paragraph, so the container is the BODY element, and the offset is considered at the positions of the child nodes. <br><br>  Range objects are created using the creareRange method, which is called in the context of a root container or document.  The object is created empty, and the boundary points are set by the setStart and setEnd methods of the object.  See an example: <br><br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="ex2"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h2</font> <font color="#0000ff">&gt;</font> | Range- <font color="#0000ff">&lt;/</font> <font color="#800000">h2</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font>  |       . <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> <br> <br> <code><font color="black">$domRange = { <br> create : <font color="#0000ff">function</font> () { <br> <font color="#008000">//  root-</font> <br> <font color="#0000ff">var</font> root = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'ex2'</font> ); <br> <font color="#008000">//     (   )</font> <br> <font color="#0000ff">var</font> start =  root.getElementsByTagName( <font color="#A31515">'h2'</font> )[0].firstChild; <br> <font color="#0000ff">var</font> end =  root.getElementsByTagName( <font color="#A31515">'p'</font> )[0].firstChild; <br> <font color="#0000ff">if</font> ( root.createRange ) { <br> <font color="#008000">//  Range</font> <br> <font color="#0000ff">var</font> rng = root.createRange(); <br> <font color="#008000">//    ,    </font> <br> rng.setStart( start, 3 ); <br> <font color="#008000">//    </font> <br> rng.setEnd( end, 10 ); <br> <font color="#008000">//     ,     </font> <br> <font color="#0000ff">return</font> rng.toString(); <br> } <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">',   Internet Explorer,   TextRange '</font> ; <br> } <br> }</font></code> <br> <br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">An example in action</a> . <br><br>  Consider briefly the <a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">properties and methods of the Range</a> : <br><ul><li>  The <strong>commonAncestorContainer</strong> property returns a link to the most embedded root container. </li><li>  The <strong>startContainer</strong> ( <strong>endContainer</strong> ) property returns a reference to the container of the upper (lower) boundary point. </li><li>  The <strong>startOffset</strong> ( <strong>endOffset</strong> ) property returns the offset for the upper (lower) boundary point. </li><li>  The <strong>collapsed</strong> property returns true if the boundary points have the same containers and offset (false otherwise). </li></ul><br><ul><li>  The <strong>setStart</strong> ( <strong>setEnd</strong> ) method sets the container (link to the node) and the offset (integer value) for the corresponding boundary points.  The example above. </li><li>  The <strong>setStartBefore</strong> , <strong>setStartAfter</strong> , <strong>setEndBefore</strong> , <strong>setEndAfter methods</strong> take as a single argument a reference to a node and set boundary points according to the natural border of the passed node.  For example: <br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#ff0000">id</font> <font color="#0000ff">="s1"</font> <font color="#0000ff">&gt;</font> First <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#ff0000">id</font> <font color="#0000ff">="s2"</font> <font color="#0000ff">&gt;</font> Second <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font></font></code> <br> <code><font color="black"><font color="#0000ff">var</font> rng = <font color="#0000ff">document</font> .createRange(); <br> <font color="#008000">//         #s1</font> <br> rng.setStartBefore( <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'s1'</font> ) ); <br> <font color="#008000">//         #s2</font> <br> rng.setEndAfter( <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'s2'</font> ) );</font></code> <br> </li><li>  The <strong>selectNode</strong> and <strong>selectNodeContents methods</strong> allow you to create a Range object on the boundaries of the node, the link to which they take as the only argument.  When using selectNode, the passed node will also go into Range, while selectNodeContents will create an object only from the contents of the node: <br><img src="https://habrastorage.org/getpro/habr/post_images/5be/bbe/f20/5bebbef2012d4adf996f7e05ba36f6e1.gif" width="358" height="55" alt="Select node"></li><li>  The <strong>collapse</strong> method combines the boundary points of a Range object.  As a single argument, it takes a boolean value (true &amp; mdash to combine at the top point, false &amp; mdash at the bottom).  By default, true. </li><li>  The <strong>toString</strong> method returns the text content of the Range object. </li><li>  The <strong>cloneContents</strong> method will return a copy of the contents of the Range object as a fragment of a document. </li><li>  The <strong>cloneRange</strong> method will return a copy of the Range object itself. </li><li>  The <strong>deleteContents</strong> method deletes the entire contents of the Range object. </li><li>  The <strong>detach</strong> method retrieves the current object from the DOM, so it can no longer be referenced. </li><li>  The <strong>insertNode</strong> method takes as a single argument a reference to a node (or a fragment of a document) and inserts it into the contents of the Range object at the starting point. </li><li>  The <strong>extractContents</strong> method cuts the contents of the Range object and returns a reference to the received document fragment. </li><li>  The method <strong>surroundContents</strong> places the entire contents of the current Range object into a new parent element, the link to which is taken as the only argument. </li><li>  The <strong>compareBoundaryPoints</strong> method <strong>is</strong> used to compare boundary points. </li></ul><br><br>  To distract and consolidate knowledge, we will solve a small puzzle.  Find the phrase in the text node and highlight it with a blue background. <br><br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="ex3"</font> <font color="#0000ff">&gt;</font> <br>      ""      <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> <br> <br> <code><font color="black">$domRange.highlight = <font color="#0000ff">function</font> ( text ) { <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> root = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'ex3'</font> ).firstChild; <br> <font color="#008000">//   </font> <br> <font color="#0000ff">var</font> content = root.nodeValue; <br> <font color="#008000">//       </font> <br> <font color="#0000ff">if</font> ( content.indexOf( text ) != -1 ) { <br> <font color="#0000ff">if</font> ( <font color="#0000ff">document</font> .createRange ) { <br> <font color="#008000">//   ,    Range,  </font> <br> <font color="#0000ff">var</font> rng = <font color="#0000ff">document</font> .createRange(); <br> <font color="#008000">//      ,</font> <br> rng.setStart( root, content.indexOf( text ) ); <br> <font color="#008000">//     +  </font> <br> rng.setEnd( root, content.indexOf( text ) + text.length ); <br> <font color="#008000">//     </font> <br> <font color="#0000ff">var</font> highlightDiv = <font color="#0000ff">document</font> .createElement( <font color="#A31515">'span'</font> ); <br> highlightDiv.style.backgroundColor = <font color="#A31515">'blue'</font> ; <br> <font color="#008000">//   Range  </font> <br> rng.surroundContents( highlightDiv ); <br> } <font color="#0000ff">else</font> <br> alert( <font color="#A31515">',   Internet Explorer,   TextRange '</font> ); <br> } <font color="#0000ff">else</font> <br> alert( <font color="#A31515">'  '</font> ); <br> }</font></code> <br> <br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">An example in action</a> . <br><br>  Experiment yourself with the rest of the properties and methods. <br>  Let us turn to the implementation of range in MSIE. <br><br><h3>  1.2.  Textrange <img src="https://habrastorage.org/getpro/habr/post_images/58e/0d1/ed1/58e0d1ed15240e9c2acf53d14c3214c2.gif" width="16" height="16" alt="Internet Explorer supported"></h3><br>  The <strong>TextRange object</strong> in the MSIE implementation is a text range of zero or more length.  This range also has its own borders, which can be ‚Äúmoved‚Äù by an integer number of text units: character (character), word (word), sentence (sentence).  That is, you can take and move the border by 2 (5, 8, etc.) words (symbol, sentence) to the right (left).  At the same time, the object stores data about the HTML content of the range and has methods for interacting with the DOM. <br><br>  A TextRange object is created using the <strong>createTextRange</strong> method, which can be called in the context of the following DOM elements: <br><br> <code>BODY, BUTTON, INPUT type=button, INPUT type=hidden, INPUT type=password, INPUT type=reset, INPUT type=submit, INPUT type=text, TEXTAREA</code> <br> <br>  A simple example with a button: <br><br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="buttonId"</font> <font color="#ff0000">type</font> <font color="#0000ff">="button"</font> <font color="#ff0000">value</font> <font color="#0000ff">="Test button"</font> <font color="#0000ff">/&gt;</font></font></code> <br> <br> <code><font color="black">$ieTextRange = { <br> create : <font color="#0000ff">function</font> () { <br> <font color="#008000">//  </font> <br> <font color="#0000ff">var</font> button = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'buttonId'</font> ); <br> <font color="#008000">//    </font> <br> <font color="#0000ff">if</font> ( button.createTextRange &amp;&amp; button.createTextRange() != undefined ) { <br> <font color="#008000">//  TextRange</font> <br> <font color="#0000ff">var</font> rng = button.createTextRange(); <br> <font color="#008000">//      </font> <br> <font color="#0000ff">return</font> rng.text; <br> } <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#A31515">',    IE (!),   Range '</font> ; <br> } <br> }</font></code> <br> <br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">An example in action</a> . <br><br>  Consider the <a href="http://msdn.microsoft.com/en-us/library/ms535872.aspx">properties and methods of the TextRange object</a> (not all, only the most necessary): <br><ul><li>  The property <strong>boundingWidth</strong> (boundingHeight) returns the width (height) that the TextRange object occupies in pixels. </li><li>  The property <strong>boundingTop</strong> ( <strong>boundingLeft</strong> ) returns the Y (X) -coordinate of the upper left corner of the test area relative to the document window. </li><li>  The <strong>htmlText</strong> property returns the HTML content of the object. </li><li>  The <strong>text</strong> property returns the textual content of the object (see the example above). </li><li>  The <strong>offsetTop</strong> ( <strong>offsetLeft</strong> ) property returns the Y (X) -coordinate of the upper left corner of the test area relative to the ancestor. </li></ul><br><ul><li>  The <strong>collapse</strong> method combines the boundary points of a range.  As a single argument, it takes a boolean value (true &amp; mdash to combine at the top point, false &amp; mdash at the bottom).  By default, true. </li><li>  The <strong>duplicate</strong> method clones the existing text range, returning a new one, exactly the same. </li><li>  The <strong>expand</strong> method expands the current text range to a single text passed as the only text argument: <br> <code>'character' ‚Äî  <br> 'word' ‚Äî  <br> 'sentence' ‚Äî  <br> 'textedit' ‚Äî    .</code> <br>  Returns true (false) on success (failure). <br></li><li>  The <strong>findText</strong> method <strong>searches</strong> for a range of matches with the text string passed as the first argument (case insensitive).  If a match is found, the boundaries of the range are collapsed to it.  As a second (optional) argument, you can pass an integer indicating the number of characters from the top point to be searched.  Further, as arguments, you can list INT-flags that you <a href="http://msdn.microsoft.com/en-us/library/ms536422(VS.85).aspx">are unlikely to need</a> . </li><li>  The <strong>getBookmark</strong> method returns in case of a successful call a string that can be used to restore the current state of the text range using the <strong>moveToBookmark</strong> method. </li><li>  The <strong>inRange</strong> method takes another TextRange object as an argument and checks whether its text range is in the range of the context object.  Returns a boolean value. </li><li>  The <strong>isEqual</strong> method checks whether the current TextRange object is identical to the one passed as an argument.  Returns a boolean value. </li><li>  The <strong>move (sUnit [, iCount])</strong> method collapses the current range to zero length and moves a unit of text passed as the first argument (character | word | sentence | textedit).  As a second (optional) argument, you can pass the number of units to which the range should be moved. </li><li>  The <strong>moveEnd</strong> ( <strong>moveStart</strong> ) method, similarly to the move method, moves the upper (lower) limit of the range by a unit of text, the number of which can also be specified by the optional second parameter. </li><li>  The <strong>moveToElementText</strong> method takes as its argument a link to the DOM element and sets the bounds of the range of the TextRange object along the bounds of the received element. </li><li>  The <strong>moveToPoint</strong> method takes as its two required arguments X and Y-coordinates (in pixels) relative to the upper left corner of the document and transfers the boundaries of the range there. </li><li>  The <strong>parentElement</strong> method returns a reference to an element that completely contains the range of a TextRange object (or null). </li><li>  The <strong>pasteHTML</strong> method replaces the HTML content of the current text range with the string passed as the only argument. </li><li>  The <strong>select</strong> method generates a selection based on the contents of the TextRange object, which we will discuss in more detail below. </li><li>  The <strong>setEndPoint</strong> method takes a text pointer and a link to another TextRange object as required arguments, setting it depending on the value of the pointer of the range border.  Pointers can be the following: 'StartToEnd', 'StartToStart', 'EndToStart', 'EndToEnd'. </li></ul><br><br>  Also applied to the TextRange objects are commands of <a href="http://2007.fastcoder.ru/articles/%3Faid%3D172">the execCommand method</a> . <br><br>  To fix it, we will solve a puzzle for searching text content, similar to the one above: <br><br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="ex4"</font> <font color="#0000ff">&gt;</font> <br>      ""      <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> <br> <br> <code><font color="black">$ieTextRange.highlight = <font color="#0000ff">function</font> ( text ) { <br> <font color="#008000">//    ,     </font> <br> <font color="#0000ff">var</font> root = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'ex4'</font> ); <br> <font color="#008000">//     </font> <br> <font color="#0000ff">var</font> content = root.firstChild.nodeValue; <br> <font color="#008000">//   </font> <br> <font color="#0000ff">if</font> ( content.indexOf( text ) != -1 ) { <br> <font color="#008000">//    MSIE</font> <br> <font color="#0000ff">if</font> ( <font color="#0000ff">document</font> .body.createTextRange ) { <br> <font color="#008000">//   TextRange</font> <br> <font color="#0000ff">var</font> rng = <font color="#0000ff">document</font> .body.createTextRange(); <br> <font color="#008000">//    root</font> <br> rng.moveToElementText( root ); <br> <font color="#008000">//       </font> <br> <font color="#0000ff">if</font> ( rng.findText( text ) ) <br> <font color="#008000">//     span   </font> <br> rng.pasteHTML( <font color="#A31515">'&lt;span style="background:blue;"&gt;'</font> + text + <font color="#A31515">'&lt;/span&gt;'</font> ); <br> } <font color="#0000ff">else</font> <br> alert( <font color="#A31515">',    IE (!),   Range '</font> ); <br> } <font color="#0000ff">else</font> <br> alert( <font color="#A31515">'  '</font> ); <br> }</font></code> <br> <br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">An example in action</a> . <br><br>  Experiment yourself with the rest of the properties and methods. <br><br><h2>  2. Selection </h2><br>  Everyone knows the selection of elements on the page, when, holding the left mouse button and moving the cursor, we select the desired fragment.  Or hold Shift and click on the arrow keys.  Or somehow, it does not matter.  In this part of the article, we will cross-browser learn how to solve two problems: get a user selection and set your own. <br><br><h3>  2.1.  Get custom highlighting </h3><br>  We have already solved this problem at the very beginning of the article <a href="https://habr.com/ru/post/55922/">in the mix example</a> .  Now consider the code: <br><br> <code><font color="black">$selection = { <br> getText : <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> txt = <font color="#A31515">''</font> ; <br> <font color="#0000ff">if</font> (txt = window.getSelection) <font color="#008000">// Not IE,   getSelection</font> <br> txt = window.getSelection().toString(); <br> <font color="#0000ff">else</font> <font color="#008000">// IE,   selection</font> <br> txt = <font color="#0000ff">document</font> .selection.createRange().text; <br> <font color="#0000ff">return</font> txt; <br> } <br> }</font></code> <br> <br>  All browsers, except Internet Explorer, support the <strong>getSelection</strong> method in the context of a window, which returns an object similar to <a href="https://habr.com/ru/post/55922/">the previously discussed Range</a> .  This object has a selection start point (anchor) and a focus end point (focus).  Points may coincide.  Consider the properties and methods of the Selection object: <img src="https://habrastorage.org/getpro/habr/post_images/d86/306/e47/d86306e474a89377a537d48d365846da.gif" width="16" height="16" alt="Mozilla Firefox supported"><img src="https://habrastorage.org/getpro/habr/post_images/576/500/807/57650080760b39c44fb782b7193c9005.gif" width="16" height="16" alt="Chrome supported"><img src="https://habrastorage.org/getpro/habr/post_images/b2d/f7a/89d/b2df7a89dcf08d3344528b3282d5ff71.gif" width="16" height="16" alt="Opera supported"><img src="https://habrastorage.org/getpro/habr/post_images/32b/3fa/755/32b3fa7553da67019db6d386f590713e.gif" width="16" height="16" alt="Safari supported"><br><ul><li>  The <strong>anchorNode</strong> property returns the container in which the selection starts.  I note that the beginning of the selection is the border from which you started the selection.  That is, if you select from right to left, then the beginning will be exactly the right border.  This rule works everywhere except for the Opera browser, in which anchorNode returns a link to the node of the left edge of the selection. </li><li>  The <strong>anchorOffset</strong> property returns the offset to start the selection within the anchorNode container. </li><li>  The <strong>focusNode</strong> and <strong>focusOffset properties</strong> work similarly for focal points, that is, the end points of the selection.  Opera has also distinguished itself here, instead of a focal point, it returns the node of the right edge of the selection. </li><li>  The <strong>rangeCount</strong> property returns the number of Range-objects that are included in the resulting selection.  This property is useful when using the addRange method. </li></ul><br><ul><li>  The <strong>getRangeAt</strong> method takes as an argument the index of the Range object and returns the object itself.  If rangeCount == 1, then only <strong>getRangeAt (0)</strong> will work.  Thus, we can get a Range-object that fully corresponds to the current selection. </li><li>  The <strong>collapse</strong> method <strong>collapses the</strong> selection to a point (caret).  The method can be passed as the first argument of the node in which to place the carriage. </li><li>  The <strong>extend</strong> method takes as arguments the reference to the container and the offset (parentNode, offset), and moves the focal point to this position. </li><li>  The <strong>collapseToStart</strong> ( <strong>collapseToEnd</strong> ) method moves the focal (initial) border to the initial (focal) border, thereby folding the selection into the caret. </li><li>  The <strong>selectAllChildren</strong> method accepts a reference to the node as the only argument and adds all its descendants to the selection. </li><li>  The <strong>addRange</strong> method takes a Range object as an argument and adds it to the selection.  Thus, you can increase the number of Range-objects, the number of which will be prompted to us by the rangeCount property. </li><li>  The <strong>removeRange</strong> ( <strong>removeAllRanges</strong> ) method removes the transferred (all) Range object from the selection. </li><li>  The <strong>toString</strong> method returns the textual content of the selection. </li></ul><br>  Internet Explorer provides its own interface for interacting with selections - the <strong>selection</strong> object in the context of the document.  The following methods are used to work with this object. <img src="https://habrastorage.org/getpro/habr/post_images/58e/0d1/ed1/58e0d1ed15240e9c2acf53d14c3214c2.gif" width="16" height="16" alt="Internet Explorer supported"><br><ul><li>  The <strong>clear</strong> method removes the selection along with its contents. </li><li>  The createRange method (IMPORTANT! Not to be confused with the createRange DOM method for creating Range objects!) Creates a TextRange object from the selection content. </li><li>  The <strong>empty</strong> method removes the selection, but leaves the contents. </li></ul><br>  I hope, now, after becoming acquainted with both implementations of selections, the code above has become more understandable. <br><br><h3>  2.1.  Setting your own selection </h3><br>  Suppose you want a text fragment on a page to be selected as a user selection.  This is necessary for the client implementation of the search page and some other tasks.  The easiest way to solve this problem is as follows: <br><ol><li>  Create a Range object (TextRange for IE). </li><li>  Translate the resulting object to the selection. </li></ol><br>  We look implementation: <br><br> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">="ex5"</font> <font color="#0000ff">&gt;</font> <br>    <font color="#0000ff">&lt;</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font>  <font color="#0000ff">&lt;/</font> <font color="#800000">span</font> <font color="#0000ff">&gt;</font> ,     . <br> <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font></font></code> <br> <br> <code><font color="black">$selection.set = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> target = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'ex5'</font> ).getElementsByTagName( <font color="#A31515">'span'</font> )[0]; <br> <font color="#0000ff">var</font> rng, sel; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">document</font> .createRange ) { <br> rng = <font color="#0000ff">document</font> .createRange(); <br> rng.selectNode( target ) <br> sel = window.getSelection(); <br> sel.removeAllRanges(); <br> sel.addRange( rng ); <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">var</font> rng = <font color="#0000ff">document</font> .body.createTextRange(); <br> rng.moveToElementText( target ); <br> rng.select(); <br> } <br> }</font></code> <br> <br>  <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">An example in action</a> . <br><br><h2>  3. Afterword </h2><br>  Reflecting on the API provided by the article, the idea arose of creating a small library that would teach IE the DOM-implementation of Range and Selection.  Perhaps it even exists, then the author will be grateful to you for the link and saving your own time. <br><br>  Description API does not claim to be complete and accurate translation, but the author of this is enough for comfortable JavaScript development.  The originals in English can be found at the links below. <br><br>  Crosspost articles <a href="http://2007.fastcoder.ru/articles/%3Faid%3D609">Range, TextRange and Selection</a> with <a href="http://2007.fastcoder.ru/">fastcoder.org</a> . <br><br><h2>  4. References </h2><ul><li>  <a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html">Document Object Model Range specification on the W3C website</a> </li><li>  <a href="https://developer.mozilla.org/En/DOM/Selection">Description of implementation of allocations on developer.mozilla.org</a> </li><li>  <a href="https://developer.mozilla.org/En/DOM/Range">Description of the implementation of the Range on developer.mozilla.org</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ms535872.aspx">Description of the TextRange object in msdn</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ms536401(VS.85).aspx">CreateTextRange method in msdn</a> </li><li>  <a href="http://msdn.microsoft.com/en-us/library/ms535869(VS.85).aspx">Msdn selection object</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/55922/">https://habr.com/ru/post/55922/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../55916/index.html">TIE Fighter webcam</a></li>
<li><a href="../55917/index.html">A new trend in the IT market - the massive transition of companies to outsourcing</a></li>
<li><a href="../55918/index.html">Pict.com is a new version of image hosting.</a></li>
<li><a href="../55919/index.html">Jewel Necklace USB Flash Drive Pendants</a></li>
<li><a href="../55921/index.html">New vacancies for student interns</a></li>
<li><a href="../55924/index.html">Photo Gallery Design</a></li>
<li><a href="../55925/index.html">Hook of intentionally obsolete things</a></li>
<li><a href="../55926/index.html">Simple image comparison using php</a></li>
<li><a href="../55927/index.html">Head of the Mozilla Foundation in Moscow</a></li>
<li><a href="../55929/index.html">Webcast - SharePoint to Web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>