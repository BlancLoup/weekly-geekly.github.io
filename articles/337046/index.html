<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write GraphQL API server on Yii2 with a client on Polymer + Apollo. Part 3. Mutations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Server 
 Part 2. Client 
 Part 3. Mutations 
 Part 4. Validation. findings 


 Sometimes, when developing an API, it happens that it is necess...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write GraphQL API server on Yii2 with a client on Polymer + Apollo. Part 3. Mutations</h1><div class="post__text post__text-html js-mediator-article"><p>  <a href="https://habrahabr.ru/post/336758/">Part 1. Server</a> <br>  <a href="https://habrahabr.ru/post/337044/">Part 2. Client</a> <br>  <strong>Part 3. Mutations</strong> <br>  <a href="https://habrahabr.ru/post/337236/">Part 4. Validation.</a>  <a href="https://habrahabr.ru/post/337236/">findings</a> </p><br><p>  Sometimes, when developing an API, it happens that it is necessary not only to receive data, but also to make certain changes.  It is for this purpose that there exists what in GraphQL is called the strange word <a href="http://graphql.org/learn/queries/">"mutation"</a> . </p><a name="habracut"></a><br><h2 id="server">  Server </h2><br><p>  Having played enough with the client part, let's go back to our server and add a few mutations.  For mutations, we need to have a separate entry point from query (MutationType), and the functionality itself is implemented through the parameters of the args and resolve fields. </p><br><p>  <em>Question: Can I implement mutations through the fields of the query section?</em>  Good question.  The fact is that hypothetically this is possible, but architecturally wrong.  And the Apollo library loves to do a root query, i.e.  having the whole structure, asks for everything that is possible.  Why does she do this, I do not know, but presumably, if you put methods like delete () in a query, you can accidentally lose valuable things. </p><br><h3 id="shag-1-sozdadim-neobhodimye-tipy">  Step 1. Create the necessary types. </h3><br><p>  /schema/mutations/UserMutationType.php: </p><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">schema</span></span>\<span class="hljs-title"><span class="hljs-title">mutations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">ObjectType</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserMutationType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $config = [ <span class="hljs-string"><span class="hljs-string">'fields'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-comment"><span class="hljs-comment">//     //      //  User 'update' =&gt; [ //      //  2  -  //  -  /  //      User. //      //    ,   //     'type' =&gt; Type::boolean(), 'description' =&gt; 'Update user data.', 'args' =&gt; [ //    ,  //    User. //       //    ,   'firstname' =&gt; Type::string(), 'lastname' =&gt; Type::string(), 'status' =&gt; Type::int(), ], 'resolve' =&gt; function(User $user, $args) { //      , // ..      : //     ,     //     ,   $user-&gt;setAttributes($args); return $user-&gt;save(); } ], ]; } ]; parent::__construct($config); } }</span></span></code> </pre> <br><p>  <em>Council</em>  <em>Try to make your resolve () functions as low as possible.</em>  <em>As you can see, GraphQL allows you to do this to the maximum.</em>  <em>Carry as much as possible all the logic in the model.</em>  <em>The schema and API is only a link between the client and the server.</em>  <em>This principle applies not only to GraphQL, but to any server architecture.</em> </p><br><p>  Similar to /schema/mutations/AddressMutationType.php: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">schema</span></span>\<span class="hljs-title"><span class="hljs-title">mutations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">ObjectType</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Address</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">schema</span></span>\<span class="hljs-title"><span class="hljs-title">Types</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressMutationType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $config = [ <span class="hljs-string"><span class="hljs-string">'fields'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'update'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; Type::boolean(), <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Update address.'</span></span>, <span class="hljs-string"><span class="hljs-string">'args'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'street'</span></span> =&gt; Type::string(), <span class="hljs-string"><span class="hljs-string">'zip'</span></span> =&gt; Type::string(), <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; Type::int(), ], <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Address $address, $args)</span></span></span><span class="hljs-function"> </span></span>{ $address-&gt;setAttributes($args); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $address-&gt;save(); }, ], <span class="hljs-comment"><span class="hljs-comment">//        // user,     //    //  ,     'user' =&gt; [ 'type' =&gt; Types::userMutation(), 'description' =&gt; 'Edit user directly from his address', //    relove   // ,  ? 'resolve' =&gt; function(Address $address) { // ! //      // (,     - //  , GraphQL,    // ,       //   User,   ,   // -   ) return $address-&gt;user; } ], ]; } ]; parent::__construct($config); } }</span></span></code> </pre> <br><p>  During the development of your server, be careful not to use the mutation for sampling, or query to change the data, because there is no hard binding, as such. </p><br><p>  Well, the root type: /schema/MutationType.php: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">schema</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">ObjectType</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GraphQL</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">Definition</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Address</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MutationType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $config = [ <span class="hljs-string"><span class="hljs-string">'fields'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; Types::userMutation(), <span class="hljs-string"><span class="hljs-string">'args'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Type::nonNull(Type::int()), ], <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($root, $args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> User::find()-&gt;where($args)-&gt;one(); }, ], <span class="hljs-string"><span class="hljs-string">'address'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; Types::addressMutation(), <span class="hljs-string"><span class="hljs-string">'args'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Type::nonNull(Type::int()), ], <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($root, $args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Address::find()-&gt;where($args)-&gt;one(); }, ], ]; } ]; <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($config); } }</code> </pre> <br><h3 id="shag-2-dobavim-sozdannye-tipy-typesphp">  Step 2. Add the created Types.php types </h3><br><p>  If you noticed, in the last step we already used custom types from Types, although we have not yet created them.  This is what we are doing now. </p><br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">// ..      //    use app\schema\mutations\UserMutationType; use app\schema\mutations\AddressMutationType; ... private static $userMutation; private static $addressMutation; ... public static function mutation() { return self::$mutation ?: (self::$mutation = new MutationType()); } public static function userMutation() { return self::$userMutation ?: (self::$userMutation = new UserMutationType()); } public static function addressMutation() { return self::$addressMutation ?: (self::$addressMutation = new AddressMutationType()); } ...</span></span></code> </pre><br><h3 id="shag-3-dobavim-kornevoy-tip-v-tochku-vhoda-graphqlcontrollerphp">  Step 3. Add the root type to the entry point of GraphqlController.php </h3><br><pre> <code class="php hljs">... $schema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Schema([ <span class="hljs-string"><span class="hljs-string">'query'</span></span> =&gt; Types::query(), <span class="hljs-string"><span class="hljs-string">'mutation'</span></span> =&gt; Types::mutation(), ]); ...</code> </pre> <br><h3 id="shag-4-testiruem">  Step 4. Testing </h3><br><p>  Let's open our GraphiQL (and in the next tab our newly created client to make sure that the data is changing) and look at the result: </p><br><p>  Request: </p><br><pre> <code class="hljs pgsql">mutation { <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>(id:<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>(firstname:"Stan") } }</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/81e/238/112/81e2381129bfe4fe7b01319ade1ae98a.png" alt="image"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c52/762/592/c52762592c250e00128c9e124668b437.png" alt="image"></p><br><p>  Now we will try to change the address and the user associated with it with one request: </p><br><p>  Request: </p><br><pre> <code class="hljs pgsql">mutation { address(id:<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>(zip: "56844") <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">update</span></span>(firstname:"Michael") } } }</code> </pre> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/982/61f/c2c/98261fc2cf7ede5125f335f1be4ddea2.png" alt="image"></p><br><p>  To see the changes in the address, we change our template a bit: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/712/0f0/7a0/7120f07a08b98f6059c109913aeb04e2.png" alt="image"></p><br><p>  Immediately try to present and compare with how you need to excel in order to crank something like this in a RESTful architecture.  In general, such things, as far as I know, rewrite the concepts of REST, and in GraphQL this is originally incorporated architecturally. </p><br><h2 id="peremennye">  Variables </h2><br><p>  Until we went to the client, we will understand what <a href="http://graphql.org/learn/queries/">variables are in GraphQL</a> .  You will get acquainted with their practical application when used in mutations in the client, but for now do not bother about it, because  initially their benefits are not so noticeable. </p><br><p>  Let's change our mutation using variables a bit: </p><br><p>  Request: </p><br><pre> <code class="hljs ruby">mutation ($id<span class="hljs-symbol"><span class="hljs-symbol">:Int</span></span>, $zip: String, $firstname: String) { address(<span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> $id) { update(<span class="hljs-symbol"><span class="hljs-symbol">zip:</span></span> $zip) user { update(<span class="hljs-symbol"><span class="hljs-symbol">firstname:</span></span> $firstname) } } }</code> </pre> <br><p>  Variables: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"zip"</span></span>: <span class="hljs-string"><span class="hljs-string">"87444"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firstname"</span></span>: <span class="hljs-string"><span class="hljs-string">"Steve"</span></span> }</code> </pre> <br><p>  <em>Note.</em>  <em>Technically, variables come as a separate POST parameter variables.</em> </p><br><p>  Window GraphiQL (the field for entering variables you just need to pull the bottom, yes, you also have it): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/417/87d/24a/41787d24a70b32a82d0792e9c83dc361.png" alt="image"></p><br><p>  It may seem that variables are convenient when the same value is used in several places, but in reality, in practice, this is a rare situation, and no, this is not their main purpose. </p><br><p>  More useful is the ability to immediately validate a field.  If you try to pass an invalid type to a variable and / or if you don‚Äôt pass it at all, in the case where the field is required, the request will not go to the server. </p><br><p>  But the main convenience (I would even say the necessity) of use you will feel in the client. </p><br><h2 id="klient">  Customer </h2><br><h3 id="shag-1-dobavim-mutaciyu-v-modelsuserjs">  Step 1. Add a mutation to models / user.js </h3><br><p>  As you remember, we agreed to store all our GraphQL queries in models (not almost everything, but everything), therefore we will add our new mutation. </p><br><p>  models / user.js: </p><br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">//     //     export const updateAddressAndUserMutation = gql` mutation updateAddressAndUser( $id: Int!, $zip: String, $street: String, $firstname: String, $lastname: String ) { address(id: $id) { update(zip: $zip, street: $street) user { update( firstname: $firstname, lastname: $lastname ) } } } `;</span></span></code> </pre> <br><h3 id="shag-2-komponent">  Step 2. Component </h3><br><p>  To make it more interesting, we will create a new component, at the same time we will look at how the event mechanism works for communication between components (no relation to GraphQL, therefore without enthusiasm). </p><br><p>  Create the / src / update-user-address directory and traditionally add 2 files there: update-user-address.html and update-user-address.js. </p><br><p>  <em>Note.</em>  <em>If you want to name your component somehow differently, keep in mind that there is an unobvious naming requirement.</em>  <em>The fact is that the custom component in the name must contain "-".</em>  <em>Like this.</em> </p><br><p>  /src/update-user-address/update-user-address.js: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PolymerApolloMixin } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'polymer-apollo'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { apolloClient } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../client'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       import { getUserInfoQuery, updateAddressAndUserMutation } from '../models/user'; class UpdateAddressUser extends PolymerApolloMixin({ apolloClient }, Polymer.Element) { static get is() { return 'update-address-user'; } static get properties() { return { user: { type: Object, value: {}, // observer   //      //  //      observer: "_updateProperties", }, //      //      // , ..    //  ,    //   zip: { type: String, value: "" }, street: { type: String, value: "" }, firstname: { type: String, value: "" }, lastname: { type: String, value: "" }, }; } get apollo() { return { getUserInfo: { query: getUserInfoQuery } }; } _updateProperties() { //       //      //     // . //      //     //    // (user = {...})  if (this.user.firstname != undefined) { //     //    this.zip = this.user.addresses[0].zip; this.street = this.user.addresses[0].street; this.firstname = this.user.firstname; this.lastname = this.user.lastname; } } //       // (  ,    //     polymer-apollo // (https://github.com/aruntk/polymer-apollo#mutations) _sendAddressUserMutation() { this.$apollo.mutate({ mutation: updateAddressAndUserMutation, // ,     // ,   variables: { id: 1, zip: this.zip, street: this.street, firstname: this.firstname, lastname: this.lastname, }, }).then((data) =&gt; { //        //    ,  , //   //    //     document.getElementById('view-block').dispatchEvent(new CustomEvent('refetch')); }) } } window.customElements.define(UpdateAddressUser.is, UpdateAddressUser);</span></span></code> </pre> <br><p>  /src/update-user-address/update-user-address.html: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dom-module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"update-address-user"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      (   ) --&gt;</span></span> ZIP Code: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{zip::input}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> Street: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{street::input}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> First Name: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{firstname::input}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> Last Name: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{lastname::input}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--         --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_sendAddressUserMutation"</span></span></span><span class="hljs-tag">&gt;</span></span>Send<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dom-module</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="shag-3-dobavim-event-listener-v-osnovnoy-komponent">  Step 3. Add event listener to the main component </h3><br><p>  So that we can immediately update the data in the neighboring component to display it after the change, add an event listener and a method to update the GraphQL query. </p><br><p>  src / graphql-client-demo-app / graphql-client-demo-app.js: </p><br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">//  eventListener  //   ready() { super.ready(); this.addEventListener('refetch', e =&gt; this._refetch(e)); } ... //      _refetch() { this.$apollo.refetch('getUserInfo'); } ...</span></span></code> </pre> <br><h3 id="shag-4-podklyuchaem-novosozdannyy-komponent">  Step 4. Connect the newly created component </h3><br><p>  index.html: </p><br><pre> <code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"import"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/src/graphql-client-demo-app/graphql-client-demo-app.html"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"import"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/src/update-address-user/update-address-user.html"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bundle.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphql-client-demo-app</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"view-block"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphql-client-demo-app</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">update-address-user</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">update-address-user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  entry.js: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./src/client.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./src/graphql-client-demo-app/graphql-client-demo-app.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./src/update-address-user/update-address-user.js'</span></span>;</code> </pre> <br><h3 id="shag-5-testiruem">  Step 5. Testing </h3><br><p>  Well, for starters, let's put together a webpack (if you still haven't gotten rid of it): </p><br><pre> <code class="bash hljs">$&gt; webpack</code> </pre> <br><p>  Open the browser and get something like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/31c/7a9/69f/31c7a969f522eba978d8ece992b4edf3.png" alt="image"></p><br><p>  Of course, the picture does not allow to prove that the data in the upper part changes immediately after clicking on the Send button, but you should not try it yourself.  By the way, all changes are prudently uploaded to github: <a href="https://github.com/timur560/graphql-client-demo">client</a> and <a href="https://github.com/timur560/graphql-server-demo">server</a> . </p><br><p>  Frankly speaking, this architecture is not at all optimal, since  it is necessary to modify it in such a way that one request is executed and data is pulled to all parts of the interface.  But this is not a GraphQL problem. </p><br><p>  In the next (final) part of the article we will look at how to implement validation in mutations, and finally draw conclusions on the advantages and disadvantages of switching to GraphQL based on the experience gained. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/337046/">https://habr.com/ru/post/337046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337036/index.html">Wolfenstein 3D pixel-by-pixel fill</a></li>
<li><a href="../337038/index.html">JavaScript scopes</a></li>
<li><a href="../337040/index.html">‚ÄúRise of Machinery Learning‚Äù or combine a hobby in Data Science and analyzing the spectra of light bulbs</a></li>
<li><a href="../337042/index.html">How JS Works: Overview of the Engine, Runtime Mechanisms, Call Stack</a></li>
<li><a href="../337044/index.html">We write GraphQL API server on Yii2 with a client on Polymer + Apollo. Part 2. Client</a></li>
<li><a href="../337048/index.html">Sir, your team is not a team</a></li>
<li><a href="../337050/index.html">Nuxt.js: 28 kilobytes good for web developer</a></li>
<li><a href="../337052/index.html">NAKIVO Backup & Replication overview</a></li>
<li><a href="../337054/index.html">Interview - Developer post. From the side of the Employer and the Applicant</a></li>
<li><a href="../337056/index.html">BigDL: In-depth Learning ‚Äî Available to Big Data Users and Data Researchers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>