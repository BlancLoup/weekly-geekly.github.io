<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use of vulcanization for polymer modules</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The project I'm working on now has a widget-like client architecture. Moreover, system widgets can use any library for their implementation, for examp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use of vulcanization for polymer modules</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/4bf/f4b/d1d/4bff4bd1d159429ab2c3ad9b190618c2.png" alt="polymerjs vulcanize" align="left" width="300"><br><br>  The project I'm working on now has a widget-like client architecture.  Moreover, system widgets can use any library for their implementation, for example, ReactJS, PolymerJS, VueJS, d3JS, and others.  Several system widgets are implemented, just like web components based on <a href="https://www.polymer-project.org/">PolymerJS</a> . <br><br>  Therefore, I offer you one of the approaches for optimizing the polymer widgets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <hr><br><h3>  Content: </h3><br>  <a href="https://habr.com/ru/post/333660/">1. Description of the problem</a> <br>  <a href="https://habr.com/ru/post/333660/">2. What difficulties arise?</a> <br>  <a href="https://habr.com/ru/post/333660/">3. How can they be solved?</a> <br>  <a href="https://habr.com/ru/post/333660/">4. Vulcanize-polymer-module library</a> <br>  <a href="https://habr.com/ru/post/333660/">4.1.</a>  <a href="https://habr.com/ru/post/333660/">Structure</a> <br>  <a href="https://habr.com/ru/post/333660/">4.2.</a>  <a href="https://habr.com/ru/post/333660/">Bower.json description</a> <br>  <a href="https://habr.com/ru/post/333660/">4.3.</a>  <a href="https://habr.com/ru/post/333660/">Package.json description</a> <br>  <a href="https://habr.com/ru/post/333660/">4.3.1.</a>  <a href="https://habr.com/ru/post/333660/">Installation Utilities</a> <br>  <a href="https://habr.com/ru/post/333660/">4.3.2.</a>  <a href="https://habr.com/ru/post/333660/">RollupJS Setup</a> <br>  <a href="https://habr.com/ru/post/333660/">4.4.</a>  <a href="https://habr.com/ru/post/333660/">vulcanize-utils.js</a> <br>  <a href="https://habr.com/ru/post/333660/">5. Conclusions</a> <br><a name="habracut"></a><br><a name="1"></a><h4>  1. Description of the problem </h4><br>  One of the main problems of polymer applications is the multiple loading of the components used and all the dependent components, which in turn can consist of auxiliary styles, <a href="https://www.polymer-project.org/1.0/docs/devguide/behaviors">behaviors</a> that can also be loaded additionally.  As a result, the console in the network section will be ‚Äúbackfilled‚Äù with these files.  In view of all this, the first download of such a widget can be quite long, depending on the number of composite web components used. <br><br>  Vulcanization is used in polymer applications for these purposes.  It is implied that this application has an entry point in the form, for example, <i>index.html</i> , in which the main container component is deployed, for example <i>&lt;App /&gt;</i> .  In this file, the polymer core itself and the component file of the <i>&lt;App /&gt;</i> container are connected, and then all the components used are hierarchically connected, which themselves are separate html files.  The process of vulcanization itself consists in ‚Äúgluing‚Äù all the components used and the polymer core into one file, which will ultimately be the entry point for <i>index.html</i> . <br><br><a name="2"></a><h4>  2. What difficulties arise? </h4><br><ol><li>  The first difficulty is that I do not have a polymer-application, but several composite components (let's call them smart components - the Criminal Code), which are wrapped in a system widget, that is, there is no single entry point. </li><li>  The second difficulty is that during the work with the application the page with these widgets may not be called at all, and accordingly none of the polymer components will simply be needed in the current session of work, not to mention the polymer core itself. </li><li>  The third one - one Criminal Code uses one set of atomic ( <a href="https://www.webcomponents.org/collection/PolymerElements/paper-elements">paper-</a> , <a href="https://www.webcomponents.org/collection/PolymerElements/iron-elements">iron-</a> and others) components (let's call them stupid components - GK), and the other - another set.  Moreover, there may be intersections, that is, two different <abbr title="Smart component">CCs</abbr> use the same <abbr title="Stupid component">CC</abbr> . </li></ol><br><a name="3"></a><h4>  3. How can they be solved? </h4><br>  If we consider the first difficulty, I could vulcanize each <abbr title="Smart component">CC</abbr> separately, but then if we take the third problem, duplication of the same HAs is possible, and there will definitely be duplication of the polymer core, if we consider the situation in which at least two <abbr title="Smart component">CCs</abbr> were used in one session .  Therefore, another solution is needed. <br><br>  If we consider the second complexity, we need to make sure that the polymer core and the <abbr title="Stupid component">GCs are</abbr> loaded only once, at the first access to one of the <abbr title="Smart component">Criminal Code</abbr> , and at the time of the second, there is no need to reload everything, but only dynamically load the <abbr title="Smart component">Criminal Code</abbr> itself. <br>  If we consider the third difficulty, then we need to make a list of all the used stupid components in the smart, which we will eventually vulcanize together with the polymer itself. <br><br><a name="4"></a><h4>  4. Vulcanize-polymer-module library </h4><br>  All the above theses I designed in the form of a library vulcanize-polymer-module. <br>  I want to tell you more about it. <br><br><a name="41"></a><h5>  4.1.  Structure </h5><br> <code>vulcanize-polymer-module/ <br> ‚îú‚îÄ‚îÄ imports.html <br> ‚îú‚îÄ‚îÄ vulcanize-utils.js <br> ‚îú‚îÄ‚îÄ rollup.config.js <br> ‚îú‚îÄ‚îÄ bower.json <br> ‚îî‚îÄ‚îÄ package.json</code> <br> <br><a name="42"></a><h5>  4.2.  Bower.json description </h5><br>  In it, we describe all the <abbr title="Stupid component">HAs</abbr> that we need as dependencies, including the polymer itself. <br><br>  For example, the <i>dependencies</i> section might look like this: <br><br><div class="spoiler">  <b class="spoiler_title">dependencies</b> <div class="spoiler_text"><pre> "dependencies": {
     "polymer": "Polymer / polymer # ^ 2.0.0",
     "polymer-redux": "^ 1.0.0",
     "iron-flex-layout": "PolymerElements / iron-flex-layout # ^ 2.0.0",
     "paper-button": "PolymerElements / paper-button # ^ 2.0.0",
     "paper-badge": "PolymerElements / paper-badge # ^ 2.0.0",
     "paper-icon-button": "PolymerElements / paper-icon-button # ^ 2.0.0",
     "paper-input": "PolymerElements / paper-input # ^ 2.0.0",
     "paper-item": "PolymerElements / paper-item # ^ 2.0.0",
     "paper-checkbox": "PolymerElements / paper-checkbox # ^ 2.0.0",
     "paper-tabs": "PolymerElements / paper-tabs # ^ 2.0.0",
     "paper-listbox": "PolymerElements / paper-listbox # ^ 2.0.0",
     "iron-a11y-keys": "PolymerElements / iron-a11y-keys # ^ 2.0.0",
     "iron-list": "PolymerElements / iron-list # ^ 2.0.0",
     "iron-icons": "PolymerElements / iron-icons # ^ 2.0.0",
     "paper-progress": "PolymerElements / paper-progress # ^ 2.0.0",
     "vaadin-split-layout": "vaadin / vaadin-split-layout # ^ 2.0.0",
     "vaadin-grid": "^ 3.0.0",
     "iron-pages": "PolymerElements / iron-pages # ^ 2.0.0",
     "iron-collapse": "PolymerElements / iron-collapse # ^ 2.0.0",
     "iron-overlay-behavior": "PolymerElements / iron-overlay-behavior # ^ 2.0.0",
     "vaadin-context-menu": "^ 3.0.0"
   }
</pre><br><br><cut></cut><br></div></div><br>  Since I use redux with polymer, I included the <a href="https://github.com/tur-nr/polymer-redux">polymer-redux library</a> . <br><br><a name="43"></a><h5>  4.3.  Package.json description </h5><br>  It contains the dependencies we need to build, in particular <a href="https://habrahabr.ru/post/331412/">RollupJS</a> , which is used for intermediate cleaning of the output file code.  The commands used for vulcanization are also described, let's look at them in more detail. <br><br><div class="spoiler">  <b class="spoiler_title">scripts</b> <div class="spoiler_text"><pre>  "scripts": {
     "build": "rollup -c",
     "vulcanize": "vulcanize imports.html --inline-scripts --inline-css --strip-comments",
     "run-vulcanize": "npm run vulcanize&gt; imports.vulcanize.html",
     "vulcanized": "vulcanize imports.html --inline-scripts --inline-css --strip-comments | crisper --html imports.vulcanized.html --js imports.vulcanized.js&gt; imports.vulcanized.html",
     "html-minifier": "html-minifier imports.vulcanized.html --remove-optional-tags --collapse-whitespace --preserve-line-breaks -o imports.vulcanized.min.html",
     "build-all": "npm run vulcanized &amp;&amp; npm run build &amp;&amp; npm run html-minifier"
   } </pre><br></div></div><br>  Commands, in order and priority of their use: <br><ul><li>  <b><i>build-all</i></b> - the main team, which starts the entire process of vulcanization. </li><li>  <b><i>vulcanized</i></b> - performs vulcanization itself, that is, combining all the components and the core into one file, then splits the entire assembly into .js and .html files separately. (The <a href="https://www.npmjs.com/package/vulcanize">vulcanize</a> and <a href="https://github.com/PolymerLabs/crisper">crisper</a> utility is <a href="https://github.com/PolymerLabs/crisper">used</a> ) </li><li>  <b><i>build</i></b> - <a href="https://habrahabr.ru/post/331412/">clears</a> js file code from comments. (used by <a href="https://habrahabr.ru/post/331412/">RollupJS</a> ) </li><li>  <b><i>html-minifier</i></b> - html-file minification. ( <a href="https://www.npmjs.com/package/html-minifier">html-minifier is used</a> ) </li></ul><br><a name="431"></a><h6>  4.3.1.  Installation Utilities </h6><br>  As you can see there are many additional utilities that we need to pre-install into the system. <br><br><div class="spoiler">  <b class="spoiler_title">Installation Utilities</b> <div class="spoiler_text"><pre> <code class="bash hljs">npm install -g vulcanize npm install -g crisper npm install -g html-minifier</code> </pre> <br></div></div><br><a name="432"></a><h6>  4.3.2.  RollupJS Setup </h6><br>  Since rollup is used only for cleaning js-code, I use only one plugin for it - <a href="https://github.com/aMarCruz/rollup-plugin-cleanup">rollup-plugin-cleanup</a> .  The <a href="https://github.com/jkuri/rollup-plugin-progress">rollup-plugin-progress plugin is</a> used to visualize the build process. <br><br><div class="spoiler">  <b class="spoiler_title">rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> progress <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-progress'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cleanup <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-cleanup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'imports.vulcanized.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dest</span></span>: <span class="hljs-string"><span class="hljs-string">'imports.vulcanized.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ cleanup(), progress({ }), ] };</code> </pre> <br></div></div><br><a name="44"></a><h5>  4.4.  vulcanize-utils.js </h5><br>  To solve the second requirement, the utilitarian <i>loadVulcanized</i> method was written, which loads the <i>CM</i> , but before that loads the vulcanized file, and does it once and in the cases of the repeated call, loads only the <abbr title="Smart component">CM</abbr> itself. <br>  Let us consider its parameters in more detail. <br><br><div class="spoiler">  <b class="spoiler_title">loadVulcanized = function (url, urlVulcanized, controller, html, store)</b> <div class="spoiler_text"><ul><li>  <i><b>url</b></i> - the path to the smart component.  It is required. </li><li>  <i><b>urlVulcanized - path</b></i> to the vulcanized assembly.  The default is the path to this build - <i>../vulcanize-polymer-module/imports.vulcanized.min.html</i> </li><li>  <i><b>controller</b></i> - in my case it is the system widget controller.  Optional. </li><li>  <i><b>html</b></i> is the html object of the smart component.  It makes sense if the controller is set. </li><li>  <i><b>store</b></i> - redux store.  Optional. </li></ul><br></div></div><br><a name="5"></a><h4>  5. Conclusions </h4><br>  Of course, you can use <a href="https://www.polymer-project.org/2.0/docs/tools/polymer-cli-commands">polymer-cli</a> with the <i>build</i> parameter, but when building with it, it is assumed that the polymer-project is building, and since we use the components in more than one <i>&lt;App /&gt;</i> container, we will have to assemble each CM separately and the build files have duplication of the polymer core and the compound <abbr title="Stupid component">HAs</abbr> .  Therefore, the approach described in the article has sufficient efficiency in systems using several UI libraries together, due to the single entry point for all CCs based on polymer. <br><br>  One of the possible disadvantages can be considered as the redundancy of the civil code in the vulcanized file, since it contains all the civil code of all the criminal code used in the system, but not all the criminal code can be used during the work session, which means that not all the civil code will be used in downloaded vulcanized file. <br><br>  Also, as a slight inconvenience, you can consider the fact that after adding a new component, you need to restart the assembly, then update the repository (push), and other users should update this library via bower update. <br><br>  Despite all this, this library solves its problem in this project, and therefore it may be useful to someone else. <br><br>  So <a href="https://github.com/kolesoffac/vulcanize-polymer-module">fork</a> , welcome. </div><p>Source: <a href="https://habr.com/ru/post/333660/">https://habr.com/ru/post/333660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333650/index.html">From repository to CI / CD infrastructure in production for the week</a></li>
<li><a href="../333652/index.html">5D market. Projection systems</a></li>
<li><a href="../333654/index.html">Work-stealing scheduler in Go</a></li>
<li><a href="../333656/index.html">XBRL: just about the complex - Chapter 2. What is XBRL?</a></li>
<li><a href="../333658/index.html">Cost of data storage: ‚Äúzero-sum game‚Äù</a></li>
<li><a href="../333662/index.html">DoT.js template engine improvements</a></li>
<li><a href="../333664/index.html">Taming Multimedia with ffmpeg</a></li>
<li><a href="../333668/index.html">[Habr - not a complaint book] How I was deceived by contacting the designer Ramin Nasibov (Berlin, Germany)</a></li>
<li><a href="../333670/index.html">Virtualization and modernization in O & G: the story of one project</a></li>
<li><a href="../333674/index.html">Tale of a project manager at a bank and how he solved problems with a remote contractor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>