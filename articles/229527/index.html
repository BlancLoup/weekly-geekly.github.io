<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking PIN code of bank cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In connection with the appearance of the article ‚ÄúTravels of a banking transaction‚Äù , in which questions about the PIN verification mechanism began to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking PIN code of bank cards</h1><div class="post__text post__text-html js-mediator-article">  In connection with the appearance of the article <a href="http://habrahabr.ru/post/229393/">‚ÄúTravels of a banking transaction‚Äù</a> , in which questions about the PIN verification mechanism began to appear, I would like to clarify this issue somewhat.  This article will consider only the issue of checking a so-called.  online PIN, i.e.  PIN, which is entered on the terminal and is transmitted for further verification to the system that authorizes the transaction. <br><br>  Before proceeding directly to the question of scrolling a PIN of a card, let us dwell on some theoretical questions. <br><a name="habracut"></a><br><h4>  Applied Cryptography </h4><br><h5>  DES algorithm </h5><br>  At the moment, the basic encryption algorithm for all actions with bank cards is the DES algorithm (and not 3DES, which is used only for encryption operations, mainly the transport layer).  Without going into the terminology and classification of encryption algorithms, just say that this is a block encryption algorithm with a block size of 8 bytes and a key of 56 bits (7 bytes).  In practice, it is customary to represent the DES key as a block of 8 bytes, where in each byte the highest 7 bits are significant, and the last bit is insignificant.  It can be used to control the integrity of the key (more on that later). <br><br>  Since, currently, a 56-bit key is insufficient from a security point of view, instead of the DES algorithm for encryption, use the <a href="http://ru.wikipedia.org/wiki/Triple_DES">3DES algorithm</a> in EDE mode (hereinafter, the 3DES designation will mean the use of the EDE scheme).  Usually, the 3DES algorithm with a double-length key (112 bits, 16 bytes) is used in the banking environment, in which the same key is used in the first and third steps (see the <a href="http://ru.wikipedia.org/wiki/Triple_DES">description of the</a> algorithm). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  PIN verification algorithms </h5><br>  At the moment, basically, the following 2 PIN verification algorithms are used: Visa PVV and IBM 3624 PIN offset. <br><br><h6>  Visa PVV </h6><br>  This algorithm was originally developed by the Visa payment system, but is currently the recommended PIN verification algorithm for both Visa and MasterCard.  This algorithm is based on the PINV value (PIN verification value), which is a cryptogram derived from the following values: <br><br><ul><li>  Card number (hereinafter PAN) </li><li>  PIN verification key index (PIN verification key, further, PVKI) </li><li>  PIN verification key (PIN verification key, further, PVK) </li><li>  PIN card code itself </li></ul><br>  To obtain a PVV, a block is formed from PAN (last 11 digits, except for the control number of the card), PVKI, PIN (strictly, the first 4 digits), which is encrypted using PVK, then a 4-digit is extracted from it using a special function the number that is the PVV value [1].  This PVV value is a reference for verifying the PIN code.  Those.  when receiving an operation with the entered PIN to check it on the basis of PAN, PVKI, PVK, a new PVV value is generated and compared with the reference PVV for the card.  If the values ‚Äã‚Äãmatch, then the PIN is considered valid, if they do not match, it is incorrect. <br><br>  The features of this algorithm include the following "limitations": <br><ul><li>  Principal impossibility of recovering PIN from PVV value </li><li>  Using a PIN code is strictly 4 digits </li></ul><br><br><h6>  IBM 3624 PIN offset </h6><br>  This algorithm was originally developed by IBM for use in IBM 3624 ATMs. How it was planned to use it, history is silent, and the author does not know the article, but in this case, it does not matter.  Currently, this algorithm is considered obsolete, but is used quite successfully for several reasons: <br><br><ul><li>  Card systems of the ‚Äúold‚Äù regions (Western Europe, North America) are quite conservative and, in many respects, work on ‚Äúsufficient‚Äù old systems, which suits them </li><li>  This algorithm allows you to restore the PIN code value from the verification value (see below), which may be.  very useful under certain conditions </li></ul><br><br>  This algorithm is based on the PIN offset value (PIN verification value), which is a cryptogram derived from the following values: <br><br><ul><li>  The reference value (Validation data, further VD) - some value (usually - part of the card number, but this is not necessary) </li><li>  Decimalization table (Decimalization table, further DT) </li><li>  PIN verification key (PIN verification key, further, PVK) </li><li>  PIN card code itself </li></ul><br>  For simplicity, the further description under the PIN verification key in the case of the IBM 3624 PIN offset method will be a combination of the PVK key and the DT decimalization table value. <br>  To obtain the PIN offset, the control value VD is encrypted using the PVK key, after which a block of 16 decimal digits is obtained from the obtained value using the DT decimalization table. <br>  The first N digits are taken from the received block, where N is the PIN length (the IBM 3624 method allows you to check the PIN with a length of up to 16 digits), then the corresponding digit of the received block is subtracted from each PIN of the modulo 10 module.  The resulting value will be the PIN offset value. <br><br><h5>  HSM </h5><br>  HSM - hardware security module, a hardware-software complex designed to perform cryptographic operations in a secure environment.  The HSM itself must be protected to prevent unauthorized access to the data stored in it.  Its functions include performing various cryptographic checks, including checking the card, PIN, cryptographic signature of messages ( <a href="http://ru.wikipedia.org/wiki/Message_authentication_code">MAC</a> ), and various encryption operations in such a way as to prevent access to meaningful information (keys, PIN code values).  It is worth explaining here that when using HSM, the key value itself, in the general case, in open form (ie, in the form, one for performing operations in accordance with the DES / 3DES algorithm) is present only inside the HSM at the time of performing this operation.  How this is achieved depends on the specific HSM.  For the most popular HSM card systems (SafeNet and Thales HSM), 2 mechanisms are used: <br><br><ul><li>  Key encryption under the so-called.  Master key HSM in various versions.  In this case, the key value itself is stored in encrypted form on an external medium (usually in the processing system) and transmitted to the HSM during the operation.  In this case, when performing an HSM operation, it first decrypts the key using the Master Key, after which it performs, directly, the operation that was requested </li><li>  Key storage in a secure HSM internal storage.  In this case, usually, the key identifier is supplied to the input, through which the HSM retrieves it from the internal storage. </li></ul><br>  At the same time, the very principle of performing an operation on HSM does not depend on which method of key storage is used. <br>  Everywhere below, if this is not explicitly stated, we will assume that the key is transmitted in a protected HSM form (ie, encrypted under the HSM Master Key or as an identifier). <br><br><h4>  PIN check </h4><br><h5>  Terminology </h5><br>  To simplify the further description, we introduce some terms: <br><ul><li>  PIN block - the value of the PIN code of the card, in some special way packaged in a block of 8 bytes.  It should be clarified that no encryption is used in this process.  Packing methods, in this case, are different, but it does not matter. </li><li>  Encrypted PIN block - the PIN block value, encrypted using the DES / 3DES algorithm using a key (terminal key, bank, payment network, etc.), specifically allocated for encrypting the PIN block. </li><li>  The PIN verification value is PVV or PIN offset depending on which PIN verification method is used. </li><li>  Additional PIN verification data - data, except PIN and PIN verification value, necessary for PIN verification in accordance with Visa PVV / IBM 3624 PIN offset algorithms in accordance with the list given in the description of the algorithms (see above). </li></ul><br><br><h5>  Payment system requirements </h5><br>  In the PIN verification part, you can specify the following: <br><ul><li>  Open PIN and PIN block values ‚Äã‚Äãshould not be transferred, stored or processed in any way outside specially allocated software and hardware systems (HSM on the side of processing systems or EPP and some other scary abbreviations on the side of terminal devices (ATMs, POS terminals, etc.)). </li><li>  The encrypted PIN block should not be stored after the completion of the operation in systems responsible for online / offline processing of transactions (there are also systems responsible for issuing the cards themselves, this requirement does not apply to them). </li></ul><br><br><h5>  PIN check </h5><br>  As we have already decided, to verify the PIN, we need the following data: <br><ul><li>  The PIN itself, which we will check </li><li>  PIN verification value </li><li>  Additional PIN verification details </li></ul><br>  With PIN, everything is quite simple.  As already mentioned above, we cannot get an open PIN value under any circumstances.  Thus, we are left with only an encrypted PIN block.  In addition to it, we need a key to decrypt it.  Name this PPK key (PIN protection key, term taken from SafeNet HSM documentation). <br><br>  Next, you need to decide on the PIN verification value and additional data. <br><br>  The first option is to store the test value on the magnetic stripe of the card after the Service Code field.  A modified version of ISO 7813, indicating where the PVV is stored, can be found <a href="http://www.gae.ucm.es/~padilla/extrawork/tracks.html">here</a> .  According to the description of the track format, it is worth adding that the 5-character PVV value means the following sequence: 1 PVKI symbol and 4 PVV symbols, and for PIN offset - the PIN offset value for a 5-digit PIN.  If the PIN is of a length other than 5 digits, then the size of the PIN offset, respectively, will change.  What are the advantages of this method.  Certainly - the ability to check the PIN for anyone who will have the necessary keys for verification.  Here it is worth noting that when you launch a new card product into the payment network, usually, the keys that the card is issued are transferred to.  Thus, when using this method, the PIN verification option appears both on the card issuer and on the payment network.  The disadvantages of this method include the fact that this option makes the PIN card static until the card is reissued. <br><br>  The second option is to store the check value in some storage, usually the database of the system responsible for performing checks when authorizing the card.  In this case, when checking the PIN, it is necessary to extract the test value from this store, and only then, to check using this value.  As a result, when using this method, it is impossible to complete the PIN check in the external system (in the same payment system) and it can be.  performed only on the system that has access to the storage of test values.  However, such a system allows you to change the PIN code of the card without any costs for changing the plastic (what it is for, what needs to be done and what after that there may be problems, I will not describe, because it is beyond the scope of this articles). <br><br>  Regardless of how and by whom (the card issuer or the payment network) all the necessary information was received, the PIN check itself is performed on the HSM, which receives a PPK key in a protected form, the PIN check key in a protected form, an encrypted PIN block, PIN verification value and additional verification data, in response to which only the verification result is returned: valid PIN, incorrect PIN, other error.  Those.  During the verification process, the system responsible for authorization does not touch the open value of the PIN code itself. <br><br>  Materials used: <br>  [1] Visa Payment Technology Standards Manual, 5 years ago, on the Internet, it was possible to find the version of this document for 2007, now, with fluent machinations, only the version from 2004 is available. </div><p>Source: <a href="https://habr.com/ru/post/229527/">https://habr.com/ru/post/229527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229517/index.html">Ciklum Speakers' Corner ‚ÄúBrave Flat World‚Äù, July 15, in the Kiev office of Ciklum</a></li>
<li><a href="../229519/index.html">Chronicle of space super heavyweight. Part 3. "Marstodont" new era</a></li>
<li><a href="../229521/index.html">Bad and good news about the withdrawal of money from Google AdSense</a></li>
<li><a href="../229523/index.html">Checking the tariff and costs for mobile</a></li>
<li><a href="../229525/index.html">Cisco Identity Services Engine</a></li>
<li><a href="../229529/index.html">Sleep REM-phase modulator</a></li>
<li><a href="../229535/index.html">Conversion of a wireless USB Wi-Fi adapter TP-LINK TL-WN722N to Philips PTA01 adapter for Philips 55PFL7606H TV and others</a></li>
<li><a href="../229539/index.html">Get Zabbix statistics from Kyocera devices</a></li>
<li><a href="../229541/index.html">I will study at the Computer Science Center</a></li>
<li><a href="../229543/index.html">How to create and earn SaaS (Part 10 / Business Model Metrics)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>