<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From Google Wave to Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In May 2009, Google Wave (GW) was announced, after a few months we received invites and began to study it. In GW, as in GoogleDocs, there is the possi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From Google Wave to Node.js</h1><div class="post__text post__text-html js-mediator-article">  In May 2009, Google Wave (GW) was announced, after a few months we received invites and began to study it.  In GW, as in GoogleDocs, there is the possibility of co-editing text using <a href="http://en.wikipedia.org/wiki/Operational_transformation">OT</a> technology.  There are also bonuses: you can collapse sections of a document into a structure, add gadgets and robots.  We discussed our current projects in GW, in general, I liked the tool, and the abundance of inconvenience gave rise to many ideas for expanding the functionality and improving the interface.  The shortage of shortcuts for folding all sections of the document was particularly acute.  Also, the idea of ‚Äã‚Äãsetting each task in the context to which it relates was often discussed. <br><img src="https://habrastorage.org/storage1/abb84825/575f69c7/56cb5619/9098eee2.png"><br><a name="habracut"></a><br>  Vladimir Semenov, our web-developer, began to investigate the possibility of contextual setting of tasks and processing of <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2580%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B2%25D1%258B%25D1%2580%25D0%25B0%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">regular expressions by the</a> robot.  The idea of ‚Äã‚Äãexpansion, providing the possibility of folding sections of discussions on shortcuts, Vladimir told classmate from <a href="http://www.tusur.ru/">TUSUR</a> , Sergey Khegayu.  Sergey became interested in this idea and began to explore it in his free time from studies and main work. <br><br>  Two months later, an extension to the Google Chrome browser appeared and a robot that processed tasks in context.  Now the architecture of our tools based on Google Wave looks like the one shown above. <br><br><h1>  Life in the scheme </h1>  Consider the scheme of interaction of our system with the user. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The tasks in the wave are associated with the task list in the gadget as follows: <br>  1. The user writes a regular expression in the text (for example, the words ‚Äútask‚Äù or ‚Äúexport‚Äù in brackets). <br>  2. The robot finds this expression in the text. <br>  3. The robot enters the necessary data into the database and generates a link. <br>  4. TaskGadget sees that a new task has appeared, and the next time it opens it shows it in its list. <br><br>  It is necessary that the window with the form opens next to the regular expression directly in the wave, and not on a separate page or tab.  This is implemented as: <br>  1. The user clicks the link generated by the robot in step 3 of the previous description. <br>  2. Clicking on the link is intercepted by the extension. <br>  3. The extension forms an iframe (empty window) in which this link is specified as an address (src). <br>  4. The browser itself receives the form from our database and loads it into the iframe. <br>  There is also interaction with GoogleCalendar, about it further. <br><br>  Photos of the organizers of the work of robots: <br><br><img src="https://habrastorage.org/storage1/af44987f/c8f1e1df/8d63670d/571edb9b.png"><br><br>  <i>Vladimir Semenov, Sergey Khegay</i> <br><br><h1>  Dispute "GUI vs.  Cmd and other interfaces </h1>  The eternal question "Which is more convenient: a text command or a graphical interface?".  We have long been holivarili about how it is more convenient to organize user interaction with the tools "tasks in the text", "search by waves" and "export to HTML."  There were two options for development: <br>  - Windows with GUI-forms: so it is more understandable to new users and does not require memorizing the parameters of the command (for example, the date format); <br>  - entering commands directly into the text of the wave: this will increase the speed at which the robot receives the command, and everyone knows that geeks are ready to go into details to save time. <br><br>  The first version of the robot perceived only text commands.  Later, when we decided to switch to GUI-forms, we decided not to refuse text commands.  As a result, the tools work in this and that way. <br><br><img src="https://habrastorage.org/storage1/b52bfcd4/9827cdbf/62e96587/14411c50.png"><br><br>  <i>GUI vs.</i>  <i>CMD for task interface</i> <br><br>  The difference between how ordinary and geek users set tasks: <br>  - accustomed to window forms, begins with what the ‚Äútask‚Äù writes in parentheses.  The robot processes this word and replaces it with a link.  Then the user clicks the link and in the appeared window clarifies the task parameters. <br>  - A user who is accustomed to the command line immediately writes "(task Vasya)" in the text of the document.  That is, it indicates all the main parameters of the task: performer, date, (sometimes other parameters).  This completes the formulation of the problem. <br><br><h1>  To-do list in the wave </h1>  The text of the problem is often just a couple of words.  Almost always, in order to understand a task, it is necessary to realize some part of the context to which it relates.  The main idea of ‚Äã‚ÄãTaskGadget is to provide a transition from the task list to the context: <br><br><img src="https://habrastorage.org/storage1/120910d8/3f4640b4/f6346119/c811eb2c.png"><br><br>  <i>TaskGadget.</i>  <i>Move from task list to context</i> <br><br>  By default, tasks are ordered by date.  Each task in the gadget contains a link to the message in which it was set.  When you click on a task, a discussion opens next to the gadget - task context. <br><br><h1>  Interface to export articles from the wave </h1>  First, we implemented the export in the simplest way: only one selected message was exported from the wave.  After the experiments, it became clear how to make a structure in the article.  In this case, for each message (in GW, messages are called blips) the publication is configured separately.  This is what the article looks like in a collapsed form: <br><br><img src="https://habrastorage.org/storage1/adb47552/5f1bc503/6ae477f4/22e973ac.png"><br><br>  <i>An example of the structure of the article in the wave</i> <br><br>  Each message can be included in the export or excluded from it.  To do this, at the beginning of each message the robot puts down the icons: "+" or "-", denoting the inclusion of the blip in the export. <br><br><img src="https://habrastorage.org/storage1/49822f9a/04a50dd3/ee508f94/507eb980.png"><br><img src="https://habrastorage.org/storage1/e3614ad3/91484fed/cfcf0f3d/d013c6b0.png"><br><br>  <i>Examples of posts.</i>  <i>The top with a "+" is included in the export.</i>  <i>Bottom with a "-" is not included in the export.</i> <br><br>  Each "+" or "-" is a link, when clicked, you can change the export status of the blip.  To do this, use these GUI forms: <br><br><img src="https://habrastorage.org/storage1/f988b48b/5138c79a/bcc05bc6/caaf0a06.png"><br><br>  <i>Forms for setting up export</i> <br><br><h1>  Google chrome extension </h1>  The <a href="https://chrome.google.com/webstore/detail/ndmnfdpnhinkgjolfjkpkjdcaghainck">WaveShortCuts extension</a> performs actions that we lacked in the GW client.  Here is a list of them: <br><br><img src="https://habrastorage.org/storage1/73e2af42/58c479d3/11ac51ed/f9650a3e.jpg"><br><br>  <i>Shortcuts WaveShortCuts</i> <br><br>  In our work, we often use two shortcuts highlighted in this picture.  Using them, you can select a sentence or a fragment of text on any site, press Alt + C, and then insert this fragment into the wave <b>immediately as a link to the site</b> from which it was taken. <br><br>  When you click the shortcut, the extension generates a command for the GW client.  Accordingly, the extension needs the right to send commands to GW on behalf of the user.  GW is wary of this situation, and users are often afraid of such a notice (it appears when installing our extension): <br><br><img src="https://habrastorage.org/storage1/82e5273d/12827914/2e657571/f481633b.png"><br><br>  <i>Request access to your Google account</i> <br><br>  For the function of inserting links extension requires access on behalf of the user to the sites that he visits.  Therefore, there is also a frightening message: <br><br><img src="https://habrastorage.org/storage1/041eb66e/e051a991/58549586/07f96ec7.jpg"><br><br>  Dear developers, when developing extensions, avoid such warnings whenever possible :) <br><br><h1>  We spread the extension on the Chrome WebStore </h1>  In the work on reducing the entry threshold for new users, it turned out that one of the bottlenecks is the installation of an extension.  Many obscure links and buttons confused new users.  Therefore, we decided to move from Google's code-hosting to WebStore. <br><br>  The difficult quest that awaited us is reflected in detail in <a href="https://wave.google.com/wave/%3Fnouacheck">this wave</a> .  If we collapse all the blips in it, we see the following structure: <br><br><img src="https://habrastorage.org/storage1/13630bdf/ccbc110b/b4ef1414/313482ae.png"><br><br>  <i>Sections of the wave in which we discuss the placement of WaveShortCuts on the WebStore</i> <br><br><h1>  Setting up notifications and working with Google Calendar </h1>  For normal work with tasks, it was necessary to configure all kinds of notifications and synchronization with mobile devices. <br><br>  Notifications to Jaber are implemented by adding our robot to our contacts, and SMS notifications and mobile synchronization we implemented via the Google calendar, because SMS is free from there, and it is more convenient to work with tasks through the calendar in the phone. <br><br><img src="https://habrastorage.org/storage1/4e47c0fb/63ba5268/67b19a4f/1c64344d.jpg"><br><br>  <i>Screenshot from the <a href="http://www.projectvolna.com/ru/my/task_settings/%3Ffrom%3Dhb%2Barch">Notification Settings</a> page</i> <br><br><h1>  Connect Google Calendar </h1>  At first we wanted to link the robot with the user's personal calendar.  But then a synchronization problem arises: if the user changes or deletes the task in his personal calendar, then these changes need to be processed and recorded into a wave.  Technically, such synchronization is quite difficult to do. <br><br>  We chose another option: the robot creates a calendar and shares it with the user. <br><br>  And we can not share the calendar if the user has not activated the GoogleCalendar service.  That is why in the <a href="http://www.projectvolna.com/ru/my/task_settings/%3Ffrom%3Dhb%2Barch">calendar activation</a> interface, the screenshot of which is higher, we could not avoid the moveton: warning words and exclamation marks. <br><br>  As a result, having learned a lot, we still fused all the tasks of synchronization with Google mobile.  There was still a problem with the fact that an ordinary user is very difficult to figure out how to set it all up.  We reworked Google‚Äôs instructions and wrote our <a href="http://www.projectvolna.com/ru/help/calendar/%3Ffrom%3Dhb%2Barch">instructions for setting up a Google calendar on mobile devices</a> . <br><br><h1>  A few words about the future architecture of Platform Odessa </h1>  That wonderful thing in GW has not been developing for a long time, rather, it is rather a bunch.  This year we realized that we need to develop this service.  To do this, find an alternative to GW.  Google has transferred all the source code and knowledge of the GW project to the Apache foundation.  Apache launched <a href="http://incubator.apache.org/projects/wave.html">WiaB</a> project - Wave in a Box.  Now there is an alpha version of the product.  We began to study the state of the project and came to the following conclusions: <br>  - it is not clear who and in what direction is developing WiaB now; <br>  - WiaB is bad for scaling; <br>  - WiaB architecture does not fully support our business logic; <br>  - a big problem with the documentation, which is more likely than there is; <br>  - big coherence of server and client code; <br>  - in fact, the biggest plus in WiaB at the moment is a well-implemented OT editor, otherwise there are more minuses than pluses; <br>  - and, finally, we have not so many java-developers. <br><br>  We asked ourselves: can we develop our own platform?  One of the challenges OT has already been implemented in <a href="http://sharejs.org/">ShareJS</a> , in addition, we have ready-made solutions for scaling.  Since clients constantly keep connection to the server, for effective resource consumption it is necessary to use server-based solutions that allow cheap to maintain many long-lived connections.  Asynchronous (non-blocking) servers are great for this task.  For ourselves, we have concluded that fundamentally unsolvable architectural tasks are not here. <br><br>  As a result, we decided to do the <a href="http://rizzoma.com/">service on our own platform</a> - <strong>Rizzoma.com</strong> .  Thinking about what specific technologies are needed for each module, we came to this vision of architecture: <br><br><img src="https://habrastorage.org/storage1/d0b31797/f365ea44/112e8d06/273eaf69.png"><br><br>  <i>Slide from <a href="http://prezi.com/ybkn1nidgfpr/projectvolna-user-path/">our presentation at OdessaCamp</a></i> <br><br>  From non-blocking servers there is Node.js or Tornado.  The choice fell on Node.js, since: <br>  - ShareJS written for Node.js; <br>  - a part of the code can be used both on the server and on the client.  And do not switch attention between different languages; <br>  - The platform is actively developing and there are a lot of libraries.  For example, Yandex has released its framework. <br>  CoffeeScript was chosen as a development language due to the presence of syntactic sugar compared to simple JavaScript. <br><br>  The database selected CouchDB, because: <br>  - the database is document-oriented, which is better suited to our business logic: a lot of things are hierarchically nested in each other.  And this is easier to implement in document-oriented databases; <br>  - Thanks to its document-centric nature, CouchDB requires fewer links between entries, which will facilitate scalability in a bright future. <br><br>  In order not to write gadgets once again, we will support the standards OpenSocial and all the gadgets that worked in Google Wave (Orkut, MySpace, etc.) will work on the Odessa platform. <br><br>  We also plan to implement <a href="http://www.waveprotocol.org/federation">federation</a> so that our server can interact (exchange waves) with WiaB, Novel Vibe and other servers that will support it. <br><br>  Search engine use Sphinx.  To simplifyly describe this scheme of work, you can do this: if you change the data in ouchDB, the changes will fall into an index that will already be searched.  All search queries will be executed by Sphinx, taking into account tags, time, access levels, etc.  Due to this, we get high speed of execution of queries and minimal load on servers from the database. </div><p>Source: <a href="https://habr.com/ru/post/132208/">https://habr.com/ru/post/132208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132203/index.html">New beta Opera 11.60 for developers</a></li>
<li><a href="../132204/index.html">Novosibirsk provider Novotelecom laid out data on users</a></li>
<li><a href="../132205/index.html">Yac 2011: Technical Report</a></li>
<li><a href="../132206/index.html">Our people at the Mass Challenge</a></li>
<li><a href="../132207/index.html">The United States and Japan launched a high-speed trans-Pacific network</a></li>
<li><a href="../132209/index.html">Adobe stops developing mobile Flash Player</a></li>
<li><a href="../132211/index.html">Symfony2. Pitfalls caching</a></li>
<li><a href="../132212/index.html">Adobe will stop developing Flash for mobile devices.</a></li>
<li><a href="../132214/index.html">Asimo just got better</a></li>
<li><a href="../132216/index.html">A couple of news about the working group on the preparation of proposals for the conditions of the competition for the provision of communication services of LTE standard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>