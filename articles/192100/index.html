<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developer iOS Notes: Sharing Experience, Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers Habr! 
 This article is the second part of the series "Notes iOS developer." 

 Content: 


1. Part 1: Working with Files; Templat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developer iOS Notes: Sharing Experience, Part 2</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1f/e4d/cb6/f1fe4dcb643eb847e2c72032d777b6c3.gif"></div><br>  Hello, dear readers Habr! <br>  This article is the second part of the series "Notes iOS developer." <br><br>  Content: <br><ol><li>  <a href="http://habrahabr.ru/post/192062/">Part 1: Working with Files;</a>  <a href="http://habrahabr.ru/post/192062/">Template Singleton;</a>  <a href="http://habrahabr.ru/post/192062/">Work with Audio;</a>  <a href="http://habrahabr.ru/post/192062/">Work with Video;</a>  <a href="http://habrahabr.ru/post/192062/">In-app purchases</a> </li><li>  <a href="http://habrahabr.ru/post/192100/">Part 2: Own popups (Popups);</a>  <a href="http://habrahabr.ru/post/192100/">How to use Modal Segue in the Navigation Controller;</a>  <a href="http://habrahabr.ru/post/192100/">Core Graphics;</a>  <a href="http://habrahabr.ru/post/192100/">Work with UIWebView and ScrollView</a> </li><li>  Part 3: Life without Autolayout;  Splash Screen;  Work with device orientation in iOS 6+;  Shifting the contents of a UITextField </li><li>  Part 4: Google Analytics;  Push Notifications;  PSPDFKit;  Login to the app via Facebook;  Tell friends - Facebook, Twitter, Email </li><li>  Part 5: Core Data;  UITableView and UICollectionView </li></ol><br>  We will deal with customizable pop-up windows at the end of the article, as this is a rather extensive topic.  In the meantime, everything else. <br><a name="habracut"></a><br><h4>  How to use Modal Segue in the Navigation Controller </h4><br>  And so, you have a problem: the client does not like the standard Navigation Controller transition - ‚Äúoverlapping to the right‚Äù - and he wants the new screen, for example, to appear ‚Äúscreen rotation from the bottom‚Äù.  We immediately see a solution to the problem: change the Segue view to Modal.  Everything would be fine, but here only the logic of the Navigation Controller with its hierarchy of screens is broken;  and as a result, the application crashes.  That is, now we need Modal Segue, but with Push Segue functions.  I suspect that there are ways to solve this problem more simply, but I suggest just writing a subclass of UIStoryboardSegue.  The only thing we have to change is the .m file of our class.  Or rather, the <i>perform</i> method: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre><code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) perform{ <span class="hljs-comment"><span class="hljs-comment">//  ,     UIViewController *src = (UIViewController *) self.sourceViewController; UIViewController *dst = (UIViewController *) self.destinationViewController; //    [UIView transitionFromView:src.view toView:dst.view duration:1 options:UIViewAnimationOptionTransitionFlipFromBottom completion:nil]; //    Navigation Controller'a [UIView transitionFromView:src.navigationItem.titleView toView:dst.navigationItem.titleView duration:1 options:UIViewAnimationOptionTransitionFlipFromBottom completion:nil]; //  Push  Segue [src.navigationController pushViewController:dst animated:NO]; }</span></span></code> </pre> </div></div><br>  Instead of UIViewAnimationOptionTransitionFlipFromBottom, you can put any style of transition that is close to the heart of your client. <br>  That's all!  How simple, you say.  Now we can specify Custom style for any Storyboard Segue, specify our new class and get Navigation Controller Segue with its type of transition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Core graphics </h4><br>  At one point, your client got tired of kicking the designer every time you need to change the width of the button by 5 pixels (after all, the designer drew a separate picture for each button).  Make your own button with rounded edges and a frame around with QuartzCore.framework.  Again, as with singleton, it‚Äôs more like a snippet, speeding up work on a project. <br><br>  In fact, this approach can be used with any subclass of UIView (UIButton is exactly what it is).  We rewrite the <i>awakeFromNib</i> method of our UIView: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)awakeFromNib { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> awakeFromNib]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.cornerRadius = <span class="hljs-number"><span class="hljs-number">5.0</span></span>f; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.masksToBounds = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.borderColor = [<span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span> whiteColor].CGColor; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.borderWidth = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f; }</code> </pre><br>  It's simple.  First, with inheritance, we need to execute our code after the superclass has finished its work.  So we call the same method, but on the superclass.  Secondly, we set the radius of rounding of the corners of the layer of our view and force the layer to obey the specified mask.  Thirdly, we set the frame color (CGColor, of course) and its thickness. <br>  I know that some expected deep work with a graphic context, but then they are quick cheat sheets for a freelancer - when a new task with Core Graphics appears, then we will write articles. <br><br><h4>  Work with UIWebView and ScrollView </h4><br>  We already have a UIWebView, let's load the content into it: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *htmlString; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *cssString; &lt;... ...&gt; htmlString = [<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> stringWithFormat:<span class="hljs-string"><span class="hljs-string">@"&lt;style&gt;%@&lt;/style&gt;%@"</span></span>, cssString, htmlString]; <span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *url = [[<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> alloc] initFileURLWithPath:pathToApplicationDirectory]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> hideOverscrollShadowsForWebView:webView]; [webView loadHTMLString:htmlString baseURL:url];</code> </pre><br>  Just got a web page with our style and html.  To hide unpleasant gray shadows during the UIWebView overscroll, we used the following method: <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">/*! ,         UIWebView \param webView   WebView,    */</span></span> - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)hideOverscrollShadowsForWebView:(<span class="hljs-built_in"><span class="hljs-built_in">UIWebView</span></span> *)webView { <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> scrollview = [webView.subviews objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *subview <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [scrollview subviews]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([subview isKindOfClass:[<span class="hljs-built_in"><span class="hljs-built_in">UIImageView</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]) subview.hidden = <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; webView.backgroundColor = [<span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span> clearColor]; }</code> </pre><br>  We hide all child views in Scrollview belonging to our UIWebView.  And also set a transparent background. <br><br>  You can say only one thing about UIScrollView: never forget to set the contentSize property, and you will be happy. <br><br><h4>  Own popups (Popups) </h4><br>  It's time to talk about the giant of this article.  This time, the client needed the ability to quickly and without your participation change the type of pop-up windows.  Well, for the cause! <br><br>  Let's talk a little about the theory, about how we all turn. <br>  In Storyboard, we are unlikely to implement a full pop-up window, but we can create a separate PopupView.xib file! <br>  And as a model, we will create three classes PopupView, PopupController, PopupControllerDelegate. <br><br>  First, build your pop-up window layout as in the screenshot.  Note that in our case, File's Owner will be an object of the PopupController class, and View itself will be an object of the PopupView class.  Background View is a translucent light gray UIView. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db4/c41/d8b/db4c41d8b2223876bc4a21bf31947c9a.png"><br><br>  Let's look first at the implementation of <i>PopupView.h</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><span class="hljs-meta"> @interface PopupView : UIView @property (strong, nonatomic) IBOutlet UIView *backgroundView; @property (strong, nonatomic) IBOutlet UIView *innerPopupView; @property (strong, nonatomic) IBOutlet UILabel *popupTitleLabel; @property (strong, nonatomic) IBOutlet UILabel *popupTextLabel; @property (strong, nonatomic) IBOutlet UIButton *popupButton; @end</span></span></code> </pre></div></div><br>  We just hooked all user interface elements into the code;  We did not change <i>PopupView.m,</i> we left the standard generated code. <br>  We have a popup template, now we need to skillfully use it.  Create a PopupController. <br><br>  <i>PopupController.h</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"PopupControllerDelegate.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"PopupView.h"</span></span></span><span class="hljs-meta"> @interface PopupController : NSObject // UIViewController,        PopupView @property (strong, nonatomic) UIViewController</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;PopupControllerDelegate&gt;</span></span></span><span class="hljs-meta"> *delegate; //    .     ! @property (strong, nonatomic) NSMutableArray *activePopups; - (IBAction)touchedButton:(UIButton *)sender; - (id)initWithDelegate:(UIViewController</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;PopupControllerDelegate&gt;</span></span></span><span class="hljs-meta"> *)delegate; - (void)showHelloWorldPopup; - (void)dismissAllPopups; @end</span></span></code> </pre></div></div><br>  All we did was set up the properties we needed and public methods of initialization, showing a simple pop-up window, closing all the pop-up windows.  And also added a small Action for the button inside the popup window in the PopupController. <br><br>  <i>PopupController.m</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"PopupController.h"</span></span></span><span class="hljs-meta"> @implementation PopupController - (id)initWithDelegate:(UIViewController</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;PopupControllerDelegate&gt;</span></span></span><span class="hljs-meta"> *)delegate { self = [super init]; if (self) { //     self.activePopups = [NSMutableArray array]; //    self.delegate = delegate; } return self; } - (void)showHelloWorldPopup { PopupView *popup = [self popupFromRestorationID:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"text"</span></span></span><span class="hljs-meta">]; [self configurePopup:popup]; [self showPopup:popup]; } - (IBAction)touchedButton:(UIButton *)sender { [self.delegate touchedPopupButton:sender]; } - (void)dismissAllPopups { for (UIView *popup in activePopups) { [self hidePopup:popup]; } } </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;...&gt;</span></span></span></span></code> </pre></div></div><br>  During initialization, we immediately set a delegate for our class. <br>  I divided the <i>showHelloWorldPopup</i> method code into three other methods to make it easier to read: we initialize the pop-up window, configure it and show it. <br>  When a user touches a button on a pop-up window, we notify our delegate. <br>  The <i>dismissAllPopups</i> method simply traverses all pop-up windows in the general array and closes each. <br>  Let's add the missing methods: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">&lt;...&gt; - (PopupView *)popupFromRestorationID:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)restorationID { <span class="hljs-comment"><span class="hljs-comment">//      .xib  NSArray *allViews = [[NSBundle mainBundle] loadNibNamed:@"PopupView.xib" owner:self options:nil]; //     for (PopupView *view in allViews) { //  restorationIdentifier ,   ,   ,        if ([view.restorationIdentifier isEqualToString:restorationID]) { view.alpha = 0.0f; [self.delegate.view addSubview:view]; return view; } } //   !   return nil; } - (void)showPopup:(PopupView *)popup { //  innerPopupView  50% [popup.innerPopupView setTransform:CGAffineTransformMakeScale(0.5, 0.5)]; //   [UIView animateWithDuration:0.2f animations:^{ //     popup.alpha = 1.0f; //      100% [popup.innerPopupView setTransform:CGAffineTransformMakeScale(1.0, 1.0)]; }]; //       [popup.backgroundView addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(dismissAllPopups)]]; //        [activePopups addObject:popup]; } - (void)hidePopup:(UIView *)popup { //   [UIView animateWithDuration:0.2f animations:^{ //     popup.alpha = 0.0f; } completion:^(BOOL finished){ //      ViewController'a [popup removeFromSuperview]; }]; //        ,     [activePopups removeObject:popup]; } - (void)configurePopup:(PopupView *)popup forName:(NSString *)name { //   popup.popupTitleLabel.text = @"Popup Title"; //   popup.popupTextLabel.text = @"Hello World!"; //     [self setTitle:@"Okay"]; } - (void)setTitle:(NSString *)title forButton:(UIButton *)button { [button setTitle:title forState:UIControlStateNormal]; [button setTitle:title forState:UIControlStateSelected]; [button setTitle:title forState:UIControlStateHighlighted]; [button setTitle:title forState:UIControlStateDisabled]; } @end</span></span></code> </pre></div></div><br>  All the tricks in turn: <br><br><ol><li>  Animations using UIView: everything that is written in the <i>animations:</i> block will be gradually executed over the specified time.  The code from the <i>completion</i> block <i>:</i> executes instantly, immediately after the <i>animations</i> block <i>:</i> </li><li>  When the user clicks on the gray dimming, the pop-up window immediately disappears. </li><li>  If you simply set the button text for one state, for others the text will not change, so the <i>setTitle: forButton method:</i> changes the button text for all states at once </li></ol><br>  By creating a similar architecture of pop-up windows, we enable the client to change the appearance of windows without our participation.  Let the client change the color, size, location of elements - as long as he does not touch the connection with the code, everything will work as it should. <br><br>  Well, and lastly, I will show how our class works.  We add <i>PopupControllerDelegate.h</i> : <br><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @protocol PopupControllerDelegate @required - (void)touchedPopupButton:(UIButton *)sender; @end</span></span></code> </pre><br>  Any UIViewController on which a pop-up window may appear should be able to handle the events of this window, respond to the PopupControllerDelegate protocol. <br><br>  For example, we want to show HelloWorld a window after loading our view, which responds to the required protocol and which already has an initialized popupController object.  Add the following code to <i>viewDidAppear:</i> <br><br><pre> <code class="objectivec hljs">[popupController showHelloWorldPopup];</code> </pre><br>  And add a popup event handler: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)touchedPopupButton:(<span class="hljs-built_in"><span class="hljs-built_in">UIButton</span></span> *)sender { <span class="hljs-comment"><span class="hljs-comment">//      [popupController dismissAllPopups]; }</span></span></code> </pre><br><h4>  Conclusion </h4><br>  Thank you for reading to the end! <br><br>  The second part of the article was written at the Domodedovo airport before flying to Vancouver.  It's late at night, I run out of coffee.  Please understand <s>forgive</s> , and if you find any typo \ inaccuracy in the text \ code, please inform <a href="http://habrahabr.ru/users/backmeupplz/">my habracenter</a> , do not rush to put a minus or write an angry comment. <br><br>  The following articles will be even more interesting topics: sharing content on social networks, PSPDFKit, Push Notifications. </div><p>Source: <a href="https://habr.com/ru/post/192100/">https://habr.com/ru/post/192100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192084/index.html">Convenient file synchronization</a></li>
<li><a href="../192090/index.html">Core Data for iOS. Chapter number 2. Practical part</a></li>
<li><a href="../192092/index.html">AndEngine GLES2 - Live Wallpaper</a></li>
<li><a href="../192094/index.html">Google has substantiated its plan for the planetary Internet Loon in terms of the distribution of balloons in the stratosphere</a></li>
<li><a href="../192098/index.html">Python. Non-obvious behavior of some constructions</a></li>
<li><a href="../192102/index.html">Sudoku generation algorithm</a></li>
<li><a href="../192106/index.html">Overview of network storage Fantec CL-35B2 RAID</a></li>
<li><a href="../192108/index.html">Unit testing is not enough. Need static typing!</a></li>
<li><a href="../192112/index.html">Google store</a></li>
<li><a href="../192116/index.html">Entering the period: stop terrorizing users</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>