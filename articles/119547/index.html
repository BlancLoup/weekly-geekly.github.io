<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Subtleties 9-patch resources</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about the unobvious features of the work of 9-patch structures used in Android to create "stretching" elements of graphic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Subtleties 9-patch resources</h1><div class="post__text post__text-html js-mediator-article"> In this article we will talk about the unobvious features of the work of 9-patch structures used in Android to create "stretching" elements of graphic design. <br><br><a name="habracut"></a><br>  I will not dwell on what it is, since there are already <a href="http://habrahabr.ru/tag/9-patch/">articles</a> on this topic.  The key element for creating stretchable images is the so-called chunk, a byte [] structure.  This chunk is used in the NinePatch constructor, but the documentation about what it is is not too verbose: <br><br> <code><b>public NinePatch (Bitmap bitmap, byte[] chunk, String srcName)</b> <br> <i>chunk</i> The 9-patch data chunk describing how the underlying bitmap is split apart and drawn. <br> <br> <b>Bitmap.getNinePatchChunk()</b> <br> Returns an optional array of private data, used by the UI system for some bitmaps. Not intended to be called by applications. <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Where does chunk come from?</b> <br>  9-patch resources can be in one of two types.  The first is the same picture with black single-pixel marker lines defining the stretch areas.  The second view is compiled.  Externally, the compiled image looks exactly the same as the original, but the marker lines are not represented visually, but are converted into a binary format and protected inside with the code name ‚ÄúnpTc‚Äù.  The aapt utility performs the conversion from the first type to the second, at the resource preparation stage. <br><br>  For clarity, take a picture consisting of one pixel of red and make it a 9-patch resource using the appropriate utility.  Compare it in the hex editor with the compiled version: <br><br>  9 pixels of source image (1 + 8 pixels markers) <br><img src="https://habrastorage.org/getpro/habr/post_images/fab/8f8/b86/fab8f8b866b3a2e6d9cbec29ad383439.png" alt="image"><br><br>  1 pixel + binary data after the npTc tag <br><img src="https://habrastorage.org/getpro/habr/post_images/49b/5c1/dcd/49b5c1dcd95f17920fd5e88e8f8204b4.png" alt="image"><br><br>  Each of these forms of being has pros and cons: on the one hand, the compiled form is optimized for use in runtime, but you cannot change it in the graphic editor - chunk will inevitably be overwritten when it is retained. <br><br>  What exactly this structure is and what it contains can be read in the <a href="http://android.git.kernel.org/%3Fp%3Dplatform/frameworks/base.git%3Ba%3Dblob%3Bf%3Dinclude/utils/ResourceTypes.h%3Bh%3D10baa11a5114a4efd3ddb1d7fc4d870d8a2e8401%3Bhb%3DHEAD">source code</a> (see the Res_png_9patch structure) <br><br>  <b>Why do we need to know this?</b> <br>  <a href="http://developer.android.com/guide/topics/graphics/2d-graphics.html">The documentation</a> for the 9-patch resources reads: "It must be saved with the extension .9.png, and saved into the res / drawable / directory of your project."  So, this is the only place where aapt compiles resources from.  But what to do if we want to take pictures from another place, for example from the assets folder or even download them in runtime?  Let's try this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> NinePatchDrawable create9Patch() { <br> <font color="#2B91AF">Bitmap</font> raw = BitmapFactory.decodeStream(...); <br> <font color="#0000ff">byte</font> [] chunk = raw.getNinePatchChunk(); <br> NinePatch patch = <font color="#0000ff">new</font> NinePatch(raw, chunk, <font color="#0000ff">null</font> ); <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> NinePatchDrawable(patch); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Attempting to create a NinePatch in the forehead from ‚Äúraw‚Äù resources in this way leads to a native crash somewhere in the wilds of the virtual machine, specifically on the raw.getNinePatchChunk () line, which is quite logical - instead of the expected npTc, it turns out there is a mess from the original image and lines- markers. <br><br><blockquote> <code><font color="black">I/DEBUG  ( 4694): signal 11 (SIGSEGV), fault addr 00000008 <br> I/DEBUG  ( 4694): r0 0000bd00 r1 00000007 r2 ad03db59 r3 00000000 <br> I/DEBUG  ( 4694): r4 0000bd00 r5 00000000 r6 ad3431b1 r7 41049cf8 <br> I/DEBUG  ( 4694): r8 beb484b8 r9 41049cf0 10 41049ce0 fp 00000000 <br> I/DEBUG  ( 4694): ip ad3431b1 sp beb48498 lr ad046f05 pc ad03db6c cpsr 00000030 <br> I/DEBUG  ( 4694):     #00 pc 0003db6c /system/lib/libdvm.so <br> I/DEBUG  ( 4694):     #01 pc 000431c6 /system/lib/libandroid_runtime.so <br> I/DEBUG  ( 4694):     #02 pc 0000e434 /system/lib/libdvm.so <br> I/DEBUG  ( 4694):     #03 pc 00040b0a /system/lib/libdvm.so <br> I/DEBUG  ( 4694):     #04 pc 00013198 /system/lib/libdvm.so <br> I/DEBUG  ( 4694):     #05 pc 00017b9c /system/lib/libdvm.so <br> ... <br></font></code> </blockquote><br><br>  The solution is to slip the system already compiled resources.  The easiest way to do this is the following: you take an empty android project, add your resources to res / drawable, compile, export apk, open apk as an archive, pull out the same resources from the same place, but already compiled.  Copy them into the assets of your application (or somewhere else) and from this point on you can construct valid NinePath objects from bitmaps using the above code. <br><br>  So it goes. </div><p>Source: <a href="https://habr.com/ru/post/119547/">https://habr.com/ru/post/119547/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119542/index.html">Report on the presentation of the Galaxy S II and Galaxy Tab</a></li>
<li><a href="../119543/index.html">iPADrom - S03E03. IPad software review</a></li>
<li><a href="../119544/index.html">Mono developers founded commercial company Xamarin</a></li>
<li><a href="../119545/index.html">Sony's black bar continues, new flash hacking</a></li>
<li><a href="../119546/index.html">Heroic timing</a></li>
<li><a href="../119549/index.html">All-Russian Popular Front vs Firefox or how to upload pictures correctly</a></li>
<li><a href="../119550/index.html">TermKit: a new concept of the console with a graphical output</a></li>
<li><a href="../119551/index.html">PHP + Word</a></li>
<li><a href="../119555/index.html">ADCSpb # 5. Editors</a></li>
<li><a href="../119556/index.html">Apple proposes to standardize even smaller SIM cards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>