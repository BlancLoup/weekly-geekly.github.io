<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bresenham algorithm in real-time applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are such devices - they are called scanners or scanners, usually with the adjective "laser" 



 use them in various laser scanning technologies...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bresenham algorithm in real-time applications</h1><div class="post__text post__text-html js-mediator-article">  There are such devices - they are called scanners or scanners, usually with the adjective "laser" <br><br><img height="255" src="https://habrastorage.org/getpro/habr/post_images/2a9/fb1/fe5/2a9fb1fe519685cd5729cf24ed6a75bd.jpg" width="220"><br><br>  use them in various <a href="https://en.wikipedia.org/wiki/Laser_scanning">laser scanning</a> technologies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the programmer's point of view, a laser scanner is two rotating mirrors that deflect a laser beam in two mutually perpendicular planes, the angles are set using a pair of DACs (and feedback amplifiers after DACs).  Usually DACs can be 12-16 bits.  In fact, the task of drawing a picture or, in a slightly more scientific language, the output of information on such a device is no different from the output of information on ancient analog graphic displays. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/122/69d/7d5/12269d7d57ed25821c207155f2257314.gif" alt="image"><br><br>  Such scanners are usually controlled using a separate (micro) controller, to which ‚Äúhigh-level commands‚Äù are sent from the computer.  The main team is ‚Äúdraw a line from now to this with such a speed‚Äù.  Once ‚Äúdraw a line‚Äù and a microcontroller, we recall the classic Bresenham algorithm.  The Bresenham algorithm is good in that it does not use any "slow" floating-point operations, although for modern 32-bit microcontrollers this is not as important as for 8 or 16-bit ones. <br><br><a name="habracut"></a><br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Bresenham algorithm implementation   .. , .. ,  ,*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x1,y1,dx,dy,sx,sy,d,d1,d2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, x,y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( x2 &gt;= x1) { dx = x2 - x1; sx = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dx = x1 - x2; sx = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( y2 &gt;= y1) { dy = y2 - y1; sy = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dy = y1 - y2; sy = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(dy &lt;= dx) { d = (dy &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) - dx; d1 = dy &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; d2 = (dy - dx) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(x=x1+sx,y=y1,i=<span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= dx ; i++,x+=sx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { d += d2; y += sy; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d += d1; } putpixel(x,y, color); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d = (dx &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) - dy; d1 = dx &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; d2 = (dx - dy) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(x=x1,y=y1+sy,i=<span class="hljs-number"><span class="hljs-number">1</span></span>;i &lt;= dy ; i++,y += sy) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { d += d2; x += sx; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d += d1; } putpixel(x,y, color); } } <span class="hljs-comment"><span class="hljs-comment">/* endif(dy &lt;=dx) */</span></span> }</code> </pre> <br><br>  In our case, there is no color, so we ignore <i>color</i> .  But we have speed. <br>  For example, if we have a horizontal or vertical segment of <i>n</i> pixels and the given speed is <i>V</i> (pixels per second), then each pixel should display the time <i>tp</i> = 1 / <i>V</i> <br><br>  If the segment is not horizontal, then its length is <i>l = hypot (x0-x1, y0-y1)</i> , the output time of the entire segment is <i>t0 = l / V</i> , but to calculate the delay per point, it will be necessary to divide t0 by the number of function calls putpixel, t. e. <br><br>  tp = t0 / max (| x0-x1 |, | y0-y1 |) <br><br>  Then in the algorithm, the color is simply replaced by ‚Äúdelay by point‚Äù <i>wait (= tp)</i> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wait)</span></span></span><span class="hljs-function"> ...... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putpixel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,y, wait)</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br><br>  at first glance, the <i>putpixel</i> function itself should look something like this <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putpixel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wait)</span></span></span><span class="hljs-function">) </span></span>{ outPortX(x); <span class="hljs-comment"><span class="hljs-comment">//    X  x outPortY(y); //    Y  y delay(wait); //  wait   }</span></span></code> </pre><br><br>  However, here begin the nuances associated with the implementation of the DAC. <br><br>  DACs can work both in series and in parallel.  Consistently - when you need to choose the number of the DAC, set the desired value and wait for the readiness, the end of the conversion, or just wait for a while.  If DACs work in parallel, then you can write the values ‚Äã‚Äãof <i>x</i> and <i>y</i> in the corresponding registers of the microcontroller, and then simultaneously wait for the readiness or the end of the conversion. <br><br>  In the first case, the time spent on outputting only X or only Y is approximately two times less than the serial output of X and Y. Accordingly, the source code looks like this <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Line</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wait, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waitXY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dx,dy,sx,sy,d,d1,d2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, x,y; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( x2 &gt;= x1) { dx = x2 - x1; sx = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dx = x1 - x2; sx = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( y2 &gt;= y1) { dy = y2 - y1; sy = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { dy = y1 - y2; sy = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/****************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(dy &lt;= dx) { d = (dy &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) - dx; d1 = dy &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; d2 = (dy - dx) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(x=x1+sx,y=y1,i=<span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt;= dx ; i++,x+=sx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { d += d2; y += sy; putXY(x,y,waitXY); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d += d1; putX(x, wait); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d = (dx &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) - dy; d1 = dx &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; d2 = (dx - dy) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(x=x1,y=y1+sy,i=<span class="hljs-number"><span class="hljs-number">1</span></span>;i &lt;= dy ; i++,y += sy) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { d += d2; x += sx; putXY(x,y,waitXY); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { d += d1; putY(y, wait); } } } <span class="hljs-comment"><span class="hljs-comment">/* endif(dy &lt;=dx) */</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putXY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> wait)</span></span></span><span class="hljs-function">) </span></span>{ outPortXY(x,y); <span class="hljs-comment"><span class="hljs-comment">//    X  Y  x  y //    #define outPortXY(x,y) outPortX(x); outPortY(y); delay(wait); //  wait   } void putX(int x, int wait)) { outPortX(x); //    X  x delay(wait); //  wait   } void putY(int y, int wait)) { outPortY(y); //    Y  y delay(wait); //  wait   }</span></span></code> </pre><br><br>  The <i>wait</i> and <i>waitXY values</i> when calling <i>Line</i> can be calculated based on the fact that: <br><br>  <i>l = hypot (x0-x1, y0-y1)</i> , the output time of the entire segment <i>t0 = l / V</i> , the number of calls to <b>putXY</b> <i>n1</i> = min (| x0-x1 |, | y0-y1 |), the number of calls to <b>putX</b> or <b>putY</b> <i>n0 = max (| x0-x1 |, | y0-y1 |) - min (| x0-x1 |, | y0-y1 |)</i> . <br><br>  In addition, you can enter a correction for the execution time of the functions outPortX, outPortY and outPortXY.  The execution time of these functions can be predetermined during the calibration process. <br><br>  Let me remind you that all the delay calculations we do in the control computer, not in the microprocessor, and the times and delays in question are microseconds and their shares ... <br><br>  Well, actually all for now. <br><br>  We assemble the installation, write programs for the control computer and the microprocessor, turn it on, display some simple test image and look at what happened <br><br>  Anyone guess what we will see?  (to be continued) </div><p>Source: <a href="https://habr.com/ru/post/205654/">https://habr.com/ru/post/205654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205644/index.html">Nokia DVLUP comes to Habrahabr</a></li>
<li><a href="../205646/index.html">Qualcomm launches iBeacon alternative</a></li>
<li><a href="../205648/index.html">Tetris is forbidden to mention on the App Store</a></li>
<li><a href="../205650/index.html">Design camp online: see conference broadcast on December 12 at 10:00 (MSK)</a></li>
<li><a href="../205652/index.html">"Hi-end" smartphones with Ubuntu Touch will appear in 2014</a></li>
<li><a href="../205656/index.html">Real Delphi Mobile Application for Surveillance Systems</a></li>
<li><a href="../205658/index.html">We prototype the application: scripts, animation, icons, usability test on the example of My World</a></li>
<li><a href="../205662/index.html">Nokia may release a smartphone with Android before merging with Microsoft</a></li>
<li><a href="../205664/index.html">About the launch of the LendWings project, the loss of nerve cells and the rapid detection of errors</a></li>
<li><a href="../205668/index.html">Ciklum Speakers' Corner: ‚ÄúLua. Overview of the language and its capabilities "</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>