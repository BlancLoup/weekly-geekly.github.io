<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate database changes in .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 I would like to talk about the projects Migrator.Net and ECM7.Migrator . 

 Migrator.Net is a database version control mechanism similar to M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate database changes in .NET</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  I would like to talk about the projects <a href="http://code.google.com/p/migratordotnet/">Migrator.Net</a> and <a href="http://code.google.com/p/ecm7migrator/">ECM7.Migrator</a> . <br><br>  Migrator.Net is a database version control mechanism similar to Migrations in Ruby on Rails.  Migrator allows you to automate the execution of database modification operations and automatically keeps track of versions. <br><br>  Migrator is written in C # and will be convenient, first of all, when used in projects under .NET. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, I will do a small review of these projects, and then I will try to highlight their ‚Äúpros‚Äù and ‚Äúcons.‚Äù <br><br><a name="habracut"></a><br><br><h5>  Basic principles </h5><br>  To modify the database, you create an assembly containing ‚Äúmigrations‚Äù.  "Migrations" are classes, each of which describes a small change in the database. <br><br>  When writing ‚Äúmigrations‚Äù classes, it is necessary to inherit from the special base class Migration and block 2 methods: <ul><li>  The Up method sets operations on the database that are necessary for moving to the next version of the database (for example, creating a table); </li><li>  The Down method sets the operations necessary to undo changes made by the Up method (for example, if a new table is created in the Up method, then it should be deleted in the Down method). </li></ul><br><br>  The actions that must be performed on the database are set in the language in which you write your .NET project.  There is a special framework containing classes and methods for performing basic operations on the database.  It is also possible to execute an arbitrary SQL query. <br><br><h5>  Migration example </h5><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Migration(7)] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> AbstractTestMigration : Migration <br> { <br> <font color="#0000ff">override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Up() <br> { <br> Database.AddTable( <font color="#A31515">"CustomerAddress"</font> , <br> <font color="#0000ff">new</font> Column( <font color="#A31515">"customer_id"</font> , <br> DbType.Int32, ColumnProperty.PrimaryKey), <br> <br> <font color="#0000ff">new</font> Column( <font color="#A31515">"address"</font> , <br> DbType.AnsiString, ColumnProperty.NotNull)); <br> } <br> <br> <font color="#0000ff">override</font> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Down() <br> { <br> Database.RemoveTable( <font color="#A31515">"CustomerAddress"</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Let's look at what is happening here: <ol><li>  We see that our class ‚Äúmigration‚Äù is marked with the attribute <i><nobr>[Migration (7)]</nobr></i> .  The attribute parameter is a value of the long type that specifies the version number of the database to which a transition will occur when making changes from the Up method. </li><li>  As we have said, the class ‚Äúmigration‚Äù should be inherited from the base class <i>Migration</i> .  Also, the ‚Äúmigration‚Äù class should override the <i>Up</i> and <i>Down</i> methods of the base class. </li><li>  The base class <i>Migration</i> has a <i>Database</i> property.  This property contains an object that implements the <i>ITransformationProvider</i> interface.  By calling the methods of the <i>ITransformationProvider</i> interface <i>on</i> the <i>Database</i> object, you can perform operations on the database.  For example, in the <i>Down</i> method, <i>Database.RemoveTable is</i> used to delete a table. <br>  The <i>ITransformationProvider</i> interface contains the <code>int ExecuteNonQuery(string sql)</code> method that allows you to execute an arbitrary SQL query. </li></ol><br><h5>  Ways to make changes </h5><br>  Migrator provides several ways to launch your ‚Äúmigrations‚Äù classes. <ol><li>  Console application </li><li>  Task for <a href="http://en.wikipedia.org/wiki/NAnt">NAnt</a> </li><li>  Task for <a href="">MsBuild</a> </li><li>  Program execution - performing ‚Äúmigrations‚Äù from your program through the API </li></ol><br>  Each of these methods receives as parameters the type of database used, the connection string and the version number of the database to be obtained. <br><br><br><h5>  Supported DBMS </h5><br>  Migrator.NET can work with various DBMS.  When ‚Äúmigrations‚Äù are launched for execution, along with the connection parameters to the database, the migrator indicates the class ‚Äúdialect‚Äù by which SQL queries are generated for a specific DBMS. <br><br>  In the Migrator.NET project there are ‚Äúdialects‚Äù for the following DBMS: MySQL, Oracle, SQLite, MS SQL Server (including CE), PostgreSQL. <br><br><h5>  Differences between Migrator.Net and ECM7.Migrator projects </h5><br>  At the beginning of this post, I mentioned another project with <a href="http://code.google.com/p/migratordotnet/">Migrator.Net</a> : <a href="http://code.google.com/p/ecm7migrator/">ECM7.Migrator</a> .  Now I will talk about it in more detail. <br><br>  In the spring of this year, my colleagues and I learned about Migrator.NET.  We tried to use it and we really liked it.  Now I use the migrator on both of my jobs (a total of 3 fairly large projects already working in real conditions). <br>  Unfortunately, it turned out that Migrator.NET has some inconveniences, and its provider for Oracle contains many errors (by the way, this is written on the main page of the project in google code, by the way). <br><br>  During the period from May to September, a large number of changes were made to Migrator.NET: several classes of so-called rewritten.  "Kernels", many errors in the provider are corrected, several "cosmetic" improvements that make using the migrator more convenient. <br><br>  As a result, the code that we finalized was so divided with the code of the original project that it was decided to make a separate project.  That he laid out in the google code called <a href="http://code.google.com/p/ecm7migrator/">ECM7.Migrator</a> .  It was also partially translated (and corrected for a new project) documentation. <br><br>  In addition, PostgreSQL support was removed as unnecessary. <br><br><h5>  How can a migrator help you? </h5><br><ol><li>  It is convenient to distribute database changes with the migrator.  There is no folder with a bunch of scripts, instead it is the only dll.  I think you will appreciate this if you need to update the windows-application for several hundred users. </li><li>  Migrations are easy to write: check at compile time, intellisense, etc.  No one writes SQL manually.  It is usually generated via the GUI.  Often, this generates a bunch of "left" teams.  With a migrator, you can fully control everything without spending a lot of time on it. </li><li>  Migrations are convenient to perform.  As I already wrote, there are tasks for the migrator for NAnt and MSBuild.  With them you can easily perform the migration during the automated assembly of your project.  In addition, software migration tools make possible such things as updating the database structure when starting the application or creating a clean database for unit tests. </li><li>  Migrations do not depend on the DBMS.  To be honest, I have never had to work on a project that should support several DBMS.  But, perhaps, independence from the DBMS is also needed by someone. </li><li>  Migration is easy to add arbitrary logic.  For example, you can create a bunch of tables in a loop or add some prefix to the name of each table, which is defined in the application settings. </li></ol><br><h5>  disadvantages </h5><br>  During my work with the migrator, I felt two of his shortcomings: <br><ol><li>  If a person does not like to work with programs via the command line (as I do), then the lack of a program with a GUI that allows to start migrations for execution will be a disadvantage for him.  Fortunately, this problem was quickly resolved by writing a bat file that launches a migrator console application with the necessary parameters. </li><li>  The second inconvenience is that when I write migration, I do not remember the names of already created database objects.  This problem has not been resolved.  When writing migrations, I look at the names in the GUI or in the hbm files (we use NHibernate in many projects). </li></ol><br><br><h5>  What can not migrator </h5><br>  Migrator does not save you from having to think about the structure of the database.  It does not generate any changes to the database machine.  It's just a more convenient way to <i>manually</i> set all actions on the database, as well as a more convenient way to perform them. <br><br><h5>  Conclusion </h5><br>  In general, this is all that I wanted to tell about the migrator.  How successful was the story - you decide. <br><br>  I will be very happy if someone is interested in a migrator.  This will mean that the work of its developers (and therefore mine too) was not in vain.  I will try in every way to help such people in the use of the migrator - to answer questions and quickly fix the bugs found. <br><br>  Thank you all for your attention. <br><br>  - Note <br>  Some time ago, the <a href="http://code.google.com/p/octalforty-wizardby/">octalforty Wizardby</a> project was already <a href="http://habrahabr.ru/blogs/net/56175/">discussed</a> <a href="http://code.google.com/p/octalforty-wizardby/">here</a> .  As I understand it, this is another migrator. <br>  Unfortunately, very briefly acquainted with this project.  The main difference that catches the eye is that there ‚Äúmigrations‚Äù are written in a special language. <br>  If you used Wizardby in real conditions, write to me.  It would be very interesting to learn about its merits / demerits and compare it with Migrator.NET. </div><p>Source: <a href="https://habr.com/ru/post/70884/">https://habr.com/ru/post/70884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70869/index.html">Architectural CAD program of 1963</a></li>
<li><a href="../70870/index.html">More free SMS in Mail.Ru Agent</a></li>
<li><a href="../70874/index.html">About habrarating</a></li>
<li><a href="../70878/index.html">How do (o, i) e house (e, i) e animals (o, s) do you have?</a></li>
<li><a href="../70881/index.html">Habratulz: now under FF 3.5+</a></li>
<li><a href="../70885/index.html">Web telephony. Solution Overview</a></li>
<li><a href="../70890/index.html">Habrarazvod?</a></li>
<li><a href="../70891/index.html">Fastening tabs</a></li>
<li><a href="../70893/index.html">A device that allows you to interact with a computer using physical objects</a></li>
<li><a href="../70894/index.html">Hello from the year 1988</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>