<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Well, yes, C ++ sites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I missed a couple of topics about the web in C ++ and many comrades misunderstand the meaning of using C ++ on the web. Therefore, I will tell you how...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Well, yes, C ++ sites</h1><div class="post__text post__text-html js-mediator-article">  I missed a <a href="http://habrahabr.ru/blogs/cpp/61563/">couple of</a> <a href="http://habrahabr.ru/blogs/cpp/61532/">topics</a> about the web in C ++ and many comrades misunderstand the meaning of using C ++ on the web.  Therefore, I will tell you how I used it in my experience.  I used, however, Python, but only because the WebToolKit type library was not at hand. <br><br>  To be honest, I understand C ++ like a hacker in women's lipstick - like many, I mostly use PHP (and more and more Python, but rarely for the web - more for OpenGL), but nevertheless it does not bother me (C ++ ) use.  This is to the fact that do not be afraid of the complexity of the language - everything is not as bad as it seems. <br><br>  But what is important: "Premature is the root of all evil."  And this is important.  To write some complicated system right on C ++ is pointless (I‚Äôm talking about sites, of course).  Optimize, as a rule, you need only 3% of the code.  That's about these 3 percent, and I will tell. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I had a website and on it on all pages users could write something (to explain for a long time) and in a corner there was a ‚Äústream‚Äù in real time (via AJAX update every 5 seconds) who wrote where and what.  It was done, as it should be on PHP / MySQL - a table, in it we select the last (relatively speaking: WHERE id&gt; MAX (id) -10 ORDER BY id DESC) records.  Periodically delete everything except the last ten.  It worked great.  While TechCrunch about the site did not write.  Dead server because of this part. <a name="habracut"></a>  As soon as I turned it off (remember about 3%?) - all tens of thousands of people that they sent me - they began to see the site perfectly.  I decided this sloppy - made memcache.  PHP chose the last 10 entries and wrote in memcache, and when queried it, it gave a line from memcache.  However, this decision as a result began to die. <br><br>  I wrote a simple http-server in Python (from the standard library), which had an array of 10 lines and gave it to an AJAX request or added a new one and deleted the first (FIFO). <br><br>  That is, PHP (on the server processed forms and sent it via file_get_contents ('http://mysite.com:9000/?put='.urlencode ($ _GET [msg]));  and AJAX (in the sense of a JavaScript client) has stepped on <a href="http://mysite.com/">mysite.com</a> : 9000 /? get - bypassing all Apaches, PHP interpreter, MySQL and even memcached (which you still need to connect to - and this time is overhead). <br><br>  To write such an application in Python or C ++ if you have a good HTTP-server library - no difference.  C ++ already has a lot of tools for high-level programming.  Even an average PHP programmer is able to write safe and serious applications in modern C ++. <br><br>  But, and here it is already interesting: the Python HTTPd script script eats up to 10-20Mb of RAM, and the C ++ server launched with the recently published <a href="http://habrahabr.ru/blogs/cpp/61563/">WebToolKit eats</a> just 0.6-1.4Mb (this is about RES memory).  So such small optimizations on the server can run the sea (unlike Python, which quickly eats up all the memory in chunks of 20Mb on a small VPS). <br><br>  Similarly, to make, for example, a real-time display of users on the site ‚Äî someone on which page ‚Äî from where. <br><br>  As a result, the site is still in PHP, it is accelerated dozens of times (due to optimization of the hardest part to execute), the database is unloaded, no dog pile of caching effects, etc., and by the time it takes 2-3 hours to this optimization. <br><br>  Another example is voting.  Suppose that you need to add a voice for someone via AJAX and save the user's IP so that he no longer votes.  In C ++, it will take in memory well, maybe byte 20, so you can safely store all the data about all users and votes for the last week with instant access to them.  At the same time, if you do it in the usual way (PHP / Python + MySQL / SQLite / Postgres ...), the database will grow and access to it will slow down and if the calls go all the time, it can slow down the server significantly.  I don‚Äôt say that SQL will lose once in 10 memories, but I have had such cases (in particular, SQLite: memory: it loses files to SQLite tens or even hundreds of times). <br><br>  Another example is the user's geo-location.  You can load information about all IPs into memory (of course, in the form of a range), and C ++ will take one cycle in nanoseconds, while PHP + MySQL will dig for a long time choosing the right range. <br><br>  Another thing: the counter of something, let's say the number of votes for the post (or karma) is the karma of all users really kept in memory and let AJAX directly contact the sish server, at the same time PHP / MySQL, and Django what they will do: check changed whether the file (PHP), let's do a regex check where we are going (django routes), if there is no optimizer in PHP, we will read the file again, parse it, initialize the connection to the database, request one digit, set the lock so that no one has changed it yet, increase it, go back, remove the lock. <br><br>  And that is if there is no ORM, and after all Django still creates objects to process the request and return it.  This is all, of course, a problem, not a catastrophe, but then again - if you spend 99% of your time on useless things - is it not better to get rid of them in an hour? <br><br>  At the same time, for C ++ it is practically a pair of processor cycles (+1 to the Integer in memory and translated into a string).  Simply put, while PHP + MySQL processes one such request, C ++ can do a thousand, maybe a million (if you do not take into account the time for processing the HTTP protocol itself).  Yes, and such a program in C ++ will actually be shorter (but it is hardly much longer) than PHP + MySQL. <br><br>  In general, if there are tasks of the level ‚Äúyou need to add one to something‚Äù, ‚Äúto find something among a small set of something‚Äù - then pieces of sites in C ++ can help you very much.  But the general idea is still better to do something more high-level (such as PHP / Python) or look at languages ‚Äã‚Äãsuch as Arc. <br><br>  Disadvantages of this approach? <br><br>  Well, more troubles. <br><br>  1. Monitoring, for example.  As an option - the easiest, let's say there is compiled_file.cpp, which compiles in compiled_file (without the extension).  Go to the crontab (crontab -e) and append: <br><br>  * * * * * / bin / pgrep compiled_file ||  / path / to / compiled_file <br><br>  The script will lie down for a minute if something goes wrong, then it will restart.  In reality - less than half a minute. <br><br>  2. Update the running process.  Yes, just replacing the file, as in PHP will not do, will have to kill the process (killall compiled_file) and restart. <br><br>  So you shouldn‚Äôt reject the idea of ‚Äã‚ÄãC ++ sites right away, but you don‚Äôt need to suffer fanaticism either.  You can write a whole site in C ++, but if you have half a man a day, then why? <br><br>  Just using this language should be reasonable.  If your server is 100% loaded and you know that 90% of requests go to one place, which could very simply be expressed as a small server with a 1MB memory footprint and that would not require databases, interpreters, etc.  - then why buy more expensive equipment instead of replacing this piece with a compiled one? <br><br>  And if C ++ is very scary, then look at what Cython is for Python. <br><br><img src="http://habrahabr.ru/media/userpic/avatar/14/45/58/31055.png"><br>  Yoi Haji <br>  <a href="http://yoihj.habrahabr.ru/blog/">view from Habra</a> </div><p>Source: <a href="https://habr.com/ru/post/61640/">https://habr.com/ru/post/61640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61631/index.html">Basics of healthy eating</a></li>
<li><a href="../61632/index.html">A set of free icons for GUI and web design</a></li>
<li><a href="../61633/index.html">Rss icon of condensed milk</a></li>
<li><a href="../61634/index.html">Filter Forge: Aging a photo - quickly and easily (lesson)</a></li>
<li><a href="../61635/index.html">Do you wear glasses or contact lenses?</a></li>
<li><a href="../61642/index.html">the fate of a small developer in a large company, or is it necessary to fight windmills</a></li>
<li><a href="../61643/index.html">The irritating behavior of the update manager in Ubuntu 9.04 and how to cure it</a></li>
<li><a href="../61644/index.html">Become a maintainer - update the repository</a></li>
<li><a href="../61646/index.html">Happy Birthday, PHP!</a></li>
<li><a href="../61648/index.html">HD Tracker.ru and the Day of Russia!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>