<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parallel Sequential Scan Commited</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In previous articles I wrote about getting parallel sequential scan commited to PostgreSQL 9.5. But this did not happen. However, I will be happy to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parallel Sequential Scan Commited</h1><div class="post__text post__text-html js-mediator-article">  In previous articles I wrote about getting parallel sequential scan commited to PostgreSQL 9.5.  But this did not happen.  However, I will be happy to tell you about the first commit parallel sequential scan to PostgreSQL in the master branch for the upcoming release of PostgreSQL 9.6. <br><br>  Parallel queries for PostgreSQL have been my dream for a long time, which I have been working on for several years.  Their development began with PostgreSQL 9.4 release cycle, where I added dynamic workers working in the background and dynamic shared memory, the development of which was continued in PostgreSQL 9.5, where the idea of ‚Äã‚Äãadding a fundamental infrastructure for parallelism that was committed today was taking place.  I would like to tell you a little about today's commits and about the work that will be done next. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But the first thing I would like to do is thank the ones I owe.  Firstly, Amit Kapila, who made a huge contribution to the completion of the project.  The two of us wrote a large amount of code, which became a full-fledged part of this functionality.  And part of this code has gone through a lot of commits over the past few years.  We also wrote a large amount of code that was not included in commits.  Secondly, I want to say thank you to Noah Misch, who helped me well in the early stages of this project, when I struggled with problems in finding ways to solve them.  Thirdly, I would like to say thanks to the PostgreSQL community and individuals who supported the review and test patches, suggested improvements, and many others who supported us in different ways. <br><br>  It is also important to say thanks EnterpriseDB, in particular, its leadership.  First, Tom Kincaid and Marc Linster.  Without their support, it would not be possible for Ammit's and me to devote a lot of time to this project, as well as without my team at EnterpriseDB, who patiently covered me up whenever it was necessary to solve other work issues.  Thank you all. <br><br>  Now, time for demo: <br><br><pre><code class="sql hljs">rhaas=<span class="hljs-comment"><span class="hljs-comment"># \timing Timing is on. rhaas=# select * from pgbench_accounts where filler like '%a%'; aid | bid | abalance | filler -----+-----+----------+-------- (0 rows) Time: 743.061 ms</span></span></code> </pre> <br><br><pre> <code class="hljs pgsql">rhaas=# <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> max_parallel_degree = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-type"><span class="hljs-type">Time</span></span>: <span class="hljs-number"><span class="hljs-number">0.270</span></span> ms rhaas=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pgbench_accounts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> filler <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%a%'</span></span>; aid | bid | abalance | filler <span class="hljs-comment"><span class="hljs-comment">-----+-----+----------+-------- (0 rows) Time: 213.412 ms</span></span></code> </pre><br><br>  Here is the plan: <br><br><pre> <code class="hljs pgsql">rhaas=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pgbench_accounts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> filler <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%a%'</span></span>; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">--------------------------------------------- Gather Number of Workers: 4 -&gt; Parallel Seq Scan on pgbench_accounts Filter: (filler ~~ '%a%'::text) (4 rows)</span></span></code> </pre><br><br>  The accumulating node collects all the workers, and all workers are started in the additional plan in parallel.  Because the additional plan Parallel Seq Scan - ordinary Seq Scan.  Workers are coordinated with each other so that each block is scanned with respect only once.  Each worker can produce a subset of the final result set, and the collecting node collects the results from all. <br><br>  One big enough limitation of the current implementation is that we generate node collectors on top of Parallel Seq Scan nodes.  This means that this function currently does not work for the inheritance hierarchy (using split table partitioning), because it can be added between nodes.  It is also not possible to push the join down into the workers at this time.  The infrastructure provider supports launching plans of every type, but the current scheduler is too dumb to support this.  I hope to fix this problem before the end of the release cycle 9.6.  Taking into account the current state of affairs, the use of this feature will give an advantage where the addition of an index no longer helps, and the addition of several workers will help increase the speed of execution. <br><br>  Also, my experience says that adding several workers as a rule helps, and the advantage does not scale well with a large number of workers.  More research is also needed to understand why this is happening and how to improve it ... As you can see, even 5 workers can improve productivity quite a bit, but this is not as important as in the previous constraint.  However, I would like to improve them further, as the number of CPUs is growing all the time. <br><br>  In conclusion, I would like to point out that there are a number of specific tasks that must be completed before I can call this function even in its basic form completely complete.  It is likely that there are still errors.  Testing is very much appreciated.  Please report the problems you find when testing at pgsql-hackers and postgresql.org.  Thank. </div><p>Source: <a href="https://habr.com/ru/post/275269/">https://habr.com/ru/post/275269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275251/index.html">Notes on SQL and relational algebra</a></li>
<li><a href="../275255/index.html">We write MVP application on Kotlin for Android</a></li>
<li><a href="../275259/index.html">Bareos: tapes, Hyper-V and more</a></li>
<li><a href="../275265/index.html">The digest of interesting materials for the mobile # 136 developer (on January 11-17)</a></li>
<li><a href="../275267/index.html">Personal account for dealers in 5 minutes</a></li>
<li><a href="../275271/index.html">The story of one integration, or how we stopped worrying and fell in love with InterSystems Ensemble</a></li>
<li><a href="../275273/index.html">How to reduce the number of measurements and benefit from it</a></li>
<li><a href="../275275/index.html">Microsoft will force new microprocessor owners to switch to Windows 10</a></li>
<li><a href="../275279/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ194 (January 11 - 17, 2016)</a></li>
<li><a href="../275281/index.html">Rating system in a high load project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>