<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ObjectManager in the Yandex.Maps API. How to quickly draw 10,000 marks on the map and not slow down everything around</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Developers who use the Yandex.Maps API often have the task of displaying many objects on the map. Indeed, there are a lot - about 10,000. And this tas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ObjectManager in the Yandex.Maps API. How to quickly draw 10,000 marks on the map and not slow down everything around</h1><div class="post__text post__text-html js-mediator-article">  Developers who use the Yandex.Maps API often have the task of displaying many objects on the map.  Indeed, there are a lot - about 10,000. And this task is relevant for us too - try to look for pharmacies on Yandex.  At first glance it seems: ‚ÄúWhat is the actual problem?  Take it and show it. ‚Äù  But until you start doing this, you will not understand that the problems are in fact a whole car. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/243665/"><img src="https://habrastorage.org/files/93d/0ff/738/93d0ff7383994f9ab91f5be3aac5232d.jpg"></a> <br><br>  Questions on a large number of tags with enviable regularity come to our club and technical support.  Who are all these people?  Who might be interested to show more than 10 tags on the map?  In this post I will examine in detail the entire car of problems and tell you how tools appeared in the API that help developers optimally show a large number of objects on the map. <br><a name="habracut"></a><br>  Basically, the problem faced by information services that want to bind the data to the map.  For example, the site bankomator.ru tells users where to find the ATM of the desired bank. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/03c/401/570/03c40157090c4d039fe324e23a684591.png"><br><br>  Real estate resources also suffer from a large amount of data.  A striking example is Cian.ru. <br><br><img src="https://habrastorage.org/files/b03/906/910/b039069105664c979322899d4bae1e1e.png"><br><br>  Until recently, we ourselves inside Yandex advised adjacent teams various ‚Äúhacks‚Äù and techniques for displaying a multitude of points through the API.  Vivid examples are Yandex.Real estate and Yandex.Taxi. <br><br><img src="https://habrastorage.org/files/01d/0e6/e9d/01d0e6e9dd6043c083668a51c430992c.png"><br><br><h3>  Item 1. What is the problem? </h3><br>  In order to feel the full brunt of the task, you need to try to solve it.  First, let's understand how to show the map on the page of your service.  Consider a simple scheme: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/33e/83e/c6f/33e83ec6f56341a79c0adb1de12f9b1a.png"></div><br><br>  A client (for example, Safari on iPhone) requests the index.html page from the server.  A page is a document with this code: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//api-maps.yandex.ru/2.1/?lang=ru_RU"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> ymaps.ready(init); </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">init</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> myMap = </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> ymaps.Map(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'map'</span></span></span><span class="actionscript">, { center: [</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">55.76</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">37.64</span></span></span><span class="actionscript">], zoom: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">10</span></span></span><span class="actionscript"> }); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Now we complicate the task.  We have a database that stores the addresses of Zenit fans.  And we want to show on the map the addresses of these fans. <br><br>  Solving the problem "in the forehead": <br><ol><li>  We make a sample from the database, we get 1 billion addresses. </li><li>  We add in the file index.html an array containing all one billion addresses. </li><li>  We transfer this file to the client. </li><li>  On the client, we loop through the array data and draw a label on the map for each element. </li></ol><br><br>  If you are a project manager, and your developer demonstrates such a solution, you will most likely turn gray.  You tell him your value judgment.  If you remove obscene language, you can select the following theses: <br><ul><li>  The weight of the index.html file will increase to several MB and the page will open in seconds for a user. </li><li>  Why transfer an entire database to a client if you only need to show tags for Moscow? </li><li>  Why draw ALL tags on a map if a person sees only a tenth of them? </li><li>  If the map draw about 100-200 labels in the usual way, the map will slow down. </li><li>  Can I load tags gradually, in batches, so that the channel does not clog and the browser has time to draw these tags? </li></ul><br><br>  Thought gets two directions: <br><ol><li>  You need to be able to determine what data the user sees and only request what they need. </li><li>  When this necessary came, it must be optimally drawn. </li></ol><br>  A hundred years ago, a tool for solving these tasks was made in the Yandex.Maps API - technology of active areas.  Who cares in detail, <a href="https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/hotspots/about-hotspots-docpage/">read the developer's guide</a> . <br><br>  In short, you generate transparent images on the server with tags, plus a text description of the tags.  The client can monitor the visible area of ‚Äã‚Äãthe map and request data that is needed for the current visible area of ‚Äã‚Äãthe map. <br><br>  With the help of hotspots, for example, traffic jams are drawn on maps.yandex.ru.  On the same technology made site bankomator.ru. <br><br><img src="https://habrastorage.org/files/421/bb5/cfd/421bb5cfd6b84439aa5be6b9cf3ec8f1.png"><br><br>  This technology has several significant drawbacks. <br>  1. <b>Very difficult server part.</b>  Try at your leisure to write a module that generates such images and their geometric descriptions, and you will understand everything. <br><br><div style="text-align:center;"><img width="256" src="https://habrastorage.org/files/fba/4da/371/fba4da37164742cdbf44a645228ee962.png"></div><br><br>  2. <b>Absolute inflexibility.</b>  It is impossible to "lift" the label when you hover over it.  It is not possible to quickly change the appearance of tags on the client.  In short - for any sneeze you need to ask the server to regenerate the image. <br><br>  Therefore, users were spinning as they could, without hotspots ‚Äî they transferred sets of single objects to the client in batches, through a timeout.  At the same time on the client they were waiting for problems again.  If you transferred 1000 points to a client, how do you draw them? <br><br>  From each point it was necessary to generate the object <code>ymaps.Placemark</code> and add it to the map.  You could add labels to the clusteriser ( <code>ymaps.Clusterer</code> ) and add unclustered labels to the map.  Here you need to note that when clustering 10,000 points, you must first instantiate these 10,000 points, and then transfer them to the clustering unit.  That is, the label may not appear on the map, since it will be included in the cluster, but we will still spend time on its initialization. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/a61/2a6/f59/a612a6f597e94b64800da00c89f46cdb.png"></div><br><br>  Summing up all these cases, we decided to write a module that would allow: <ol><li>  Quickly and easily draw a large number of points on the client. </li><li>  Avoid unnecessary initialization when working with points on the client. </li><li>  Download data to the client strictly on demand. </li></ol><br>  And we did it.  <s>We seals.</s> <br><br><h3>  Point 2. Draw tags quickly. </h3><br>  To learn how to draw labels quickly, it was necessary to understand what problems lie in the current, already existing solution.  Let's see what the <code>ymaps.Placemark</code> object can do: <br><ol><li>  He knows how to draw on the map. </li><li>  He has his own balloon manager, <code>placemark.balloon.</code> </li><li>  He has his hint manager <code>placemark.hint.</code> </li><li>  He has an editor that allows you to drag a tag and fix its coordinates <code>placemark.editor</code> . </li></ol><br>  In addition, the label dynamically reacts to any change in the external environment - changing options, data, map projections, changing the scale of the map, changing the center of the map, and much, much more.  Such here we have powerful placemarks. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/files/8db/5c6/e07/8db5c6e0739b4088a30de14c0bd2c106.png"></div><br><br>  Do you need all this software power for the case when the developer just needs to show a lot of similar labels on the map?  Correct, not needed. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/8eb/308/8e1/8eb3088e1c9b4e1cb9e60fc5b0b7dd2d.png"></div><br><br>  Therefore, the first insight was as follows: let's move out all the auxiliary modules of tags into one common component and for each individual object we will create only a program entity that is directly responsible for drawing. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/dfe/2ff/eaf/dfe2ffeaf8cf455a8bc4362d76fa36c3.png"></div><br><br>  The second insight came when we thought about the problem of unnecessary software initialization.  We recall the story above, somewhere in the area of ‚Äã‚Äãsuch a picture. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/a61/2a6/f59/a612a6f597e94b64800da00c89f46cdb.png"></div><br><br>  We wanted to get rid of unnecessary software initialization, and we came up with a brilliant.  Sit back, now there will be a revelation: if unnecessary program initializations prevent you, do not do them. <br>  We decided that we would store user data about objects (in fact in JSON), and program entities for objects will be created only when an object needs to be drawn on the map. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/dba/4cd/4ac/dba4cd4ac228498ea56f9c3ff39897d8.png"></div><br><br>  After a combination of these ideas and some development, a new API module was born to display a large number of point objects - <a href="https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/object-manager/about-docpage/">ymaps.ObjectManager</a> . <br><br>  A JSON description of the objects is fed to the input of this manager. <br>  The manager analyzes which labels fall into the visible area of ‚Äã‚Äãthe map and either draws labels or clusters these labels and shows the result on the map. <br><br>  For drawing labels and clusters on the map, we took only part of the <code>ymaps.Placemark</code> object (namely, ymaps.overlay. *), Which was responsible only for displaying the label on the map.  We carried the entire infrastructure like baluns and hints into a single common component. <br><br>  These techniques allowed us to make good progress in the matter of drawing a large number of labels on the client.  Here are the speed gains we received: <br><br><img src="https://habrastorage.org/files/1d8/d31/57f/1d8d3157f4324a66b46c2381296a6be7.png"><br>  <i>Chart 1. The speed of creating and adding objects to the map, followed by asynchronous drawing of their visible part</i> <br><br><ol><li>  Create 1000 tags and add them to the map, all tags are visible. </li><li>  Creating 1000 tags and adding them to the map with clustering, all tags are visible. </li><li>  Create 10,000 labels and add them to the map with clustering, all labels are visible. </li><li>  Creating 50,000 tags and adding them to the map with clustering, all tags are visible. </li><li>  Creating 50,000 labels and adding them to the map with clustering, 500 objects are visible. </li><li>  Creating 50,000 tags and adding them to the map without clustering, 10,000 are visible. </li></ol><br><br><img src="https://habrastorage.org/files/1b0/6d3/c06/1b06d3c0650c43949bb45a2ee88dbec0.png"><br>  <i>Chart 2. The speed of creating and adding objects to the map, followed by synchronous drawing of their visible part</i> <br><br><ol><li>  Create 1000 tags and add them to the map, all tags are visible. </li><li>  Creating 1000 tags and adding them to the map with clustering, all tags are visible. </li><li>  Create 10,000 labels and add them to the map with clustering, all labels are visible. </li><li>  Creating 50,000 tags and adding them to the map with clustering, all tags are visible. </li><li>  Creating 50,000 labels and adding them to the map with clustering, 500 objects are visible. </li><li>  Creating 10,000 tags and adding them to the map without clustering, 2000 are visible. </li><li>  Creating 5000 tags and adding them to the map without clustering, 1000 are visible. </li></ol><br><br>  <b>Important note.</b>  All these statistics are valid for modern browsers.  IE8 is not one of these browsers.  Therefore, for him the numbers will be much worse, but I think for most it does not matter. <br><br>  We managed to speed up the creation and rendering of objects directly, in addition to this, we optimized the initialization of program entities as much as possible.  Now you can, for example, otklasterizovat 50 000 points on the client, and it will be comfortable to work with the card. <br><br>  You can read more about the module in <a href="https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/object-manager/about-docpage/">our developer‚Äôs guide</a> , and see the live examples of how the module works in the <a href="https://tech.yandex.ru/maps/jsbox/2.1/object_manager">sandbox</a> . <br><br>  So, we learned to quickly draw and cluster points on the client.  What's next? <br><br><h3>  Point 3. Optimally load the data. </h3><br>  Remember an example about Zenit fans?  We solved the problem of drawing data on the client, but did not solve the problem associated with the optimal loading of this data.  We began to collect typical tasks for users of the API.  According to the results of the research, we received two model cases: <br><ol><li>  A person on the server has a lot of data, he wants to show it on the client, but load the data as needed. </li><li>  The developer prepares data on the server (for example, implements server clustering) and wants to show the results of this processing on the client. </li></ol><br><br>  To solve these cases, the <b>LoadingObjectManager</b> and <b>RemoteObjectManager</b> modules, <b>respectively,</b> were written. <b>Both</b> modules are essentially based on the <b>ObjectManager</b> implementation, but have a number of differences in the loading and caching algorithm of the loaded data. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/930/8d6/cc0/9308d6cc086f418ebea47547e729cdaa.png"></div><br><br>  As a result, as the user works with the card, he will receive data from your database.  At some point, all or the necessary part of the data will be loaded and requests to the server will generally cease to be sent. <br><br>  The data is stored on the client in the pr-tree, so even for a large amount of data, samples are made quite quickly. <br><br>  Now let's discuss option number two ‚Äî displaying server clustering results on the client.  Suppose you have written server clustering labels.  You also wrote a script that, upon request from a client, can give clusters and single tags that are not included in the cluster. <br><br>  You just have to create an instance of <b>RemoteObjectManager</b> and set the path to this wonderful script in it.  <b>RemoteObjectManager</b> will work in much the same way as <b>LoadingObjectManager</b> .  The difference will only be that we will re-request data from the server every time the zoom is changed. <br><br>  Since the data is clustered on the server, the server and only the server can know what data is needed and which one does not need to be shown at the moment on the map.  Therefore, information about objects is stored on the client only until the first change of the zoom, and then everything is requested again. <br><br>  If the description of the cluster label is transmitted from the server, then on the client these labels will pick up the entire infrastructure from the API - special icons will be drawn for the clusters, all standard behaviors will work for them, and so on and so forth. <br><br><h3>  Item 4. Reflections on server implementation </h3><br>  In this section, we want to list the concepts of data storage and processing on the server, which we assumed when designing the client part.  Let's go from simple to complex. <br><br><h4>  1. Storing information about objects on the server in static files </h4><br>  The client code operates on data exclusively by the secret.  A tile is some numbered area on a map.  More information about the numbering of tiles can be found in our documentation. <br><br><img src="https://habrastorage.org/files/f91/516/714/f9151671472f49a9b2a345806825a4f1.png"><br><br>  When a certain area of ‚Äã‚Äãthe map is shown on the page, the client module calculates which tiles fall into this visible area, checks for the availability of the required data and sends requests for data as needed. <br><br>  The client module has settings that make it necessary to send requests for each new tile separately.  How is this valuable?  Yes, the fact that we get a finite number of client request options to the server. <br><br>  zoom = 0, tile = [0, 0] <br>  zoom = 1, tile = [0, 0] <br>  zoom = 1, tile = [0, 1] <br>  zoom = 1, tile = [1, 0] <br>  zoom = 1, tile = [1, 1] <br>  zoom = 2, tile = [0, 0] <br>  ... <br><br>  Since requests are known in advance, responses to requests can also be generated in advance.  We organize some kind of file structure on the server. <br><br><img width="250" src="https://habrastorage.org/files/7d9/3b8/cf7/7d93b8cf78dc4e2db3bb46692b03eabd.png"><br><br>  The files will contain the following code: <br><br><pre> <code class="javascript hljs">myCallback_x_1_y_2_z_5({ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"FeatureCollection"</span></span>, <span class="hljs-string"><span class="hljs-string">"features"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Feature"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"geometry"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Point"</span></span>, <span class="hljs-string"><span class="hljs-string">"coordinates"</span></span>: [<span class="hljs-number"><span class="hljs-number">55.831903</span></span>, <span class="hljs-number"><span class="hljs-number">37.411961</span></span>] }, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"balloonContent"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"clusterCaption"</span></span>: <span class="hljs-string"><span class="hljs-string">" 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"hintContent"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } }, ... ] }</code> </pre><br><br>  When loading such a file on the client, JSONP-callback will be called, written in the file.  The data will fall into the bowels of LoadingObjectManager, cached and drawn in the desired form. <br><br>  As a result, just static files with data sets can be stored on the server, and the client part itself decides what to ask and when to show it. <br><br><h4>  2. Dynamic formation of a response from static files </h4><br>  A significant disadvantage of the above solution is a large number of requests for data from the client to the server.  It is much more expedient to send a request for several tiles at once than to request data for each tile separately. But in order to process requests for groups of tiles, you will have to write some server code. <br><br>  In this case, the data can continue to be stored in separate files.  When the client receives a request for data in a certain rectangular area, it will suffice to glue the contents of several files into one answer and send it back to the client. <br><br><h4>  3. Dynamic response generation using a database </h4><br>  The most correct, in our opinion, way is to implement the server part using any database that can index geolocated data.  For any database that does not support spatial indexes, you can create a similar index yourself using the <a href="https://karussell.wordpress.com/2012/05/23/spatial-keys-memory-efficient-geohashes/">concept of spatial keys</a> . <br><br>  In general, storing georeferenced data on a server and clustering them is a topic for a separate conversation.  So we will discuss another time. <br><br>  <a href="https://github.com/dimik/geohosting-server">In this repository</a> lives an example of the implementation of the server-side with server-based clustering, written in node.js + mongo.db.  can someone come in handy ( <a href="http://dimik.github.io/ymaps/examples/2.1/remote-object-manager/">Demo</a> ). <br><br><h3>  Conclusion </h3><br>  Comparative table of new modules. <br><br><table><tbody><tr><th>  Module </th><th>  Benefits </th><th>  disadvantages </th></tr><tr><td>  Objectmanager </td><td>  Allows clustering of objects on the client. <br><br>  Rendering is performed only for those objects that fall into the visible area of ‚Äã‚Äãthe map. <br><br>  Allows you to filter objects when they are displayed. <br><br>  There is no need to implement the server part, since all data processing is done on the client side. <br></td><td>  Supports work only with tags. <br><br>  Data is loaded for all objects at once (even for those that do not fall into the visible area of ‚Äã‚Äãthe map). <br><br>  Object clustering is performed on the client side. </td></tr><tr><td width="200">  LoadingObjectManager </td><td>  Allows clustering of objects on the client. <br>  Loads data only for the visible area of ‚Äã‚Äãthe map. <br><br>  Saves the downloaded data.  For each object, the data is loaded only once. <br><br>  Allows you to filter objects when they are displayed. <br></td><td>  Supports work only with tags. <br><br>  Object clustering is performed on the client side. <br><br>  It is necessary to implement the server part. <br></td></tr><tr><td>  RemoteObjectManager </td><td>  Uses server data clustering. <br><br>  Object data is stored on the server.  Each time the data is loaded only for those objects that fall into the visible area of ‚Äã‚Äãthe map. <br></td><td>  Supports work only with tags. <br><br>  When the zoom factor is changed, the data is reloaded (even for those objects for which data has already been loaded). <br><br>  You must implement your own clustering. <br><br>  It is necessary to implement the server part. <br></td></tr></tbody></table><br><br>  At the moment we support the work only with point objects.  Support for polygons, polylines and other beautiful shapes is in our plans and will appear in future releases. <br><br>  When should you think about using these modules?  Almost in any situation when you need to draw a lot of point objects on the map. <br><br>  Useful links: <br><ol><li>  Detailed developer's guide with images - <a href="https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/many-objects-docpage/">tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/many-objects-docpage</a> . </li><li>  Sandbox examples - <a href="https://tech.yandex.ru/maps/jsbox/2.1/object_manager">tech.yandex.ru/maps/jsbox/2.1/object_manager</a> </li><li>  The github project with an example of the implementation of the server part for RemoteObjectManager - <a href="https://github.com/dimik/geohosting-server">github.com/dimik/geohosting-server</a> . </li><li>  Yandex.Maps API Developer Club where you need to come with questions - <a href="http://clubs.ya.ru/mapsapi">clubs.ya.ru/mapsapi</a> . </li></ol></div><p>Source: <a href="https://habr.com/ru/post/243665/">https://habr.com/ru/post/243665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243651/index.html">Mosh - SSH with blackjack and roaming</a></li>
<li><a href="../243655/index.html">Time-lapse camera on STM32L</a></li>
<li><a href="../243657/index.html">Ways to transfer financial data # 2: FAST protocol</a></li>
<li><a href="../243659/index.html">[Peter] Meeting with the OpenSource TechSlide Embox OS: Modern firmware and Tanenbaum classics</a></li>
<li><a href="../243663/index.html">Vulnerability in Android <5.0 (ObjectInputStream)</a></li>
<li><a href="../243667/index.html">ASP.NET 5 Overview</a></li>
<li><a href="../243669/index.html">White Cube on guard of air purity, part 1</a></li>
<li><a href="../243671/index.html">Looking for the answer to the question of how to make people more responsible ...</a></li>
<li><a href="../243673/index.html">Monitoring and data center management system</a></li>
<li><a href="../243675/index.html">About agile-methodology. Subjectively</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>