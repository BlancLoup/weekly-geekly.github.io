<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Minimalistic system of division of rights into groups in 5 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tired of ACL? Perhaps the easiest solution is to divide rights into groups. No ACL tables, no rights tree. But if you need to set the rights personall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Minimalistic system of division of rights into groups in 5 minutes</h1><div class="post__text post__text-html js-mediator-article"> Tired of ACL?  Perhaps the easiest solution is to divide rights into groups.  No ACL tables, no rights tree.  But if you need to set the rights personally for each user, then this decision is definitely not for you. <br><a name="habracut"></a><br>  We only have 5 minutes, so let's get started right away. <br><br>  Create or modify database tables with users and groups, so that they look like this: <br><br> <code><font color="black">users <br> id - primary <br> username - unique <br> password <br> group_id <br> groups <br> id - primary <br> name - unique</font></code> <br> <br>  Then we create several groups and users.  Do not forget to create the group "Administrators" 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, create classes of user and group models. <br><br> <code><font color="black"><font color="#3A00FF">&lt;?php</font> <br> <font color="#3A00FF">class</font> User <font color="#3A00FF">extends</font> AppModel <font color="#009900">{</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$name</font> <font color="#339933">=</font> <font color="#0000ff">'User'</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$displayField</font> <font color="#339933">=</font> <font color="#0000ff">'username'</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$belongsTo</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'Group'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'className'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'Group'</font> <font color="#339933">,</font> <br> <font color="#0000ff">'foreignKey'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'group_id'</font> <br> <font color="#009900">)</font> <br> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <font color="#000000">?&gt;</font></font></code> <br> <br> <code><font color="black"><font color="#3A00FF">&lt;?php</font> <br> <font color="#3A00FF">class</font> Group <font color="#3A00FF">extends</font> AppModel <font color="#009900">{</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$name</font> <font color="#339933">=</font> <font color="#0000ff">'Group'</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$displayField</font> <font color="#339933">=</font> <font color="#0000ff">'name'</font> <font color="#339933">;</font> <br> <br> <font color="#3A00FF">var</font> <font color="#000088">$hasMany</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'User'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'className'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'User'</font> <font color="#339933">,</font> <br> <font color="#0000ff">'foreignKey'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'group_id'</font> <font color="#339933">,</font> <br> <font color="#0000ff">'dependent'</font> <font color="#339933">=&gt;</font> <font color="#3A00FF">false</font> <br> <font color="#009900">)</font> <br> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#009900">}</font> <br> <font color="#000000">?&gt;</font></font></code> <br> <br>  And add the following code to <i>app_controller.php</i> : <br><br> <code><font color="black"><font color="#3A00FF">&lt;?php</font> <br> <font color="#3A00FF">class</font> AppController <font color="#3A00FF">extends</font> Controller <font color="#009900">{</font> <br> <br> <font color="#3A00FF">var</font> <font color="#000088">$components</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'Auth'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$permissions</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#3A00FF">function</font> beforeFilter <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">fields</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'username'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'username'</font> <font color="#339933">,</font> <font color="#666666">//      </font> <br> <font color="#0000ff">'password'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'password'</font> <font color="#666666">//   </font> <br> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">authorize</font> <font color="#339933">=</font> <font color="#0000ff">'controller'</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">autoRedirect</font> <font color="#339933">=</font> <font color="#3A00FF">false</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">loginAction</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'controller'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'users'</font> <font color="#339933">,</font> <font color="#0000ff">'action'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'login'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">logoutRedirect</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'controller'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'users'</font> <font color="#339933">,</font> <font color="#0000ff">'action'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'login'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">loginRedirect</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'controller'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'users'</font> <font color="#339933">,</font> <font color="#0000ff">'action'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'welcome'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#009900">}</font> <br> <br> <font color="#3A00FF">function</font> isAuthorized <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">user</font> <font color="#009900">(</font> <font color="#0000ff">'group'</font> <font color="#009900">)</font> <font color="#339933">==</font> <font color="#0000ff">''</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF">true</font> <font color="#339933">;</font> <font color="#666666">//        ""    ,   </font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">permissions</font> <font color="#009900">[</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">action</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">permissions</font> <font color="#009900">[</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">action</font> <font color="#009900">]</font> <font color="#339933">==</font> <font color="#0000ff">'*'</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF">true</font> <font color="#339933">;</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">in_array</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">user</font> <font color="#009900">(</font> <font color="#0000ff">'group'</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">permissions</font> <font color="#009900">[</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">action</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#3A00FF">true</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <font color="#b1b100">return</font> <font color="#3A00FF">false</font> <font color="#339933">;</font> <br> <br> <font color="#009900">}</font> <br> <br> <font color="#009900">}</font> <br> <font color="#000000">?&gt;</font></font></code> <br> <br>  Add the <i>following</i> lines to <i>users_controller.php</i> : <br><br> <code><font color="black"><font color="#3A00FF">&lt;?php</font> <br> <font color="#3A00FF">class</font> UsersController <font color="#3A00FF">extends</font> AppController <font color="#009900">{</font> <br> <br> <font color="#3A00FF">var</font> <font color="#000088">$name</font> <font color="#339933">=</font> <font color="#0000ff">'Users'</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$helpers</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'Html'</font> <font color="#339933">,</font> <font color="#0000ff">'Form'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#3A00FF">var</font> <font color="#000088">$permissions</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'logout'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'*'</font> <font color="#339933">,</font> <br> <font color="#0000ff">'welcome'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'*'</font> <br> <font color="#009900">)</font> <font color="#339933">;</font> <br> <br> <font color="#3A00FF">function</font> welcome <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#009900">}</font> <br> <br> <font color="#3A00FF">function</font> login <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">user</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Session</font> <font color="#339933">-&gt;</font> <font color="#004000">write</font> <font color="#009900">(</font> <font color="#0000ff">'Auth.User.group'</font> <font color="#339933">,</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">User</font> <font color="#339933">-&gt;</font> <font color="#004000">Group</font> <font color="#339933">-&gt;</font> <font color="#004000">field</font> <font color="#009900">(</font> <font color="#0000ff">'name'</font> <font color="#339933">,</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">'id'</font> <font color="#339933">=&gt;</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">user</font> <font color="#009900">(</font> <font color="#0000ff">'group_id'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">redirect</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">redirect</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <font color="#009900">}</font> <br> <br> <font color="#3A00FF">function</font> logout <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">redirect</font> <font color="#009900">(</font> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">logout</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#009900">}</font> <br> <br> <font color="#666666">//      ,  add, edit, delete</font> <br> <font color="#000000">?&gt;</font></font></code> <br> <br>  Well, actually, that's all.  Now, in order to specify access rights, you need to add $ permissions for any controller as we did in users_controller <br><br><h6>  How it works: </h6><br>  When a user logs in, we add the name of his group to the Auth session.  After when we call the controller method, the Auth component calls our isAuthorized function and if it returns true, the user gets access, and if it returns false, it denies it.  If the user is in the "Administrators" group, then he always gets access.  The isAuthorized function checks the $ permissions array specified in each controller using the name of the current action as the key and if the user group is in the array using this key (well, or instead of an array, there is a '*' - that is, everyone) then the user is allowed access. <br>  Note: It is understood that you are still authorized, even if the access level is '*'.  You can allow unauthorized users to log in using the Auth-&gt; allow method <br>  Note: We did not define access to users / login because Auth allows access to it by default. <br><br><h6>  Example: </h6><br>  Suppose we want to allow the Moderators group to delete users.  Add the following code to <i>users_controller.php</i> : <br><br> <code><font color="black"><font color="#3A00FF">var</font> <font color="#000088">$permissions</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br> <font color="#0000ff">'logout'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'*'</font> <font color="#339933">,</font> <br> <font color="#0000ff">'welcome'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'*'</font> <br> <font color="#0000ff">'delete'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">''</font> <font color="#009900">)</font> <br> <font color="#009900">)</font> <font color="#339933">;</font></font></code> <br> <br>  But after all, users who are not logged in will not be able to register.  Add to <i>users_controller.php</i> : <br><br> <code><font color="black"><font color="#3A00FF">function</font> beforeFilter <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br> <font color="#000088">$this</font> <font color="#339933">-&gt;</font> <font color="#004000">Auth</font> <font color="#339933">-&gt;</font> <font color="#004000">allow</font> <font color="#009900">(</font> <font color="#0000ff">'signup'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#3A00FF">parent</font> <font color="#339933">::</font> <font color="#004000">beforeFilter</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br> <font color="#009900">}</font></font></code> <br> <br>  I hope this decision helped you.  This is an extremely simple solution for dividing rights into groups, but of course it has its drawbacks.  For example, you cannot allow a user to change an article only if he created it.  Well, at least without changing the above code.  But I will leave it for you. </div><p>Source: <a href="https://habr.com/ru/post/69182/">https://habr.com/ru/post/69182/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../69175/index.html">Microsoft SQL Driver for PHP comparative review</a></li>
<li><a href="../69177/index.html">Windows 7 Launch party</a></li>
<li><a href="../69178/index.html">Asus UL50: the world's first 12-hour laptop</a></li>
<li><a href="../69180/index.html">osi.od.ua - banners are spreading malware</a></li>
<li><a href="../69181/index.html">Minimalistic platformer "Green-gray world: not for loosers"</a></li>
<li><a href="../69184/index.html">Multitouch-wall in Hard Rock Cafe</a></li>
<li><a href="../69185/index.html">Bluetooth Mobile Keyboard 6000 - the thinnest keyboard</a></li>
<li><a href="../69188/index.html">MonoDevelop 2.2 Beta Update</a></li>
<li><a href="../69189/index.html">"Your K.O." or habrana observation</a></li>
<li><a href="../69191/index.html">Quality literature on weekdays. Short</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>