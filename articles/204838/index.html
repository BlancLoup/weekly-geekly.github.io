<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Talk about Intel¬Æ Cilk ‚Ñ¢ Plus</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My recent post about OpenMP 4.0 gave me an idea that it would be nice to write about Intel Cilk Plus, because the programming model is very interestin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Talk about Intel¬Æ Cilk ‚Ñ¢ Plus</h1><div class="post__text post__text-html js-mediator-article">  My recent <a href="http://habrahabr.ru/company/intel/blog/204668/">post about OpenMP 4.0</a> gave me an idea that it would be nice to write about Intel Cilk Plus, because the programming model is very interesting and certainly deserves special attention.  Well, since its part became in fact a new OpenMP standard, then there were probably good reasons. <br><a name="habracut"></a><br>  I'll start with the history of the name itself. <br>  So, how it all began.  Since 1994, MIT has developed the Cilk language, which made it easy to implement task parallelism.  Moreover, it was an extension for the C language, because by removing all the Cilk keywords from the source, it turned into a completely correct and easily compiled code from the compiler.  Naturally, in time, the commercial version of Cilk appeared, which was called Cilk ++.  She, in turn, already supported C ++, and was also compatible with gcc and Microsoft compilers, and the commercial organization Cilk Arts, Inc. was already involved in the development.  This is where Intel sneaked up by purchasing Cilk Arts, the Cilk ++ technology and the Cilk trademark.  It is noteworthy that I myself began working at Intel since 2008, and I remember all the stages of Cilk‚Äôs development in our compiler.  So, soon, namely in 2010, the first commercial version called Intel Cilk Plus, which is part of the C ++ compiler of Intel, was released.  Why Plus, you ask?  Yes, because in fact only half of Intel Cilk Plus from the technology Cilk ++, which allowed to introduce parallelism on tasks.  The second half is the part that makes it possible to implement data parallelism and helps to vectorize the code.  Schematically it looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f27/36a/c7b/f2736ac7b9e882233eba6b4a89da5094.png"></div><br><br>  Now you know the ‚Äúsecrets‚Äù of such a long name, and the secret meaning of Plus'a is the part that is responsible for vectorization.  Clearly, marketers have tried and combined two different technologies under the ‚Äúone roof‚Äù.  By the way, it was the vector part that migrated to the new OpenMP, and it was about her that I already partially told in my previous post. <br>  Here I will tell more about Cilk itself.  By the way, the question is very rhetorical, which part is more important and significant for the developer.  If we want to get maximum performance, then we need to use all types of parallelism, so everything is extremely useful.  From personal experience, I use the vectoring part more often and with greater profit.  Of course, this is not related to the fact that tasking Cilk is bad, I just often meet with using OpenMP to parallelize tasks.  Although the Silkovskaya implementation is good. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea is simple - the minimum number of new keywords in the amount of 3 pieces, with the maximum return: <i>cilk_spawn, cilk_sync and cilk_for</i> .  Inside is a modern, easy and efficient task scheduler that captures work for load balancing.  But, about everything in order. <br><br>  If you look at the skeleton of a function in which another function g () is called and the work is performed (abstractly speaking), then it looks like this in a sequential version: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ g(); work work } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ work work }</code> </pre> <br>  Now, we will turn the code into a parallel ‚Äúflick of the wrist‚Äù: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">cilk_spawn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; work work cilk_sync; work }</code> </pre><br>  What is going on here?  We create a task (task) for the possible parallel execution of the g () function, and the work that remained in the f () function until the line cilk_sync (in Cilk's terms - continuation).  A bit of terminology: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/835/5ec/271/8355ec2710b3a4c95a4956eadb983e52.png"></div><br>  It is important that we do not create a thread (thread) and do not say what code to execute in which thread.  All work is based on tasks, which allows you to effectively distribute the load and guarantee parallelism.  How?  Very simple. <br>  We have a pool of threads, let's say for a simple example, that there are only 2 threads. And everyone has a queue of tasks to be performed.  If there is an imbalance, that is, one thread is busy with work, and the other does not have it, then the tasks from the queue of another thread are captured. <br>  And in our example, the continuation of the region will be captured.  Like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/527/4a3/72e/5274a372e4ea862f823c9181b452f9fe.png"></div><br><br>  Thus, we guarantee that all cores will be loaded with work.  By the way, the same scheduler is implemented in Intel Threading Building Blocks (TBB).  <i>cilk_sync</i> is a synchronization point. <br><br>  The cilk_for construct is intended, as Captain Obvious says, to introduce concurrency in for loops.  Why do we need a separate structure?  I will not give a direct answer, but I will give a suggestive example.  What is the difference between the two data cycle? <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; n; ++x) { <span class="hljs-function"><span class="hljs-function">cilk_spawn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span></span>; } cilk_for (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; n; ++x) { f(x); }</code> </pre><br>  In the first case, at each iteration we will create a task, and the operation of capturing someone else's task is very costly in terms of performance.  If in each iteration ‚Äúlittle‚Äù work, then we will lose more than we get with the help of such a ‚Äúparallel‚Äù program. <br><br>  Obviously, spawn needs to be done not at each iteration, but, let's say, only once, and let all other iterations be perceived as continuation.  I think the answer to the question about the need for <i>cilk_for</i> now disappears. <br><br>  Actually, almost everything.  It remains to solve the issue of shared memory.  We have to take care of it ourselves, with the help of reducer'ov.  Shared data are created using templates from Cilk, thereby ensuring safe operation with them. <br><br>  Let's continue our simple example: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sum=<span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">cilk_spawn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; work sum += <span class="hljs-number"><span class="hljs-number">2</span></span>; work } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ work sum++; work }</code> </pre><br>  It is clear that a "bad" situation arises with the common variable sum.  To solve it, we need to declare it like this: <br><br><pre> <code class="cpp hljs">cilk::reducer_opadd&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; sum(<span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre><br>  And you can write your own reducer, inheriting from the classes cilk :: monoid_base and cilk :: reducer.  This, incidentally, has become possible in the latest version of OpenMP. <br>  I hope that I have told enough to understand what is in the Intel Cilk Plus.  Actually, there is almost everything there - both task concurrency through Cilk's keywords, and data concurrency using directives and new syntax (I haven't deliberately talked about this yet).  As you can see, the technology is powerful and gives great potential to use all types of parallelism in your application.  Dare, and ‚ÄúMay the Force be with you‚Äù! </div><p>Source: <a href="https://habr.com/ru/post/204838/">https://habr.com/ru/post/204838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204810/index.html">Prototyping in Axure RP PRO 7</a></li>
<li><a href="../204814/index.html">Grants for Ukrainian mobile developers from AppCampus</a></li>
<li><a href="../204816/index.html">Russia's first competence center for solutions on the IBM System z platform</a></li>
<li><a href="../204834/index.html">CUBA - a platform for rapid development of business applications in Java</a></li>
<li><a href="../204836/index.html">Valve joined the Linux Foundation</a></li>
<li><a href="../204840/index.html">We get i18n list of countries, regions, settlements from VKontakte</a></li>
<li><a href="../204842/index.html">Highscreen Alpha Rage - budget for budget</a></li>
<li><a href="../204844/index.html">Last Saturday of the month: Linux</a></li>
<li><a href="../204846/index.html">How to protect everything with just one SSL certificate</a></li>
<li><a href="../204848/index.html">Translation Airbnb Style Guide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>