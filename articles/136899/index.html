<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to drown in megabytes javascript code? // Reports from the Mail.Ru Technology Forum 2011: text of the report, video, presentation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Report by Andrei Sumin ( habraprofil ) ‚Äú How not to drown in megabytes of JS-code? "- another in a series of transcripts from the Mail.Ru Technology F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to drown in megabytes javascript code? // Reports from the Mail.Ru Technology Forum 2011: text of the report, video, presentation</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>Report by Andrei Sumin ( <sub><a href="http://habrahabr.ru/users/andrewsumin/">habraprofil</a></sub> ) ‚Äú <a href="http://techforum.mail.ru/report/4">How not to drown in megabytes of JS-code?</a></i>  <i>"- another in a series of transcripts from <a href="http://techforum.mail.ru/">the Mail.Ru Technology Forum 2011</a> .</i>  <i>For details on how the report decryption system works, see the article <a href="http://habrahabr.ru/company/mailru/blog/132953/">‚ÄúReverse‚Äù of the Mail.Ru Technologies Forum: High-tech in event-management</a> .</i>  <i>There, as well as on the Forum website ( <a href="http://techforum.mail.ru/">http://techforum.mail.ru</a> ) - links to transcripts of other reports.</i> </blockquote><br><video>  http://video.mail.ru/corp/glavred/ftmailru/84.html </video><br>  <i>( <a href="">Download</a> video version for mobile devices - iOS / Android H.264 480? 368, size 170 Mb, video bitrate 500 kbps, audio - 64 kbps)</i> <br>  <i>( <a href="">Download</a> video version of higher resolution H.264 624? 480, size 610 Mb, video bitrate 1500 kbps, audio - 128 kbps)</i> <br>  <i>( <a href="http://www.slideshare.net/tfmailru/sumin/download">Download</a> presentation slides, 4.7Mb)</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/875/c4b/daf/875c4bdafe7b7263a3d887650f16c48b.jpg" align="left">  I will say right away that in this post there will not even be a mention of the latest "chips" embedded by browsers.  Moreover, I covered this topic for the first time in 2007.  I will tell you about some of the methods of organizing the code, which for 5 years now have helped me and my colleagues successfully develop projects with a lot of JS code. <a name="habracut"></a><br><br>  Let's go back a little, around 2002.  Sites then contained little JS code.  For the most part, Javascript was made with small ‚Äúryushechki‚Äù, like changing the background by hovering.  The project structure was simple and transparent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/01b/52a/5fb/01b52a5fbde069d95580a3ee75df2423.jpg"><br><br>  Since 2005, we have seen rapid development, and already then, vacancies with the title ‚Äújavascript programmer‚Äù appear in RuNet.  Projects have also become a bit more complicated. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/acc/644/52c/acc64452c8acbd2a4db1da328b6825d0.jpg"><br><br>  I singled out common.js not because it is so important, but because it has become big and uncontrollable.  If not one person worked, but a team, everyone would write something different there, at the end of the file.  Support for the project, of course, complicated. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33a/2a3/a73/33a2a3a73add906c9a6e5432ffd11c01.jpg"><br><br>  As a result, we have confusion, a huge file and, the worst thing, in my opinion - there is no code reuse. <br><br>  Specifically, I had this: some functions for escaping strings, for example, html, no one else then knew how to do that.  You come to the project or take the project of another person, you see the function of escaping, you try to apply it, it does not work.  Either the bugs, or the wrong escape, all that is needed, or the extra escape.  It all ended with those (nobody knew for sure about the tests) that I was very afraid to change this function, and just wrote another one next to it.  After some time, I thought, well, wherever I remembered, I changed it to my own, and it‚Äôs definitely better, faster, there are no bugs in it, and, like, you can delete the old one.  But at the last moment the hand trembles, okay leave.  So this code is for future generations. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/130/323/1dc/1303231dc55f54561eada1e3329a76d8.jpg"><br><br>  The following steps were obvious: people just began to divide one large file for some logical parts.  And well, if by logical - usually came out "as it will." <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb7/249/7ce/cb72497cee245cf3418910875a77c22d.jpg"><br><br>  And let's be frank - this, in fact, did not solve the problems.  The size remained, only earlier it was one file, and now it is a folder.  We have new problems - connection problems.  If we hit several files, naturally, we want that on pages where some part of the files are needed, we only include this part of the files.  This problem had to be solved somehow.  And the problem with the maintenance of the connection, because in fact it turned out like this: on all pages they connected all the scripts. <br><br>  The next slide is very important and reflects the main idea of ‚Äã‚Äãmy report. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/249/fe6/e04/249fe6e0435d3e75216eda2c08074474.jpg"><br><br>  The idea is as follows.  Yes, we have a lot of JavaScript, but it is somehow broken, but we need to connect part of it on the pages according to some rules.  Let the resulting HTML, which is the result of working out all our logic, will be the config of what needs to be connected. <br><br>  I will explain.  We have a div tag, which includes some complete block - let's say it will be a list of folders, i.e., in this div is a list of folders.  The first step, we mark with a class - this div is a component.  This means that the js engine will search for it by this mark.  The second line is onclick, return is specified there, and some hash.  This hash contains a description of what this component is. <br><br>  As a result, we need to find the component in the DOM tree.  Determine what this component is (in my case, the type information is in onclick).  Connect js-files to make it all work. <br><br>  The first problem is solved, at least in modern browsers, very easily.  CSS selectors work a lot where natively, and where not natively, you have the appropriate libraries at your disposal. <br><br>  Now the most interesting part is what is written in onclick.  There you can sew any information that you need for initialization.  In my case, this is the type of component, I understand from the contents of the hash that this is a component for working with folders.  To get it is very easy. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/842/174/0a4842174bd4ab42925ad83bf0dfacb6.jpg"><br><br>  Thus, we immediately get a hash with the input data for the component. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e14/bfa/5a6/e14bfa5a6f8167f79eecec33ffa203af.jpg"><br><br>  Require - this is the same function - the heart that will make our entire circuit work.  Naturally, it is much more difficult at some production solution, but this does not change the ideas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/987/282/379/987282379d560b931b874414134b01e8.jpg"><br><br>  This require is written in some library, in some component, that is, in some javaScript file that is responsible for the functionality.  The javascript file with its help tells the kernel that for my work I need file1 and file2.  This is passed to the first argument, and the second argument to the kernel is the function that will be executed after it loads both. <br><br>  A very important point.  The function says loaded (file).  Naturally, the idea has long been new, of course, there are implementations, in addition to the one that I describe.  But in some implementations there is one difference, they try to understand that the functionality is loaded by some metadata.  Suppose the onload event is triggered by a script or something like that.  I basically did not do this: the code that is in javascript, calling the method loaded, he will say for sure that I am ready.  And not because there is something loaded, not because someone thinks that I loaded.  Yes, I booted up, I definitely got what I needed, I‚Äôm definitely ready.  If I call on the chain, who needs me further, then we can safely say about it and not be afraid of anything. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/34c/768/e8b/34c768e8bb6cbb67576a792629c0da00.jpg"><br><br>  Here is how it looks on a small bundle.  Folders need libraries to work with dates. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbc/c6b/07c/cbcc6b07c09ddb53a0b359835523c75f.jpg"><br><br>  In the library for working with dates, strings are needed to display nicely, for example, some implementation of printf is in strings.  And strings are self-sufficient, they do not need anything.  And we have a require chain.  In folders.js, we ask for dates, as we load the dates, we call a function in which the folders themselves tell the kernel that I have dates, I don‚Äôt need anything, I‚Äôm ready to go.  Dates have the same strings.  And strings do not need anything when they are loaded, they say at the end - everything, we loaded, let's work on. <br><br>  We reviewed the complete set of tasks to make our example work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba2/a30/48a/ba2a3048a06de08cb53187b48d5774bd.jpg"><br><br>  First of all, we extract from the DOM tree all the components that are needed.  The second stage determines what this component is, in the hash we will have a component for work, let's say that this is a component for working with the list of letters.  Further require function, here there is the first argument of getFileName (type).  By line, the kernel can understand the real path to the file in order to write the script tag in src.  Accordingly, in our case, this will be folders.js.  Script folders will be loaded.  He will say in require that I need dates, dates will say that I need strings.  3 script tags are generated, in the reverse order, the loaded ones will work and as a result we have a function that says window [type] .init (), it will be executed and the component will start to initialize. <br><br>  But it is too early to rest, we got another problem.  We have quite a load of isolated components, and imagine such a situation - everything seems to be fine.  A manager comes to the developer and says: "I want you to make a calendar." <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbc/c6b/07c/cbcc6b07c09ddb53a0b359835523c75f.jpg"><br><br>  The developer says, here I will have a separate div, I will have a separate file.  I have a library for working with strings, which is covered with tests with dates, a date that is covered with tests, and I make a calendar in 2 days.  Shows the manager, he is happy, shows colleagues in other projects.  They come again to you. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63b/2ea/970/63b2ea97005bd0d64f1e856871123d9d.jpg"><br><br>  It seems to be the same calendar, but the number of interfaces that different people want for this beautiful licked thing is slightly depressing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a9/730/f6f/1a9730f6fff9f71fdab3a0a4bbb7d876.jpg"><br><br>  Then you have the following options: you can do a very long design, do abstractions, do abstractions over abstractions, but believe me, after three months, and if you are a brilliant programmer, after six months, another programmer will come to your place, he will be surprised . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/869/3b3/134/8693b31346040cd3a20f720ffae309f1.jpg"><br><br>  We are all people, we all understand that everything is impossible to take into account, so there is no new pattern, it has been used in programming for a long time.  Moreover, from the very beginning, with the advent of JavaScript, which is used to the full in browsers, these are events.  You make the calendar, make it systemic, make it inviolable, but make it an event API. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e5/e68/359/4e5e683592add2eacb58b5395ca484b7.jpg"><br><br>  It is very easily scaled, it is very easily covered with tests, and the programmer who came to write down his little thing is very easy and do not touch your code. <br><br>  It would seem that everything is just fine now.  We have a config in html, we have a download of components, by request, according to the html that is.  We have an interface for communicating components with each other.  But there was another problem. <br><br>  If you know today, then tomorrow you don‚Äôt know the order of initialization of components.  Imagine such a situation: met the calendar.  He began to boot, booted, initialized.  After initialization, I threw an event that I will now put on the date on November 7th.  All he has already done, only after this, the DOM contains a small component that should be written on November 7th.  He hangs on the event, and the event has already happened.  He is no longer there. <br><br>  The solution was from the server programming section, I was prompted.  It exists a long time ago and is called - queues. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b0/b9e/f26/2b0b9ef26bae491314cee81b22372bce.jpg"><br><br>  We add one more argument to the dispatch method, I highlighted it in red ,.  This is the size of the queue.  The calendar during its initialization makes dispatch, since we have a callback object.  He tells him that the queue size of such events is one, i.e.  if someone subscribes to a similar event and has not received anything yet, then he will receive events via the first in first out stack.  The queue length will be equal to the size of the digit indicated on the last argument.  And he, accordingly, receives all these events. <br><br>  As for mail.ru, I have not been working here for a year, but for only 4 months, I thought that I would come with a long raincoat now, and show everyone here how to live.  And on the very first day, when I saw the source code of JavaScript mail.ru I realized that they wrote almost the same thing.  Mostly even to letters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/309/7cc/89b/3097cc89b4b45ff41e14b8290c386911.jpg"><br><br>  <i>This text is based on the report of Sumin Andrei at <a href="http://techforum.mail.ru/">the Mail.Ru 2011 Technology Forum</a> , held on November 16 in the center of Infospace.</i>  <i>Details about the technology of creating texts of reports based on video recordings can be found here: <a href="http://habrahabr.ru/company/mailru/blog/132953/">‚ÄúWrong side‚Äù of the Mail.Ru Technologies Forum: High-tech in event-management</a> .</i>  <i>Video versions of other reports (including versions for mobile devices) are available on the Forum website - <a href="http://techforum.mail.ru/">techforum.mail.ru</a> .</i>  <i>Text versions of the reports will be published here and on the Forum website every week or less often in a similar format.</i>  <i>Please report in the "lichku" about typos in the text.</i> </div><p>Source: <a href="https://habr.com/ru/post/136899/">https://habr.com/ru/post/136899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136893/index.html">Windows Azure Toolkits for Devices - using Windows Azure on mobile platforms</a></li>
<li><a href="../136894/index.html">I do not share the tribulation of MegaUpload</a></li>
<li><a href="../136895/index.html">Dependency injection in the MVC 3 Framework by the example of Autofac</a></li>
<li><a href="../136896/index.html">Glonass in Ukraine</a></li>
<li><a href="../136897/index.html">HTML KickStart is another way to quickly create an interface for your web application.</a></li>
<li><a href="../136900/index.html">Pavel Durov spoke at the DLD 2012 conference</a></li>
<li><a href="../136901/index.html">Form Analytics - new Yandex.Metrics tool</a></li>
<li><a href="../136904/index.html">To-do list by Leonardo da Vinci</a></li>
<li><a href="../136905/index.html">Increase programming performance (mental map)</a></li>
<li><a href="../136906/index.html">Donor blood.rf - quick search for blood donor in emergency situations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>