<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MyHTML - HTML parser on the "bare" C with POSIX Threads support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 As it was possible to guess from the title, we will focus on HTML parsing (hereinafter referred to as html). 

 Preamble 

 Once I got the i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MyHTML - HTML parser on the "bare" C with POSIX Threads support</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b34/3fb/56b/b343fb56b3d54fe389d0186d98b27269.png" alt="image"><br><br>  Hello! <br><br>  As it was possible to guess from the title, we will focus on HTML parsing (hereinafter referred to as html). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  <b>Preamble</b> <br><br>  Once I got the idea of ‚Äã‚Äã"X", but for its implementation, you need a calculated DOM with all the styles and buns.  Googling and Yandex showed nothing good.  There are all sorts of wrappers for WebKit, but they do not work on all platforms, and very cropped.  There are projects where WebKit is wrapped in a certain frontend with which you work via JavaScript.  Something was tried, but the result was deplorable.  Consumption of resources which only cost. <br><br>  <b>Wishlist</b> <br><br>  But I wanted, as it seemed, not so much: <br><ol><li>  Renderer html without wild dependencies.  Only a renderer, the network would fall on the user.  In other words, the full calculation of html until drawing in the window. </li><li>  Ability to adjust wrapper for JavaScript engine </li><li>  The ability to easily make a wrapper for other programming languages </li></ol><br><br>  <b>And I entered into an unequal battle!</b> <br><br>  Studied existing HTML and CSS (hereinafter cess) parsers. <br>  Being a back-end developer, I was not always satisfied with existing HTML parsers.  All of them were divided conditionally into three categories: <br><ol><li>  Parsing as you please, having only your own idea about tokenization of html </li><li>  Somehow following the specification </li><li>  Parsing clearly following specifications </li></ol><br>  It would seem that there is a third point, and you can probably close the topic?  But no, and here's why: all existing parsers are arranged according to the principle ‚ÄúParsim and Dying‚Äù.  This is when you give the program a whole html, the program returns the result and any subsequent manipulations are impossible, only reading.  This fact greatly limits the scope of the parsers.  It is worth making a remark, there are those who shift work with the DOM to a higher level.  The meaning is this: parsim with a parser, and then through the wrapper we try to work with the DOM on, for example, Python, which is a little absurd. <br><br>  Further, no one allowed to break into the stream (meaning html) at the time of parsing.  This is extremely important for adjusting the JavaScript engine.  I will not explain for a long time, but I'd better show you why: <br><br>  Fragment of html document: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.write(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"&lt;div cl"</span></span></span><span class="javascript">);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>ass="future"&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The result of any browser with JS: <br><pre> <code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"future"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  That is, in the end a full DIV element will be created.  By the way, tokenization tag SCRIPT is still the case.  I had to paint <div class="spoiler">  <b class="spoiler_title">scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/116/d5f/220/116d5f2209e14e4c89942b2b30b7d2cb.png" alt="image"><br></div></div><br>  After all he saw, it was decided to write everything from scratch on C.  The requirements for the code immediately arose: <br><ol><li>  C99 support </li><li>  Ability to separate html parser from renderer to use separately </li><li>  No external dependencies </li></ol><br>  Why is it so tough right away - on Si ?!  The solution must be embedded so that you can easily make a binding for a third-party programming language. <br><br>  With varying success, it was possible to implement in draft form: <br><ol><li>  Html parser </li><li>  Parser cess </li><li>  Selectors </li><li>  Inline Drawer, inline-block, block, table ... </li></ol><br>  You can write about the renderer for a long time, for the short phrase ‚ÄúRenderer of inline elements‚Äù there is not enough hiding: working with fonts according to the specification, calculating the size of the text, calculating the vertical-align, building an auxiliary tree for drawing the text, and a whole lot more. <br><br>  In the end, after two or three years of slow development, I begin to convert the draft into a working one.  The first, which is logical, was the html parser. <br><br>  Now html parser has the following features: <br><ul><li>  Asynchronously parse HTML, handle tokens, build a tree </li><li>  Full HTML 5 support to <a href="https://html.spec.whatwg.org/multipage/">html.spec.whatwg.org/multipage</a> specification </li><li>  We have two APIs: ‚ÄúHigh‚Äù level and ‚ÄúLow‚Äù.  The first is a public api, which has a description and in general, everything is just like that of people, but does not allow seeing structures.  The second is the use of source code directly. </li><li>  Ability to manipulate elements: add, delete, modify. </li><li>  The ability to manipulate the attributes of elements: add, delete, modify </li><li>  Supports 34 encoding per input.  Only UTF-8 output, and all the work inside is only in UTF-8 </li><li>  Can determine the text encoding.  Unicode is now available: UTF-8, UTF-16LE, UTF-16BE (+ definition by BOM) and Russian: windows-1251, koi8-r, iso-8859-5, x-mac-cyrillic, ibm866 </li><li>  Can work in Single Mode - without threads </li><li>  Parse HTML snippets </li><li>  Parsy chunks.  You can give cut pieces of HTML (broken in an arbitrary place) and it will parse them without first accumulating the buffer. </li><li>  No external dependencies </li><li>  Supports C99 </li><li>  Work with memory.  Memory is cached, allocated in chunks and under objects.  For example, deleting ten elements, and then adding ten others will not eat memory for new ones. </li></ul><br>  + A whole bunch of small, but necessary pieces about which you can write for a long time. <br><br>  Next up are the CSS parser and Render.  I do everything alone, "gasoline" should be enough. <br>  Any help is extremely welcome! <br><br>  Thanks for attention!  I hope you will be useful! <br><br>  Actually <a href="https://github.com/lexborisov/myhtml">the parser itself</a> <br><br>  PS: If the community shows interest in this topic, I can write narrowly focused articles on how the rendering calculation works and what difficulties I encountered / face. </div><p>Source: <a href="https://habr.com/ru/post/277031/">https://habr.com/ru/post/277031/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277019/index.html">Technosphere Mail.Ru - 2 years</a></li>
<li><a href="../277021/index.html">We disassemble decorators ES2016</a></li>
<li><a href="../277023/index.html">The book "Head First. Programming for Android ¬ª</a></li>
<li><a href="../277025/index.html">From complex to simple: we start a virtual server Windows / Linux</a></li>
<li><a href="../277029/index.html">Log server Elasticsearch + Logstash + Kibana4 + Beats (windows / linux). Installation and Setup</a></li>
<li><a href="../277033/index.html">Generators in ES6 and asynchronous code in a new way</a></li>
<li><a href="../277035/index.html">Initial Setup of Extreme Networks Wireless Controllers</a></li>
<li><a href="../277037/index.html">Ultima 2C is a free ERP II class solution based on Ultima Businessware platform.</a></li>
<li><a href="../277041/index.html">Multichannel site upgrade. How to make your life easier</a></li>
<li><a href="../277043/index.html">Ariadna. Why do I need another geocoder for OSM?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>