<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript Strategy Pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: 
 I was going to study the new Strategy pattern for me, but I did not find an intelligent Russian description of its implementati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript Strategy Pattern</h1><div class="post__text post__text-html js-mediator-article">  <font color="DimGray">From the translator:</font> <font color="DimGray"><br></font>  <font color="DimGray">I was going to study the new Strategy pattern for me, but I did not find an intelligent Russian description of its implementation in javascript.</font>  <font color="DimGray"><a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D1%2580%25D0%25B0%25D1%2582%25D0%25B5%25D0%25B3%25D0%25B8%25D1%258F_%2528%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F%2529">The article</a> on the wiki is frightening in its complexity, and the clarity of the example leaves much to be desired.</font>  <font color="DimGray">That's why I took up the translation of this article, at the same time figuring out what this pattern is.</font> <font color="DimGray"><br></font>  <font color="DimGray">Spoilers and text highlighted in gray are my comments.</font> <br><blockquote>  Next, we'll look at examples of how I use <i>STRATEGY</i> in Javascript, and how it is used by the real library, to break it down into small pieces. </blockquote><a name="habracut"></a><br>  I adore the <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D1%2580%25D0%25B0%25D1%2582%25D0%25B5%25D0%25B3%25D0%25B8%25D1%258F_%2528%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F%2529">Strategy</a> pattern.  I try to use it wherever possible.  In essence, it uses <abbr title="Delegation (Delegation) - the main design pattern in which an object outwardly expresses some behavior, but in reality transfers responsibility for the implementation of this behavior to a related object.">delegation</abbr> to separate the algorithms from the classes that use them. <br><br>  There are several advantages to this approach. <br>  Firstly, it allows to avoid complex conditional constructions for choosing which variant of the algorithm to use. <br>  Secondly, it weakens <abbr title="Connectivity (coupling, or dependency dependency) is a measure of dependencies between classes or modules. With weak connectivity, the modules interact through a stable interface and do not depend on the implementation of each other.">connectivity</abbr> , thereby reducing the complexity of clients, and encourages the rejection of the use of subclasses in favor of class <abbr title="Aggregation (also called composition or inclusion) is a technique for creating a new class from already existing classes by inclusion, also called delegation.">aggregation</abbr> . <br>  Third, it improves <abbr title="Modularity is the principle that a software tool (program, library, web application, etc.) is divided into separate named entities, called modules.">modularity</abbr> and testability. <br><br>  In the implementation of <i>STRATEGY</i> , two participants are usually used: <br><ul><li>  <b><i>A strategy</i></b> is an object that encapsulates an algorithm. </li><li>  <b><i>A client</i></b> (or <b><i>Context</i></b> ) is an object that can use any plug-and-play plug-and-play strategy. </li></ul>  <font color="DimGray">Hereinafter:</font> <font color="DimGray"><br></font>  <font color="DimGray"><i>STRATEGY</i> - pattern itself.</font> <font color="DimGray"><br></font>  <font color="DimGray"><i>Strategy</i> - a separate implementation of the algorithm.</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, we'll look at examples of how I use <i>STRATEGY</i> in Javascript, and how it is used by the real library, to break it down into small pieces. <br><br><h1>  <i>Strategy</i> as a function </h1>  The built-in <i>FUNCTION</i> class provides a great way to <abbr title="Encapsulation - restriction of access from the outside to internal components (methods, properties, etc.).">encapsulate an</abbr> algorithm.  This means that functions can be used as <i>strategies</i> .  Just pass the function to the client and make sure that the client uses it. <br><br>  We illustrate this with an example.  Suppose we want to create a class <i>Greeter</i> .  His task is to greet people.  We also want <i>Greeter</i> to be able to greet them in different ways.  That is, we need several different implementations of the <i>algorithm</i> .  For this, we will create different greeting strategies.  <font color="DimGray">Hereinafter, the <i>algorithm</i> implies a greeting.</font> <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Greeter -  ,    . //         var Greeter = function(strategy) { this.strategy = strategy; }; // Greeter   greet, //       //  ,    Greeter.prototype.greet = function() { return this.strategy(); }; //     , //       //  : var politeGreetingStrategy = function() { console.log("Hello."); }; var friendlyGreetingStrategy = function() { console.log("Hey!"); }; var boredGreetingStrategy = function() { console.log("sup."); }; //   ! var politeGreeter = new Greeter(politeGreetingStrategy); var friendlyGreeter = new Greeter(friendlyGreetingStrategy); var boredGreeter = new Greeter(boredGreetingStrategy); console.log(politeGreeter.greet()); //=&gt; Hello. console.log(friendlyGreeter.greet()); //=&gt; Hey! console.log(boredGreeter.greet()); //=&gt; sup.</span></span></code> </pre>  <font color="DimGray">There is an error in this code (thanks to <a href="http://habrahabr.ru/users/bashtannik/" class="user_link">bashtannik</a> ).</font>  <font color="DimGray">Since the algorithms of the strategies already have the output in the console, and the <i>greet</i> method returns a function that returns nothing - the last three lines should be replaced by</font> <div class="spoiler">  <b class="spoiler_title">these</b> <div class="spoiler_text"><pre> <code class="javascript hljs">politeGreeter.greet(); <span class="hljs-comment"><span class="hljs-comment">//=&gt; Hello. friendlyGreeter.greet(); //=&gt; Hey! boredGreeter.greet(); //=&gt; sup.</span></span></code> </pre> </div></div><br>  In the example above, we created a <i>Greeter</i> client and three different <i>strategies</i> .  Obviously, <i>Greeter</i> knows how to use the <i>algorithm</i> , but has no idea about what is under his hood. <br><br>  But for complex algorithms, functions are often not enough.  In this case, it is better to use the <i>STRATEGY</i> in the OOP style. <br><br><h1>  <i>Strategy</i> as a class </h1>  Classes can also be <i>strategies</i> , especially in cases where the algorithms are more complex than the one invented in the example above.  Using classes allows you to define an interface for each <i>strategy</i> . <br><br>  Consider this by example. <br><div class="spoiler">  <b class="spoiler_title">implies that this code is located before the example.</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Greeter = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">strategy</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategy = strategy; };</code> </pre> </div></div><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       Javascript //   ,      //     , //          . //    ,      var Strategy = function() {}; Strategy.prototype.execute = function() { throw new Error('Strategy#execute needs to be overridden.') }; //           //        `Strategy`. //  ,    , //      `execute` var GreetingStrategy = function() {}; GreetingStrategy.prototype = Object.create(Strategy.prototype); //   `execute`,       //    `Strategy`   . //  ,       . //      (Template Method). //      . GreetingStrategy.prototype.execute = function() { return this.sayHi() + this.sayBye(); }; GreetingStrategy.prototype.sayHi = function() { return "Hello, "; }; GreetingStrategy.prototype.sayBye = function() { return "Goodbye."; }; //      . //    -   `Greeter`. Greeter.prototype.greet = function() { return this.strategy.execute(); }; var greeter = new Greeter(new GreetingStrategy()); greeter.greet() //=&gt; 'Hello, Goodbye.'</span></span></code> </pre>  We defined <i>Strategy</i> as an object (or class) with the <i>execute</i> method.  The client can use any <i>strategy</i> that fits this class. <br><br>  Pay attention to the <i>GreetingStrategy</i> .  The most interesting thing is to override the <i>execute</i> method.  It depends on other methods of this class.  Now objects that inherit this class can change individual methods, such as <i>sayHi</i> or <i>sayBye</i> , without changing the basic <i>algorithm</i> .  This pattern is called the <abbr title="Template method (eng. Template method) is a behavioral design pattern that defines the basis of the algorithm and allows successors to redefine some steps of the algorithm without changing its structure as a whole.">Template Method</abbr> and it combines perfectly with <i>STRATEGY</i> . <br><br>  Let's see how. <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   GreetingStrategy#execute    . //    ,     , //       ( `execute`) var PoliteGreetingStrategy = function() {}; PoliteGreetingStrategy.prototype = Object.create(GreetingStrategy.prototype); PoliteGreetingStrategy.prototype.sayHi = function() { return "Welcome sir, "; }; var FriendlyGreetingStrategy = function() {}; FriendlyGreetingStrategy.prototype = Object.create(GreetingStrategy.prototype); FriendlyGreetingStrategy.prototype.sayHi = function() { return "Hey, "; }; var BoredGreetingStrategy = function() {}; BoredGreetingStrategy.prototype = Object.create(GreetingStrategy.prototype); BoredGreetingStrategy.prototype.sayHi = function() { return "sup, "; }; var politeGreeter = new Greeter(new PoliteGreetingStrategy()); var friendlyGreeter = new Greeter(new FriendlyGreetingStrategy()); var boredGreeter = new Greeter(new BoredGreetingStrategy()); politeGreeter.greet(); //=&gt; 'Welcome sir, Goodbye.' friendlyGreeter.greet(); //=&gt; 'Hey, Goodbye.' boredGreeter.greet(); //=&gt; 'sup, Goodbye.'</span></span></code> </pre>  By defining the <i>execute</i> method, <i>GreetingStrategy</i> creates a family of <i>algorithms</i> .  In the above fragment, we took advantage of this by creating several varieties of them. <br><br>  Even without the use of subclasses, <i>Greeter</i> still has <abbr title="Polymorphism is a property that allows you to uniformly process data of different types.">polymorphism</abbr> .  There is no need to switch to a different type of <i>Greeter</i> to call the algorithm we need.  Now they are all in every new <i>Greeter</i> . <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greeters = [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Greeter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoredGreetingStrategy()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Greeter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PoliteGreetingStrategy()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Greeter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FriendlyGreetingStrategy()), ]; greeters.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">greeter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    `greeter`     //      . //      `greet`, //        . greeter.greet(); });</span></span></code> </pre><br><br><h1>  STRATEGY in the real code </h1>  One of my favorite examples of using <i>STRATEGY</i> is the <a href="http://github.com/jaredhanson/passport">Passport.js</a> library. <br><br>  Passport.js provides an easy way to manage authentication in node.js.  It supports a large number of providers (Facebook, Twitter, Google, etc.), each of which is presented as a separate strategy. <br><br>  The library is available in the form of an npm-package, as well as all its strategies.  The programmer is free to decide which npm package to install in this particular case.  Here is a code snippet that clearly shows how this works: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    http://passportjs.org var passport = require('passport') //      npm-. //     . , LocalStrategy = require('passport-local').Strategy , FacebookStrategy = require('passport-facebook').Strategy; // Passport      . passport.use(new LocalStrategy( function(username, password, done) { User.findOne({ username: username }, function (err, user) { if (err) { return done(err); } if (!user) { return done(null, false, { message: 'Incorrect username.' }); } if (!user.validPassword(password)) { return done(null, false, { message: 'Incorrect password.' }); } return done(null, user); }); } )); // ,    Facebook passport.use(new FacebookStrategy({ clientID: FACEBOOK_APP_ID, clientSecret: FACEBOOK_APP_SECRET, callbackURL: "http://www.example.com/auth/facebook/callback" }, function(accessToken, refreshToken, profile, done) { User.findOrCreate(..., function(err, user) { if (err) { return done(err); } done(null, user); }); } ));</span></span></code> </pre>  The Passport.js library itself contains only a couple of simple authentication mechanisms.  There is nothing in it but them and the <i>Context</i> .  This architecture allows third-party programmers to easily implement their own authentication mechanisms without cluttering up the project. <br><br><h1>  Morality </h1>  The Strategy Pattern provides a way to increase the modularity and testability of your code.  But this does not mean that it should be used everywhere with or without.  It is also useful to use <abbr title="An admixture (mixin) is an element (usually a class or module) that implements any clearly defined behavior. Used to clarify the behavior of other classes, it is not intended to generate independently used objects.">impurities</abbr> to add functionality to objects at run time.  And sometimes a fairly simple polymorphism in the style of the good old <abbr title="Duck typing (duck typing; implicit dynamic typing) ‚Äîdetermining the type of an object through the contract it supports, rather than valid interfaces or base types from which it is inherited.">duck typing</abbr> . <br><br>  Anyway, the use of <i>STRATEGY</i> , in the first place, allows you to scale the code, avoiding the large overhead of architecture.  This can be seen in the example of Passport.js, in which the use of this pattern contributes to painless addition of new strategies from other programmers. </div><p>Source: <a href="https://habr.com/ru/post/191480/">https://habr.com/ru/post/191480/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191468/index.html">EmBlocks - IDE for STM32</a></li>
<li><a href="../191470/index.html">Yoobao YB-665 - Power Bank at 15600 mAh</a></li>
<li><a href="../191472/index.html">Core Data for iOS. Chapter number 1. Practical part</a></li>
<li><a href="../191476/index.html">Capturing downloadable resources in QtWebKit or how I saddled a unicorn under dubstep</a></li>
<li><a href="../191478/index.html">Why study TDD is difficult and what to do about it. Part 2</a></li>
<li><a href="../191482/index.html">Servers in the USA, Data Center COPT DC-6-EvoSwitch / LeaseWeb (Manassas)</a></li>
<li><a href="../191486/index.html">10 fastest supercomputers in pictures</a></li>
<li><a href="../191488/index.html">Interactive testing - is it worth it?</a></li>
<li><a href="../191490/index.html">Opera 16 Final</a></li>
<li><a href="../191494/index.html">Survey: how many of our sites with you?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>