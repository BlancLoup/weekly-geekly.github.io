<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Facebook SDK (iOS) integration into mobile free-to-play games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mobile free-to-play is almost no time without the use of social networks in games. Social networks provide what is called virality (from the English. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Facebook SDK (iOS) integration into mobile free-to-play games</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/80c/f3f/9d8/80cf3f9d87af9f3370e4ac420a704593.png" alt="image" align="right">  Mobile free-to-play is almost no time without the use of social networks in games.  Social networks provide what is called <a href="http://en.wikipedia.org/wiki/Viral_marketing">virality</a> (from the English. Viral - viral, ie, able to spread like a virus, from one person to another), which allows you to attract new players with minimal cost.  In this article we will share the experience of integrating Facebook into Alawar games on the iOS platform. <br><a name="habracut"></a><br>  In a typical free-to-play mobile game, Facebook integration provides the following features: <br><ol><li>  The possibility of authorization through a user account in Facebook  This authorization is good because we form a unique user ID of the game with minimal effort on his part.  The player does not need to invent a login, enter an e-mail address, etc.  After all, we are talking about a mobile application, where it is somewhat tiring to constantly enter text data.  It is enough to press the button with the well-recognized ‚Äúf‚Äù logo once.  There are also advantages for developers - the player‚Äôs progress can be synchronized between different devices on different platforms, the main thing is Facebook on these platforms. </li><li>  Ability to send app requests to friends.  Requests are sort of messages that appear on a player‚Äôs Facebook page (and in the Facebook application) and contain game-related information.  Typical requests include inviting friends to the game, requests like ‚Äúsend / give me something‚Äù or ‚Äúhelp me complete a level‚Äù.  Ultimately, the request is needed only in order for a person to click on it and go into the game (or to the game page in the App store).  The use of requests is a powerful mechanism for attracting new players and returning old players to the game for free. </li><li>  Ability to send posts in the timeline (timeline).  This posting allows you to report the game to anyone who reads the timeline.  Games usually put there information about the achievements of the player, which adds a competitive component. </li><li>  The ability to receive information about the player from his Facebook account.  Most often, such information includes the name of the player, his avatar, and possibly the avatars of his friends.  An example of using avatars in a real <a href="https://www.facebook.com/TheTreasuresOfMontezumaBlitzCommunity">-</a> life <a href="https://www.facebook.com/TheTreasuresOfMontezumaBlitzCommunity">free-to-play game</a> under a spoiler. <div class="spoiler">  <b class="spoiler_title">Avatar Game</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/a63/894/c0ba638943484804ac4402b3db82b49a.jpg" alt="image"></div></div></li></ol><br>  In order to simplify the integration of Facebook, we have created a demo application that implements almost everything needed from the client side. <br><br><h4>  Demo application </h4><br>  The demo application is written in C ++ (like most of our free-to-play-games) with inserts in Objective-C and is the simplest application on the <a href="http://www.cocos2d-x.org/">Cocos2d-x</a> engine (you can download it <a href="https://github.com/alawar/FacebookSample">here</a> ).  A rectangle moves across the screen and is reflected from the edges of the screen when these borders are reached. <br><img src="https://habrastorage.org/getpro/habr/post_images/e3c/c54/381/e3cc543816c756f6aef98f116dea3a73.png" alt="image"><br>  The control is carried out using 4 buttons: f - authorization, REQ - sending a request to friends, POST - posting to the timeline and LOGOUT.  After authorization, the user's avatar is placed in place of the rectangle, and a welcome inscription is added. <br><img src="https://habrastorage.org/getpro/habr/post_images/164/ed9/d19/164ed9d19c11d43ea1033fce31793faa.png" alt="image"><br>  To compile, you need to download and install the <a href="https://developers.facebook.com/docs/ios/">Facebook SDK</a> , add the Facebook SDK framework to the project in Xcode.  We used the Facebook SDK version 3.9. <br>  To launch a demo application, you must create your own Facebook application on your developer portal, register its identifier in the plist of our demo application, and also perform a number of other simple operations.  Read more about it <a href="https://developers.facebook.com/docs/ios/getting-started/">here</a> . <br><br><h4>  Technical implementation details </h4><br><h5>  Access rights </h5><br>  The first thing you encounter when you integrate Facebook on a client is the creation of a session with a request for access rights (permissions), which Facebook offers <a href="https://developers.facebook.com/docs/reference/login/">various options</a> .  It is important to restrain the impulse and not to request access rights to everything at once.  It is considered a good form to request access rights at the moment when they are really necessary.  When creating a session, we request only basic rights. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs objectivec">+ (<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span>*) getBasicPermissions { <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span>* permissions = [[<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> alloc] initWithObjects: <span class="hljs-string"><span class="hljs-string">@"user_birthday"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> permissions; }</code> </pre> <br><br>  In this case, the authorization will show the following dialog. <br><img src="https://habrastorage.org/getpro/habr/post_images/e07/ef1/b0d/e07ef1b0d8b6b3a9a4bde18c1346233c.png" alt="image"><br>  You should also pay attention to the fact that native iOS dialogs will only be shown if you pre-authorize on Facebook on the device itself in the settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f70/cfe/6d2/f70cfe6d26fdf8c41a1056250750f7bd.png" alt="image"><br><br>  Otherwise, iOS will try to use the Facebook application (if it was installed from the App Store) or it will open Facebook in the browser. <br>  When we need the rights to publish something on the timeline or when we request friends, we will ask for rights specifically for this. <br><br><pre> <code class="hljs objectivec">+ (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) requestPublishPermissions { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasPublishPermissions) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *permissions = [[<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> alloc] initWithObjects: <span class="hljs-string"><span class="hljs-string">@"publish_actions"</span></span>, <span class="hljs-string"><span class="hljs-string">@"publish_stream"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [[FBSession activeSession] requestNewPublishPermissions:permissions defaultAudience:FBSessionDefaultAudienceFriends completionHandler:^(FBSession *session, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { hasPublishPermissions = [[FBSession activeSession].permissions containsObject:<span class="hljs-string"><span class="hljs-string">@"publish_actions"</span></span>] &amp;&amp; [[FBSession activeSession].permissions containsObject:<span class="hljs-string"><span class="hljs-string">@"publish_stream"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (g_handler) { g_handler-&gt;OnGetPublishPermissions(hasPublishPermissions); } }]; }</code> </pre><br><br>  In this case, the following dialog will be displayed. <br><img src="https://habrastorage.org/getpro/habr/post_images/863/b01/a72/863b01a725a4a9ae3e38ffee22fe4055.png" alt="image"><br>  It is important to remember that the player can deny the rights to publish on his own behalf, but allow authorization.  These cases need to be handled carefully. <br><br><h5>  Requests to friends </h5><br>  The implementation of requests to friends (app requests) is described in some detail in the <a href="https://developers.facebook.com/docs/ios/send-requests-using-ios-sdk/">documentation</a> , but there are a number of subtleties.  With the basic implementation of requests, the dialog box shown below will be displayed. <br><img src="https://habrastorage.org/getpro/habr/post_images/e17/3fb/be7/e173fbbe71f3c236b0e5d9d8a4c97d80.png" alt="image"><br>  The code for this implementation is under the spoiler. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="hljs ruby">+ (void) requestFriend { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> more details here /<span class="hljs-regexp"><span class="hljs-regexp">/ https:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/developers.facebook.com/docs</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ios/send</span></span>-requests-using-ios-sdk/ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!friendsCache) { friendsCache = [[FBFrictionlessRecipientCache alloc] init]; } [friendsCache <span class="hljs-symbol"><span class="hljs-symbol">prefetchAndCacheForSession:</span></span><span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [FBWebDialogs <span class="hljs-symbol"><span class="hljs-symbol">presentRequestsDialogModallyWithSession:</span></span><span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-symbol"><span class="hljs-symbol">message:</span></span>@<span class="hljs-string"><span class="hljs-string">"Help me, friend!"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">title:</span></span>@<span class="hljs-string"><span class="hljs-string">"Help me!"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">parameters:</span></span><span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-symbol"><span class="hljs-symbol">handler:</span></span>^(FBWebDialogResult result, NSURL *resultURL, NSError *error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) { NSLog(@<span class="hljs-string"><span class="hljs-string">"Error sending request"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == FBWebDialogResultDialogNotCompleted) { NSLog(@<span class="hljs-string"><span class="hljs-string">"User canceled request"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { NSDictionary *urlParams = [FacebookController <span class="hljs-symbol"><span class="hljs-symbol">parseURLParams:</span></span>[resultURL query]]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![urlParams <span class="hljs-symbol"><span class="hljs-symbol">valueForKey:</span></span>@<span class="hljs-string"><span class="hljs-string">"request"</span></span>]) { NSLog(@<span class="hljs-string"><span class="hljs-string">"User canceled request"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { NSLog([NSString <span class="hljs-symbol"><span class="hljs-symbol">stringWithFormat:</span></span> @<span class="hljs-string"><span class="hljs-string">"Request Sent: %@"</span></span>, [urlParams <span class="hljs-symbol"><span class="hljs-symbol">valueForKey:</span></span>@<span class="hljs-string"><span class="hljs-string">"request"</span></span>]]); } } } } <span class="hljs-symbol"><span class="hljs-symbol">friendCache:</span></span>friendsCache]; }</code> </pre></div></div><br>  The behavior of the query window can be controlled using parameters passed after <i>parameters:</i> when the dialog is invoked.  For example, the following set of parameters allows you to send a request to a friend known in advance. <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *friendId=<span class="hljs-string"><span class="hljs-string">@"100006530868327"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSMutableDictionary</span></span>* params = [[<span class="hljs-built_in"><span class="hljs-built_in">NSMutableDictionary</span></span> alloc] init]; params[<span class="hljs-string"><span class="hljs-string">@"to"</span></span>] = friendId;</code> </pre> <br><br>  The Facebook SDK in this case will show the modified App requests window and even suggest not to show the window on the following requests to this friend. <br><br><h5>  Posting timeline </h5><br>  Facebook allows you to post so-called stories in the timeline.  In order to form a story, you need to select ‚ÄúOpen Graph‚Äù in the menu on the left on the page of your application on <a href="https://developers.facebook.com/apps">the Facebook developer portal</a> .  You will see 3 tabs: Stories, Object Types and Action Types.  The object type summarizes a certain group of objects that can be encountered by users of your game, for example, badges.  Now we need actions that can be applied to the ‚ÄúBadge‚Äù object, for example, the ‚ÄúFind‚Äù action.  The type of action and the type of object can be combined into the ‚ÄúFind a Badge‚Äù story.  Facebook has ample opportunity to customize stories.  Read more about it <a href="https://developers.facebook.com/docs/opengraph/creating-custom-stories/">here</a> . <br>  To get the code for publishing the created story from the application, you need to click on the ‚ÄúGet Code‚Äù caption to the right of the story name.  Select the required platform (iOS SDK in our case) and the ‚ÄúCode for Object‚Äù tab.  The system will generate code like this: <br><br><pre> <code class="hljs scala"><span class="hljs-type"><span class="hljs-type">NSMutableDictionary</span></span>&lt;<span class="hljs-type"><span class="hljs-type">FBGraphObject</span></span>&gt; *<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span></span>= [<span class="hljs-type"><span class="hljs-type">FBGraphObject</span></span> openGraphObjectForPostWithType:@<span class="hljs-string"><span class="hljs-string">"aw_test:badge"</span></span> title:@<span class="hljs-string"><span class="hljs-string">"Sample Badge"</span></span> image:@<span class="hljs-string"><span class="hljs-string">"https://fbstatic-a.akamaihd.net/images/devsite/attachment_blank.png"</span></span> url:@<span class="hljs-string"><span class="hljs-string">"http://samples.ogp.me/473380876115865"</span></span> description:@<span class="hljs-string"><span class="hljs-string">""</span></span>];; [<span class="hljs-type"><span class="hljs-type">FBRequestConnection</span></span> startForPostWithGraphPath:@<span class="hljs-string"><span class="hljs-string">"me/objects/aw_test:badge"</span></span> graphObject:<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completionHandler</span></span></span></span>:^(<span class="hljs-type"><span class="hljs-type">FBRequestConnection</span></span> *connection, id result, <span class="hljs-type"><span class="hljs-type">NSError</span></span> *error) { <span class="hljs-comment"><span class="hljs-comment">// handle the result }];</span></span></code> </pre><br><br>  In the Code for Action tab, you can get the code for the action.  To form a history in the timeline, you must first create an object and then create an action with this object. <br>  Oddly enough, this code does not work.  If you include it in the project without modifications, then there will be a crash on the undetected selector in one of the classes.  In order to fix this, you need to add a couple of lines to the parameters of the Open Graph object being created. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-string"><span class="hljs-string">@"create_object"</span></span>] = <span class="hljs-string"><span class="hljs-string">@"true"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-string"><span class="hljs-string">@"fbsdk:create_object"</span></span>] = <span class="hljs-string"><span class="hljs-string">@"true"</span></span>;</code> </pre> <br><br>  This "magic" corrects crash, but posting to the timeline is still not working.  A good sign that everything has worked is a callback ID returned by Facebook.  The identifier is a set of numbers (for example, 586146891470767).  In response to the code received from the portal, comes the string "true".  This can be fixed by modifying the code a little more.  In particular, the call to startForPostWithGraphPath proposed by the code generator should be replaced by startForPostOpenGraphObject when creating the object. <br>  The full code for posting in the timeline can be seen under the spoiler. <br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="hljs haskell">+ (void) createOpenGraphObjectWithType:(<span class="hljs-type"><span class="hljs-type">NSString</span></span> *) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> title:(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> *) title url:(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> *) url image:(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> *) image handler: (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OpenGraphObjectCreationHandler</span></span></span><span class="hljs-class">) handler { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSMutableDictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBOpenGraphObject</span></span></span><span class="hljs-class">&gt; *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> = [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBGraphObject</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">openGraphObjectForPostWithType</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">image</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">description</span></span></span><span class="hljs-class">:@""]; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">[@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create_object</span></span></span><span class="hljs-class">"] = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">"; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class">[@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fbsdk</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create_object</span></span></span><span class="hljs-class">"] = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">"; [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBRequestConnection</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startForPostOpenGraphObject</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completionHandler</span></span></span><span class="hljs-class">:^(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBRequestConnection</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connection</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSError</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> &amp;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">) { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSLog</span></span></span><span class="hljs-class">([</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stringWithFormat</span></span></span><span class="hljs-class">:@"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Posting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> '%@' (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">=%@) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created</span></span></span><span class="hljs-class">!", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectForKey</span></span></span><span class="hljs-class">:@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">"]]); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectForKey</span></span></span><span class="hljs-class">:@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">"]); } else { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSLog</span></span></span><span class="hljs-class">([</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stringWithFormat</span></span></span><span class="hljs-class">:@"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Posting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">creation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">: %@", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">]); } }]; } + (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">) postStory { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_title</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Blue</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Badge</span></span></span><span class="hljs-class">"; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_url</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">demo</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tom3</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html5</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">services</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alawar</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">images</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tester</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blue_badge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">htm</span></span></span><span class="hljs-class">"; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_image</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">demo</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tom3</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html5</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">services</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alawar</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">images</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tester</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blue_badge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">png</span></span></span><span class="hljs-class">"; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rnd</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arc4random</span></span></span><span class="hljs-class">() % 2; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rnd</span></span></span><span class="hljs-class"> == 0) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_title</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Red</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Badge</span></span></span><span class="hljs-class">"; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_url</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">demo</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tom3</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html5</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">services</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alawar</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">images</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tester</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">red_badge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">htm</span></span></span><span class="hljs-class">"; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge_image</span></span></span><span class="hljs-class"> = @"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">demo</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tom3</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html5</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">services</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alawar</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">images</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tester</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">red_badge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">png</span></span></span><span class="hljs-class">"; } [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FacebookController</span></span></span><span class="hljs-class"> createOpenGraphObjectWithType:@"aw_test:badge" title:badge_title url:badge_url image:badge_image handler:^(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectId</span></span></span><span class="hljs-class">) { // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSMutableDictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBGraphObject</span></span></span><span class="hljs-class">&gt; *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class"> = [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBGraphObject</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">graphObject</span></span></span><span class="hljs-class">]; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class">[@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">badge</span></span></span><span class="hljs-class">"] = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectId</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class">[@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fb</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">explicitly_shared</span></span></span><span class="hljs-class">"] = @"1"; [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBRequestConnection</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startForPostWithGraphPath</span></span></span><span class="hljs-class">:@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">me</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aw_test</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">graphObject</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completionHandler</span></span></span><span class="hljs-class">:^(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FBRequestConnection</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connection</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSError</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> &amp;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">) { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSLog</span></span></span><span class="hljs-class">([</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stringWithFormat</span></span></span><span class="hljs-class">:@"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Posted</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">=%@)!", [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">result</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">objectForKey</span></span></span><span class="hljs-class">:@"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">"]]); } else { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSLog</span></span></span><span class="hljs-class">([</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stringWithFormat</span></span></span><span class="hljs-class">:@"</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Posting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">: %@", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">]); } }]; }]; }</span></span></code> </pre></div></div><br>  The attentive reader will note that when executing the code for the action an additional parameter was added. <br><br><pre> <code class="hljs objectivec">action[<span class="hljs-string"><span class="hljs-string">@"fb:explicitly_shared"</span></span>] = <span class="hljs-string"><span class="hljs-string">@"1"</span></span>;</code> </pre> <br><br>  If this parameter is not set, the created history will go to the user's Recent Activities, and not into the timeline.  If everything is done correctly, then in the timeline of the user it will be possible to observe something similar to the picture below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba9/699/57e/ba969957e63ec98978cf043ee1fb0024.png" alt="image"><br><br>  The last point that you need to figure out: where and how the descriptions of objects are stored  The description of the object is stored as a specially marked up html-document on any open server.  Images are also posted on public servers, where their Facebook is from and uploads. <br><br><h4>  Instead of conclusion </h4><br>  If you decide to integrate into the Facebook game, remember that this is not a momentary matter.  Be sure to think about how the game will interact with the user through Facebook.  Otherwise, you will receive instead of a useful tool for attracting players another application annoying players.  Complaints from players on spam will lead to the fact that Facebook will ban the application, which, of course, no one wants. <br>  As practice shows, not everyone gets to take Facebook with a swoop.  We hope that the experience we have given on integrating this social network will be useful to you. </div><p>Source: <a href="https://habr.com/ru/post/214043/">https://habr.com/ru/post/214043/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214027/index.html">Massively parallel image stabilization</a></li>
<li><a href="../214033/index.html">Is cross-platform development on Titanium a terrible end, or horror without end?</a></li>
<li><a href="../214035/index.html">Chrome Extension: Microsoft KB English Only</a></li>
<li><a href="../214039/index.html">Google introduced the online learning tool for oppia.</a></li>
<li><a href="../214041/index.html">Can a programmer become a factory director?</a></li>
<li><a href="../214047/index.html">Review of new technologies in the production of food sources</a></li>
<li><a href="../214053/index.html">We invite you to take part in the Siberian Hackath 1-2 March</a></li>
<li><a href="../214055/index.html">Ban on continents</a></li>
<li><a href="../214063/index.html">Angular boilerplate. Simplicity - the trend of youth</a></li>
<li><a href="../214071/index.html">Adaptive images without shamanism</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>