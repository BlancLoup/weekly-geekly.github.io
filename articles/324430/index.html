<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I did a tester optimizer for finding profitable strategies on the Exchange - 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fig. 1. Optimization of the multidimensional space of trading strategies algorithms. 

 Optimization of trading strategies 

 In the process of algori...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I did a tester optimizer for finding profitable strategies on the Exchange - 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://softalgotrade.com//images/habrahabr/MultidimensionalSpaceStrategies2.png" alt="Multidimensional Space Trading Strategies"><br>  <i>Fig.</i>  <i>1. Optimization of the multidimensional space of trading strategies algorithms.</i> <br><br>  <b>Optimization of trading strategies</b> <br><br>  In the process of algorithmic trading, it is constantly necessary to adjust the parameters of trading strategies algorithms.  The combination of all possible parameters turns into a large multidimensional space of options strategies.  To get the most profitable and stable strategies you need to explore this space and find the optimal parameters for trading. <br><a name="habracut"></a><br>  The best way to research any set is to look through all its elements <a title="Brute force" href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BE%25D1%2580">Brute Force</a> .  However, given the enormous amounts of data that one has to face during optimization, as a rule, it turns out to be simply impossible to conduct such a study by exhaustive search.  It is necessary to apply various analytical algorithms that can reduce the actual amount of research in the process of searching for extrema. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most of these algorithms are well known: <a title="Monte Carlo method" href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%259C%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B5-%25D0%259A%25D0%25B0%25D1%2580%25D0%25BB%25D0%25BE">the Monte Carlo</a> <a title="Gradient descent" href="https://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA">method</a> , <a title="Gradient descent" href="https://ru.wikipedia.org/wiki/%25D0%2593%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA">the gradient descent</a> <a title="Annealing Simulation Algorithm" href="https://ru.wikipedia.org/wiki/%25C0%25EB%25E3%25EE%25F0%25E8%25F2%25EC_%25E8%25EC%25E8%25F2%25E0%25F6%25E8%25E8_%25EE%25F2%25E6%25E8%25E3%25E0">method</a> , <a title="Annealing Simulation Algorithm" href="https://ru.wikipedia.org/wiki/%25C0%25EB%25E3%25EE%25F0%25E8%25F2%25EC_%25E8%25EC%25E8%25F2%25E0%25F6%25E8%25E8_%25EE%25F2%25E6%25E8%25E3%25E0">the simulated annealing method</a> , <a title="Evolutionary algorithms" href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25B2%25D0%25BE%25D0%25BB%25D1%258E%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC%25D1%258B">evolutionary algorithms</a> , etc.  There are various modifications of these optimization algorithms.  In algorithmic trading, as a rule, there are implementations of genetic algorithms and Monte Carlo.  Anyway, all these algorithms use "random number magic" or scientifically speaking nonlinear stochastic optimization. <br><br>  The classic problem of stochastic optimization algorithms is that, for small volumes of actual research and small samples, they are not representative.  For example, Monte Carlo is not effective in multi-extremal space, it emphasizes the study on global extremum, losing sight of local, but no less interesting extremes.  The algorithm does not set itself such tasks, it just needs to find the most profitable strategy.  The genetic algorithm can also go unsuccessful branch of mutations and <a title="Visualizing evolution" href="">stop at some local extremum</a> , etc. <br>  This is because these optimization algorithms in the initial stages have to make decisions on a limited amount of data in a space that has not yet been studied, and important areas can easily fall out of the study.  To avoid this, you need to increase the data sample and the time of the study, and in our case, time is worth its weight in gold.  It is necessary at the minimum time spent exploring the extremes of space in as much detail as possible.  At the same time, in the rapidly changing conditions of stock trading, it is important to pay attention not only to profitable, but also to stable parameters of trading strategies.  Stable means parameters forming clusters with similar results.  Profitable strategies that are out of clusters may not be stable and lead to serious losses.  In turn, the strategy of the cluster is less susceptible to changes in the market. <br><br>  <b>Stochastic cluster optimization method</b> <br><br>  Taking into account the peculiarities of optimization of stock exchange strategies, a hybrid algorithm was developed (see the <b><a title="How I did a tester optimizer for finding profitable strategies on the stock exchange" href="https://habrahabr.ru/post/209198/">last article</a></b> ) which had one pleasant side effect - it successfully selected and investigated clusters.  I gave the name of the resulting algorithm - ‚ÄúThe method of stochastic cluster optimization‚Äù. <br><br>  The research process therefore the algorithm takes place in two stages: <br><br><ol><li>  Exploring strategy space with the removal of unprofitable and at risk areas </li><li>  Detailed study of extrema and clusters of space </li></ol><br>  <b>Stage 1. Investigation of strategy space with the removal of unprofitable and at-risk areas.</b> <br><br>  To get rid of uncertainty due to lack of data at the initial stages of research, the algorithm does not set the task of finding profitable strategies, but, on the contrary, searches for the most unprofitable and removes them from space along with the areas bordering on them with potentially high risks of losses. <br><br>  The work is carried out in the following order: <br><br><ul><li>  A multidimensional space is formed from all possible parameters of a trading strategy. </li><li>  Strategies are randomly selected from space and are tested on historical data with the specified parameters. </li><li>  According to the results of testing, border microregions are removed around the most unprofitable strategies.  This reduces the research space and focuses on more profitable and stable areas in further iterations. </li><li>  Testing iterations are held until the strategy space is studied to the necessary extent. </li></ul><br>  In Fig.  2 shows how the study shifts towards extremes, while the risk of missing small clusters with possibly good and stable parameters is minimal. <br><br><div style="text-align:center;"><img src="https://softalgotrade.com/images/habrahabr/gif/StochasticClusterOptimizationExtrema.gif" alt="Stochastic Cluster Optimization - Extrema Focused" width="600" height="332"></div><br>  Fig.  2. The first stage of the Stochastic Cluster Optimization algorithm is the study of the strategy space. <br><br>  <b>Stage 2. Detailed study of clusters and extremes.</b> <br><br>  After the first stage of the study are well the types of extremes.  However, due to the peculiarities of the algorithm (a lot of microregions are cut out), the space turns out to be ‚Äúragged‚Äù and some extremes can be investigated not in great detail.  In order to fully explore all interesting clusters, the optimization algorithm begins the research process exactly the opposite.  To do this, select all the best strategies and micro-regions are additionally distinguished around them.  If strategies that have not yet been studied are found in these areas, then they are additionally tested (see Fig. 3). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com//images/habrahabr/ExtremaMap2.png" alt="Extrema map" width="600" height="331"></div><br>  <i>Fig.</i>  <i>3. The second stage of the Stochastic Cluster Optimization algorithm is a detailed study of extrema.</i> <br><br>  As a result, after the algorithm works, all areas of space that are interesting to us are investigated and clusters with profitable strategies are tested in detail.  In this case, the actual amount of research, as a rule, is no more than 25-50% of the total volume of the strategy options space (see. Fig. 4). <br><table><tbody><tr><td><img src="https://softalgotrade.com/images/habrahabr/gif/StochasticClusterOptimization.gif" alt="Stochastic Cluster Optimization" width="350" height="195"></td><td><img src="https://softalgotrade.com/images/habrahabr/gif/BruteForce.gif" alt="Brute force" width="350" height="195"></td></tr></tbody></table>  <i>Fig.</i>  <i>4. The speed of research of the Stochastic Cluster Optimization algorithm (left) is 2-4 times higher than the speed of the Brute Force algorithm (right).</i> <br><br>  <b>Walk forward optimization</b> <br><br>  Seemingly optimized parameters and you can start trading.  However, this is not the end of the research process.  The optimization process is at risk of ‚Äúfitting‚Äù or re-optimizing the parameters for the historical data used in the process, so you need to additionally check the results.  To do this, use the <b><a title="Walk Forward optimization" href="https://en.wikipedia.org/wiki/Walk_forward_optimization">Walk Forward</a></b> method.  The essence of the method lies in the fact that the strategy parameters are tested on historical data different from those used in the optimization process. <br><br>  To do this, the entire range of historical data is divided into samples consisting of sets: <br><br><ul><li>  <b>IS ("In Sample")</b> - the sample used for optimization </li><li>  <b>OOS ("Out Of Sample")</b> - a sample used to test optimization results </li></ul><br>  Moreover, the sampling ranges are formed in such a way that the OOS data follow one after another (see Fig. 5). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com//images/habrahabr/WalkForward2.png" alt="Walk Forward Optimization" width="500" height="391"></div><br>  <i>Fig.</i>  <i>5. Scheme Walk Forward optimization.</i> <br><br>  To reduce the amount of research at the stages of testing the results, after optimization you can immediately filter out strategies with poor performance, thereby reducing the overall testing time.  As a result of this check, we will obtain objective parameters of trading strategies that are protected from reoptimization (see Fig. 6 and Fig. 7). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com/images/habrahabr/gif/IS.gif" alt="In sample" width="600" height="173"></div><br>  <i>Fig.</i>  <i>6. Optimization results on the data "In Sample".</i> <br><br><div style="text-align:center;"><img src="https://softalgotrade.com/images/habrahabr/gif/OOS.gif" alt="Out of sample" width="600" height="173"></div><br>  <i>Fig.</i>  <i>7. Check the results of optimization on the data "Out Of Sample".</i> <br><br>  <b>Results analysis</b> <br><br>  As a rule, after a Walk Forward check, most of the trading strategies do not look as attractive as after the optimization.  Ideally, strategies should confirm their statistics, while extremes and clusters retain their shape and position in space. <br><br>  For a comfortable analysis of the results obtained, I visualized a multidimensional strategy space for each parameter in the format of a heat map (see <b>Fig. 8</b> ).  The map visually evaluates the shape and size of the clusters, the position of the extremes, checks the effect of the parameters on the effectiveness of the strategy, evaluates the changes after checking for re-optimization, etc. <br><br><div style="text-align:center;"><img src="https://softalgotrade.com/images/habrahabr/SharpeRatio.png" alt="Space-section Sharpe Ratio" width="600" height="335"></div><br>  <i>Fig.</i>  <i>8. An example of the cross section of the space on the optimized parameters and the objective function.</i> <br><br>  For a comprehensive assessment of the results of Walk Forward optimization, a matrix is ‚Äã‚Äãconstructed with all the steps and parameters that have passed filtering.  The steps in which the parameters confirmed their indicators are highlighted in green and red, respectively, if not confirmed.  Parameters that showed themselves well in a large number of steps can be considered more suitable for trading (see Fig. 9). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com//images/habrahabr/WalkForwardMatrix.png" alt="Walk forward matrix" width="600" height="335"></div><br>  <i>Fig.</i>  <i>9. Walk Forward matrix with all the results of the check for OOS data.</i> <br><br>  If necessary, the results can be exported to third-party analysis systems for more detailed research.  For example, in R, Excel, or Mathlab (see Figure 10). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com//images/habrahabr/Excel.png" alt="Export to Excel" width="600" height="311"></div><br>  <i>Fig.</i>  <i>10. Export optimization results to Excel.</i> <br><br>  In order to finally make sure that the chosen parameters are correct, detailed tests of strategies are carried out, the smoothness of the yield curve is assessed, bids are displayed on the schedule and the trade deals log is studied (see Fig. 11). <br><br><div style="text-align:center;"><img src="https://softalgotrade.com//images/habrahabr/Analyzer.png" alt="Analyzer" width="600" height="324"></div><br>  <i>Fig.</i>  <i>11. Detailed analysis of the parameters of a trading strategy.</i> <br><br>  <b>Conclusion</b> <br><br>  After optimization and all checks, we will have strategies that are potentially suitable for real trading on the Exchange. <br><br>  Finally, we all rechecked, probably, you can already start trading?  In fact, we are only halfway through, it is too early to send trading algorithms to battle.  Next to be: <br><br><ul><li>  Check strategies for live data from the Exchange to confirm the indicators obtained during testing. </li><li>  Build a portfolio of trading strategies for risk diversification.  By the way, it also needs to be optimized. </li><li>  In the process of real trading, periodically reduce the results obtained with the results of tests to adjust the settings of the tester-optimizer. </li></ul><br>  But this is probably another time. <br>  All successful trading! </div><p>Source: <a href="https://habr.com/ru/post/324430/">https://habr.com/ru/post/324430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324420/index.html">Cones stuffed with 15 years of using actors in C ++. Part I</a></li>
<li><a href="../324422/index.html">APS technology: cloud standard</a></li>
<li><a href="../324424/index.html">‚ÄúComplicated architecture is very simple to do‚Äù - an interview with Oleg Anastasiev from Odnoklassniki</a></li>
<li><a href="../324426/index.html">Where do programmers go after 40</a></li>
<li><a href="../324428/index.html">We share information about the work of your site. Service Overview HostTracker Part 5</a></li>
<li><a href="../324432/index.html">Analysis of demand for virtual servers</a></li>
<li><a href="../324436/index.html">Hardware solution hang GSM-modems</a></li>
<li><a href="../324438/index.html">How is the search for package tours in a country where people do not really trust credit cards?</a></li>
<li><a href="../324440/index.html">Tales of the project manager</a></li>
<li><a href="../324442/index.html">How clouds change the colocation market in data centers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>