<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a WEB system - testing based on headless chromium-browser, chromedriver, nightwatch and node.js on Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Hi, Habr! I had this problem with the problem, which was to create a robot for Instagram authorization that would make likes for me. I will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a WEB system - testing based on headless chromium-browser, chromedriver, nightwatch and node.js on Ubuntu</h1><div class="post__text post__text-html js-mediator-article"><img width="100%" src="https://habrastorage.org/getpro/habr/post_images/a1d/3d1/525/a1d3d152571ce6c82f9c120ebd36267e.png" alt="image"><br><h3>  Foreword </h3><br>  Hi, Habr!  I had this problem with the problem, which was to create a robot for Instagram authorization that would make likes for me.  I will not write the whole task, I will write only a part of the implementation in the form of setting up the necessary tools on a remote server. <br><br>  WEB testing is a voluminous and ambiguous area, which may consist in solving problems not only in terms of testing WEB applications, but also, for example, in terms of building parsers, IoT robots and bots for working with social networks and all this using only JavaScript ! <br><br><blockquote>  It is possible that you do not like the phrase "testing", perhaps partly because this phrase contains more interesting things that, for example, allow us to write a bot that can authorize on Instagram, Facebook and perform a number of actions on our behalf and at the same time it is tedious to engage in monitoring how our frontend is performed, but testing makes sense and has already been standardized by the <a href="https://www.w3.org/testing/">W3C</a> community and continues to evolve. </blockquote><a name="habracut"></a><br><h3>  Task description in a nutshell </h3><br>  What task do we set to solve with the help of testing?  All you need is for some program to open a browser and there automatically click links, type in texts and show what you get or return the result parameter that we need.  And all this needs to be done on Linux - the Ubuntu 16.04 distribution, which does not have a GUI, i.e.  we only have a console and start a familiar browser, as a full-fledged computer will fail. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  What is needed to solve a test without a GUI? </h3><br>  Everything you need for modern, ‚Äúexclusive‚Äù JavaScript testing: <br><br><ol><li>  Headless Chromium Browser v 59 ( <b>chromium-browser</b> ) - a headless browser in the console; </li><li>  Node.js ( <b>nodejs</b> ) - JavaScript server; </li><li>  WebDriver ( <b>chromedriver</b> ) - a driver for processing JavaScript tests and working with chromium-browser using Node.js; </li><li>  Nightwatch.js ( <b>nightwatch</b> ) is a well-known library for writing and running autotests with LinkedIn's <b>Node.js.</b> </li></ol><br><h3>  Installation on the server </h3><br>  We write the steps for the sequential installation of all components for testing. <br><br><img height="120" src="https://habrastorage.org/getpro/habr/post_images/94c/6c8/404/94c6c8404e64ec161001a64749963e3c.png" alt="image"><br><br>  one).  Installing <b>cromium-browser</b> .  Before installing the chromium-browser, you will need to install all the dependencies necessary for it, so you will need to perform a series of actions. <br>  Install dependencies: <br><br><pre><code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> -f install</code> </pre> <br>  If we had the first installation attempts, but put no dependencies, it would be good if you delete the downloaded files in <b>/ var / cache / apt / archives by</b> running the command: <br><br><pre> <code class="hljs swift">sudo rm /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/cache/apt/archives/chromium*</code> </pre> <br>  Now install the cromium-browser itself: <br><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install chromium-browser</code> </pre> <br><img height="120" src="https://habrastorage.org/getpro/habr/post_images/f5e/808/cdc/f5e808cdc8c7b2ae41f38858222c160f.png" alt="image"><br><br>  2).  Install <b>nodejs</b> .  How to install Node.js and all installation methods described in detail <a href="http://blog.websofter.ru/ustanovka-apgreid-ili-pereustanovka-nodejs-na-ubuntu/">here</a> . <br><br>  One of the easiest installation methods: <br><blockquote>  There is a possibility that this method will install the old stable version v4.2.6 from the Ubuntu repository, under which this testing example is not tested.  For stable operation, it is optimal if you install version 7 or higher using PPA or NVM </blockquote><br><pre> <code class="hljs pgsql">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install nodejs</code> </pre> <br>  You will also need a package manager, through which you will need to install <b>chromedriver</b> and <b>nightwatch</b> : <br><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install npm</code> </pre> <br>  We will need them to process JavaScript tests from Node.js. <br><br><img height="120" src="https://habrastorage.org/getpro/habr/post_images/176/dd7/775/176dd77750315e92786897a5efe4e83e.png" alt="image"><br><br>  3).  Install <b>chromedriver.</b>  This driver performs the role of WebDriver, providing the API, for example, to be able to click on links and type texts into text fields and forms, for this we will use Chromedriver.  To install <b>chromedriver</b> run the command: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> chromedriver</code> </pre> <br><img height="120" src="https://habrastorage.org/getpro/habr/post_images/c19/4d2/ab8/c194d2ab82e8a36a71debc7d89800506.png" alt="image"><br><br>  four).  Install <b>nightwatch</b> .  Nightwatch.js is a library for writing and running JavaScript autotests: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> nightwatch</code> </pre> <br><h3>  Testing work scheme </h3><br>  Briefly, the whole scheme looks like that the tests for Nightwatch.js send requests to Chromedriver, and the Chromedriver refers to the Chrome Browser for the execution of tests (filling in the form fields and clicking on the links): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/442/5fc/fdb/4425fcfdb48ce9441e6919552452c767.png" alt="image"><br><br><h3>  Setup and run the first test </h3><br>  The default Nightwatch.js configuration file is located in the <b>node_modules / nightwatch / bin folder</b> and the settings are taken by default from there and in order to set our custom settings for Nightwatch.js you need to create the <b>nightwatch.json</b> file in the root of the project and register everything you need to Chromedriver was used directly (without Selenium and other third-party things) and Chromium was launched in "headless" mode: <br><br><pre> <code class="hljs pgsql">{ "src_folders": ["tests"], //      "output_folder": "reports", "custom_commands_path": "", "custom_assertions_path": "", "page_objects_path": "", "globals_path": "globals.js", //   ,         "selenium": { "start_process": <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> //   , ..    Chromedriver  }, "test_settings": { "default": { "selenium_port": <span class="hljs-number"><span class="hljs-number">9515</span></span>, //   Chromedriver   ("selenium_"    ‚Äî   ) "selenium_host": "localhost", "default_path_prefix" : "", "desiredCapabilities": { "browserName": "chrome", "chromeOptions" : { "args" : ["--no-sandbox", "--headless", "--disable-gpu"], //       headless- "binary" : "/usr/bin/chromium-browser" //      }, "acceptSslCerts": <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } } } }</code> </pre><br>  It is necessary to pay attention to the line with <b>globals.js</b> .  Inside this file, you can set a global context for all tests.  Let's prescribe there so that the Chromedriver starts before all the tests are started and is nailed at the end: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> chromedriver = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'chromedriver'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">before</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done</span></span></span><span class="hljs-function">) </span></span>{ chromedriver.start(); done(); }, <span class="hljs-attr"><span class="hljs-attr">after</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">done</span></span></span><span class="hljs-function">) </span></span>{ chromedriver.stop(); done(); } };</code> </pre><br>  Now you need to write any test to test the performance of the testing system.  For example, you need to open google.com, search for something and check the search results.  Of course, the <a href="http://nightwatchjs.org/api">Nightwatch.js API</a> provides a whole bunch of all sorts of methods for all sorts of checks, but first we have enough: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-string"><span class="hljs-string">'Test google.com'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">browser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> firstResultSelector = <span class="hljs-string"><span class="hljs-string">'#rso cite._Rm'</span></span>; browser .url(<span class="hljs-string"><span class="hljs-string">'http://google.com'</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Loading google.com...'</span></span>); }) .waitForElementVisible(<span class="hljs-string"><span class="hljs-string">'#lst-ib'</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>) .execute(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'lst-ib'</span></span>).value = <span class="hljs-string"><span class="hljs-string">' WebSofter!'</span></span>; }) .submitForm(<span class="hljs-string"><span class="hljs-string">'form'</span></span>) .waitForElementVisible(firstResultSelector, <span class="hljs-number"><span class="hljs-number">5000</span></span>) .getText(firstResultSelector, result =&gt; { browser.assert.equal(result.value, <span class="hljs-string"><span class="hljs-string">'blog.websofter.ru/'</span></span>); }) .end(); } };</code> </pre><br>  Run via console on command: <br><br><pre> <code class="hljs pgsql">nightwatch <span class="hljs-comment"><span class="hljs-comment">--test google.js</span></span></code> </pre> <br><br><blockquote>  Comment.  Firstly, if Node.js is installed via nvm, then you need to activate the session via the command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nvm</span></span> ~/.profile</code> </pre> <br>  secondly, to run the test, you need to create package.json in the project root with the project data, and google.js must be specified as a launch file using the command: <br><br><pre> <code class="hljs swift">npm <span class="hljs-keyword"><span class="hljs-keyword">init</span></span></code> </pre> <br>  Next, we run the command to run our test: <br><br><pre> <code class="hljs pgsql">nightwatch <span class="hljs-comment"><span class="hljs-comment">--test google.js</span></span></code> </pre> </blockquote><br>  The result of the above code in the files will be the result in the console: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/655/910/b87/655910b87ea68e335d6d48b331ed23fe.png" alt="image"><br><br>  Ie, we go to the main site of Google, type in the search phrase ‚ÄúBlog WebSofter!‚Äù And as a result compares the address of our blog to the presence of certain tags on the search result page. <br><br>  Download the working example from this article by the <a href="">link</a> . <br><br><h3>  Conclusion </h3><br>  Originally Nightwatch.js was focused on working with Selenium.  But today, she knows how to work with <b>chromedriver</b> directly and the need for Selenium, especially in PhantomJS, disappears, although it is possible to integrate with them. <br><br>  <b>Caution!</b>  Chrome Headless Mode is available on Mac and Linux in v59.  <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D686608">Windows support</a> is included with Chrome v60.  To check which version of Chrome you have, open <br><br><pre> <code class="hljs objectivec">chrome:<span class="hljs-comment"><span class="hljs-comment">//version</span></span></code> </pre> <br><blockquote>  <a href="">Headless Chrome</a> comes in Chrome 59. This is a way to launch the Chrome browser in a headless environment;  in console without GUI.  PhantomJS worked in a similar way.  Chrome brings to the command line all the modern functions of a web platform provided by Chromium and the Blink engine. <br><br>  Why is this useful? <br><br>  Headless browser is a great tool for automated testing and server environments where you don't need a visible user interface shell.  For example, you can run some tests on a real web page, create a PDF file, or simply check how the browser displays the URL.  Additionally, you can find out by <a href="https://developers.google.com/web/updates/2017/04/headless-chrome">reference.</a> <br></blockquote><br><h3>  Related Links </h3><br><ul><li>  <a href="https://developers.google.com/web/updates/2017/04/headless-chrome">Getting Started with Headless Chrome</a> </li><li>  <a href="https://habrahabr.ru/post/329660/">How to set up a simple autotest system without Java and Selenium</a> <br></li><li>  <a href="http://blog.websofter.ru/nastroyka-systemy-web-testirovaniya-na-osnove-headless-chromium-browser-chromedriver-nightwatch-node-js-na-linux-distributive/">Official link to this article at www.blog.websofter.ru</a> <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/343522/">https://habr.com/ru/post/343522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343510/index.html">Olympiad "I am a professional" track "Information and cyber security"</a></li>
<li><a href="../343512/index.html">Is it possible to push number recognition in any tamagotchi?</a></li>
<li><a href="../343514/index.html">Face Recognition. Create and try on masks</a></li>
<li><a href="../343516/index.html">Developers on the dirtiest software tricks in games</a></li>
<li><a href="../343518/index.html">How we rewrote the Yandex.Pogoda architecture and made a global forecast on maps</a></li>
<li><a href="../343524/index.html">Network JTAG programmer for Altera Quartus Prime from Raspberry Pi3</a></li>
<li><a href="../343526/index.html">Two geometric tasks that came across at the interview, and where they live</a></li>
<li><a href="../343530/index.html">Development for Sailfish OS: Using Sensors (Part 2)</a></li>
<li><a href="../343532/index.html">Mikrotik: Download speed limit for certain IP addresses</a></li>
<li><a href="../343534/index.html">Analysis of the quest Digital Security ICO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>