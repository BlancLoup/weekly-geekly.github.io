<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a sound effects synthesizer from retro games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, you will learn how to create an audio engine based on a synthesizer that can generate sounds for retro-style games. The sound engine ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a sound effects synthesizer from retro games</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fc/5c7/2a9/5fc5c72a93ea9a5c4fce4c93fe022f7e.png" alt="image"></div><br>  In this article, you will learn how to create an audio engine based on a synthesizer that can generate sounds for retro-style games.  The sound engine will generate all sounds at run time and it does not require any external dependencies, such as MP3 or WAV files.  The end result will be a working library that can be conveniently embedded in games. <br><br>  Before we start creating an audio engine, we need to deal with a couple of concepts.  First, with the waves that the engine will use to generate sounds.  Secondly, it is necessary to understand how sound waves are stored and designated in digital form. <br><br>  This tutorial uses the programming language ActionScript 3.0, but the techniques and concepts used can be easily converted to any other language that provides access to a low-level API for working with sound. <br><a name="habracut"></a><br><hr><br><h2>  Waves </h2><br>  The audio engine we create will use four basic types of waves (also known as <em>periodic</em> waves, because their basic forms are periodically repeated).  All of them are very often used in both analog and digital synthesizers.  Each waveform has its own unique sound characteristic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below is a visual representation of each of the waveforms, sound samples and the code necessary to generate each of the waveforms as an array of sampled data. <br><br><h3>  Pulse </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d23/8a7/fb1/d238a7fb194ee5da4442033d9a52277f.png"><br><br>  Pulse wave creates a sharp and harmonious sound. <br><br>  <a href="">Download MP3</a> . <br><br>  To generate an array of values ‚Äã‚Äãrepresenting a pulse wave (in the range from -1.0 to 1.0), you can use the following code, in which <code>n</code> is the number of values ‚Äã‚Äãneeded to fill the array, <code>a</code> is an array, <code>p</code> is the normalized position inside the wave: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:Number; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i &lt; n ) { p = i / n; a[i] = p &lt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? <span class="hljs-number"><span class="hljs-number">1.0</span></span> : <span class="hljs-number"><span class="hljs-number">-1.0</span></span>; i ++; }</code> </pre> <br><h3>  Saw </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d98/8a2/72f/d988a272fabe9f3f1921045fb4ccddef.png"><br><br>  The sawtooth wave creates a harsh and harsh sound. <br><br>  <a href="">Download MP3</a> . <br><br>  To generate an array of values ‚Äã‚Äãrepresenting a sawtooth wave (in the range from -1.0 to 1.0), where <code>n</code> is the number of values ‚Äã‚Äãrequired to fill the array, <code>a</code> is the array, <code>p</code> is the normalized position inside the wave: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:Number; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i &lt; n ) { p = i / n; a[i] = p &lt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? p * <span class="hljs-number"><span class="hljs-number">2.0</span></span> : p * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">2.0</span></span>; i ++; }</code> </pre> <br><br><h3>  Sinusoid </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/2a7/881/990/2a788199045dc38db650e21f6698fc9b.png"><br><br>  The sine wave creates a smooth and clear sound. <br><br>  <a href="">Download MP3</a> . <br><br>  To generate an array of values ‚Äã‚Äãrepresenting a sine wave (in the range from -1.0 to 1.0), you can use the following code, where <code>n</code> is the number of values ‚Äã‚Äãrequired to fill the array, <code>a</code> is an array, <code>p</code> is the normalized position inside the wave: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:Number; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i &lt; n ) { p = i / n; a[i] = Math.sin( p * <span class="hljs-number"><span class="hljs-number">2.0</span></span> * Math.PI ); i ++; }</code> </pre> <br><h3>  Triangle </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/a46/54a/09b/a4654a09b8d25665fe95e0089396bcd0.png"><br><br>  The triangular wave creates a smooth and harmonious sound. <br><br>  <a href="">Download MP3</a> . <br><br>  To generate an array of values ‚Äã‚Äã(in the range from -1.0 to 1.0), you can use the following code, where <code>n</code> is the number of values ‚Äã‚Äãneeded to fill the array, <code>a</code> is the array, <code>p</code> is the normalized position representing the wave: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:Number; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i &lt; n ) { p = i / n; a[i] = p &lt; <span class="hljs-number"><span class="hljs-number">0.25</span></span> ? p * <span class="hljs-number"><span class="hljs-number">4.0</span></span> : p &lt; <span class="hljs-number"><span class="hljs-number">0.75</span></span> ? <span class="hljs-number"><span class="hljs-number">2.0</span></span> - p * <span class="hljs-number"><span class="hljs-number">4.0</span></span> : p * <span class="hljs-number"><span class="hljs-number">4.0</span></span> - <span class="hljs-number"><span class="hljs-number">4.0</span></span>; i ++; }</code> </pre> <br>  Here is the expanded version of line 6: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p &lt; <span class="hljs-number"><span class="hljs-number">0.25</span></span>) { a[i] = p * <span class="hljs-number"><span class="hljs-number">4.0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p &lt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>) { a[i] = <span class="hljs-number"><span class="hljs-number">2.0</span></span> - (p * <span class="hljs-number"><span class="hljs-number">4.0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { a[i] = (p * <span class="hljs-number"><span class="hljs-number">4.0</span></span>) - <span class="hljs-number"><span class="hljs-number">4.0</span></span>; }</code> </pre> <br><hr><br><h2>  Wave amplitude and frequency </h2><br>  A sound wave has two important properties ‚Äî the <em>amplitude</em> and <em>frequency of the</em> wave: the <em>volume</em> and <em>pitch of the</em> sound, respectively, depend on them.  Amplitude is the absolute peak value of a wave, and frequency is the number of times that a wave repeats in a second.  Frequency is usually measured in <a href="http://en.wikipedia.org/wiki/Hertz">Hertz (Hz, Hz)</a> <br><br>  The figure below shows a 200-ms snapshot of a sawtooth wave with an amplitude of 0.5 and a frequency of 20 Hz: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/541/bff/d23/541bffd23566846cc1c24489a844f068.png"><br><br>  I will give an example of how the frequency of a wave directly affects the pitch: a wave with a frequency of 440 Hz has the same pitch as the standard note for the first octave (A4) of a modern concert piano.  Given this frequency, we can calculate the frequency of any other note using the following code: <br><br><pre> <code class="actionscript hljs">f = Math.pow( <span class="hljs-number"><span class="hljs-number">2</span></span>, n / <span class="hljs-number"><span class="hljs-number">12</span></span> ) * <span class="hljs-number"><span class="hljs-number">440.0</span></span>;</code> </pre> <br>  The variable <code>n</code> in this code is the number of notes from A4 to the note of interest.  For example, to find the frequency for the second octave (A5), one octave above A4, we need to assign <code>n</code> value of <code>12</code> , because A5 is 12 notes above A4.  To find the frequencies of the large octave (E2), we need to assign <code>n</code> value of <code>-5</code> , because E2 is 5 notes below A4.  You can also do the reverse operation and find a note (relative to A4) at a given frequency: <br><br><pre> <code class="actionscript hljs">n = Math.round( <span class="hljs-number"><span class="hljs-number">12.0</span></span> * Math.log( f / <span class="hljs-number"><span class="hljs-number">440.0</span></span> ) * Math.LOG2E );</code> </pre> <br>  These calculations work because the frequencies of the notes are <a href="http://betterexplained.com/articles/using-logs-in-the-real-world/">logarithmic</a> ‚Äî multiplying the frequency by two shifts the note up one octave, and dividing the frequency by two lowers the note one octave. <br><br><hr><br><h2>  Digital sound waves </h2><br>  In the digital world, sound waves must be stored as binary data, and this is usually accomplished by taking periodic snapshots of the state (or samples) of the sound wave.  The number of wave samples received per second sound duration is called <em>the sampling frequency</em> , that is, a sound with a sampling frequency of 44100 will contain 44100 wave samples (per channel) per second of sound duration. <br><br>  The figure below shows how to sample a sound wave: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fc/5c7/2a9/5fc5c72a93ea9a5c4fce4c93fe022f7e.png"><br><br>  White dots in the figure show wave amplitude points sampled and stored in digital format.  You can perceive them as the resolution of a bitmap: the more pixels there are in the bitmap, the more visual information it can store, and the increase in the amount of information leads to an increase in the size of the files (here we do not consider compression).  The same is true for digital sounds: the more wave samples a sound file contains, the more accurate the recreated sound wave will be. <br><br>  In addition to the sampling frequency, digital sounds also have <em>a bit rate</em> , measured in bits per second.  From the bit rate (bit rate) depends on the number of binary bits used to store each sample wave.  This is similar to the number of bits used to store the ARGB information of each pixel of a bitmap.  For example, a sound with a sampling frequency of 44100 and a bit rate of 705600 will store each of the wave samples as a 16-bit value, and we can quite easily calculate it with the following code: <br><br><pre> <code class="actionscript hljs">bitsPerSample = bitRate / sampleRate;</code> </pre> <br>  Here is a practical example in which the above values ‚Äã‚Äãare used: <br><br><pre> <code class="actionscript hljs">trace( <span class="hljs-number"><span class="hljs-number">705600</span></span> / <span class="hljs-number"><span class="hljs-number">44100</span></span> ); <span class="hljs-comment"><span class="hljs-comment">// "16"</span></span></code> </pre> <br>  The most important thing here is to understand what sound samples are.  The engine we create will generate raw sound samples and control them. <br><br><hr><br><h2>  Modulators </h2><br>  Before you start programming the sound engine, you need to get acquainted with another concept - <em>modulators</em> that are actively used in analog and digital synthesizers.  In essence, a modulator is a standard wave, but instead of creating sound, they are usually used to modulate one or more properties of a sound wave (i.e., its amplitude or frequency). <br><br>  For example, take <em>vibrato</em> .  Vibrato is a periodic, pulsating change in height.  To create such an effect using a modulator, you can set a modulator wave for a sine wave and set the modulator frequency to, for example, 8 Hz.  If you then connect this modulator to the frequency of the sound wave, the result is a vibrato effect - the modulator will smoothly increase and decrease the frequency (height) of the sound wave eight times per second. <br><br>  The engine we create will allow you to attach modulators to sounds to provide a wide range of different effects. <br><br><hr><br><h2>  Demo audio engine </h2><br>  In this part we will write all the basic code needed for a full audio engine.  Here is a simple demonstration of the audio engine (Flash): <a href="">demo</a> . <br><br>  In this demonstration, only one sound is played, but the frequency of the sound changes randomly.  A modulator is also connected to the sound, creating a vibrato effect (modulating the amplitude of the sound), and the frequency of the modulator also changes randomly. <br><br><hr><br><h2>  AudioWaveform class </h2><br>  The first class we create will simply store the constant values ‚Äã‚Äãfor the waves that the engine will use to generate sounds. <br><br>  Let's start by creating a new class package called <code>noise</code> , and then add the following class to this package: <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioWaveform</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PULSE:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SAWTOOTH:int = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SINE:int = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TRIANGLE:int = <span class="hljs-number"><span class="hljs-number">3</span></span>; } }</code> </pre> <br>  We will also add to the class a static general method that can be used to check the value of the wave.  The method will return <code>true</code> or <code>false</code> depending on the correctness of the wave value. <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( waveform:int )</span></span></span><span class="hljs-function">:Boolean </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( waveform == PULSE ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( waveform == SAWTOOTH ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( waveform == SINE ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( waveform == TRIANGLE ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Finally, we need to protect the class from instantiating it, because there is no reason to create it.  This can be done inside the class constructor: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioWaveform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Error( <span class="hljs-string"><span class="hljs-string">"AudioWaveform class cannot be instantiated"</span></span> ); }</code> </pre> <br>  With this we have completed the creation of the class. <br><br>  Protecting enum-style classes, completely static classes and singleton classes from directly creating instances is good practice, because instances of such classes should not be created, there is no reason for that.  In some programming languages, for example, in Java, for most of these types of classes this is done automatically, but in ActionScript 3.0 it is necessary to enforce this behavior inside the class constructor. <br><br><hr><br><h2>  Class audio </h2><br>  Next on the list is the <code>Audio</code> class.  By nature, this class is similar to the native ActionScript 3.0 <code>Sound</code> class, each audio engine will be represented as an instance of the <code>Audio</code> class. <br><br>  Add the following class skeleton to the <code>noise</code> package: <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Audio</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Audio</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } }</code> </pre> <br>  The first thing to add to the class is the properties that tell the audio engine how to generate a sound wave when the sound is played.  These properties are the type of wave used in the sound, the frequency and amplitude of the wave, the duration of the sound and the decay time.  All these properties will be private, and they will be accessed via getters / setters: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_waveform:int = AudioWaveform.PULSE; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_frequency:Number = <span class="hljs-number"><span class="hljs-number">100.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_amplitude:Number = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_duration:Number = <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_release:Number = <span class="hljs-number"><span class="hljs-number">0.2</span></span>;</code> </pre> <br>  As you can see, we set reasonable default values ‚Äã‚Äãfor each property.  <code>amplitude</code> is a value in the range from <code>0.0</code> to <code>1.0</code> , <code>frequency</code> is in Hz, and <code>duration</code> and <code>release</code> are in seconds. <br><br>  We also need to add two more private properties for modulators connected to the sound.  Access to these properties will also be carried out via getters / setters: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_frequencyModulator:AudioModulator = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_amplitudeModulator:AudioModulator = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  Finally, the <code>Audio</code> class should contain several internal properties that only the <code>AudioEngine</code> class will have access to (we will write it soon).  These properties do not need to be hidden behind getters / setters: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> position:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playing:Boolean = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> releasing:Boolean = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> samples:Vector.&lt;Number&gt; = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  <code>position</code> is set in seconds and allows the <code>AudioEngine</code> class <code>AudioEngine</code> track the position of the sound when it is played.  This is necessary to calculate the sound samples of the wave.  The <code>playing</code> and <code>releasing</code> tell the <code>AudioEngine</code> class what state the sound is in, and the <code>samples</code> property is a reference to the cached wave samples used by the sound.  How these properties are used, we will understand when we write the <code>AudioEngine</code> class. <br><br>  To complete the <code>Audio</code> class, add getters / setters: <br><br> <code>Audio. <strong>waveform</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waveform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:int </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_waveform; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waveform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:int )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( AudioWaveform.isValid( value ) == <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>( value ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.PULSE: samples = AudioEngine.PULSE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.SAWTOOTH: samples = AudioEngine.SAWTOOTH; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.SINE: samples = AudioEngine.SINE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.TRIANGLE: samples = AudioEngine.TRIANGLE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } m_waveform = value; }</code> </pre> <br> <code>Audio. <strong>frequency</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_frequency; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  frequency  1.0 - 14080.0 m_frequency = value &lt; 1.0 ? 1.0 : value &gt; 14080.0 ? 14080.0 : value; }</span></span></code> </pre> <br> <code>Audio. <strong>amplitude</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_amplitude; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  amplitude  0.0 - 1.0 m_amplitude = value &lt; 0.0 ? 0.0 : value &gt; 1.0 ? 1.0 : value; }</span></span></code> </pre> <br> <code>Audio. <strong>duration</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_duration; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  duration  0.0 - 60.0 m_duration = value &lt; 0.0 ? 0.0 : value &gt; 60.0 ? 60.0 : value; }</span></span></code> </pre> <br> <code>Audio. <strong>release</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_release; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">release</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   release  0.0 - 10.0 m_release = value &lt; 0.0 ? 0.0 : value &gt; 10.0 ? 10.0 : value; }</span></span></code> </pre> <br> <code>Audio. <strong>frequencyModulator</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequencyModulator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:AudioModulator </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_frequencyModulator; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequencyModulator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:AudioModulator )</span></span></span><span class="hljs-function">:void </span></span>{ m_frequencyModulator = value; }</code> </pre> <br> <code>Audio. <strong>amplitudeModulator</strong></code> <br> <br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitudeModulator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:AudioModulator </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_amplitudeModulator; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitudeModulator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:AudioModulator )</span></span></span><span class="hljs-function">:void </span></span>{ m_amplitudeModulator = value; }</code> </pre> <br>  You certainly noticed the <code>[Inline]</code> metadata label associated with some of the getter functions.  This metadata label is a feature of the <a href="http://www.bytearray.org/%3Fp%3D4789">ActionScript 3.0 Compiler</a> , and it does exactly what its name implies: it <a href="http://en.wikipedia.org/wiki/Inline_function">embeds</a> (expands) the contents of the function.  When used wisely, this feature is incredibly useful for optimization, and the task of generating a dynamic audio signal during the execution of an optimization program exactly requires. <br><br><hr><br><h2>  AudioModulator class </h2><br>  The <code>AudioModulator</code> is to enable the amplitude and frequency modulation of <code>Audio</code> instances to create various useful effects.  Modulators are actually similar to <code>Audio</code> instances, they have a waveform, amplitude and frequency, but they do not create any audible sound, but only modify other sounds. <br><br>  Let's start from the beginning - let's create the following class skeleton in the <code>noise</code> package: <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioModulator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioModulator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } }</code> </pre> <br>  Now add private properties: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_waveform:int = AudioWaveform.SINE; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_frequency:Number = <span class="hljs-number"><span class="hljs-number">4.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_amplitude:Number = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_shift:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_samples:Vector.&lt;Number&gt; = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  If you think that this is very similar to the <code>Audio</code> class, then you are not mistaken: everything is the same here, except for the <code>shift</code> property. <br><br>  To understand what the <code>shift</code> property does, recall one of the base waves used by the audio engine (pulse, sawtooth, sinusoidal, or triangular) and imagine a vertical line passing through the wave anywhere.  The horizontal position of this vertical line will be the <code>shift</code> value;  this value is in the range from <code>0.0</code> to <code>1.0</code> , telling the modulator where to start reading the wave.  In turn, it has an absolute influence on the modifications made by the modulator to the amplitude or frequency of the sound. <br><br>  For example, if a modulator uses a sine wave to modulate the frequency of the sound, and <code>shift</code> has the value <code>0.0</code> , then the frequency of the sound will first increase and then decrease according to the curvature of the sinusoid.  However, if <code>shift</code> set to <code>0.5</code> , the frequency of the sound will first decrease, and therefore increase. <br><br>  Well, back to the code.  <code>AudioModulator</code> contains one internal method used only by <code>AudioEngine</code> .  The method is as follows: <br><br><pre> <code class="actionscript hljs">[Inline] <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( time:Number )</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_shift != <span class="hljs-number"><span class="hljs-number">0.0</span></span> ) { time += ( <span class="hljs-number"><span class="hljs-number">1.0</span></span> / m_frequency ) * m_shift; } p = ( <span class="hljs-number"><span class="hljs-number">44100</span></span> * m_frequency * time ) % <span class="hljs-number"><span class="hljs-number">44100</span></span>; s = m_samples[p]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s * m_amplitude; }</code> </pre> <br>  This function is built in because it is often used, and by ‚Äúoften‚Äù I mean ‚Äú44,100 times per second‚Äù for each reproduced sound to which the modulator is connected (this is where embedding turns out to be incredibly useful).  The function simply receives a sound sample from the waveform used by the modulator, changes the amplitude of the sample, and then returns the result. <br><br>  To complete the <code>AudioModulator</code> class, add getters / setters: <br><br> <code>AudioModulator. <strong>waveform</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waveform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:int </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_waveform; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">waveform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:int )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( AudioWaveform.isValid( value ) == <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>( value ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.PULSE: m_samples = AudioEngine.PULSE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.SAWTOOTH: m_samples = AudioEngine.SAWTOOTH; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.SINE: m_samples = AudioEngine.SINE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> AudioWaveform.TRIANGLE: m_samples = AudioEngine.TRIANGLE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } m_waveform = value; }</code> </pre> <br> <code>AudioModulator. <strong>frequency</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_frequency; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frequency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  frequency  0.01 - 100.0 m_frequency = value &lt; 0.01 ? 0.01 : value &gt; 100.0 ? 100.0 : value; }</span></span></code> </pre> <br> <code>AudioModulator. <strong>amplitude</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_amplitude; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  amplitude  0.0 - 8000.0 m_amplitude = value &lt; 0.0 ? 0.0 : value &gt; 8000.0 ? 8000.0 : value; }</span></span></code> </pre> <br> <code>AudioModulator. <strong>shift</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shift</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_shift; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shift</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  shift  0.0 - 1.0 m_shift = value &lt; 0.0 ? 0.0 : value &gt; 1.0 ? 1.0 : value; }</span></span></code> </pre> <br>  And on this class <code>AudioModulator</code> can be considered complete. <br><br><hr><br><h2>  AudioEngine class </h2><br>  And now a serious task: class <code>AudioEngine</code> .  This is a completely static class.  It controls almost everything related to <code>Audio</code> and sound generation. <br><br>  Let's start as usual with the class skeleton in <code>noise</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.events.SampleDataEvent;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.media.Sound;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.media.SoundChannel;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.utils.ByteArray;</span></span> <span class="hljs-comment"><span class="hljs-comment">// public final class AudioEngine { public function AudioEngine() { throw new Error( "AudioEngine class cannot be instantiated" ); } } }</span></span></code> </pre> <br>  As stated above, for completely static classes, no instances should be created, so if someone tries to create an instance, an exception is thrown in the class constructor.  The class is also <code>final</code> , because there is no reason to extend the completely static class. <br><br>  The first thing we add to this class is internal constants.  These constants will be used to cache the samples of each of the four waveforms used by the audio engine.  Each cache contains 44,100 samples, which is equal to one-herbal waveforms.  This allows the audio engine to create very clean low frequency sound waves. <br><br>  The following constants are used: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PULSE:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;( <span class="hljs-number"><span class="hljs-number">44100</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SAWTOOTH:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;( <span class="hljs-number"><span class="hljs-number">44100</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SINE:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;( <span class="hljs-number"><span class="hljs-number">44100</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TRIANGLE:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;( <span class="hljs-number"><span class="hljs-number">44100</span></span> );</code> </pre> <br>  The class also uses two private constants: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BUFFER_SIZE:int = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SAMPLE_TIME:Number = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">44100.0</span></span>;</code> </pre> <br>  <code>BUFFER_SIZE</code> is the number of sound samples transmitted by the ActionScript 3.0 audio API when making a sound sample request.  This is the smallest allowable number of samples, which provides the lowest possible sound latency.  The number of samples can be increased to reduce the load on the CPU, but this will increase the latency of the sound.  <code>SAMPLE_TIME</code> is the duration of one sound sample in seconds. <br><br>  And now private variables: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_position:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_amplitude:Number = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_soundStream:Sound = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_soundChannel:SoundChannel = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_audioList:Vector.&lt;Audio&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Audio&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_sampleList:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;( BUFFER_SIZE );</code> </pre> <br><ul><li>  <code>m_position</code> used to track audio streaming time in seconds. </li><li>  <code>m_amplitude</code> is the global secondary amplitude for all playable <code>Audio</code> instances. </li><li>  <code>m_soundStream</code> and <code>m_soundChannel</code> explanatory. </li><li>  <code>m_audioList</code> contains links to all playable copies of <code>Audio</code> . </li><li>  <code>m_sampleList</code> is a temporary buffer used to store sound samples when they are requested by the ActionScript 3.0 audio API. </li></ul><br>  Now we need to initialize the class.  There are many ways to do this, but I prefer the simple and understandable static class constructor: <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioEngine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = <span class="hljs-number"><span class="hljs-number">44100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// while( i &lt; n ) { p = i / n; SINE[i] = Math.sin( Math.PI * 2.0 * p ); PULSE[i] = p &lt; 0.5 ? 1.0 : -1.0; SAWTOOTH[i] = p &lt; 0.5 ? p * 2.0 : p * 2.0 - 2.0; TRIANGLE[i] = p &lt; 0.25 ? p * 4.0 : p &lt; 0.75 ? 2.0 - p * 4.0 : p * 4.0 - 4.0; i++; } // m_soundStream = new Sound(); m_soundStream.addEventListener( SampleDataEvent.SAMPLE_DATA, onSampleData ); m_soundChannel = m_soundStream.play(); } $AudioEngine();</span></span></code> </pre> <br>  In this code, the following happens: samples are generated and cached for each of the four waveforms, and this happens only once.  It also creates an instance of the audio stream that runs and plays before the application is completed. <br><br>  The <code>AudioEngine</code> class has three general methods used to play and stop <code>Audio</code> instances: <br><br> <code>AudioEngine. <strong>play()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( audio:Audio )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( audio.playing == <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) { m_audioList.push( audio ); } <span class="hljs-comment"><span class="hljs-comment">//     ,      audio.position = m_position - ( m_soundChannel.position * 0.001 ); audio.playing = true; audio.releasing = false; }</span></span></code> </pre> <br> <code>AudioEngine. <strong>stop()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( audio:Audio, allowRelease:Boolean = true )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( audio.playing == <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">//    return; } if( allowRelease ) { //         audio.position = audio.duration; audio.releasing = true; return; } audio.playing = false; audio.releasing = false; }</span></span></code> </pre> <br> <code>AudioEngine. <strong>stopAll()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( allowRelease:Boolean = true )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = m_audioList.length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o:Audio = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">// if( allowRelease ) { while( i &lt; n ) { o = m_audioList[i]; o.position = o.duration; o.releasing = true; i++; } return; } while( i &lt; n ) { o = m_audioList[i]; o.playing = false; o.releasing = false; i++; } }</span></span></code> </pre> <br>         ,     : <br><br> <code>AudioEngine. <strong>onSampleData()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSampleData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event:SampleDataEvent )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = BUFFER_SIZE; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b:ByteArray = event.data; <span class="hljs-comment"><span class="hljs-comment">// if( m_soundChannel == null ) { while( i &lt; n ) { b.writeFloat( 0.0 ); b.writeFloat( 0.0 ); i++; } return; } // generateSamples(); // while( i &lt; n ) { s = m_sampleList[i] * m_amplitude; b.writeFloat( s ); b.writeFloat( s ); m_sampleList[i] = 0.0; i++; } // m_position = m_soundChannel.position * 0.001; }</span></span></code> </pre> <br> ,    <code>if</code>  , -  <code>m_soundChannel</code>   null.   ,    <code>SAMPLE_DATA</code>      <code>m_soundStream.play()</code>    ,       <code>SoundChannel</code> . <br><br>  <code>while</code>   ,  <code>m_soundStream</code>      <code>ByteArray</code> .     : <br><br> <code>AudioEngine. <strong>generateSamples()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSamples</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = m_audioList.length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k:int = BUFFER_SIZE; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o:Audio = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   audio while( i &lt; n ) { o = m_audioList[i]; // if( o.playing == false ) { //  audio   m_audioList.splice( i, 1 ); n--; continue; } // j = 0; //      while( j &lt; k ) { if( o.position &lt; 0.0 ) { //  audio     o.position += SAMPLE_TIME; j++; continue; } if( o.position &gt;= o.duration ) { if( o.position &gt;= o.duration + o.release ) { //  audio  o.playing = false; j++; continue; } //  audio    o.releasing = true; } //      audio f = o.frequency; a = o.amplitude; // if( o.frequencyModulator != null ) { //   f += o.frequencyModulator.process( o.position ); } // if( o.amplitudeModulator != null ) { //   a += o.amplitudeModulator.process( o.position ); } //      p = ( 44100 * f * o.position ) % 44100; //    s = o.samples[p]; // if( o.releasing ) { //      s *= 1.0 - ( ( o.position - o.duration ) / o.release ); } //     m_sampleList[j] += s * a; //    audio o.position += SAMPLE_TIME; j++; } i++; } }</span></span></code> </pre> <br> ,  ,   ,    /    <code>m_amplitude</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_amplitude; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">amplitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  amplitude  0.0 - 1.0 m_amplitude = value &lt; 0.0 ? 0.0 : value &gt; 1.0 ? 1.0 : value; }</span></span></code> </pre> <br><hr><br><h2>   </h2><br>         <em></em>     <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BB%25D1%258D%25D0%25B9"></a> .         (Flash): <a href=""></a> . <br><br>       ,      ,        ,     . <br><br><hr><br><h2>  AudioProcessor </h2><br> ,    ‚Äî     : <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// public var enabled:Boolean = true; // public function AudioProcessor() { if( Object(this).constructor == AudioProcessor ) { throw new Error( "AudioProcessor class must be extended" ); } } // internal function process( samples:Vector.&lt;Number&gt; ):void {} } }</span></span></code> </pre> <br>   ,   ,     <code>process()</code> ,   <code>AudioEngine</code> ,    ,    <code>enabled</code> ,        . <br><br><hr><br><h2>  AudioDelay </h2><br>  <code>AudioDelay</code> ‚Äî  ,    .    <code>AudioProcessor</code> .    ,     : <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioDelay</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// public function AudioDelay( time:Number = 0.5 ) { this.time = time; } } }</span></span></code> </pre> <br>  <code>time</code> ,   , ‚Äî   ( )  ,        . <br><br>     : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_buffer:Vector.&lt;Number&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;Number&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_bufferSize:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_bufferIndex:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_time:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_gain:Number = <span class="hljs-number"><span class="hljs-number">0.8</span></span>;</code> </pre> <br>  <code>m_buffer</code> ‚Äî  <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B2%25D1%258F%25D0%25B7%25D1%258C_(%25D1%2582%25D0%25B5%25D1%2585%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B0)">  </a> :     ,   <code>process</code> ,      (     )    <code>m_bufferIndex</code>  .    ,      <code>process()</code> . <br><br>  <code>m_bufferSize</code>  <code>m_bufferIndex</code>     .  <code>m_time</code> ‚Äî      .  <code>m_gain</code> ‚Äî  ,         . <br><br>      ,     <code>process()</code> ,   <code>process()</code>   <code>AudioProcessor</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( samples:Vector.&lt;Number&gt; )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = samples.length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v:Number = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// while( i &lt; n ) { v = m_buffer[m_bufferIndex]; //    v *= m_gain; //   v += samples[i]; //    // m_buffer[m_bufferIndex] = v; m_bufferIndex++; // if( m_bufferIndex == m_bufferSize ) { m_bufferIndex = 0; } // samples[i] = v; i++; } }</span></span></code> </pre> <br> ,    /    <code>m_time</code>  <code>m_gain</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_time; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  time  0.0001 - 8.0 value = value &lt; 0.0001 ? 0.0001 : value &gt; 8.0 ? 8.0 : value; //  time  ,      if( m_time == value ) { return; } //  time m_time = value; //    m_bufferSize = Math.floor( 44100 * m_time ); m_buffer.length = m_bufferSize; }</span></span></code> </pre> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:Number </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_gain; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value:Number )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  gain  0.0 - 1.0 m_gain = value &lt; 0.0 ? 0.0 : value &gt; 1.0 ? 1.0 : value; }</span></span></code> </pre> <br>   ,     <code>AudioDelay</code> .        ,  ,      ( <code>m_buffer</code> ). <br><br><hr><br><h2>   <code>AudioEngine</code> </h2><br> ,    ‚Äî   <code>AudioEngine</code> ,       . -,       : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m_processorList:Vector.&lt;AudioProcessor&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector.&lt;AudioProcessor&gt;();</code> </pre> <br>         <code>AudioEngine</code> ,      : <br><br> <code>AudioEngine. <strong>addProcessor()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( processor:AudioProcessor )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_processorList.indexOf( processor ) == <span class="hljs-number"><span class="hljs-number">-1</span></span> ) { m_processorList.push( processor ); } }</code> </pre> <br> <code>AudioEngine. <strong>removeProcessor()</strong></code> <br> <br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( processor:AudioProcessor )</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = m_processorList.indexOf( processor ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( i != <span class="hljs-number"><span class="hljs-number">-1</span></span> ) { m_processorList.splice( i, <span class="hljs-number"><span class="hljs-number">1</span></span> ); } }</code> </pre> <br>    ‚Äî         <code>AudioProcessor</code>   <code>m_processorList</code> . <br><br>  ,   ,     ,    ,      <code>process()</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processSamples</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n:int = m_processorList.length; <span class="hljs-comment"><span class="hljs-comment">// while( i &lt; n ) { if( m_processorList[i].enabled ) { m_processorList[i].process( m_sampleList ); } i++; } }</span></span></code> </pre> <br>      ,    ,       <code>onSampleData()</code>  <code>AudioEngine</code> : <br><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_soundChannel == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i &lt; n ) { b.writeFloat( <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); b.writeFloat( <span class="hljs-number"><span class="hljs-number">0.0</span></span> ); i++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// generateSamples(); processSamples(); // while( i &lt; n ) { s = m_sampleList[i] * m_amplitude; b.writeFloat( s ); b.writeFloat( s ); m_sampleList[i] = 0.0; i++; }</span></span></code> </pre> <br>       <code>processSamples();</code>  .     <code>processSamples()</code> ,    . <br><br><hr><br><h2>  Conclusion </h2><br>  That's all.                 .      ,    ,  . <br><br>       ,    ,           .      (   ),         ‚Äî        (  worker ActionScript 3.0),            . <br><br>                ,                   .          ()   ,   :  ,          . <br><br>       :  ‚Äî   ,     ,   .           ,     .         . <br><br> ,   ,       - .            ,      . <br><br>       <a href=""></a> . <br><br> ! </div><p>Source: <a href="https://habr.com/ru/post/338544/">https://habr.com/ru/post/338544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338532/index.html">CIS Benchmarks: best practices, guidelines and recommendations for information security</a></li>
<li><a href="../338536/index.html">Automation to collect data on the growth of tables and files of all MS SQL Server databases</a></li>
<li><a href="../338538/index.html">MikroTik - several addresses and several different MAC on one interface</a></li>
<li><a href="../338540/index.html">CGLayout - new automatic layout system in iOS</a></li>
<li><a href="../338542/index.html">How does Microsoft try to send mobile mail to itself?</a></li>
<li><a href="../338548/index.html">How to distinguish birds from flowers. Or flowers from birds</a></li>
<li><a href="../338550/index.html">MVP recommendation system for GitHub weekly</a></li>
<li><a href="../338554/index.html">Visualization of election results in Moscow on a map in Jupyter Notebook</a></li>
<li><a href="../338556/index.html">Go: 10 years and grow further</a></li>
<li><a href="../338558/index.html">Reactive applications with Model-View-Intent. Part 2: View and Intent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>