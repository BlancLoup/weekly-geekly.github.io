<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Index method for generating finite discrete distributions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes it is very interesting to imitate the roll of the dice For this there is an effective algorithm that allows you to generate the value fallen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Index method for generating finite discrete distributions</h1><div class="post__text post__text-html js-mediator-article">  Sometimes it is very interesting to imitate the roll of the dice  For this there is an effective algorithm that allows you to generate the value fallen on the upper face, using a pseudo-random number <img src="https://habrastorage.org/getpro/habr/post_images/d3c/c39/ae8/d3cc39ae8468bfdd4c8e3fcc7aa4fb0e.png" alt="alpha">  from even distribution on <img src="https://habrastorage.org/getpro/geektimes/post_images/1e5/668/a24/1e5668a24690f7b412a044dbc14ad6bd.png" alt="[0,1]">  .  Namely: <img src="https://habrastorage.org/getpro/geektimes/post_images/7fb/f23/e55/7fbf23e552d66e88f48b8e511d416991.png" alt="image">  where <img src="https://habrastorage.org/getpro/geektimes/post_images/2bb/faf/b47/2bbfafb47837bac14f153e0a85354ce8.png" alt="image">  - taking the whole part of the argument. <br><br>  But suppose that we have a ‚Äúdishonest‚Äù bone and the faces fall out unevenly.  Let our bone has K faces, and <img src="https://habrastorage.org/getpro/geektimes/post_images/745/fbc/10e/745fbc10e3d653f4f0cbae99663100ce.png" alt="p_i">  face loss probability <img src="https://habrastorage.org/getpro/geektimes/post_images/8af/533/067/8af533067baf4a941467bc2fdf73e94e.png" alt="image">  .  This is a natural limitation. <img src="https://habrastorage.org/getpro/geektimes/post_images/437/c60/9f6/437c609f6f911f958cfff264f94cc7c9.png" alt="image">  .  I will try to answer the question: how to simulate a pseudo-random sequence with such a distribution? <br><a name="habracut"></a><br><br><pre><code class="hljs lua">#Naive approach <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>&lt;<span class="hljs-number"><span class="hljs-number">-10</span></span> ps&lt;-seq(<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>, by=<span class="hljs-number"><span class="hljs-number">-1</span></span>) ps&lt;- <span class="hljs-number"><span class="hljs-number">1</span></span>/ps^<span class="hljs-number"><span class="hljs-number">2</span></span> ps&lt;-ps/sum(ps) ss&lt;-cumsum(ps) gen_naiv &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { alpha&lt;-runif(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(which(alpha&lt;ss))) } #sample val&lt;-c() <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>&lt;<span class="hljs-number"><span class="hljs-number">-10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>) { val&lt;-append(val, gen_naiv()) } vals&lt;-factor(val) plot(vals)</code> </pre> <br><img src="http://habrastorage.org/storage2/fa9/815/8bc/fa98158bc7a9c623ce3e268b1b3b667e.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the "naive" version of the generation of such a distribution.  We introduce the concept of partial sums <img src="http://mathurl.com/a3uuotf.png" alt="image">  , you can write equality <img src="http://mathurl.com/a6nwxlh.png" alt="image">  .  It remains to famous <img src="http://mathurl.com/ygw8ook.png" alt="image">  and <img src="http://mathurl.com/d4o5jko.png" alt="image">  find specific i.  If you simply go through all i starting from 1 and ending with K, then on average you need <img src="http://mathurl.com/amrte25.png" alt="image">  comparison operations.  In the worst case, which, by the way, meets with probability <img src="http://mathurl.com/9wqyk2j.png" alt="image">  , we will need K comparisons, for an example from the graph above, it appears with a probability of 0.45473749.  On the average, 7.5 comparisons and generation of one random variable are required.  The number of operations makes you sad especially if you want to simulate a large number of throws with the wrong bone. <br><br>  One of the ideas how to solve a bad luck is to pick up such a correct bone, by looking at which we can roughly bring our wrong bone closer and do it very quickly.  This method is called the Chen method, and can also be found under the name ‚Äúcutpoint method‚Äù or the ‚Äúindex search‚Äù method. <br><br>  The essence of the method is very simple, divide the segment <img src="http://mathurl.com/a5nwa6n.png" alt="[0,1]">  on M equal parts.  We introduce an additional array r of length M. In the element <img src="http://mathurl.com/a5ckz75.png" alt="r_j">  the array will be stored i, such that <img src="http://mathurl.com/bg35of3.png" alt="image">  : <br><pre> <code class="hljs lisp">#Preprocessing ss&lt;-cumsum(<span class="hljs-name"><span class="hljs-name">ps</span></span>) ss&lt;-append(<span class="hljs-name"><span class="hljs-name">ss</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, after=0) M&lt;-length(<span class="hljs-name"><span class="hljs-name">ss</span></span>) rs&lt;-c() for(<span class="hljs-name"><span class="hljs-name">k</span></span> in <span class="hljs-number"><span class="hljs-number">0</span></span>:(<span class="hljs-name"><span class="hljs-name">M-1</span></span>)) rs&lt;-append(<span class="hljs-name"><span class="hljs-name">rs</span></span>, min(<span class="hljs-name"><span class="hljs-name">which</span></span>(<span class="hljs-name"><span class="hljs-name">ss&gt;=k/M</span></span>)))</code> </pre><br><br>  In this case, the algorithm for generating a new value takes the following form: <br><pre> <code class="hljs scala">#chen<span class="hljs-symbol"><span class="hljs-symbol">'s</span></span> method finite discrete distribution generator gen_dfd &lt;- function() { <span class="hljs-type"><span class="hljs-type">M</span></span>&lt;<span class="hljs-number"><span class="hljs-number">-10</span></span> alpha&lt;-runif(<span class="hljs-number"><span class="hljs-number">1</span></span>) idx&lt;-rs[floor(alpha*<span class="hljs-type"><span class="hljs-type">M</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (idx<span class="hljs-number"><span class="hljs-number">-1</span></span>+min(which(alpha&lt;ss[idx:(<span class="hljs-type"><span class="hljs-type">M</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>)]))<span class="hljs-number"><span class="hljs-number">-1</span></span>) } #sample code <span class="hljs-keyword"><span class="hljs-keyword">val</span></span>&lt;-c() len&lt;<span class="hljs-number"><span class="hljs-number">-10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i in <span class="hljs-number"><span class="hljs-number">1</span></span>:len) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span>&lt;-append(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>, gen_dfd()) } vals&lt;-factor(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) plot(vals)</code> </pre><br><br>  In the worst case, for the example above, we will need (with M equal to 9) 4 comparisons with a probability of 0.03712143.  On average, one will need to generate one random variable and 1.2 comparisons.  If there is a lot of memory and the data preparation stage (task <img src="http://mathurl.com/adqb7nj.png" alt="p_i">  ) is relatively rare, M can be chosen arbitrarily large. <br><br>  The method is simple to implement and gives a significant gain in the rate of generation of a large number of realizations of the same random variable, especially in the case of a large number of almost identical states.  Just in case, a rough implementation on c ++ is laid out on <a href="http://pastebin.com/LrDsKwuY">pastebin</a> . </div><p>Source: <a href="https://habr.com/ru/post/157689/">https://habr.com/ru/post/157689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157675/index.html">One day of the Internet: statistics, figures, facts</a></li>
<li><a href="../157677/index.html">A couple of words about debugging applications from the App Store</a></li>
<li><a href="../157683/index.html">Calls from VimpelCom FMC</a></li>
<li><a href="../157685/index.html">Backing up user data in Android</a></li>
<li><a href="../157687/index.html">OpenVPN on Android: transparent switching between WiFi and Mobile data without disconnecting</a></li>
<li><a href="../157699/index.html">Aichi-Event.rf - all IT events of Runet!</a></li>
<li><a href="../157707/index.html">Video report from the first conference "Around the Cloud" in St. Petersburg</a></li>
<li><a href="../157709/index.html">Microsoft officially: Skype will replace Messenger</a></li>
<li><a href="../157715/index.html">Budgets for R & D or what is influenced by research in microelectronics</a></li>
<li><a href="../157717/index.html">Lecture by director Gary Hasvita about crowdfunding</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>