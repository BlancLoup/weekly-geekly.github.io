<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installation, configuration and use of Antidoto security scanner</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I previously wrote about two well-known general security scanners rkhunter and CentOS. 
 On "Habr√©" there is also a description of the organization of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installation, configuration and use of Antidoto security scanner</h1><div class="post__text post__text-html js-mediator-article">  I previously wrote about two well-known general security scanners rkhunter and CentOS. <br>  On "Habr√©" there is also a description of the organization of the scanner for webhosting - maldet.  Now I would like to consider the implementation of the application for the heuristic detection of vulnerabilities, viruses and botnets for OpenVZ Linux OS - Antidoto. <br><br><img src="https://habrastorage.org/files/d4b/817/fec/d4b817fec7d74dc5ba35feeaf02d5754.jpg"><br><a name="habracut"></a><br>  With an Italian name, this open project is the brainchild of Russian-speaking developer Pavel Odintsov <a href="http://habrahabr.ru/users/pavelodintsov/" class="user_link">pavelodintsov</a> .  This is an open source project and is located on the <a href="https://github.com/FastVPSEestiOu/Antidoto">githab</a> .  One of the reasons for creating this scanner, as well as the fact that vividly distinguishes it before the rest, is scanning the memory of a running system to detect running malicious software. <br><br>  Declared work on all popular modern Linux distributions: Centos 5-6, Debian 5-7, Ubuntu 10-14.  In general, it should work on other distributions, since the project is written in perl. <br>  Consider the possibilities of Antidote. <br><ul><li>  Search for non-empty files and directories with strange names (spaces, dots) in publicly accessible directories (/ tmp, / var / tmp) </li><li>  Search for non-empty files with scheduler tasks for apache, www-data users (/ var / spoo / crontabs, / var / spool / cron) </li><li>  Notification of missing files with information about recent authorizations (/ var / log / btmp, / var / log / wtmp) </li><li>  Search for processes whose executable files are missing </li><li>  Detection of popular malware in memory by md5 hashes </li><li>  Detection of suspicious software using udp / tcp ports (irc, proxy, botnet controllers) </li><li>  Detection of connections to remote servers with abnormal number of threads (from 5 and up) </li><li>  Detection of processes that differ in architecture from the system used on the server </li><li>  Detection of processes running from statically collected files (binary files including all dependent components) </li><li>  Detection of processes that were started using LD_PRELOAD, started from files with SUID, SGID bits </li></ul><br>  Antidoto can be run in audit mode, which is used to replace several programs at once: netstat, lsof, ss, and ps.  It can also use the installed ClamAV as a scanning engine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Installing and running an antidoto scanner is very simple, since no additional dependencies are required to run.  Just download the scanner file and module to it: <br><br><pre><code class="bash hljs">wget -OAntidoto.pl --no-check-certificate https://raw.githubusercontent.com/pavel-odintsov/Antidoto/master/Antidoto.pl wget -OAntidoto.pm --no-check-certificate https://raw.githubusercontent.com/pavel-odintsov/Antidoto/master/Antidoto.pm perl Antidoto.pl</code> </pre> <br><br>  In addition to the file scanner scanner, there is a network scanner that comes with Antidoto. <br><br><pre> <code class="bash hljs">wget -OAntidoto.pm --no-check-certificate https://raw.githubusercontent.com/pavel-odintsov/Antidoto/master/Antidoto.pm wget -Olinux_network_activity_tracker.pl --no-check-certificate https://raw.githubusercontent.com/pavel-odintsov/Antidoto/master/linux_network_activity_tracker.pl perl linux_network_activity_tracker.pl</code> </pre><br><br>  Next, we consider the practical use of Antidoto on a server running CentOS on which a number of openvz containers are located. <br>  Neither the first script nor the second one implies the use of parameters at startup. <br>  But Antidoto.pl has a set of parameters in the code with which you can correct the verification of network activity.  Boolean values ‚Äã‚Äãare used, so tuning is not particularly difficult. <br><br><ul><li>  compress_forks =&gt; 1, when detecting forks of a process, show only one process </li><li>  show_process_information =&gt; 1, display information about the processes found </li><li>  show_open_files =&gt; 1, output open application files to the report </li></ul><br>  The next block will be fully dedicated to TCP connections. <br><ul><li>  show_tcp =&gt; 1, display any information related to TCP </li><li>  show_whitelisted_listen_tcp =&gt; 1, list the listened sockets in the white list </li><li>  show_listen_tcp =&gt; 1, display a list of listening TCP sockets </li><li>  show_client_tcp =&gt; 1, display a list of TCP client sockets </li><li>  show_local_tcp_connections =&gt; 1, display information about local TCP connections </li></ul><br><br>  The last block is similar to the previous one, but applies to UDP <br><ul><li>  show_udp =&gt; 1, </li><li>  show_whitelisted_listen_udp =&gt; 1, </li><li>  show_listen_udp =&gt; 1, </li><li>  show_client_udp =&gt; 1, </li><li>  show_local_udp_connections =&gt; 1, </li></ul><br><br>  Running the script on the parent server, I received the following data <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># perl Antidoto.pl We got warning about process from CT: 115: 'Programm is x86 on container with arch x86_64 Probably it's an malware!' pid: 48998 name: 3proxy ppid: 30919 uid: 13 gid: 13 CT: 115 exe path: /home/proxy/bin/3proxy cwd: / cmdline: /home/proxy/bin/3proxy /home/proxy/conf/main.cfg We found a file with suspicious name .crontab.kVBjzc.swp in CT 485 in directory: /vz/root/485/tmp We got warning about process from CT: 485: 'it running manually from NOT root user and it's very dangerous' pid: 927381 name: AchievementSave ppid: 925991 uid: 501 gid: 502 CT: 485 exe path: /home/0xp_servers/prop_hunt2/serverfiles/srcds_linux cwd: /home/0xp_servers/prop_hunt2/serverfiles cmdline: ./srcds_linux -game garrysmod -strictportbind -ip 192.168.0.2 -port 27015 +host_workshop_collection -authkey +clientport 27008 +tv_port 27023 +map cs_office +servercfgfile prop_hunt2.cfg -maxplayers 32 +gamemode prop_hunt -tickrate 33</span></span></code> </pre><br><br>  As we see, when checking the server, a suspicious file was found in the temporary directory of the 485 container and the mismatch of the architecture of the running 3proxy process. <br>  Fortunately, no malware was detected on the server. <br><br>  Let us turn to the consideration of the diagnostic mode (audit) of the server, which is represented by a separate script - linux_network_activity_tracker.pl <br><br>  Its advantages are that it replaces several utilities at once: netstat, lsof, ss and ps and provides readable information output as a result of the check.  Like Antidoto, we just run the script on the parent server with containers. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># perl linux_network_activity_tracker.pl Container's 15675 process 415528 connected to the DANGER tcp port 6667 to the server 192.169.0.2 Container's 15675 process 415530 connected to the DANGER tcp port 6667 to the server 192.169.0.2 Container's 29419 process 174494 listens DANGER tcp port 9050</span></span></code> </pre><br><br>  As can be seen from the information received, the audit script found in one container connections to port 6667 (this is the most popular port for connecting to IRC and managing bots), and in the other, an application waiting for a connection to port 9050.  Upon further consideration, this turned out to be a socks proxy. <br><br>  Other articles about security and vulnerability scanners: <br><ul><li>  <a href="http://habrahabr.ru/post/194346/">maldet</a> </li><li>  <a href="http://habrahabr.ru/company/first/blog/242865/">rkhunter</a> </li><li>  <a href="http://habrahabr.ru/company/first/blog/243487/">chkrootkit</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/254079/">https://habr.com/ru/post/254079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254067/index.html">Simulation model of the logistics center</a></li>
<li><a href="../254071/index.html">Space landscape</a></li>
<li><a href="../254073/index.html">Lectures Technopark. Semester 2 Database</a></li>
<li><a href="../254075/index.html">What would JSON support look like in modern C ++?</a></li>
<li><a href="../254077/index.html">And once again about the unique constants</a></li>
<li><a href="../254087/index.html">The process of developing and testing demons</a></li>
<li><a href="../254089/index.html">ROTE and Lua bind terminal emulation library</a></li>
<li><a href="../254091/index.html">Free online school of Android developers</a></li>
<li><a href="../254093/index.html">Algorithm Tasks</a></li>
<li><a href="../254097/index.html">How to avoid null pointer dereferencing, using the example of a single patch in the Linux kernel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>