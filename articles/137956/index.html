<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tighten the TCP / IP nuts on Solaris</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, respected users, despite the tendency of the fall of Oracle in the eyes of system engineers and customer companies. The operating syst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tighten the TCP / IP nuts on Solaris</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, respected users, despite the tendency of the fall of Oracle in the eyes of system engineers and customer companies.  The operating system, now Oracle Solaris continues to live and delight our eyes. <br>  Recently I faced the issue of optimizing some parameters of the TCP / IP stack.  This topic seemed interesting to me, it may seem to many already beaten, and it will introduce someone to new interesting moments of customization.  So, let's begin‚Ä¶ <br><a name="habracut"></a><br>  To begin with, we consider two parameters like <i>tcp_conn_req_max_q</i> and <i>tcp_conn_req_max_q0</i> , why they are needed at all, what values ‚Äã‚Äãfor these parameters are the most suitable. <br>  In simple terms, these parameters are responsible for the maximum number of requests for an IP address and a port that will be processed by the server. <br>  <i>tcp_conn_req_max_q</i> is the maximum number of incoming connections that will be processed by the port. <br>  <i>tcp_conn_req_max_q0</i> is the maximum number of half-open TCP sessions that can exist on a port. <br>  These parameters on Solaris allow the administrator, in order to block SYN packets, to prevent ‚Äúdenial of service‚Äù attacks in DOS progenority. <br>  The default value for <i>tcp_conn_req_max_q</i> on Solaris is only 128, and for <i>tcp_conn_req_max_q0</i> 1024. These parameters are in principle sufficient for a server serving a small number of clients, but if the server expects a greater number of hits than specified by default, this will significantly spoil the nerves of the system administrator.  From the beginning, it looks like this. <br><pre><code class="hljs ruby">root@T1000-spare <span class="hljs-comment"><span class="hljs-comment"># ndd /dev/tcp tcp_conn_req_max_q 128 root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@T</span></span></span><span class="hljs-comment">1000-spare # ndd /dev/tcp tcp_conn_req_max_q0 1024</span></span></code> </pre> <br><br>  When the time comes to change these parameters, in fact, it is quite simple to determine if the number of dropped packets goes off-scale, then the time has come.  How to determine this number, we use the usual sample: <br><br><pre> <code class="hljs perl">root@T1000-spare <span class="hljs-comment"><span class="hljs-comment"># netstat -s | fgrep -i listendrop tcpListenDrop = 0 tcpListenDropQ0 = 0 sctpListenDrop = 0 sctpInClosed = 0</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my case, there are zeros here, since the test server cannot show the change in values.  But the scheme is this: if the value of tcpListenDrop is not zero, increase tcp_conn_req_max_q, and if tcpListenDropQ0 is non-zero, respectively, increase the value of the tcp_conn_req_max_q0 parameter. <br><br>  But, there is one BUT, if you immediately increase tcp_conn_req_max_q immediately, then it will naturally be vulnerable to DOS using SYN packets.  Just for this we need the second parameter, which is ideally designed to prevent such cases.  The second parameter is responsible for the sessions that will be queued on the server after receiving the SYN packet.  Unfortunately, it also cannot be increased dimensionlessly, as in the case of slow application work, clients will get into the queue and remain there, without connecting to the server. <br>  Any changes to these values ‚Äã‚Äãare easily carried out using the ndd command, as an example, I will give the values ‚Äã‚Äãof one of the heavily loaded servers, these parameters can be used in the work: <br><pre> <code class="hljs swift"> # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_conn_req_max_q <span class="hljs-number"><span class="hljs-number">16384</span></span> &lt;==== # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_conn_req_max_q0 <span class="hljs-number"><span class="hljs-number">16384</span></span> &lt;==== # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_max_buf <span class="hljs-number"><span class="hljs-number">4194304</span></span> # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_cwnd_max <span class="hljs-number"><span class="hljs-number">2097152</span></span> # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_recv_hiwat <span class="hljs-number"><span class="hljs-number">400000</span></span> # ndd -<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> /dev/tcp tcp_xmit_hiwat <span class="hljs-number"><span class="hljs-number">400000</span></span></code> </pre><br><br>  In conclusion, I would like to say about these parameters that it is necessary to relate to changes in these parameters with due scrupulousness and not to change them unnecessarily. <br><br>  PS If anyone has an interest in other parameters, in the next article it will be possible to describe them.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/137956/">https://habr.com/ru/post/137956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137950/index.html">Now ChromeOS is participating in the rewards program for bugs found.</a></li>
<li><a href="../137951/index.html">Take part in the translation of technical terms for Windows 8</a></li>
<li><a href="../137952/index.html">Welcome to the Quality Assurance Day conference.</a></li>
<li><a href="../137953/index.html">Household appliances interfaces are 20 years behind</a></li>
<li><a href="../137955/index.html">Payment interface, as a direct communication channel with developers</a></li>
<li><a href="../137960/index.html">Some details about Class Based Views, part 4</a></li>
<li><a href="../137961/index.html">Protection against bots, based on differences in working with large numbers in JavaScript and PHP</a></li>
<li><a href="../137962/index.html">How to buy low customer loyalty?</a></li>
<li><a href="../137963/index.html">We communicate with the SIM card at a low level</a></li>
<li><a href="../137964/index.html">Free xml-source of cash exchange rates, as well as 3 convenient updates from the portal FINANCE.UA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>