<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP: work with time intervals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once, according to the task, I ran into a problem that I could not find a solution on the Internet. Either the problem is specific and no one has come...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP: work with time intervals</h1><div class="post__text post__text-html js-mediator-article">  Once, according to the task, I ran into a problem that I could not find a solution on the Internet.  Either the problem is specific and no one has come across it, or it is primitive, and I used the wrong search procedure.  But as for any programmer, it became interesting for me to solve it myself and in my own way ... <br><br>  The problem was this: for example, there are 10 tasks that are performed in parallel, each task is divided into subtasks that start at a certain time and their duration is known, we need to add a couple of subtasks to one of the tasks, but first we need to find out if there are free the length of time we need and how long to how long they last.  We have $ reservArray with data that contains the start and end time of an event for each element of the array, as well as the start and end time ($ timeArray) of the interval in which we need to check which intervals and how long we will have if in the given interval All events from the previous array will occur. <br><br>  As a result, I needed the function to return the array with free intervals if they are longer than the duration that I pass to the function as the $ duration parameter, the error variable was also added for the start and end time of the event, which I needed at that moment to cut off the intervals no interest to me (less than 3 seconds) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFreeTimeArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($timeArray, $reservArray, $duration, $nullDuration = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $resultArray = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $tmpArray[] = $timeArray; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($reservArray) &amp;&amp; is_array($reservArray)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($reservArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($tmpArray)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($tmpArray <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $tmp_key =&gt; $tmp_val) { <span class="hljs-comment"><span class="hljs-comment">/* * reserved line * a|============|b * * time line * x|------------|y * * * a = $value['start'] * b = $value['end'] * * x = $tmp_val['start'] * y = $tmp_val['end'] */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* if x&gt;a &amp;&amp; x&gt;b * * a|====|b * * x|------|y * * * OR y * * a|====|b * * x|------|y * * * =&gt; reserved &amp; time line not intersect */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($tmp_val[<span class="hljs-string"><span class="hljs-string">'start'</span></span>] &gt; $value[<span class="hljs-string"><span class="hljs-string">'start'</span></span>] &amp;&amp; $tmp_val[<span class="hljs-string"><span class="hljs-string">'start'</span></span>] &gt; $value[<span class="hljs-string"><span class="hljs-string">'end'</span></span>]) || ($tmp_val[<span class="hljs-string"><span class="hljs-string">'end'</span></span>] &lt; $value[<span class="hljs-string"><span class="hljs-string">'start'</span></span>] &amp;&amp; $tmp_val[<span class="hljs-string"><span class="hljs-string">'end'</span></span>] &lt; $value[<span class="hljs-string"><span class="hljs-string">'end'</span></span>])) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//reserved &amp; time line intersect /* if x&lt;=a &amp;&amp; y&gt;=b * * a|====|b * * x|------------|y * */ if ($tmp_val['start'] &lt;= $value['start'] &amp;&amp; $tmp_val['end'] &gt;= $value['end']) { //if (ax) &gt; nullDuration -&gt; save data to array('start'=&gt;x,'end'=&gt;(a-1)) if (($value['start'] - $tmp_val['start']) &gt; $nullDuration) $tmpArray[] = array('start' =&gt; $tmp_val['start'], 'end' =&gt; $value['start'] - 1); //if (yb) &gt; nullDuration -&gt; save data to array('start'=&gt;(b+1),'end'=&gt;y) if (($tmp_val['end'] - $value['end']) &gt; $nullDuration) $tmpArray[] = array('start' =&gt; ($value['end'] + 1), 'end' =&gt; $tmp_val['end']); //delete this time interval unset($tmpArray[$tmp_key]); } /* if x&gt;=a &amp;&amp; y&lt;=b * * a|==========|b * * x|------|y * */ else if ($tmp_val['start'] &gt;= $value['start'] &amp;&amp; $tmp_val['end'] &lt;= $value['end']) { unset($tmpArray[$tmp_key]); } /* if x&gt;=a &amp;&amp; x&lt;=b * * a|=====|b * * x|------------|y * */ else if ($tmp_val['start'] &gt;= $value['start'] &amp;&amp; $tmp_val['start'] &lt;= $value['end']) { if (($tmp_val['end'] - $value['end']) &gt; $nullDuration) $tmpArray[] = array('start' =&gt; ($value['end'] + 1), 'end' =&gt; $tmp_val['end']); unset($tmpArray[$tmp_key]); } /* if y&gt;=a &amp;&amp; y&lt;=b * * a|=====|b * * x|----------|y * */ else if ($tmp_val['end'] &gt;= $value['start'] &amp;&amp; $tmp_val['end'] &lt;= $value['end']) { if (($value['start'] - $tmp_val['start']) &gt; $nullDuration) $tmpArray[] = array('start' =&gt; $tmp_val['start'], 'end' =&gt; ($value['start'] - 1)); unset($tmpArray[$tmp_key]); } } } } } // if result is not null // check duration in result data and sort array if (!empty($tmpArray)) { $tmpArray2 = null; foreach ($tmpArray as $val) { if ($duration &lt;= ($val['end'] - $val['start'])) $tmpArray2[$val['start']] = $val; } ksort($tmpArray2); $tmpArray = $tmpArray2; } $resultArray = $tmpArray; return $resultArray; }</span></span></code> </pre> <br><br>  As a result of the transfer of this function of all parameters, I received at the output of an array of time intervals free from events and with a duration longer than that specified in $ duration <br><br>  If you have questions, ask, but I would like to hear a solution to this problem in other ways.  ;) <br>  original article in my blog on <a href="http://yuretski.livejournal.com/768.html">LiveJournal</a> <br><br>  PS if you minus it, then at least indicate what you did not like, or I have a bad mood, come on and ruin others ... <br>  A person solves a problem and proposes its solution to others, but someone quietly minus it and his mood rises from it ... <br><br>  PS2 Here are the trolls ... at least say what you don't like, why just minusovat so ???  I still have a couple of solutions for Javascript and PHP, but I don‚Äôt even know with such trolls only memoirs here you can write, judging by the evaluation of this topic, you don‚Äôt like free solutions here ... at least there are a few minuses than pluses.  Is there any washed away posting? <br><br>  PPS, thanks to MikhailEdoshin, a solution was found that allows replacing lines 46-52 with <br> <code>if($tmp_val['start'] &lt; $value['end'] &amp;&amp; $value['start'] &lt; $tmp_val['end'])</code> <br>  for which a special thank you to him! </div><p>Source: <a href="https://habr.com/ru/post/65184/">https://habr.com/ru/post/65184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../65174/index.html">IT Report 2.0</a></li>
<li><a href="../65176/index.html">Promo of the Resident Evil sequel</a></li>
<li><a href="../65177/index.html">Meet RW</a></li>
<li><a href="../65178/index.html">Road to sky</a></li>
<li><a href="../65180/index.html">The difference in rendering between 3.0 and 3.5. Bug or feature?</a></li>
<li><a href="../65185/index.html">Translation: 30 days Windows Mobile, the third day - GPS Compass (.NET vs WinAPI / C)</a></li>
<li><a href="../65188/index.html">We combine supply and demand</a></li>
<li><a href="../65191/index.html">Google Wave made friends with Silverlight</a></li>
<li><a href="../65192/index.html">Base stations Yota in Moscow</a></li>
<li><a href="../65194/index.html">Synaptic ClearPad 3000 - 10-finger touchscreen display</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>