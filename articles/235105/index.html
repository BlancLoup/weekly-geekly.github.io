<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program currency symbols for customer display</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I offer a small guide to those who, like Squier , author of the article Automation of a Store or how to compete with supermarkets , does automation in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program currency symbols for customer display</h1><div class="post__text post__text-html js-mediator-article">  I offer a small guide to those who, like <a href="https://habrahabr.ru/users/squier/" class="user_link">Squier</a> , author of the article <a href="http://habrahabr.ru/post/126377/">Automation of a Store or how to compete with supermarkets</a> , does automation in a store using free software.  As a visual example, I will tell and show you how to connect the customer‚Äôs display to the Raspberry Pi to load currency symbols onto it for subsequent withdrawal during sales. <br><br><img src="https://habrastorage.org/files/6ca/bd3/e09/6cabd3e09c8f4ddeb5acf938291e354c.JPG"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Connection </h4><br>  Unlike Windows, where drivers are needed, everything is simple in Linux, if you have a USB display, you just need to connect it to Raspberry Pi, after which the new device will be accessible via <code>/dev/ttyUSB0</code> .  In this case, the customer‚Äôs display acts as a slave device, and the control protocol programmed in the controller of the display itself is used to control and display information on the display screen.  There are several different information transfer protocols for controlling the customer display, but all of them are de facto based on the Epson ESC / POS command format. <br><br>  To get started, initialize the customer display by clearing the memory and the display screen with the <code>ESC @</code> command: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e \\x1B\\x40 &gt; /dev/ttyUSB0</code> </pre><br>  And standard check: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e Hello, world!\\n &gt; /dev/ttyUSB0</code> </pre><br>  If done correctly, the line will be displayed. <br><br><h4>  Display </h4><br>  A VFD or LCD panel, usually containing 2 lines of 20 characters each, is used to display the customer‚Äôs displays.  Each character, depending on the display model, may consist of a matrix from 5 * 7 to 8 * 8 dots.  For this example, a display with a character size of 5 points horizontally and 7 points vertically is used. <br><br>  Characters are encoded in the display ROM and are available for output in the range from 0x20 to 0xFF bytes.  And if the range from 0x20 to 0x7F is the standard ANSI code page, then the range from 0x80 to 0xFF is allocated for additional code pages, for example, Cyrillic.  To switch code pages, use the <code>ESC tn</code> command, where <code>n</code> is the code page number.  Example: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e \\x1B\\x74\\x07 &gt; /dev/ttyUSB0 $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e \\x87\\xA4\\xE0\\xA0\\xA2\\xE1\\xE2\\xA2\\xE3\\xA9\\x2C\\x20\\x95\\xA0\\xA1\\xE0\\x21\\n &gt; /dev/ttyUSB0</code> </pre><br><img src="https://habrastorage.org/files/7f6/bf6/bfc/7f6bf6bfcd794940a340326d9d527827.JPG"><br><br><h4>  Drawing </h4><br>  It is good if all the characters are already programmed into the displays, but very often, having bought a display in China, you have to face the fact that the ROM is completely filled with hieroglyphs, and there is no place left for Cyrillic.  Then you can use the special command <code>ESC &amp; snm [a (p1..pa)]*mn</code> to load the missing characters into the display RAM.  This command is also suitable for us to load currency symbols into memory for subsequent display on sales.  The command for programming the characters <code>ESC &amp;</code> contains arguments that can be divided into two parts, the first is constant, the second is variable. <br><br>  The constant part consists of three arguments <code>s</code> , <code>n</code> and <code>m</code> , where: <code>s</code> is the number of bytes in the row of the matrix characters, in our example, the value is 1;  <code>n</code> - byte space in the code page for programming the first character;  <code>m</code> - byte space for programming the last character, and if one character is programmed, then <code>n=m</code> . <br><br>  The variable part consists of blocks <code>a p1...pa</code> , where the number of blocks depends on the number of programmable characters.  Each block starts with a value, it is the number of vertical columns in the matrix of the symbol, in our example it can be in the range from 1 to 5. After the value of <code>a</code> , the status values ‚Äã‚Äãof the diodes of each are byte-encoded in <code>p1</code> , <code>p2</code> , <code>p3</code> , <code>p4</code> and <code>p5</code> column of the matrix symbol, where the most significant bit is the top row of the diodes, and the least significant is the bottom one <br><br>  This year, the symbol of the Russian ruble was officially included in Unicode (‚ÇΩ, code 20BD), but 5 years before this, the symbol of Kazakhstani tenge was adopted to me since November 1993 (‚Ç∏, code 20B8).  So let's start programming from it.  If we present the tenge symbol in the form of a 5 * 8 by-bit matrix, then it will look like the one shown in the figure below.  The upper line is supplemented by the high 8th bit, but in this example it will not be displayed. <br><img src="https://habrastorage.org/files/bc7/64b/d9d/bc764bd9d42b4dbfb8b782f4ba3497e5.png"><br>  In total, to replace the dollar symbols (code 0x26 in the table of symbols of our display) with the tenge symbol with the same code, we need the ESC / POS command of the following form: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e \\x1b\\x26\\x01\\x24\\x24\\x05\\x50\\x50\\x5f\\x50\\x50 &gt; /dev/ttyUSB0</code> </pre><br>  Include loaded characters with the command <code>ESC % n</code> , where the value of <code>n</code> one or zero depending on whether the loaded characters are included or not: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e \\x1b\\x25\\x01 &gt; /dev/ttyUSB0</code> </pre><br>  We check the work: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e 1500$ &gt; /dev/ttyUSB0</code> </pre><br>  Result on the screen: <br><img src="https://habrastorage.org/files/3a7/4f3/e78/3a74f3e78cd146f5a81e64d6f0877aef.JPG"><br><br><h4>  Programming </h4><br>  Now it remains to make automatic when connecting the initialization of the Cyrillic alphabet and the loading of the tenge symbol.  To do this, we need to set the <code>udev</code> rules for automatically launching a bash script when connecting the customer display to the Raspberry Pi.  The <code>udevadm</code> command <code>udevadm</code> vendor code and model of our display. <br><pre> <code class="bash hljs">$ udevadm info -q all -n /dev/ttyUSB0 | grep -E -i -w <span class="hljs-string"><span class="hljs-string">'.*VENDOR_ID.*|.*MODEL_ID.*'</span></span></code> </pre><br><pre> <code class="bash hljs">E: ID_MODEL_ID=2303 E: ID_VENDOR_ID=067b</code> </pre><br>  Create rules <code>90-init-vfd-display.rules</code> : <br><pre> <code class="bash hljs">$ sudo nano /etc/udev/rules.d/90-init-vfd-display.rules</code> </pre><br>  , of the following content: <br><pre> <code class="bash hljs">ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, ATTRS{idVendor}==<span class="hljs-string"><span class="hljs-string">"067b"</span></span>, ATTRS{idProduct}==<span class="hljs-string"><span class="hljs-string">"2303"</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/usr/local/bin/init-vfd-display.sh"</span></span></code> </pre><br>  and script: <br><pre> <code class="bash hljs">$ sudo nano /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/init-vfd-display.sh</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash sleep 20 echo -n -e \\x1B\\x40 &gt; /dev/ttyUSB0 echo -n -e \\x1B\\x74\\x07 &gt; /dev/ttyUSB0 echo -n -e \\x1B\\x26\\x01\\x24\\x24\\x05\\x50\\x50\\x5F\\x50\\x50 &gt; /dev/ttyUSB0 sleep 3</span></span></code> </pre><br>  Make the bash script executable and activate our rules: <br><pre> <code class="bash hljs">$ sudo chmod +x /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/init-vfd-display.sh $ sudo udevadm control --reload-rules $ sudo udevadm trigger --action=add $ sudo service udev restart</code> </pre><br>  We try to simultaneously use the dollar and tenge symbol by switching them alternately. <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n -e 1$ =\\x1B\\x25\\x01 181,95$ \\x1B\\x25\\x00 &gt; /dev/ttyUSB0</code> </pre><br><img src="https://habrastorage.org/files/6f6/e00/c75/6f6e00c757f94e419a5ef40180a2278b.JPG"><br><br><h4>  Conclusion </h4><br>  The example given here is not necessary to perform using Raspberry Pi, all the described commands are available independently of the Linux distribution, the main thing is the presence of the <code>udev</code> service in it to automatically execute the script loading the characters into the customer display.  As a fixing material, I propose to program the symbols of two more currencies from the Unicode table, the Russian ruble and the Ukrainian hryvnia, according to the matrices in the figures, and you can already do the euro sign yourself. <br><img src="https://habrastorage.org/files/d84/66b/bee/d8466bbee4204f179197fb9ec83ae244.png"><img src="https://habrastorage.org/files/f38/b26/3e1/f38b263e141a4a86b7c5f8ee02b6c91f.png"></div><p>Source: <a href="https://habr.com/ru/post/235105/">https://habr.com/ru/post/235105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235081/index.html">POST handling of AngularJs requests in symfony2</a></li>
<li><a href="../235089/index.html">First All-Union Olympiad of Schoolchildren on Programming (Computer Science) 1988</a></li>
<li><a href="../235093/index.html">Instead of building - 3D printing</a></li>
<li><a href="../235095/index.html">Learning How to Learn: Impressions</a></li>
<li><a href="../235101/index.html">Some subtleties of GetHashCode</a></li>
<li><a href="../235107/index.html">Consulo - IDE where Java and C # live together</a></li>
<li><a href="../235109/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ122 (August 24 - 31, 2014)</a></li>
<li><a href="../235111/index.html">The evolution of remote control</a></li>
<li><a href="../235117/index.html">Placeholders - evil</a></li>
<li><a href="../235119/index.html">5 more layouts from VWO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>