<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Super anthill on ClojureCLR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Clojure's multithreading has been taken to a new level of development, because it implements the STM (The software transactional memory system) memory...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Super anthill on ClojureCLR</h1><div class="post__text post__text-html js-mediator-article">  Clojure's multithreading has been taken to a new level of development, because it implements the STM (The software transactional memory system) memory change transactions.  As a demonstration, Rich Hickey (the divine author of Clojure) and David Miller (the man who wrote the Clojure implementation under .Net) offer the ants program, which simulates an anthill.  Each ant lives there in a separate stream.  Ants run in the cells of the common field, collect food, carry it to the anthill and do not conflict with each other. <br><br>  The result of my exercises with this program is what I want to bring to the general review.  I hope the article will be useful to those who are starting to get acquainted with Clojure on the .Net platform. <br><a name="habracut"></a><br>  First links: <br><br>  <a href="https://github.com/kemerovo-man/super-ants-clojure-clr">github.com/kemerovo-man/super-ants-clojure-clr</a> <br>  <a href="https://youtu.be/xZ9AGQ3L-EI">youtu.be/xZ9AGQ3L-EI</a> <br>  <a href="http://sourceforge.net/projects/clojureclr/files/">sourceforge.net/projects/clojureclr/files</a> <br>  <a href="">github.com/clojure/clojure-clr/blob/master/Clojure/Clojure.Source/clojure/samples/ants.clj</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What has been done by me. <br>  1. <b>Graphics</b> .  In the original program, the ant is only a dash.  My insects are more natural. <br>  2. <b>New heroes</b> .  In addition to the ants I have implemented aphids and ladybugs. <br>  3. The <b>interaction of heroes</b> .  The grass grows, the aphid eats grass, produces sugar and lays eggs (multiplies).  Ladybirds eat aphids and eggs.  Ants avoid obstacles on the way.  (Even the ants have to drag aphids on the grass and stop the ladybugs from devouring the aphids, but this is not yet implemented.) <br>  3. <b>Behavior</b> .  The behavior of the ants became more complicated, they became smarter than in the original.  Added behavior of new heroes. <br>  4. <b>Charts</b> .  Visible dynamics of the processes on the graphs.  Growth of grass, the number of aphids, the amount of sugar in the anthill and in the surrounding space. <br>  5. <b>A primitive magnifier</b> can look at the details.  Right mouse button. <br>  6. <b>Mouse</b> .  When you click on the cell field in the console displays the information contained in the cell.  Mouse wheel, you can change the speed of movement of insects. <br><br>  By changing the initialization parameters, you can get different scenarios for the development of this ecosystem.  The faster the grass grows, the faster the aphids reproduce and the more sugar appears on the field.  Grass does not grow on sugar; therefore, the vigorous activity of aphids affects the growth of grass.  Different ratios of insects at launch (how many aphids, how many ladybirds, how many ants) determine the new dynamics. <br><br>  Each insect sees only four cells: the one on which it is located, and three cells in front of itself, and guides them. <br>  Ants respond to the pheromone trace.  It is very important for them not to lose an anthill, otherwise they can run endlessly with food ‚Äúin their mouths‚Äù, not finding where to put it.  I added a few pheromone features to them so that they can efficiently navigate where the food is, where the anthill is. <br><br>  Closer to the code.  But I'll start from afar. <br>  First you need to get acquainted with such concepts in Clojure as atom, agent and ref.  They can be called variable managers.  The code does not directly refer to the value of the variable, but through an intermediary.  Atom, agent and ref are three types of intermediary. <br><br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> atom1 (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> ref1 (<span class="hljs-name"><span class="hljs-name">ref</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre> <br>  Here we defined atom1, agent1 and ref1.  The initial value of all is 0. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">swap!</span></span> atom1 inc) (<span class="hljs-name"><span class="hljs-name">prn</span></span> @atom1) <span class="hljs-comment"><span class="hljs-comment">;-&gt;1 (send agent1 inc) (prn @agent1) ;-&gt;1 (dosync (alter ref1 inc)) (prn @ref1) ;-&gt;1</span></span></code> </pre><br>  Here we pass the function inc to atom1, agent1 and ref1 which increases the value by 1 and see that the values ‚Äã‚Äãeverywhere become 1. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom1 <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref1 <span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre><br>  Here we change the current values ‚Äã‚Äãof atom1, agent1 and ref1 to 0. <br><br>  While the difference between intermediaries is not visible, it is only syntactic. <br><br>  We define three functions: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> atom1-change [] (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"atom1-change"</span></span>) (<span class="hljs-name"><span class="hljs-name">swap!</span></span> atom1 inc) (<span class="hljs-name"><span class="hljs-name">prn</span></span> @atom1)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> agent1-change [] (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"agent1-change"</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 inc) (<span class="hljs-name"><span class="hljs-name">prn</span></span> @agent1)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> ref1-change [] (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"ref1-change"</span></span>) (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">alter</span></span> ref1 inc)) (<span class="hljs-name"><span class="hljs-name">prn</span></span> @ref1))</code> </pre><br><br>  Call them: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">atom1-change</span></span>) <span class="hljs-comment"><span class="hljs-comment">;"atom1-change" ;1 (prn @atom1) ;1 (agent1-change) ;"agent1-change" ;0 (prn @agent1) ;1 (ref1-change) ;"ref1-change" ;1 (prn @ref1) ;1</span></span></code> </pre><br>  We see that in the case of an agent (send agent1 inc) it is called asynchronously.  This agent is different from the rest. <br><br>  We will need a delay function.  We define it using the standard Sleep from .Net and see the interop in action. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> sleep [ms] (. System.Threading.Thread (<span class="hljs-name"><span class="hljs-name">Sleep</span></span> ms)))</code> </pre><br><br>  Create a stream that will increase the value of the agent every second. <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> agent1-thread[x] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agent1-thread) (<span class="hljs-name"><span class="hljs-name">prn</span></span> x) (<span class="hljs-name"><span class="hljs-name">inc</span></span> x)) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 agent1-thread)</code> </pre><br>  * agent * is the current agent. <br>  It may seem (it seemed to me) that if you swap sleep and send, something terrible will happen.  After all, send is called recursively and asynchronously, the stream should multiply and multiply, but this does not happen and you can safely write like this: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> agent1-thread[x] (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agent1-thread) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">prn</span></span> x) (<span class="hljs-name"><span class="hljs-name">inc</span></span> x)) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 agent1-thread)</code> </pre><br>  Underwater rake, however, is.  Notice that the last line (inc x) returns the value stored in the agent, incremented by 1, and it is this last return value that is written to the agent. <br><br>  Now there are three ways to put Clojure on the floor with an overflow stack overflou: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom1 atom1) (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref1 ref1)) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] agent1))</code> </pre><br>  Here we write the values ‚Äã‚Äãof the atom of the ref and the agent of them.  This leads to a stack of overflow. <br><br>  Often agents are used to organize timers without changing the value of the agents themselves, for example: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> timer (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) ) (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-timer [_] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* on-timer) (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"tic-tac"</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> timer on-timer)</code> </pre><br>  It is worth noting here that prn returns nil and this particular nil is written to the value of the agent. <br>  Since the send function returns the agent itself, a great way to shoot yourself in the foot: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> timer (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) ) (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-timer [_] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"tic-tac"</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* on-timer)) (<span class="hljs-name"><span class="hljs-name">send</span></span> timer on-timer)</code> </pre><br>  And here, it seems, even everything will be all right, until you want to see what the timer is equal to, and it is equal to the stack of overflou with the fall of Clojure. <br><br>  The following illustrative example: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent2 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> timer (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> atom1 (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> atom2 (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> atoms-change-thread1 [_] (<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom1 <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom2 <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* atoms-change-thread1) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> atoms-change-thread2 [_] (<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom1 <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> atom2 <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* atoms-change-thread2) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-timer [_] (<span class="hljs-name"><span class="hljs-name">prn</span></span> @atom1 @atom2) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* on-timer) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 atoms-change-thread1) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent2 atoms-change-thread2) (<span class="hljs-name"><span class="hljs-name">send</span></span> timer on-timer)</code> </pre><br>  Here we have two atoms and two streams that change their values. <br>  The first stream writes values ‚Äã‚Äã1 and 2 to atoms, the second stream writes values ‚Äã‚Äã3 and 4. <br>  There is also a timer, which once per second displays the values ‚Äã‚Äãof atoms. <br>  The output will be something like this: <br><br>  3 4 <br>  12 <br>  14 <br>  3 2 <br>  12 <br>  3 4 <br>  14 <br>  3 2 <br><br>  Now, finally about transactions.  Let's rewrite the previous example, but instead of atoms we will have refs. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent2 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> timer (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> ref1 (<span class="hljs-name"><span class="hljs-name">ref</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> ref2 (<span class="hljs-name"><span class="hljs-name">ref</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> refs-change-thread1 [_] (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref1 <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref2 <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>))) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* refs-change-thread1) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> refs-change-thread2 [_] (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref1 <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> ref2 <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>))) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* refs-change-thread2) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-timer [_] (<span class="hljs-name"><span class="hljs-name">prn</span></span> @ref1 @ref2) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* on-timer) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 refs-change-thread1) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent2 refs-change-thread2) (<span class="hljs-name"><span class="hljs-name">send</span></span> timer on-timer)</code> </pre><br>  The output will be something like this <br>  3 4 <br>  3 4 <br>  12 <br>  3 4 <br>  12 <br>  3 4 <br>  12 <br>  3 4 <br>  3 4 <br>  12 <br><br>  Now it becomes clear why to write dosync.  This is the definition of transaction boundaries.  Reflex changes are transactional.  This is how they differ from the rest. <br><br>  Although, if we replace the refs with the agents, we will also see transactionality.  Agents also operate in the STM and the scope of the transaction is the entire function of changing the value of the agent. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent2 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> timer (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent3 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent4 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> agents-change-thread1 [_] (<span class="hljs-name"><span class="hljs-name">send</span></span> agent3 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] <span class="hljs-number"><span class="hljs-number">1</span></span>)) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent4 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] <span class="hljs-number"><span class="hljs-number">2</span></span>)) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agents-change-thread1) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> agents-change-thread2 [_] (<span class="hljs-name"><span class="hljs-name">send</span></span> agent3 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] <span class="hljs-number"><span class="hljs-number">3</span></span>)) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent4 (<span class="hljs-name"><span class="hljs-name">fn</span></span> [_] <span class="hljs-number"><span class="hljs-number">4</span></span>)) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span>)) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agents-change-thread2) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-timer [_] (<span class="hljs-name"><span class="hljs-name">prn</span></span> @agent3 @agent4) (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* on-timer) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 agents-change-thread1) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent2 agents-change-thread2) (<span class="hljs-name"><span class="hljs-name">send</span></span> timer on-timer)</code> </pre><br>  12 <br>  3 4 <br>  12 <br>  12 <br>  3 4 <br>  12 <br>  12 <br>  12 <br><br>  Finally, after all this, you can return to the anthill.  If you greatly simplify the task, then it will look like this: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> v [<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>]) (<span class="hljs-name"><span class="hljs-name">def</span></span> world (<span class="hljs-name"><span class="hljs-name">vec</span></span> (<span class="hljs-name"><span class="hljs-name">map</span></span> (<span class="hljs-name"><span class="hljs-name">fn</span></span> [x] (<span class="hljs-name"><span class="hljs-name">ref</span></span> x)) v))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> place [x] (<span class="hljs-name"><span class="hljs-name">world</span></span> x)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent1 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent2 (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> agent-show-world (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> agent-change [x] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">place</span></span> x) new-coord (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> (<span class="hljs-name"><span class="hljs-name">count</span></span> world)) new (<span class="hljs-name"><span class="hljs-name">place</span></span> new-coord)] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span>)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> @old <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agent-change) (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> @new <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> old <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> new <span class="hljs-number"><span class="hljs-number">1</span></span>) new-coord) x))) (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"agent "</span></span> *agent* <span class="hljs-string"><span class="hljs-string">"is out"</span></span>)))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> show-world [_] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span>) (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* show-world) (<span class="hljs-name"><span class="hljs-name">prn</span></span> (<span class="hljs-name"><span class="hljs-name">map</span></span> (<span class="hljs-name"><span class="hljs-name">fn</span></span> [x] (<span class="hljs-name"><span class="hljs-name">deref</span></span> x)) world))) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent-show-world show-world) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent1 agent-change) (<span class="hljs-name"><span class="hljs-name">send</span></span> agent2 agent-change)</code> </pre><br>  The approximate output would be <br>  (1 0 0 1 0) <br>  (0 0 1 1 0) <br>  (1 0 0 1 0) <br>  (0 1 1 0 0) <br>  (0 0 1 1 0) <br>  (1 0 0 1 0) <br>  (0 0 1 1 0) <br>  (0 0 1 1 0) <br>  (1 0 1 0 0) <br>  (1 0 0 1 0) <br>  (0 0 1 0 1) <br>  (0 1 0 1 0) <br>  (1 0 1 0 0) <br>  (1 0 0 1 0) <br>  (0 0 0 1 1) <br>  (0 1 1 0 0) <br>  (1 1 0 0 0) <br>  (1 0 1 0 0) <br>  (0 0 0 1 1) <br>  (1 0 1 0 0) <br>  (1 0 0 0 1) <br>  (1 0 0 1 0) <br>  (0 1 0 0 1) <br><br>  Here we defined the vector v in it the first two elements of the unit, and the rest - the zeros.  In the context of an anthill, we will assume that units are ants, and zeros are free cells.  Made a vector world - this is a vector of refs whose values ‚Äã‚Äãare the elements of the vector v.  We have two agents whose values ‚Äã‚Äãare the coordinates of the world vector.  And there are two streams moving units along the vector world.  Due to the transactionality, the two streams will not simultaneously record a unit in the same cell. <br><br>  Note that the transaction wraps not only the record, but also the read-check: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> @new <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> old <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> new <span class="hljs-number"><span class="hljs-number">1</span></span>) new-coord) x)))</code> </pre><br>  If the new, randomly generated, coordinate is 0, i.e.  an empty cell, then we write to the old cell 0, and to the new one. Thus we move the ant from the old coordinate to the new one. <br><br>  If you only wrap a record in a transaction, it will not be thread-safe. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> agent-change [x] (<span class="hljs-name"><span class="hljs-name">let</span></span> [old (<span class="hljs-name"><span class="hljs-name">place</span></span> x) new-coord (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> (<span class="hljs-name"><span class="hljs-name">count</span></span> v)) new (<span class="hljs-name"><span class="hljs-name">place</span></span> new-coord)] (<span class="hljs-name"><span class="hljs-name">sleep</span></span> (<span class="hljs-name"><span class="hljs-name">rand-int</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span>)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> @old <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">send</span></span> *agent* agent-change) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> @new <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">dosync</span></span> (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> old <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">ref-set</span></span> new <span class="hljs-number"><span class="hljs-number">1</span></span>)) new-coord) x)) (<span class="hljs-name"><span class="hljs-name">prn</span></span> <span class="hljs-string"><span class="hljs-string">"agent "</span></span> *agent* <span class="hljs-string"><span class="hljs-string">"is out"</span></span>))))</code> </pre><br><br>  With this version of the function, the output will be something like this: <br>  (0 0 0 1 1) <br>  (1 0 1 0 0) <br>  (0 0 1 0 1) <br>  (1 0 0 0 1) <br>  "Agent" # &lt;Agent @ 549043: 4&gt; "is out" <br>  (1 0 0 0 0) <br>  (0 0 1 0 0) <br>  (0 0 1 0 0) <br>  (0 1 0 0 0) <br>  (0 0 0 1 0) <br>  (0 0 1 0 0) <br><br>  Those.  the streams recorded simultaneously a unit in the same place, then one stream stole this unit in a new place, and the second did not find its unit in the place where it left and curled up.  Everything.  There was an ant and was gone.  Rather, two ants merged into one. <br><br>  As for multithreading, this is probably all. <br><br>  How graphics are implemented: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> ant-vert-bitmap '(<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> ant-diag-bitmap '(<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>))</code> </pre><br>  This is an ant.  There are functions of rotation and flip of these matrices.  Further, all this is rendered in .Net Bitmap: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> render-bitmap [bitmap bit color] (<span class="hljs-name"><span class="hljs-name">let</span></span> [bit-pos (<span class="hljs-name"><span class="hljs-name">positions</span></span> #{bit} bitmap) rendered-bitmap (<span class="hljs-name"><span class="hljs-name">Bitmap</span></span>. bitmaps-dim bitmaps-dim)] (<span class="hljs-name"><span class="hljs-name">doseq</span></span> [b bit-pos] (<span class="hljs-name"><span class="hljs-name">let</span></span> [dy (<span class="hljs-name"><span class="hljs-name">quot</span></span> b bitmaps-dim) dx (<span class="hljs-name"><span class="hljs-name">rem</span></span> b bitmaps-dim)] (.SetPixel rendered-bitmap dx dy color))) rendered-bitmap))</code> </pre><br><br>  All images are cached.  When drawing a frame, everything is taken from the cache. <br><br>  Well, as for the Windows Form and Chart, the code is: <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> current-wins (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> win-app (<span class="hljs-name"><span class="hljs-name">agent</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> winforms-app-inited? (<span class="hljs-name"><span class="hljs-name">atom</span></span> false)) (<span class="hljs-name"><span class="hljs-name">def</span></span> chart (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">def</span></span> series (<span class="hljs-name"><span class="hljs-name">atom</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> get-series [series-name] (<span class="hljs-name"><span class="hljs-name">first</span></span> (<span class="hljs-name"><span class="hljs-name">filter</span></span> (<span class="hljs-name"><span class="hljs-name">fn</span></span> [x] (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> (. x Name) series-name) true false)) @series))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> add-xy [series-name xy] (<span class="hljs-name"><span class="hljs-name">let</span></span> [series (<span class="hljs-name"><span class="hljs-name">get-series</span></span> series-name)] (<span class="hljs-name"><span class="hljs-name">when</span></span> series (.AddXY (.Points series) xy) (<span class="hljs-name"><span class="hljs-name">when</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> (.Count (.Points series)) <span class="hljs-number"><span class="hljs-number">500</span></span>) (.RemoveAt (.Points series) <span class="hljs-number"><span class="hljs-number">0</span></span>))))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> create-series [chart] (<span class="hljs-name"><span class="hljs-name">let</span></span> [series1 (. chart Series)] (.Add series1 <span class="hljs-string"><span class="hljs-string">"herb"</span></span>) (.Add series1 <span class="hljs-string"><span class="hljs-string">"sugar"</span></span>) (.Add series1 <span class="hljs-string"><span class="hljs-string">"anthill-sugar"</span></span>) (.Add series1 <span class="hljs-string"><span class="hljs-string">"aphises"</span></span>) (<span class="hljs-name"><span class="hljs-name">doseq</span></span> [s series1] (<span class="hljs-name"><span class="hljs-name">doto</span></span> s (.set_ChartType SeriesChartType/Spline) (.set_IsVisibleInLegend true) )) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> series series1) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">get-series</span></span> <span class="hljs-string"><span class="hljs-string">"herb"</span></span>) (.set_Color Color/Green) (.set_LegendText <span class="hljs-string"><span class="hljs-string">"Herb"</span></span>) ) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">get-series</span></span> <span class="hljs-string"><span class="hljs-string">"sugar"</span></span>) (.set_Color Color/White) (.set_LegendText <span class="hljs-string"><span class="hljs-string">"Free sugar"</span></span>) ) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">get-series</span></span> <span class="hljs-string"><span class="hljs-string">"anthill-sugar"</span></span>) (.set_Color (<span class="hljs-name"><span class="hljs-name">Color/FromArgb</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">115</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (.set_LegendText <span class="hljs-string"><span class="hljs-string">"Anthill sugar"</span></span>) ) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">get-series</span></span> <span class="hljs-string"><span class="hljs-string">"aphises"</span></span>) (.set_Color (<span class="hljs-name"><span class="hljs-name">ControlPaint/Light</span></span> Color/Green)) (.set_LegendText <span class="hljs-string"><span class="hljs-string">"Aphises"</span></span>) ))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> chart-update[chart] (<span class="hljs-name"><span class="hljs-name">add-xy</span></span> <span class="hljs-string"><span class="hljs-string">"anthill-sugar"</span></span> @world-time (<span class="hljs-name"><span class="hljs-name">anthill-sugar-calc</span></span>)) (<span class="hljs-name"><span class="hljs-name">add-xy</span></span> <span class="hljs-string"><span class="hljs-string">"herb"</span></span> @world-time (<span class="hljs-name"><span class="hljs-name">herb-calc</span></span>)) (<span class="hljs-name"><span class="hljs-name">add-xy</span></span> <span class="hljs-string"><span class="hljs-string">"sugar"</span></span> @world-time (<span class="hljs-name"><span class="hljs-name">free-sugar-calc</span></span>)) (<span class="hljs-name"><span class="hljs-name">add-xy</span></span> <span class="hljs-string"><span class="hljs-string">"aphises"</span></span> @world-time (<span class="hljs-name"><span class="hljs-name">count</span></span> @aphises)) (<span class="hljs-name"><span class="hljs-name">let</span></span> [chart-areas (. chart ChartAreas) chart-area (<span class="hljs-name"><span class="hljs-name">first</span></span> chart-areas) axis-x (. chart-area AxisX)] (<span class="hljs-name"><span class="hljs-name">doto</span></span> axis-x (.set_Minimum (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> @world-time <span class="hljs-number"><span class="hljs-number">500</span></span>) (<span class="hljs-name"><span class="hljs-name">-</span></span> @world-time <span class="hljs-number"><span class="hljs-number">500</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>)) (.set_Maximum (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> @world-time <span class="hljs-number"><span class="hljs-number">500</span></span>) @world-time <span class="hljs-number"><span class="hljs-number">500</span></span>))))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> create-form [] (<span class="hljs-name"><span class="hljs-name">let</span></span> [form (<span class="hljs-name"><span class="hljs-name">Form</span></span>.) panel (<span class="hljs-name"><span class="hljs-name">Panel</span></span>.) animation-timer (<span class="hljs-name"><span class="hljs-name">Timer</span></span>.) world-timer (<span class="hljs-name"><span class="hljs-name">Timer</span></span>.) chart1 (<span class="hljs-name"><span class="hljs-name">Chart</span></span>.) series1 (. chart1 Series)] (<span class="hljs-name"><span class="hljs-name">doto</span></span> chart1 (.set_Name <span class="hljs-string"><span class="hljs-string">"chart1"</span></span>) (.set_Location (<span class="hljs-name"><span class="hljs-name">new</span></span> Point size <span class="hljs-number"><span class="hljs-number">0</span></span>)) (.set_Size (<span class="hljs-name"><span class="hljs-name">Size</span></span>. size size)) (.set_BackColor (<span class="hljs-name"><span class="hljs-name">ControlPaint/Light</span></span> bgcolor))) (.Add (. chart1 ChartAreas) <span class="hljs-string"><span class="hljs-string">"MainChartArea"</span></span>) (.Add (. chart1 Legends) <span class="hljs-string"><span class="hljs-string">"Legend"</span></span>) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">first</span></span> (. chart1 ChartAreas)) (.set_BackColor bgcolor)) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (<span class="hljs-name"><span class="hljs-name">first</span></span> (. chart1 Legends)) (.set_BackColor bgcolor)) (<span class="hljs-name"><span class="hljs-name">create-series</span></span> chart1) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> chart chart1) (<span class="hljs-name"><span class="hljs-name">chart-update</span></span> chart1) (<span class="hljs-name"><span class="hljs-name">let</span></span> [chart-areas (. chart1 ChartAreas) chart-area (<span class="hljs-name"><span class="hljs-name">first</span></span> chart-areas) axis-x (. chart-area AxisX) axis-y (. chart-area AxisY)] (<span class="hljs-name"><span class="hljs-name">doto</span></span> axis-x (.set_IsStartedFromZero true)) (<span class="hljs-name"><span class="hljs-name">doto</span></span> axis-y (.set_IsStartedFromZero true))) (<span class="hljs-name"><span class="hljs-name">doto</span></span> panel (.set_Location (<span class="hljs-name"><span class="hljs-name">new</span></span> Point <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) (.set_Name <span class="hljs-string"><span class="hljs-string">"panel1"</span></span>) (.set_Size (<span class="hljs-name"><span class="hljs-name">Size</span></span>. size size)) (.add_Click (<span class="hljs-name"><span class="hljs-name">gen-delegate</span></span> EventHandler [sender args] (<span class="hljs-name"><span class="hljs-name">when</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> (.Button args) MouseButtons/Right) (<span class="hljs-name"><span class="hljs-name">swap!</span></span> show-lens? (<span class="hljs-name"><span class="hljs-name">fn</span></span> [x] (<span class="hljs-name"><span class="hljs-name">not</span></span> x)))) (<span class="hljs-name"><span class="hljs-name">when</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> (.Button args) MouseButtons/Left) (<span class="hljs-name"><span class="hljs-name">let</span></span> [mouse-x (@mouse-pos <span class="hljs-number"><span class="hljs-number">0</span></span>) mouse-y (@mouse-pos <span class="hljs-number"><span class="hljs-number">1</span></span>) x (<span class="hljs-name"><span class="hljs-name">/</span></span> mouse-x scale) y (<span class="hljs-name"><span class="hljs-name">/</span></span> mouse-y scale) p (<span class="hljs-name"><span class="hljs-name">place</span></span> [xy])] (<span class="hljs-name"><span class="hljs-name">prn</span></span> [xy] @p) (.Focus panel))))) (.add_MouseMove (<span class="hljs-name"><span class="hljs-name">gen-delegate</span></span> MouseEventHandler [sender args] (<span class="hljs-name"><span class="hljs-name">reset!</span></span> mouse-pos [ (<span class="hljs-name"><span class="hljs-name">*</span></span> (<span class="hljs-name"><span class="hljs-name">quot</span></span> (.X args) scale) scale) (<span class="hljs-name"><span class="hljs-name">*</span></span> (<span class="hljs-name"><span class="hljs-name">quot</span></span> (.Y args) scale) scale)]))) (.add_MouseWheel (<span class="hljs-name"><span class="hljs-name">gen-delegate</span></span> MouseEventHandler [sender args] (<span class="hljs-name"><span class="hljs-name">let</span></span> [f (<span class="hljs-name"><span class="hljs-name">fn</span></span> [x] (<span class="hljs-name"><span class="hljs-name">let</span></span> [new-sleep (<span class="hljs-name"><span class="hljs-name">+</span></span> x (<span class="hljs-name"><span class="hljs-name">*</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> (<span class="hljs-name"><span class="hljs-name">/</span></span> (.Delta args) <span class="hljs-number"><span class="hljs-number">120</span></span>)))] (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> new-sleep <span class="hljs-number"><span class="hljs-number">0</span></span>) new-sleep <span class="hljs-number"><span class="hljs-number">0</span></span>)))] (<span class="hljs-name"><span class="hljs-name">swap!</span></span> ant-sleep-ms f) (<span class="hljs-name"><span class="hljs-name">swap!</span></span> ladybug-sleep-ms f) (<span class="hljs-name"><span class="hljs-name">swap!</span></span> aphis-sleep-ms f) (<span class="hljs-name"><span class="hljs-name">prn</span></span> @ant-sleep-ms))))) (<span class="hljs-name"><span class="hljs-name">doto</span></span> animation-timer (.set_Interval animation-sleep-ms) (.set_Enabled true) (.add_Tick (<span class="hljs-name"><span class="hljs-name">gen-delegate</span></span> EventHandler [sender args] (<span class="hljs-name"><span class="hljs-name">do</span></span> (<span class="hljs-name"><span class="hljs-name">when</span></span> @buf-graph (.Render (@buf-graph <span class="hljs-number"><span class="hljs-number">0</span></span>) (@buf-graph <span class="hljs-number"><span class="hljs-number">1</span></span>))) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> rectangles-in-cells []) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> rendered-bitmaps []) (<span class="hljs-name"><span class="hljs-name">let</span></span> [v (<span class="hljs-name"><span class="hljs-name">vec</span></span> (<span class="hljs-name"><span class="hljs-name">for</span></span> [x (<span class="hljs-name"><span class="hljs-name">range</span></span> dim) y (<span class="hljs-name"><span class="hljs-name">range</span></span> dim)] @(<span class="hljs-name"><span class="hljs-name">place</span></span> [xy])))] (<span class="hljs-name"><span class="hljs-name">dorun</span></span> (<span class="hljs-name"><span class="hljs-name">for</span></span> [x (<span class="hljs-name"><span class="hljs-name">range</span></span> dim) y (<span class="hljs-name"><span class="hljs-name">range</span></span> dim)] (<span class="hljs-name"><span class="hljs-name">render-place</span></span> (<span class="hljs-name"><span class="hljs-name">v</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> (<span class="hljs-name"><span class="hljs-name">*</span></span> x dim) y)) xy))) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> buf-graph (<span class="hljs-name"><span class="hljs-name">render</span></span> panel)) (<span class="hljs-name"><span class="hljs-name">when</span></span> @show-lens? (<span class="hljs-name"><span class="hljs-name">reset!</span></span> buf-graph (<span class="hljs-name"><span class="hljs-name">render-lens</span></span>)))))))) (<span class="hljs-name"><span class="hljs-name">doto</span></span> world-timer (.set_Interval <span class="hljs-number"><span class="hljs-number">5000</span></span>) (.set_Enabled true) (.add_Tick (<span class="hljs-name"><span class="hljs-name">gen-delegate</span></span> EventHandler [sender args] (<span class="hljs-name"><span class="hljs-name">swap!</span></span> world-time inc) (<span class="hljs-name"><span class="hljs-name">chart-update</span></span> chart1)))) (<span class="hljs-name"><span class="hljs-name">doto</span></span> (.Controls form) (.Add panel) (.Add chart1)) (<span class="hljs-name"><span class="hljs-name">doto</span></span> form (.set_ClientSize (<span class="hljs-name"><span class="hljs-name">Size</span></span>. (<span class="hljs-name"><span class="hljs-name">*</span></span> size <span class="hljs-number"><span class="hljs-number">2</span></span>) size)) (.set_Text <span class="hljs-string"><span class="hljs-string">"Super Ants"</span></span>)) form)) (<span class="hljs-name"><span class="hljs-name">defn</span></span> init-winforms-app [] (<span class="hljs-name"><span class="hljs-name">when-not</span></span> @winforms-app-inited? (<span class="hljs-name"><span class="hljs-name">Application/EnableVisualStyles</span></span>) (<span class="hljs-name"><span class="hljs-name">Application/SetCompatibleTextRenderingDefault</span></span> false) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> winforms-app-inited? true))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> start-gui [x] (<span class="hljs-name"><span class="hljs-name">init-winforms-app</span></span>) (<span class="hljs-name"><span class="hljs-name">reset!</span></span> current-wins (<span class="hljs-name"><span class="hljs-name">create-form</span></span>)) (<span class="hljs-name"><span class="hljs-name">Application/Run</span></span> @current-wins))</code> </pre><br><br>  I hope it was not boring. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/256017/">https://habr.com/ru/post/256017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256005/index.html">Big Data Week Moscow 2015: learn about the big data industry from the inside</a></li>
<li><a href="../256009/index.html">New life shooting gallery</a></li>
<li><a href="../256011/index.html">Character LCD display (Video Lesson 1)</a></li>
<li><a href="../256013/index.html">Why did PayPal replace VMware with OpenStack?</a></li>
<li><a href="../256015/index.html">Xcode: plugins plugins</a></li>
<li><a href="../256021/index.html">What is the HL7 Continuity of Care Document (CCD)</a></li>
<li><a href="../256023/index.html">The task of the sages. Decision</a></li>
<li><a href="../256027/index.html">Cut and copy to buffer using javascript</a></li>
<li><a href="../256029/index.html">Report by Alexey Bragin at the Russian Open Source Summit 2015</a></li>
<li><a href="../256033/index.html">Intel Xeon `s rush into the market fault-tolerant RISC-servers, built on the patterns mainframe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>