<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby 2.1 in Detail (Part 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Method #singleton_class? for Module / Class 
 The #singleton_class? Method was added to the Module and Class classes, which, as one would expect, retu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby 2.1 in Detail (Part 3)</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/ccd/b8f/bab/ccdb8fbabd2b13bae6145fa4da9c7ac2.png"><br><h5>  Method #singleton_class?  for Module / Class </h5><br>  The #singleton_class? Method was added to the Module and Class classes, which, as one would expect, returns whether the recipient is a (singleton) meta-class. <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">singleton_class?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; false class &lt;&lt; self singleton_class? #=&gt; true end end</span></span></span></span></code> </pre> <br><a name="habracut"></a><br><h5>  More logical Module # ancestors </h5><br>  The #ancestors method, called against a meta-class, now returns an array containing, among other things, meta-classes, which makes its behavior more consistent.  It also orders the output of meta-classes, but this is done only if the module was connected to the meta-class with prepend (and not include). <br><br><pre> <code class="ruby hljs">Object.ancestors.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(Object) <span class="hljs-comment"><span class="hljs-comment">#=&gt; true Object.singleton_class.ancestors.include?(Object.singleton_class) #=&gt; true</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Object # singleton_method </h5><br>  Same as #method and #instance_method, but returns only meta-class methods <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test2</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># returns class method Example.singleton_method(:test) #=&gt; #&lt;Method: Example.test&gt; # doesn't return instance method Example.singleton_method(:test2) #=&gt; #&lt;NameError: undefined singleton method `test2' for `Example'&gt; # doesn't return inherited class method Example.singleton_method(:name) #=&gt; #&lt;NameError: undefined singleton method `name' for `Example'&gt;</span></span></span></span></code> </pre><br><br><pre> <code class="ruby hljs">example = Object.new <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">example</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">singleton_method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:test</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Method: #&lt;Object:0x007fc54997a610&gt;.test&gt;</span></span></code> </pre><br><br><h5>  Method # original_name </h5><br>  In the Method and UnboundMethod classes, the #original_name method appeared, which returns the name of the method without an alias. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alias</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">original_name</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; :foo example.method(:bar).original_name #=&gt; :foo Example.instance_method(:bar).original_name #=&gt; :foo</span></span></span></span></code> </pre><br><br><h5>  Mutex owned? </h5><br>  Method <a href="http://globaldev.co.uk/2013/03/ruby-2-0-0-in-detail/">Mutex owned?</a>  It is no longer experimental, there is nothing more to say about it in general. <br><br><h5>  Hash # reject </h5><br>  Calling the Hash # reject method in a subclass of Hash will output a Vorning.  In Ruby 2.2, calling #reject in subclasses of Hash will return a new Hash object, not a subclass object.  Therefore, in preparation for this change, a warning has been added. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyHash</span></span></span><span class="hljs-class"> &lt; Hash </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyHash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">] = 1 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">] = 2 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reject</span></span></span><span class="hljs-class"> {|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">k</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class"> &gt; 1}.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; MyHash</span></span></span></span></code> </pre><br>  Displays the following warning: <br><br><pre> <code class="ruby hljs">example.<span class="hljs-symbol"><span class="hljs-symbol">rb:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">warning:</span></span> copying unguaranteed <span class="hljs-symbol"><span class="hljs-symbol">attributes:</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:a=&gt;</span></span><span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:b=&gt;</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>} example.<span class="hljs-symbol"><span class="hljs-symbol">rb:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">warning:</span></span> following atributes will <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be copied <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the future <span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> example.<span class="hljs-symbol"><span class="hljs-symbol">rb:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">warning:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">subclass:</span></span> MyHash</code> </pre><br>  In Ruby 2.1.1, a complete change was accidentally included, to which the Hash object returns and does not generate a Vorning, but in 2.1.2 this was fixed back. <br><br><h5>  Vector # cross_product </h5><br>  The cross_product method has been added to the Vector class. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"matrix"</span></span> Vector[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>].cross_product(Vector[<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-comment"><span class="hljs-comment">#=&gt; Vector[0, 0, -1]</span></span></code> </pre><br><br><h5>  Fixnum / Bignum #bit_length </h5><br>  Calling #bit_length against an integer will return the number of digits needed to represent the number in the binary system. <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">128</span></span>.bit_length <span class="hljs-comment"><span class="hljs-comment">#=&gt; 8 32768.bit_length #=&gt; 16 2147483648.bit_length #=&gt; 32 4611686018427387904.bit_length #=&gt; 63</span></span></code> </pre><br><br><h5>  pack / unpack and byte number representation </h5><br>  The Array # pack and String # unpack methods can now work with the byte representation of long numbers using Q_ / Q!  and q_ / q !. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># output may differ depending on the endianness of your system unsigned_long_long_max = [2**64 - 1].pack("Q!") #=&gt; "\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF" signed_long_long_min = [-2**63].pack("q!") #=&gt; "\x00\x00\x00\x00\x00\x00\x00\x80" signed_long_long_max = [2**63 - 1].pack("q!") #=&gt; "\xFF\xFF\xFF\xFF\xFF\xFF\xFF\x7F" unsigned_long_long_max.unpack("Q!") #=&gt; 18446744073709551615 signed_long_long_min.unpack("q!") #=&gt; -9223372036854775808 signed_long_long_max.unpack("q!") #=&gt; 9223372036854775807</span></span></code> </pre><br><br><h5>  Dir.glob returns compound characters </h5><br>  The Mac OS X file system HFS Plus uses UTF8-MAC encoding for file names with separated characters, for example, √© is represented as e and U + 0301, and not just U + 00E9 ( <a href="https://developer.apple.com/library/mac/qa/qa1173/_index.html">with some exceptions</a> ).  Dir.glob and Dir [] now convert them back to UTF8 strings with compound characters. <br><br><pre> <code class="ruby hljs">File.write(<span class="hljs-string"><span class="hljs-string">"composed_e\u{301}xample.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) File.write(<span class="hljs-string"><span class="hljs-string">"precomposed_\u{e9}xample.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) puts Dir[<span class="hljs-string"><span class="hljs-string">"*"</span></span>].map(&amp;<span class="hljs-symbol"><span class="hljs-symbol">:dump</span></span>)</code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-string"><span class="hljs-string">"composed_\u{e9}xample.txt"</span></span> <span class="hljs-string"><span class="hljs-string">"example.rb"</span></span> <span class="hljs-string"><span class="hljs-string">"precomposed_\u{e9}xample.txt"</span></span></code> </pre><br><br><h5>  Improved type casting for Numeric # quo </h5><br>  The Numeric # quo method now calls #to_r on the receiver, which should improve behavior when implementing Numeric own subclasses.  This also means that if it is impossible to cast, TypeError will be raised, not ArgumentError, which the truth should not be a problem during the transition, since  TypeError is a subclass of ArgumentError. <br><br><h5>  Binding # local_variable_get / _set / _defined? </h5><br>  In the Binding class, new methods for getting / setting local variables have appeared.  This can be useful if you really need to use a named argument that matches a reserved keyword. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">primes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">begin:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">end:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> [binding.local_variable_get(<span class="hljs-symbol"><span class="hljs-symbol">:begin</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>].max.upto(binding.local_variable_get(<span class="hljs-symbol"><span class="hljs-symbol">:end</span></span>)).each_with_object([]) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i, array|</span></span> array &lt;&lt; i <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>...i).any? {<span class="hljs-params"><span class="hljs-params">|j|</span></span> (i % j).zero?} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> primes(<span class="hljs-symbol"><span class="hljs-symbol">end:</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; [2, 3, 5, 7]</span></span></code> </pre><br>  Or if you want to use a hash to set variables, for example when running a template: <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_binding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hash)</span></span></span></span> b = TOPLEVEL_BINDING.dup hash.each {<span class="hljs-params"><span class="hljs-params">|k,v|</span></span> b.local_variable_set(k, v)} b <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"erb"</span></span> cover = <span class="hljs-string"><span class="hljs-string">%Q{&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;\n&lt;h2 class="big friendly"&gt;&lt;%= subtitle %&gt;&lt;/h2&gt;}</span></span> locals = {<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Hitchhiker's Guide to the Galaxy"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:subtitle</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Don't Panic"</span></span>} ERB.new(cover).result(make_binding(locals)) <span class="hljs-comment"><span class="hljs-comment">#=&gt; "&lt;h1&gt;Hitchhiker's Guide to the Galaxy&lt;/h1&gt;\n&lt;h2 class=\"big friendly\"&gt;Don't Panic&lt;/h2&gt;"</span></span></code> </pre><br><br><h5>  CGI class methods are now available from the CGI :: Util module </h5><br>  The CGI class has several useful methods for shielding url and html strings.  They were transferred to the CGI :: Util module, which can be included in other classes or scripts. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"cgi/util"</span></span> CGI.escape(<span class="hljs-string"><span class="hljs-string">"hello world!"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; "hello+world%21" include CGI::Util escape("hello world!") #=&gt; "hello+world%21"</span></span></code> </pre><br><br><h5>  Digest :: Class.file passes arguments to the constructor. </h5><br>  The various classes of the Digest module have a method for creating a digest for the file, this method has been changed, and now it passes to the constructor all the arguments passed except for the file name.  Those.  instead: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"digest"</span></span> Digest::SHA2.new(<span class="hljs-number"><span class="hljs-number">512</span></span>).hexdigest(File.read(<span class="hljs-string"><span class="hljs-string">"example.txt"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">#=&gt; "f7fbba..."</span></span></code> </pre><br>  You can write: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"digest"</span></span> Digest::SHA2.file(<span class="hljs-string"><span class="hljs-string">"example.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>).hexdigest <span class="hljs-comment"><span class="hljs-comment">#=&gt; "f7fbba..."</span></span></code> </pre><br><br><h5>  Net :: SMTP # rset </h5><br>  You can now cancel the SMTP transaction by sending a RSET command using the Net :: SMTP # rset method. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"net/smtp"</span></span> smtp = Net::SMTP.start(<span class="hljs-string"><span class="hljs-string">"some.smtp.server"</span></span>) notification = <span class="hljs-string"><span class="hljs-string">"Hi %s,\n ..."</span></span> users.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|user|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> smtp.mailfrom(<span class="hljs-string"><span class="hljs-string">"noreply@example.com"</span></span>) smtp.rcptto(user.email) smtp.data(sprintf(notification, user.name)) <span class="hljs-keyword"><span class="hljs-keyword">rescue</span></span> smtp.rset <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> smtp.finish</code> </pre><br><br><h5>  open-uri supports duplicate headers </h5><br>  open-uri allows using the Kernel # open method to open resources by URI, and extends the return value using OpenURI :: Meta, where the new method #metas was added, which returns an array of values ‚Äã‚Äãif the header was specified several times, for example, set-cookie. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"open-uri"</span></span> f = open(<span class="hljs-string"><span class="hljs-string">"http://google.com"</span></span>) f.meta[<span class="hljs-string"><span class="hljs-string">"set-cookie"</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-comment"><span class="hljs-comment">#=&gt; String f.metas["set-cookie"].class #=&gt; Array f.metas["set-cookie"].length #=&gt; 2</span></span></code> </pre><br><br><h5>  Write to file via Pathname </h5><br>  The #write and #binwrite methods for writing files have been added to the Pathname class. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"pathname"</span></span> path = Pathname.new(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>).expand_path(__dir_<span class="hljs-number"><span class="hljs-number">_</span></span>) path.write(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>) path.write(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment"># offset path.write("baz", mode: "a") # append</span></span></code> </pre><br><br><h5>  Tempfile.create </h5><br>  The Tempfile class now has a method similar to the new method, but instead of returning a Tempfile object that uses the finalizer (finaliser), which deletes the file when the object is garbage collected, the create method passes the File object to the block after which the file is deleted. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"tempfile"</span></span> path = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> Tempfile.create(<span class="hljs-string"><span class="hljs-string">"example"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|f|</span></span> f <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;File:/tmp/example20140428-16851-15kf046&gt; path = f.path end File.exist?(path) #=&gt; false</span></span></code> </pre><br><br><h5>  Rinda multicast support </h5><br>  Now Rinda Ring Classes can listen / connect to group addresses. <br><br>  Below is an example of using Rinda to create a simple service that listens on a group address of 239.0.0.1. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"rinda/ring"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"rinda/tuplespace"</span></span> DRb.start_service tuple_space = Rinda::TupleSpace.new server = Rinda::RingServer.new(tuple_space, [<span class="hljs-string"><span class="hljs-string">"239.0.0.1"</span></span>]) DRb.thread.join</code> </pre><br>  Registration service: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"rinda/ring"</span></span> DRb.start_service ring_finger = Rinda::RingFinger.new([<span class="hljs-string"><span class="hljs-string">"239.0.0.1"</span></span>]) tuple_space = ring_finger.lookup_ring_any tuple_space.write([<span class="hljs-symbol"><span class="hljs-symbol">:message_service</span></span>, <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-number"><span class="hljs-number">8080</span></span>]) <span class="hljs-comment"><span class="hljs-comment"># start messaging service on localhost:8080</span></span></code> </pre><br>  Getting the address of the service: <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"rinda/ring"</span></span> DRb.start_service ring_finger = Rinda::RingFinger.new([<span class="hljs-string"><span class="hljs-string">"239.0.0.1"</span></span>]) tuple_space = ring_finger.lookup_ring_any <span class="hljs-number"><span class="hljs-number">_</span></span>, host, port = tuple_space.read([<span class="hljs-symbol"><span class="hljs-symbol">:message_service</span></span>, String, Fixnum]) <span class="hljs-comment"><span class="hljs-comment"># connect to messaging service</span></span></code> </pre><br>  I had some problems with the string tuple_space = ring_finger.lookup_ring_any and I had to use: <br><br><pre> <code class="ruby hljs">tuple_space = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> ring_finger.lookup_ring(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">01</span></span>) {<span class="hljs-params"><span class="hljs-params">|x|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> tuple_space = x}</code> </pre><br><br><h5>  Setting additional HTTP options for XMLRPC </h5><br>  XMLRPC :: Client # http returns the Net :: HTTP object used by the client to set some configuration options that cannot be set via setters. <br><br><pre> <code class="ruby hljs">client = XMLRPC::Client.new(<span class="hljs-string"><span class="hljs-string">"example.com"</span></span>) client.http.keep_alive_timeout = <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-comment"><span class="hljs-comment"># keep connection open for longer # use client ...</span></span></code> </pre><br><br><h5>  URI.encode_ / decode_www_form updated to WHATWG standard </h5><br>  The methods URI.encode_www_form and URI.decode_www_form have been updated to conform <a href="http://url.spec.whatwg.org/">to the WHATWG standard</a> . <br><br>  URI.decode_www_form no longer perceives <code>;</code>  as a delimiter, <code>&amp;</code> only default delimiter, but you can set the delimiter value using a named argument separator :. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"uri"</span></span> URI.decode_www_form(<span class="hljs-string"><span class="hljs-string">"foo=1;bar=2"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">separator:</span></span> <span class="hljs-string"><span class="hljs-string">";"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; [["foo", "1"], ["bar", "2"]]</span></span></code> </pre><br>  URI.decode_www_form can now also successfully decode the output of URI.encode_www_form when its value is nil. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"uri"</span></span> string = URI.encode_www_form(<span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">bar:</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">baz:</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; "foo=1&amp;bar&amp;baz=3" URI.decode_www_form("foo=1&amp;bar&amp;baz=3") #=&gt; [["foo", "1"], ["bar", ""], ["baz", "3"]]</span></span></code> </pre><br><br><h5>  RbConfig :: SIZEOF </h5><br>  New method RbConfig :: SIZEOF returns the size of C-types. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"rbconfig/sizeof"</span></span> RbConfig::SIZEOF[<span class="hljs-string"><span class="hljs-string">"short"</span></span>] <span class="hljs-comment"><span class="hljs-comment">#=&gt; 2 RbConfig::SIZEOF["int"] #=&gt; 4 RbConfig::SIZEOF["long"] #=&gt; 8</span></span></code> </pre><br><br><h5>  Setting the logging category to Syslog :: Logger </h5><br>  Syslog :: Logger, a Logger-compatible interface for Syslog, has the option of installing a category. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"syslog/logger"</span></span> facility = Syslog::LOG_LOCAL<span class="hljs-number"><span class="hljs-number">0</span></span> logger = Syslog::Logger.new(<span class="hljs-string"><span class="hljs-string">"MyApp"</span></span>, facility) logger.debug(<span class="hljs-string"><span class="hljs-string">"test"</span></span>)</code> </pre><br><br><h5>  CSV.foreach without block returns an enumerator </h5><br>  CSV.foreach, called without a block as an argument, returns an enumerator, but when used for a long time, this led to IOError, it was fixed. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"csv"</span></span> enum = CSV.foreach(<span class="hljs-string"><span class="hljs-string">"example.csv"</span></span>) enum.<span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-comment"><span class="hljs-comment">#=&gt; ["1", "foo"] enum.next #=&gt; ["2", "bar"] enum.next #=&gt; ["3", "baz"]</span></span></code> </pre><br><br><h5>  Openssl bignum </h5><br>  OpenSSL :: BN.new now accepts not only strings, but also integers as arguments. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"openssl"</span></span> OpenSSL::BN.new(<span class="hljs-number"><span class="hljs-number">4_611_686_018_427_387_904</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;OpenSSL::BN:0x007fce7a0c56e8&gt;</span></span></code> </pre><br><br><h5>  The size enumerator.new argument takes any callable object. </h5><br>  Enumerator.new accepts the size argument, which can be either an integer or an object with the #call method.  However, before 2.0.0, the method actually worked only with integers and Proc objects.  This is now fixed and works as stated in the documentation. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"thread"</span></span> queue = Queue.new enum = Enumerator.new(queue.method(<span class="hljs-symbol"><span class="hljs-symbol">:size</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|yielder|</span></span> loop {yielder &lt;&lt; queue.pop} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> queue &lt;&lt; <span class="hljs-string"><span class="hljs-string">"foo"</span></span> enum.size <span class="hljs-comment"><span class="hljs-comment">#=&gt; 1</span></span></code> </pre><br><br><h5>  Removed curses library </h5><br>  curses has been removed from the standard library and is available as a <a href="https://rubygems.org/gems/curses">heme</a> . <br><br><h5>  Class methods in TSort </h5><br>  The TSort class can be useful in determining the order in which tasks are executed from a list of dependencies.  However, using it is rather troublesome, for the total you need to implement a class that includes TSort, as well as the #tsort_each_node and #tsort_each_child methods. <br><br>  But now TSort has become more convenient to use with, for example, hashes.  Methods that are available as instance methods are now available in the module itself, taking two callable objects, one as a replacement for #tsort_each_node, and the other for #tsort_each_child. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"tsort"</span></span> camping_steps = { <span class="hljs-string"><span class="hljs-string">"sleep"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"food"</span></span>, <span class="hljs-string"><span class="hljs-string">"tent"</span></span>], <span class="hljs-string"><span class="hljs-string">"tent"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"camping site"</span></span>, <span class="hljs-string"><span class="hljs-string">"canvas"</span></span>], <span class="hljs-string"><span class="hljs-string">"canvas"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"tent poles"</span></span>], <span class="hljs-string"><span class="hljs-string">"tent poles"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"camping site"</span></span>], <span class="hljs-string"><span class="hljs-string">"food"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"fish"</span></span>, <span class="hljs-string"><span class="hljs-string">"fire"</span></span>], <span class="hljs-string"><span class="hljs-string">"fire"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"firewood"</span></span>, <span class="hljs-string"><span class="hljs-string">"matches"</span></span>, <span class="hljs-string"><span class="hljs-string">"camping site"</span></span>], <span class="hljs-string"><span class="hljs-string">"fish"</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">"stream"</span></span>, <span class="hljs-string"><span class="hljs-string">"fishing rod"</span></span>] } all_nodes = camping_steps.to_a.flatten each_node = all_nodes.method(<span class="hljs-symbol"><span class="hljs-symbol">:each</span></span>) each_child = -&gt; step, &amp;b {camping_steps.fetch(step, []).each(&amp;b)} puts TSort.tsort(each_node, each_child)</code> </pre><br>  Displays: <br><br><pre> <code class="ruby hljs">stream fishing rod fish firewood matches camping site fire food tent poles canvas tent sleep</code> </pre><br><br><h5>  TCP Fast Open </h5><br>  Ruby 2.1 adds support for <a href="http://lwn.net/Articles/508865/">TCP Fast Open</a> , if available on your system.  To check for its presence in the system, you can check the existence of the constants Socket :: TCP_FASTOPEN and Socket :: MSG_FASTOPEN. <br><br>  Server: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> Socket.const_defined?(<span class="hljs-symbol"><span class="hljs-symbol">:TCP_FASTOPEN</span></span>) abort <span class="hljs-string"><span class="hljs-string">"TCP Fast Open not supported on this system"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> server = Socket.new(Socket::AF_INET, Socket::SOCK_STREAM) server.setsockopt(Socket::SOL_TCP, Socket::TCP_FASTOPEN, <span class="hljs-number"><span class="hljs-number">5</span></span>) addrinfo = Addrinfo.new(Socket.sockaddr_in(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>)) server.bind(addrinfo) server.listen(<span class="hljs-number"><span class="hljs-number">1</span></span>) socket = server.accept socket.write(socket.readline)</code> </pre><br>  Customer: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> Socket.const_defined?(<span class="hljs-symbol"><span class="hljs-symbol">:MSG_FASTOPEN</span></span>) abort <span class="hljs-string"><span class="hljs-string">"TCP Fast Open not supported on this system"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> socket = Socket.new(Socket::AF_INET, Socket::SOCK_STREAM) socket.send(<span class="hljs-string"><span class="hljs-string">"foo\n"</span></span>, Socket::MSG_FASTOPEN, Socket.sockaddr_in(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>)) puts socket.readline socket.close</code> </pre><br>  <a href="http://habrahabr.ru/post/222941/">The first part</a> <a href="http://habrahabr.ru/post/223209/">The second part</a> </div><p>Source: <a href="https://habr.com/ru/post/223521/">https://habr.com/ru/post/223521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223509/index.html">At Indiegogo raise money for a prototype of an inexpensive fusion reactor</a></li>
<li><a href="../223511/index.html">Using MultiSSID in life</a></li>
<li><a href="../223515/index.html">Promotion of applications in the AppStore (Google Play)</a></li>
<li><a href="../223517/index.html">Game Development: Getting Started</a></li>
<li><a href="../223519/index.html">Getting ready for 2014 Zabbix conference</a></li>
<li><a href="../223523/index.html">IPv6 in Cisco or the future is near (Part 2)</a></li>
<li><a href="../223525/index.html">Project management: operational vs. project approach</a></li>
<li><a href="../223527/index.html">Octotree: displaying code on github as a tree</a></li>
<li><a href="../223529/index.html">Magic AngularJS: never hang the binding on primitives</a></li>
<li><a href="../223531/index.html">All-Russian conference on Asterisk held</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>