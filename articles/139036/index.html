<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Script for deploying SSRS reports</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In many projects, an installation script or package is required, which performs the upgrade of the server part of the application. The need, first of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Script for deploying SSRS reports</h1><div class="post__text post__text-html js-mediator-article">  In many projects, an installation script or package is required, which performs the upgrade of the server part of the application.  The need, first of all, is due to the lack of direct access to the production server by the developers. <br>  The installer in the form of a script is best suited for installation without explicitly logging into the server (RDP).  The script can also be executed as a single loader, which will do the rest.  In current projects, we implemented something like PsGet <sup><a href="https://habr.com/ru/post/139036/">[1]</a></sup> , only for the internal build server. <br>  The application is large and consists of a number of components, one of which is the reporting module, built on the basis of <abbr title="SQL Server Reporting Services">SSRS</abbr> . <br><a name="habracut"></a><br>  To manage the reporting server, Microsoft provided the ReportingService2005.asmx web service to developers <sup><a href="https://habr.com/ru/post/139036/">[2]</a></sup> . <br><br><h4>  Presets </h4><br>  Initial installation and configuration of the reporting server is not the responsibility of the developers and is performed by teams with a certain responsibility.  Also, we do not create Data Sources, because  they may contain sensitive information (such as passwords to connect). <br>  As a result, the above settings, as well as the distribution of access, are not necessary for the script.  It remains only to add and update the reports themselves. <br><br><h4>  Connect to the service </h4><br>  PowerShell 2.0 provides the ability to create a proxy for working with a web service via the New-WebServiceProxy command <sup><a href="https://habr.com/ru/post/139036/">[3]</a></sup> . <br>  It is enough to specify the path to the description of the service on <abbr title="Web Service Definition Language">WSDL</abbr> <sup><a href="https://habr.com/ru/post/139036/">[4]</a></sup> .  We use Windows Authentication, so in the connection we specify the key UseDefaultCredential.  In the proxy service itself, you must also specify the authentication method. <br><pre><code class="hljs mel">function Connect-ReportingService([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$ssrsHost) { $reportingServiceUrl = $ssrsHost + <span class="hljs-string"><span class="hljs-string">"ReportService2005.asmx?wsdl"</span></span> $reportingService= New-WebServiceProxy $reportingServiceUrl -UseDefaultCredential -<span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> ReportingWebService $reportingService.UseDefaultCredentials = $true $reportingService }</code> </pre> <br>  The $ ssrsHost parameter contains the full path to which our service is configured (usually, <a href="http://servername/ReportServer/">servername / ReportServer</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Add report </h4><br>  In order to create or update a report, there is a method CreateReport <sup><a href="https://habr.com/ru/post/139036/">[5]</a></sup> . <br>  As parameters, it takes the report name, the parent folder name (folders allow you to group reports and set various security policies to them), the need to overwrite flag, the binary content of the report file and additional properties (usually not used, you can pass $ null). <br>  The method returns a collection of error and warning messages. <br>  Of these, we will ignore messages about Data Sources. <br>  The call will look like: <br><pre> <code class="hljs perl">(Connect-ReportingService $ssrsHost).CreateReport($report, $ssrsFolder, $true, $reportBits, $null)</code> </pre><br>  Thus, adding a report can be wrapped in a function: <br><pre> <code class="hljs mel">function Deploy-Report([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$ssrsHost, [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$reportDir, [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$report, [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$ssrsFolder) { &lt;#    ,     (   ) #&gt; $relativeReportLocation = <span class="hljs-string"><span class="hljs-string">"..\RS\$($report).rdl"</span></span> #    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-not (Test-Path $reportFile)) { $message = <span class="hljs-string"><span class="hljs-string">"Report file '{0}' was not found!"</span></span> -f $reportFile Write-Warning $message <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } #    [byte[]]$reportBits = [System.IO.File]::ReadAllBytes($reportFile) # ,      $warnings = (Connect-ReportingService $ssrsHost).CreateReport($report, $ssrsFolder, $true, $reportBits, $null) #    <span class="hljs-string"><span class="hljs-string">""</span></span> $cleanedWarnings = $warnings | ? { -not $_.Message.Contains(<span class="hljs-string"><span class="hljs-string">"data source"</span></span>) } #     (    ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$cleanedWarnings) { $result = <span class="hljs-string"><span class="hljs-string">"Report '{0}' published successfully with no warnings"</span></span> -f $report Write-Host $result Write-Host <span class="hljs-string"><span class="hljs-string">""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $warningHeader = <span class="hljs-string"><span class="hljs-string">"Report '{0}' published with warnings: "</span></span> -f $report Write-Host $warningHeader $cleanedWarnings | % { Write-Warning $_.Message } Write-Host <span class="hljs-string"><span class="hljs-string">""</span></span> } }</code> </pre><br><br><h4>  findings </h4><br>  The presented implementation solves the problem of adding and updating a single report and can be used in such code: <br><pre> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> <span class="hljs-string"><span class="hljs-string">"..\RS\*.rdl"</span></span>) | % { $_.Name.Replace(<span class="hljs-string"><span class="hljs-string">".rdl"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) } | % { Deploy-Report $ssrsHost $reportDir $report $ssrsFolder }</code> </pre><br>  Calling web services through PowerShell is a trivial task. <br>  The web service itself for SSRS provides much more possibilities, for example, adding / changing Data Source by means of the CreateDataSource method <sup><a href="https://habr.com/ru/post/139036/">[6]</a></sup> . <br><br><h5>  Extensions that can be made </h5><br>  In the current project we have implemented a bulk extension module. <br><br>  So, reports can also be updated by condition, for example, based on the time of the last modification of files <sup><a href="https://habr.com/ru/post/139036/">[7]</a></sup> : <br><pre> <code class="hljs smalltalk"> #     () <span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReports = (<span class="hljs-type"><span class="hljs-type">Connect</span></span>-<span class="hljs-type"><span class="hljs-type">ReportingService</span></span> <span class="hljs-string"><span class="hljs-string">$c</span></span>onfig).<span class="hljs-type"><span class="hljs-type">ListChildren</span></span>(<span class="hljs-string"><span class="hljs-string">$s</span></span>srsFolder, <span class="hljs-number"><span class="hljs-number">1</span></span>) [hashtable]<span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReportsMap = @{} <span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReports | % { <span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReportsMap[<span class="hljs-string"><span class="hljs-string">$_</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span> + <span class="hljs-string"><span class="hljs-string">'.rdl'</span></span>] = <span class="hljs-string"><span class="hljs-string">$_</span></span> } ls <span class="hljs-comment"><span class="hljs-comment">"..\RS\*.rdl"</span></span>) ` | ? { ( -not <span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReportsMap.<span class="hljs-type"><span class="hljs-type">ContainsKey</span></span>(<span class="hljs-string"><span class="hljs-string">$_</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>)) -or <span class="hljs-string"><span class="hljs-string">$d</span></span>eployedReportsMap[<span class="hljs-string"><span class="hljs-string">$_</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>].<span class="hljs-type"><span class="hljs-type">ModifiedDate</span></span> -lt <span class="hljs-string"><span class="hljs-string">$_</span></span>.<span class="hljs-type"><span class="hljs-type">LastWriteTime</span></span> } ` | % { <span class="hljs-string"><span class="hljs-string">$_</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>.<span class="hljs-type"><span class="hljs-type">Replace</span></span>(<span class="hljs-comment"><span class="hljs-comment">".rdl"</span></span>, <span class="hljs-comment"><span class="hljs-comment">""</span></span>) } ` | % { <span class="hljs-type"><span class="hljs-type">Deploy</span></span>-<span class="hljs-type"><span class="hljs-type">Report</span></span> <span class="hljs-string"><span class="hljs-string">$s</span></span>srsHost <span class="hljs-string"><span class="hljs-string">$r</span></span>eportDir <span class="hljs-string"><span class="hljs-string">$r</span></span>eport <span class="hljs-string"><span class="hljs-string">$s</span></span>srsFolder }</code> </pre><br>  Sometimes it is necessary to update the Data Source of the report, for which the SetItemDataSources method is used. <br>  Often it is required to flush the cache of the report (FlushCache method). <br><br>  In general, everything is simple and expandable. <br><hr><ol><li><a name="note1"></a>  <a href="http://psget.net/">psget.net</a> </li><li><a name="note2"></a>  <a href="http://msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.aspx">msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.aspx</a> </li><li><a name="note3"></a>  <a href="http://technet.microsoft.com/en-us/library/dd315258.aspx">technet.microsoft.com/en-us/library/dd315258.aspx</a> </li><li><a name="note4"></a>  <a href="http://www.w3.org/TR/wsdl">www.w3.org/TR/wsdl</a> </li><li><a name="note5"></a>  <a href="http://msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.createreport.aspx">msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.createreport.aspx</a> </li><li><a name="note6"></a>  <a href="http://msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.createdatasource.aspx">msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.createdatasource.aspx</a> </li><li><a name="note7"></a>  ListChildren method: <a href="http://msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.listchildren.aspx">msdn.microsoft.com/en-us/library/reportservice2005.reportingservice2005.listchildren.aspx</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/139036/">https://habr.com/ru/post/139036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139030/index.html">Video of the seminar "Information technologies as tools for profitable growth of the company"</a></li>
<li><a href="../139031/index.html">Duracell has released a "charging card" for wireless charging of mobile devices</a></li>
<li><a href="../139032/index.html">Gameboy emulation on Android</a></li>
<li><a href="../139033/index.html">Confused in a lot of communications? There is a solution</a></li>
<li><a href="../139034/index.html">Google will distribute 1 million dollars to fighters with bugs</a></li>
<li><a href="../139037/index.html">What do you think about master classes / workshops from foreign stars?</a></li>
<li><a href="../139039/index.html">The principle of substitution Liskov and contracts</a></li>
<li><a href="../139040/index.html">Centralized syslog</a></li>
<li><a href="../139042/index.html">Login page in the admin site of the city council of Dnepropetrovsk</a></li>
<li><a href="../139044/index.html">Setting up document processing on FAST</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>