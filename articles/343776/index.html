<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ideal catalog, data sample optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 At the next interview I was asked about the shortcomings of the EAV data model (Entity Attribute Value), I did not find what to say, in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ideal catalog, data sample optimization</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  At the next interview I was asked about the shortcomings of the EAV data model (Entity Attribute Value), I did not find what to say, in my opinion this is the ideal way to store arbitrary data.  After a short reflection, I said that the only problem is the impossibility of constructing indices for samples. <br><br>  After the interview I was puzzled by this question for a few days, I came to some conclusions, to clear my conscience a little google.  Googled confirmation of his thoughts, but this was not enough for me - I wanted to implement the confirmation with numbers. <br><br>  If you are interested in what conclusions I came to and what benefits from optimization can be obtained, then welcome to cat. <br><a name="habracut"></a><br><h2>  Table of contents on the series of articles "Ideal catalog" </h2><br><ol><li>  <a href="https://habrahabr.ru/post/322930/">Ideal catalog, architecture sketch</a> </li><li>  <a href="https://habrahabr.ru/post/323498/">Ideal catalog, an implementation option</a> </li><li>  <a href="https://habrahabr.ru/post/343776/">Ideal catalog, data sample optimization</a> </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Brief conclusions </h2><br>  For those who are tired and do not master a lot of letters, the conclusion is as follows: for sampling data, you must use materialized views, for which indices are built for all columns. <br>  Sampling on the materialized view works 5-15% faster than sampling from a similar table with similar indices. <br>  This concludes the conclusions and begins a consistent presentation. <br><br><h2>  Methods of working with the EAV model </h2><br>  Data can be obtained by direct queries, you can make a presentation for each type of Entity (catalog rubrics), you can make a similar materialized view.  As an option, you can make a table, but with every Attribute change, it will be necessary to perform ALTER TABLE with DROP COLUMN and ADD COLUMN, and this is exactly what they leave with EAV, although if you store data in EAV and use the table only for reading, normal option. <br>  You can google other ways to optimize EAV, but I researched only these. <br><br><h2>  Testing method </h2><br>  Scripts (PHP) were written to generate the contents of ‚Äúheadings‚Äù and scripts to generate the DDL code for creating a table, creating a view, and creating a materialized view (PostrgeSql). <br>  With these scripts the appropriate data sources were created. <br>  Now we select an entity (catalog rubric), which will have many positions and few characteristics (attributes). <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> r.code, (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric_property rp <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> rp.rubric_id = r.id) property_count, (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric_item ri <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ri.rubric_id = r.id) item_count, (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric_property rp <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> rp.rubric_id = r.id) + ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric_item ri <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ri.rubric_id = r.id) summary <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric r <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> r.code, r.id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> summary <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>, property_count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>, item_count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br>  The number of attributes in my opinion does not matter much, but if someone wants to evaluate the impact of the number of attributes, then all the scripts <a href="https://github.com/SbWereWolf/universal_data_catalog_idea">are in the repository</a> . <br>  We make two types of samples, the first type of sample returns one line, the second one - several lines. <br>  Of course, for full testing, more sample types are required. <br><br>  For each type of sample, we perform queries to each data source: we sample from a query, from a view, from a table, from a materialized view and again from a query, and so on in a circle.  Such a recurrence in theory will reduce the impact of query caching  Performing the same query 1000 times in a row seems to me a bad way to test. <br>  Thus, we make five measurements of the execution time.  We discard the extreme measurements - the most is the run time and the shortest run time.  What remains is tabulated. <br><br>  Testing was conducted on the following data set: <br><br><ul><li>  rubrics (entity) - 323 </li><li>  characteristics of the product (attribute, attribute) - 47,229 </li><li>  commodity items - 6,989 </li><li>  values ‚Äã‚Äã(value) - 1 102 279 </li></ul><br>  Directly in the chosen category there were 41 positions and 22 characteristics. <br><br><h2>  Test results </h2><br>  The query returns one row (many selection conditions) <br><br><pre> <code class="sql hljs">WHERE mv.tiger IN ('poor', 'white', 'orange', 'red') AND mv.bowl BETWEEN 1000 AND 4000 AND mv.clock &gt; 3000 AND mv.legs &lt; 2000 AND mv.snake = 'crazy'</code> </pre><br><table><tbody><tr><th>  iteration </th><th>  SELECT </th><th>  VIEW </th><th>  TABLE </th><th>  MAT VIEW </th></tr><tr><td>  one </td><td>  61 </td><td>  53 </td><td>  22 </td><td>  20 </td></tr><tr><td>  2 </td><td>  49 </td><td>  50 </td><td>  20 </td><td>  15 </td></tr><tr><td>  3 </td><td>  50 </td><td>  49 </td><td>  20 </td><td>  14 </td></tr><tr><td>  mean time ms </td><td>  53 </td><td>  50 </td><td>  20 </td><td>  sixteen </td></tr></tbody></table><br>  The query returns multiple rows (fewer sample conditions) <br><br><pre> <code class="sql hljs">WHERE mv.tiger IN ('poor', 'white', 'orange', 'red') AND mv.bowl BETWEEN 1000 AND 4000</code> </pre><br><table><tbody><tr><th>  iteration </th><th>  SELECT </th><th>  VIEW </th><th>  TABLE </th><th>  MAT VIEW </th></tr><tr><td>  one </td><td>  92 </td><td>  70 </td><td>  31 </td><td>  nineteen </td></tr><tr><td>  2 </td><td>  63 </td><td>  56 </td><td>  nineteen </td><td>  14 </td></tr><tr><td>  3 </td><td>  54 </td><td>  54 </td><td>  22 </td><td>  18 </td></tr><tr><td>  mean time ms </td><td>  69 </td><td>  60 </td><td>  24 </td><td>  17 </td></tr></tbody></table><br>  For direct requests, these are still good results. During the testing, I changed the data set several times and the sampling time could exceed one second (1000 ms), while the sample from the materialized view took no more than 30 ms. <br>  As you can see, even if the data is stored in a table, the selection from the materialized view is faster. <br><br><h2>  Possible optimizations </h2><br><h3>  Materialized view </h3><br><div class="spoiler">  <b class="spoiler_title">Data Definition Language</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">-- CREATE MATERIALIZED VIEW : CREATE MATERIALIZED VIEW tea_mv AS SELECT ri.item_id item_id, ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'snake' ) "snake" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'tiger' ) "tiger" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'beans' ) "beans" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'sweater' ) "sweater" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'pudding' ) "pudding" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'bumper' ) "bumper" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'train' ) "train" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'alligator' ) "alligator" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'trousers' ) "trousers" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'bowl' ) "bowl" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'cabbage' ) "cabbage" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'ship' ) "ship" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'undershirt' ) "undershirt" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'simmer' ) "simmer" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'squirrel' ) "squirrel" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'ceiling' ) "ceiling" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'legs' ) "legs" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'jacket' ) "jacket" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'book' ) "book" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'stomach' ) "stomach" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'clock' ) "clock" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'furniture' ) "furniture" FROM rubric_item ri WHERE ri.rubric_id = ( SELECT id FROM rubric WHERE code = 'tea' ) ; /* [2017-12-03 14:27:34] completed in 163ms */ -- CREATE INDEX FOR MATERIALIZED VIEW : CREATE INDEX tea_mv_snake ON tea_mv ("snake"); CREATE INDEX tea_mv_tiger ON tea_mv ("tiger"); CREATE INDEX tea_mv_beans ON tea_mv ("beans"); CREATE INDEX tea_mv_sweater ON tea_mv ("sweater"); CREATE INDEX tea_mv_pudding ON tea_mv ("pudding"); CREATE INDEX tea_mv_bumper ON tea_mv ("bumper"); CREATE INDEX tea_mv_train ON tea_mv ("train"); CREATE INDEX tea_mv_alligator ON tea_mv ("alligator"); CREATE INDEX tea_mv_trousers ON tea_mv ("trousers"); CREATE INDEX tea_mv_bowl ON tea_mv ("bowl"); CREATE INDEX tea_mv_cabbage ON tea_mv ("cabbage"); CREATE INDEX tea_mv_ship ON tea_mv ("ship"); CREATE INDEX tea_mv_undershirt ON tea_mv ("undershirt"); CREATE INDEX tea_mv_simmer ON tea_mv ("simmer"); CREATE INDEX tea_mv_squirrel ON tea_mv ("squirrel"); CREATE INDEX tea_mv_ceiling ON tea_mv ("ceiling"); CREATE INDEX tea_mv_legs ON tea_mv ("legs"); CREATE INDEX tea_mv_jacket ON tea_mv ("jacket"); CREATE INDEX tea_mv_book ON tea_mv ("book"); CREATE INDEX tea_mv_stomach ON tea_mv ("stomach"); CREATE INDEX tea_mv_clock ON tea_mv ("clock"); CREATE INDEX tea_mv_furniture ON tea_mv ("furniture");</span></span></code> </pre><br></div></div><br>  The materialized view works many times faster than direct requests. <br>  When changing data, you must update the view (REFRESH MATERIALIZED VIEW). <br>  When adding an attribute (characteristic) it is necessary to re-create the view (CREATE MATERIALIZED VIEW). <br><br>  These operations take a matter of seconds.  These actions can be automated and performed without the involvement of qualified personnel. <br><br>  But if we have a million users and they constantly fill in new catalog positions (headings), but also the administration changes the list of characteristics several times an hour, this can be a problem. <br><br><h3>  Table </h3><br><div class="spoiler">  <b class="spoiler_title">Data Definition Language</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- CREATE TABLE : CREATE TABLE tea_t ( id serial not null constraint tea_pkey primary key, is_hidden integer default 0, insert_date timestamp with time zone default now(), item_id integer REFERENCES item (id), "snake" TEXT, "tiger" TEXT, "beans" TEXT, "sweater" TEXT, "pudding" TEXT, "bumper" TEXT, "train" TEXT, "alligator" TEXT, "trousers" TEXT, "bowl" DOUBLE PRECISION, "cabbage" DOUBLE PRECISION, "ship" DOUBLE PRECISION, "undershirt" DOUBLE PRECISION, "simmer" DOUBLE PRECISION, "squirrel" DOUBLE PRECISION, "ceiling" DOUBLE PRECISION, "legs" DOUBLE PRECISION, "jacket" DOUBLE PRECISION, "book" DOUBLE PRECISION, "stomach" DOUBLE PRECISION, "clock" DOUBLE PRECISION, "furniture" DOUBLE PRECISION ) ; /* [2017-12-03 14:28:24] completed in 82ms */ -- CREATE INDEX FOR TABLE : CREATE INDEX tea_t_snake ON tea_t ("snake"); CREATE INDEX tea_t_tiger ON tea_t ("tiger"); CREATE INDEX tea_t_beans ON tea_t ("beans"); CREATE INDEX tea_t_sweater ON tea_t ("sweater"); CREATE INDEX tea_t_pudding ON tea_t ("pudding"); CREATE INDEX tea_t_bumper ON tea_t ("bumper"); CREATE INDEX tea_t_train ON tea_t ("train"); CREATE INDEX tea_t_alligator ON tea_t ("alligator"); CREATE INDEX tea_t_trousers ON tea_t ("trousers"); CREATE INDEX tea_t_bowl ON tea_t ("bowl"); CREATE INDEX tea_t_cabbage ON tea_t ("cabbage"); CREATE INDEX tea_t_ship ON tea_t ("ship"); CREATE INDEX tea_t_undershirt ON tea_t ("undershirt"); CREATE INDEX tea_t_simmer ON tea_t ("simmer"); CREATE INDEX tea_t_squirrel ON tea_t ("squirrel"); CREATE INDEX tea_t_ceiling ON tea_t ("ceiling"); CREATE INDEX tea_t_legs ON tea_t ("legs"); CREATE INDEX tea_t_jacket ON tea_t ("jacket"); CREATE INDEX tea_t_book ON tea_t ("book"); CREATE INDEX tea_t_stomach ON tea_t ("stomach"); CREATE INDEX tea_t_clock ON tea_t ("clock"); CREATE INDEX tea_t_furniture ON tea_t ("furniture"); -- FILL TABLE WITH DATA : INSERT INTO tea_t (item_id,snake,tiger,beans,sweater,pudding,bumper,train,alligator,trousers,bowl,cabbage,ship,undershirt,simmer,squirrel,ceiling,legs,jacket,book,stomach,clock,furniture) SELECT ri.item_id item_id, ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'snake' ) "snake" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'tiger' ) "tiger" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'beans' ) "beans" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'sweater' ) "sweater" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'pudding' ) "pudding" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'bumper' ) "bumper" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'train' ) "train" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'alligator' ) "alligator" , ( SELECT sm.string FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN string_matter sm ON sm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'trousers' ) "trousers" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'bowl' ) "bowl" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'cabbage' ) "cabbage" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'ship' ) "ship" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'undershirt' ) "undershirt" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'simmer' ) "simmer" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'squirrel' ) "squirrel" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'ceiling' ) "ceiling" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'legs' ) "legs" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'jacket' ) "jacket" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'book' ) "book" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'stomach' ) "stomach" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'clock' ) "clock" , ( SELECT dm.digital FROM item_content ic JOIN content c ON ic.content_id = c.id JOIN property p ON c.property_id = p.id JOIN digital_matter dm ON dm.content_id = c.id WHERE ic.item_id = ri.item_id AND p.code = 'furniture' ) "furniture" FROM rubric_item ri WHERE ri.rubric_id = (SELECT id FROM rubric WHERE code = 'tea') ; /*[2017-12-03 14:30:08] 41 rows affected in 105ms*/</span></span></code> </pre><br></div></div><br>  Queries to the table as well as queries to the materialized view work many times faster than direct queries, while the query to the table will work a little slower than the query to the materialized view. <br><br>  In the tables, when changing the attribute list, the problems are the same as in the materialized view, but when the value of the characteristic changes, it is not necessary to update all the records in the table, it is enough to update only the changed rows and columns. <br><br>  If it is impossible to create a foreign key for the view, then it is possible and necessary for the table to link the position of the catalog and the entry in our table of characteristics, thereby increasing the consistency of the data.  Using the table allows you to use all the features of the tables (triggers, logging, backup). <br><br><h3>  Representation </h3><br><div class="spoiler">  <b class="spoiler_title">Data Definition Language</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> tea_v <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ri.item_id item_id, ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'snake'</span></span> ) <span class="hljs-string"><span class="hljs-string">"snake"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'tiger'</span></span> ) <span class="hljs-string"><span class="hljs-string">"tiger"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'beans'</span></span> ) <span class="hljs-string"><span class="hljs-string">"beans"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'sweater'</span></span> ) <span class="hljs-string"><span class="hljs-string">"sweater"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'pudding'</span></span> ) <span class="hljs-string"><span class="hljs-string">"pudding"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'bumper'</span></span> ) <span class="hljs-string"><span class="hljs-string">"bumper"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'train'</span></span> ) <span class="hljs-string"><span class="hljs-string">"train"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'alligator'</span></span> ) <span class="hljs-string"><span class="hljs-string">"alligator"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sm.string <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> string_matter sm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> sm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'trousers'</span></span> ) <span class="hljs-string"><span class="hljs-string">"trousers"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'bowl'</span></span> ) <span class="hljs-string"><span class="hljs-string">"bowl"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'cabbage'</span></span> ) <span class="hljs-string"><span class="hljs-string">"cabbage"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'ship'</span></span> ) <span class="hljs-string"><span class="hljs-string">"ship"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'undershirt'</span></span> ) <span class="hljs-string"><span class="hljs-string">"undershirt"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'simmer'</span></span> ) <span class="hljs-string"><span class="hljs-string">"simmer"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'squirrel'</span></span> ) <span class="hljs-string"><span class="hljs-string">"squirrel"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'ceiling'</span></span> ) <span class="hljs-string"><span class="hljs-string">"ceiling"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'legs'</span></span> ) <span class="hljs-string"><span class="hljs-string">"legs"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'jacket'</span></span> ) <span class="hljs-string"><span class="hljs-string">"jacket"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'book'</span></span> ) <span class="hljs-string"><span class="hljs-string">"book"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'stomach'</span></span> ) <span class="hljs-string"><span class="hljs-string">"stomach"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'clock'</span></span> ) <span class="hljs-string"><span class="hljs-string">"clock"</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dm.digital <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> item_content ic <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">content</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ic.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> property p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.property_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> digital_matter dm <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dm.content_id = c.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ic.item_id = ri.item_id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p.code = <span class="hljs-string"><span class="hljs-string">'furniture'</span></span> ) <span class="hljs-string"><span class="hljs-string">"furniture"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric_item ri <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ri.rubric_id = ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> rubric <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> code = <span class="hljs-string"><span class="hljs-string">'tea'</span></span> ) ;</code> </pre><br></div></div><br>  A view works a little faster than a direct request, and the use of a view reduces the number of lines of code.  If the request can easily be inflated by 1000 or more lines, then accessing the view is just one line - less data is sent between the DBMS server and the application server, less work is done to the DBMS parser. <br><br>  Changing data immediately, without additional actions, is reflected in the view. <br>  When changing the list of characteristics (attributes), you need to re-create the view. <br><br><h2>  Using EAV Model </h2><br>  For a regular online store that sells both refrigerators and auto parts, the use of EAV is more than justified, for each item you will not create a new table or an additional column in the table of characteristics.  In addition, in each rubric there are usually no more than a hundred titles, and for each rubric a separate materialized view is a good idea; to search among hundreds of other lines is faster than searching among millions of attribute lines. <br><br>  Changes in the values ‚Äã‚Äãof the characteristics occur once in a life - at the moment of adding a product item.  Changes in the list of characteristics occur with each turn of the fashion - no more than once every six months.  Adding commodity items - each delivery - no more than once a week. <br><br>  That is, we have data that is more often read and almost never change. <br>  The EAV model is a great fit for this use.  Optimization through the materialized views gives the reading speed not lower than the reading speed from ordinary tables. <br><br><h2>  Bonus </h2><br>  In the previous article, I promised to share classes for generating EAV requests.  I still haven't got a hand in writing them, but I can share a <a href="">repository in which all this is there</a> , the only thing that is not there is documentation. <br><br>  If someone undertakes to deal with this cemetery of good intentions, then contact, I will help (my contacts are indicated in the profile, it is better to write in VK). <br><br><h2>  If you want to repeat the experiment </h2><br>  For those to whom my collective testing with testing optimizations seemed dubious, I suggest testing them on their own.  All scripts for this <a href="">are laid out in the repository</a> . <br>  The sequence of actions is described in <a href="">use_case.sql</a> . <br><br>  In addition, using a bunch: <br><br><ol><li>  noun.txt </li><li>  adjective.txt </li><li>  get_pdo.php </li><li>  words_input.php </li><li>  data_generation.php </li><li>  ddl_generation.php </li></ol><br>  You can create your own data set and conduct your experiments. <br><br>  There is not a lot of code in the scripts (there are 1,000 lines per three php files), cut as you like. <br><br>  The code works under PHP 7.1 and PostgreSQL 10.1, after file processing it will work for earlier versions. <br><br><h2>  Conclusion </h2><br>  If you like, subscribe to our channel, put likes, write comments. </div><p>Source: <a href="https://habr.com/ru/post/343776/">https://habr.com/ru/post/343776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343764/index.html">The digest of interesting materials for the mobile developer # 232 (November 27-December 3)</a></li>
<li><a href="../343766/index.html">When you start a startup and find out that it is not a startup at all</a></li>
<li><a href="../343770/index.html">Lecture Yandex: Advanced UI, Part One</a></li>
<li><a href="../343772/index.html">‚ÄúI am watching you‚Äù or how to make SCADA from CADa (MultiCAD.NET API)</a></li>
<li><a href="../343774/index.html">Hole from a hosting provider or how to get access to a remote (not active) account</a></li>
<li><a href="../343778/index.html">Entity-Component-System Design Pattern - implementation and sample game</a></li>
<li><a href="../343780/index.html">Virtual Pentest Laboratory</a></li>
<li><a href="../343782/index.html">Two years of successful use of Edition-Based Redefiniton in Oracle databases</a></li>
<li><a href="../343784/index.html">C ++ crashes in WebAssembly on different browsers</a></li>
<li><a href="../343788/index.html">Patties in go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>