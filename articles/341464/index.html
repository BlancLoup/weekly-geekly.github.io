<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Infinite scrolling on Firebase</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, you will learn how to implement endless scrolling using JavaScript and Firebase, while you will not need to change anything in your e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Infinite scrolling on Firebase</h1><div class="post__text post__text-html js-mediator-article">  In this article, you will learn how to implement endless scrolling using JavaScript and Firebase, while you will not need to change anything in your existing data structure for Firebase. <br><br>  I tried to write this article in such a way that the information in it was as universal and practical as possible for any framework / library, so I hope that every step that is necessary to implement the ideas in your projects will be as clear as possible. <br><br>  Note: if the trial information does not interest you, feel free to skip to the code examples below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/7z/ja/il/7zjailca5a5ksya71ajsbfbdxvk.png"><br><a name="habracut"></a><br><h3>  Introduction </h3><br>  Before we begin, let's define the expected behavior: <br><br><ul><li>  Initial selection: returns 5 new items; </li><li>  subsequent samples: return the next 5 new items. </li></ul><br>  In addition, we need to define test data for which we will try to implement a sample from Firebase: using this approach, it will be easier for me to give you a vivid example of what is happening with requests. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    Firebase items: { firstInsertedItem: { ‚Ä¶ }, // oldest SecondInsertedItem: { ‚Ä¶ }, ThirdInsertedItem: { ‚Ä¶ }, FourthInsertedItem: { ‚Ä¶ }, FifthInsertedItem: { ‚Ä¶ }, SixthInsertedItem: { ‚Ä¶ }, SeventhInsertedItem: { ‚Ä¶ }, EighthInsertedItem: { ‚Ä¶ }, NinethInsertedItem: { ‚Ä¶ }, TenthInsertedItem: { ‚Ä¶ }, // newest } //       </span></span></code> </pre> <br><h3>  Push keys for Firebase </h3><br>  We start with the fact that I will reveal to you all the beauty of push keys for Firebase, and also tell you about how with their help we implement our idea. <br><br>  Firebase push keys are not just a collection of random characters.  It turns out that the <a href="https://firebase.googleblog.com/2015/02/the-2120-ways-to-ensure-unique_68.html">push keys firebase</a> consist of a combination of timestamps and random data encoded in the modified base64 alphabet to preserve their chronological order (that is, the order in which they are inserted). <br><br>  This indispensable feature will allow us to sort Firebase requests. <br><br>  Now go to the direct development. <br><br><h3>  First step </h3><br>  In order for all our samples, following the very first sample, to return exactly the data they need to return, we will need to create some reference for the key that was chosen before everyone else. <br><br>  Let's define a variable as follows: <br><br><pre> <code class="cpp hljs">let referenceToOldestKey = <span class="hljs-string"><span class="hljs-string">'';</span></span></code> </pre> <br><h3>  Original sample </h3><br>  The next step is to create a query for a selection of the first 5 nested items: <br><br><pre> <code class="javascript hljs">firebase.database().ref(<span class="hljs-string"><span class="hljs-string">'items'</span></span>) .orderByKey() .limitToLast(<span class="hljs-number"><span class="hljs-number">5</span></span>) .once(<span class="hljs-string"><span class="hljs-string">'value'</span></span>) .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">snapshot</span></span></span><span class="hljs-function">) =&gt;</span></span> { ‚Ä¶ } ) .catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { ‚Ä¶ } );</code> </pre> <br>  This query performs the following actions: <br><br><ul><li>  <b>orderByKey</b> sorts the items by their keys in chronological order (from last to first); </li><li>  <b>limitToLast</b> selects the 5 most recent items (starting from the 5th item). </li></ul><br>  The result will look like this: <br><br><pre> <code class="cpp hljs">{ SixthItemFromTheEnd: { ‚Ä¶ }, SeventhItemFromTheEnd: { ‚Ä¶ }, EighthInsertedItem: { ‚Ä¶ }, NinethInsertedItem: { ‚Ä¶ }, TenthInsertedItem: { ‚Ä¶ }, }</code> </pre> <br>  Then we need to change the order of the elements for the result: the last element should have been on top, not below. <br><br>  There are several options for this purpose, depending on how you will manage the state of your application: <br><br><ul><li>  Change the order of the elements for the result; </li><li>  convert the object (the result) into an array of objects, and then change the array itself; </li><li>  do not modify the object, but make its shallow copy and change the latter when displayed to the user. </li></ul><br>  We will choose the second option, since it is the most common method for storing this kind of data. <br><br>  Add the following piece of code in .then for our fetch function: <br><br><pre> <code class="cpp hljs">let arrayOfkeys = Object.keys(snapshot.val()); let results = arrayOfkeys .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(key =&gt; snapshot.val()[key]) .reverse();</code> </pre> <br>  Next, we need to initialize our link, starting with the most recent of the 5 keys, so that when the user scrolls down the page, our next sample function will recognize the element required for scrolling. <br><br><pre> <code class="cpp hljs">referenceToOldestKey = arrayOfkeys[<span class="hljs-number"><span class="hljs-number">0</span></span>];</code> </pre> <br>  (The most recent key is in position [0], because <b>limitToLast</b> returns the elements in chronological order.) <br><br>  So, we are done with the first sample. <br><br><h3>  Next sample </h3><br>  Now let's make it so that when the user scrolls to the end of the page, the selection for the first 5 elements is activated.  For this we will write the following query: <br><br><pre> <code class="cpp hljs">firebase.database().ref(<span class="hljs-string"><span class="hljs-string">'items'</span></span>) .orderByKey() .endAt(referenceToOldestKey) .limitToLast(<span class="hljs-number"><span class="hljs-number">6</span></span>) .once(<span class="hljs-string"><span class="hljs-string">'value'</span></span>) .then((snapshot) =&gt; { ‚Ä¶ } ) .<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>((error) =&gt; { ‚Ä¶ } );</code> </pre> <br>  This query does the following: <br><br><ul><li>  <b>orderByKey</b> sorts the items by their keys in chronological order (from last to first); </li><li>  <b>endAt</b> selects all elements, starting with the 1st element, which was added to our original variable (including); </li><li>  <b>limitToLast</b> selects 6 items from the end (starting from the 6th). </li></ul><br>  The result will be as follows: <br><br><pre> <code class="cpp hljs">{ firstInsertedItem: { ‚Ä¶ }, SecondInsertedItem: { ‚Ä¶ }, ThirdInsertedItem: { ‚Ä¶ }, FourthInsertedItem: { ‚Ä¶ }, FifthInsertedItem: { ‚Ä¶ }, SixthInsertedItem: { ‚Ä¶ }, }</code> </pre> <br><ul><li>  Hmm ... why are we limited to 6 last elements, and not 5, as is the case with the first sample? </li></ul><br>  Since the <b>endAt</b> method is inclusive, i.e.  our source key is included in the returned object (or in the result).  Thus, if we were limited to only 5 elements, then we would be able to use only 4 new elements: 1 would be a duplicate.  You need to make a request for 6 items, and then delete the 6th item on the client side. <br><br>  Now that we have figured out how the request works, we need to cancel the returned object and remove the duplicate. <br><br><pre> <code class="cpp hljs">let arrayOfkeys = Object.keys(snapshot.val()); let results = arrayOfkeys .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(key =&gt; snapshot.val()[key]) .reverse() .slice(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Why <b>slice (1)</b> ?  After reverse (), our copy moves from the last position to the first.  How to understand that the copy was in the last position?  All keys are returned in chronological order. <br><br>  Finally, for the link, we need to write the value of the last key from the current selection. <br><br><pre> <code class="cpp hljs">referenceToOldestKey = arrayOfkeys[<span class="hljs-number"><span class="hljs-number">0</span></span>];</code> </pre> <br>  Thus, everything necessary for the subsequent sampling is done. <br><br>  This concludes my brief guide.  Thanks to all who read for your attention, and I really hope that you have learned something new for yourself from my article.  Below is the complete code example. <br><br><h3>  Full code example </h3><br>  Note: duplicating the code inside <b>.then</b> for both requests has been shown here for better code perception.  So, to find the desired fragment, you do not need to study the entire code, as, for example, in the case of placing the code in a separate function. <br><br><pre> <code class="cpp hljs">let referenceToOldestKey = <span class="hljs-string"><span class="hljs-string">''; if (!referenceToOldestKey) { firebase.database().ref('</span></span>items') .orderByKey() .limitToLast(<span class="hljs-number"><span class="hljs-number">5</span></span>) .once(<span class="hljs-string"><span class="hljs-string">'value'</span></span>) .then((snapshot) =&gt; { let arrayOfkeys = Object.keys(snapshot.val()); let results = arrayOfKeys .<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>(key =&gt; snapshot.val()[key]) .reverse(); <span class="hljs-comment"><span class="hljs-comment">//   referenceToOldestKey = arrayOfkeys[0]; //    ,  //    ({ ‚Ä¶ })   redux }) .catch((error) =&gt; { ‚Ä¶ } ); } else {  firebase.database().ref('items') .orderByKey() .endAt(oldestKeyReference) .limitToLast(6) .once('value') .then((snapshot) =&gt; { let arrayOfkeys = Object.keys(snapshot.val()); //    &amp; //   //   &amp; let results = arrayOfkeys .map(key =&gt; snapshot.val()[key]) .reverse() .slice(1); //   referenceToOldestKey = arrayOfkeys[0]; //    ,  //    ({ ‚Ä¶ })   redux }) .catch((error) =&gt; { ‚Ä¶ } );  }</span></span></code> </pre> <br>  I really hope that this article was not a waste of time for you, and you found in it something useful for yourself! <br><br>  - Best promotion service on reddit, bitcointalk and medium: <a href="http://reddit-marketing.pro/">reddit-marketing.pro</a> </div><p>Source: <a href="https://habr.com/ru/post/341464/">https://habr.com/ru/post/341464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341454/index.html">Welcome to the YAPC :: Russia conference on November 4</a></li>
<li><a href="../341456/index.html">Bitcoin hardware wallets</a></li>
<li><a href="../341458/index.html">GitLab 10.1 released: commenting on images and blocking unsigned commits</a></li>
<li><a href="../341460/index.html">The functional architecture is ports and adapters.</a></li>
<li><a href="../341462/index.html">What is silent post-mortem: the unknown story of the creation of Gothic 3</a></li>
<li><a href="../341466/index.html">Create your own blockchain on Ethereum</a></li>
<li><a href="../341468/index.html">23 questions for a support candidate</a></li>
<li><a href="../341470/index.html">Deep calculation. How do 3D technologies help people to count and make life easier?</a></li>
<li><a href="../341474/index.html">Digital Friday 2017 - sale of online services for businesses</a></li>
<li><a href="../341476/index.html">We are not waiting, but we are preparing for the transition to new standards of cryptographic protection of information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>