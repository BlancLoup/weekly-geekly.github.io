<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sensors and microcontrollers. Part 1. The materiel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the era of ready-made debug boards and thousands of ready-made modules for them, where it is enough to take a couple of blocks, connect them togeth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sensors and microcontrollers. Part 1. The materiel</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/8ec/cd7/6ee/8eccd76eecd94623b8a36cee3ad1d084.jpg">  In the era of ready-made debug boards and thousands of ready-made modules for them, where it is enough to take a couple of blocks, connect them together, and get the desired result, not everyone understands the basics of circuitry, why and how it works, and most importantly - what to do if it works not this way. <br><div class="spoiler">  <b class="spoiler_title">The circuitry hub has just opened, so, as Beauford Mad Dog Tannen said</b> <div class="spoiler_text">  The court building is already being built, so it's time to hang someone. <br></div></div><br>  In this cycle I will talk about sensors - as an important element of the control system of a certain object or those.  process. <br><br>  I will lead all my narration on the practical issues of implementing digital control systems based on microcontrollers. <br><br>  The manual does not claim to be a universal question. <br>  Although after my abstract climbed over 20 pages of text, I decided to split the article into the following parts: <br><ul><li>  <b>Part 1. Mat.</b>  <b>part.</b>  In it, we will consider a sensor that is not tied to any particular measured parameter.  Consider the transfer function and the dynamic characteristics of the sensor, let's deal with its possible connections. </li><li>  <b><a href="http://habrahabr.ru/post/259203/">Part 2. Climate control sensors</a> .</b>  In it, I will consider the features of working with sensors of temperature, humidity, pressure and gas composition </li><li>  <a href="http://habrahabr.ru/post/260639/"><b>Part 3. Sensors of electrical quantities.</b></a>  In it, I touch the measurement of current and voltage </li></ul><br><a name="habracut"></a><br><h4>  <b>Introduction</b> </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/XScxCvM_910%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgQzR8Nfr9qWeUymKP1TS06hkhi4Q" frameborder="0" allowfullscreen=""></iframe><br>  In the control system of a technological installation, the reading of the current readings of a certain value ‚Äî temperature, humidity, pressure, liquid level, voltage, current, etc.  It is carried out with the help of sensors - devices and mechanisms designed to convert the external influence signal into a form that is understandable to the control system.  For example, a humidity sensor generates an electrical signal proportional to the current value of air humidity. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a rule, sensors are not used by themselves, but are part of the control system, providing a feedback signal. <br><img src="https://habrastorage.org/files/799/931/ea1/799931ea175c4415ae99535edcd2f005.jpg"><br>  <i>Figure 1. Typical scheme of a closed control system</i> <br>  Figure 1 shows a typical scheme of the regulatory system.  There is a reference signal <i>Xz</i> , which is compared with the output signal obtained by means of a sensor having a transfer function <i>Wd (p)</i> .  The control error is fed to the regulator, which, in turn, generates a control signal of the actuating unit, which forms the output signal <i>Y.</i> [1] <br><br>  A simple example is a centrifugal engine speed regulator, where the sensor is a platform with balls, which, rotating, sets one or another position of the fuel rail.  The valve, controlled by this rail, regulates the amount of fuel supplied to the engine.  The target signal will be the required speed value. <br><br><h4>  <b>1.1 Sensor classification</b> </h4><br>  Sensor classification is very diverse.  I will give only a part of it based on [4]. <br>  All sensors are divided into two main classes: <br><ul><li>  Passive, which do not need an external source of electricity, and in response to the input action generate an electrical signal.  Examples of such sensors are thermocouples, photodiodes, and piezoelectric sensing elements. </li><li>  Active, which require for their work an external signal, called the excitation signal.  Since such sensors change their characteristics in response to changes in external signals, they are called parametric.  Examples of active sensors are thermistors, the resistance of which can be calculated by passing an electric current through them. </li></ul><br><blockquote>  It should be noted that the alternative classification is also found in the literature, when the generator sensors are defined as Active, and Parametric Sensors - as Passive.  Hereinafter I am guided by the option according to the Fariden reference book. </blockquote><br><br>  Another important criterion for us is the choice of data reference point.  Thus, sensors are <br><ul><li>  Absolute, the measured value of a physical quantity which does not depend on the measurement conditions and the external environment. </li><li>  Relative, when the output signal of such a sensor in each case is interpreted differently. </li></ul><br>  A striking example is again a thermistor, whose resistance directly depends only on the temperature of the object being measured, and a thermocouple, the output voltage of which depends on the temperature difference between the hot and cold ends. <br><br>  In the development of electronic equipment, an important factor in the characteristics of the sensor is also the nature of the output signal. <br><ul><li>  The analog sensors at the output have a continuous output signal, for which removal it is necessary to use an analog-to-digital converter, after which it is necessary to convert the ADC value into the format of the measured value. </li><li>  Digital sensors, information from which is removed using various digital interfaces.  As a rule, information is available directly in the format of the measured value and does not require additional transformations. </li><li> Discrete sensors that have only two options for the signal at the output of the sensor channel - log 0. and log.  1. An example of such a sensor is a limit switch having closed and open states.  A discrete sensor can have several output channels, each of which is in one of two states.  For example, a 12-bit absolute position sensor. </li><li>  Pulse sensors that generate output signal pulses, the amplitude or duration of which depends on the measured value.  For example, an incremental position sensor generates a Gray code at the output.  At the same time, the higher the shaft rotation speed of the sensor, the higher the signal frequency will be at the output, which will allow determining the shaft rotation speed with high accuracy. </li></ul><br><br><h4>  <b>2 Sensor Characteristics</b> </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Xt3bCA9Qqow%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhuiEOUNjNr7PPpwnhfzZ14jMp4PA" frameborder="0" allowfullscreen=""></iframe><br><br>  Most sensors have a complex procedure for converting the measured value into an electrical signal.  For example, in a strain gauge pressure sensor, the measured value acts on the sensitive element, changing its resistance.  After applying the excitation signal, the voltage drop across the resistor will allow you to indirectly determine its resistance and, based on the dependence of the resistance on pressure, calculate the measured value. <br><br>  For a developer, a sensor is a black box with known signal ratios between inputs and outputs. <br><br><h5>  <b>2.1 Range of measured and output values</b> </h5><br>  <b>The range of measured values</b> indicates what the maximum value of the input signal can be converted by the sensor into an output electrical signal, without going beyond the limits of the established errors.  These figures are always given in the specification for the sensor, at the same time displaying the possible accuracy of measurements in one or another range. <br><br>  It should be understood that some sensors, when the input signal exceeds the maximum values, will simply become saturated and will return incorrect data.  Other sensors (for example, temperature sensors) can fail.  In the future, for each type of sensor will be given their recommendations. <br><br>  <b>The range of output values ‚Äã‚Äãof the sensor</b> is the minimum and maximum voltage that the sensor is able to produce at the minimum and maximum external exposure.  Since we consider sensors that convert an input signal into an electrical one, the range of output values ‚Äã‚Äãof the sensor will be determined by the voltage it produces, or the current passing through it.  One of our tasks when connecting a sensor will be to match the output range of the sensor with the input range of the measuring path. <br><br><h5>  <b>2.2 Transfer function - static and dynamic characteristics</b> </h5><br>  When working with the sensor is required to know the ratio of the levels of the signals at the input and output.  The ratio Wd (p) = Y (p) / X (p) in an operator form is the transfer function of the sensor and uniquely determines the characteristics of the sensor in statics and dynamics. <br><br>  The equation Y (p) = Wd (p) * X (p) in the real plane, i.e.  the function Y = f (x) will be a static characteristic <br>  The static characteristic can be linear and will be defined as: <br><img src="https://habrastorage.org/files/43f/f79/2b1/43ff792b1a0e49328bb3dff4700e36c3.jpg">  (one) <br>  Where a is the slope of the straight line determined by the sensitivity of the sensor and b is the constant component (that is, the output signal level when there is no signal at the input) <br><br><img src="https://habrastorage.org/files/b3c/0ea/ce2/b3c0eace28eb4c9faa2304062fabaaf1.jpg"><br>  <i>Figure 2. Linear dependence</i> <br><br>  In addition to sensors with linear dependence, there may be sensors with a logarithmic dependence, with an equation of the form <br><img src="https://habrastorage.org/files/205/e00/3ba/205e003ba5664bfab39523a55ab1f3a7.jpg">  (2) <br>  Exponential: <br><img src="https://habrastorage.org/files/e21/c84/5cf/e21c845cf56240c186ef2caa04fe3f90.jpg">  (3) <br>  Or power: <br><img src="https://habrastorage.org/files/b89/309/12c/b8930912cf3a4cf08bbd840ec18a28f1.jpg">  (four) <br>  Where <i>k</i> is a constant number. <br>  There are sensors with more complex characteristics.  But there is documentation. <br><br>  However, the transfer function also reveals what properties the sensor has in dynamics, i.e., how quickly and precisely the sensor performs the output signal when the input value changes rapidly.  Practically every real sensor has an energy storage device in itself - a capacitor, a mass, etc. Consider the sensor behavior, the dynamic characteristics of which are described by a first order equation: <br><br><img src="https://habrastorage.org/files/baa/3bd/554/baa3bd5548c74ee7aa61053cd1797000.jpg">  (five) <br>  In the theory of automatic control, there are two test input signals.  This is a single function ‚Äî the feed at zero time is one, and the delta function is a feed of a signal of infinite amplitude and infinitely small duration. <br><br><img src="https://habrastorage.org/files/a4b/9aa/074/a4b9aa0741d84b49bc0ee1118cae9046.jpg"><br>  <i>Figure 3. Single and delta functions</i> <br><br>  Inertia-free, I mean the ideal sensor will exactly repeat the input signal form.  The real sensor described by the formula (5) will give the following reaction: <br><br><img src="https://habrastorage.org/files/72b/fd0/ce6/72bfd0ce6f2c46e79d27e0c3c122b9d7.jpg"><br>  <i>Figure 4. Reaction of the first-order aperiodic link to test signals</i> <br><br>  It should be noted that the value at the output of the sensor will correspond to that supplied at the input only after the completion of the transition process, which will last 3-4 <i>œÑ</i> , where <i>œÑ</i> is the time constant of our link.  When <i>t = 1œÑ</i> , the output value will reach <br><img src="https://habrastorage.org/files/434/f74/612/434f74612bb94e99bd6df1dbd1240445.jpg"><br>  It is easy to calculate that at <i>t = 2œÑ the</i> output value will be 86%, and at <i>t = 3œÑ</i> - 95% and the transition process will be considered complete. <br><br>  Thus, it should be understood that, for example, the same temperature sensor will react to a change in the ambient temperature with some delay due to the fact that there is a housing between the sensor and the environment, which must absorb heat and heat.  It takes time. <br><br>  Of course, inertial sensors can be described by more complex equations, for example, they can be second-order aperiodic units, have a reaction delay, etc. The behavior of such units is described in detail in [1]. <br><br><h5>  <b>2.3 Accuracy, nonlinearity</b> </h5><br>  One of the important characteristics of the sensor is its <b>accuracy</b> in the range of measured values.  The output signal of the sensor corresponds to the value of the measured value with some certainty, called the error. <br><br>  For example, a temperature sensor has an accuracy of ¬± 2 degrees.  This means that at a real temperature of the object being measured at 100 degrees, the permissible readings of this temperature sensor are in the range of 98 to 102 degrees. <br>  Sensor error is different. <br><br>  There are additive and multiplicative error. <br><br>  The additive error is constant over the entire measurement range. <br><img src="https://habrastorage.org/files/2aa/b4b/8c7/2aab4b8c78bf4c0f9ca587826c8198b8.jpg"><br>  <i>Figure 5. Additive error</i> <br><br>  Multiplicative linearly depends on the level of the measured value: <br><img src="https://habrastorage.org/files/d40/b65/4c2/d40b654c2eec48119c90fc860b539c60.jpg"><br>  <i>Figure 6. Multiplicative error</i> <br><br>  In addition, there is a non-linearity of the sensor in the measured range.  Depending on the current measurement range, the slope of the transfer function varies within certain limits.  In this case, the specification indicates either the curves of variation of accuracy over the range, or the worst indicators of nonlinearity in one or another range. <br><br><img src="https://habrastorage.org/files/279/2dd/c3b/2792ddc3bd834181b3ff403ce0957d20.jpg"><br>  <i>Figure 7. Sensor nonlinearity</i> <br><br>  In addition, some sensors have a hysteresis effect, when for the same input signal, after increasing and decreasing, the output signal values ‚Äã‚Äãare different.  A typical cause of hysteresis is friction and structural changes in materials.  Sensors based on ferromagnetic materials are subject to the greatest hysteresis effect. <br><br>  To improve the accuracy and compensation of additive and multiplicative error, the sensor calibration process can be performed.  For example, for a linear sensor, it is necessary to determine the readings at two points at different ends of the operating range with a known accuracy.  For some sensors, calibration data may be provided in the passport for each specific instance.  For the calibration procedure, you can use more accurate equipment, you can use the standard (for example, black body, reference kilogram, etc.).  Accuracy after calibration naturally will not exceed the accuracy of the standard. <br><br><h5>  <b>2.4 Sensor sensitivity, resolution and dead zone</b> </h5><br>  <b>The</b> sensor <b>dead zone is the</b> sensor insensitivity in a certain range of input signals.  Within this zone, the output readings are incorrect. <br><br>  For example, in Figure 2, the output value for all values ‚Äã‚Äãfrom 0 to x0 is not defined.  For example, some current sensors that have zero voltage at the output at currents lower than, for example, 10 mA, sin with this feature. <br><br>  In the rest of the range, there is a certain <b>sensitivity of the</b> sensor, i.e., how strong is the increase in the output signal for a change in the input signal.  that is, sensitivity is defined by the following formula: <br><img src="https://habrastorage.org/files/f5d/454/17f/f5d45417f76c40fc847efe871a812bab.jpg"><br>  For a linear sensor, the sensitivity will be constant over the entire measured range. <br><br>  <b>The resolution</b> shows how small a change in the measured value can cause a change in the output signal.  For example, some incremental position sensor has a resolution of 1 degree.  Analog sensors have an infinitely large resolution, since in their output signal it is impossible to determine the individual steps of its change. <br><br><h4>  <b>3 Sensor connection method</b> </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/VmUgFbvan-A%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhRzt7fD3gsO6NyDemlMyMqGKzn5A" frameborder="0" allowfullscreen=""></iframe><br>  Depending on the type of sensor, it is connected to the measuring path in different ways. <br><br><h5>  <b>Connection of the passive sensor</b> </h5><br>  Since the passive sensor without any help in response to an external effect independently produces an electrical signal for us, we need to consider this signal. <br>  Depending on whether our sensor is a current source or voltage source, the connection method will differ. <br><br>  For example, a thermocouple is a voltage source - the voltage at the output does not depend on the magnitude of the output current (within reasonable limits of course).  Our task is to measure the EMF produced.  Since the measuring path will have some final resistance, the wiring diagram will be as follows: <br><img src="https://habrastorage.org/files/4aa/4f2/d14/4aa4f2d14f00451f92542c579283459b.jpg"><br>  <i>Figure 8. Connecting the voltage source to the ADC</i> <br><br>  If <i>Radc</i> is much greater than the internal resistance <i>r</i> , then the voltage drop across it will tend to zero and the voltage at the ADC input will tend to the value of the EMF. <br>  In the second part, I will consider in detail the thermocouple, as one of the most accurate and fast sensors. <br>  Another case is if our sensor is a current source, that is, the voltage it generates depends on the current passed through the load. <br><br>  Connecting the sensor is similar: <br><img src="https://habrastorage.org/files/28c/82e/b42/28c82eb4244f450da8d77373e38477fb.jpg"><br>  <i>Figure 9. Connecting the current source to the ADC</i> <br>  However, the load resistance of the current source should now tend to zero.  For this, the sensor is shunted by a resistor of the necessary resistance, thereby turning the current source into a voltage source: <br><img src="https://habrastorage.org/files/8c4/4cc/c20/8c44ccc20faa4b9e921f6921cb5a4b11.jpg"><br>  <i>Figure 10. Proper connection of the current source to the ADC</i> <br><br>  The resistance of resistor <i>R is</i> calculated as the quotient by dividing the maximum voltage applied to the ADC input by the maximum current that the sensor is able to output <br><img src="https://habrastorage.org/files/5f8/4f1/96c/5f84f196cf04430b9034c902bd20d363.jpg"><br>  The most vivid image of such a sensor is a current sensor. <br><blockquote>  ATTENTION: sensors that have a replacement circuit in the form of a current source should always be shunted by resistance and not be allowed to break the shunting circuit in the presence of an arbitrarily small input.  Otherwise, the same current sensor generates voltages in kilovolts at the free terminals of the secondary winding before the breakdown of the measurement circuit or the sensor itself.  Modern current sensors are tested at a voltage of 1kV or more, so getting 2-3 kV at the output, and getting into them with your finger is not the most difficult task. </blockquote><br><br><h5>  <b>Active sensor connection</b> </h5><br>  Consider active sensors, which are variable resistance.  In particular, these are thermistors, strain gauges and other similar sensors.  To measure the resistance of the sensor, it must be connected to a current source and determine the voltage drop across it: <br><br><img src="https://habrastorage.org/files/247/3a7/529/2473a75291bb45b389ac1ad067a7cc56.jpg"><br>  <i>Figure 11. Connecting the sensor to an unregulated current source</i> <br><br>  The current source produces a constant current of a known value.  Then, the output voltage will be determined by the formula: <br><img src="https://habrastorage.org/files/6c9/de6/5bd/6c9de65bd56543049d33d60ee7b95e14.jpg">  (7) <br><br>  For example, we calculate the output voltage value at a current source of 10 mA if our sensor changes the resistance from 0.1 kŒ© to 1 kŒ©.  Then the maximum output voltage will be equal to <br><img src="https://habrastorage.org/files/5af/c04/ef5/5afc04ef56ec493b9bef6f14e2245072.jpg">  (eight) <br>  That quite corresponds to the required value of voltage for an analog control system based on operational amplifiers. <br><br>  Where to get the current source?  It so happens that it is built into the microcontroller itself.  For example, in the ADuCM360 / 361 microcontrollers there are two embedded current sources of 0.01-1 mA.  It is true there they have a diagnostic task - applying a small current through the sensor circuit can be convinced of its presence and serviceability. <br><br>  Of course, we are used to using a voltage source with a divider: <br><img src="https://habrastorage.org/files/18c/d50/144/18cd50144cf242229d05aadc904d8fa3.jpg"><br>  <i>Figure 12. Connecting the sensor to a voltage source with a divider</i> <br><br>  Speaking of purity, the U-R1 chain forms the same current source, only its parameters depend on the load - <i>Rd</i> .  The output voltage will be determined by the following formula: <br><br><img src="https://habrastorage.org/files/3da/d56/f72/3dad56f7209040ebbf3b93bd0740b77b.jpg">  (9) <br><br>  And here the main problem of this method comes up - you can‚Äôt get rid of the resistance of our sensor in the denominator and the readings become non-linear, unlike, by the way, the first option. <br><br>  The question is - what should be the resistance of <i>R1</i> ?  It should provide the maximum output voltage range.  i.e. with known values ‚Äã‚Äãof the minimum and maximum resistance of the sensor <i>Rd1</i> and <i>Rd2</i> , <i>abs (Uout1 - Uout2) -&gt; max</i> <br><br>  On the other hand, the maximum output voltage we have is limited to the input circuits of the measuring device.  For example, the input of a microcontroller with 5V power supply must be energized, for example, no more than 2.5V.  I note that if the maximum possible voltage applied to the ADC input is less than the supply voltage, then we will be able to feed it there. <br><br>  If our sensor changes the resistance from 0.1 kŒ© to 1 kŒ©, then we take the resistance of resistor R1 equal to the upper limit of the sensor resistance.  Then Uout can vary from 1 / 11Uin to 1 / 2Uin.  In absolute figures of this example - from 0.45 to 2.5V.  And we use such values ‚Äã‚Äã(2.5-0.45) / 2.5 = 82% of the entire ADC range, which is pretty good. <br><br>  Another sensor can be plugged into the measuring bridge and measure the voltage difference in its shoulders: <br><br><img src="https://habrastorage.org/files/a66/f1b/c78/a66f1bc78f7d4e6fad87fabcf349fc65.jpg"><br>  <i>Figure 13. Sensor in the measuring bridge</i> <br>  In this case, we work with a differential ADC, measuring the potential difference <i>Uab</i> .  It will be equal to: <br><img src="https://habrastorage.org/files/cc9/b9b/f67/cc9b9bf67a7b4ed89e322e861caf3cb9.jpg">  (ten) <br><br>  Moreover, the resistance of the resistor <i>R1</i> may be such that <i>Uab</i> could be negative.  There are sensors, the internal scheme of which is already a balanced bridge with the necessary characteristics.  Later I will look at examples of such sensors. <br><br>  There are more convenient to use sensors.  They give the necessary analog signal and without dancing with resistors.  For example, the analog humidity sensor HIH-4010-004 is a three-output case, 5V power supply, line output.  This miracle connects like this: <br><br><img src="https://habrastorage.org/files/9df/29e/66e/9df29e66e6c7419dad5ebe7268896d6c.jpg"><br>  <i>Figure 14. Connection of the HIH-4010-004 humidity sensor</i> <br><br>  Two wires to the reference voltage source, output - to the ADC of the microcontroller. <br><br><h5>  <b>Connection of digital sensors according to the standard 1-Wire</b> </h5><br>  1-Wire is a bidirectional low-speed digital data bus that requires only two wires - data wire and ground.  The bus is quite simple to use, it supports parasitic powering of devices from the line and allows you to connect in parallel many devices of the same type, like temperature sensors (all your favorite DS18B20), or identification chips (iButton). <br>  Parasitic nutrition is organized as follows: <br><br><img src="https://habrastorage.org/files/fa8/428/d11/fa8428d11ea14727a33e9d3f2791000d.jpg"><br>  <i>Figure 15. Parasitic powering of 1-Wire bus devices</i> <br><br>  And this is the usual active power supply of the device, when it‚Äôs close to the source. <br><img src="https://habrastorage.org/files/63e/ef4/89a/63eef489a21e46419bb1e561c2fedde9.jpg"><br>  <i>Figure 16. Powering a 1-Wire device from an external source</i> <br><br>  The number of sensors connected in parallel is actually limited only by the line parameters. <br>  Perhaps hot plug and identification on the go.  Moreover, the computational complexity of the identification algorithm <i>O (log n)</i> <br><br>  In more detail with this protocol we will work in the second part. <br>  In the meantime, about the protocol itself can be read on the classic link: <a href="http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf">http://datasheets.maximintegrated.com/en/ds/DS18B20.pdf</a> <br><br><h5>  <b>Connection of digital sensors according to I2C (Twi) / SMBus standard</b> </h5><br>  If 1-Wire required one data wire, then this bus, according to the name Two-Wire Bus - two. <br>  One of the wires - SCL will be clocking, on the second - SDA, half duplex data will be transmitted. <br>  An open collector tire, therefore both lines need to be pulled to power.  The sensor will connect as follows: <br><br><img src="https://habrastorage.org/files/648/dbc/5ae/648dbc5ae8f9469db11deac22fdc9825.jpg"><br>  <i>Figure 17. Sensor connection via I2C</i> <br><br>  The total number of devices that can be connected to the I2C bus is 112 devices with 7-bit addressing.  Each device is actually allocated two consecutive addresses, the least significant bit is set to read or write.  There is a strict tire capacity requirement - no more than 400pF. <br><br>  Commonly used speeds are 100 kbps and 10 kbps, although the latest standards allow speeds of 400 kbps and 3.4 mbps. <br><br>  The bus can work as with an irremovable master, there and with the transfer of the flag. <br>  A huge amount of information on the protocol can be found at this link: <a href="http://www.esacademy.com/en/library/technical-articles-and-documents/miscellaneous/i2c-bus.html">http://www.esacademy.com/en/library/technical-articles-and-documents/miscellaneous/i2c-bus.html</a> <br><br><h5>  <b>SPI Digital Sensor Connection</b> </h5><br>  Requires at least three wires, works in full duplex mode - i.e.  organizes simultaneous data transfer in both directions. <br>  Communication lines: <br><ul><li>  CLK is the clock line. </li><li>  MOSI - master output, slave input </li><li>  MISO - master input, slave exit </li><li>  CS - chip selection (optional). </li></ul><br>  One of the devices is chosen by the master.  It will be responsible for clocking the bus.  Connection is made in a cross way: <br><br><img src="https://habrastorage.org/files/0d8/52b/ea1/0d852bea1f8f40c1adfd69390167274b.jpg"><br>  <i>Figure 18. SPI connection and the essence of the transfer</i> <br><br>  Each device in the chain contains its own shift register data.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the help of clocking signals, after 8 clocks, the contents of the registers change places, thereby carrying out data exchange. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI - The fastest data transmission interface presented. Depending on the maximum possible clocking frequency, the data transfer rate can be 20, 40, 75 Mb / s and higher. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The SPI bus allows you to connect devices in parallel, but here a problem arises - each device requires its own CS line to the processor. This limits the total number of devices on a single interface. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main difficulty in configuring SPI is to set the clocking signal polarity.</font></font> Seriously.  SPI  ,   . <br><br>     SPI     SPI  AVR  MSP430    <a href="http://www.gaw.ru/html.cgi/txt/interface/spi/index.htm">http://www.gaw.ru/html.cgi/txt/interface/spi/index.htm</a> <br><h4> <b>4    </b> </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OqWNx2eBDuQ%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhTkAg1CkRj_tk6PMgSUWV_ixEPqA" frameborder="0" allowfullscreen=""></iframe><br>         - . <br><br>              .  ,   ,   ,    ,     ,     . <br><br>  ,       ‚Äî       .          : <br><img src="https://habrastorage.org/files/7c4/010/4da/7c40104da1644296b83573864b04589c.jpg"><br> <i> 19.     </i> <br><br>        : <br> <b> 1.</b>   , , . <br>    ,      ‚Äî        ,   .       ‚Äî  . <br><br>       : <br><pre><code class="cpp hljs">Sensor.Start();<span class="hljs-comment"><span class="hljs-comment">//   delay(MINIMAL_SENSOR_DELAY_TIME);//   int var = Sensor.Read();// </span></span></code> </pre> <br>  <b>Option 2</b> .  they started the measurement mode, returned to other tasks, after a while the interruption worked, the data was counted. <br>  One of the best options.  But the most difficult: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ TimerIsr.Setup(MINIMAL_SENSOR_DELAY_TIME);<span class="hljs-comment"><span class="hljs-comment">//       int mode = START;//  Sensor.Start();//      } TimerIsr.Vector(){//    if (mode == START{ mode = READ; var = Sensor.Read();//     ,   } else { mode = START; Sensor.Start();///      ,     } }</span></span></code> </pre><br>  Looks good.  allows you to vary the time between measurement cycles and read cycles.  for example, the gas composition sensor should have time to cool down after previous measurements, or to have time to heat up during measurements.  These are different periods of time. <br><br>  <b>Option 3:</b> Read the data, launched a new round. <br>  If the sensor allows you to start a new measurement cycle after reading the data, then why not - we will do the opposite. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ TimerIsr.Setup(MINIMAL_SENSOR_DELAY_TIME);<span class="hljs-comment"><span class="hljs-comment">//       Sensor.Start();//      } TimerIsr.Vector(){//    var = Sensor.Read();//  Sensor.Start();///   </span></span></code> </pre><br><br>  A great way to save time.  and you know what - this method works fine without interruption.  Digital sensors store the calculated value until the power is turned off. And given the fact that it is often not necessary to read signals from the humidity sensor due to its inertia of 15 seconds, you can do this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Sensor.Start();<span class="hljs-comment"><span class="hljs-comment">//      while(1){ //    var = Sensor.Read();//  Sensor.Start();///    } }</span></span></code> </pre><br>  It may also be such an option that our sensor independently launches a new measurement cycle and then, using an external interrupt, it reports the completion of measurements.  For example, the ADC can be configured to automatically read data at a frequency of N Hz.  On the one hand, in the interrupt handler, it will be sufficient to implement only the process of reading new data.  On the other hand, it is possible to use the ADC interrupt with the Direct Memory Access mode (DMA).  In this case, at the interrupt signal, the peripheral ADC module at the hardware level will independently copy data into a specific memory cell into RAM, thereby ensuring maximum data processing speed and minimal impact on the work program (no need to go into the interrupt, call the handler, etc.). <br><br>  But using DMA is far beyond the scope of this cycle. <br><br>  Unfortunately, the first method is universally used in libraries and examples for Arduino, it does not allow this platform to properly use the resources of the microcontroller.  But it is easier to write and debug. <br><br><h5>  <b>4.1 Working with ADC</b> </h5><br>  Dealing with analog sensors, we deal with ADC.  In this case, the ADC is built into the microcontroller.  Since the ADC is essentially the same sensor - converts an electrical signal into an information signal - for it, everything described above in section 2 is valid. The main characteristics of the ADC for us are its effective capacity, sensitivity, reference voltage and speed.  At the same time, the output value of the ADC conversion will be a number in the output register, which must be converted to an absolute value in units of the measured value.  In the future, for individual sensors, examples of such calculations will be considered. <br><br>  <b>4.1.1 Reference Voltage</b> <br>  The reference voltage of the ADC is the voltage to which the maximum output value of the ADC will correspond.  The reference voltage is supplied from a voltage source, both embedded in the microcontroller and external.  The accuracy of the ADC readings depends on the accuracy of this source.  The typical reference voltage of the integrated source is equal to the supply voltage or half the supply voltage of the microcontroller.  There may be other values. <br><br>  For example, the table of possible values ‚Äã‚Äãof the reference voltage for the Atmega1280 microcontroller: <br><img src="https://habrastorage.org/files/6d9/b0e/1e3/6d9b0e1e38eb4c2cbeac3d97e7507c02.jpg"><br>  <i>Figure 20. The selection of the reference voltage for the ADC microcontroller Atmega1280</i> <br><br>  <b>4.1.2 ADC resolution and sensitivity</b> <br>  The ADC resolution determines the maximum and minimum values ‚Äã‚Äãin the output register with the minimum and maximum input effects of an electrical signal. <br><br>  It should be noted that the maximum digit capacity of the ADC may not correspond to its effective digit capacity. <br>  Some of the lower digits may be given to noise.  Let us turn to the ADuCM360 microcontroller datasheet, which has a 24-bit ADC with an effective bit depth of 14 bits: <br><br><img src="https://habrastorage.org/files/cef/331/2af/cef3312af3af419bb76f27f10f63eb1f.jpg"><br>  <i>Figure 21. Assignment of the bits of the ADC data register</i> <br><br>  As can be seen from the figure, in a 32-bit register, a part is allocated to a sign, a part to zeros and a part to noise.  And only 14 bits contain data that have the specified accuracy.  In any case, these data are always indicated in the documentation. <br><br>  The sensitivity of an ADC determines its sensitivity.  The more intermediate the output voltage steps, the higher the sensitivity will be. <br><br>  Suppose the reference voltage is ADC <i>Uop</i> .  Then, the N-bit ADC, having 2N possible values, has a sensitivity <br><img src="https://habrastorage.org/files/e85/0cf/038/e850cf038d5a48efabb7e8df5c04e638.jpg">  (eleven) <br><br>  Thus, for a 12-bit ADC and a reference voltage of 3.3V, its sensitivity will be 3.3 / 4096 = 0.8 mV <br><br>  Since our sensor also has a certain sensitivity and accuracy, it would be nice if the ADC has the best performance. <br><br>  <b>4.1.3 ADC speed</b> <br>  The speed of the ADC determines how quickly the readings are read.  A sequential approximation ADC requires a certain number of clock cycles to digitize the input voltage level.  The greater the bit depth, the longer it takes, respectively, if by the end of the measurement the signal level has time to change, it will affect the accuracy of the measurement. <br><br>  The speed of the ADC is measured in the number of data samples per second.  It is defined as the frequency of the ADC clock signal divided by the number required for the measurement.  For example, having a clocking frequency of 1 MHz ADC and 13 clocks to take readings, the ADC speed will be 77 kilo-samples per second.  For each variant of the bit it is possible to calculate its speed.  The technical documentation usually indicates the maximum possible clock frequency of the ADC and its maximum speed at a certain bit depth. <br><br><h5>  <b>4.2 Digital sensors</b> </h5><br>  The main advantage of digital sensors over analog - they provide information about the measured greatness in finished form.  The digital humidity sensor will return the absolute value of humidity in percent, the digital temperature sensor will return the temperature value in degrees. <br><br>  The sensor is controlled using the question-answer form available in it.  The questions are as follows: <br><ul><li>  Write in the register A value B </li><li>  Return the value stored in register C </li></ul><br>  In response, the sensor, respectively, either writes the necessary data to the register, setting parameters or starting some mode, or sending the measured data to the controller as a finished product. <br><br>  On this I will finish the general material.  In the next part, we will look at HVAC sensors with examples. <br>  After the sensors, the executive devices will be considered - there are quite a few interesting things from the point of value of the theory of automatic control, and then we will get to the synthesis and optimization of the regulator of all this disgrace. <br><br>  UPD: Thanks to <a href="http://geektimes.ru/users/amartology/" class="user_link">amartology</a> , <a href="http://geektimes.ru/users/arastas/" class="user_link">Arastas</a> and <a href="http://geektimes.ru/users/stross/" class="user_link">Stross</a> for their fair comments on the article.  Added material in sections 2 and 4 and explained some controversial points. <br><br><h4>  <b>List of useful literature:</b> </h4><br><ol><li>  Bessekersky V.A., Popov E.P.  Theory of automatic control systems / V.A.  Besssekersky, E.P.  Popov - Ed.  4th, pererabot.  And add.  - SPb., Profession, 2007. - 752. </li><li>  Sensors: Reference book / V.M.  Sharapov, E.S.  Polishchuk, N.D.  Koshevoy, G.G.  Ishanin, I.G.  Minaev, A.S.  Sovlukov.  - Moscow: Technosphere, 2012. - 624 p. </li><li>  G. Vigleb.  Sensors.  Device and application.  Moscow.  Mir publishing house, 1989 </li><li>  Modern sensors.  Directory.  J.  FRIDEN Translated from English by Yu. A. Zabolotnaya, edited by E. L. Svintsova TECHNOSPHERE Moscow Technosphere-2005 </li></ol></div><p>Source: <a href="https://habr.com/ru/post/258967/">https://habr.com/ru/post/258967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258957/index.html">TypeScript: general impressions</a></li>
<li><a href="../258959/index.html">Serialization, sir! Today for dinner byte porridge, cooked from C ++ objects</a></li>
<li><a href="../258961/index.html">How to pass an elephant through the eye of a needle. Processing the maximum amount of data in the shortest time</a></li>
<li><a href="../258963/index.html">Krovi: Big Data - as dream. 10th series: Standard bummer</a></li>
<li><a href="../258965/index.html">NOT Arduino for 55 cents</a></li>
<li><a href="../258973/index.html">Content Iconification</a></li>
<li><a href="../258977/index.html">Some interesting and useful things for web developer # 44</a></li>
<li><a href="../258979/index.html">Is Asynchronous PHP a Myth? Reality! Video with DevConf 2014</a></li>
<li><a href="../258981/index.html">Reliability Analysis in Wolfram SystemModeler 4.1</a></li>
<li><a href="../258983/index.html">Deep learning on R, we train word2vec</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>