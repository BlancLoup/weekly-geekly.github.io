<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Clojure Web Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© there are not so many articles about Clojure, and this is sad, I intend to fix it. Below I will talk about a tool that is different in my sub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Clojure Web Applications</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© there are not so many articles about Clojure, and this is sad, I intend to fix it.  Below I will talk about a tool that is different in my subjective opinion - Clojure programming language and its libraries for creating web applications. <br><a name="habracut"></a><br>  In this article, there will be no comparison of Clojure with other languages, since, starting from modest experience, there is nothing to compare with. <br><br><h5>  Clojure's Basic Information </h5><br>  Clojure is a general purpose multiparadigm programming language that promotes functional programming.  The basis of this language and its syntax is Lisp and its S-expressions.  Unlike Lisp, Clojure includes other data types (collections), such as: vectors, associative arrays, sets, and very easy-to-use keyword keywords.  Clojure code is compiled into JVM bytecode, which allows you to deploy applications on a large number of platforms and use all available Java libraries on your own. <br><br>  The Internet is full of information about the structures of Clojure, so I will skip the description of these. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Community </h5><br>  It is impossible not to say about the community that has developed around this programming language, which is not so huge, but very friendly to beginners and not only, they readily help solve the problems that have arisen.  There is a large number of video materials on various aspects of using Clojure, except that almost all of them are in English (a paradise for translators' self-realization).  At the end of the article will be links. <br><br><h5>  Leiningen </h5><br>  Alternative Maven.  Used to manage project dependencies, library settings, and global project settings.  Provides console commands for building, testing, compiling, and running applications. <br><br>  Clojure projects are created using the command: <i>$ lein new &lt;project template name (app | compojure | luminus ...)&gt; &lt;project name&gt;</i> <br>  This creates a directory with a Clojure project that has all the necessary files and directories.  And of course, it creates a project.clj file in which all libraries are connected and global settings are set: libraries, project, compilation, repl, etc ... <br><br><div class="spoiler">  <b class="spoiler_title">Example project.clj file:</b> <div class="spoiler_text"><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defproject</span></span> test <span class="hljs-string"><span class="hljs-string">"0.1.0-SNAPSHOT"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:url</span></span> <span class="hljs-string"><span class="hljs-string">"http://test.ru"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:dependencies</span></span> [[org.clojure/clojure <span class="hljs-string"><span class="hljs-string">"1.7.0"</span></span>] [selmer <span class="hljs-string"><span class="hljs-string">"0.8.2"</span></span>] [com.taoensso/timbre <span class="hljs-string"><span class="hljs-string">"4.0.2"</span></span>] [com.taoensso/tower <span class="hljs-string"><span class="hljs-string">"3.0.2"</span></span>] [markdown-clj <span class="hljs-string"><span class="hljs-string">"0.9.67"</span></span>] [environ <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>] [compojure <span class="hljs-string"><span class="hljs-string">"1.3.4"</span></span>] [ring/ring-defaults <span class="hljs-string"><span class="hljs-string">"0.1.5"</span></span>] [ring/ring-session-timeout <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>] [metosin/ring-middleware-format <span class="hljs-string"><span class="hljs-string">"0.6.0"</span></span>] [metosin/ring-http-response <span class="hljs-string"><span class="hljs-string">"0.6.2"</span></span>] [bouncer <span class="hljs-string"><span class="hljs-string">"0.3.3"</span></span>] [prone <span class="hljs-string"><span class="hljs-string">"0.8.2"</span></span>] [org.clojure/tools.nrepl <span class="hljs-string"><span class="hljs-string">"0.2.10"</span></span>] [buddy <span class="hljs-string"><span class="hljs-string">"0.6.0"</span></span>] [com.novemberain/monger <span class="hljs-string"><span class="hljs-string">"2.0.1"</span></span>] [org.immutant/web <span class="hljs-string"><span class="hljs-string">"2.0.2"</span></span>] [clojure.joda-time <span class="hljs-string"><span class="hljs-string">"0.6.0"</span></span>]] <span class="hljs-symbol"><span class="hljs-symbol">:min-lein-version</span></span> <span class="hljs-string"><span class="hljs-string">"2.0.0"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:uberjar-name</span></span> <span class="hljs-string"><span class="hljs-string">"test.jar"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:jvm-opts</span></span> [<span class="hljs-string"><span class="hljs-string">"-server"</span></span>] <span class="hljs-comment"><span class="hljs-comment">;;enable to start the nREPL server when the application launches ;:env {:repl-port 7001} :main test.core :plugins [[lein-environ "1.0.0"] [lein-ancient "0.6.5"]] :profiles {:uberjar {:omit-source true :env {:production true} :aot :all} :dev {:dependencies [[ring-mock "0.1.5"] [ring/ring-devel "1.3.2"] [pjstadig/humane-test-output "0.7.0"]] :repl-options {:init-ns test.core} :injections [(require 'pjstadig.humane-test-output) (pjstadig.humane-test-output/activate!)] :env {:dev true}}})</span></span></code> </pre> <br></div></div><br><br><h5>  Ring </h5><br>  Ring - is a layer of abstraction over HTTP, providing interaction with it through a simple API.  Very successfully used to create modular applications. <br>  Examples of use can be seen on their github page (link at the end of the article).  I use another Ring abstraction, which in my opinion makes working with Ring routes easier and is called Compojure. <br><br><h5>  Compojure </h5><br>  The library for Ring routing, with its help, you can conveniently package routes and use them in the project's handler. <br><br><div class="spoiler">  <b class="spoiler_title">I give a simple example:</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defroutes</span></span> auth-routes <span class="hljs-comment"><span class="hljs-comment">;   (GET "/logout" ;      ;  request (-&gt; logout-controller)) ;    POST  (POST "/login" ;     [login password] (login-controller login password)) ;  ;  GET     ;    ;      ;      ;   (GET "/login" request (view/login-page)))</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">This is also possible:</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defroutes</span></span> users-routes <span class="hljs-comment"><span class="hljs-comment">;    (GET "/profile/:login" ;  request  :params    ;  login     :login request ;     -&gt; ;     ;  . (-&gt; profile-view-controller-GET)))</span></span></code> </pre><br></div></div><br><br>  I will not give an example of request, since you all understand how it looks.  This is about Compojure over. <br><br><h5>  Buddy </h5><br>  Library for authorization and user authentication.  It packs sessions of authorized users into the HTTP header in its backend, has functions for encrypting passwords, etc ... <br><br>  Password encryption example: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">buddy</span></span>.hashers/encrypt <span class="hljs-string"><span class="hljs-string">"qwerty"</span></span>)</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">An example of the authorization function from my project:</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> login-controller <span class="hljs-string"><span class="hljs-string">" "</span></span> [request] (<span class="hljs-name"><span class="hljs-name">let</span></span> [ <span class="hljs-comment"><span class="hljs-comment">;     form {:login (get-in request [:form-params "login"]) :password (get-in request [:form-params "password"])} ;     validate (bouncer/validate form valid/login-validator) ;   errors (first validate) return-errors (fn [message] (util/return-messages view/login-page :error-message message :data validate))] ;    (if-not errors ;      (if (true? (db/user-exist? {:login (:login form)})) ;    (let [user (db/get-user {:login (:login form)} [:password])] ;   (if (hashers/check (:password form) (:password user)) (do ;  :visited (db/update-user {:login (:login form)} {:visited (util/date-time)}) ;    (util/create-session request (:login form) "/")) ;     (return-errors " "))) ;     (return-errors "  ")) ;    (return-errors "   "))))</span></span></code> </pre><br></div></div><br><br>  Also Buddy allows you to customize access to pages in middleware. <br><br><div class="spoiler">  <b class="spoiler_title">Example:</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">def</span></span> rules [{<span class="hljs-symbol"><span class="hljs-symbol">:pattern</span></span> #<span class="hljs-string"><span class="hljs-string">"^/user/edit$"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:handler</span></span> authenticated-user} (<span class="hljs-name"><span class="hljs-name">defn</span></span> on-error [request response] {<span class="hljs-symbol"><span class="hljs-symbol">:status</span></span> <span class="hljs-number"><span class="hljs-number">403</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:headers</span></span> {<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span> <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>} <span class="hljs-symbol"><span class="hljs-symbol">:body</span></span> (<span class="hljs-name"><span class="hljs-name">str</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span> (<span class="hljs-symbol"><span class="hljs-symbol">:uri</span></span> request) <span class="hljs-string"><span class="hljs-string">".&lt;br&gt;"</span></span> response)}) (<span class="hljs-name"><span class="hljs-name">defn</span></span> wrap-restricted [handler] (<span class="hljs-name"><span class="hljs-name">restrict</span></span> handler {<span class="hljs-symbol"><span class="hljs-symbol">:handler</span></span> authenticated? <span class="hljs-symbol"><span class="hljs-symbol">:on-error</span></span> on-error})) (<span class="hljs-name"><span class="hljs-name">defn</span></span> wrap-identity [handler] (<span class="hljs-name"><span class="hljs-name">fn</span></span> [request] (<span class="hljs-name"><span class="hljs-name">binding</span></span> [*identity* (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">get-in</span></span> request [<span class="hljs-symbol"><span class="hljs-symbol">:session</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:identity</span></span>]) <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)] (<span class="hljs-name"><span class="hljs-name">handler</span></span> request)))) (<span class="hljs-name"><span class="hljs-name">defn</span></span> wrap-auth [handler] (<span class="hljs-name"><span class="hljs-name">-&gt;</span></span> handler wrap-identity (<span class="hljs-name"><span class="hljs-name">wrap-authentication</span></span> (<span class="hljs-name"><span class="hljs-name">session-backend</span></span>)))) <span class="hljs-comment"><span class="hljs-comment">;   middleware base: (defn wrap-base [handler] (-&gt; handler wrap-dev ;    (wrap-access-rules {:rules rules :on-error on-error}) ;   wrap-auth ;  (wrap-idle-session-timeout {:timeout (* 60 30) :timeout-response (redirect "/")}) wrap-formats (wrap-defaults (-&gt; site-defaults (assoc-in [:security :anti-forgery] false) (assoc-in [:session :store] (memory-store session/mem)))) wrap-servlet-context wrap-internal-error wrap-uri))</span></span></code> </pre><br></div></div><br><br><h5>  Selmer </h5><br>  HTML template engine inspired by Django.  Allows very flexible work with data in HTML templates. <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defn</span></span> registration-page <span class="hljs-string"><span class="hljs-string">"  "</span></span> [] (<span class="hljs-name"><span class="hljs-name">render</span></span> <span class="hljs-string"><span class="hljs-string">"registration.html"</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:foo</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>]})))</code> </pre><br><br>  And the template itself: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {% for i in foo %} {{i}} {% endfor %} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h5>  Monger </h5><br>  The library for working with mongodb, in general Clojure is a very convenient tool for working with databases, all thanks to its collections.  Monger is a Clojure MongoDB client (the essence of the library), providing high and low level functions for interacting with the MongoDB API.  The library is written very succinctly and at the same time provides everything you need to fully use MongoDB in applications.  It is impossible not to notice a huge plus - this is a very detailed and detailed documentation on the official site. <br><br><div class="spoiler">  <b class="spoiler_title">A small example:</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">ns</span></span> test.users.db (<span class="hljs-symbol"><span class="hljs-symbol">:require</span></span> monger.joda-time [monger.collection <span class="hljs-symbol"><span class="hljs-symbol">:as</span></span> m] [test.db <span class="hljs-symbol"><span class="hljs-symbol">:refer</span></span> [db]])) (<span class="hljs-name"><span class="hljs-name">def</span></span> collection <span class="hljs-string"><span class="hljs-string">"users"</span></span>) (<span class="hljs-name"><span class="hljs-name">defn</span></span> get-user <span class="hljs-string"><span class="hljs-string">" "</span></span> ([query] (<span class="hljs-name"><span class="hljs-name">m/find-one-as-map</span></span> db collection query)) ([query fields] (<span class="hljs-name"><span class="hljs-name">m/find-one-as-map</span></span> db collection query fields))) <span class="hljs-comment"><span class="hljs-comment">;  : ;     (get-user {:login "test"} [:first-name :last-name]) ;    (get-user {:login "test"})</span></span></code> </pre><br></div></div><br><br><h6>  About the abundance of brackets </h6><br>  There are a lot of brackets, you need to get used to it, but an attentive person will notice that there are no more than braces in the same JavaScript. <br><br><h5>  Links to the described libraries </h5><br><ul><li>  <a href="http://leiningen.org/">Leiningen</a> </li><li>  <a href="https://github.com/ring-clojure/ring">Ring</a> </li><li>  <a href="https://github.com/weavejester/compojure/wiki">Compojure</a> </li><li>  <a href="https://github.com/funcool/buddy">Buddy</a> </li><li>  <a href="http://clojuremongodb.info/">Monger</a> </li><li>  <a href="https://github.com/yogthos/Selmer">Selmer</a> </li></ul><br><br><h5>  Additional links </h5><br><ul><li>  <a href="http://www.clojure-toolbox.com/">Clojure Library List</a> </li><li>  <a href="http://clojuredocs.org/">Function and Core Documentation</a> </li><li>  <a href="http://www.braveclojure.com/">Clojure howto</a> </li><li>  <a href="http://clojure-doc.org/">Clojure docs</a> </li><li>  <a href="http://www.4clojure.com/">Challenges for Clojure (for any difficulty level)</a> </li></ul><br><br>  This is probably all, in future articles, if there is interest in them, I will tell about each library separately, about the wonderful web server immutant, and of course about ClojureScript, which is convenient to use when developing front-end applications and compiled into javascript.  I would also like to highlight the Luminus framework, which helped me a lot with Clojure web development.  I hope my, though not a comprehensive article will interest you to see the possibilities of this wonderful tool. <br><br>  Thank you all the best! </div><p>Source: <a href="https://habr.com/ru/post/263115/">https://habr.com/ru/post/263115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263103/index.html">Unobvious performance problems in Doctrine related to the hydration of objects</a></li>
<li><a href="../263105/index.html">Getting rid of the ‚Äúhistorical reasons‚Äù in cmd.exe in an easier and standard way.</a></li>
<li><a href="../263109/index.html">User data leakage in QIWI</a></li>
<li><a href="../263111/index.html">Chronos library: make writing long operations easier</a></li>
<li><a href="../263113/index.html">Trouble came from not waiting, XSS vulnerability in Yandex.Metrica</a></li>
<li><a href="../263117/index.html">10 years "on the knee" and forced evolution - note for young</a></li>
<li><a href="../263121/index.html">We continue to get acquainted with Intel Xeon Phi: "native" code</a></li>
<li><a href="../263125/index.html">International Mathematical Olympiad for Schoolchildren 2015. Am I? If I want to? Will I decide?</a></li>
<li><a href="../263129/index.html">Microsoft has released an unscheduled security update for Windows MS15-078</a></li>
<li><a href="../263131/index.html">Clojure web application. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>