<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configure Asterisk 1.8 + FreePBX 2.10 from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a continuation of the installation of the system. 
 Finally, in one way or another, we have installed Asterisk and FreePBX installed. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configure Asterisk 1.8 + FreePBX 2.10 from scratch</h1><div class="post__text post__text-html js-mediator-article"> This article is a continuation of the installation of the system. <br>  Finally, in one way or another, we have installed Asterisk and FreePBX installed. <br><br>  I will describe the situation in a little more detail to compare whether our work scheme will suit you.  We are a small Internet provider, we need a recording of conversations, queues of calls to landline and mobile phones, a voice menu telling about promotions with a choice of which department to get into, and the ability to quickly put all of these messages about accidents on certain streets of the city so that people don‚Äôt overwork support, preferably for free.  In order not to buy expensive gateways, we decided to change landline numbers and buy a couple of numbers + a dozen channels from an ip-telephony provider.  Someone will say that it is unreliable, etc.  Just tell me, what difference does the Internet provider on landline phones, if it fell all the Internet?  But it is cheap.  The connection cost us only $ 38, each phone number is $ 2 and the line is $ 1.2 per month.  After that, we received the settings even without authorization and an account was tied to our ip address.  Immediately I would like to stipulate how this article will be built, so as not to overload it with tons of screenshots, I will describe the creation of each element once (which I advise you to do because they will be needed for your subsequent experiments), and then I will write out a scheme of what it refers to. in our work pattern.  Surely you will have a different scheme, but you can understand the meaning.  I will describe only those elements that are directly needed when setting up. <br><a name="habracut"></a><br>  Now it's time to get a trunk: <br><br>  For clarity, I will write in English because  The interface is translated in pieces and quite mysteriously.  Go to Connectivity&gt; Trunks&gt; Add SIP Trunk. <br><img src="https://habrastorage.org/storage2/27d/9e5/f6f/27d9e5f6fd05cb67e604e0f3723a3ee7.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the right corner there will be a list of trunks you have already created.  Having opened a new one, I arbitrarily filled in the name - Trunk Name, calling it Vega (Vegatelecom is our provider).  Outbound CallerID having entered the number in the format 380652 as our operator gives it, this is the number from which outgoing calls will be made, if you do not specify it, you cannot call using this trunk, all the lines said.  In Outgoing Settings I filled in another Trunk Name field and entered the settings that the provider gave: <br><br>  host = 93.178.205.29 <br>  type = peer <br>  disallow = all <br>  allow = alaw &amp; ulaw &amp; g729 <br>  nat = no <br>  canreinvite = nonat <br>  insecure = invite <br>  dtmfmode = rfc2833 <br><br>  At the bottom I clicked the Submit Changes button and got the trunk created. <br><br>  Now you need to choose where we will receive calls.  Go to Applications&gt; Extension&gt; Generic SIP Device&gt; Submit <br><img src="https://habrastorage.org/storage2/e96/cec/d11/e96cecd117a450f8ff8e2be8be65d1a8.jpg"><br><br>  User Extension - the internal number of this phone, softphone or whatever you will connect there.  We used 100,101, etc. <br>  Display Name - the display name <br>  Required in the This device uses sip technology section.  fill in the secret is a password. <br>  Fields Recording Options include a recording of this phone: <br>  Inbound External Calls Always = Incoming External Calls <br>  Outbound External Calls?  Always = Outgoing external calls <br>  Inbound Internal Calls?  Always = Incoming internal calls <br>  Outbound Internal Calls?  Always = Outgoing internal calls <br>  On Demand Recording?  Disable Write on request <br>  At the bottom click Submit. <br><br>  Next, let's digress a bit and set up a softphone, ie a program for making calls from the computer.  There are a lot of them (EyeBeam, SJ-phone, Zoiper).  I will show with the EyeBeam. <br><br>  After installing the program under Windows, launch it, go to the settings in the Sip Accounts and edit the first one. <br><img src="https://habrastorage.org/storage2/e20/a4b/cfa/e20a4bcfa19a4f9d42e0d4c23caabf3f.jpg"><br><br>  To make it work we need to enter Display Name = User 1, User Name = 100, Password = ******, Domain = ip-your server.  The remaining settings can not touch.  You can create several subscribers with numbers 101-102 or any others, run several phones on several computers and try to call from one customer to another, respectively, using the numbers 100-101-102, etc. <br><br>  But we want to call our newly-purchased rooms. <br><br>  Go Connectivity&gt; Inbound Routes <br><img src="https://habrastorage.org/storage2/9c3/026/d32/9c3026d32201eeaa5a0d867a2e1c38e7.jpg"><br><br>  Description - Route Description (Name) <br>  DID Number - A very useful field, having set it, you can filter calls from a specific number.  Let us dwell on it in more detail.  In our case, 1 trunk enters 2 phone numbers, let's say we need the first number to go to the first operator and the call from the second number to the second operator.  We go to the telephony server via SSH, or physically if there is a monitor, log in as root and launch Asterisk CLI with the asterisk command -r.  Call one of the numbers that we connected to the trunk.  We look at one of the first lines to appear: Executing [380652 ****** @ from-trunk-sip-vega: 2] Goto (‚ÄúSIP / vega-000000e4 ‚Ä≥,‚Äú from-trunk, 380652 ****** , 1 ‚Ä≥) in new stack.  after the phrase from-trunk, we see what the DID of this number is, our provider sends the number in this format, if it is a GSM gateway in the form of a huawei modem, then its IMEI will be written there, in any case, if we create a route indicating this number , he will be responsible for calls to him.  In this example, I propose to leave the field empty for universality.  Those.  the system will transfer all calls from all trunks to the specified Destination. <br>  CallerID Number - works similar, but already with caller numbers.  In the prompts you can see that you can specify for example Blocked, therefore calls from the blocked phone numbers will be transferred to the desired Destination.  By tradition, leave empty. <br>  Set Destination - the main field in which we finally specify where the calls will go, you can choose a queue or let's say a specific extension, select the extension 100 that we created earlier and plugged into the softphone. <br>  Now, if you call the number that is running in the trunk, the softphone will ring.  Congratulations!  You made the first successful call. <br><br>  It is time to think about the fact that we can call someone else. <br><br>  Go Connectivity&gt; Outbound Routes&gt; <br><img src="https://habrastorage.org/storage2/efa/453/db1/efa453db1865d47ca0f920e03c2c0eb0.jpg"><br>  Route Name - the name of the route <br>  Dial Patterns that will use this Route - here you can set a route to certain numbers, again our provider supports dialing in any form, you can dial with the area code, you can without it, all these routes are registered with him, then we will not prescribe anything and set in the match pattern field -.  Yes, just a point.  This will mean sending all the numbers dialed as is. <br><br>  Finally, in Trunk Sequence for Matched Routes, we specify the trunks through which the call will go out, in our case, vega. <br><br>  If you now call any phone number from the softphone, the call will go through the trunk from the number specified in the trunk. <br><br>  It's time to think about the voice menu and call queues. <br>  This is where the fun begins.  We need a lot of notes for the voice menu.  Looking ahead I will describe the principle.  I personally had a problem on their dictation, but I found a wonderful way out.  First, we create many many records (I will tell you how), dictate them with a nasty lisping voice, then turn on the wonderful function of changing the recording by calling to a number, then go to Admin&gt; Feature codes, below the Recordings all codes that can be called with conditional names will be there records that you give them.  Thus, having printed this piece on paper, it can be issued to a female person so that she calls there, listens to what you dictate and re-record in a melodious voice until she starts to like it.  Another huge plus of this event is that these recordings can already be used in the finished voice menu, that is, you can change it to a hot one without stopping the operation of telephony and callers.  In the same way, it is possible to implement the accident notification function for unqualified personnel.  For example, by creating an entry with the name of the accident, a duration of 1 second and silence inside, you can hang it at the very beginning of your menu.  If an accident happens, the support operator can call the number of this file - dictate the streets where the repair is being carried out, and after the repair is completed, call there and keep silence for 1 second. <br><br>  So the dictation!  Go Admin&gt; System Recordings - <img src="https://habrastorage.org/storage2/af4/b46/7b0/af4b467b0e76d640441f190d0073f309.jpg"><br><br>  Here you can upload a file with the record, or you can enter your Extension number, press the Go button, call the * 77 number from the softphone or something connected to the server in the form of a phone and dictate what you need, then enter the name Name this Recording :, and Click the Save button, the record appears in the right corner. <br><img src="https://habrastorage.org/storage2/b76/ae8/c13/b76ae8c13cd9ff712263911f224fb165.jpg"><br><br>  By logging in, you can select the awesome function about the application of which I wrote above - Link to Feature Code put a tick.  Now by calling this code, you can overwrite it. <br><img src="https://habrastorage.org/storage2/80e/445/be2/80e445be21f1919fd06d488ee31462d8.jpg"><br><br>  Where is the complete list of these codes that you have included - Admin&gt; Feature Code: <br><img src="https://habrastorage.org/storage2/29f/432/4df/29f4324dfc9ff986522c8fb55fa63e08.jpg"><br><br>  Ahead of the course call queues Aplication&gt; Queues: <br><img src="https://habrastorage.org/storage2/d02/690/4db/d026904db47114a6139cda632adb9ea9.jpg"><br><br>  Queue Number - the queue number for which the call will go. <br>  Queue Name - the name of the queue. <br>  Static Agents: Here you can choose extensions (or other functions like MiscDestinations, there are legends that if you write a mobile number there and put the # icon at the end, it will switch there, but for some reason it did not work) that are constantly in this queue, respectively calls will always go to them. <br>  Dynamic Members: Already more interesting ... I will use this for the head of the STF service because  he is sitting on the phone, but he does not always have time to answer the subscribers so that he will not be tugged once again to ensure entry and exit from the queue, it may also be necessary if we assume the operator works in 2 departments and periodically switches from the sales department queue to the support queue or something like that.  By adding an extension here, we will get little - to connect to the queue, you need to dial in the phone the queue number * (we have 1000) and then dial your extension and #, after which it will be reported that you are connected to the queue and will receive calls from it.  To exit it, I dial 1000 ** then my number 100 # - after which I hear that they have disconnected me from the queue. <br><br>  Ring Strategy: dialer strategy, let me get lazy and attach a screenshot with a Russian translation. <br><img src="https://habrastorage.org/storage2/570/dff/fbe/570dfffbec494728c89a964fad9735a6.jpg"><br><br>  Join Announcement: Here you can choose one of the records, it is convenient enough if you get a call from some number to a queue of calls in which you just have to greet the client and call the name of the company he is calling, then the client is waiting for the connection with the operator. <br>  Call Recording: the format of recording calls in the queue, I have a wav. <br>  Max Wait Time: the time of the maximum stay in the queue, after which the subscriber will be advised to call later. <br>  Agent Timeout: The time during which the operator‚Äôs telephone will ring.  If there is a linear dialer strategy, then after this period of time there will be a switch to the next operator. <br>  Retry: After how many seconds to try to call the operator again.  An important jackdaw if you make a queue with a call to your mobile, when you need the phone to ring once for how many seconds and the operator can reset the call, after which the call will go to the destination if it is not answered - you need to select it without repeating. <br>  Agent Announcement: Here you can select a message that will be communicated to the operator in the handset before it is connected to the subscriber, for example, if the operator is sitting in 2-3 queues at the same time - he can be told from which queue the call came to him. <br>  Frequency: How often to inform the subscriber of his number in the queue. <br>  Announce Position: Report position in the queue or not. <br><br>  To create a greeting, go to the Applications-Announcements: <br><img src="https://habrastorage.org/storage2/da5/9b6/4bf/da59b64bfc7405843ae6deeb64f9d47e.jpeg"><br><br>  It's all very simple. <br>  Description: Title. <br>  Recording: Select the recording to be pronounced. <br>  Repeat: The number of repeats. <br>  Allow Skip: Allow the user to reset the greeting by pressing the keys. <br>  Destination after playback: Where to transfer the call after the end of the greeting. <br><br>  An interesting feature of the Applications-Follow Me: <br><img src="https://habrastorage.org/storage2/0af/45a/a4a/0af45aa4a37f5f0d269ad2bb04ff0685.jpeg"><br><br>  It is created on the basis of any Extension and makes it possible to redirect the call to something else.  It is used when for example you are not on the spot, a subscriber was switched to your phone, and you left for lunch, this menu can switch the call to your personal mobile phone and at the same time solve the problem when, according to the dialing policy, the trunk that calls you is transferred as a name caller's number that actually calls.  Then the trunk swears that the CID is invalid, that is, the caller's number.  At the bottom there is a Change External CID Configuration setting, here you can select the desired mode to make your trunk work.  A very common problem by the way in many forums.  I will not dwell on the settings in detail.  they duplicate many of the queue settings described above. <br><br>  Create the Applications-IVR voice menu: <br><img src="https://habrastorage.org/storage2/045/d95/368/045d9536801db265f966553fbf9f8c90.jpeg"><br><br>  IVR Name - Name <br>  IVR Description - Description <br>  Announcement - A greeting to be pronounced. <br>  Direct Dial - Direct Dialing the Extension if it is known to the caller. <br>  Timeout - Time in seconds after the end of the greeting, after which it will be switched to Destination by timeout. <br>  Invalid Retries - The number of attempts to incorrectly dial numbers. <br>  Invalid Retry Recording - Record is played when wrongly dialed. <br>  Append Original Annoucement - Reproduce the main greeting after a message about the wrong set of numbers. <br>  Invalid Recording - A message that will be played after the attempts of incorrect input have been exhausted, but before switching over to assignments in case of incorrect input attempts. <br>  Invalid Destination - Where to throw the subscriber who pressed a lot of wrong buttons. <br>  Timeout Retries - The number of menu repeats after a timeout. <br>  Timeout Retry Recording - Message after the timeout expires and before the message try again. <br>  Append Original Annoucement - Add original message menu after timeout message. <br>  Timeout Recording - Message after the timeout message and before the subscriber is sent to the destination by timeout. <br>  Timeout Destination - Where to switch on timeout. <br>  IVR Entries - Here are given by what numbers where to redirect. <br><br>  Go to Applications - Misc Destination: <br><img src="https://habrastorage.org/storage2/e42/224/b05/e42224b05721ebf2040ac58e11ae32f4.jpg"><br><br>  Description: Title <br>  Feature Code: The code for which will be called.  I have installers with personal mobiles crammed into 30x numbers. <br>  Feature Status: On / Off <br>  Destination: destination.  Here I have chosen Misc Destination with phones of installers, and then for everyone there are queues in static agents of which, just the Misc Application numbers are indicated.  This was done so that if the installer did not pick up the phone, you could switch to someone else. <br>  Applications - Time Group even has nothing to describe, just to mention that one entry is first created, let's say office hours are from 8.00 to 17.00, then it is saved, it opens again on the right and then a button appears - to add an additional time period, for example, also on Saturday 10.00 to 15.00 <br><img src="https://habrastorage.org/storage2/ee1/679/82c/ee167982c3a4191d044eb4fa79711610.jpg"><br><br>  After creating the Time Group, you can create Applications - Time Condition: <br><img src="https://habrastorage.org/storage2/c51/6f4/000/c516f400006b7730019a86a758c5a63c.jpg"><br><br>  Time Condition name: Name. <br>  Time Group: selects a group from the past menu. <br>  Well, 2 directions - if it is the same and if it is not. <br>  To clearly show how this all works, I'll show you a diagram: <br><img src="https://habrastorage.org/storage2/2d9/e77/c67/2d9e77c67955dd4f1f38b163fefeec47.jpg"><br><br>  I do not claim the correctness of what I did.  Two months ago I did not know anything about telephony.  When I searched for articles in runet, I could not find something large-scale that would help me to set up telephony to the state - it works.  So maybe there are a lot of errors here and it works not optimally, but in any case, I hope the newcomer will help set up the server to a working state. </div><p>Source: <a href="https://habr.com/ru/post/154933/">https://habr.com/ru/post/154933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154919/index.html">Patrons of Wikipedia. Who are they?</a></li>
<li><a href="../154921/index.html">Antivirus service will be built into Google Play</a></li>
<li><a href="../154923/index.html">New HabrAjax Theme</a></li>
<li><a href="../154929/index.html">New Node Subsite Names</a></li>
<li><a href="../154931/index.html">A little trick to display a large amount of data in a ListView</a></li>
<li><a href="../154935/index.html">Presented by ASUS PadFone 2</a></li>
<li><a href="../154939/index.html">Asus insists on a unique form factor and releases PadFone2</a></li>
<li><a href="../154945/index.html">How I started a project about startups, and how it developed in practice</a></li>
<li><a href="../154947/index.html">Linux ipsec decoding</a></li>
<li><a href="../154949/index.html">Personal personal documents will appear in Google personal search results.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>