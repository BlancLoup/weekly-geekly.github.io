<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco wireless controller device and root access</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am often approached with requests for troubleshooting of Cisco wireless controllers, some of which stem from not knowing how they are designed and w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco wireless controller device and root access</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/085/4e9/469/0854e9469da0c665b04dae6defb04e56.jpg"><br><br>  I am often approached with requests for troubleshooting of Cisco wireless controllers, some of which stem from not knowing how they are designed and work.  The controller of wireless access points is not a familiar router or switch with IOS, it is a specialized computer (or virtual machine) with Linux inside.  Today we will get acquainted with the hardware platforms of different controllers, learn about the mechanism of their licensing, analyze one firmware, and get root access to the device. <br><a name="habracut"></a><br><br><h4>  What for </h4><br>  In short, controllers are needed for centralized management of large wireless networks built on the basis of relatively non-individually adjustable access points.  I wrote about this architecture in detail on Habr√© ( <a href="http://habrahabr.ru/post/145082/">one</a> , <a href="http://habrahabr.ru/post/145677/">two</a> , <a href="http://habrahabr.ru/post/148903/">three</a> , <a href="http://habrahabr.ru/post/169511/">four</a> ).  Access points located across the premises of the enterprise (not necessarily in the same office) through a local or global network are registered on the controller, receive settings from it, are controlled by it, and provide wireless Wi-Fi access to subscribers.  Virtually all models of Cisco access points are available in a standalone version (independent control through the CLI or GUI) and in a unified (limited CLI and control from the controller via CAPWAP).  The controller is a hardware and software platform for interaction with access points and a wired network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In preparation for the CCIE Wireless (two years ago), I needed several controllers for the experiments, which were not at hand.  Prior to this, after successfully running the <a href="http://www.cisco.com/en/US/products/sw/secursw/ps5338/index.html">ACS</a> virtual machine, Location Appliance, <a href="http://www.cisco.com/en/US/products/ps9742/index.html">MSE,</a> I tried to virtualize the controller itself in the same way.  The task (solved in one and a half years) turned out to be difficult, and there was plenty of experience.  That's what I want to share with the community.  To begin with, let's see what the hardware of the controller is. <br><br><h4>  Iron </h4><br>  In fact, any controller is a specialized single-board computer with a processor of some well-known architecture, RAM, a flash disk (CompactFlash card in WISM, WLCM, 440x or a soldered chip in other models), network cards.  Any doubter can open the lid of the device and see for yourself. <br><br>  <a href="http://www.cisco.com/en/US/products/ps12722/index.html">The Cisco 8510</a> and <a href="http://www.cisco.com/en/US/products/ps11635/index.html">Cisco Flex 7510</a> are based on regular IBM 1U servers with an additional network card based on the <a href="http://www.cavium.com/OCTEON-III_CN7XXX.html">Cavium Octeon processor</a> , to which the controller assigns real-time packet operations (such as decrypting DTLS CAPWAP traffic).  These controllers have a specific niche - aggregation of traffic of a very large number of remote (in FlexConnect mode) access points, and because of this distribution do not have. <br><br>  <a href="http://www.cisco.com/en/US/products/ps12598/index.html">The Cisco 5760</a> and <a href="http://www.cisco.com/en/US/products/ps12686/index.html">Cisco Catalyst 3850</a> are devices close to regular routers and switches.  The controller code is executed under the control of IOS XE, the same as, for example, in the ASR line.  All that will be discussed below, to the data still exotic devices is not enough. <br><br>  The outgoing 4402, 4404 models carry the MIPS 64 processor, the NPE co-processor and the new software versions (&gt; 7.2) are not supported.  These include the 4402 controller built into the 3750G-24WS switch, as well as the WiSM module in the Catalyst 6500 (which is two independent 4404s that receive only console, power, and GigE ports from the chassis). <br><br>  The WLCM (for ISR) and <a href="http://www.cisco.com/en/US/products/ps11716/index.html">SRE</a> (ISR G2) devices are modules that are installed autonomously in the 28xx / 38xx, 29xx / 39xx series router.  They differ in processor (Celeron / i386 and Core / x64) and, accordingly, in performance (the number of supported access points). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a92/33a/01e/a9233a01ebad44919fc514f9788a6ed2.jpg"><br>  We are most interested in the more common standalone controllers <a href="http://www.cisco.com/en/US/products/ps11630/index.html">2504</a> , <a href="http://www.cisco.com/en/US/products/ps10315/index.html">5508</a> , and the new <a href="http://www.cisco.com/en/US/products/ps11634/index.html">WiSM2</a> module for the <a href="http://www.cisco.com/en/US/products/ps11634/index.html">6500</a> switch. The last (surprise) is again two independent 5508. In reality, all these three models are the same, they differ only in the number of network interfaces and CPU performance (64-bit MIPS architecture). <br><br>  The <a href="http://www.cisco.com/en/US/products/ps12723/index.html">virtual controller</a> closes the line, which is sold as a VM image under VMware ESXi (ovf-file).  It is logical that its architecture corresponds to the standard hardware of the virtual machine: x64 processor, LSI SCSI disk, Intel E1000 network. <br><br>  Two years ago, there was no virtual controller.  I tried to virtualize the closest in architecture WLCM (NME-AIR-WLC), which, however, required parsing and examining the firmware (approximately as described below), writing the NVRAM emulation driver for MontaVista 4.0, studying Ida Pro, modifying QEMU network offsets, working with the network in ESXi and it took about a year of time in the sluggish mode.  And such a controller earned!  True, the modern controller software versions (&gt; 7.2) no longer support the WLCM, and we have a vWLC, so my results have only academic value. <br><br>  In addition to the obvious differences in performance (the number of simultaneously supported access points and wireless subscribers), all controllers differ in functionality.  The main <a href="http://www.cisco.com/en/US/docs/wireless/controller/release/notes/crn75.html">differences are reduced to the support of</a> wired guest, guest access, mobility-anchor, multicast, IPV6, etc.  rarely required features.  The real weighty difference is that support for local mode (traditional mode) is implemented at 2504/5508 / WISM2, while Flex7500 / vWLC is only content with FlexConnect. <br><br><h4>  Soft </h4><br>  The controller software is a file of about 100 megabytes in size, which you can download on the manufacturer‚Äôs website if you have a service contract <s>or google by the same file name from the same place</s> .  For a typical AIR-CTYYYY-K9-XX-XX.aes, the .aes extension should not mislead you: it has nothing to do with <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">the encryption protocol</a> .  The name of the firmware file (firmware) may contain the word LDPE (Licensed Data Payload Encryption).  This means that this firmware activates the ability to encrypt user traffic (the CAPWAP control tunnel is still encrypted via DTLS / AES) with a separate license.  This is Cisco specially invented for users from Russia, so that K9 devices do not fall under the legal restrictions on the input of encryption tools. <br><br>  Inside the firmware file of the proprietary format, you will see some binary garbage, pieces of shell scripts, large blocks that look like tar or gz archives.  This is not at all like the tightly packed, monolithic IOS (Internetwork Operating System, not to be confused with Apple iOS) binary image of any traditional Cisco device.  Therefore, you should not try to make any updates by directly deleting-pouring the .aes-file to the flash, you will only distort the device. <br><br>  Take the latest version for today 7.5.102.0 for the controller 5508, AIR-CT5500-K9-7-5-102-0.aes.  A curious fact: remember, I said that 2504, 5508 and WiSM2 are the same thing?  If you look closely, for all of them the software file of this firmware version has one length (133146180 bytes) and a checksum (62ba852937eefaadaaba25e3b6cc18fc).  The software itself determines which platform it runs on.  Well, you, if you have software for one of the three platforms, automatically have it for the rest - just rename the file. <br><br><h4>  Getting root access </h4><br>  As you know, connecting via SSH or console to the controller, you get to the command line interface, which is a bit like iOS.  Slightly - because the entire line of controllers is based on the historical code obtained by Cisco as a result of the acquisition of Airespace in 2005.  Once we know that the controller is based on Linux OS, the question arises - is it possible to get shift-access to the system itself, preferably root-based.  Let's try to do this on the example of a virtual controller installed according to the <a href="http://www.cisco.com/en/US/products/ps12723/products_tech_note09186a0080bd2d04.shtml">instructions</a> .  After installing version 7.4.100, I additionally updated it to version 7.5.102. <br><br>  Just because you can not get into his shell (this is not <a href="http://www.cisco.com/en/US/docs/wireless/ncs/1.0/command/reference/cli_app_a.html">Prime NCS</a> ) <br>  Our ‚Äúvirtual controller‚Äù CTVM runs as a VMware ESXi virtual machine.  Turn off the controller (using the Power Off button) and connect its virtual disk (.vmdk) to some of our other virtual machines on the same host.  I use Debian / GNU Linux for similar purposes as the closest option to the original OS.  What we see: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c87/097/152/c87097152d1a45865382325f6332a8c5.gif"><br><br><pre><code class="hljs pgsql">root@debian64:~# fdisk /dev/sdb ‚Ä¶ Disk /dev/sdb: <span class="hljs-number"><span class="hljs-number">8589</span></span> MB, <span class="hljs-number"><span class="hljs-number">8589934592</span></span> bytes ‚Ä¶ Device Boot <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> Blocks Id <span class="hljs-keyword"><span class="hljs-keyword">System</span></span> /dev/sdb1 * <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">265072</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> Linux /dev/sdb2 <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">99</span></span> <span class="hljs-number"><span class="hljs-number">530145</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> Linux /dev/sdb3 <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">491</span></span> <span class="hljs-number"><span class="hljs-number">3148740</span></span> <span class="hljs-number"><span class="hljs-number">83</span></span> Linux /dev/sdb4 <span class="hljs-number"><span class="hljs-number">492</span></span> <span class="hljs-number"><span class="hljs-number">1044</span></span> <span class="hljs-number"><span class="hljs-number">4441972</span></span>+ <span class="hljs-number"><span class="hljs-number">83</span></span> Linux</code> </pre> <br><br>  Four partitions.  Let's try to mount them all: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> sdb &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> sdb/<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> sdb/<span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> sdb/<span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> sdb/<span class="hljs-number"><span class="hljs-number">4</span></span> mount /dev/sdb1 sdb/<span class="hljs-number"><span class="hljs-number">1</span></span>/ ; mount /dev/sdb2 sdb/<span class="hljs-number"><span class="hljs-number">2</span></span>/ ; mount /dev/sdb3 sdb/<span class="hljs-number"><span class="hljs-number">3</span></span>/ ; mount /dev/sdb4 sdb/<span class="hljs-number"><span class="hljs-number">4</span></span>/</code> </pre><br><br>  Section 1 contains a bootloader (grub) and recovery core rescue.img, section 2 is not mounted at all (and is not used by this version of the controller), section 3 contains log files, and section 4 contains the most interesting.  I will give a trimmed output ls ‚Äìla with comments. <br><br><pre> <code class="hljs pgsql">./sdb/<span class="hljs-number"><span class="hljs-number">4</span></span>: drwxr-xr-x <span class="hljs-number"><span class="hljs-number">7</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> application drwxr-xr-x <span class="hljs-number"><span class="hljs-number">4</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> images -rw-r<span class="hljs-comment"><span class="hljs-comment">--r-- 1 root root 524288  24 11:58 vmstore.bin</span></span></code> </pre><br><br>  vmstore.bin is a mounted image of the system storage of certificates and licenses, as discussed below. <br><br><pre> <code class="hljs rust">./sdb/<span class="hljs-number"><span class="hljs-number">4</span></span>/application: ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">611</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> bsnSslWebadminCert.crt ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">607</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> bsnSslWebadminCert.prv ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">597</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> bsnSslWebauthCert.crt ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">609</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> bsnSslWebauthCert.prv drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> cfg -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">131072</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> csl.bin ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">32768</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> flash_settings.bin drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> ha ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">4080</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> log.bin drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span> lvl7 ---------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> mcast_ucast_feature drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span> nim -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">125</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span> promptError.txt -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> snmpBoots.txt -rw------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">668</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_dsa_key -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">606</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_dsa_key.<span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> -rw------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">531</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_key -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">335</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_key.<span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> -rw------- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">883</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_rsa_key -rw-r--r-- <span class="hljs-number"><span class="hljs-number">1</span></span> root root <span class="hljs-number"><span class="hljs-number">226</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> ssh_host_rsa_key.<span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> drwxr-xr-x <span class="hljs-number"><span class="hljs-number">3</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> xml</code> </pre><br><br>  It contains controller configuration files, SSH keys, Webadmin SSL certificates and Webauth. <br><br><pre> <code class="hljs pgsql">./sdb/<span class="hljs-number"><span class="hljs-number">4</span></span>/application/<span class="hljs-type"><span class="hljs-type">xml</span></span>: <span class="hljs-comment"><span class="hljs-comment">---------- 1 root root 1583  24 12:33 aaaapiCfgData.xml ---------- 1 root root 1068  24 12:33 aaaapiFileDbCfgData.xml ‚Ä¶</span></span></code> </pre><br><br>  You probably know that a comprehensive configuration of a switch and a Cisco router can be obtained via <i>sh run</i> to archive it, or upload it to another device.  Initially, in wireless controllers, too, it was.  However, now the output of the <i>sh config</i> command is not enough to fully understand what is configured on the device.  To do this, you have to use numerous <i>shows ....</i>  The fact is that the actual device configuration is now in the set of XML files located in / application / xml, and each launch of the <i>sh config</i> command causes a special code to transform this XML into text CFG.  Work on such a converter is delayed in relation to the development of the device (and, perhaps, is abandoned altogether), so you cannot rely on <i>sh config</i> .  However, complete device configuration via <i>config ...</i> commands (i.e., without web gui) is possible.  Moreover, for a number of tasks there is simply no graphic equivalent to a text command.  Naturally, in the depths of the device there are inverse tools for converting commands to XML. <br><br><pre> <code class="hljs pgsql">./sdb/<span class="hljs-number"><span class="hljs-number">4</span></span>/images: drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span> ap.bak drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span> ap.pri -rw-r<span class="hljs-comment"><span class="hljs-comment">--r-- 1 root root 39773258  24 11:58 linux.bak.img -rw-r--r-- 1 root root 40973323  31 13:53 linux.pri.img -rw-r--r-- 1 root root 0  24 12:21 upgrade.log -rw-r--r-- 1 root root 10  31 13:53 vinitrd-primary -rw-r--r-- 1 root root 10  24 11:58 vinitrd-secondary</span></span></code> </pre><br><br>  Here we see the primary and backup kernels of the operating system of the controller, as well as two directories with the primary and backup versions of the firmware of the access points (see below). <br><br><pre> <code class="hljs">./sdb/4/images/ap.pri: -rwxr-xr-x 1 root root 11018240  24 12:22 ap1g1 -rwxr-xr-x 1 root root 40  24 12:22 ap1g1.md5 -rwxr-xr-x 1 root root 10342400  24 12:23 ap1g2 -rwxr-xr-x 1 root root 40  24 12:23 ap1g2.md5 -rwxr-xr-x 1 root root 10383360  24 12:23 ap3g1 -rwxr-xr-x 1 root root 40  24 12:23 ap3g1.md5 -rwxr-xr-x 1 root root 11530240  24 12:23 ap3g2 -rwxr-xr-x 1 root root 40  24 12:23 ap3g2.md5 -rwxr-xr-x 1 root root 7608320  24 12:23 ap801 -rwxr-xr-x 1 root root 40  24 12:23 ap801.md5 -rwxr-xr-x 1 root root 9041920  24 12:24 ap802 -rwxr-xr-x 1 root root 40  24 12:24 ap802.md5 -rwxr-xr-x 1 root root 5201920  24 12:24 c1130 -rwxr-xr-x 1 root root 40  24 12:24 c1130.md5 -rwxr-xr-x 1 root root 10229760  24 12:24 c1140 -rwxr-xr-x 1 root root 40  24 12:24 c1140.md5 -rwxr-xr-x 1 root root 7342080  24 12:24 c1250 -rwxr-xr-x 1 root root 40  24 12:24 c1250.md5 -rwxr-xr-x 1 root root 8468480  24 12:24 c1520 -rwxr-xr-x 1 root root 40  24 12:24 c1520.md5 -rwxr-xr-x 1 root root 3840000  24 12:24 c602i -rwxr-xr-x 1 root root 40  24 12:24 c602i.md5</code> </pre><br><br>  What is the core of the OS controller?  Judging by the size, it contains initramfs, the root filesystem with all utilities, mounted in memory immediately after the kernel starts.  By the way, in previous versions of the controller, the initrd was shipped as a separate ext2fs image file, which greatly simplified the task of modifying it. <br><br><pre> <code class="hljs css"># <span class="hljs-selector-tag"><span class="hljs-selector-tag">file</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linux</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pri</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">linux</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pri</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Linux</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x86</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">boot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">executable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bzImage</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">version</span></span> 2<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.21_mvlcge500-octeon-mips64_</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">RO-rootFS</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">root_dev</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x801</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">swap_dev</span></span> 0<span class="hljs-selector-tag"><span class="hljs-selector-tag">x27</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">VGA</span></span></code> </pre><br>  To get root access, you need to disassemble the kernel into parts, change something in the root file system, and collect everything back.  To do this, let's see how the core works.  Surprisingly, there is almost no clear description of the structure of the assembled kernel, along with the tools for parsing it on the Internet ( <a href="http://code.google.com/p/binwalk/">binwalk</a> helps <a href="http://code.google.com/p/binwalk/">remotely</a> ).  It is clear that the kernel is packed, and probably the packer is gzip.  The signature of gzip files is simple - all archives begin with 0x1F 0x8B 0x08.  We will search for the beginning of the archive, cut, unpack, see what's inside, repeat, etc.  As a result, the following structure appears: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e23/697/354/e23697354c73dea8e34366fa9cf8e7f0.gif"><br><br>  The constants K1, K2 and K3 are selected experimentally and depend on the firmware version.  2.gz are at the very end of the kernel, and the gzip magic combination occurs there many times - for example, it is known that there is a packed .config in the kernel used in its assembly.  The following script was compiled for unpacking: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh K1=38088 K2=6619136 K3=45117311 dd if=linux.pri.img of=0 skip=0 count=1 bs=$K1 dd if=linux.pri.img of=1.gz skip=0 bs=$K1 zcat 1.gz &gt; 1 dd if=1 of=2-h skip=0 count=1 bs=$K2 dd if=1 of=2-f skip=$K3 bs=1 dd ibs=1 if=1 of=2.gz skip=$K2 count=$(expr $K3 - $K2) zcat 2.gz &gt; 2 mkdir initramfs cd initramfs cpio --no-absolute-filenames -idv &lt; ../2 cd ..</span></span></code> </pre><br><br>  At the output we have the initramfs directory containing the root file system of the controller.  To get root access, just correct the following files: <br><ol><li>  Edit ./etc/inittab so that when you start the console starts, not the wireless system code: <br>  a.  Swap comments by unlocking the console: <br>  con: 2345: respawn: / sbin / getty console <br>  #con: 2345: respawn: / bin / gettyOrMwar <br>  b.  Let's uncomment from 2 to 6 virtual terminals: <br>  2: 23: respawn: / sbin / getty 38400 vc / 2 <br></li><li>  The root user in / etc / passwd is prescribed a normal shell, / bin / bash </li><li>  You can also make non-executable ./etc/init.d/S95mwar so that the controller does not start without demand </li></ol><br><br>  Now we will collect everything back.  Remember that archives in the kernel have the maximum compression ratio.  With our manipulations, the sizes of the resulting pieces will probably be smaller than the original ones, therefore, to preserve the binary structure, we will add blocks with zeros. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cd initramfs find . | cpio --create --format='newc' | gzip -n -9 &gt; ../2-new.gz cd .. SPACER1=$(expr `stat -c%s 2.gz` - `stat -c%s 2-new.gz`) dd if=/dev/zero of=$SPACER1 bs=1 count=$SPACER1 cat 2-h 2-new.gz $SPACER1 2-f | gzip -n -9 &gt; 1-new.gz SPACER2=$(expr `stat -c%s 1.gz` - `stat -c%s 1-new.gz`) dd if=/dev/zero of=$SPACER2 bs=1 count=$SPACER2 cat 0 1-new.gz $SPACER2 &gt; bz rm $SPACER1 $SPACER2</span></span></code> </pre><br><br>  Now we need to make sure that the modified kernel is the same size as the original one, and put it in its place: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ls -la linux.pri.img bz -rw-r--r-- 1 root root 40973323  27 10:00 bz -rw-r--r-- 1 root root 40973323  25 23:05 linux.pri.img # mount /dev/sdb4 sdb/4/ # cp bz sdb/4/images/linux.pri.img # umount /dev/sdb4</span></span></code> </pre><br><br>  You can turn off the test virtual machine with Linux, and turn on the controller (ESXi one virtual disk, .vmdk file, will not allow two VMs to use at the same time).  Load the controller: <br><br><pre> <code class="hljs mel"> Cisco Bootloader (Version <span class="hljs-number"><span class="hljs-number">7.4</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>) .o88b. d888888b .d8888. .o88b. .d88b. d8P Y8 <span class="hljs-string"><span class="hljs-string">`88' 88' YP d8P Y8 .8P Y8. 8P 88 `</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>bo. <span class="hljs-number"><span class="hljs-number">8</span></span>P <span class="hljs-number"><span class="hljs-number">88</span></span> <span class="hljs-number"><span class="hljs-number">88</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">88</span></span> <span class="hljs-string"><span class="hljs-string">`Y8b. 8b 88 88 Y8b d8 .88. db 8D Y8b d8 `</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>b d8<span class="hljs-string"><span class="hljs-string">' `Y88P'</span></span> Y888888P <span class="hljs-string"><span class="hljs-string">`8888Y' `</span></span>Y88P<span class="hljs-string"><span class="hljs-string">' `Y88P'</span></span> Booting Primary Image... Press &lt;ESC&gt; now <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> additional boot options... Booting <span class="hljs-string"><span class="hljs-string">'Primary image'</span></span> Detecting <span class="hljs-keyword"><span class="hljs-keyword">hardware</span></span> . . . . <span class="hljs-number"><span class="hljs-number">3</span></span> INIT: version <span class="hljs-number"><span class="hljs-number">2.86</span></span> booting ‚Ä¶</code> </pre><br><br><img src="http://habrastorage.org/storage3/8f4/52c/d78/8f452cd78340ea7f60fc70f3b885caf3.gif"><br><br>  Bottom line: we have full root access to a working Cisco vWLC virtual wireless controller. <br><div class="spoiler">  <b class="spoiler_title">How to get root access to the hardware controller?</b> <div class="spoiler_text">  If you need it that way (although I don‚Äôt understand why), you can try modifying the firmware in a similar way and uploading it to the device ‚Äî if there‚Äôs a CF card, then via a card reader; if the soldered flash, then via the bootloader of the device that has the option of loading the image kernels via TFTP. </div></div><br><br><h4>  The device is a working controller </h4><br>  It is obvious that the controller is based on the specialized version of Linux production <a href="http://www.mvista.com/">MontaVista</a> .  At startup, the above file systems are mounted, standard initialization, loading of kernel modules, checking for the Octeon chip, and downloading of its firmware.  The network cards of the controller at this moment do not have IP addresses.  At the end, the wireless controller code itself is started with the / bin / bsnmwar binding script.  Mwar - Main Wireless Application Routine.  The controller code is contained in a monolithic, statically linked <b>/ sbin / switchdrvr file</b> (ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, for GNU / Linux 2.6.18, stripped), which occupies a good half of the volume the entire controller firmware, and implements fully the logic of its work.  It is when it is launched that the familiar controller initialization lines (Starting .... Ok) appear on the console, the network interfaces are initialized, the license management daemon is started by a separate process, the web interface appears and the access points and wireless clients start to be served.  Shell access to the console disappears, and the user gets to the standard console login prompt to the controller (but we remember the running getty on the other virtual terminals, which arose as a result of our inittab modernization). <br>  During the switchdrvr startup process, the /mnt/wlc/vmstore.bin file is mounted with licenses and certificates into memory (losetup) and the partition with the firmware of access points is remounted.  As a result, the mount points look like this: <br><br><pre> <code class="hljs swift">root@(<span class="hljs-keyword"><span class="hljs-keyword">none</span></span>):/mnt/wlc# df -k <span class="hljs-type"><span class="hljs-type">Filesystem</span></span> 1k-blocks <span class="hljs-type"><span class="hljs-type">Used</span></span> <span class="hljs-type"><span class="hljs-type">Available</span></span> <span class="hljs-type"><span class="hljs-type">Use</span></span>% <span class="hljs-type"><span class="hljs-type">Mounted</span></span> on tmpfs <span class="hljs-number"><span class="hljs-number">1029084</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1029076</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% /tmp tmpfs <span class="hljs-number"><span class="hljs-number">10240</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">10232</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% /dev tmpfs <span class="hljs-number"><span class="hljs-number">1029084</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1029084</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% /dev/shm <span class="hljs-keyword"><span class="hljs-keyword">none</span></span> <span class="hljs-number"><span class="hljs-number">1029084</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1029076</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/run <span class="hljs-keyword"><span class="hljs-keyword">none</span></span> <span class="hljs-number"><span class="hljs-number">1029084</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1029076</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% /tmp /dev/sda4 <span class="hljs-number"><span class="hljs-number">4372140</span></span> <span class="hljs-number"><span class="hljs-number">394588</span></span> <span class="hljs-number"><span class="hljs-number">3755456</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>% /mnt/wlc /dev/sda3 <span class="hljs-number"><span class="hljs-number">3099292</span></span> <span class="hljs-number"><span class="hljs-number">82176</span></span> <span class="hljs-number"><span class="hljs-number">2859680</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>% /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log /dev/loop5 <span class="hljs-number"><span class="hljs-number">494</span></span> <span class="hljs-number"><span class="hljs-number">176</span></span> <span class="hljs-number"><span class="hljs-number">293</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span>% /mnt/vmstore /dev/loop3 <span class="hljs-number"><span class="hljs-number">110</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">67</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>% /root/.csl /dev/ram3 <span class="hljs-number"><span class="hljs-number">122</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">117</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>% /root/.csl_tmp tmpfs <span class="hljs-number"><span class="hljs-number">40960</span></span> <span class="hljs-number"><span class="hljs-number">9856</span></span> <span class="hljs-number"><span class="hljs-number">31104</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>% /mnt/ap_bundle</code> </pre><br><br><h4>  Access points </h4><br>  Their mode of operation is determined by the firmware, which can be changed from the AP (now called SAP, standalone access point) to LAP (lightweight access point) and <a href="https://supportforums.cisco.com/docs/DOC-14960">vice versa</a> .  Firmware in both cases is IOS compiled for the hardware platform of the point itself (all points are PowerPC of various antiquities).  The firmware file for the stand-alone point will have a name like c1130-k9w7-tar.124-3g.JA.tar, and ‚Äúlightweight‚Äù will be c1130-k9w8-mx.124-23c.JA3.tar The difference is in <b>W7</b> and <b>W8</b> .  There are also ‚Äúrecovery (recovery)‚Äù versions of the type c1130- <b>rcvk9w8</b> -mx.  Here, the firmware does not contain the radio code, its purpose is to start, find the controller, and download the ‚Äúworking‚Äù version of the software from it.  By the way, by the last letters of the file name of the lightweight firmware, you can determine the version of the controller to which it corresponds.  For example, 152-2.JB is 7.4.100, and 124-23c.JA3 is 7.0.220. <br><br>  All controllers carry copies of the firmware supported by their access points.  When the access point is connected to the controller, version compliance is checked, and if they are different, software is automatically installed from the controller.  At the same time possible downgrade version.  The controller will work only with the corresponding software version of the point.  Therefore, if you have two controllers with software of different versions on your network, and access points can choose either one or the second, when you jump from one controller to another, they will change their software.  This is a long time, and is fraught with breakage of the flash memory of a point from its permanent rewriting. <br><br>  Although the CAPWAP communication protocol between the controller and the access point is <a href="http://en.wikipedia.org/wiki/CAPWAP">standardized</a> , there is no chance that the Cisco controller will work with third-party access points in the foreseeable future.  In a specific implementation, there are a lot of undocuments, and it is not necessary (not profitable) for anyone. <br><br><h4>  Licensing </h4><br>  For the impatient: the means to "break" the licensing mechanism of controllers today is not. <br>  Old controller platforms were licensed by the number of access points by hardware.  Information on the number of maximum serviced points is contained in NVRAM next to the serial number, and is not updated (you cannot buy support for additional points). <br>  All new platforms use a modern approach based on issuing a license based on UDI (product name / platform + Serial Number of the device) on Cisco.com/go/licensing with indication of the PAK key, i.e.  confirmation of your purchase of the device and software rights.  Thus, licenses can be re-purchased as the number of access points installed at you increases, within the hardware capabilities of the platform.  You can also activate a demo license once for 90 days. <br><br>  The virtual controller generates its serial number the first time it starts up, guided by the MAC address of the device (provided by VMware) and probably some other parameters like CPU identifiers. <br><br>  This method of licensing platforms and components is used by all devices on IOS 15.0, IOS XR, IOS XE, NX-OS, etc. <br>  The license itself has the following form: <br><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_ARTIFACTS</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_LICENSE</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span>base<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_VERSION</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_VERSION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UDI</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PID</span></span></span><span class="hljs-tag">&gt;</span></span>AIR-CT5508-K9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PID</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SN</span></span></span><span class="hljs-tag">&gt;</span></span>FCJ00000000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SN</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UDI</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOURCE</span></span></span><span class="hljs-tag">&gt;</span></span>Cisco HQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SURCE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CREATE_DATE</span></span></span><span class="hljs-tag">&gt;</span></span>2010-10-20T18:29:16<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CREATE_DATE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE_HASH</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hashAlgo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SHA1"</span></span></span><span class="hljs-tag">&gt;</span></span>Eb86wsdgdsheIdRgxu8SYjnV2kug=<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE_HASH</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TYPE</span></span></span><span class="hljs-tag">&gt;</span></span>EXTENSION<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TYPE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXPIRATION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DAYS</span></span></span><span class="hljs-tag">&gt;</span></span>60<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DAYS</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXPIRATION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EULA</span></span></span><span class="hljs-tag">&gt;</span></span>YES<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EULA</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[11 base 1.0 LONG TRIAL DISABLED 1440 DISABLED STANDALONE ADD INFINITE_KEYS INFINITE_KEYS NEVER NEVER NiL SLM_CODE CL_ND_LCK NiL *1B2UN9YKWSE6TLX400 NiL NiL NiL 5_MINS &lt;UDI&gt;&lt;PID&gt;AIR-CT5508-K9&lt;/PID&gt;&lt;SN&gt;FCJ00000000&lt;/SN&gt;&lt;/UDI&gt; IoNEjaiZMvr:SUgPfi7IL7DfUgmILSlzRAumZl96TmLQxk8wOUr9YwwsYn0pd5vsVYhn9K2G:rYugiUzNI2SeH3jL0Fvj9boyHdSgN9heQmw3F1APru5,qKFhvCKGi16CO3A$&lt;WLC&gt;AQEBIf8B///vAvN3WYGs8UKGLXXeaNhRdwitkjqL7s+cOPCdiN04GY47UbtfByUZYOemWEq6ljxHebPkGlARtYd1UQO7GJ3KnufZ9oZ6JdFniDf5HrQ8DrXdpCz5RgZE+y8fbN200xiXA5cB3fwcJqoPIFZm2HmD1qFfsyTAzuio66t6Xk5y8xo1lbVhvoh/FZfy5iRY3oE=&lt;/WLC&gt;]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USER_MODIFIABLE_COMMENT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fieldRestrictions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Max 99 ASCII characters in length."</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USER_MODIFIABLE_COMMENT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_LICENSE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_ARTIFACTS</span></span></span><span class="hljs-tag">&gt;</span></span></code> &gt; IoNEjaiZMvr: SUgPfi7IL7DfUgmILSlzRAumZl96TmLQxk8wOUr9YwwsYn0pd5vsVYhn9K2G: rYugiUzNI2SeH3jL0Fvj9boyHdSgN9heQmw3F1APru5, qKFhvCKGi16CO3A $ &lt;WLC&gt; AQEBIf8B /// vAvN3WYGs8UKGLXXeaNhRdwitkjqL7s + cOPCdiN04GY47UbtfByUZYOemWEq6ljxHebPkGlARtYd1UQO7GJ3KnufZ9oZ6JdFniDf5HrQ8DrXdpCz5RgZE + y8fbN200xiXA5cB3fwcJqoPIFZm2HmD1qFfsyTAzuio66t6Xk5y8xo1lbVhvoh / FZfy5iRY3oE = &lt;/ WLC&gt;]]&gt; &lt;/ LICENSE_LINE&gt; <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_ARTIFACTS</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_LICENSE</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span>base<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_NAME</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_VERSION</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FEATURE_VERSION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UDI</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PID</span></span></span><span class="hljs-tag">&gt;</span></span>AIR-CT5508-K9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PID</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SN</span></span></span><span class="hljs-tag">&gt;</span></span>FCJ00000000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SN</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UDI</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SOURCE</span></span></span><span class="hljs-tag">&gt;</span></span>Cisco HQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SURCE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CREATE_DATE</span></span></span><span class="hljs-tag">&gt;</span></span>2010-10-20T18:29:16<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CREATE_DATE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE_HASH</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hashAlgo</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SHA1"</span></span></span><span class="hljs-tag">&gt;</span></span>Eb86wsdgdsheIdRgxu8SYjnV2kug=<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE_HASH</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TYPE</span></span></span><span class="hljs-tag">&gt;</span></span>EXTENSION<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TYPE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXPIRATION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DAYS</span></span></span><span class="hljs-tag">&gt;</span></span>60<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DAYS</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EXPIRATION</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EULA</span></span></span><span class="hljs-tag">&gt;</span></span>YES<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EULA</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[11 base 1.0 LONG TRIAL DISABLED 1440 DISABLED STANDALONE ADD INFINITE_KEYS INFINITE_KEYS NEVER NEVER NiL SLM_CODE CL_ND_LCK NiL *1B2UN9YKWSE6TLX400 NiL NiL NiL 5_MINS &lt;UDI&gt;&lt;PID&gt;AIR-CT5508-K9&lt;/PID&gt;&lt;SN&gt;FCJ00000000&lt;/SN&gt;&lt;/UDI&gt; IoNEjaiZMvr:SUgPfi7IL7DfUgmILSlzRAumZl96TmLQxk8wOUr9YwwsYn0pd5vsVYhn9K2G:rYugiUzNI2SeH3jL0Fvj9boyHdSgN9heQmw3F1APru5,qKFhvCKGi16CO3A$&lt;WLC&gt;AQEBIf8B///vAvN3WYGs8UKGLXXeaNhRdwitkjqL7s+cOPCdiN04GY47UbtfByUZYOemWEq6ljxHebPkGlARtYd1UQO7GJ3KnufZ9oZ6JdFniDf5HrQ8DrXdpCz5RgZE+y8fbN200xiXA5cB3fwcJqoPIFZm2HmD1qFfsyTAzuio66t6Xk5y8xo1lbVhvoh/FZfy5iRY3oE=&lt;/WLC&gt;]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LICENSE_LINE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USER_MODIFIABLE_COMMENT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fieldRestrictions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Max 99 ASCII characters in length."</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USER_MODIFIABLE_COMMENT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_LICENSE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CISCO_WT_ARTIFACTS</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  It is tied to the serial number of the device, and contains some analogue of the digital signature, which carries the hash of the lines indicated at the beginning of the license.  When an attempt is made to download a license to the controller (switchdrvr), the latter checks it through interaction with a separate process running the license manager (licensed).  There is also a command line utility, license_cli.  "Manual" interventions in the license file lead to a processing error.  Client and server exchange protocol is not known (goes through unix domain socket).  Since licensed is a 32-bit application, it is easily disassembled by interactive disassemblers / debuggers like <a href="https://www.hex-rays.com/products/ida/index.shtml">Ida Pro / HexRays</a> into pseudo- <a href="https://www.hex-rays.com/products/ida/index.shtml">source</a> C texts, analysis of which clearly indicates the use of SafeNet's <a href="http://www.safenet-inc.com/software-monetization/sentinel-rms-embedded/">Sentinel</a> encryption libraries and signatures.  For further investigation of my knowledge is not enough, but I do not need it.  As far as we know, there is no license generator yet, but <s>self-censorship</s> . <br><br>  It should be noted that Cisco's Java server systems (CUCM, ACS, WCS, Prime, MSE, NAC, and many others) use a similar license file format, with a digital signature.  However, where there is Java, there are decompilers.  It is enough just to find out what platform parameters and properties (features) (as strings) are searched for in the license, and that flexlm.jar is used to verify the signature, with all the ensuing consequences.  However, I urge you to live honestly. <br><br><h4>  Afterword </h4><br>  I hope this material will relieve users in general of good wireless systems based on the Cisco WLC controllers from a number of difficult issues of operation, troubleshooting, software updates.  On the other hand, the completely trivial method of reverse engineering of firmware described here can help an inquisitive researcher to work on similar Linux-based devices. <br>  This post does not aim to compare the advantages and disadvantages of wireless systems from different manufacturers and is not agitating for anyone.  I am in no way affiliated with Cisco Systems. <br>  I learned all of the above as a result of a long study of the files that everyone can download on the Internet, documentation, and based on personal experience.  I urge to use this post only for the purpose of troubleshooting and self-education.  For learning purposes, a virtual controller demo is sufficient.  A license for 5 access points to a (free) virtual controller costs $ 750 (no discount).  The used points of the old, but still supported models are cheap - I took three pieces of 1131a / g for 2500 rubles on eBay.  with delivery. </div><p>Source: <a href="https://habr.com/ru/post/197906/">https://habr.com/ru/post/197906/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197894/index.html">I'll get there</a></li>
<li><a href="../197896/index.html">Primitive game design. Turn-based card game development. Part 2: From the skeleton to the muscles</a></li>
<li><a href="../197900/index.html">Mysterious devices ‚Äì4</a></li>
<li><a href="../197902/index.html">Startup Game at Java Seminars</a></li>
<li><a href="../197904/index.html">A magic keyword - VALUES ...</a></li>
<li><a href="../197908/index.html">Fortuna: paranoid random number generator</a></li>
<li><a href="../197910/index.html">Application rejects in AppStore</a></li>
<li><a href="../197912/index.html">Battlefield - Hypervisor</a></li>
<li><a href="../197914/index.html">Configuring I2P Out Proxy</a></li>
<li><a href="../197918/index.html">RevealApp - Firebug for iOS applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>