<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using XmlRPC through a proxy server for a host with authorization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Immediately make a reservation that we are talking about Python 2.X. 

 The task: to force xmlrpclib in Python to work through a proxy server with Bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using XmlRPC through a proxy server for a host with authorization</h1><div class="post__text post__text-html js-mediator-article">  Immediately make a reservation that we are talking about Python 2.X. <br><br>  The task: to force <a href="http://docs.python.org/library/xmlrpclib.html">xmlrpclib</a> in Python to work through a proxy server with Basic and NTLM authorization, as well as with a host requiring authentication and Cookies. <br><br>  I needed this for the bugreport system in our application, where when sending an error message to <a href="http://trac.edgewall.org/">TRAC</a> , a ticket with a description, logs, and other things should be created.  Communication with TRAC goes through xmlRPC (using <a href="http://trac-hacks.org/wiki/XmlRpcPlugin">XmlRpcPlugin</a> ).  Application users mainly work behind a proxy server within the corporate network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is <a href="http://docs.python.org/library/urllib.html">accomplished</a> through the creation of a transport based on <a href="http://docs.python.org/library/urllib.html">urllib</a> , which redirects XML requests through a proxy server. <br><br>  On the Internet you can find a <a href="http://code.activestate.com/recipes/523016-using-xmlrpc-with-authenticated-proxy-server/">couple of examples</a> to support a proxy without authorization, written on the <a href="http://docs.python.org/library/urllib.html">first urllib</a> .  At first I tried to take this example and add authorization to it, but in the end it became clear that it is better to rewrite it under <a href="http://docs.python.org/library/urllib2.html">urllib2</a> , where it is much easier to do this. <br><br>  This transport option also supports operation without a proxy server (if a direct connection is available, and the specified proxy server is not, then the connection will occur directly - this is a feature of urllib2). <br><br>  <a href="http://code.google.com/p/python-ntlm/">Python-ntlm is</a> used to support NTLM authentication. <br><br>  Just in case, I warn you that the code is presented only as an example and requires mandatory testing and modification for your needs. <br><br>  Example of use: <br><br><blockquote><code><a href="http://s-c.me/18495/s"></a> <a href="http://s-c.me/18495/h"></a> <font color="black">Copy Source | Copy HTML serverURL = <font color="#008000">"http://some.server.com/xmlrpc"</font> xmlTransport= UrllibTransport() server = <b>xmlrpclib</b> .ServerProxy(serverURL, transport = xmlTransport)</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/18495/s"></a> <a href="http://s-c.me/18495/h"></a> Copy Source | Copy HTML serverURL = <font color="#008000">"http://some.server.com/xmlrpc"</font> xmlTransport= UrllibTransport() server = <b>xmlrpclib</b> .ServerProxy(serverURL, transport = xmlTransport)</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/18495/s"></a> <a href="http://s-c.me/18495/h"></a> Copy Source | Copy HTML serverURL = <font color="#008000">"http://some.server.com/xmlrpc"</font> xmlTransport= UrllibTransport() server = <b>xmlrpclib</b> .ServerProxy(serverURL, transport = xmlTransport)</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/18495/s"></a> <a href="http://s-c.me/18495/h"></a> Copy Source | Copy HTML serverURL = <font color="#008000">"http://some.server.com/xmlrpc"</font> xmlTransport= UrllibTransport() server = <b>xmlrpclib</b> .ServerProxy(serverURL, transport = xmlTransport)</font></code> </li> </ol></blockquote><br><br><a name="habracut"></a><br><br>  The transport script itself: <br><br><blockquote> <code><a href="http://s-c.me/18496/s"></a> <a href="http://s-c.me/18496/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#696969"># - * - coding: utf8 - * -</font> </li><li></li><li>  <font color="#696969"># Requires python-ntlm (http://code.google.com/p/python-ntlm/) package</font> </li><li>  <font color="#0000ff">from</font> ntlm <font color="#0000ff">import</font> HTTPNtlmAuthHandler </li><li></li><li>  <font color="#0000ff">import</font> sys, os, tempfile, pickle </li><li>  <font color="#0000ff">import</font> xmlrpclib, getpass, string </li><li>  <font color="#0000ff">import</font> base64, urllib2, cookielib </li><li>  <font color="#0000ff">from</font> urllib <font color="#0000ff">import</font> unquote, splittype, splithost, getproxies </li><li>  <font color="#0000ff">import</font> urllib2 </li><li></li><li>  <font color="#696969">##################################</font> </li><li></li><li>  useProxy = True </li><li>  useAuthOnProxy = True </li><li></li><li>  proxyUser = <font color="#008000">"username"</font> </li><li>  proxyPassword = <font color="#008000">"password"</font> </li><li>  proxyServer = <font color="#008000">"http://proxy.org:37128"</font> </li><li></li><li>  httpAuthName = <font color="#008000">"user"</font> </li><li>  httpAuthPassword = <font color="#008000">"password"</font> </li><li>  serverTopLevelURL = <font color="#008000">"http://my.server.com"</font> </li><li></li><li>  <font color="#696969">##################################</font> </li><li></li><li>  <font color="#0000ff">class</font> <font color="#cc6633">UrllibTransport</font> ( <b>xmlrpclib</b> .Transport): </li><li>  <font color="#0000ff">def</font> <font color="#cc6633">request</font> (self, host, handler, request_body, verbose = <font color="#008000">0</font> ): </li><li>  <b>self</b> .verbose = verbose </li><li></li><li>  <font color="#0000ff">if</font> useProxy: </li><li>  <font color="#0000ff">if</font> useAuthOnProxy: </li><li>  <b>self</b> .proxyurl = <font color="#008000">"http: //"</font> + proxyUser + <font color="#008000">":"</font> \ </li><li>  + proxyPassword + <font color="#008000">"@"</font> \ </li><li>  + proxyServer [ <font color="#008000">7</font> :] </li><li>  <font color="#0000ff">else</font> : </li><li>  <b>self</b> .proxyurl = proxyServer </li><li>  <font color="#0000ff">else</font> : </li><li>  <b>self</b> .proxyurl = None </li><li></li><li>  puser_pass = None </li><li></li><li>  <font color="#0000ff">if</font> <b>self</b> .proxyurl <font color="#0000ff">is not</font> None: </li><li>  type r_type = splittype ( <b>self</b> .proxyurl) </li><li>  phost, XXX = splithost (r_type) </li><li></li><li>  <font color="#0000ff">if</font> <font color="#008000">'@'</font> <font color="#0000ff">in</font> phost: </li><li>  user_pass, phost = phost.split ( <font color="#008000">'@'</font> , <font color="#008000">1</font> ) </li><li>  <font color="#0000ff">if</font> <font color="#008000">':'</font> <font color="#0000ff">in</font> user_pass: </li><li>  user, password = user_pass.split ( <font color="#008000">':'</font> , <font color="#008000">1</font> ) </li><li>  puser_pass = <b>base64</b> .encodestring ( </li><li>  <font color="#008000">'% s:% s'</font> % (unquote (user), unquote (password))). strip () </li><li></li><li>  proxies = { <font color="#008000">'http'</font> : <font color="#008000">'http: //% s'</font> % phost} </li><li></li><li>  host = unquote (host) </li><li>  address = <font color="#008000">"http: //% s% s"</font> % (host, handler) </li><li></li><li>  <font color="#cc6633">request</font> = <b>urllib2</b> .Request (address) </li><li>  <font color="#cc6633">request</font> .add_data (request_body) </li><li>  <font color="#cc6633">request</font> .add_header ( <font color="#008000">'User-agent'</font> , <b>self</b> .user_agent) </li><li>  <font color="#cc6633">request</font> .add_header ( <font color="#008000">"Content-Type"</font> , <font color="#008000">"text / xml"</font> ) </li><li></li><li>  <font color="#696969"># HTTP Auth</font> </li><li>  password_mgr = <b>urllib2</b> .HTTPPasswordMgrWithDefaultRealm () </li><li>  top_level_url = serverTopLevelURL </li><li>  password_mgr.add_password (None, </li><li>  top_level_url, </li><li>  httpAuthName, </li><li>  httpAuthPassword) </li><li>  handler = <b>urllib2</b> .HTTPBasicAuthHandler (password_mgr) </li><li></li><li>  <font color="#696969"># Cookies</font> </li><li>  cj = <b>cookielib</b> .CookieJar () </li><li></li><li>  <font color="#0000ff">if</font> puser_pass: </li><li>  <font color="#696969"># NTLM</font> </li><li>  passman = <b>urllib2</b> .HTTPPasswordMgrWithDefaultRealm () </li><li>  passman.add_password (None, serverTopLevelURL, user, password) </li><li></li><li>  authNTLM = HTTPNtlmAuthHandler.HTTPNtlmAuthHandler (passman) </li><li>  <font color="#cc6633">request</font> .add_header ( <font color="#008000">'Proxy-authorization'</font> , <font color="#008000">'Basic'</font> + puser_pass) </li><li></li><li>  proxy_support = <b>urllib2</b> .ProxyHandler (proxies) </li><li></li><li>  opener = <b>urllib2</b> .build_opener (handler, proxy_support, </li><li>  <b>urllib2</b> .HTTPCookieProcessor (cj), </li><li>  authNTLM) </li><li>  <font color="#0000ff">elif</font> <b>self</b> .proxyurl: </li><li>  <font color="#696969"># Proxy without auth</font> </li><li>  proxy_support = <b>urllib2</b> .ProxyHandler (proxies) </li><li>  opener = <b>urllib2</b> .build_opener (proxy_support, </li><li>  handler, </li><li>  <b>urllib2</b> .HTTPCookieProcessor (cj)) </li><li>  <font color="#0000ff">else</font> : </li><li>  <font color="#696969"># Direct connection</font> </li><li>  proxy_support = <b>urllib2</b> .ProxyHandler ({}) </li><li>  opener = <b>urllib2</b> .build_opener (proxy_support, </li><li>  handler, </li><li>  <b>urllib2</b> .HTTPCookieProcessor (cj)) </li><li></li><li>  <b>urllib2</b> .install_opener (opener) </li><li>  response = <b>urllib2</b> .urlopen ( <font color="#cc6633">request</font> ) </li><li></li><li>  <font color="#0000ff">return</font> <b>self</b> .parse_response (response) </li></ol></blockquote><br><br>  PS <br>  For anyone interested in urllib2, I recommend to look at <a href="http://www.voidspace.org.uk/python/articles/urllib2.shtml">urllib2 - The Missing Manual</a> - an excellent document, which describes in detail the features of working with it, in particular, error handling and exceptions. </div><p>Source: <a href="https://habr.com/ru/post/116867/">https://habr.com/ru/post/116867/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116858/index.html">Architecture Orchard CMS. Security and Development Concepts</a></li>
<li><a href="../116859/index.html">Autistic Gospel</a></li>
<li><a href="../116860/index.html">Canvas step by step: PONG</a></li>
<li><a href="../116861/index.html">Light and lighting</a></li>
<li><a href="../116862/index.html">Dapper.NET - ‚Äúmicro-ORM‚Äù on which StackOverflow works</a></li>
<li><a href="../116868/index.html"># 404fest: Section Design</a></li>
<li><a href="../116869/index.html">Droider Chart 46. The hit parade of Android applications</a></li>
<li><a href="../116870/index.html">New version of ASP.NET AJAX Control Toolkit released</a></li>
<li><a href="../116872/index.html">A simple example of using WCF in Visual Studio 2010. Part 2</a></li>
<li><a href="../116874/index.html">What tools do you use to measure performance?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>