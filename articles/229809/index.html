<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Formatting Images with Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will learn how to resize and crop images using an element  HTML5, , , . 
 
 - . , . , . 
  
 canvas , , . , , . 
 
 . . , , .   , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Formatting Images with Canvas</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1fb/6fe/81b/1fb6fe81b5a94eb19e9bec256be84953.jpg"><br><br>  In this article, we will learn how to resize and crop images using an element <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code></code> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code class="html"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> &lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt; <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </h4> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> <pre> <code class="hljs matlab"><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class=<span class="hljs-string"><span class="hljs-string">"resize-image"</span></span> src=<span class="hljs-string"><span class="hljs-string">"image.jpg"</span></span> alt=<span class="hljs-string"><span class="hljs-string">"Image"</span></span> /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: <span class="hljs-number"><span class="hljs-number">2</span></span>px dashed rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); }</code> <br> <br>        <span class="hljs-string"><span class="hljs-string">'resize handles'</span></span>.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: <span class="hljs-number"><span class="hljs-number">10</span></span>px; height: <span class="hljs-number"><span class="hljs-number">10</span></span>px; background: rgba(<span class="hljs-number"><span class="hljs-number">222</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">.9</span></span>); z-index: <span class="hljs-number"><span class="hljs-number">999</span></span>; } .resize-handle-nw { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: nw-resize; } .resize-handle-sw { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; left: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: sw-resize; } .resize-handle-ne { top: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: ne-resize; } .resize-handle-se { bottom: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; right: <span class="hljs-number"><span class="hljs-number">-5</span></span>px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function"> = {}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constrain</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_width</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_height</span></span></span><span class="hljs-function"> = 60, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_width</span></span></span><span class="hljs-function"> = 800, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_height</span></span></span><span class="hljs-function"> = 900, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; }); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($('.resize-image')</span></span></span><span class="hljs-function">);</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,    .     ,    ,        .     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jQuery</span></span></span><span class="hljs-function">  ,               . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeableImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function"> { // ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">When</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">always</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">original</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image_target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handles</span></span></span><span class="hljs-function"> $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;div class="resize-container"&gt;&lt;/div&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">variable</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.resize-container')</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; }; //... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   ,        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', resizing)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endResize)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', resizing)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">            .      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initial</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">details</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse_y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">This</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mobile</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safari</span></span></span><span class="hljs-function"> // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">For</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">some</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reason</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">does</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allow</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">direct</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">property</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(typeof e.originalEvent.touches !== 'undefined')</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; $.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.originalEvent.touches, function(i, ob)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function"> = {}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[i]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> = 0+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ob</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evnt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> -  .     .             . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Shift</span></span></span><span class="hljs-function">  . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">           . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><b><span class="hljs-function"><span class="hljs-function"> </span></span></b><span class="hljs-function"><span class="hljs-function"> :      ,        ,         </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canvas</span></span></span><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .      ,    .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDataURL</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded</span></span></span><span class="hljs-function">   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"><span class="hljs-function"><span class="hljs-function"></span></span></a><span class="hljs-function"><span class="hljs-function">        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(orig_src, 0, 0, width, height)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('src', resize_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ?   :          ,        </span></span><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CORS</span></span></span></span></a><span class="hljs-function"><span class="hljs-function"> .    ,       '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tainted</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">'. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">       .     .           ,     .    ,   . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    ,       ,        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     ,         .    </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizing</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={},</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-function">=$</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || e.originalEvent.touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || e.originalEvent.touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Position</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">differently</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">depending</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corner</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dragged</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constraints</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-se')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-sw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_top</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-nw')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.x - event_state.container_left)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(event_state.evnt.target)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('resize-handle-ne')</span></span></span><span class="hljs-function"> ){ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mouse.y - event_state.container_top)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_left</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((width / orig_src.width * orig_src.height)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">); } } // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Optionally</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maintain</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aspect</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(constrain || e.shiftKey)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> / </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig_src</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height)</span></span></span><span class="hljs-function">{ // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">will</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">re</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drag</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({'left': left, 'top': top})</span></span></span><span class="hljs-function">; } }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resize</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,      , , , ,    "".        .      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown', 'img', startMoving)</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove', moving)</span></span></span><span class="hljs-function">; };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">       .        ,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><br><span class="hljs-function"><span class="hljs-function"> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="html"><span class="hljs-function"><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span><span class="hljs-function">&gt; &lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">class</span></span></span><span class="hljs-function">="</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function">"&gt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crop</span></span></span><span class="hljs-function">&lt;/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">button</span></span></span><span class="hljs-function">&gt;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  ,          ,    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="css"><span class="hljs-function"><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 50%; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -100</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 200</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">solid</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizing</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">box</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pointer</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">events</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function">, .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">content</span></span></span><span class="hljs-function">: ''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">: 40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">: 204</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dashed</span></span></span><span class="hljs-function"> 2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgba</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80,.9)</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlay</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inner</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">after</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: -40</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margin</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">: -2</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; } .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">position</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">absolute</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function">: 6</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function"> 10</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">z</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function">: 999; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(222,60,80)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">none</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">radius</span></span></span><span class="hljs-function">: 5</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">px</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-function">: #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FFF</span></span></span><span class="hljs-function">; }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JavaScript</span></span></span><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ //... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.js-crop')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('click', crop)</span></span></span><span class="hljs-function">; }; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> - $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('.overlay')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('canvas')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop_canvas</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('2d')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image_target, left, top, width, height, 0, 0, width, height)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(crop_canvas.toDataURL("image/png")</span></span></span><span class="hljs-function">); }</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crop</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .    ,          . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">        </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawImage</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">.  -  .   - ,   .   -  ,       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canvas</span></span></span><span class="hljs-function">,     . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      </span></span><br><span class="hljs-function"><span class="hljs-function">    .        . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">    - </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> .   ,      </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchdown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span></span></span><s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   </span></span></span></span></s><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">. </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchstart</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchend</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,     </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousedown</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,  </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouseup</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touchmove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mousemove</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-function">// </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', '.resize-handle', startResize)</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousedown touchstart', 'img', startMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> ... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endResize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; //</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">In</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endMoving</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">... $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mouseup touchend', endMoving)</span></span></span><span class="hljs-function">; $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(document)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('mousemove touchmove', moving)</span></span></span><span class="hljs-function">;</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">      ,       ""     .        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hammer</span></span></span><span class="hljs-function">,    . ,      ,       . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> , , ,   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveEventState</span></span></span></span></code><span class="hljs-function"><span class="hljs-function">      .    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">     " "    .     ,        .   </span></span><code><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span></span></code><span class="hljs-function"><span class="hljs-function"> : </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">={}, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopPropagation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientX || e.pageX || touches[0].clientX)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e.clientY || e.pageY || touches[0].clientY)</span></span></span><span class="hljs-function"> + $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left )</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mouse</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> - </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( event_state.mouse_y - event_state.container_top )</span></span></span><span class="hljs-function"> }); // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Watch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinch</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zoom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gesture</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moving</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1)</span></span></span><span class="hljs-function">{ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_width</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">container_height</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event_state</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientX</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">originalEvent</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[0]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">touches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1]</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientY</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a + b )</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist2</span></span></span><span class="hljs-function"> /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist1</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ratio</span></span></span><span class="hljs-function">; // </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">To</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improve</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performance</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">you</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">might</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">how</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">often</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resizeImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(width, height)</span></span></span><span class="hljs-function">; } };</span></span></code><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">                . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">   .    </span></span><a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b><span class="hljs-function"><span class="hljs-function"></span></span></b></a><span class="hljs-function"><span class="hljs-function">  </span></span><a href=""><b><span class="hljs-function"><span class="hljs-function">  </span></span></b></a><span class="hljs-function"><span class="hljs-function"> . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Chrome</span></span></span><span class="hljs-function">        "",  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Firefox</span></span></span><span class="hljs-function">    . </span></span><br><span class="hljs-function"><span class="hljs-function"> </span></span><br><span class="hljs-function"><span class="hljs-function"> ,    .</span></span></code> </pre> <code><code> HTML5,     ,      ,   . <br> <br>       -    .      ,           .   ,          . <br> <a name="habracut"></a> <br>      canvas</code> ,     ,    .     ,       ,       . <br> <br>            .          .     ,     ,     .      <a href="http://stackoverflow.com/questions/18922880/html5-canvas-resize-downscale-image-high-quality">     </a> ,       . <br> <br>      ! <br> <br>  <br>          : <br> <code class="html">&lt;img class="resize-image" src="image.jpg" alt="Image" /&gt;</code> <br> <br> !  HTML   . <br> <br> CSS <br> CSS-     .    <code>resize-container</code>   . <br> <br> <code class="css">.resize-container { position: relative; display: inline-block; cursor: move; margin: 0 auto; } .resize-container img { display: block } .resize-container:hover img, .resize-container:active img { outline: 2px dashed rgba(222,60,80,.9); }</code> <br> <br>        'resize handles'.   ,    ,       . <br> <br> <code class="css">.resize-handle-ne, .resize-handle-ne, .resize-handle-se, .resize-handle-nw, .resize-handle-sw { position: absolute; display: block; width: 10px; height: 10px; background: rgba(222,60,80,.9); z-index: 999; } .resize-handle-nw { top: -5px; left: -5px; cursor: nw-resize; } .resize-handle-sw { bottom: -5px; left: -5px; cursor: sw-resize; } .resize-handle-ne { top: -5px; right: -5px; cursor: ne-resize; } .resize-handle-se { bottom: -5px; right: -5px; cursor: se-resize; }</code> <br> <br> JavaScript <br>        Canvas. <br> <br> <code class="javascript">var resizeableImage = function(image_target) { var $container, orig_src = new Image(), image_target = $(image_target).get(0), event_state = {}, constrain = false, min_width = 60, min_height = 60, max_width = 800, max_height = 900, resize_canvas = document.createElement('canvas'); }); resizeableImage($('.resize-image'));</code> <br> <br>    ,    .     ,    ,        .     jQuery  ,               . <br> <br> <code class="javascript">var resizeableImage = function(image_target) { // ... init = function(){ // Create a new image with a copy of the original src // When resizing, we will always use this original copy as the base orig_src.src=image_target.src; // Add resize handles $(image_target).wrap('&lt;div class="resize-container"&gt;&lt;/div&gt;') .before('&lt;span class="resize-handle resize-handle-nw"&gt;&lt;/span&gt;') .before('&lt;span class="resize-handle resize-handle-ne"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-se"&gt;&lt;/span&gt;') .after('&lt;span class="resize-handle resize-handle-sw"&gt;&lt;/span&gt;'); // Get a variable for the container $container = $(image_target).parent('.resize-container'); // Add events $container.on('mousedown', '.resize-handle', startResize); }; //... init(); }</code> <br> <br>  <code>startResize</code>  <code>endResize</code>   ,        ,     . <br> <br> <code class="javascript">startResize = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', resizing); $(document).on('mouseup', endResize); }; endResize = function(e){ e.preventDefault(); $(document).off('mouseup touchend', endResize); $(document).off('mousemove touchmove', resizing); };</code> <br> <br>            .      <code>event_state</code>     . <br> <br> <code class="javascript">saveEventState = function(e){ // Save the initial event details and container state event_state.container_width = $container.width(); event_state.container_height = $container.height(); event_state.container_left = $container.offset().left; event_state.container_top = $container.offset().top; event_state.mouse_x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); event_state.mouse_y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // This is a fix for mobile safari // For some reason it does not allow a direct copy of the touches property if(typeof e.originalEvent.touches !== 'undefined'){ event_state.touches = []; $.each(e.originalEvent.touches, function(i, ob){ event_state.touches[i] = {}; event_state.touches[i].clientX = 0+ob.clientX; event_state.touches[i].clientY = 0+ob.clientY; }); } event_state.evnt = e; }</code> <br> <br>  <code>resizing</code> -  .     .             . <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>           Shift  . <br> <br>           . <br> <br> <b> </b> :      ,        ,         <code>resizeImage</code>     . <br> <br>    <br>    Canvas   ,   <code>drawImage</code> .      ,    .   <code>toDataURL</code>   Base64-encoded   . <br> <br> <a href="http://tympanus.net/codrops/2014/10/30/resizing-cropping-images-canvas/"></a>        . <br> <br> <code class="javascript">resizeImage = function(width, height){ resize_canvas.width = width; resize_canvas.height = height; resize_canvas.getContext('2d').drawImage(orig_src, 0, 0, width, height); $(image_target).attr('src', resize_canvas.toDataURL("image/png")); };</code> <br> <br>  ?   :          ,        <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a> .    ,       'tainted canvas'. <br> <br>     <br> <br>       .     .           ,     .    ,   . <br> <br>    ,       ,        . <br> <br> <img src="//habrastorage.org/files/7a5/2fc/9bb/7a52fc9bbb524e3b9f7211aaa3c21350.png"> <br> <br>     ,         .    <code>resizing</code> : <br> <br> <code class="javascript">resizing = function(e){ var mouse={},width,height,left,top,offset=$container.offset(); mouse.x = (e.clientX || e.pageX || e.originalEvent.touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || e.originalEvent.touches[0].clientY) + $(window).scrollTop(); // Position image differently depending on the corner dragged and constraints if( $(event_state.evnt.target).hasClass('resize-handle-se') ){ width = mouse.x - event_state.container_left; height = mouse.y - event_state.container_top; left = event_state.container_left; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-sw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = mouse.y - event_state.container_top; left = mouse.x; top = event_state.container_top; } else if($(event_state.evnt.target).hasClass('resize-handle-nw') ){ width = event_state.container_width - (mouse.x - event_state.container_left); height = event_state.container_height - (mouse.y - event_state.container_top); left = mouse.x; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } else if($(event_state.evnt.target).hasClass('resize-handle-ne') ){ width = mouse.x - event_state.container_left; height = event_state.container_height - (mouse.y - event_state.container_top); left = event_state.container_left; top = mouse.y; if(constrain || e.shiftKey){ top = mouse.y - ((width / orig_src.width * orig_src.height) - height); } } // Optionally maintain aspect ratio if(constrain || e.shiftKey){ height = width / orig_src.width * orig_src.height; } if(width &gt; min_width &amp;&amp; height &gt; min_height &amp;&amp; width &lt; max_width &amp;&amp; height &lt; max_height){ // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); // Without this Firefox will not re-calculate the the image dimensions until drag end $container.offset({'left': left, 'top': top}); } }</code> <br> <br>   ,   <code>resize-handle</code>  ,    . <br> <br>   <br> ,      , , , ,    "".        .      . <br> <br> <code class="javascript">init = function(){ //... $container.on('mousedown', 'img', startMoving); }</code> <br> <br>     <code>startMoving</code>  <code>endMoving</code> ,   <code>startResize</code>  <code>endResize</code> . <br> <br> <code class="javascript">startMoving = function(e){ e.preventDefault(); e.stopPropagation(); saveEventState(e); $(document).on('mousemove', moving); $(document).on('mouseup', endMoving); }; endMoving = function(e){ e.preventDefault(); $(document).off('mouseup', endMoving); $(document).off('mousemove', moving); };</code> <br> <br>   <code>moving</code>       .        ,     . <br> <br> <code class="javascript">moving = function(e){ var mouse={}; e.preventDefault(); e.stopPropagation(); mouse.x = (e.clientX || e.pageX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); };</code> <br> <br>   <br> ,     ,    .  ,        ,    ,      ,      .       ,  , ,    ,      . <br> <br>      HTML : <br> <br> <code class="html">&lt;div class="overlay"&gt; &lt;div class="overlay-inner"&gt; &lt;/div&gt; &lt;/div&gt; &lt;button class="btn-crop js-crop"&gt;Crop&lt;/button&gt;</code> <br> <br>  ,          ,    . <br> <br> <code class="css">.overlay { position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; z-index: 999; width: 200px; height: 200px; border: solid 2px rgba(222,60,80,.9); box-sizing: content-box; pointer-events: none; } .overlay:after, .overlay:before { content: ''; position: absolute; display: block; width: 204px; height: 40px; border-left: dashed 2px rgba(222,60,80,.9); border-right: dashed 2px rgba(222,60,80,.9); } .overlay:before { top: 0; margin-left: -2px; margin-top: -40px; } .overlay:after { bottom: 0; margin-left: -2px; margin-bottom: -40px; } .overlay-inner:after, .overlay-inner:before { content: ''; position: absolute; display: block; width: 40px; height: 204px; border-top: dashed 2px rgba(222,60,80,.9); border-bottom: dashed 2px rgba(222,60,80,.9); } .overlay-inner:before { left: 0; margin-left: -40px; margin-top: -2px; } .overlay-inner:after { right: 0; margin-right: -40px; margin-top: -2px; } .btn-crop { position: absolute; vertical-align: bottom; right: 5px; bottom: 5px; padding: 6px 10px; z-index: 999; background-color: rgb(222,60,80); border: none; border-radius: 5px; color: #FFF; }</code> <br> <br>   JavaScript : <br> <br> <code class="javascript">init = function(){ //... $('.js-crop').on('click', crop); }; crop = function(){ var crop_canvas, left = $('.overlay').offset().left - $container.offset().left, top = $('.overlay').offset().top - $container.offset().top, width = $('.overlay').width(), height = $('.overlay').height(); crop_canvas = document.createElement('canvas'); crop_canvas.width = width; crop_canvas.height = height; crop_canvas.getContext('2d').drawImage(image_target, left, top, width, height, 0, 0, width, height); window.open(crop_canvas.toDataURL("image/png")); }</code> <br> <br>  <code>crop</code>   <code>resizeImage</code> .    ,          . <br> <br>        <code>drawImage</code>  canvas.  -  .   - ,   .   -  ,       canvas,     . <br> <br>      <br>    .        . <br> <br>  <code>mousedown</code>  <code>mouseup</code>    - <code>touchstart</code>  <code>touchend</code> ,   <code>mousemove</code>  <code>touchmove</code> .   ,      <code>touchup</code>  <code>touchdown</code> ( <s>   </s> ). <br> <br>   <code>touchstart</code>  <code>touchend</code> ,     <code>mousedown</code> ,  <code>mouseup</code>   <code>touchmove</code> ,   <code>mousemove</code> . <br> <br> <code class="javascript">// In init()... $container.on('mousedown touchstart', '.resize-handle', startResize); $container.on('mousedown touchstart', 'img', startMoving); //In startResize() ... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endResize()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving); //In startMoving()... $(document).on('mousemove touchmove', moving); $(document).on('mouseup touchend', endMoving); //In endMoving()... $(document).off('mouseup touchend', endMoving); $(document).off('mousemove touchmove', moving);</code> <br> <br>      ,       ""     .        Hammer,    . ,      ,       . <br> <br> , , ,   <code>saveEventState</code>      .    . <br> <br>     " "    .     ,        .   <code>moving</code> : <br> <br> <code class="javascript">moving = function(e){ var mouse={}, touches; e.preventDefault(); e.stopPropagation(); touches = e.originalEvent.touches; mouse.x = (e.clientX || e.pageX || touches[0].clientX) + $(window).scrollLeft(); mouse.y = (e.clientY || e.pageY || touches[0].clientY) + $(window).scrollTop(); $container.offset({ 'left': mouse.x - ( event_state.mouse_x - event_state.container_left ), 'top': mouse.y - ( event_state.mouse_y - event_state.container_top ) }); // Watch for pinch zoom gesture while moving if(event_state.touches &amp;&amp; event_state.touches.length &gt; 1 &amp;&amp; touches.length &gt; 1){ var width = event_state.container_width, height = event_state.container_height; var a = event_state.touches[0].clientX - event_state.touches[1].clientX; a = a * a; var b = event_state.touches[0].clientY - event_state.touches[1].clientY; b = b * b; var dist1 = Math.sqrt( a + b ); a = e.originalEvent.touches[0].clientX - touches[1].clientX; a = a * a; b = e.originalEvent.touches[0].clientY - touches[1].clientY; b = b * b; var dist2 = Math.sqrt( a + b ); var ratio = dist2 /dist1; width = width * ratio; height = height * ratio; // To improve performance you might limit how often resizeImage() is called resizeImage(width, height); } };</code> <br> <br>                . <br> <br> <img src="//habrastorage.org/files/8e9/a9a/6bb/8e9a9a6bb4bd4bb19cfda1ab3665cfb1.jpg"> <br> <br>   .    <a href="http://tympanus.net/Tutorials/ImageResizeCropCanvas/"><b></b></a>  <a href=""><b>  </b></a> . <br> <br>    Chrome        "",  Firefox    . <br> <br> ,    .</code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/229809/">https://habr.com/ru/post/229809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229797/index.html">Vladimir Stasevich (Bank XXI, Sberbank): "We must prepare and prepare for the next stage of evolution - mass mobile banking"</a></li>
<li><a href="../229799/index.html">Go + Heroku: web application deployment</a></li>
<li><a href="../229801/index.html">Materials for the manufacture of mobile devices</a></li>
<li><a href="../229803/index.html">We treat SQLite in Monotouch or the practical use of reflection</a></li>
<li><a href="../229805/index.html">Visas for startups: how to open your own business abroad (part 2)</a></li>
<li><a href="../229811/index.html">WinJS on Windows Phone 8.1</a></li>
<li><a href="../229813/index.html">My corporate communications experience in Social Media</a></li>
<li><a href="../229815/index.html">Available for download WordPress 4.0 Beta 1</a></li>
<li><a href="../229817/index.html">Determination of the dominant signs of classification and the development of a mathematical model of facial expressions</a></li>
<li><a href="../229819/index.html">Dialectics of the SATA Revolution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>