<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JVM is not so hard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Basically the answer to the fact that Clojure is a JVM. Like, this crap so hard. 

 It appeared on the ZA Tech channel in the Slack group a few weeks ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JVM is not so hard</h1><div class="post__text post__text-html js-mediator-article">  <i>Basically the answer to the fact that Clojure is a JVM.</i>  <i>Like, this crap so hard.</i> <br><br>  It appeared on the <a href="http://zatech.co.za/">ZA Tech</a> channel in the Slack group a few weeks ago.  During some Clojure speeches, the speakers made such a remark again and again. <br><br>  On this occasion, I <a href="https://zatech.slack.com/archives/developers/p1481966328001513">spoke at Slack</a> .  Now I will write for wider reading and discussion. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Foreword </h1><br>  I also thought that the JVM was heavy.  This was in the early 2000s, in comparison with PHP.  There were other heavyweights, like .NET and ColdFusion.  There were lighter alternatives like Perl and Python, but then I was on Windows, so ActivePerl and ActivePython were also a bit heavy. <br><br>  I first overcome my ‚Äúfear‚Äù of the JVM when I deployed a small JRuby production application on Heroku.  This little monster had to perform only one task per day.  He generated a number of PDFs, then uploaded them to iSign (currently not functioning) for storage and distribution.  ISign itself was a classic Rails application hosted on three AMIs.  This little dinosaur in the stock JVM (with the exception of <code>-server -Xmx=512M</code> ) produced PDFs so quickly that it literally killed the three-quanter cluster with each launch. <br><br>  I still thought he was a bit heavy at work, but I fell in love with this ugly duckling. <br><a name="habracut"></a><br>  I more or less followed the developments in the development of JRuby and success stories and had a wonderful time at <a href="http://rubyfuza.org/">Rubyfuza 2015</a> with <a href="https://www.youtube.com/watch%3Fv%3DaZh9e7aFE4E">Charles Nutter</a> .  This inspired me so much that I began <a href="https://github.com/activeadmin/activeadmin/pull/3792">to open pull requests</a> in Ruby projects that simply run their tests on JRuby.  On that one and finished, to my shame. <br><br><h1>  And by 2016 </h1><br>  In November 2016, I tried to write a Rails application from scratch.  For the first time in several months, I programmed in Ruby on my own machine.  The <code>brew upgrade</code> crashed into rbenv and therefore threw out all installed Ruby versions, but I didn‚Äôt even notice. <br><br>  I had a presentation on WebSockets on <a href="https://www.meetup.com/joziruby/events/235962465/">Jozi.rb.</a> <br><br>  At the beginning of the speech, I wanted to play around with the <a href="https://www.reactrails.com/">React on Rails</a> repository, just for the general feeling of sharing React and Rails.  I have been using <a href="https://github.com/Day8/re-frame">re-frame</a> for a couple of months now and I was sure that I could pull it out with bare React. <br><br>  The train got off the rails, and very spectacular. <br><br>  To clone and run a single template application, you needed to update XCode, update the command line tools for Xcode (more than 6 GB in total), install a new version of Ruby and Bundler, and then link the installation in a template application ... Everything is simple, right?  Like most Rails applications, this template application somewhere in the dependency graph had a dependency on libv8, and this alone adds more than 1 GB in size. <br><br>  The whole exercise took several hours. <br><br>  After playing with such an impressive demonstration, I realized that the work turns into a coin toss.  Therefore, I decided to make a better frontend on Ember, because I know it, but I did not have enough time. <br><br>  Again the same thing, you need to update nvm, install an acceptable version of node, install ember-cli, generate an application and install dependencies via npm <i>and</i> bower. <br><br>  I played a little and admitted my defeat, and instead shared my experience with colleagues.  It was humiliating, truly humiliating.  I felt like a stranger in a world of which I had been so long. <br><br>  Let's return to the statement that the JVM is <i>heavy</i> . <br><br><h1>  How are we weighing? </h1><br><ul><li>  JDK size when downloading too big? </li><li>  Does he use a lot of resources in his work? </li><li>  Do libraries take up a lot of disk space? </li><li>  Is deployment too heavy? </li><li>  Does she slow you down to the day? </li></ul><br>  Here are some questions that help us overcome our emotional barriers about the JVM. <br><br>  So let's take care of them and see what happens in reality. <br><br><h1>  Is the original volume really that big? </h1><br>  This <i>‚Äúgravity‚Äù of the</i> JVM is pure FUD, starting with an allegedly large amount of initial installation.  You compare about 200 MB of JDK downloads with about 15 MB of Node or Ruby downloads.  But this is only the beginning.  For both Node and Ruby, the system needs a C compiler, only one - hundreds of megabytes.  Worse, you'll probably need a compiler in production! <br><br>  A bunch of puffing load for both Node and Ruby is hiding from you in such small, sequential steps.  If you stop and calculate the volume, not to mention the time spent, then 200 MB will be a much more optimal option. <br><br>  I don‚Äôt even want to start compiling instructions for assembling your own web kit, just to not rewrite it as soon as a new tool is released. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d52/e95/bf4/d52e95bf4ea03d6d8da818bc7388e472.png"><br><br><h1>  Is JVM so hard at work? </h1><br>  JVM is fast, it‚Äôs probably one of the <a href="https://www.techempower.com/benchmarks/">fastest media</a> ever.  Over time, it just gets faster and easier.  Thousands of the smartest engineers are working to improve it, and have contributed even more over the past 21 years. <br><br>  There are real execution threads, multi-core support, it can be hellishly configured or just left as is.  The only useful thing you probably should know is setting the memory limits for the JVM, and then it will show wonders when dealing with the limitations of this environment. <br><br>  Unfolding on Heroku?  <code>java -server -Xmx512m beast.jar</code> .  If this is not enough, then you probably have the money to pay someone for the advice ... Oh, well, or just look at StackOverflow. <br><br>  Here is the key idea that Charles and other guys from the JRuby community continue to promote.  Without any gestures, your applications will surely run faster and faster with each release of the JVM (regardless of the progress of JRuby). <br><br><h1>  Disk usage is so big? </h1><br>  I was interested, and I looked in the folder <code>~/.m2</code> , where for 9 months of development with Clojure <b>1010 MB of</b> dependencies accumulated.  Even a gigabyte yet. <br><br> <code>$ du -sh /usr/local/opt/rbenv/versions/2.3.3 ~/.nvm/versions/node/v6.9.1 ~/.m2 <br> 690M /usr/local/opt/rbenv/versions/2.3.3 <br> 232M /Users/kenneth/.nvm/versions/node/v6.9.1 <br> 1010M /Users/kenneth/.m2</code> <br> <br>  The Ruby installation is fresh again and meets the basic requirements for running this blog and Middleman (I'm working on a fix there).  Yes, it takes almost 700 MB of space to run this static blog and participate in the development of the tools on which it works. <br><br>  Node has only ember, docpad and bower installed, and it is more than 200 MB. <br><br><h1>  Is the deployment so heavy? </h1><br>  You can probably predict what I'm going to talk about ... <br><br>  When building, you make a single JAR file.  It has everything to run your application on any platform.  Just place the JAR where needed and provide the JVM to deal with it. <br><br>  There is no such requirement that the application should work on a massive application server; you can very easily associate it with a productive HTTP server directly in the JAR file.  Do guys from Node do that, and from Ruby too, but somehow JAR files can't stay on their own?  I thought so too ... <br><br>  I, for example, have been relieved of the need to run <code>apt-get install build-essentials</code> in production. <br><br><h1>  Day to day with JVM </h1><br>  I have at least <b>five</b> JVM processes running on my 2012 MacBook Pro with 8 GB of memory.  Work constantly and every day.  I never tried to run five Rails applications at the same time. <br><br>  Why five?  Two for <a href="http://www.datomic.com/">Datomic</a> (data collection and console), one for our backend APIs and one for the front end I work with.  Sometimes there are also automatic tests in the background.  Sure, macOS memory compression probably helps here because a significant part of these JVM processes should have the same bytes loaded into memory. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbc/991/8ba/dbc9918ba42915348c661e7cc9e7cc20.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f77/c76/f5a/f77c76f5aa37abeecafba0f369531727.png"><br><br>  If you had told me about it 10 months ago, I would have just laughed.  Who in their right mind will launch <b>5 or more</b> JVM processes?  I could give my hand to cut off, which I will never do. <br><br>  Oh, and what about the class paths and all the other crazy things?  They won't touch you at all thanks to the excellent Clojure toolkit.  This is the same reason you use npm or bundler and do not suffer from the inclusion of paths.  You could do this, but then you probably have another problem that you do not notice. <br><br><h1>  Joy REPL </h1><br>  If I had to continuously stop and start JVM instances, I‚Äôd just go crazy.  That bothered me about JRuby in the old days.  Fortunately, with Clojure and a great REPL, you have to restart a JVM instance only in the rare case where I really screwed up somewhere.  This is pretty good fool protection.  <a href="https://github.com/bhauman/lein-figwheel">Figwheel</a> works without problems for days. <br><br><h1>  Conclusion </h1><br>  Be careful when evaluating the JVM as an object.  Evaluate Java as a language in every sense, but do not mix it with a virtual machine. <br><br>  I also used to think like you.  I thought of the JVM as a hippo.  Fortunately, now I was able to get rid of these restrictions and got the result of the work of thousands of giants supporting it. <br><br>  In no case do not consider this post as a sign of "the end of Node" or "end of Ruby".  Think of a fresh perspective.  If you cannot switch to JVM, at least think about how to reduce bloatiness in your own world. <br><br>  Thank you for your time.  <a href="http://www.braveclojure.com/">Learn</a> Clojure and try <a href="https://www.infoq.com/presentations/Simple-Made-Easy">Simple Made Easy</a> . </div><p>Source: <a href="https://habr.com/ru/post/324572/">https://habr.com/ru/post/324572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324562/index.html">Creating cross-platform applications with React Native</a></li>
<li><a href="../324564/index.html">Development of R & D projects continues: launch of Wolfram Language 11.1</a></li>
<li><a href="../324566/index.html">Publisher Peter. Spring sale</a></li>
<li><a href="../324568/index.html">Blockchain will change the world: but what will people do?</a></li>
<li><a href="../324570/index.html">VR / AR in the browser. How to quickly integrate and make your first application using WebVR API</a></li>
<li><a href="../324574/index.html">Power to the people: how to use AI to solve human problems</a></li>
<li><a href="../324576/index.html">IBM Q - developing a quantum computer running through the cloud</a></li>
<li><a href="../324578/index.html">IntelliJ IDEA 2017.1 Review: Java 9, Kotlin 1.1, Spring, Gradle, JavaScript, Go, and more</a></li>
<li><a href="../324580/index.html">Asterisk queues, minor tricks</a></li>
<li><a href="../324582/index.html">Spring Games KIPS. Or master the budget for information security in $ 300.000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>