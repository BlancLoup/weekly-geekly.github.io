<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free literature or a tale about friendship CoolReader c Tor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A neighbor lives in my house: a very good woman, a pensioner, a labor veteran, a former medical worker who has worked as a nurse in a hospital all her...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free literature or a tale about friendship CoolReader c Tor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/79c/d2b/b97/79cd2bb9785c41a791425b8f5362a960.png" alt="Picture to attract attention"><br><br>  A neighbor lives in my house: a very good woman, a pensioner, a labor veteran, a former medical worker who has worked as a nurse in a hospital all her life.  Currently retired.  I help her with what I can, but the tale is not about the neighbor, but about what the hospital management gave her, where she used to work the tablet.  There is nothing in this tablet (there is WIFI, 3G is not available, the screen diagonal is 7 inches, on aliexpress such are $ 45 with delivery), but of course they didn‚Äôt explain what to do with this tablet.  And I had to answer the question of what I do with my tablet, and I read books on the tablet, mainly Yasinsky and Elterus. <br><br>  Naturally, I connected the tablet to my laptop and dropped the CoolReader apkashka, as well as my library.  Unfortunately, two days later it turned out that our literary predilections are different and my neighbor books are not interesting.  I had to share the password from my Wi-Fi and set up the Flibusta opds, because my neighbor knew what the Internet was about and she had no computer, no Internet connection, and never had it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After the weekend, I was stunned by the fact that the necessary books from Flibusta are not downloaded.  To say that I was at a loss - to say nothing - all the literature of interest to me was always freely available, but the neighbor wanted Daria Dontsova and ‚Äú50 shades of gray‚Äù and, to my surprise, they really did not download. <br><a name="habracut"></a><br>  Googling the network, I found out that good people in the TOR network made Flibusta's mirror, from which everything is perfectly downloaded, but all attempts to explain CoolReader to go to the .onion address, stumbled upon its persistent reluctance to connect to .onion addresses in principle.  That, in principle, is logical.  The attempt to explain the principles of modern copyright and the purchase of books on the "Liters" was successfully failed by me: the neighbor does not have a card, like a computer, and the naive confront "and why should I pay if I still don‚Äôt have books?" And " where is the store where you can come and get a book on a tablet? ‚Äùturned out to be above my modest forces, so I had to solve this problem with technical methods, because I don‚Äôt know how to say no to people, especially to those who need help and protection. <br><br>  Fortunately, I already had a VRS (virtual root server), on which my small Ubuntu and Apache project was running. <br><br>  <u>Step 1</u> .  Install on Ubuntu tor <br><pre><code class="bash hljs">apt-get install tor</code> </pre> <br>  The default settings were fine for me. <br><br>  <u>Step 2</u> .  We write a script for apache, calling it, for example: /home/user/flibusta/nph-flibusta.pl.  The nph-prefix in the file name is very important, because it affects how the script will be processed by the Apache. <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use warnings; use HTTP::Proxy; use LWP::UserAgent; use LWP::Protocol::socks; use URI::Escape; use CGI qw(:standard -nph); my $q = new CGI; my $ua = LWP::UserAgent-&gt;new(max_redirect =&gt; 0, agent =&gt; $q-&gt;user_agent(),); $ua-&gt;timeout(60); $ua-&gt;proxy([qw/ http https /] =&gt; 'socks://127.0.0.1:9050'); # Tor proxy my $refer = $q-&gt;referer(); $refer = "" unless defined($refer); $refer =~ s/proxy\.flibusta\.net/flibustahezeous3.onion/g; #handle extra parameters my $ep =""; foreach my $par ($q-&gt;param) {$ep .= $par.'='.uri_escape($q-&gt;param($par)).'&amp;' unless ($par eq 'url');} chop $ep; $ep = '?'.$ep if ($ep ne ''); my $rsp = $ua-&gt;get('http://flibustahezeous3.onion'.$q-&gt;param('url').$ep, 'Referer'=&gt;$refer, 'Accept'=&gt;$q-&gt;http('Accept'), 'Accept-Language'=&gt;$q-&gt;http('Accept-Language'), 'Accept-Encoding'=&gt;'identity', 'Cookie'=&gt;$q-&gt;http('Cookie') ); my $fstr = $rsp-&gt;as_string; $fstr =~ s/flibustahezeous3\.onion/proxy.flibusta.net/g; #define templates my $nbl = &lt;&lt;DATA1; &lt;link href="/b/BOOOOOOOK/fb2" rel="http://opds-spec.org/acquisition/open-access" type="application/fb2+zip" /&gt; &lt;link href="/b/BOOOOOOOK/html" rel="http://opds-spec.org/acquisition/open-access" type="application/html+zip" /&gt; &lt;link href="/b/BOOOOOOOK/txt" rel="http://opds-spec.org/acquisition/open-access" type="application/txt+zip" /&gt; &lt;link href="/b/BOOOOOOOK/rtf" rel="http://opds-spec.org/acquisition/open-access" type="application/rtf+zip" /&gt; &lt;link href="/b/BOOOOOOOK/epub" rel="http://opds-spec.org/acquisition/open-access" type="application/epub+zip" /&gt; &lt;link href="/b/BOOOOOOOK/mobi" rel="http://opds-spec.org/acquisition/open-access" type="application/x-mobipocket-ebook" /&gt; DATA1 my $olb = quotemeta &lt;&lt;DATA2; &lt;link href="/b/BOOOOOOOK/download" rel="http://opds-spec.org/acquisition/disabled" type="disabled/fb2+zip" /&gt; DATA2 #get all book IDs my @IDs = $fstr =~ /\/b\/(\d+)\/download/g; foreach my $id (@IDs) { # prepare search and replace strings my $ao = $olb; $ao =~ s/BOOOOOOOK/$id/g; my $an= $nbl; $an =~ s/BOOOOOOOK/$id/g; # do replace to fix format for cool reader $fstr =~ s/$ao/$an/g; } print $fstr;</span></span></code> </pre><br>  What the script does: the $ url script gets the parameter, rewrites the host name to tori, sends the request via TOR and corrects the received answer into the form in which CoolReader wants to see it. <br><br>  <u>Step 3</u> .  Configure the Apache. <br>  Create the file /etc/apache2/sites-available/proxy.flibusta.net with something like this: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> webmaster@flibusta.net ServerName proxy.flibusta.net DirectoryIndex /home/user/flibusta/nph-flibusta.pl DocumentRoot /home/user/flibusta/ &lt;Directory /home/user/flibusta/ &gt; AllowOverride None Options -Indexes +ExecCGI -MultiViews +SymLinksIfOwnerMatch Order allow,deny Allow from <span class="hljs-literal"><span class="hljs-literal">all</span></span> &lt;/Directory&gt; RewriteEngine <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span> =proxy.flibusta.net RewriteRule ^(.*)$ /nph-flibusta.pl?url=<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [H=cgi-script,QSA,L] LogLevel warn CustomLog /var/log/apache2/access.log combined &lt;/VirtualHost&gt;</span></span></code> </pre><br><br>  And give the command: <br><br><pre> <code class="bash hljs">a2ensite proxy.flibusta.net</code> </pre><br>  Restarting apache in passing: <br><br><pre> <code class="bash hljs">service apache2 restart</code> </pre><br>  What is happening here: all requests to the site proxy.flibusta.net are sent to our magic script. <br><br>  <u>Step 4</u> .  Fix the DNS configuration on the router. <br>  I have an ASUS RT-N66U router, so in order to be able to make the necessary modifications, the MerlinWRT firmware was installed using DNSmasq from <a href="http://www.lostrealm.ca/asuswrt-merlin/download">the developer‚Äôs site</a> .  The JFFS section is included and the line has been added to the /jffs/configs/dnsmasq.conf.add file: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-attribute">address</span></span>=/proxy.flibusta.net/99.99.99.99</code> </pre><br>  Where 99.99.99.99 is the IP address of my VRSki (specially modified to avoid habraraefffekta) given the fact that I have a dynamic address and no filtering of IP addresses on the server when I access the script I do not have.  Obviously, for another model of router, step 4 will be different, but similar. <br><br>  <u>Step last</u> .  Add the address <a href="http://proxy.flibusta.net/opds">proxy.flibusta.net/opds</a> to the list of digital libraries in the CoolReader program.  There is nothing to explain, I think not.  Just use the corresponding menu in the CoolReader interface ~. <br><br>  I hope my experience will be useful to other people and will help to make not only my neighbor happier, but also anyone else in this world.  Special thanks to the person who made the possibility of downloading books through the Tor network and the author of the CoolReader program, which is used by "both the pioneers and pensioners." <br><br>  PS: After two weeks I learned that ‚ÄúDontsova is an excellent writer, and 50 50 shades of gray‚Äô of a chernukha, which you shouldn‚Äôt read to such well-bred and polite young people like me. ‚ÄùAnd I was almost forcibly shoved Alenka‚Äôs chocolate bar with a request to remove from the CoolReader ~ and Liters menu, which for some reason ‚Äúconstantly asks for registration‚Äù.  Obviously, this method can also be used to organize access of any other software to .onion and .i2p sites. </div><p>Source: <a href="https://habr.com/ru/post/235581/">https://habr.com/ru/post/235581/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235571/index.html">Car dealers in one of the US states are trying to close Tesla store due to its too high sales.</a></li>
<li><a href="../235573/index.html">Drupal performance optimization. Testing VPS and Cloud VPS from Infobox</a></li>
<li><a href="../235575/index.html">YouTube has launched the crowdfunding feature</a></li>
<li><a href="../235577/index.html">Logitech has released a keyboard for multiple devices.</a></li>
<li><a href="../235579/index.html">Convenient "padzhinator"</a></li>
<li><a href="../235583/index.html">News from Baidu: The Answer to Google Glass and Smart Wands</a></li>
<li><a href="../235585/index.html">The main differences between Java IO and Java NIO</a></li>
<li><a href="../235589/index.html">Minimalism and animation in web design</a></li>
<li><a href="../235591/index.html">Installing GitLab on Slackware</a></li>
<li><a href="../235593/index.html">Cooling server. Where to spend money with benefits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>