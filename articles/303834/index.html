<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple graphics using D3.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D3.js (or simply D3) is a JavaScript library for processing and visualizing data with incredibly huge capabilities. When I first found out about it, I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple graphics using D3.js</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/2fd/9f3/15b/2fd9f315b03d4221b36312dd7ebc5339.jpg" alt="Gualtiero Boffi | Dreamstime.com"></p><br><p>  <a href="http://d3js.org/">D3.js</a> (or simply D3) is a JavaScript library for processing and visualizing data with incredibly huge capabilities.  When I first found out about it, I probably spent at least two hours just looking at <a href="https://github.com/d3/d3/wiki/Gallery">examples of</a> data visualization created on D3.  And of course, when I myself needed to build graphics for a small internal site in our enterprise, first of all I remembered D3 and with the thought that ‚Äúnow I will surprise everyone with the coolest visualization,‚Äù I took up studying the source codes of examples ... <a name="habracut"></a></p><br><p>  ... and I realized that I absolutely do not understand anything!  The strange logic of the library, in the examples a whole bunch of lines of code to create the simplest graph - it was of course a blow, mainly on vanity.  Okay, wiped my snot - I realized that I shouldn‚Äôt take the D3 swoop, and to understand this library we must start from its very foundations.  Therefore, I decided to go another way - to take one of the libraries as a basis for my schedules - add-ons on D3.  As it turned out, there are quite a lot of such libraries - it means that I‚Äôm not the only one who is not understanding (it was my pride rising from the ashes). </p><br><p>  Having tried several libraries, I stopped at <a href="http://dimplejs.org/">dimple</a> as more or less suitable for my needs, rebuilt all my graphics with it, but the dissatisfaction remained.  Some things did not work as we would like, other functionality could not be implemented without deep digging into the dimple, and it was postponed.  And in general, if you need to dig deeply, then it is better to do it directly with D3, and not with additional settings, the rich functionality of which in my case is used for no more than five to ten percent, but the settings I needed on the contrary were not enough.  And so what happened happened - D3.js. </p><br><h3>  Attempt number two </h3><br><p>  First of all I read everything that is on D3 on <a href="https://habrahabr.ru/search/%3Fq%3D%255Bd3.js%255D%26target_type%3Dposts">Habr√©</a> .  And in the <a href="https://habrahabr.ru/company/datalaboratory/blog/217905/">commentary</a> under one of the articles I saw a link to the book <a href="http://chimera.labs.oreilly.com/books/1230000000345/index.html">Interactive Data Visualization for the Web</a> .  Opened, looked, began to read - and instantly became involved!  The book is written in simple and understandable English, plus the author is in itself a wonderful and interesting storyteller, well revealing the subject of D3 from the beginning. </p><br><p>  Based on the results of reading this book (as well as parallel heaps of other documentation on the topic), I wrote a small (more accurately, microscopic) library for constructing simple and minimalist line graphs.  And in turn, using the example of this library, I want to show that it is not at all difficult to build graphs with D3.js. </p><br><p>  So (my favorite word), let's get started. </p><br><p>  First let's decide which data we want to rebuild as a graph.  I decided not to grind out a set of conditional data, but took real ones that I encounter every day, simplifying and depersonalizing them for better understanding. </p><br><p>  Imagine some sort of mining and processing plant, say, iron ore at some conditional deposit (take a candle factory, ‚Äùthe classic phrase of literature from behind the shoulder reminds me, but the data are already prepared, because the candle factory is postponed until the next times). </p><br><p>  So, we extract ore and we produce iron.  There is a production plan drawn up by technologists, taking into account the geological features of the field, production capacity, and so on.  etc.  The plan (in our case) is broken down by months, and it is clear how much it is necessary to extract ores and smelt iron in one month or another in order to fulfill this plan.  There is also a fact - monthly actual data on the implementation of the plan.  Let's take it all and display it as a graph. </p><br><p>  The server will provide us with the above data in the form of the following <a href="https://ru.wikipedia.org/wiki/TSV">tsv</a> file: </p><br><pre><code class="javascript hljs">Category <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> Metal month Mined % fact <span class="hljs-number"><span class="hljs-number">25.10</span></span><span class="hljs-number"><span class="hljs-number">.2010</span></span> <span class="hljs-number"><span class="hljs-number">2234</span></span> <span class="hljs-number"><span class="hljs-number">0.88</span></span> fact <span class="hljs-number"><span class="hljs-number">25.11</span></span><span class="hljs-number"><span class="hljs-number">.2010</span></span> <span class="hljs-number"><span class="hljs-number">4167</span></span> <span class="hljs-number"><span class="hljs-number">2.55</span></span> ... plan <span class="hljs-number"><span class="hljs-number">25.09</span></span><span class="hljs-number"><span class="hljs-number">.2010</span></span> <span class="hljs-number"><span class="hljs-number">1510</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> plan <span class="hljs-number"><span class="hljs-number">25.10</span></span><span class="hljs-number"><span class="hljs-number">.2010</span></span> <span class="hljs-number"><span class="hljs-number">2790</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> plan <span class="hljs-number"><span class="hljs-number">25.11</span></span><span class="hljs-number"><span class="hljs-number">.2010</span></span> <span class="hljs-number"><span class="hljs-number">3820</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ...</code> </pre> <br><p>  Where in the Category column are the planned or actual values, Date is the data for each month (we date from the 25th), Metal month - how much metal in the month we planned (or received) and column Mined% - what percentage of metal mined at the moment. </p><br><p>  I think everything is clear with the data, now we are starting the program.  I will not show all the code, such as library calls, css styles, and the like, so as not to clutter up the article and focus on the main thing, and you can download the example described here at the end of the article. </p><br><p>  First of all, using the d3.tsv function, load the data: </p><br><pre> <code class="javascript hljs">d3.tsv(<span class="hljs-string"><span class="hljs-string">"sample.tsv"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error; <span class="hljs-comment"><span class="hljs-comment">//      }</span></span></code> </pre> <br><p>  Loading data in D3 is very simple.  If you need to load data in a different format, for example in <a href="https://ru.wikipedia.org/wiki/CSV">csv</a> , just change the call from d3.tsv to d3.sv.  Is your data in <a href="https://ru.wikipedia.org/wiki/JSON">JSON format</a> ?  Change the call to d3.json.  I tried all three formats and stopped at tsv, as the most convenient for me.  You can use any one you like, or even generate data directly in the program. </p><br><p>  In the picture below you can see how the downloaded data looks in our program. </p><br><p><img src="https://habrastorage.org/files/c42/97d/407/c4297d4076ef4ebf94d4ba20b6d92307.png" alt="i01"></p><br><p>  If you look closely at the figure, you can see that the data is loaded as strings, because the next stage of the program is to cast the dates to the data type date, and the numeric values ‚Äã‚Äãto the numeric type.  Without these conversions, D3 will not be able to correctly process dates, and it will apply a selective approach to numerical values, i.e.  some numbers will be taken, while others will simply be ignored.  For these casts, call the following function: </p><br><pre> <code class="javascript hljs"> preParceDann(<span class="hljs-string"><span class="hljs-string">"Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"%d.%m.%Y"</span></span>,[<span class="hljs-string"><span class="hljs-string">"Metal month"</span></span>,<span class="hljs-string"><span class="hljs-string">"Mined %"</span></span>],data);</code> </pre> <br><p>  In the parameters of this function, we pass the name of the column in which the dates are written, the date format in accordance with the <a href="https://github.com/d3/d3/wiki/Time-Formatting">rules for</a> recording dates in D3;  then comes an array with the names of the columns for which you want to do the conversion of digital values.  And the last parameter is the data we downloaded earlier.  The conversion function itself is quite small and therefore, in order not to return to it again, I will bring it right away: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preParceDann</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dateColumn,dateFormat,usedNumColumns,data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parse = d3.time.format(dateFormat).parse; data.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ d[dateColumn] = parse(d[dateColumn]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, len = usedNumColumns.length; i &lt; len; i += <span class="hljs-number"><span class="hljs-number">1</span></span>) { d[usedNumColumns[i]] = +d[usedNumColumns[i]]; } }); };</code> </pre> <br><p>  Here we initialize the date prasing function and then for each data row we convert the dates, and for the specified columns we translate the rows into numbers. </p><br><p>  After performing this function, our data is already presented in this form: </p><br><p><img src="https://habrastorage.org/files/9ac/45e/f36/9ac45ef36b474704affcd2e9349be38f.png" alt="i02"></p><br><p>  Immediately I answer a possible question - Why does this function have a complication with the list of columns in which you need to format digital data?  - and this answer is simple: in a real table there can be (and there is) a much larger number of columns and not all of them can be digital.  Yes, and we certainly will not build on all columns of graphics, so why unnecessary manipulations on data conversion? </p><br><p>  Before proceeding to the next step, let's recall our data file - it sequentially records first the actual and then the project data.  If we now rebuild the data as they are, we get a complete mess.  Because both the fact and the plan will be drawn in the form of a single diagram.  Therefore, we perform another data manipulation using the D3 function with the curious name nest (nest): </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataGroup = d3.nest() .key(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d.Category; }) .entries(data);</code> </pre> <br><p>  As a result of this function, we get the following data set: </p><br><p><img src="https://habrastorage.org/files/8c4/8de/626/8c48de626878423db8fc15a88cf343d6.png" alt="i03"></p><br><p>  where we see that our data array is already divided into two sub-arrays: one fact, another plan. </p><br><p>  Everything, we have finished with data preparation - now we proceed to setting the parameters for plotting: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> param = { <span class="hljs-attr"><span class="hljs-attr">parentSelector</span></span>: <span class="hljs-string"><span class="hljs-string">"#chart1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"Iron mine work"</span></span>, <span class="hljs-attr"><span class="hljs-attr">xColumn</span></span>: <span class="hljs-string"><span class="hljs-string">"Date"</span></span>, <span class="hljs-attr"><span class="hljs-attr">xColumnDate</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">yLeftAxisName</span></span>: <span class="hljs-string"><span class="hljs-string">"Tonnes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">yRightAxisName</span></span>: <span class="hljs-string"><span class="hljs-string">"%"</span></span>, <span class="hljs-attr"><span class="hljs-attr">categories</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"plan"</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-string"><span class="hljs-string">"1px"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"fact"</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-string"><span class="hljs-string">"2px"</span></span>} ], <span class="hljs-attr"><span class="hljs-attr">series</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">yColumn</span></span>: <span class="hljs-string"><span class="hljs-string">"Metal month"</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">"#ff6600"</span></span>, <span class="hljs-attr"><span class="hljs-attr">yAxis</span></span>: <span class="hljs-string"><span class="hljs-string">"left"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">yColumn</span></span>: <span class="hljs-string"><span class="hljs-string">"Mined %"</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">"#0080ff"</span></span>, <span class="hljs-attr"><span class="hljs-attr">yAxis</span></span>: <span class="hljs-string"><span class="hljs-string">"right"</span></span>} ] };</code> </pre> <br><p>  Everything is simple here: </p><br><table><thead><tr><th>  Parameter </th><th>  Value </th></tr></thead><tbody><tr><td>  parentSelector </td><td>  The id of the element of our page in which the schedule will be built up </td></tr><tr><td>  width: 600 </td><td>  width </td></tr><tr><td>  height: 300 </td><td>  height </td></tr><tr><td>  title: "Iron mine work" </td><td>  headline </td></tr><tr><td>  xColumn: "Date" </td><td>  the name of the column from which the coordinates for the X axis will be taken </td></tr><tr><td>  xColumnDate: true </td><td>  if true, then the x axis is the dates (unfortunately, this functionality is still unfinished, that is, we can build only the dates along the x axis) </td></tr><tr><td>  yLeftAxisName: "Tonnes" </td><td>  left y axis name </td></tr><tr><td>  yRightAxisName: "%" </td><td>  the names of the right y axis </td></tr><tr><td>  categories: </td><td>  long thought how to name that.  that flies out of the ‚Äúnest‚Äù D3 and did not invent anything better than the categories.  For each category, the name is given - how it is spelled out in our data and the width of the construction </td></tr><tr><td>  series: </td><td>  Obviously, the diagrams themselves, we define from which column we take values ‚Äã‚Äãfor the y axis, color, and to which axis the diagram will belong, left or right </td></tr></tbody></table><br><p>  We set all the initial data, now we finally call the plotting and enjoy the result: </p><br><pre> <code class="javascript hljs"> d3sChart(param,data,dataGroup);</code> </pre> <br><p><img src="https://habrastorage.org/files/89e/ba8/e26/89eba8e26124467fa55e1fc6de7d0bc2.png" alt="i04"></p><br><p>  What do we see on this chart?  And we see that the plans were too optimistic and in order to have a reliable forecast it is necessary to make an inevitable adjustment.  It is also necessary to take a closer look at the production, the actual schedule is painfully ragged ... Okay, okay - we already go where we, programmers, have not been called, therefore we return to our sheep - how is this schedule built? </p><br><p>  I repeat the call of the function of plotting: </p><br><pre> <code class="javascript hljs"> d3sChart(param,data,dataGroup);</code> </pre> <br><p>  Looking at it, a reasonable question arises, which you probably want to ask me - Why do two arrays of data, data and dataGroup, be passed to the function?  The answer is: the initial data array is needed in order to set the correct data range for the axes.  I suspect that this sounds not very clear - but I will try to explain this moment soon. </p><br><p>  The first thing we do in the construction function is to check if there is an object at all in which we will build a graph.  And if this object itself is not there - we swear strongly: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d3sChart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">param,data,dataGroup</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// check availability the object, where is displayed chart var selectedObj = null; if (param.parentSelector === null || param.parentSelector === undefined) { parentSelector = "body"; }; selectedObj = d3.select(param.parentSelector); if (selectedObj.empty()) { throw "The '" + param.parentSelector + "' selector did not match any elements. Please prefix with '#' to select by id or '.' to select by class"; };</span></span></code> </pre> <br><p>  Our following actions: we initialize various indents, the sizes and we create scales. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> margin = {<span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-attr"><span class="hljs-attr">bottom</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>}, width = param.width - margin.left - margin.right, height = param.height - margin.top - margin.bottom; <span class="hljs-comment"><span class="hljs-comment">// set the scale for the transfer of real values var xScale = d3.time.scale().range([0, width]); var yScaleLeft = d3.scale.linear().range([height, 0]); var yScaleRight = d3.scale.linear().range([height, 0]);</span></span></code> </pre> <br><p>  We do not forget that our library has just hatched and has not been accustomed to adjust some things (for example, indents) from the outside, due to the artificially accelerated incubation process.  Therefore, once again I ask you to understand and forgive. </p><br><p>  Jokes, jokes, but back to the code above - with indents and sizes, I think everything is clear, we need the scales to recalculate the initial values ‚Äã‚Äãof the coordinates into the coordinates of the plot area.  It can be seen that the x scale is initialized as a time scale, and the left and right scales along the y axis are initialized as linear.  In general, there are many different scales in D3, but considering them, as well as many other things, is already much beyond the scope of this article. </p><br><p>  We continue, we have created scales, now we need to configure them.  And this is where the original data set comes in handy.  If in a very simple way - with the previous actions we set a range of scales in the coordinates of the graph, with the same commands we associate this range with data ranges: </p><br><pre> <code class="javascript hljs"> xScale.domain([d3.min(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d[param.xColumn]; }), d3.max(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d[param.xColumn]; })]); yScaleLeft.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>,d3.max(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d[param.series[<span class="hljs-number"><span class="hljs-number">0</span></span>].yColumn]; })]); yScaleRight.domain([<span class="hljs-number"><span class="hljs-number">0</span></span>,d3.max(data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d[param.series[<span class="hljs-number"><span class="hljs-number">1</span></span>].yColumn]; })]);</code> </pre> <br><p>  For the X scale, we set the minimum value to the minimum date in our data, and the maximum to the maximum.  For Y axes, we take 0 for the minimum, and we also learn the maximum from the data.  For this, we also needed non-broken data - to find out the minimum and maximum values. </p><br><p>  The next step is to tune the axes.  Here begins a little confusion.  In D3 there are scales (scales) and axes (axis).  The scales are responsible for converting the original coordinates into the coordinates of the construction area, the axes are intended to display on the charts those rods and dashes that we see on the graph and which in Russian are called ‚Äúcoordinate scales plotted along the X and Y axes‚Äù.  Therefore, in the future, if I am writing a scale, keep in mind that we are talking about axis, i.e.  about drawing the scale on the chart. </p><br><p>  So, I remind you - we have two scales for the Y axis and one scale for the X axis, from which we had to pretty much tinker.  The fact is that I was completely uncomfortable with how D3 displays the date scale by default.  But all my attempts to adjust the date signatures the way I need it, were broken, like waves, against the cliffs of power and monumentality of this library.  Therefore I had to go on forgery and deception: I created two scales on the X axis. On one scale, only years are displayed on my scale, on the other months.  For months, a small check has been added that excludes the first month from the output.  And after all, just a couple of sentences ago, I blamed this library for monumentality, and here is such a wonderful example of flexibility. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xAxis = d3.svg.axis().scale(xScale).orient(<span class="hljs-string"><span class="hljs-string">"bottom"</span></span>) .ticks(d3.time.year,<span class="hljs-number"><span class="hljs-number">1</span></span>).tickFormat(d3.time.format(<span class="hljs-string"><span class="hljs-string">"%Y"</span></span>)) .tickSize(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monthNameFormat = d3.time.format(<span class="hljs-string"><span class="hljs-string">"%m"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xAxis2 = d3.svg.axis().scale(xScale).orient(<span class="hljs-string"><span class="hljs-string">"bottom"</span></span>) .ticks(d3.time.month,<span class="hljs-number"><span class="hljs-number">2</span></span>).tickFormat(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = monthNameFormat(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-string"><span class="hljs-string">"01"</span></span>) {a = <span class="hljs-string"><span class="hljs-string">""</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;}) .tickSize(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yAxisLeft = d3.svg.axis().scale(yScaleLeft).orient(<span class="hljs-string"><span class="hljs-string">"left"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yAxisRight = d3.svg.axis().scale(yScaleRight).orient(<span class="hljs-string"><span class="hljs-string">"right"</span></span>);</code> </pre> <br><p>  We continue to consider the code.  We have carried out all the preparatory work and are now proceeding directly to the formation of the image.  The next 4 lines of code sequentially create the <a href="https://ru.wikipedia.org/wiki/SVG">svg</a> area, draw an outlining frame, create with a given offset a group of svg objects in which our graph will be plotted.  And the last action - the title is displayed. </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> svg = selectedObj.append(<span class="hljs-string"><span class="hljs-string">"svg"</span></span>) .attr({<span class="hljs-attr"><span class="hljs-attr">width</span></span>: param.width, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: param.height}); <span class="hljs-comment"><span class="hljs-comment">// outer border svg.append("rect").attr({width: param.width, height: param.height}) .style({"fill": "none", "stroke": "#ccc"}); // create group in svg for generate graph var g = svg.append("g").attr({transform: "translate(" + margin.left + "," + margin.top + ")"}); // add title g.append("text").attr("x", margin.left) .attr("y", 0 - (margin.top / 2)) .attr("text-anchor", "middle").style("font-size", "14px") .text(param.title);</span></span></code> </pre> <br><p>  The next big piece of code signs the units of measure of our 3 axes.  I think everything is clear and in detail need not be considered: </p><br><pre> <code class="javascript hljs"> g.append(<span class="hljs-string"><span class="hljs-string">"g"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"x axis"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate(0,"</span></span> + height + <span class="hljs-string"><span class="hljs-string">")"</span></span>) .call(xAxis) .append(<span class="hljs-string"><span class="hljs-string">"text"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, width<span class="hljs-number"><span class="hljs-number">-20</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"dx"</span></span>, <span class="hljs-string"><span class="hljs-string">".71em"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, <span class="hljs-number"><span class="hljs-number">-4</span></span>).style(<span class="hljs-string"><span class="hljs-string">"text-anchor"</span></span>, <span class="hljs-string"><span class="hljs-string">"end"</span></span>) .text(param.xColumn); g.append(<span class="hljs-string"><span class="hljs-string">"g"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"x axis2"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate(0,"</span></span> + height + <span class="hljs-string"><span class="hljs-string">")"</span></span>) .call(xAxis2); g.append(<span class="hljs-string"><span class="hljs-string">"g"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"y axis"</span></span>) .call(yAxisLeft) .append(<span class="hljs-string"><span class="hljs-string">"text"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"rotate(-90)"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"dy"</span></span>, <span class="hljs-string"><span class="hljs-string">".71em"</span></span>).style(<span class="hljs-string"><span class="hljs-string">"text-anchor"</span></span>, <span class="hljs-string"><span class="hljs-string">"end"</span></span>) .text(param.yLeftAxisName); g.append(<span class="hljs-string"><span class="hljs-string">"g"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"y axis"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate("</span></span> + width + <span class="hljs-string"><span class="hljs-string">" ,0)"</span></span>) .call(yAxisRight) .append(<span class="hljs-string"><span class="hljs-string">"text"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"rotate(-90)"</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, <span class="hljs-number"><span class="hljs-number">-14</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"dy"</span></span>, <span class="hljs-string"><span class="hljs-string">".71em"</span></span>).style(<span class="hljs-string"><span class="hljs-string">"text-anchor"</span></span>, <span class="hljs-string"><span class="hljs-string">"end"</span></span>) .text(param.yRightAxisName);</code> </pre> <br><p>  And finally, the core of the graphing function is the drawing of the diagrams themselves: </p><br><pre> <code class="javascript hljs"> dataGroup.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, len = param.categories.length; i &lt; len; i += <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param.categories[i].name == d.key){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>, len1 = param.series.length; j &lt; len1; j += <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (param.series[j].yAxis == <span class="hljs-string"><span class="hljs-string">"left"</span></span>){ <span class="hljs-comment"><span class="hljs-comment">// init line for left axis var line = d3.svg.line() .x(function(d) { return xScale(d[param.xColumn]); }) .y(function(d) { return yScaleLeft(d[param.series[j].yColumn] ); }); }; if (param.series[j].yAxis == "right"){ // init line for right axis var line = d3.svg.line() .x(function(d) { return xScale(d[param.xColumn]); }) .y(function(d) { return yScaleRight(d[param.series[j].yColumn] ); }); }; // draw line g.append("path").datum(d.values) .style({"fill": "none", "stroke": param.series[j].color, "stroke-width": param.categories[i].width}) .attr("d", line); }; }; }; });</span></span></code> </pre> <br><p>  ‚ÄúThree nested cycles!‚Äù Exclaim you in a rage.  And you will be absolutely right in your indignation - I myself do not like to make such nested constructions, but sometimes I have to.  In the third cycle nesting, we initialize our lines of diagrams, where, depending on the series, we indicate whether this line belongs to the right or left scale.  After that, in the second nesting we already draw the line on the chart, setting its thickness from the properties of the categories.  Those.  in fact, we only have two lines of code involved in the construction, everything else is just a strapping, necessary for processing a different number of diagrams on the graph. </p><br><p>  Well, the last action with our schedule is the conclusion of the legend.  I repent of the legend - here I was in a hurry and made it to a tyap-bluff, this code will be rewritten soon and I show it only to demonstrate once again that everything is pretty simple in D3.  And yet - here is a good example of how not to do it: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> legend = svg.append(<span class="hljs-string"><span class="hljs-string">"g"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"class"</span></span>, <span class="hljs-string"><span class="hljs-string">"legend"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>) .attr(<span class="hljs-string"><span class="hljs-string">"transform"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate(180,20)"</span></span>); legend.selectAll(<span class="hljs-string"><span class="hljs-string">'rect'</span></span>).data(param.series).enter() .append(<span class="hljs-string"><span class="hljs-string">"rect"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> - (margin.top / <span class="hljs-number"><span class="hljs-number">2</span></span>)).attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i * <span class="hljs-number"><span class="hljs-number">90</span></span>;}) .attr(<span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) .style(<span class="hljs-string"><span class="hljs-string">"fill"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d.color; }); legend.selectAll(<span class="hljs-string"><span class="hljs-string">'text'</span></span>).data(param.series).enter() .append(<span class="hljs-string"><span class="hljs-string">"text"</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"y"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> - (margin.top / <span class="hljs-number"><span class="hljs-number">2</span></span>)+<span class="hljs-number"><span class="hljs-number">10</span></span>).attr(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, i</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i * <span class="hljs-number"><span class="hljs-number">90</span></span> + <span class="hljs-number"><span class="hljs-number">11</span></span>;}) .text(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d.yColumn; }); <span class="hljs-comment"><span class="hljs-comment">// add legend for categories var legend1 = svg.append("g").attr("class", "legend").attr("height", 40).attr("width", 200) .attr("transform", "translate(350,20)"); legend1.selectAll('line').data(param.categories).enter() .append("line").attr("y1", 0 - (margin.top / 2)+5).attr("x1", function(d, i){ return i * 60;}) .attr("y2", 0 - (margin.top / 2)+5).attr("x2", function(d, i){ return i * 60+15;}) .style("stroke", "black").style("stroke-width", function(d) { return d.width; }); legend1.selectAll('text').data(param.categories).enter() .append("text").attr("y", 0 - (margin.top / 2)+10).attr("x", function(d, i){ return i * 60 + 17;}) .text(function(d) { return d.name; });</span></span></code> </pre> <br><p>  That's all.  Thanks for attention!  I hope that I did not disappoint you with my article. </p><br><p>  The source code and sample data can be downloaded from <a href="https://github.com/MaximPetrichuk/d3.simple.chart">GitHub</a> . </p><br><p>  In conclusion, I just want to add that I was looking for a similar article or tutorial when I tried to deal with the D3 library myself.  Looking for an article, where by examples, separately and consistently, it would be shown: how to load and prepare data, how to create and set up a construction area, and how to display this data.  Unfortunately, I didn‚Äôt meet anything like that then, and in the examples on D3 from the author everything is so mixed up that without understanding the logic of the work and not having basic knowledge of this library, it is very difficult to figure out where the data manipulation ends, and where the manipulation with representation of this data, and vice versa. </p><br><p>  <strong>06/23/2016 upd.</strong>  I updated the program on Gitkhab: I improved the time scale, made that I could put a number row instead of dates on the X axis, fixed some errors and now I can build graphs without categories. </p><br><p>  <strong>08/12/2016 upd.</strong>  Redid the program to work on the 4th version of d3.  A lot of incompatibilities have come out.  The example described in the article works only with the 3rd version of the library and lies on <a href="https://github.com/MaximPetrichuk/d3.simple.chart">Github</a> in files with the _v3 prefix in the file name. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/303834/">https://habr.com/ru/post/303834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303824/index.html">User Behavior Analytics. How can Varonis help here?</a></li>
<li><a href="../303826/index.html">Release Fedora 24. Race for Versions</a></li>
<li><a href="../303828/index.html">The most popular models of refurbished servers</a></li>
<li><a href="../303830/index.html">How I accelerated strstr</a></li>
<li><a href="../303832/index.html">Interview with Google Programmer Martin Horner about TensorFlow</a></li>
<li><a href="../303836/index.html">What is space time really?</a></li>
<li><a href="../303838/index.html">Search for connections in social networks</a></li>
<li><a href="../303840/index.html">Java library for the efficient transfer of CSS and JavaScript</a></li>
<li><a href="../303842/index.html">Neural network as a predictor for PNG image coding</a></li>
<li><a href="../303844/index.html">NetApp ONTAP & ESXi 6.x tuning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>