<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Phalcon 2.0.4 release</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of the schedule of our three-weekly minor releases, we are pleased to announce that Phalcon 2.0.4 has been released! 

 The number of improvem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Phalcon 2.0.4 release</h1><div class="post__text post__text-html js-mediator-article">  As part of the schedule of our three-weekly minor releases, we are pleased to announce that Phalcon 2.0.4 has been released! <br><a name="habracut"></a><br>  The number of improvements and fixes has increased significantly compared with other releases of 2.0.x: <br><br><h4>  Changes </h4><br><ul><li> Fixed a bug in <code>Phalcon\Mvc\Model::update()</code> erroneously <code>Phalcon\Mvc\Model::update()</code> an exception when a record really exists </li><li>  Now links in <code>Phalcon\Debug</code> point to <a href="https://api.phalconphp.com/">https://api.phalconphp.com</a> instead of <a href="http://docs.phalconphp.com/">http://docs.phalconphp.com</a> </li><li>  Implemented a universal way of assigning variables in Volt, allowing you to assign variables and arrays of indices </li><li>  Improved macros in Volt through the use of anonymous functions that allow you to bind object adapter and DI services together </li><li>  Fixed generation and validation of standard parameters in Volt macros </li><li>  Added <code>Phalcon\Assets\Manager::getCollections()</code> method that returns all registered collections <a href="https://github.com/phalcon/cphalcon/pull/2488"># 2488</a> </li><li>  Now <code>Phalcon\Mvc\Url::getStatic()</code> generates URLs from routing </li><li>  Added <code>Phalcon\Mvc\EntityInterface</code> for general abstraction over <code>Phalcon\Mvc\Model</code> and <code>Phalcon\Mvc\Collection</code> .  This interface supports <code>Mvc\Model\Validators</code> for use in <code>Mvc\Collection</code> </li><li>  Added <code>Phalcon\Session\Adapter::setName()</code> method to change session name </li><li>  Added support for <code>BIGINT</code> column in <code>Phalcon\Db</code> </li><li>  Added new types of <code>Phalcon\Db\Column::BLOB</code> and <code>Phalcon\Db\Column::DOUBLE</code> <a href="https://github.com/phalcon/cphalcon/pull/10506"># 10506</a> </li><li>  Automatic binding of Large Object data (LOB) in ORM </li><li>  Support for MySQL type <code>BIT</code> with binding as a <code>boolean</code> </li><li>  Added method <code>Phalcon\Flash\Direct::output()</code> allows you to place flash-messages in a specific place of the template <a href="https://github.com/phalcon/cphalcon/pull/629"># 629</a> </li><li>  Added <code>autoescape</code> option that allows you to turn on autoescape at a global level in any Volt template </li><li>  Added <code>readAttribute</code> / <code>writeAttribute</code> to <code>Phalcon\Mvc\Collection\Document</code> </li><li>  Added <code>toArray</code> in <code>Phalcon\Mvc\Collection\Document</code> </li><li>  The global parameter <code>db.force_casting</code> now allows you to force the cast of specified types </li><li>  A new syntax has been introduced in PHQL, allowing you to set the type: <code>{name:str}</code> or <code>{names:array}</code> </li><li>  Now you can work with arrays as parameters in PHQL </li><li>  The global parameter <code>orm.cast_on_hydrate</code> allows <code>orm.cast_on_hydrate</code> to give attributes with original types from the mapped table instead of using strings </li><li>  Values ‚Äã‚Äãin <code>LIMIT</code> / <code>OFFSET</code> now possible to add via the attached parameters to PHQL </li><li>  Support for late static linking in Simple / Complex results for redefining <code>Mvc\Model::cloneResultMap</code> </li><li>  Added <code>distinct()</code> method in <code>Phalcon\Mvc\Model\Criteria</code> <a href="https://github.com/phalcon/cphalcon/issues/10536"># 10536</a> </li><li>  Added global parameter <code>orm.ignore_unknown_columns</code> to ignore unrecorded columns in ORM.  This removes the extra auxiliary columns used in <code>Db\Adapter\Pdo\Oracle</code> </li><li>  Added support for <code>afterFetch</code> in <code>Mvc\Collection</code> </li><li>  Added the <code>beforeMatch</code> parameter to the <code>@Route</code> annotation from <code>Mvc\Router\Annotations</code> </li><li>  Added <code>groupBy</code> / <code>getGroupBy</code> / <code>having</code> / <code>getHaving</code> to <code>Mvc\Model\Criteria</code> </li><li>  <code>Phalcon\Mvc\Model::count()</code> now returns a value of type int </li><li>  Removed <code>__construct</code> from <code>Phalcon\Mvc\View\EngineInterface</code> </li><li>  Added <code>Phalcon\Debug\Dump::toJson()</code> method to return the value as JSON with variable information </li><li>  Instances in <code>Phalcon\Di</code> are built using internal optimizers instead of <code>\ReflectionClass</code> (PHP 5.6) </li><li>  Added <code>Phalcon\Mvc\Model\Validator\IP</code> from <code>phalcon/incubator</code> </li><li>  Added <code>defaultValue</code> return parameter to <code>Phalcon\Mvc\Model\Validator::getOption()</code> </li><li>  Now developers can define relationships using conditional statements. </li></ul><br><h4>  Highlights </h4><br><h5>  Typed placeholders in ORM </h5><br><habracut></habracut><br>  Prior to this version, only standard placeholders (strings and <a href="https://docs.phalconphp.com/en/latest/reference/phql.html">numbers</a> ) were supported in <a href="https://docs.phalconphp.com/en/latest/reference/phql.html">PHQL</a> .  They allowed to bind parameters to avoid SQL injections: <br><br><pre> <code class="php hljs">$phql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Store\Robots WHERE id &gt; :id:"</span></span>; $robots = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelsManager-&gt;executeQuery($phql, [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>]);</code> </pre><br>  However, some DBMS require additional actions when using placeholders, such as specifying the type: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phalcon</span></span>\<span class="hljs-title"><span class="hljs-title">Db</span></span>\<span class="hljs-title"><span class="hljs-title">Column</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... $phql = "SELECT * FROM Store\Robots LIMIT :number:"; $robots = $this-&gt;modelsManager-&gt;executeQuery( $phql, ['number' =&gt; 10], Column::BIND_PARAM_INT );</span></span></code> </pre><br>  To facilitate this task, Phalcon 2.0.4 introduces typed placeholders that work exactly as before, but with the ability to specify the type: <br><br><pre> <code class="php hljs">$phql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Store\Robots LIMIT {number:int}"</span></span>; $robots = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelsManager-&gt;executeQuery( $phql, [<span class="hljs-string"><span class="hljs-string">'number'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>] ); $phql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Store\Robots WHERE name &lt;&gt; {name:str}"</span></span>; $robots = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelsManager-&gt;executeQuery( $phql, [<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $name] );</code> </pre><br>  You can also omit the type indication if you do not need: <br><br><pre> <code class="php hljs">$phql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Store\Robots WHERE name &lt;&gt; {name}"</span></span>; $robots = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelsManager-&gt;executeQuery( $phql, [<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $name] );</code> </pre><br>  Typed placeholders are also more functional, since now we can bind a static array without having to pass each element separately as a placeholder: <br><br><pre> <code class="php hljs">$phql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Store\Robots WHERE id IN ({ids:array})"</span></span>; $robots = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelsManager-&gt;executeQuery( $phql, [<span class="hljs-string"><span class="hljs-string">'ids'</span></span> =&gt; [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>]] );</code> </pre><br>  The following types are available: <br><table><thead><tr><th>  Type of </th><th>  Type constant </th><th>  Example </th></tr></thead><tbody><tr><td>  str </td><td> <code>Column::BIND_PARAM_STR</code> </td> <td> <code>{name:str}</code> </td> </tr><tr><td>  int </td><td> <code>Column::BIND_PARAM_INT</code> </td> <td> <code>{number:int}</code> </td> </tr><tr><td>  double </td><td> <code>Column::BIND_PARAM_DECIMAL</code> </td> <td> <code>{price:double}</code> </td> </tr><tr><td>  bool </td><td> <code>Column::BIND_PARAM_BOOL</code> </td> <td> <code>{enabled:bool}</code> </td> </tr><tr><td>  blob </td><td> <code>Column::BIND_PARAM_BLOB</code> </td> <td> <code>{image:blob}</code> </td> </tr><tr><td>  null </td><td> <code>Column::BIND_PARAM_NULL</code> </td> <td> <code>{exists:null}</code> </td> </tr><tr><td>  array </td><td>  Array of <code>Column::BIND_PARAM_STR</code> </td><td> <code>{codes:array}</code> </td> </tr><tr><td>  array-str </td><td>  Array of <code>Column::BIND_PARAM_STR</code> </td><td> <code>{names:array}</code> </td> </tr><tr><td>  array-int </td><td>  Array of <code>Column::BIND_PARAM_INT</code> </td><td> <code>{flags:array}</code> </td> </tr></tbody></table><br><h5>  Validation of bound parameters </h5><br>  By default, parameters associated with placeholders did not support type indications, but now it is possible to check the types of parameters before starting work with PDO. <br><br>  The classic situation when a problem arises is to transfer the string to the <code>LIMIT</code> / <code>OFFSET</code> placeholder: <br><br><pre> <code class="php hljs">$number = <span class="hljs-string"><span class="hljs-string">'100'</span></span>; $robots = $modelsManager-&gt;executeQuery( <span class="hljs-string"><span class="hljs-string">'SELECT * FROM Some\Robots LIMIT {number:int}'</span></span>, [<span class="hljs-string"><span class="hljs-string">'number'</span></span> =&gt; $number] );</code> </pre><br>  This code will throw the following exception: <br><br><pre> <code class="hljs vhdl">Fatal <span class="hljs-literal"><span class="hljs-literal">error</span></span>: Uncaught exception <span class="hljs-symbol"><span class="hljs-symbol">'PDOException</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> message <span class="hljs-symbol"><span class="hljs-symbol">'SQLSTATE</span></span>[<span class="hljs-number"><span class="hljs-number">42000</span></span>]: Syntax <span class="hljs-literal"><span class="hljs-literal">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">access</span></span> violation: <span class="hljs-number"><span class="hljs-number">1064</span></span> You have an <span class="hljs-literal"><span class="hljs-literal">error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> your SQL syntax; check the manual that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL server version <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the right syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near ''<span class="hljs-number"><span class="hljs-number">100</span></span>'' at <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /Users/scott/demo.php:<span class="hljs-number"><span class="hljs-number">78</span></span></code> </pre><br>  This is because 100 is a string variable.  Easy to fix, you just need to cast the type to int: <br><br><pre> <code class="php hljs">$number = <span class="hljs-string"><span class="hljs-string">'100'</span></span>; $robots = $modelsManager-&gt;executeQuery( <span class="hljs-string"><span class="hljs-string">'SELECT * FROM Some\Robots LIMIT {number:int}'</span></span>, [<span class="hljs-string"><span class="hljs-string">'number'</span></span> =&gt; (int) $number] );</code> </pre><br>  However, this solution requires the developer to pay special attention to working with types.  To make the task easier and avoid unexpected exceptions, you can get Phalcon to do this work for you: <br><br><pre> <code class="php hljs">\Phalcon\Db::setup([<span class="hljs-string"><span class="hljs-string">'forceCasting'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>]);</code> </pre><br>  The following actions are performed according to the binding of the specified type: <br><br><table><thead><tr><th>  Type of </th><th>  Act </th></tr></thead><tbody><tr><td> <code>Column::BIND_PARAM_STR</code> </td> <td>  Sends the value as a native type PHP string </td></tr><tr><td> <code>Column::BIND_PARAM_INT</code> </td> <td>  Pass value as native php integer type </td></tr><tr><td> <code>Column::BIND_PARAM_BOOL</code> </td> <td>  Pass value as native php type boolean </td></tr><tr><td> <code>Column::BIND_PARAM_DECIMAL</code> </td> <td>  Sends value as native PHP type double </td></tr></tbody></table><br><h5>  Type casting from PDO values </h5><br>  The values ‚Äã‚Äãreturned from the system database are always transferred as string values ‚Äã‚Äãby the PDO, regardless of whether the value belongs to a numeric or logical data type of a column.  This is because some column types cannot be represented using native PHP types due to their size limit. <br><br>  For example, a value of type <code>BIGINT</code> in MySQL can store large integers that cannot be represented as a 32-bit integer in PHP.  Because of this, PDO and ORM defaults to a secure solution and leave all values ‚Äã‚Äãas strings. <br><br>  However, some developers may find this unexpected and inconvenient.  With Phalcon 2.0.4, you can configure ORM to automatically cast types to the appropriate PHP primitives, provided that it is safe: <br><br><pre> <code class="php hljs">\Phalcon\Mvc\Model::setup([<span class="hljs-string"><span class="hljs-string">'castOnHydrate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>]);</code> </pre><br>  Thus, you can use strict comparison operators or make assumptions about the type of variables: <br><br><pre> <code class="php hljs">$robot = Robots::findFirst(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($robot-&gt;id === <span class="hljs-number"><span class="hljs-number">11</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $robot-&gt;name; }</code> </pre><br><h5>  Links to conditional operators </h5><br>  With 2.0.4, you can create relationships based on conditional statements.  Phalcon will take care of the rest :) <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// Companies have invoices issued to them (paid/unpaid) // Invoices model class Invoices extends Phalcon\Mvc\Model { public function getSource() { return 'invoices'; } } // Companies model class Companies extends Phalcon\Mvc\Model { public function getSource() { return 'companies'; } public function initialize() { // All invoices relationship $this-&gt;hasMany( 'id', 'Invoices', 'inv_id', [ 'alias' =&gt; 'invoices', 'reusable' =&gt; true, ] ); // Paid invoices relationship $this-&gt;hasMany( 'id', 'Invoices', 'inv_id', [ 'alias' =&gt; 'invoicesPaid', 'reusable' =&gt; true, 'params' =&gt; [ 'conditions' =&gt; "inv_status = 'paid'" ] ] ); // Unpaid invoices relationship $this-&gt;hasMany( 'id', 'Invoices', 'inv_id', [ 'alias' =&gt; 'invoicesUnpaid', 'reusable' =&gt; true, 'params' =&gt; [ 'conditions' =&gt; "inv_status &lt;&gt; 'paid'" ] ] ); } }</span></span></code> </pre><br><h4>  Update / Install </h4><br>  This version can be installed from the master branch.  If you have not installed Zephir, run the following commands: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://github.com/phalcon/cphalcon git checkout master <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ext sudo ./install</code> </pre><br>  If you already have Zephir installed: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://github.com/phalcon/cphalcon git checkout master zephir fullclean zephir build</code> </pre><br>  <i>Please note that when you run the installation script will replace the already installed version of Phalcon.</i> <br><br>  Windows DLLs are available on <a href="http://phalconphp.com/en/download/windows">the download page</a> . <br><br>  See <a href="https://blog.phalconphp.com/post/guide-upgrading-to-phalcon-2">the upgrade guide</a> if you want to upgrade to Phalcon 2.0.x from 1.3.x. <br><br><ul><li>  <a href="https://docs.phalconphp.com/">Documentation</a> </li><li>  <a href="https://api.phalconphp.com/">API</a> (Thanks <a href="https://github.com/gsouf">gsouf</a> ) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/262007/">https://habr.com/ru/post/262007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261995/index.html">How to remove UIPickerView freezes in iOS simulator</a></li>
<li><a href="../261997/index.html">RailsClub Ruby Mitap # 2 at Rambler & Co office</a></li>
<li><a href="../262001/index.html">The Evolution of Emails in Email Microsites</a></li>
<li><a href="../262003/index.html">Free summer school on HPC in scientific and engineering problems - applications are accepted until July 24</a></li>
<li><a href="../262005/index.html">Statistical analysis of association rules in survey results</a></li>
<li><a href="../262009/index.html">Teach telnet.exe to play the correct MUDs</a></li>
<li><a href="../262011/index.html">The first steps in working with Arduino</a></li>
<li><a href="../262013/index.html">Critical security update for node.js and io.js</a></li>
<li><a href="../262015/index.html">The mystery of flicker noise unraveled</a></li>
<li><a href="../262017/index.html">Shadow DOM: Specification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>