<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mikrotik-Qos Prioritization by type of traffic and speed division</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikrotik-Qos Prioritization by type of traffic and speed division 

 Good day, today it will be about sore, namely, how to competently share the Inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mikrotik-Qos Prioritization by type of traffic and speed division</h1><div class="post__text post__text-html js-mediator-article"><h4>  Mikrotik-Qos Prioritization by type of traffic and speed division </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/066/c6c/749/066c6c74964693e01649b5b3a6fc5d9a.jpg" align="left" alt="image">  Good day, today it will be about sore, namely, how to competently share the Internet channel, so that all your users are as happy as possible. <br><a name="habracut"></a><br><br>  To begin with, according to tradition, I, like all other experts, will send you smoking manuals ... Why?  Yes, just so that you at least slightly figuratively presented how the processes of speed division will proceed.  Because, as practice shows, any actions without awareness of the principles of work leads only to a heap of questions, lost time and an evil accountant, or the director who, due to your fault, did not open a page with tanned blondes this morning :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, manuals: <br><br>  A wonderful article by Alexander Kuzmitsky - <a href="http://mikrotik.axiom-pro.ru/articles/qos.php">Sharing the Internet or QoS at Mikrotik</a> <br>  Read ten times, to a full understanding, if you do not understand - read again ... <br><br>  Two articles from Sergey Lagovsky: <br>  <a href="http://mikrotik.axiom-pro.ru/articles/qosbandwidthcontrol1.php">MikroTik - QoS / Bandwidth Control / Simple Limit</a> <br>  <a href="http://mikrotik.axiom-pro.ru/articles/qosbandwidthcontrol2.php">MikroTik - QoS / Bandwidth Control / Individual rules</a> <br>  It will be very useful to consolidate the basic skills ... <br><br>  A good, but not complete, presentation from Megis, well, and her translation from white_crow for which many thanks to him ... <br>  <a href="http://mikrotik.axiom-pro.ru/library/QoS_Megis.pdf">QoS_Megis.pdf</a> <br>  <a href="http://mikrotik.axiom-pro.ru/library/megisrus.pdf">QoS_Megis_ (Russian_translate_by_white_crow_rev.2) .pdf</a> <br><br>  This prezashka contains an error, read more about it in the next dock. <br><br>  Russian version of the Mikrotik Wiki <br>  <a href="http://wiki.mikrotik.com/wiki/%25D0%25F3%25EA%25EE%25E2%25EE%25E4%25F1%25F2%25E2%25E0:%25CE%25F7%25E5%25F0%25E5%25E4%25FC_(Queue)">http://wiki.mikrotik.com/wiki/Tutorials: Queue_ (Queue)</a> <br>  You do not need to spit saliva and say that you know everything, take a closer look, especially in the comments, discover a little bit of new, especially where SRC-NAT is and why outgoing speed is incorrectly cut because of it. <br><br>  Well?  Have read?  Already have a bunch of questions? <br>  After fumbling around the Internet, it was revealed that micro-administrators have a number of similar problems and issues related to QoS in general, prioritizing and cutting traffic, which is basically the same thing.  However, as a rule, these are either unfinished articles or branches of forums that were abandoned at the most interesting place. <br>  The main goals, problems and issues in them are as follows: <br><br><ul><li>  How to share the speed equally between users? </li><li>  How to increase the priority of a certain type of traffic? </li><li>  How to prioritize a specific user? </li><li>  How to lower the priority of torrents and other P2P traffic so that torrents do not clog the channel, but if the channel is free, give up all the speed? </li><li>  How to make a quick response to certain resources? </li><li>  How to divide users into groups with different priorities? </li><li>  How to lower the priority of downloads, so that the Internet pages open quickly? </li><li>  How not to limit the speed of internal (regional resources) if they come through the same channel? </li><li>  Why doesn't the shaper give out full speed? </li></ul><br><br>  And these are just the main questions ... <br><br>  After reading and reflecting a bit, I came to the conclusion that it would be very hard to think of anything, something that is universal, easily scalable, and extremely usable for the administrator.  After a couple of days, the implementation plan came to mind, and a week later everything was ready ... <br><br>  In general, the task was set: <br><br><h5>  Task 1. </h5><br><br>  Separate traffic by priority. <br>  Sharav on the Internet, came across warnings, they say, p2p is difficult to tag, Skype, too.  And in general, prioritization by type of traffic is not a good idea on microtic. <br><br>  To all, we were embarrassed by the golden words that we cannot control incoming traffic that falls to us from the Internet, since  he ALREADY CAME to our inbound interface.  But these words have a disclaimer - Yes, we cannot control what has already arrived on the interface, but we can detain this traffic through the control fields of packets that will come with delays, we can inform the server that our client cannot so quickly accept data.  As a result, the server will send packets a little slower. <br><br>  So, the question is closed, the separation of traffic by priority will be! <br><br>  A weighted decision was made: ‚ÄúIf it‚Äôs not possible to tag low-priority traffic, we‚Äôll mark all traffic as low-priority, and then redistribute and pull out high-priority traffic from this heap.‚Äù <br><br>  To separate the traffic, four groups (traffic classes) were taken: <br><br>  CLASS-A <br>  CLASS-B <br>  CLASS-C <br>  CLASS-D <br><br>  CLASS-A - has the highest priority, and will be skipped in the very first place. <br>  CLASS-D - has the lowest priority and will be skipped only in the case of channel idleness by higher classes. <br><br><h5>  Task 2. </h5><br>  The division of the total flow into user groups with different priorities. <br>  Here, in principle, questions as such did not arise.  It was decided to make 5 user groups with different priorities, the priorities of the queues were distributed overlapping, so that the high-class traffic of the lower group could compete with the traffic of the upper group of the middle or low class. <br>  As a result, five groups: <br><br>  GROUP-A <br>  GROUP-B <br>  GROUP-C <br>  GROUP-D <br>  GROUP-E <br><br>  GROUP-A - has the highest priority, clients of this group distribute the queue among themselves equally according to the above classes. <br>  GROUP-E - has the lowest priority, clients of this group distribute the queue among themselves equally according to the above classes.  If the groups with a higher priority fully occupy the entire limit, this group will be able to transmit only high-class traffic, according to probability theory and meanness law - this group will not be able to transmit any traffic at all until the channel becomes more free, so for all groups you should set the Limit parameter -At that will give some guarantee that people, at least ICQ will work. <br><br>  As a result, we get a tree, names on the left, priorities on the right: <br><br>  GROUP-A <br>  CLASS-A 1 <br>  CLASS-B 2 <br>  CLASS-C 3 <br>  CLASS-D 4 <br>  GROUP-B <br>  CLASS-A 2 <br>  CLASS-B 3 <br>  CLASS-C 4 <br>  CLASS-D 5 <br>  GROUP-C <br>  CLASS-A 3 <br>  CLASS-B 4 <br>  CLASS-C 5 <br>  CLASS-D 6 <br>  GROUP-D <br>  CLASS-A 4 <br>  CLASS-B 5 <br>  CLASS-C 6 <br>  CLASS-D 7 <br>  GROUP-E <br>  CLASS-A 5 <br>  CLASS-B 6 <br>  CLASS-C 7 <br>  CLASS-D 8 <br><br>  At the points of intersection of priorities, classes of different groups, if there is traffic on them, will share the speed available to them. <br>  For example, <br>  GROUP-A CLASS-C PRIO 3 tries to completely hammer the channel <br><br>  Only the following classes will be allowed to transmit packets: <br>  GROUP-A CLASS-A 1 <br>  GROUP-A CLASS-B 2 <br>  GROUP-B CLASS-A 2 <br>  GROUP-B CLASS-B 3 <br>  GROUP-WITH CLASS-A 3 <br>  moreover, classes with the same priority will divide the speed equally among themselves, classes with a higher priority take away speed from classes with a lower one. <br><br><h5>  Task 3. </h5><br>  Prioritize access to certain resources. <br>  After marking the traffic by type, I added rules that will give priority to certain resources, and divided them into three classes: <br>  CLASS-A-SITES <br>  CLASS-B-SITES <br>  CLASS-C-SITES <br>  By adding lists to the / ip firewall address-list under appropriate names, we can direct traffic to the class we need. <br><br><h5>  Task 4. </h5><br>  Speed ‚Äã‚Äãup the first connection flows. <br>  Quite the dual benefit of this chip, after marking the type of traffic and towards the resources, it was decided to add three rules. <br><br>  All downloads no larger than 5 kilobytes are placed in CLASS-A <br>  All downloads from 5 to 50 kilobytes in size will be moved to CLASS-B <br>  All downloads from 50 to 100 kilobytes in size will be moved to CLASS-C <br>  After 100 kilobytes, packets will no longer be marked and as a rule fall into CLASS-D, these rules do not apply to CLASS-A traffic.  he is so top priority. <br><br>  All this works as a kind of Burst for short connections, fast loading of pages, nimble connections on the remote, fast flight of im-messages, etc. <br>  The reverse side of the medal, all connections will receive this Burst incl.  and P2P. <br><br><h5>  Task 5. </h5><br>  Exclude the regional resources of the provider from the shaper. <br>  To solve this problem, in the rules that mark the streams in different classes, the list! ShaperExclude was added to the Src.address list and Dst.address list fields; all addresses and address ranges that appear in this list will be skipped by shaper rules and regional resources will no longer be limited speed. <br><br><h5>  Task 6. </h5><br>  Leave the administrator the ability to manage PCQ profiles for each group separately. <br>  To solve this problem, ten profiles were created, five per load, five per return, two per group. <br><br><h5>  Task 7. </h5><br>  Blind all this happiness together under the following conditions: <br>  The rules in / ip firewall mangle should not block packets in chains, i.e.  passthrough = yes must be in all rules. <br>  On a microtic, SRC-NAT is enabled, which will greatly affect the open spaces for creativity. <br><br>  We have defined the tasks, now it is up to the implementation and the result. <br><br>  Implementing, taking into account the conditions and the tasks we will be using PCQ queues, we will mark the packets in the forward and prerouting chains. <br><br>  So, an excerpt from help: <br> <code>QoS   ,   : <br> <br> 1. mangle chain prerouting <br> 2. HTB global-in <br> 3. Mangle chain forward <br> 4. Mangle chain postrouting <br> 5. HTB global-out <br> 6. HTB out interface <br> <br>         : <br> <br> a) #1  #2       ,  #3+#5   <br> b) #1  #2       ,  #3+#6   <br> c) #1  #2       ,  #4+#5   <br> d) #1  #2       ,  #4+#6   <br></code> <br><br>  So who all the same was not lazy and once more smoked the manuals about which I spoke at the very beginning.  By the present from Megis, it can be seen that the prioritization by type should lie within the limits of PREROUTING-GLOBAL-IN and the cutting of the FORWARD-HTB INTERFACE speed. <br><br>  First and foremost, it does not make sense to first prioritize and then cut traffic to the user, because  this will only make sense if the Internet channel is full.  And if the user bangs his channel, then there will be little sense from such prioritization. <br><br>  The second and very important note. <br>  The FORWARD-HTB INTERFACE chain will not work with the outgoing channel because  HTB INTERFACE is located after SRC-NAT, the same applies to the FORWARD-GLOBAL-OUT chain, PCQ queues do not work on these chains, who do not believe you can set up a couple of rules and experiment. <br><br>  The third important note. <br>  When SRC-NAT is enabled in the PREROUTING-GLOBAL-IN chain, it will not be possible to catch incoming traffic, or rather, it will turn out to be a lot of perversion and will not work very well. <br><br>  And finally, now I will throw a big brick in the garden to those who shout that using Global-in, Global-out, Global-Total as Parent is not right and generally a complete heresy.  So, dear, imagine for a second that a brick came to you in the garden, and a vitauha from your SECOND provider was tied to it.  Catch what you mean?  How much can a router spend on dubbing rules?  And if they are not two and five will be? <br><br>  Enough criticism ... <br><br>  So, since it so happened that you can mark and then cut, we will mark and cut at the same time. <br>  Once in the Forward chain, the shaper does not work for outgoing traffic, then we will do it in the <b>PREROUTING-GLOBAL-TOTAL</b> chain <br>  Once in the Prerouting chain, we cannot know which of the gray addresses the packet arrived in, then we will mark them in the <b>FORWARD-GLOBAL-OUT</b> chain. <br><br><h5>  As Gagarin said: ‚ÄúLet's go!‚Äù </h5><br><br><h6>  First, let's add a couple of L-7 sets to determine the type of traffic: </h6><br><br> <code>/ip firewall layer7-protocol <br> add name=Skype regexp="^..\\x02............." <br> add name=radmin regexp="^\\x01\\x01(\\x08\\x08|\\x1b\\x1b)\$" <br> add name=rdp regexp="rdp\r\ <br> \nrdpdr.*cliprdr.*rdpsnd" <br> add name=http regexp="http/(0\\.9|1\\.0|1\\.1) [1-5][0-9][0-9]|post [\\x09-\\x\ <br> 0d -~]* http/[01]\\.[019]" <br> add name=Jabber regexp=\ <br> "&lt;stream:stream[\\x09-\\x0d ][ -~]*[\\x09-\\x0d ]xmlns=['\"]jabber" <br> add name=GIF_FILE regexp=gif <br> add name=PNG_FILE regexp=png <br></code> <br><br><h6>  Mark all traffic in CLASS-D </h6><br> <code>/ip firewall mangle <br> add action=accept chain=forward comment=CLASS-D disabled=yes <br> add action=mark-connection chain=forward comment=ALLTRAFFIC disabled=no new-connection-mark=CLASS-D passthrough=yes <br> add action=mark-packet chain=forward comment=CLASS-D-GROUP-E-DL connection-mark=CLASS-D disabled=no dst-address-list=GROUP-E new-packet-mark=CLASS-D-GROUP-E-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-D-GROUP-D-DL connection-mark=CLASS-D disabled=no dst-address-list=GROUP-D new-packet-mark=CLASS-D-GROUP-D-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-D-GROUP-C-DL connection-mark=CLASS-D disabled=no dst-address-list=GROUP-C new-packet-mark=CLASS-D-GROUP-C-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-D-GROUP-B-DL connection-mark=CLASS-D disabled=no dst-address-list=GROUP-B new-packet-mark=CLASS-D-GROUP-B-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-D-GROUP-A-DL connection-mark=CLASS-D disabled=no dst-address-list=GROUP-A new-packet-mark=CLASS-D-GROUP-A-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=prerouting comment=CLASS-D-GROUP-E-UP connection-mark=CLASS-D disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-D-GROUP-E-UP passthrough=yes src-address-list=GROUP-E <br> add action=mark-packet chain=prerouting comment=CLASS-D-GROUP-D-UP connection-mark=CLASS-D disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-D-GROUP-D-UP passthrough=yes src-address-list=GROUP-D <br> add action=mark-packet chain=prerouting comment=CLASS-D-GROUP-C-UP connection-mark=CLASS-D disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-D-GROUP-C-UP passthrough=yes src-address-list=GROUP-C <br> add action=mark-packet chain=prerouting comment=CLASS-D-GROUP-B-UP connection-mark=CLASS-D disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-D-GROUP-B-UP passthrough=yes src-address-list=GROUP-B <br> add action=mark-packet chain=prerouting comment=CLASS-D-GROUP-A-UP connection-mark=CLASS-D disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-D-GROUP-A-UP passthrough=yes src-address-list=GROUP-A <br> add action=accept chain=forward comment=CLASS-D disabled=yes <br></code> <br><br><h5>  Re-package higher class CLASS-C </h5><br> <code>add action=accept chain=forward comment=CLASS-C disabled=yes <br> add action=mark-connection chain=forward comment=Proxy disabled=no dst-port=3128 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=HTTP disabled=no layer7-protocol=http new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=HTTPS disabled=no dst-port=443 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=FTP disabled=no dst-port=20,21 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=SFTP disabled=no dst-port=22 new-connection-mark=CLASS-C packet-size=1400-1500 passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=SMTP disabled=no dst-port=25 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=SMTPS disabled=no dst-port=465 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=Imap disabled=no dst-port=143 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=POP3 disabled=no dst-port=110 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=POP3S disabled=no dst-port=995 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=IMAPS disabled=no dst-port=993 new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=GIF_FILE disabled=no layer7-protocol=GIF_FILE new-connection-mark=CLASS-C passthrough=yes <br> add action=mark-connection chain=forward comment=PNG_FILE disabled=no layer7-protocol=PNG_FILE new-connection-mark=CLASS-C passthrough=yes <br> add action=mark-connection chain=forward comment=CLASS-C-SITES disabled=no new-connection-mark=CLASS-C passthrough=yes src-address-list=CLASS-C-SITES <br> add action=mark-connection chain=forward comment=CLASS-C-SITES disabled=no dst-address-list=CLASS-C-SITES new-connection-mark=CLASS-C passthrough=yes <br> add action=mark-connection chain=forward comment="100Kb Connections" connection-bytes=0-100000 disabled=no new-connection-mark=CLASS-C passthrough=yes protocol=tcp <br> add action=mark-packet chain=forward comment=CLASS-C-GROUP-E-DL connection-mark=CLASS-C disabled=no dst-address-list=GROUP-E new-packet-mark=CLASS-C-GROUP-E-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-C-GROUP-D-DL connection-mark=CLASS-C disabled=no dst-address-list=GROUP-D new-packet-mark=CLASS-C-GROUP-D-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-C-GROUP-C-DL connection-mark=CLASS-C disabled=no dst-address-list=GROUP-C new-packet-mark=CLASS-C-GROUP-C-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-C-GROUP-B-DL connection-mark=CLASS-C disabled=no dst-address-list=GROUP-B new-packet-mark=CLASS-C-GROUP-B-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-C-GROUP-A-DL connection-mark=CLASS-C disabled=no dst-address-list=GROUP-A new-packet-mark=CLASS-C-GROUP-A-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=prerouting comment=CLASS-C-GROUP-E-UP connection-mark=CLASS-C disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-C-GROUP-E-UP passthrough=yes src-address-list=GROUP-E <br> add action=mark-packet chain=prerouting comment=CLASS-C-GROUP-D-UP connection-mark=CLASS-C disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-C-GROUP-D-UP passthrough=yes src-address-list=GROUP-D <br> add action=mark-packet chain=prerouting comment=CLASS-C-GROUP-C-UP connection-mark=CLASS-C disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-C-GROUP-C-UP passthrough=yes src-address-list=GROUP-C <br> add action=mark-packet chain=prerouting comment=CLASS-C-GROUP-B-UP connection-mark=CLASS-C disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-C-GROUP-B-UP passthrough=yes src-address-list=GROUP-B <br> add action=mark-packet chain=prerouting comment=CLASS-C-GROUP-A-UP connection-mark=CLASS-C disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-C-GROUP-A-UP passthrough=yes src-address-list=GROUP-A <br> add action=accept chain=forward comment=CLASS-C disabled=yes <br></code> <br><br><h6>  Redesign higher class CLASS-B packages. </h6><br> <code>add action=accept chain=forward comment=CLASS-B disabled=yes <br> add action=mark-connection chain=forward comment=ICQ disabled=no dst-port=5190 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment="Mail.ru Agent" disabled=no dst-port=2041,2042 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=Jabber disabled=no layer7-protocol=Jabber new-connection-mark=CLASS-B passthrough=yes <br> add action=mark-connection chain=forward comment=IRC disabled=no dst-port=6667-6669 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=SSH disabled=no dst-port=22 new-connection-mark=CLASS-B packet-size=0-1400 passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=TELNET disabled=no dst-port=23 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=SNMP disabled=no dst-port=161-162 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=PPTP disabled=no dst-port=1723 new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=L2TP disabled=no dst-port=1701 new-connection-mark=CLASS-B passthrough=yes protocol=udp <br> add action=mark-connection chain=forward comment=GRE disabled=no new-connection-mark=CLASS-B passthrough=yes protocol=gre <br> add action=mark-connection chain=forward comment=Skype disabled=no layer7-protocol=Skype new-connection-mark=CLASS-B passthrough=yes <br> add action=mark-connection chain=forward comment=CLASS-B-SITES disabled=no new-connection-mark=CLASS-B passthrough=yes src-address-list=CLASS-B-SITES <br> add action=mark-connection chain=forward comment=CLASS-B-SITES disabled=no dst-address-list=CLASS-B-SITES new-connection-mark=CLASS-B passthrough=yes <br> add action=mark-connection chain=forward comment="50Kb Connections" connection-bytes=0-50000 disabled=no new-connection-mark=CLASS-B passthrough=yes protocol=tcp <br> add action=mark-packet chain=forward comment=CLASS-B-GROUP-E-DL connection-mark=CLASS-B disabled=no dst-address-list=GROUP-E new-packet-mark=CLASS-B-GROUP-E-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-B-GROUP-D-DL connection-mark=CLASS-B disabled=no dst-address-list=GROUP-D new-packet-mark=CLASS-B-GROUP-D-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-B-GROUP-C-DL connection-mark=CLASS-B disabled=no dst-address-list=GROUP-C new-packet-mark=CLASS-B-GROUP-C-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-B-GROUP-B-DL connection-mark=CLASS-B disabled=no dst-address-list=GROUP-B new-packet-mark=CLASS-B-GROUP-B-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-B-GROUP-A-DL connection-mark=CLASS-B disabled=no dst-address-list=GROUP-A new-packet-mark=CLASS-B-GROUP-A-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=prerouting comment=CLASS-B-GROUP-E-UP connection-mark=CLASS-B disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-B-GROUP-E-UP passthrough=yes src-address-list=GROUP-E <br> add action=mark-packet chain=prerouting comment=CLASS-B-GROUP-D-UP connection-mark=CLASS-B disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-B-GROUP-D-UP passthrough=yes src-address-list=GROUP-D <br> add action=mark-packet chain=prerouting comment=CLASS-B-GROUP-C-UP connection-mark=CLASS-B disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-B-GROUP-C-UP passthrough=yes src-address-list=GROUP-C <br> add action=mark-packet chain=prerouting comment=CLASS-B-GROUP-B-UP connection-mark=CLASS-B disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-B-GROUP-B-UP passthrough=yes src-address-list=GROUP-B <br> add action=mark-packet chain=prerouting comment=CLASS-B-GROUP-A-UP connection-mark=CLASS-B disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-B-GROUP-A-UP passthrough=yes src-address-list=GROUP-A <br> add action=accept chain=forward comment=CLASS-B disabled=yes <br></code> <br><br><h6>  Redesign higher class CLASS-A packages. </h6><br> <code>add action=accept chain=forward comment=CLASS-A disabled=yes <br> add action=mark-connection chain=forward comment=DNS disabled=no dst-port=53 new-connection-mark=CLASS-A passthrough=yes protocol=tcp src-port=53 <br> add action=mark-connection chain=forward comment=DNS disabled=no dst-port=53 new-connection-mark=CLASS-A passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=DNS disabled=no dst-port=53 new-connection-mark=CLASS-A passthrough=yes protocol=udp <br> add action=mark-connection chain=forward comment=NNTP disabled=no dst-port=119 new-connection-mark=CLASS-A passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=Winbox disabled=no dst-port=8291 new-connection-mark=CLASS-A passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=ntp disabled=no dst-port=123 new-connection-mark=CLASS-A passthrough=yes protocol=udp <br> add action=mark-connection chain=forward comment=VNC disabled=no dst-port=5900-5901 new-connection-mark=CLASS-A passthrough=yes protocol=tcp <br> add action=mark-connection chain=forward comment=Radmin disabled=no layer7-protocol=radmin new-connection-mark=CLASS-A passthrough=yes <br> add action=mark-connection chain=forward comment=RDP disabled=no layer7-protocol=rdp new-connection-mark=CLASS-A passthrough=yes <br> add action=mark-connection chain=forward comment=PING disabled=no new-connection-mark=CLASS-A passthrough=yes protocol=icmp <br> add action=mark-connection chain=forward comment=CLASS-A-SITES disabled=no new-connection-mark=CLASS-A passthrough=yes src-address-list=CLASS-A-SITES <br> add action=mark-connection chain=forward comment=CLASS-A-SITES disabled=no dst-address-list=CLASS-A-SITES new-connection-mark=CLASS-A passthrough=yes <br> add action=mark-connection chain=forward comment="5Kb Connections" connection-bytes=0-5000 disabled=no new-connection-mark=CLASS-A passthrough=yes protocol=tcp <br> add action=mark-packet chain=forward comment=CLASS-A-GROUP-E-DL connection-mark=CLASS-A disabled=no dst-address-list=GROUP-E new-packet-mark=CLASS-A-GROUP-E-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-A-GROUP-D-DL connection-mark=CLASS-A disabled=no dst-address-list=GROUP-D new-packet-mark=CLASS-A-GROUP-D-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-A-GROUP-C-DL connection-mark=CLASS-A disabled=no dst-address-list=GROUP-C new-packet-mark=CLASS-A-GROUP-C-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-A-GROUP-B-DL connection-mark=CLASS-A disabled=no dst-address-list=GROUP-B new-packet-mark=CLASS-A-GROUP-B-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=forward comment=CLASS-A-GROUP-A-DL connection-mark=CLASS-A disabled=no dst-address-list=GROUP-A new-packet-mark=CLASS-A-GROUP-A-DL passthrough=yes src-address-list=!ShaperExclude <br> add action=mark-packet chain=prerouting comment=CLASS-A-GROUP-E-UP connection-mark=CLASS-A disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-A-GROUP-E-UP passthrough=yes src-address-list=GROUP-E <br> add action=mark-packet chain=prerouting comment=CLASS-A-GROUP-D-UP connection-mark=CLASS-A disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-A-GROUP-D-UP passthrough=yes src-address-list=GROUP-D <br> add action=mark-packet chain=prerouting comment=CLASS-A-GROUP-C-UP connection-mark=CLASS-A disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-A-GROUP-C-UP passthrough=yes src-address-list=GROUP-C <br> add action=mark-packet chain=prerouting comment=CLASS-A-GROUP-B-UP connection-mark=CLASS-A disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-A-GROUP-B-UP passthrough=yes src-address-list=GROUP-B <br> add action=mark-packet chain=prerouting comment=CLASS-A-GROUP-A-UP connection-mark=CLASS-A disabled=no dst-address-list=!ShaperExclude new-packet-mark=CLASS-A-GROUP-A-UP passthrough=yes src-address-list=GROUP-A <br> add action=accept chain=forward comment=CLASS-A disabled=yes <br></code> <br><br><h6>  Now it‚Äôs probably worth scoring empty address lists, so for beauty ... </h6><br> <code>/ip firewall address-list <br> add address=192.168.0.1 disabled=no list=GROUP-A <br> add address=192.168.0.2 disabled=no list=GROUP-B <br> add address=192.168.0.4 disabled=no list=GROUP-D <br> add address=192.168.0.3 disabled=no list=GROUP-C <br> add address=192.168.0.5 disabled=no list=GROUP-E <br> add address=0.0.0.0 disabled=no list=CLASS-A-SITES <br> add address=0.0.0.0 disabled=no list=CLASS-B-SITES <br> add address=0.0.0.0 disabled=no list=CLASS-C-SITES <br> add address=192.168.0.0/16 disabled=no list=ShaperExclude <br> add address=10.0.0.0/8 disabled=no list=ShaperExclude <br></code> <br><br>  Now that we‚Äôre done with the firewall, it‚Äôs time to get into the queue types and <s>plant the liver</s> to build a tree. <br><br><h6>  Create queue types </h6><br> <code>/queue type <br> add kind=pcq name=GROUP-A-DL pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=50 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-B-DL pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=50 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-C-DL pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=50 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-D-DL pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=50 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-E-DL pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=dst-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=50 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-A-UP pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=150 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-B-UP pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=150 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-C-UP pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=150 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-D-UP pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=150 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br> add kind=pcq name=GROUP-E-UP pcq-burst-rate=0 pcq-burst-threshold=0 pcq-burst-time=10s pcq-classifier=src-address pcq-dst-address-mask=32 pcq-dst-address6-mask=64 pcq-limit=150 pcq-rate=0 pcq-src-address-mask=32 pcq-src-address6-mask=64 pcq-total-limit=2000 <br></code> <br><br>  Pay close attention that the PCQ Rate parameter is not limited by anything, since  I left the subflow rate at your discretion, by default the maximum subflow rate will be limited by the Max.Limit parameter divided by the number of subflows divided by classes. <br><br><h6>  Build a tree: </h6><br> <code>/queue tree <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=10M name=DOWNLOAD parent=global-out priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=10M name=UPLOAD parent=global-total priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-A-UP parent=UPLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AA-UP packet-mark=CLASS-A-GROUP-A-UP parent=GROUP-A-UP priority=1 queue=GROUP-A-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BA-UP packet-mark=CLASS-B-GROUP-A-UP parent=GROUP-A-UP priority=2 queue=GROUP-A-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CA-UP packet-mark=CLASS-C-GROUP-A-UP parent=GROUP-A-UP priority=3 queue=GROUP-A-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DA-UP packet-mark=CLASS-D-GROUP-A-UP parent=GROUP-A-UP priority=4 queue=GROUP-A-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-B-UP parent=UPLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AB-UP packet-mark=CLASS-A-GROUP-B-UP parent=GROUP-B-UP priority=2 queue=GROUP-B-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BB-UP packet-mark=CLASS-B-GROUP-B-UP parent=GROUP-B-UP priority=3 queue=GROUP-B-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CB-UP packet-mark=CLASS-C-GROUP-B-UP parent=GROUP-B-UP priority=4 queue=GROUP-B-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DB-UP packet-mark=CLASS-D-GROUP-B-UP parent=GROUP-B-UP priority=5 queue=GROUP-B-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-C-UP parent=UPLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AC-UP packet-mark=CLASS-A-GROUP-C-UP parent=GROUP-C-UP priority=3 queue=GROUP-C-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BC-UP packet-mark=CLASS-B-GROUP-C-UP parent=GROUP-C-UP priority=4 queue=GROUP-C-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CC-UP packet-mark=CLASS-C-GROUP-C-UP parent=GROUP-C-UP priority=5 queue=GROUP-C-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DC-UP packet-mark=CLASS-D-GROUP-C-UP parent=GROUP-C-UP priority=6 queue=GROUP-C-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-D-UP parent=UPLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AD-UP packet-mark=CLASS-A-GROUP-D-UP parent=GROUP-D-UP priority=4 queue=GROUP-D-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BD-UP packet-mark=CLASS-B-GROUP-D-UP parent=GROUP-D-UP priority=5 queue=GROUP-D-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CD-UP packet-mark=CLASS-C-GROUP-D-UP parent=GROUP-D-UP priority=6 queue=GROUP-D-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DD-UP packet-mark=CLASS-D-GROUP-D-UP parent=GROUP-D-UP priority=7 queue=GROUP-D-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-E-UP parent=UPLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AE-UP packet-mark=CLASS-A-GROUP-E-UP parent=GROUP-E-UP priority=5 queue=GROUP-E-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BE-UP packet-mark=CLASS-B-GROUP-E-UP parent=GROUP-E-UP priority=6 queue=GROUP-E-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CE-UP packet-mark=CLASS-C-GROUP-E-UP parent=GROUP-E-UP priority=7 queue=GROUP-E-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DE-UP packet-mark=CLASS-D-GROUP-E-UP parent=GROUP-E-UP priority=8 queue=GROUP-E-UP <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-A-DL parent=DOWNLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AA-DL packet-mark=CLASS-A-GROUP-A-DL parent=GROUP-A-DL priority=1 queue=GROUP-A-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BA-DL packet-mark=CLASS-B-GROUP-A-DL parent=GROUP-A-DL priority=2 queue=GROUP-A-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CA-DL packet-mark=CLASS-C-GROUP-A-DL parent=GROUP-A-DL priority=3 queue=GROUP-A-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DA-DL packet-mark=CLASS-D-GROUP-A-DL parent=GROUP-A-DL priority=4 queue=GROUP-A-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-B-DL parent=DOWNLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AB-DL packet-mark=CLASS-A-GROUP-B-DL parent=GROUP-B-DL priority=2 queue=GROUP-B-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BB-DL packet-mark=CLASS-B-GROUP-B-DL parent=GROUP-B-DL priority=3 queue=GROUP-B-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CB-DL packet-mark=CLASS-C-GROUP-B-DL parent=GROUP-B-DL priority=4 queue=GROUP-B-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DB-DL packet-mark=CLASS-D-GROUP-B-DL parent=GROUP-B-DL priority=5 queue=GROUP-B-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-C-DL parent=DOWNLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AC-DL packet-mark=CLASS-A-GROUP-C-DL parent=GROUP-C-DL priority=3 queue=GROUP-C-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BC-DL packet-mark=CLASS-B-GROUP-C-DL parent=GROUP-C-DL priority=4 queue=GROUP-C-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CC-DL packet-mark=CLASS-C-GROUP-C-DL parent=GROUP-C-DL priority=5 queue=GROUP-C-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DC-DL packet-mark=CLASS-D-GROUP-C-DL parent=GROUP-C-DL priority=6 queue=GROUP-C-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-D-DL parent=DOWNLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AD-DL packet-mark=CLASS-A-GROUP-D-DL parent=GROUP-D-DL priority=4 queue=GROUP-D-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BD-DL packet-mark=CLASS-B-GROUP-D-DL parent=GROUP-D-DL priority=5 queue=GROUP-D-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CD-DL packet-mark=CLASS-C-GROUP-D-DL parent=GROUP-D-DL priority=6 queue=GROUP-D-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DD-DL packet-mark=CLASS-D-GROUP-D-DL parent=GROUP-D-DL priority=7 queue=GROUP-D-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=GROUP-E-DL parent=DOWNLOAD priority=8 <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-AE-DL packet-mark=CLASS-A-GROUP-E-DL parent=GROUP-E-DL priority=5 queue=GROUP-E-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-BE-DL packet-mark=CLASS-B-GROUP-E-DL parent=GROUP-E-DL priority=6 queue=GROUP-E-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-CE-DL packet-mark=CLASS-C-GROUP-E-DL parent=GROUP-E-DL priority=7 queue=GROUP-E-DL <br> add burst-limit=0 burst-threshold=0 burst-time=0s disabled=no limit-at=0 max-limit=0 name=CLASS-DE-DL packet-mark=CLASS-D-GROUP-E-DL parent=GROUP-E-DL priority=8 queue=GROUP-E-DL <br></code> <br><br>  On this we can say the implementation is complete. <br><br>  I also think it is worth mentioning the need to use the <b>Limit-at</b> and <b>Max-limit</b> parameters in each group at least for the reason that everyone needs the Internet :) <br>  It is also useful to set up profiles of groups, again I will take you to the side of the presentation from Megis, which says about the size of the queue, delays and packet losses. <br><br>  In addition, for beginners I will say a few words: This set of rules is absolutely useless if you do not set <b>Max-Limit</b> values ‚Äã‚Äãin the roots of <b>DOWNLOAD</b> and <b>UPLOAD</b> <br>  <b>Max-Limit</b> values ‚Äã‚Äãshould be set LESS than the real speed of your channel on the Internet by 5-10 percent, otherwise the setting will be absolutely meaningless, because  your provider will drop or delay packets that do not fit in the output stream. <br><br>  In general, everything, everything else is done to taste and color, changing the priority is done by changing the connection label and moving the rule through the list. <br>  Adding a new specific type in the same way or by banal copying the rule with the subsequent movement and editing. <br><br>  If there are several channels, the Max.Limit parameter sets the sum of the speeds of these channels. <br><br>  For your convenience, I post the <a href="">RSC import file into the system</a> , as well as screenshots for a more complete view of the work.  Use on health! <br><br><h5>  Mangle </h5><br><img src="http://mikrotik.axiom-pro.ru/articles/images/priorityshaper/Mangle_s.jpg" alt="image"><br>  <a href="">Full size pichka</a> <br><br><h5>  Queue </h5><br><img src="http://mikrotik.axiom-pro.ru/articles/images/priorityshaper/Queue_s.jpg" alt="image"><br>  <a href="">Full size pichka</a> <br><br>  I want to express my deep gratitude to all those brilliant people who, with their knowledge and answers on the forums, brought me to the right thoughts and the right direction. <br>  This article may contain some inaccuracies in the description, due to the lack of high qualifications of the author and the lack of free time. <br><br>  I would be very happy with your ‚ÄúThank you!‚Äù Which should be sent personally to me, according to the coordinates that you can find in your profile. <br>  I will also listen and consider constructive criticism on your part, I will be glad to communicate with experts working in a similar direction, I will take into account your amendments and additions. </div><p>Source: <a href="https://habr.com/ru/post/131295/">https://habr.com/ru/post/131295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131285/index.html">Cipher Copiale Cipher XVIII century decrypted using statistical machine translation</a></li>
<li><a href="../131286/index.html">Nokia Lumia 800 and 710 Short Review</a></li>
<li><a href="../131288/index.html">Sisyphus.js - protect user form data from accidental loss</a></li>
<li><a href="../131289/index.html">Requirements for cloud platforms in the Russian Federation</a></li>
<li><a href="../131291/index.html">TechCranch - not idiocy</a></li>
<li><a href="../131296/index.html">According to statistics, more than 50% of sites use jQuery</a></li>
<li><a href="../131297/index.html">Android flaws in tablets</a></li>
<li><a href="../131298/index.html">Subtext: communication in the pages of books</a></li>
<li><a href="../131299/index.html">SITH - CSS3 technology for smooth image change</a></li>
<li><a href="../131300/index.html">SQL Server 2008: backup wisely. Part 1: Theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>