<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHPUnit: Mock Objects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often when writing unit tests, we have to deal with the fact that the class under test depends on data from external sources, the state of which...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHPUnit: Mock Objects</h1><div class="post__text post__text-html js-mediator-article">  Quite often when writing unit tests, we have to deal with the fact that the class under test depends on data from external sources, the state of which we cannot control.  Such sources include a far-located publicly accessible database or service, a sensor of some physical process, etc. Or we need to make sure that certain actions are performed in a strictly defined order.  In these cases, Mock objects come to our aid (mock in English is a parody), allowing us to test classes in isolation from external dependencies.  This article is devoted to the use of Mock objects in PHPUnit. <br><a name="habracut"></a><br>  As an example, take the following class description: <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showWord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($word)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemperature</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> getWord($temparature) { $temperature = (int)$temparature; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($temperature &lt; <span class="hljs-number"><span class="hljs-number">15</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'cold'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($temperature &gt; <span class="hljs-number"><span class="hljs-number">25</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'hot'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'warm'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $temperature = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTemperature(); $word = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getWord($temperature); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;showWord($word); } }</code> </pre> <br>  Objects of this class are designed to display on one device one of the three weather conditions, depending on the ambient temperature.  At the time of writing the code, neither the device for displaying the result, nor the temperature sensor is inaccessible, and an attempt to access them may lead to a program crash. <br><br>  In the simplest case, to check the logic, we can inherit from the specified class, replace the plugs with methods that apply to unconnected devices, and conduct unit testing on the child instance.  Approximately the same implemented Mock objects in PHPUnit, where it provides additional convenience in the form of built-in API. <br><br><h4>  Getting a mock object </h4><br>  To get an instance of a Mock object, use the getMock () method: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClassTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Framework_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMock(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,   $mock    MyClass $this-&gt;assertInstanceOf('MyClass', $mock); } }</span></span></code> </pre><br>  As you can see, getting the Mock object we need is very simple.  By default, all methods in it will be replaced by stubs that do nothing and always return null. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  GetMock call options </h5><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $originalClassName, //   ,     Mock  $methods = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, //           array $arguments = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, // ,    $mockClassName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, //    Mock  $callOriginalConstructor = true, //   __construct</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params"> $callOriginalClone = true, //   __clone</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params"> $callAutoload = true //   __autoload</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>;</code> </pre><br>  Passing the getMock () constructor as the second argument to a null value will result in a Mock object being returned without any changes at all. <br><br><h5>  getMockBuilder </h5><br>  For those who prefer to write in a chain style, PHPUnit offers the corresponding constructor: <br><pre> <code class="php hljs">$mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMockBuilder(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>) -&gt;setMethods(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) -&gt;setConstructorArgs(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>()) -&gt;setMockClassName(<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ,   Mock  "" -&gt;disableOriginalConstructor() -&gt;disableOriginalClone() -&gt;disableAutoload() -&gt;getMock();</span></span></code> </pre><br>  The chain should always begin with the getMockBuilder () method and be uploaded with the getMock () method ‚Äî these are the only links in the chain that are mandatory. <br><br><h5>  Additional ways to get Mock objects </h5><br><ul><li>  getMockFromWsdl () - allows you to build Mock objects based on the description from the <a href="http://ru.wikipedia.org/wiki/WSDL">WSDL</a> ; </li><li>  getMockClass () - creates a mock class and returns its name as a string; </li><li>  getMockForAbstractClass () - returns the Mock object of the abstract class, in which all abstract methods are substituted. </li></ul><br>  All this is beautiful - you say, but what next?  In response, I will say that we have just come to the most interesting. <br><br><h4>  Waiting for method call </h4><br>  PHPUnit allows us to control the number and order of calls of the substituted methods.  To do this, use the construction of expects () followed by the indication of the desired method using method ().  As an example, let us turn to the class cited at the beginning of the article and write the following test for it: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMock(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'getTemperature'</span></span>, <span class="hljs-string"><span class="hljs-string">'getWord'</span></span>, <span class="hljs-string"><span class="hljs-string">'showWord'</span></span>)); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;once())-&gt;method(<span class="hljs-string"><span class="hljs-string">'getTemperature'</span></span>); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;once())-&gt;method(<span class="hljs-string"><span class="hljs-string">'showWord'</span></span>); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;once())-&gt;method(<span class="hljs-string"><span class="hljs-string">'getWord'</span></span>); $mock-&gt;process(); }</code> </pre><br>  The result of this test will be successful if, when calling the process () method, a single call of the three listed methods occurs: getTemperature (), getWord (), showWord ().  Note that in the test, the test for the getWord () call is after the test for the showWord () call, although in the test method, the opposite is true.  That's right, there is no error.  To control the order of calling methods in PHPUnit, another construction is used - at ().  Let's correct a little the code of our test so that PHPUnit checks the sequence of the method call at the same time: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMock(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'getTemperature'</span></span>, <span class="hljs-string"><span class="hljs-string">'getWord'</span></span>, <span class="hljs-string"><span class="hljs-string">'showWord'</span></span>)); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;at(<span class="hljs-number"><span class="hljs-number">0</span></span>))-&gt;method(<span class="hljs-string"><span class="hljs-string">'getTemperature'</span></span>); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;at(<span class="hljs-number"><span class="hljs-number">2</span></span>))-&gt;method(<span class="hljs-string"><span class="hljs-string">'showWord'</span></span>); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;at(<span class="hljs-number"><span class="hljs-number">1</span></span>))-&gt;method(<span class="hljs-string"><span class="hljs-string">'getWord'</span></span>); $mock-&gt;process(); }</code> </pre><br>  In addition to the once () and at () mentioned, there are also the following constructs for testing call expectations in PHPUnit: any (), never (), atLeastOnce () and exactly ($ count).  Their names speak for themselves. <br><br><h4>  Override return result </h4><br>  By far the most useful function of Mock objects is the ability to emulate the returned result by substituted methods.  Let us again refer to the process () method of our class.  We see there is an appeal to the temperature sensor - getTemperature ().  But we also remember that in fact we do not have a sensor.  Although even if we had one, we would not cool it below 15 degrees or heat it above 25 in order to test all possible situations.  As you may have guessed, in this case Mock objects come to our aid.  We can force the method that interests us to return any result we want using the will () construction.  Here is an example: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@dataProvider</span></span></span><span class="hljs-comment"> provider_process */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($temperature)</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMock(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'getTemperature'</span></span>, <span class="hljs-string"><span class="hljs-string">'getWord'</span></span>, <span class="hljs-string"><span class="hljs-string">'showWord'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  getTemperature()   $temperature $mock-&gt;expects($this-&gt;once())-&gt;method('getTemperature')-&gt;will($this-&gt;returnValue($temperature)); $mock-&gt;process(); } public static function provider_process() { return array( 'cold' =&gt; array(10), 'warm' =&gt; array(20), 'hot' =&gt; array(30), ); }</span></span></code> </pre><br>  Obviously, this test covers all possible values ‚Äã‚Äãthat our test class can handle.  PHPUnit offers the following constructions for use with will (): <br><ul><li>  returnValue ($ value) - returns $ value; </li><li>  returnArgument ($ index) - returns the argument with the number $ index, specified when calling the method; </li><li>  returnSelf () - returns a pointer to itself, useful for testing chain methods; </li><li>  returnValueMap ($ map) - used to return a result based on certain sets of arguments; </li><li>  returnCallback ($ callback) - passes arguments to the specified function and returns its result; </li><li>  onConsecutiveCalls () - successively returns one of the listed arguments with each subsequent method call; </li><li>  throwException ($ exception) - throws the specified exception. </li></ul><br><h4>  Validation of the specified arguments </h4><br>  Another useful feature for testing the ability of Mock objects is to check the arguments specified when calling the substituted method using the with () construction: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_with_and_will_usage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMock(<span class="hljs-string"><span class="hljs-string">'MyClass'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'getWord'</span></span>)); $mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;once()) -&gt;method(<span class="hljs-string"><span class="hljs-string">'getWord'</span></span>) -&gt;with(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;greaterThan(<span class="hljs-number"><span class="hljs-number">25</span></span>)) -&gt;will(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;returnValue(<span class="hljs-string"><span class="hljs-string">'hot'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-string"><span class="hljs-string">'hot'</span></span>, $mock-&gt;getWord(<span class="hljs-number"><span class="hljs-number">30</span></span>)); }</code> </pre><br>  As with arguments, it can take all the same constructions as the check of assertThat (), so here I will only give a list of possible constructions without their detailed description: <br><ul><li>  attribute () </li><li>  anything () </li><li>  arrayHasKey () </li><li>  contains () </li><li>  equalTo () </li><li>  attributeEqualTo () </li><li>  fileExists () </li><li>  greaterThan () </li><li>  greaterThanOrEqual () </li><li>  classHasAttribute () </li><li>  classHasStaticAttribute () </li><li>  hasAttribute () </li><li>  identicalTo () </li><li>  isFalse () </li><li>  isInstanceOf () </li><li>  isNull () </li><li>  isTrue () </li><li>  isType () </li><li>  lessThan () </li><li>  lessThanOrEqual () </li><li>  matchesRegularExpression () </li><li>  stringContains () </li></ul><br>  All the listed constructions can be combined using logical constructs logicalAnd (), logicalOr (), logicalNot () and logicalXor (): <br><pre> <code class="php hljs">$mock-&gt;expects(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;once()) -&gt;method(<span class="hljs-string"><span class="hljs-string">'getWord'</span></span>) -&gt;with(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logicalAnd(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;greaterThanOrEqual(<span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;lessThanOrEqual(<span class="hljs-number"><span class="hljs-number">25</span></span>))) -&gt;will(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;returnValue(<span class="hljs-string"><span class="hljs-string">'warm'</span></span>));</code> </pre><br>  Now that we are fully familiar with the capabilities of Mock objects in PHPUnit, we can conduct final testing of our class: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@dataProvider</span></span></span><span class="hljs-comment"> provider_process */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($temperature, $expected_word)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Mock ,  getWord()  process()      $mock = $this-&gt;getMock('MyClass', array('getTemperature', 'showWord')); //  getTemperature()    $temperature $mock-&gt;expects($this-&gt;once())-&gt;method('getTemperature')-&gt;will($this-&gt;returnValue($temperature)); // ,   showWord()    $expected_word $mock-&gt;expects($this-&gt;once())-&gt;method('showWord')-&gt;with($this-&gt;equalTo($expected_word)); //  $mock-&gt;process(); } public static function provider_process() { return array( 'cold' =&gt; array(10, 'cold'), 'warm' =&gt; array(20, 'warm'), 'hot' =&gt; array(30, 'hot'), ); }</span></span></code> </pre><br>  UPD: <a href="http://habrahabr.ru/users/volch/" class="user_link">VolCh</a> rightly <a href="http://habrahabr.ru/post/140217/">noted</a> that writing tests, like the one presented above, is antipattern.  Therefore, the above example should be considered solely in order to familiarize yourself with the capabilities of Mock objects in PHPUnit. <br><br><h4>  Substitution of static methods </h4><br>  Starting with PHPUnit version 3.5, it became possible to substitute static methods using the static construct staticExpects (): <br><pre> <code class="php hljs">$class = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getMockClass(<span class="hljs-string"><span class="hljs-string">'SomeClass'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    PHP  5.3   //       call_user_func_array() $class::staticExpects($this-&gt;once())-&gt;method('someStaticMethod'); $class::someStaticMethod();</span></span></code> </pre><br>  In order for this innovation to be of practical use, it is necessary that within the class under test a call to the replaced static method be performed in one of the following ways: <br><ul><li>  $ this-&gt; staticMethod () - from dynamic methods; </li><li>  static :: staticMethod () - from static and dynamic methods. </li></ul><br>  Due to <a href="http://ru.php.net/manual/en/language.oop5.late-static-bindings.php">self limitations, the</a> substitution of static methods called inside the class in the following way will not work: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::staticMethod();</code> </pre><br><h4>  Conclusion </h4><br>  In conclusion, I‚Äôll say that you shouldn‚Äôt get too carried away with Mock objects for any purpose other than isolating the class under test from external data sources.  Otherwise, for any, even minor, change of the source code, you most likely will also need to edit the tests themselves.  A rather significant refactoring can lead to the fact that you have to completely rewrite them altogether. </div><p>Source: <a href="https://habr.com/ru/post/140217/">https://habr.com/ru/post/140217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140212/index.html">Search Quality in Runet - 2011</a></li>
<li><a href="../140213/index.html">What do androids dream about</a></li>
<li><a href="../140214/index.html">We write a cache with a certain storage time of objects using java.util.concurrent</a></li>
<li><a href="../140215/index.html">Fading stripes on CSS3 without images</a></li>
<li><a href="../140216/index.html">Redefinition of functions in PHP 5.3</a></li>
<li><a href="../140219/index.html">Preparing rails environments for installing Redmine using RVM</a></li>
<li><a href="../140220/index.html">New Apple Office Floor Plans</a></li>
<li><a href="../140221/index.html">Corporate applications speed</a></li>
<li><a href="../140222/index.html">Smart pointers for beginners</a></li>
<li><a href="../140223/index.html">Running TechDays.ru in Clouds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>