<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Facebook API: How to allow commenting on a wall post to everyone [upd: 09/25/2011]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue to learn Facebook API [upd 09/25/2011] 

 This time I ran into comments. 

 Required: sending messages to the user's wall, followed by comm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Facebook API: How to allow commenting on a wall post to everyone [upd: 09/25/2011]</h1><div class="post__text post__text-html js-mediator-article"> I continue to learn Facebook API [upd 09/25/2011] <br><br>  This time I ran into comments. <br><br>  <b>Required:</b> sending messages to the user's wall, followed by commenting. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Task:</b> to give the opportunity to comment on the post to all Facebook users, not just friends. <br><br>  And I will immediately disappoint: <u>today (09/21/2011) there is no human way to give access to commenting directly to everyone via Graph api.</u> <br><br>  Those.  there is a way of commenting, but by default commenting is allowed only for friends of the user whose record is located.  If someone else is trying to leave a comment on your message, they will receive an error message with this content: <br><br> <code>(#100) Error finding the requested story //    </code> <br> <br><a name="habracut"></a><br><br>  By the way, in order to comment, let's say posts on the wall of the application, you must first approve it by clicking on ‚ÄúI like‚Äù, in order to comment on the messages on the group wall, you need to join the group, etc. <br><br>  On the other hand, if you install a comment plugin on the site and use it to send a message to the user's wall, then any visitor to this site will be able to comment on it (the message) (if he has already logged in on Facebook). <br><br>  Remarkably, there is a way, it only remains to find out how everything works. <br><br>  Only here is an ambush: in the documentation for the plugin only ryushki - tips on setting up the look (scant ones should be noted) and other unnecessary crap.  There are no hints about how and where the data from the plugin is sent.  But if you get wall entries through the API: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"data"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"100001957292289_178950362180206"</span></span>, <span class="hljs-string"><span class="hljs-string">"from"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"\u0410\u043d\u0442\u043e\u043d \u0413\u043e\u0440\u043e\u0434\u0435\u0446\u043a\u0438\u0439"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"100001957292289"</span></span> }, <span class="hljs-string"><span class="hljs-string">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Cats!"</span></span>, <span class="hljs-string"><span class="hljs-string">"actions"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Comment"</span></span>, <span class="hljs-string"><span class="hljs-string">"link"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://www.facebook.com/100001957292289/posts/178950362180206"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Like"</span></span>, <span class="hljs-string"><span class="hljs-string">"link"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://www.facebook.com/100001957292289/posts/178950362180206"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"privacy"</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Friends of Friends"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"FRIENDS_OF_FRIENDS"</span></span>, <span class="hljs-string"><span class="hljs-string">"allow"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"deny"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span> }, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"status"</span></span>, <span class="hljs-string"><span class="hljs-string">"application"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"pilot"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"174611799256077"</span></span> }, <span class="hljs-string"><span class="hljs-string">"created_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"2011-09-21T18:24:50+0000"</span></span>, <span class="hljs-string"><span class="hljs-string">"updated_time"</span></span>: <span class="hljs-string"><span class="hljs-string">"2011-09-21T18:24:50+0000"</span></span>, <span class="hljs-string"><span class="hljs-string">"comments"</span></span>: { <span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } },</code> </pre><br><br>  That no trace of the newly recorded record will not be there.  And no wonder.  Long-term studies show that wall posts are type: status, while wall posts sent from the comment plugin are type: link_stat. <br><br>  After reading thoughtfully 70-80 on stackoverflow.com, in the most natural sense, I get an overflow of the stack of the brain and in anticipation of the deprivation of my mind I stumble upon this design: <br><br> <code><a href="http"></a> graph.facebook.com/comments/?ids=http://example.org/post/35/</code> <br> <br>  By that time, I had played enough with the experiments, so without departing from the cash register, I try this design in Facebook-explorere. <br><br>  And lo and behold - I get the coveted JSON with information about this post. <br><br>  By the way, if at the same address (https://graph.facebook.com/DIGITS_MOREDIGITS/comments) to make a post-request, then a new post will be sent: <br> <code><a href="http"></a> graph.facebook.com/comments/?ids=http://nadvoe.org.ua/stud.my/post/35/</code> <br> <br>  So, I send GET, I get the post id out of the returned json-object and try to send a comment on this id: <br><br> <code><a href="https://graph.facebook.com/DIGITS_MOREDIGITS/comments"></a> graph.facebook.com/DIGITS_MOREDIGITS/comments</code> <br> <br>  To which I get a response from Facebook: <br> <code>(#100) Invalid fbid. //      </code> <br> <br>  <s>By the same way again complex mental frauds, I find out that the comments will freely go if everything is removed from the id from the bottom line:</s> <s><br><br> <code><a href="https://graph.facebook.com/DIGITS"></a> graph.facebook.com/DIGITS <s>_MOREDIGITS</s> /comments</code> <br> <br></s>  <s>Comments will be sent to this address successfully, and from any users.</s> <s><br></s> <br><br>  <b>[upd 09/25/2011]</b> <b><br><br></b>  <b>In the identifier DIGITS_MOREDIGITS, DIGITS is an identifier of an object of type type: website, together these characters make up the <a href="http://developers.facebook.com/docs/reference/fql/comment/">value of the id field from the comment table</a></b> <b><br><br></b>  <b>Below are new conclusions about this.</b> <b><br></b> <br><br>  Those.  in principle, DIGITS_MOREDIGITS is the correct message identifier, but if you try to get comments on this address: <br> <code><a href="https://graph.facebook.com/DIGITS_MOREDIGITS/comments"></a> graph.facebook.com/DIGITS_MOREDIGITS/comments</code> <br>  facebook will return void in json format. <br><br>  It would be logical to try to make an FQL query to the comment table, putting id = DIGITS_MOREDIGITS in the condition.  But the id field in the comment table (no matter how strange and mysterious it is!) Is not indexed, which Facebook will kindly remind us of: <br><blockquote>  Your statement is not indexable.  The WHERE clause must contain an indexable column.  Such columns are marked with * in the tables </blockquote><br><br>  <b>offtop: I send hate rays to facebook developers for not doing a column that should be canonically indexed.</b> <br><br>  By the way, the identifier by which you can extract comments to a specific post is in the <u>post_fbid</u> column (also, by the way, not indexable). <br><br>  Thus, the subtask is reduced to identifying the correspondence between these identifiers.  The truth is that we can only have the URL to which the comment plugin was attached.  In this case, from the link_stat table (as mentioned above - this is just the type of those posts that are sent from the comments plug-in to the wall) we need to extract the object identifier (object_id) by url.  And then by this identifier select all fbid_post and id.  In general it is better to show the query (FQL): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> post_fbid, <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> object_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> comments_fbid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> link_stat <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span> =<span class="hljs-string"><span class="hljs-string">'".base_url()."'</span></span>)</code> </pre><br><br>  Accordingly, I supplemented my facebook class extension with the function of receiving id_ for which you can get_ or send_comment on id_ who_returns_ after_the creation of post_through_plugin_ of comments: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* **   id ,       facebook **     id,   facebook    POST-query   /comments/?ids={$url} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRealPostId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($given_post_id)</span></span></span><span class="hljs-function"> </span></span>{ $fql =<span class="hljs-string"><span class="hljs-string">" SELECT post_fbid, id FROM comment WHERE object_id IN (SELECT comments_fbid FROM link_stat WHERE url ='"</span></span>.base_url().<span class="hljs-string"><span class="hljs-string">"') "</span></span>; $params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'query'</span></span> =&gt; $fql, <span class="hljs-string"><span class="hljs-string">'method'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'fql.query'</span></span>, <span class="hljs-string"><span class="hljs-string">'callback'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ); $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;api($params); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($row[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]==$given_post_id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $row[<span class="hljs-string"><span class="hljs-string">'post_fbid'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br><br>  [/ upd] <br><br>  In principle, all this works wonderfully, but then I try to introduce it to my site, then I get another unpleasant surprise in the form of an error: <br> <code>"Unknown identifier, "</code> <br> <br>  Facebook complains that this identifier is not known to him.  Searching the personal Facebook section on stackoverflow makes me think that each address must be initialized before it can be used. <br><br>  This can be done in two ways (although essentially one): <br><br><ol><li>  Run a comment plugin on your site </li><li>  View the source of the iframe plugin comments and pull this source "transparently" for the user and once for all new URLs on the site. </li></ol><br><br>  By the second method I decided the case (the extended facebook php sdk class was used, the function is written under codeigniter): <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   URL   key- $new_id = $this-&gt;base-&gt;add( array( 'key_post' =&gt; 'NULL' ) ); $url = base_url().'post/'.$new_id.'/'; //   ,       $context = stream_context_create(array( 'http' =&gt; array( 'method' =&gt; 'GET', 'header' =&gt; 'User-Agent: Mozilla/5.0 (X11; Linux i686; rv:6.0.2) Gecko/20100101 Firefox/6.0.2 FirePHP/0.6'. 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'. 'Accept-Language: ru-ru,ru;q=0.8,en-us;q=0.5,en;q=0.3'. 'Accept-Encoding: gzip, deflate'. 'Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.7'. 'Connection: keep-alive'. 'Referer: http://www.nadvoe.org.ua/stud.my/'. 'Cookie: '.implode(';',$_COOKIE), ), )); $w = file_get_contents('https://www.facebook.com/plugins/comments.php?href='.urlencode($url),false,$context); //  ,         id $result = $this-&gt;facebook-&gt;postMessageByUrl($url,$this-&gt;fields['message_post']); //      $last_post = $this-&gt;facebook-&gt;getPost($result['id']); $this-&gt;fields['id_post'] = $last_post['id']; $this-&gt;fields['created_time_post'] = strtotime($last_post['created_time']); $this-&gt;fields['id_user_post'] = $this-&gt;session-&gt;myId(); //     if ($this-&gt;base-&gt;edit($this-&gt;fields,$new_id,'key')) { $this-&gt;NOTIFY-&gt;success(' '); $this-&gt;NOTIFY-&gt;returnNotify(); } else { $this-&gt;NOTIFY-&gt;returnError(' '); } }</span></span></code> </pre><br><br><br>  This is how you can ensure that anyone can comment on your posts on your facebook wall left through the app. </div><p>Source: <a href="https://habr.com/ru/post/128949/">https://habr.com/ru/post/128949/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128942/index.html">Chuck spared Groupon</a></li>
<li><a href="../128943/index.html">Chronicles Pentester</a></li>
<li><a href="../128944/index.html">Are you interested in articles / translations of an article about "hacking" an interview with Google?</a></li>
<li><a href="../128945/index.html">ConfeT & QA Testers Online Conference</a></li>
<li><a href="../128948/index.html">Immersion into the scripts of the Unity3d game engine, part 2</a></li>
<li><a href="../128951/index.html">Validation messages in Russian in Rails 3</a></li>
<li><a href="../128952/index.html">Ocsigen 2.0 - a new version of the framework for OCaml</a></li>
<li><a href="../128953/index.html">Developing a game application for the iPhone. Part 3</a></li>
<li><a href="../128954/index.html">Future brand logos</a></li>
<li><a href="../128955/index.html">Firefox Sync OR Xmarks? AND!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>