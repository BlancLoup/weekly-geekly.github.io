<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Here you are, grandmother, and namespaces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Experience of using namespaces in client XHTML 


 Text Rostislav Chebykina. 
 I brought you a package. But I will not give it to you, because you hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Here you are, grandmother, and namespaces</h1><div class="post__text post__text-html js-mediator-article"><p>  <strong>Experience of using namespaces in client XHTML</strong> </p><br><p>  <em>Text Rostislav Chebykina.</em> </p><br><blockquote>  I brought you a package.  But I will not give it to you, because you have no documents. <br>  Postman Pechkin </blockquote><p>  Together with Denis Lesnov, we are developing an audio player for the site, which was already <a href="https://habrahabr.ru/post/256329/">told here in 2015</a> .  Now an updated version is on the way, which can play not only individual tracks, but also entire playlists. </p><br><p>  This article is not about the player itself, but about the unexpected phenomena that we encountered when trying to use real XHTML. </p><br><a name="habracut"></a><br><p>  ‚Ä¢ </p><br><p>  The main goal of our project is to enjoy joint programming.  Therefore, we write code the way we like it and use technologies that interest us. </p><br><p>  For example, I was interested in XHTML since the W3C Consortium published the first drafts of this standard, and many enthusiasts rushed to promote the updated language.  At that time, many hoped that the entire Internet was about to switch to XML-compatible markup, and from this there would be a universal happiness. </p><br><p>  On my own website, the web pages always followed the syntax of XHTML and were sent with the application / xhtml + xml type to the browsers that supported it.  A few years ago, I generally stopped giving text / html. </p><br><p> By now, the hype around XHTML has subsided, the corresponding <a href="http://www.w3.org/2007/03/XHTML2-WG-charter">working group of the Consortium has</a> closed after several years of prostration, and then enthusiasts have switched to other fashionable concepts.  I‚Äôm sorry that many promising XHTML 2.0 ideas haven‚Äôt been so widely implemented.  For example, the standard proposed that any element could be turned into a hyperlink by assigning to it the <code>href</code> attribute: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/about/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/contacts/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Alas, this did not materialize, so for canonical idioms of web interfaces like ‚Äúclickable‚Äù pictures, you still have to use the <code>img</code> element and the a element separately, as in the early 1990s. </p><br><p>  ‚Ä¢ </p><br><p>  Maybe XHTML ‚Äúdidn‚Äôt take off‚Äù because enthusiasts never managed to demonstrate its practical advantages.  On fan sites, the XHTML code was purely cosmetic in nature and did not contain anything that plain HTML would not provide.  On the contrary, XHTML limited the old-school developers by not allowing their favorite <code>document.write</code> and forcing to explicitly insert <code>tbody</code> into each table. </p><br><p>  In 2016, I finally decided to try the endemic possibilities of XHTML, namely the namespace.  I wanted the components of the audio player to be self-made elements in their own namespace: </p><br><p><img src="https://habrastorage.org/files/77c/613/32b/77c61332bf724ea19c97fdd690d09d9a.jpeg" alt="image"></p><br><p>  As expected, the namespace and its prefix are declared in the opening <code>html</code> tag: </p><br><pre> <code class="hljs pgsql">&lt;html xmlns="http://www.w3.org/1999/xhtml" xmlns:p="http://rostislav.chebykin.ru/xmlns" lang="ru" <span class="hljs-type"><span class="hljs-type">xml</span></span>:lang="ru"&gt;</code> </pre> <br><p>  The introduction of self-made elements in the code did not cause any problems, but it did not bring any benefit.  The benefit should have come after these elements will take on the appearance with CSS and come to life with JavaScript.  And here began the hitch. </p><br><p>  ‚Ä¢ </p><br><p>  First, at the stage of the initial testing of the idea, it turned out that the <code>style</code> attribute does not work for homemade elements: </p><br><pre> <code class="hljs mel">&lt;p:<span class="hljs-keyword"><span class="hljs-keyword">track</span></span> style=<span class="hljs-string"><span class="hljs-string">"background: #999;"</span></span> /&gt; <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre> <br><p>  The corresponding attribute appears in the DOM tree, but the background element on the page is not painted in the specified color. </p><br><p>  But when you connect a separate style sheet (in an external file or in the <code>style</code> element), the CSS successfully operates, and self-made elements are drawn using the namespace selector: </p><br><pre> <code class="hljs objectivec">p|track { background: <span class="hljs-meta"><span class="hljs-meta">#999; }</span></span></code> </pre> <br><p>  However, for this to work, the first rule in the style sheet is to declare <code>@namespace</code> : </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@namespace</span></span> p url(<span class="hljs-symbol"><span class="hljs-symbol">'http</span></span>:<span class="hljs-comment"><span class="hljs-comment">//rostislav.chebykin.ru/xmlns');</span></span></code> </pre> <br><p>  Thus, we managed to decorate the <code>track</code> in the desired color and give the <code>playhead</code> element a round shape.  But it still did not provide the dynamics, which is the essence of the player interface.  And this dynamic led us into the wilds. </p><br><p>  ‚Ä¢ </p><br><p>  To work with namespaces in the DOM there are methods <code>createElementNS</code> and <code>getElementsByTagNameNS</code> .  Their behavior in some places confuses me: for example, the <code>p|track</code> selector acts on an element regardless of whether the namespace prefix is ‚Äã‚Äãspecified in the second argument of <code>createElementNS</code> : </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ns = <span class="hljs-string"><span class="hljs-string">'http://rostislav.chebykin.ru/xmlns'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElementNS(ns, <span class="hljs-string"><span class="hljs-string">'p:track'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElementNS(ns, <span class="hljs-string"><span class="hljs-string">'track'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       p|track</span></span></code> </pre> <br><p>  But <code>getElementsByTagNameNS</code> wants to get the name strictly without a prefix, no matter which of the two ways the element was created: </p><br><pre> <code class="hljs ruby">document.getElementsByTagNameNS(ns, <span class="hljs-string"><span class="hljs-string">'track'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  HTMLCollection    document.getElementsByTagNameNS(ns, <span class="hljs-string"><span class="hljs-string">'p:track'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   HTMLCollection</code> </pre> <br><p>  But it still does not matter.  The trouble began further when we tried to animate the whole structure through JS. </p><br><p>  ‚Ä¢ </p><br><p>  Moving the head of the player - it would seem, what could be easier?  Get the desired position, convert it to a percentage and assign it to the <code>left</code> property: </p><br><pre> <code class="hljs swift">playhead.style.<span class="hljs-keyword"><span class="hljs-keyword">left</span></span> = pos;</code> </pre> <br><p>  (Here, the <code>playhead</code> variable points to the desired element in the DOM, and <code>pos</code> is a percentage line in CSS format, such as <code>'12.34%'</code> ). </p><br><p>  But no!  It turns out that the <code>playhead</code> does not have a <code>style</code> property.  To figure out why this happened, <code>playhead</code> compare the <code>playhead</code> prototype <code>playhead</code> with the standard HTML element chain: </p><br><pre> <code class="hljs delphi">playhead: Element ‚Üê Node ‚Üê EventTarget ‚Üê <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">div</span></span>: HTMLDivElement ‚Üê HTMLElement ‚Üê Element ‚Üê Node ‚Üê EventTarget ‚Üê <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span></code> </pre> <br><p>  The <code>style</code> property, which provides access to the CSS properties of an element, is defined in the <code>HTMLElement</code> interface and is absent from its parent <code>Element</code> . </p><br><p>  Trying to transfer the "native" <code>style</code> from the <code>HTMLElement</code> to homemade elements, we were defeated.  Even if you just type in the console <code>HTMLElement.prototype.style</code> , an error message <code>HTMLElement.prototype.style</code> , and all the more so with this property you can‚Äôt do anything meaningful. </p><br><p>  I had to use the <a href="http://www.w3.org/TR/cssom-1/">CSS Object Model</a> : dynamically connect external CSS, get to its rules, which have the same <code>style</code> property, and nail this <code>style</code> to the appropriate elements with nails: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> link = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'link'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   link'   //    head playhead.style = link.sheet.cssRules.item(1).style</span></span></code> </pre> <br><p>  After this, constructs like <code>playhead.style.left = pos;</code>  started working ... everywhere except Safari.  Unexpectedly, it turned out that <code>Element.prototype</code> does have a <code>style</code> property in this extravagant browser, and the descriptors of this property do not allow it to be assigned anything.  The problem was solved by redefining the <code>style</code> personally for our elements: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.defineProperty(playhead, <span class="hljs-string"><span class="hljs-string">'style'</span></span>, { writable: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> });</code> </pre> <br><p>  ‚Ä¢ </p><br><p>  Finally, a separate surprise was how the <code>querySelector</code> , <code>querySelectorAll</code> and <code>matches</code> methods that take CSS selectors as arguments are bypassed with namespaces, for example: </p><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'p|track'</span></span>); playhead.matches(<span class="hljs-string"><span class="hljs-string">'p|playhead'</span></span>);</code> </pre> <br><p>  Here, each browser found its own words to express bewilderment: </p><br><table><tbody><tr><td>  Edge </td><td>  NamespaceError </td></tr><tr><td>  Chrome </td><td>  Uncaught DOMException: Failed to execute 'matches' on 'Element': 'p | playhead' is not a valid selector </td></tr><tr><td>  Firefox </td><td>  SyntaxError: An invalid or illegal string was specified </td></tr><tr><td>  Safari </td><td>  NamespaceError (DOM Exception 14): Namespaces in XML </td></tr></tbody></table><br><p>  The reason is that the listed methods cannot resolve the prefix <code>p</code> and associate it with the corresponding namespace.  In XHTML, there is an <code>xmlns</code> attribute for declaring namespaces, @namespace in CSS, and <code>@namespace</code> in JavaScript!  - there is nothing.  Characteristically, the <code>document.createNSResolver</code> method works in browsers, but its result is not screwed to methods of the <code>querySelectorAll</code> type. </p><br><p>  The <a href="http://www.w3.org/TR/selectors-api2/">Selectors API</a> says that "namespace prefix needs to be resolved," but is immediately attributed: "This specification does not provide support for resolving arbitrary namespace prefixes."  Interestingly, in the draft versions of the specification there was <a href="http://www.w3.org/TR/2007/WD-selectors-api-20071221/">an NSResolver interface</a> and a corresponding argument was proposed in the "selector" methods: </p><br><pre> <code class="hljs objectivec">Element querySelector(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DOMString selectors, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSResolver</span></span> nsresolver);</code> </pre> <br><p>  However, on the way to the recommendation of the W3C, <code>NSResolver</code> was villainously drank, and as a result, the specification behaves like the postman Pechkin: ‚ÄúI brought you a package, only I will not give it to you, because you have no documents‚Äù. </p><br><p>  I would not be surprised if in a few years the Consortium declares XHTML language deprecated and obsolete, and browsers refuse to support application / xhtml + xml.  I hope that before this time Denis and I will be able to finish the next version of the audio player so that it will be preserved on the Internet at least as a museum piece. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/318984/">https://habr.com/ru/post/318984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318970/index.html">Neural network optimization methods</a></li>
<li><a href="../318972/index.html">Adaptive jQuery without window.matchMedia</a></li>
<li><a href="../318976/index.html">How IT professionals work. Ilya Safonov, Senior Research Scientist at Schlumberger</a></li>
<li><a href="../318980/index.html">Theoretical Foundations of VMware Virtual SAN 6.5</a></li>
<li><a href="../318982/index.html">The history of one bug (# 1653967)</a></li>
<li><a href="../318986/index.html">Translation of excerpts from Robert Heinlein‚Äôs book, Take Your Government Back - part 20</a></li>
<li><a href="../318990/index.html">Empathy in Internet services or why the cart is ‚Äúmine‚Äù and not ‚Äúyour‚Äù</a></li>
<li><a href="../318992/index.html">Floating commercial data center Nautilus Data Technologies will begin work this year</a></li>
<li><a href="../318994/index.html">Notes freelancer: how to stop being afraid and start working for yourself</a></li>
<li><a href="../318996/index.html">Pink Eurollers dream of censorship on the topic "1984"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>