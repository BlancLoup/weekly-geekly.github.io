<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recognize the Generic Class Parameter in Java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you do not program in Java very often, then this topic is most likely to be useless for you. Do not read it :) 

 Recently it was necessary to solv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recognize the Generic Class Parameter in Java</h1><div class="post__text post__text-html js-mediator-article">  <font color="#888">If you do not program in Java very often, then this topic is most likely to be useless for you.</font>  <font color="#888">Do not read it :)</font> <br><br>  Recently it was necessary to solve the following problem: to determine the class, which is parameterized by the generic class. <br><br>  If someone faced a similar task, then he probably also immediately tried to write something like this: <blockquote><code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> AbstractEntityFactory&lt;E <font color="#0000ff">extends</font> Entity&gt; { <br> <font color="#0000ff">public</font> Class getEntityClass() { <br> <font color="#0000ff">return</font> <b>E. <font color="#0000ff">class</font></b> ; <br> } <br> }</font></code> </blockquote> <br>  Alas, the IDE or the compiler will immediately indicate to you the error (‚Äúcannot select from a type variable‚Äù in the standard compiler): ‚Äú <font color="black">E. <font color="#0000ff">class</font></font> ‚Äù is not a valid construction.  The fact is that in the general case, during the execution of a program, information about the real parameters of our generic class may no longer exist.  Therefore, such a construction in Java cannot work. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If we write <blockquote> <code><font color="black"><font color="#2B91AF">ArrayList</font> &lt;Float&gt; listOfNumbers = <font color="#0000ff">new</font> <font color="#2B91AF">ArrayList</font> &lt;Float&gt;();</font></code> </blockquote>  then, due to the <a title="Type erasure" href="http://en.wikipedia.org/wiki/Generics_in_Java">erasure of types,</a> we cannot analyze the listOfNumbers to find out that this is an ArrayList parameterized by Float, and not by anything else.  Unfortunately, Java Generics work this way: ( <br><br>  Is information about the parameters of generic classes always lost without a trace during compilation and does not exist at runtime?  No, there is.  But only in the information about the class, which explicitly defines the value of the parameter in its generic parent.  Select the class under study: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> FloatList extends <font color="#2B91AF">ArrayList</font> &lt;Float&gt;{}</font></code> </blockquote> <blockquote> <code><font color="black"><font color="#2B91AF">ArrayList</font> &lt;Float&gt; listOfNumbers = <font color="#0000ff">new</font> <font color="#2B91AF">FloatList</font> ();</font></code> </blockquote> <br>  Now, if we analyze through the listOfNumbers reflections, we can find out that this is an object of the FloatList class for which the ancestor is an ArrayList and this ArrayList inside the FloatList has been parameterized by the Float class.  The Class.getGenericSuperclass () method will help us learn all this. <blockquote> <code><font color="black">Class actualClass = listOfNumbers.getClass(); <br> ParameterizedType type = (ParameterizedType)actualClass.getGenericSuperclass(); <br> System. <font color="#0000ff">out</font> .println(type); <font color="#008000">// java.util.ArrayList&lt;java.lang.Float&gt;</font> <br> Class parameter = (Class)type.getActualTypeArguments()[0]; <br> System. <font color="#0000ff">out</font> .println(parameter); <font color="#008000">// class java.lang.Float</font></font></code> </blockquote> <br>  Thus, now we can find out the actual parameter of the generic class if this parameter was explicitly specified (that is, the parameter is defined inside the extends section of one of the heirs).  Suppose we cannot solve the problem of determining the type of a parameter in a general form, but in many cases even what we received is enough. <br><br>  We put everything in a separate method: <blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ReflectionUtils { <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> Class getGenericParameterClass(Class actualClass, <font color="#0000ff">int</font> parameterIndex) { <br> <font color="#0000ff">return</font> (Class) ((ParameterizedType) actualClass.getGenericSuperclass()).getActualTypeArguments()[parameterIndex]; <br> } <br> }</font></code> </blockquote> <br>  Rewrite our original class: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> AbstractEntityFactory&lt;E extends Entity&gt; { <br> <font color="#0000ff">public</font> Class getEntityClass() { <br> <font color="#0000ff">return</font> ReflectionUtils.getGenericParameterClass( <font color="#0000ff">this</font> .getClass(), 0); <br> } <br> }</font></code> </blockquote> <br>  Everything, the problem is solved!  Or not?.. <br><br>  Suppose that the class ExtendedFloatList is inherited from FloatList?  Obviously, actualClass.getGenericSuperclass () will return to us the wrong class (FloatList instead of ExtendedFloatList).  And if the hierarchy will be <i>even</i> more difficult?  Our method turns out to be useless.  Summarize our problem.  Suppose that we have the following class hierarchy: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ReflectionUtilsTest extends TestCase { <br> <font color="#008000">//    "" </font> <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">class</font> A&lt;K, L&gt; { <br> <font color="#008000">// String, Integer</font> <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">class</font> B&lt;P, Q, R extends Collection&gt; extends A&lt;Q, P&gt; { <br> <font color="#008000">// Integer, String, Set</font> <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">class</font> C&lt;X extends Comparable&lt; <font color="#2B91AF">String</font> &gt;, Y, Z&gt; extends B&lt;Z, X, Set&lt;Long&gt;&gt; { <br> <font color="#008000">// String, Double, Integer</font> <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">class</font> D&lt;M, N extends Comparable&lt;Double&gt;&gt; extends C&lt; <font color="#2B91AF">String</font> , N, M&gt; { <br> <font color="#008000">// Integer, Double</font> <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">class</font> E extends D&lt;Integer, Double&gt; { <br> <font color="#008000">//</font> <br> } <br> }</font></code> </blockquote> <br>  Let now we need from the instance of class E to get the information that its ancestor B received the class String as the second parameter (Q). <br><br>  So what has changed?  First, now we need to analyze not the immediate parent, but ‚Äúclimb‚Äù along the class hierarchy to a certain ancestor.  Secondly, we need to take into account that the parameters can be set not in the nearest heir of the class being analyzed, but ‚Äúbelow‚Äù.  Third, a simple caste of a parameter to Class may not pass ‚Äî the parameter itself may be a parameterized class.  Let's try to take all this into account ... <br><br><blockquote> <code><font color="black">import java.lang.reflect.GenericDeclaration; <br> import java.lang.reflect.ParameterizedType; <br> import java.lang.reflect.Type; <br> import java.lang.reflect.TypeVariable; <br> import java.util.Stack; <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">* Alex Tracer (c) 2009</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> ReflectionUtils { <br> <br> <font color="#008000">/**</font> <br> <font color="#008000">*              generic-.</font> <br> <font color="#008000">*</font> <br> <font color="#008000">* @param actualClass    </font> <br> <font color="#008000">* @param genericClass  ,     </font> <br> <font color="#008000">* @param parameterIndex  </font> <br> <font color="#008000">* @return        ,     parameterIndex  genericClass</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> Class getGenericParameterClass(final Class actualClass, final Class genericClass, final <font color="#0000ff">int</font> parameterIndex) { <br> <font color="#008000">//    genericClass    actualClass.</font> <br> <font color="#0000ff">if</font> (!genericClass.isAssignableFrom(actualClass.getSuperclass())) { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalArgumentException( <font color="#A31515">"Class "</font> + genericClass.getName() + <font color="#A31515">" is not a superclass of "</font> <br> + actualClass.getName() + <font color="#A31515">"."</font> ); <br> } <br> <br> <font color="#008000">//    ,      genericClass.</font> <br> <font color="#008000">//      ,      .</font> <br> <font color="#008000">//        genericClasses   -      .</font> <br> <br> <font color="#008000">//   -    .</font> <br> Stack&lt;ParameterizedType&gt; genericClasses = <font color="#0000ff">new</font> Stack&lt;ParameterizedType&gt;(); <br> <br> <font color="#008000">// clazz -   </font> <br> Class clazz = actualClass; <br> <br> <font color="#0000ff">while</font> ( <font color="#0000ff">true</font> ) { <br> Type genericSuperclass = clazz.getGenericSuperclass(); <br> boolean isParameterizedType = genericSuperclass instanceof ParameterizedType; <br> <font color="#0000ff">if</font> (isParameterizedType) { <br> <font color="#008000">//   -  ,    -      .</font> <br> genericClasses.push((ParameterizedType) genericSuperclass); <br> } <font color="#0000ff">else</font> { <br> <font color="#008000">//     .       .</font> <br> genericClasses.clear(); <br> } <br> <font color="#008000">// ,       .</font> <br> Type rawType = isParameterizedType ? ((ParameterizedType) genericSuperclass).getRawType() : genericSuperclass; <br> <font color="#0000ff">if</font> (!rawType.equals(genericClass)) { <br> <font color="#008000">// genericClass       .</font> <br> <font color="#008000">//    .</font> <br> clazz = clazz.getSuperclass(); <br> } <font color="#0000ff">else</font> { <br> <font color="#008000">//     . .</font> <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <br> <font color="#008000">//   .    ,    .</font> <br> Type result = genericClasses.pop().getActualTypeArguments()[parameterIndex]; <br> <br> <font color="#0000ff">while</font> (result instanceof TypeVariable &amp;&amp; !genericClasses.empty()) { <br> <font color="#008000">//     -   ,  .</font> <br> <br> <font color="#008000">//      ,    .</font> <br> <font color="#0000ff">int</font> actualArgumentIndex = getParameterTypeDeclarationIndex((TypeVariable) result); <br> <font color="#008000">//   ,     .</font> <br> ParameterizedType type = genericClasses.pop(); <br> <font color="#008000">//     .</font> <br> result = type.getActualTypeArguments()[actualArgumentIndex]; <br> } <br> <br> <font color="#0000ff">if</font> (result instanceof TypeVariable) { <br> <font color="#008000">//     ,         .</font> <br> <font color="#008000">//  - "Type erasure"     .</font> <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"Unable to resolve type variable "</font> + result + <font color="#A31515">"."</font> <br> + <font color="#A31515">" Try to replace instances of parametrized class with its non-parameterized subtype."</font> ); <br> } <br> <br> <font color="#0000ff">if</font> (result instanceof ParameterizedType) { <br> <font color="#008000">//    .</font> <br> <font color="#008000">//     ,    .</font> <br> result = ((ParameterizedType) result).getRawType(); <br> } <br> <br> <font color="#0000ff">if</font> (result == <font color="#0000ff">null</font> ) { <br> <font color="#008000">// Should never happen. :)</font> <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"Unable to determine actual parameter type for "</font> <br> + actualClass.getName() + <font color="#A31515">"."</font> ); <br> } <br> <br> <font color="#0000ff">if</font> (!(result instanceof Class)) { <br> <font color="#008000">// ,   -   - ,    .</font> <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"Actual parameter type for "</font> + actualClass.getName() + <font color="#A31515">" is not a Class."</font> ); <br> } <br> <br> <font color="#0000ff">return</font> (Class) result; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">int</font> getParameterTypeDeclarationIndex(final TypeVariable typeVariable) { <br> GenericDeclaration genericDeclaration = typeVariable.getGenericDeclaration(); <br> <br> <font color="#008000">//        ,     .</font> <br> TypeVariable[] typeVariables = genericDeclaration.getTypeParameters(); <br> Integer actualArgumentIndex = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; typeVariables.length; i++) { <br> <font color="#0000ff">if</font> (typeVariables[i].equals(typeVariable)) { <br> actualArgumentIndex = i; <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <font color="#0000ff">if</font> (actualArgumentIndex != <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">return</font> actualArgumentIndex; <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> IllegalStateException( <font color="#A31515">"Argument "</font> + typeVariable.toString() + <font color="#A31515">" is not found in "</font> <br> + genericDeclaration.toString() + <font color="#A31515">"."</font> ); <br> } <br> } <br> }</font></code> </blockquote> <br>  Uhh, our "one line" method has become a bulky monster!  :) <br>  I hope comments are enough to understand what is happening;) <br><br>  So, we rewrite our initial class: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> AbstractEntityFactory&lt;E extends Entity&gt; { <br> <font color="#0000ff">public</font> Class getEntityClass() { <br> <font color="#0000ff">return</font> ReflectionUtils.getGenericParameterClass( <font color="#0000ff">this</font> .getClass(), AbstractEntityFactory. <font color="#0000ff">class</font> , 0); <br> } <br> }</font></code> </blockquote> <br>  Now this code will work correctly: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Topic extends Entity { <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TopicFactory extends AbstractEntityFactory&lt;Topic&gt; { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> doSomething() { <br> Class entityClass = getEntityClass(); <font color="#008000">//  Topic</font> <br> } <br> }</font></code> </blockquote> <br>  This is probably all.  Thank you for reading to the end :) <br><br>  <font color="#888">This is my first post on Habr√©.</font>  <font color="#888">I would be grateful for criticism, comments and indications of errors.</font> <br><br>  <b>Upd: the</b> code is corrected for the correct consideration of the situation when somewhere in the hierarchy there is a non-parameterized class. <br>  <b>Upd2:</b> Thanks to the <a href="http://power.habrahabr.ru/">Power</a> user for pointing out errors. <br><br>  <b>Upd3:</b> <a href="">archive with source codes and tests</a> . </div><p>Source: <a href="https://habr.com/ru/post/66593/">https://habr.com/ru/post/66593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66582/index.html">Competition for the most original Google Chrome logo</a></li>
<li><a href="../66583/index.html">Microsoft patented storing tagged text in XML</a></li>
<li><a href="../66585/index.html">Tracker music. We join the great</a></li>
<li><a href="../66591/index.html">Generator</a></li>
<li><a href="../66592/index.html">Boo is a python-like .NET language</a></li>
<li><a href="../66594/index.html">Targeting Promotional Campaigns</a></li>
<li><a href="../66595/index.html">zi.byudzhet or SSS.R (How much is Site.Rub)</a></li>
<li><a href="../66599/index.html">Simplicity in design. Episode 2. DHT and PEX</a></li>
<li><a href="../66601/index.html">Is it really the case with the display for MacBook Pro?</a></li>
<li><a href="../66602/index.html">Lighttpd cacti statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>