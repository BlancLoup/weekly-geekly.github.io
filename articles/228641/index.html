<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Grub 2 + VHD: install and boot Windows 7 Ultimate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 It's no secret to anyone that since the version of Windows 7 Ultimate, Microsoft's operating systems can boot by being installed on a V...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Grub 2 + VHD: install and boot Windows 7 Ultimate</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  It's no secret to anyone that since the version of Windows 7 Ultimate, Microsoft's operating systems can boot by being installed on a VHD format hard disk image.  However, this opportunity out of the box is available only to users of this very Windows 7 Ultimate. <br><br>  I, a dedicated Arch Linux user, need to use this technology has arisen because of the need to have Windows on hand in dual block and in a real environment.  90% of the tasks for which Windows is needed are, of course, solved by virtualization, and the power of modern hardware, and the capabilities of virtual machines, allow even playing games in a virtual environment.  However, it became necessary to use the ‚ÄúUniversal Mechanism‚Äù package, which works crookedly under Vain (I admit that my hands are crooked), and in a virtual environment, understandably, it shamelessly loses its agility.  In general, I needed Windows, but I didn‚Äôt want to drag partitions on the screw and change its markup for the sake of installing one program for Windows. <br><br>  The solution was found in the implementation of booting from a VHD image using the Grub2 boot loader, which has become the de facto standard in many popular Linux distributions.  About this actually will be discussed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What are the advantages over the standard installation of Windows in dual-boot with Linux gives such a technique: <br><br><ul><li>  The entire installation and configuration process is performed in the Linux OS environment using the VirtualBox virtual machine manager </li><li>  The section where images are stored can be of any type: primary or logical.  It does not have to be active. </li><li>  The number of installed systems is limited only by the size of the NTFS partition.  All systems are isolated from each other. </li><li>  MBR is not overwritten, Linux downloader remains intact </li><li>  When replacing the HDD, you can simply copy Linux (the contents of all partitions, read more about it <a href="http://maisvendoo.org/%3Fp%3D261">here</a> ) to a new screw, recursively with the attributes preserved, install Grub 2 to a new screw and voila - your Windows systems will be transferred as if nothing had happened.  It's comfortable </li></ul><br><br>  So, we proceed to the description of the method. <br><br><a name="habracut"></a><br><h4>  1. Soil preparation </h4><br>  To store images, we still need an NTFS partition, which can be both primary and logical, and not necessarily active.  It can be created using <b>gparted</b> , in the same place and formatted in NTFS.  I had an unallocated area reserved for various axes experiments on HDD, which I gave to this section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/069/e32/020/069e32020d63b7ba4219db6e787a12f0.png"><br><br>  Next, make this section available for VirtualBox virtual machines. <br><br><pre><code class="bash hljs">$ VBoxManage internalcommands createrawvmdk -filename ~/&lt;  &gt;/win7.vdmk -rawdisk /dev/&lt;&gt;</code> </pre> <br><br>  that is, we create a virtual disk in the form of a file link to the real HDD partition.  We connect this disk to a virtual machine with Windows 7 Ultimate - it will be useful to us to solve the problem. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f0/e65/787/2f0e65787859e45d566e3be4afc3e783.png"><br><br><h4>  2. Create a VHD image with the system </h4><br>  Now you need to create a VHD-HDD image.  You will have to create it using the tools provided by Windows 7 Ultimate, because disks created by the same VirtualBox cause the subsequent crash of the bootable Windows to the BSOD. <br><br>  We load the virtual machine with Windows.  Go to Control Panel -&gt; System and Security -&gt; Administration -&gt; Computer Management -&gt; Disk Management.  On the right side of the window there is a menu where we select the creation of a virtual disk. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37d/5ab/4f9/37d5ab4f954a082907fc350a924ecd1a.png"><br><br>  then we specify the path to it and set its parameters <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4d/bf9/83a/c4dbf983a3b92456d348245d14e42fca.png"><br><br>  Better yet, choose a fixed image size ‚Äî this will work faster. <br><br>  Click OK and while the process is in progress, we will execute <br><br><h4>  3. Configure bootmgr bootloader </h4><br>  The <b>bootmgr</b> bootloader itself and the directory with its <b>boot</b> config are simply copied from the Windows 7 installation DVD to the root of the NTFS partition, to the same place where the folder with the VHD disks is located. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/585/028/949/58502894999b691eaeb3ee443d67a712.png"><br><br>  Delete the <b>\ boot \ bcd</b> file, because this container stores the configuration from the bootable DVD, and create a new container.  For this we use a tiny utility <a href="http://bbs.ipauly.com/viewtopic.php%3Ff%3D2%26t%3D2">bootice</a> .  Run it, select the ‚ÄúBCD edit‚Äù tab. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/109/052/57f/10905257fa68ab521e70c9d834ace478.png"><br><br>  Next, click ‚ÄúCreate new BCD‚Äù, select the path where the configuration file will be located and create it with the name BCD.  Next, select this file and click ‚ÄúEasy mode‚Äù - launch the editor in the simplified mode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/202/70d/046/20270d0466a266f05a66804ea9455cf8.png"><br><br>  The configuration file will open in edit mode, click the ‚ÄúAdd‚Äù button and select the ‚ÄúNew VHD boot entry‚Äù option.  The editor is a boot record template and we just need to enter the path to our image. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ead/5bc/a47/ead5bca47362236b04ad589ff093da8b.png"><br><br>  The path to the VHD file from the root of the partition with images is written in the ‚ÄúFile‚Äù field.  After that, click ‚ÄúSave current system‚Äù and exit the program. <br><br>  We wait until the process of creating a VHD image is over and leave the virtual seven. <br><br><h4>  4. Installing Windows 7 Ultimate on a VHD image </h4><br>  Implemented by means of VirtualBox.  For this: <br><br><ul><li>  An NTFS image partition was mounted on a Linux host system. </li><li>  A virtual machine has been created, and the image we have created is selected as the disk image. </li><li>  Installed Windows, standard, without tricks </li></ul><br><br>  However, I must say this about what.  We remember that our system is installed in the VM, and therefore some devices are defined at the installation stage and the system slipped the appropriate drivers for them.  When you run on your real computer with a probability of 99%, you will get a BSOD.  This is due to the fact that VirtualBox emulates an IDE controller as follows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b5/f81/282/4b5f812821e6ba04f25098772f429a35.png"><br><br>  and this driver, working in a bootable system, conflicts with the actual one installed on the mat.  board controller, when the system tries to read the image file from the disk.  It is solved simply - select ‚ÄúUpdate driver‚Äù, we say that we should not search and we will specify the driver and select ‚ÄúStandard dual-channel IDE controller‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba7/d86/150/ba7d861500709251d1defd2446bb0f75.png"><br><br>  After that, turn off our virtual machine and make it "real" <br><br><h4>  5. Configuring the Grub2 bootloader </h4><br>  In the Grub2 config, you need to add a boot entry of this type <br><br><pre> <code class="bash hljs">menuentry ‚ÄúWindows 7 Ultimate SP1‚Ä≥ { <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> root=<span class="hljs-string"><span class="hljs-string">'hd0,msdos4‚Ä≤ ntldr /bootmgr }</span></span></code> </pre><br><br>  where (hd0, msdos4) is the NTFS partition where the VHD images are located. <br><br>  After that, you can reboot and try ... <br><br><h4>  Conclusion </h4><br>  After downloading, install the driver on our real hardware and enjoy life: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2b/fba/e7b/a2bfbae7b6e975728b9d72e322e2f18c.jpg"><br><br>  Depicted on screenshots is a full-fledged OS that runs on real hardware.  But it is just a file on your hard drive.  This file can be copied, deleted, moved, archived and so on.  In addition, this method solves the perennial problem of the conflict of Windows vs Linux on one HDD.  Now they peacefully get along with each other and do not spoil each other's life. </div><p>Source: <a href="https://habr.com/ru/post/228641/">https://habr.com/ru/post/228641/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228627/index.html">Go Digest: June 2014</a></li>
<li><a href="../228629/index.html">Introduction to the PHP messaging services</a></li>
<li><a href="../228631/index.html">History of portable game consoles. Part 1.1 (1990s)</a></li>
<li><a href="../228633/index.html">Happy birthday, Julian Assange</a></li>
<li><a href="../228635/index.html">The main idea of ‚Äã‚Äãrobotics and eight smaller ideas</a></li>
<li><a href="../228651/index.html">Azarkant: a short cartoon that took three years</a></li>
<li><a href="../228661/index.html">Epson Moverio BT-200 and Sony HMZ-T3 video glasses: tested in humans</a></li>
<li><a href="../228663/index.html">Testing a new product: online insurance module</a></li>
<li><a href="../228665/index.html">NSA monitors those interested in Linux and information security</a></li>
<li><a href="../228669/index.html">Warning Search: Spacecraft DX1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>