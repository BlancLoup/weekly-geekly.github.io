<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create templateable reusable components in Angular 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many times I heard the statement that Angular 2 should be especially good in corporate applications, since it supposedly offers all the necessary (and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create templateable reusable components in Angular 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9d5/487/85c/9d548785c3174e09a43938f51f3b82ee.jpg" alt="image" align="right">  Many times I heard the statement that Angular 2 should be especially good in corporate applications, since it supposedly offers all the necessary (and not so) gadgets right out of the box (Dependency Injection, Routing, etc.).  Well, maybe this statement has a basis, because instead of dozens of different libraries, developers need to master only one Angular 2, but let's see how well the basic (basic) functionality of this framework is suitable for corporate applications. <br><br>  In my experience, a typical corporate application is hundreds (sometimes thousands) of almost identical pages that are only slightly different from each other.  I think it‚Äôs not for me alone that it was a good idea to allocate repetitive functionality into a separate component, but to determine the specific behavior through parameters and implemented templates.  Let's see what Angular 2 can offer us. <br><a name="habracut"></a><br><br><h2>  Simple option </h2><br>  The first thing that comes to mind is the reflection of the contents of the component declaration in its DOM using the special <b>&lt;ng-content select = "..."&gt; tag</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will try to demonstrate this approach on the example of a simple component ‚Äúwidget‚Äù. <br>  First use example: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">widget</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> Just do my job... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"settings"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span>Faster<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span>Slower<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">widget</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And the way it looks: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/da8/432/594/da8432594ea54fc89e24b90331af8fb5.gif"></div><br><br>  Inside the widget component, we define two elements: <br><br><ol><li>  Marked with the class "content" - the main content of the widget; </li><li>  Marked with a class "settings" - some settings related to the widget; </li></ol><br>  The widget component itself is responsible for: <br><br><ul><li>  Frame and title drawing; </li><li>  Switching logic between the main content display mode and the settings display mode. </li></ul><br><br>  Now let's take a look at the widget component itself: <br><br><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">"widget"</span></span>, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-string"><span class="hljs-string">` &lt;style&gt; .. &lt;/style&gt; &lt;div class="hdr"&gt; &lt;span&gt;Some widget&lt;/span&gt; &lt;button *ngIf="!settingMode" (click)="settingMode = true" class="wid_btn"&gt; Settings &lt;/button&gt; &lt;button *ngIf="settingMode" (click)="settingMode = false" class="wid_btn"&gt; Ok &lt;/button&gt; &lt;/div&gt; &lt;div class="cnt"&gt; &lt;ng-content *ngIf="!settingMode" select=".content"&gt; &lt;/ng-content&gt; &lt;div *ngIf="settingMode"&gt; Settings: &lt;ng-content select=".settings"&gt; &lt;/ng-content&gt; &lt;/div&gt; &lt;div&gt; `</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> </span></span>{ protected settingMode: boolean = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Notice the two <b>ng-content</b> tags.  Each of these tags contains a <b>select</b> attribute with the help of which it searches for elements intended to replace the original <b>ng-content</b> .  For example, when displaying our widget: <br><br>  <code>&lt;ng-content select=".settings" /&gt;</code> will be replaced by <code>..</code> a <code>&lt;ng-content select=".content"/&gt;</code> by <code>..</code> Naturally, the search for items is limited to the <b>&lt;widget&gt; tag ... &lt;/ widget&gt;</b> in client markup.  If the replacement was not found, then we simply will not see anything.  If the sample condition is satisfied by several elements, then we will see them all. <br><br><h2>  The option is more complicated </h2><br>  The approach described above can be successfully applied in many cases when you need to create a template component, but sometimes this approach is not enough.  For example, if it is necessary for us that the template passed to the component be displayed several times in different contexts.  In order to explain the problem, let's consider the following problem: in our corporate application there are several pages with lists of objects.  Each page displays objects of one type (users, orders, whatever), but each page allows paging of objects (paging) and has the ability to mark some objects in order to perform a certain group operation, for example, ‚Äúdelete ".  I would like to have a component that would be responsible for paging and selecting elements, but the method of displaying elements would remain the responsibility of a particular page, which is logical, since users and orders usually need to be displayed differently.  In the case of such a task, <b>ng-content is</b> no longer appropriate, since it simply displays one object inside another, but we need not only to display, but also to put checkmarks in front of each object (individual context). <br><br>  Looking ahead, I will immediately show a solution to this problem using the example of the ‚ÄúList Navigator‚Äù component, which I configured to display information about users (the <a href="https://plnkr.co/edit/5RXkoh7abyaIRhsTVbKH%3Fp%3Dpreview">source here</a> ). <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataSource</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> [(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedItems</span></span></span><span class="hljs-tag">)]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"selectedUsers"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list-navigator-item</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i, let isSelected = selected"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item-container"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class.item-container-selected</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"isSelected"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item-header"</span></span></span><span class="hljs-tag">&gt;</span></span>{{i.firstName}} {{i.lastName}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item-details"</span></span></span><span class="hljs-tag">&gt;</span></span> Id: {{i.id}}, Email: {{i.email}}, Gender: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngClass</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'item-details-gender-'+ i.gender.toLowerCase()"</span></span></span><span class="hljs-tag">&gt;</span></span> {{i.gender}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4e5/538/c38/4e5538c381b94999aa105de8dc094474.gif"></div><br><br>  The idea is as follows: the component receives as a parameter a function reference that returns a range of objects by offset and page size (offset and pageSize): <br><br><pre> <code class="html hljs xml">[dataSource]="dataSource"</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataSource = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">o, p</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._data.slice(o, o + p);</code> </pre><br>  as well as a template describing how to display these objects: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list-navigator-item</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i, let isSelected = selected"</span></span></span><span class="hljs-tag">‚Ä¶</span></span></code> </pre><br>  The <b>* list-navigator-item</b> argument is a kind of marker that allows our component to understand that the element it marks is a template (the '*' character tells the angular that we have not just an element, but a template) that should be used to draw the next object from the range returned by the <b>dataSource</b> .  Using the <b>list-navigator-item,</b> we also set two variables: <br><br><ul><li>  <b>let i</b> - link to another object from the range; </li><li>  <b>let isSelected = selected</b> - a boolean value indicating whether this item is checked <br>  or not (we'll talk about what ‚Äú= selected‚Äù means later). <br></li></ul><br>  In addition, the component receives as a parameter a list of ‚Äúselected‚Äù elements (indicated by a check mark), and if the user changes the selection, the component returns an already updated list corresponding to the user choice: <br><br><pre> <code class="html hljs xml">[(selectedItems)]="selectedUsers"</code> </pre> <br>  You can draw the following analogy: we pass a ‚Äúfactory‚Äù component, which creates a new interface element using the parameters passed by the component.  Then our component places the interface element created by the factory inside where it is needed (opposite the tick in our case). <br><br>  Let's finally see how to make such a component.  For this we need the following ingredients: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/92d/74b/d92/92d74bd923924208a251a9a4887825c5.png"></div><br><ul><li>  <b>list-navigator-item-outlet</b> ‚Äî the <b>outlet</b> directive, which is actually responsible for creating a new item using the template and the current context (the ‚Äúfactory‚Äù from the above analogy) (part of the component's internal implementation); </li><li>  <b>list-navigator-item-ontext</b> - Container class for transferring context data (part of the component's internal implementation); </li><li>  <b>list-navigator-item</b> is a marker directive with which the component accesses an element template; </li><li>  <b>list-navigator</b> is the actual component that implements the basic behavior, namely paging and selection of items. </li></ul><br><br><h3>  list-navigator-item-outlet </h3><br>  <i>The note.</i>  <i>In fact, this directive is not needed because it duplicates the <a href="https://angular.io/docs/ts/latest/api/common/index/NgTemplateOutlet-directive.html">NgTemplateOutlet</a> directive included in the standard library, but I decided to use my own version to better explain what is happening.</i> <br><br>  Just a small directive, so I‚Äôll give its entire source code: <br><br><pre> <code class="javascript hljs">@Directive({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">"list-navigator-item-outlet"</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListNavigatorItemOutlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private readonly _viewContainer: ViewContainerRef){} @Input() public template: TemplateRef&lt;ListNavigatorItemContext&gt;; @Input() public context: ListNavigatorItemContext; public ngOnChanges(changes: SimpleChanges): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [, tmpl] = analyzeChanges(changes, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.template); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [, ctx] = analyzeChanges(changes, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tmpl &amp;&amp; ctx) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._viewContainer.createEmbeddedView(tmpl, ctx); } } }</code> </pre><br>  In the constructor, we request from Angular 2 an object of type <a href="https://angular.io/docs/ts/latest/api/core/index/ViewContainerRef-class.html">ViewContainerRef</a> .  With this object we can control the visual elements (View) (not to be confused with the elements of the DOM browser) in the parent component.  Among all the capabilities of the <a href="https://angular.io/docs/ts/latest/api/core/index/ViewContainerRef-class.html">ViewContainerRef,</a> we are currently interested in the possibility of creating new visual elements, this can be done using the following two methods: <br><br><ul><li>  createComponent (componentFactory: ComponentFactory &lt;C&gt;, ...) </li><li>  createEmbeddedView (templateRef: TemplateRef &lt;C&gt;, context ?: C, ...) </li></ul><br>  The first method is useful if we want to dynamically create a component with only its ‚Äúclass‚Äù in hand.  For example, the Angulyarovsky router uses this method, but this topic deserves a separate post (if, of course, it will be interesting).  Now let's pay attention to the second method <b>createEmbeddedView</b> , with which we create our users.  As parameters, it takes a <a href="https://angular.io/docs/ts/latest/api/core/index/TemplateRef-class.html">TemplateRef</a> and some context. <br><br>  <a href="https://angular.io/docs/ts/latest/api/core/index/TemplateRef-class.html">A TemplateRef</a> is a ‚Äúfactory‚Äù for creating new visual components, obtained by ‚Äúcompiling‚Äù the <b>&lt;template&gt; tag</b> in the component layout (the one that is template: '...' or templateUrl: ‚Äú...‚Äù).  But until now we have not seen this tag anywhere, so where did the TemplateRef come from?  In fact, we had the <b>&lt;template&gt; tag</b> , we just implicitly defined it using the syntactic sugar in the form of the '*' symbol: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list-navigator-item</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i, let isSelected = selected"</span></span></span><span class="hljs-tag">‚Ä¶</span></span></code> </pre><br>  is equivalent to <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list-navigator-item</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i, let isSelected = selected"</span></span></span><span class="hljs-tag"> &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span><span class="hljs-tag"> ‚Ä¶</span></span></code> </pre><br>  Angular 2 creates a <a href="https://angular.io/docs/ts/latest/api/core/index/TemplateRef-class.html">TemplateRef</a> for any <b>&lt;template&gt;</b> it finds in the component layout. <br><br>  Let's go back to <b>createEmbeddedView</b> .  The second argument this method gets some <b>context</b> .  This object is quite important, because it is with the help of it that we can initialize the values ‚Äã‚Äãof variables defined in the template: <br><br><pre> <code class="html hljs xml">"let i, let isSelected = selected"</code> </pre><br>  Here again, there is a small syntactic sugar, this record Angular 2 understands how: <br><br><pre> <code class="html hljs xml">"let i=$implicit, let isSelected = selected"</code> </pre><br>  That is, in our case, the <b>context</b> object should have two properties: <b>$ implicit</b> and <b>selected</b> .  The way it is: <br><br><pre> <code class="hljs cs">export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListNavigatorItemContext</span></span> { constructor( <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span>: any, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> selected: boolean ) { } }</code> </pre><br>  Now we have all the knowledge to understand how <b>list-navigator-item-outlet</b> works - as soon as both the <b>template</b> and <b>context</b> properties are set, the directive creates a new visual element in its container. <br><br>  Here it is necessary to make the following disclaimer: in an amicable way, it would be <a href="https://angular.io/docs/ts/latest/cookbook/component-communication.html">necessary to</a> delete the previously created visual component when you call <a href="https://angular.io/docs/ts/latest/cookbook/component-communication.html">ngOnChanges</a> again, but in our case study this is not necessary. <br><br><h3>  list-navigator-item </h3><br>  It's all very simple: <br><br><pre> <code class="javascript hljs">@Directive({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">"[list-navigator-item]"</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListNavigatorItem</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(@Optional() public readonly templateRef: TemplateRef&lt;ListNavigatorItemContext&gt;) { } }</code> </pre><br>  The sole purpose of this directive is to pass the compiled template through a public property. <br><br><h3>  list-navigator </h3><br>  Finally, our main component, for which everything was started.  Let's start with its layout: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i of itemsToDisplay"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModel</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"i.selected"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngModelChange</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onSelectedChange(i, $event)"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item-wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator-item-outlet</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"templateOutlet.templateRef"</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">context</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"i"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator-item-outlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onPrev()"</span></span></span><span class="hljs-tag">&gt;</span></span>Prev<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onNext()"</span></span></span><span class="hljs-tag">&gt;</span></span>Next<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Where: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.itemsToDisplay = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .dataSource(offset, pageSize) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListNavigatorItemContext( i, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.selectedItems.indexOf(i) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)); ‚Ä¶ @ContentChild(ListNavigatorItem) protected templateOutlet: ListNavigatorItem;</code> </pre><br>  Principle of operation: <br><br><ul><li>  We get the next portion of objects using the link to the corresponding function ( <b>dataSource</b> ) and put it in <b>itemsToDisplay</b> </li><li>  We loop through all the objects from the chunk ( <b>* ngFor = "let i of itemsToDisplay"</b> ) and for each object we create a check mark plus the above <b>-</b> described <b>list-navigator-item-outlet</b> , which receives as parameters: </li><li><ul><li>  A context consisting of an object and a flag selected; </li><li>  A link to a <a href="https://angular.io/docs/ts/latest/api/core/index/TemplateRef-class.html">TemplateRef</a> that the <b>list-navigator-item</b> directive kindly supplied us, which in turn was found by declaring the query <b>@ContentChild (ListNavigatorItem)</b> <br></li></ul></li><li>  <b>The list-navigator-item-outlet</b> creates a visual element for the next object using the passed template and context (remember that in a real project it is advisable to use <a href="https://angular.io/docs/ts/latest/api/common/index/NgTemplateOutlet-directive.html">NgTemplateOutlet</a> ). </li></ul><br><p>  <i>A small addition.</i> <br>  The template for the <b>list-navigator</b> is quite interactive - we can add buttons, checkboxes, input fields and manage all of this from the parent page.  <a href="https://embed.plnkr.co/qUT6duG8n3XxcT126qZy">Here is an example</a> with the added ‚ÄúArchive‚Äù button, the handler of which is on the parent page and changes the user's state: <br></p><div style="text-align:center;"><img src="https://habrastorage.org/files/40f/323/3d3/40f3233d3b5f4ec5b6019344f3f6bc3c.gif"></div><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator..</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">list-navigator-item</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let i..."</span></span></span><span class="hljs-tag"> &gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!i.archived"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn-arch"</span></span></span><span class="hljs-tag"> (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onArchive(i)"</span></span></span><span class="hljs-tag">&gt;</span></span>Archive<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list-navigator</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="javascript hljs"> protected onArchive(user: User){ user.archived = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><p></p><br><br>  That's all.  This article describes techniques that are slightly beyond the standard documentation for Angular 2, so I hope it will be useful to someone.  Once again I specify the <a href="https://plnkr.co/edit/5RXkoh7abyaIRhsTVbKH%3Fp%3Dpreview">link to the source code of the examples described in the article.</a>  ( <a href="https://plnkr.co/edit/qUT6duG8n3XxcT126qZy%3Fp%3Dpreview">option with the Archive button</a> ). </div><p>Source: <a href="https://habr.com/ru/post/320414/">https://habr.com/ru/post/320414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320398/index.html">Defect Detection Code Type Expression Issues (CWE-569)</a></li>
<li><a href="../320400/index.html">Cloud.Mail.Ru + EncFS without local file storage</a></li>
<li><a href="../320404/index.html">How not to waste time on continuous integration</a></li>
<li><a href="../320408/index.html">[BugBounty] Partial authentication bypass vk.com</a></li>
<li><a href="../320412/index.html">Microsoft has introduced Windows Defender Security Center</a></li>
<li><a href="../320418/index.html">How to become a product manager? Part 5: Get things done</a></li>
<li><a href="../320420/index.html">Open data transfer</a></li>
<li><a href="../320422/index.html">Closed beta testing of hot storage in Mail.Ru Cloud</a></li>
<li><a href="../320424/index.html">3 main trends in the world of AI in 2017</a></li>
<li><a href="../320426/index.html">An attempt to teach students to program how to automate this process</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>