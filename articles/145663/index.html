<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we made a plugin for kate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes the process of writing a plugin for kate called Neznaju. The plugin is designed to co-edit text via the network Using this plug...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we made a plugin for kate</h1><div class="post__text post__text-html js-mediator-article">  This article describes the process of writing a plugin for <a href="http://kate-editor.org/">kate</a> called Neznaju.  The plugin is designed to co-edit text via the network  Using this plugin you can create a server, or connect to a server created by someone and jointly edit some text.  The plugin is as simple as possible.  At the moment, it supports connecting multiple clients, as well as editing large files (since only information about changes in the document is transmitted). <br><a name="habracut"></a><br><h4>  Idea </h4><br>  Once, an acquaintance wrote to me on Skype, and offered to <a href="http://gobby.0x539.de/trac/">test Gobby</a> , a program for co-editing text.  We phoned and downloaded stable versions of Gobby.  Having run Gobby for a long time I tried to figure out how to work with it.  Or rather how to create a server.  As a result, having climbed all the menu items, I never found the server to create a server.  Maybe you downloaded the wrong version of Gobby, maybe something else.  As a result, I launched the console version of the server, and then connected to it from the client.  But the problems did not end there.  My friend could not connect.  It turned out that in the Gobby, which is with him, encryption is enabled, and it cannot be disabled during connection. <br><br>  I will not bore my readers with details, let me just say that in the end we managed to set everything up, connect and see how it works.  And immediately the question arose, do you need 90% of Gobby functionality for ordinary users? <br><br>  It is possible that someone needs a whole bunch of all sorts of chips like encryption, chat, list of users, rooms, etc. We decided to make the most simple tool that only does what they want from it.  Namely - it will be a plugin, not a new text editor.  He will be able to work as a server (listen to the specified port), as well as as a client (connect to the specified address).  A simple text protocol will be used to exchange information between the server and the client so that everyone can easily write a plug-in for their favorite text editor (or IDE), and they can work together. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Kate was chosen as the text editor because we are both Qt lovers, and we don‚Äôt know the more common Qt editor.  A quick search on the Internet issued a GSoS project of one guy from Zaporozhye, who planned to create a similar plugin for Kate over the summer using telepathy tubes.  What about writing a plugin in a few days?  Challenge was accepted. <br><br><h4>  Development </h4><br>  I installed a virtual machine with debian, downloaded the kate-dev package with the header files needed for the build, and also installed QtCreator.  After that, you could proceed directly to the development. <br><br>  Note that the plugin does not directly depend on kate, it is a plugin for KTextEditor, a component of a text editor in kate and kwrite. <br><br>  As an example, the TimeDate plugin was taken from the <a href="http://techbase.kde.org/Development/Tutorials/Kate/KTextEditor_Plugins">tutorial</a> on creating plugins to kate.  It is going to traditionally with the help of cmake.  In addition to the source files, the plug-in requires two more files - plugin.desktop and plugin.rc (for registering the capabilities of our plugin in the editor). <br><br>  After we assembled and installed the test plug-in, it's time to think about the exchange protocol and the plug-in architecture.  At first, we decided to make the simplest option of all possible: for any change in the document, the client must send the full contents to the server, and the server, in turn, to the client.  The message format was XML-like: the full document is edged with the full tag. <br><br>  For network interactions, we used the QtNetwork module, more specifically, the QTcpServer classes for organizing the server part and QTcpSocket for the client side. <br><br>  When the primitive plugin started working, we decided not to re-send the entire document, but just the changes appearing in it.  In order to determine the changes we used the library diff-match-patch.  It was a good decision, but on large documents the difference between the texts after each change was calculated for a very long time.  Fortunately, it turned out that ktexteditor itself can send signals about changes (textInserted and textRemoved signals).  Therefore, we decided to abandon the use of diff-match-patch, but simply send information about the changes transmitted through these signals.  The general scheme of the plugin is: <br><br><img src="https://habrastorage.org/storage2/abc/5a4/b01/abc5a4b01a8718a63b521d89719862f8.png"><br><br>  After catching most of the bugs, we got quite a workable tool, which may be useful to someone.  The sources are on <a href="https://github.com/Kakadu/Neznaju">githaba</a> . <br><br><h4>  Conclusion </h4><br>  And the most important thing that we have learned from this whole process: <br>  - opensource is simple.  Choose your favorite project, write the code and have fun! <br>  - pair programming cool.  Much more fun than coding alone.  If you like programming, the two of you will enjoy it even more.  Call up, start your favorite ide and go ahead! <br>  - KDE radishes.  They wrote to them in the <a href="http://lists.kde.org/%3Fl%3Dkwrite-devel%26m%3D133873174830775%26w%3D2">maillist</a> , but they are silent. <br><br><h4>  Links </h4><br>  <a href="https://github.com/Kakadu/Neznaju">Github sources</a> <br>  <a href="http://techbase.kde.org/Development/Tutorials/Kate/KTextEditor_Plugins">Ktexteditor plugin writing guide</a> <br>  <a href="http://www.purinchu.net/kdelibs-apidocs/interfaces/ktexteditor/html/index.html">KTextEditor API Reference</a> <br>  <a href="http://code.google.com/p/google-diff-match-patch/">Diff match patch - a library that defines the difference between two texts.</a> </div><p>Source: <a href="https://habr.com/ru/post/145663/">https://habr.com/ru/post/145663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145657/index.html">CSS is my LSD</a></li>
<li><a href="../145658/index.html">30 most popular passwords stolen from LinkedIn</a></li>
<li><a href="../145659/index.html">Artificial intelligence, intelligence, life ... How long to wait for them?</a></li>
<li><a href="../145661/index.html">Ukrainian App Store will appear in June</a></li>
<li><a href="../145662/index.html">iOS 6 beta is available for download to developers.</a></li>
<li><a href="../145665/index.html">Heterogeneous processor pool in XenServer 6</a></li>
<li><a href="../145666/index.html">GPU acceleration of CSS filters in Chromium</a></li>
<li><a href="../145667/index.html">Hash + salt as a panacea for the decrypt</a></li>
<li><a href="../145668/index.html">Buying a brand on the conveyor</a></li>
<li><a href="../145669/index.html">Students fined for the site with subtitles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>