<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animated graphics with gnuplot + bash + Avidemux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An almost integral part of any presentation at a natural science conference is graphics. It is often interesting to see not only the graph of some dep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animated graphics with gnuplot + bash + Avidemux</h1><div class="post__text post__text-html js-mediator-article">  An almost integral part of any presentation at a natural science conference is graphics.  It is often interesting to see not only the graph of some dependence at some point in time, but also to see how this dependence changes over time.  Very clearly, this can be shown by making many, many graphs and collecting video from them.  About one of the options how to do it, and will be my post. <br><a name="habracut"></a><br>  Beautiful graphics can be done in many programs: proprietary Grapher and Origin, free gnuplot, QtiPlot, Veusz and others.  Most popular graphing programs have an interactive graphical interface that allows you to quickly make a publication-quality graph without straining your brain.  However, now we have another task - we need to stamp a lot of pictures with the same type of graphs.  Editing each chart manually is a thankless task, so we will use not a glamorous Origin, but a plain gnuplot.  Its strength is in the ability to build a graph according to a predetermined scenario (i.e., gnuplot has its own scripting language).  Next, I will show how to quickly create graphics in any required quantity using simple scripts. <br><br><h2>  Install gnuplot </h2><br>  <strong>For Windows users.</strong>  Go to <a href="http://www.gnuplot.info/">the project site</a> .  There, click "Download" and select the appropriate option for download.  Then set as usual. <br>  <strong>For linuksoidov.</strong>  Install the package with your favorite package manager.  For Ubuntu Lucid users, I recommend <a href="https://launchpad.net/~daniel-elstner/%2Barchive/ppa">this PPA</a> - it has a new version with additional buns. <br><br><h3>  Example 1. The changing schedule </h3><br>  Let's make an animation of how the <a href="http://en.wikipedia.org/wiki/Pair_correlation_function">pair correlation function of the</a> fluid changes during the transition to the glassy state.  The source data is a file with values ‚Äã‚Äãof the pair correlation function at different points in time.  It looks like this: <br><pre><code class="hljs css">0 100 1 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0284366</span></span> 0 2 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0853097</span></span> 0 ... 99 5<span class="hljs-selector-class"><span class="hljs-selector-class">.60201</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.0403</span></span> 100 5<span class="hljs-selector-class"><span class="hljs-selector-class">.65888</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.01337</span></span> 1000 100 1 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0284366</span></span> 0 2 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0853097</span></span> 0 ...</code> </pre> <br>  The first line is the moment of time and the number of points <strong>N.</strong>  Then there are <strong>N</strong> lines in the format <br><pre> <code class="hljs"> _X _Y</code> </pre><br>  Then 2 line breaks and again the same.  Line breaks between blocks are important - gnuplot treats blocks separated by several line breaks as different.  Thus, it is possible to build a graph corresponding to only one block. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now we start gnuplot - we come into the command interface of the program.  Typing <br><pre> <code class="hljs pgsql">plot "rdf.txt" <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lines</code> </pre><br>  What does this mean?  <em>plot</em> - command to plot;  "Rdf.txt" - the path to the file from which we want to read data;  <em>using 2: 3</em> means "use column 2 as X values, column 3 as Y values";  <em>with lines</em> - please print only the lines connecting data points to the chart. <br><br>  The result of this command will be something like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/6b4/7b6/1c9/6b47b61c9e64bef2946acc7aa0c4a517.jpg"><br>  As you can see, <em>all the</em> graphs in the file are drawn.  To draw a graph only for parts of points, use the <em>index</em> keyword.  For example, we build a graph using only the first 100 lines with data: <br><pre> <code class="hljs pgsql">plot "rdf.txt" <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> linewidth <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lines</code> </pre><br>  Here linewidth 5 indicates that the line will be thicker than usual.  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/135/040/6f3/1350406f3763860a4bdc4e40b5266f23.jpg"><br>  We assume that this kind of graphics suits us.  Now you need to run through all the records in the input file, build graphs for all of them and export them to pictures.  I did this with a couple of bash scripts.  In fact, you can do with the built-in gnuplot tools (which is better, since it does not bind to Unixes).  Making scripts <i>animator.gp</i> and <i>animate.gp</i> .  In <i>animator.gp</i> customize the schedule and terminal: <br><pre> <code class="hljs pgsql">#!/usr/bin/gnuplot <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> xrange [<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">5.66</span></span>] #   X <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> yrange [<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">4.5</span></span>] #   Y <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> palette model RGB defined (<span class="hljs-number"><span class="hljs-number">0</span></span> "green", <span class="hljs-number"><span class="hljs-number">0.5</span></span> "blue", <span class="hljs-number"><span class="hljs-number">1</span></span> "dark-violet") unset colorbox <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> terminal png font "Droid, 14" size <span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> size square iterations=<span class="hljs-number"><span class="hljs-number">100</span></span> #   iterator=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>=<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> "animate.gp"</code> </pre><br>  In <i>animate.gp</i> we do, in fact, the generation of images. <br><pre> <code class="hljs pgsql">iterator=iterator+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>=iterator/(iterations+<span class="hljs-number"><span class="hljs-number">1.0</span></span>) #<span class="hljs-number"><span class="hljs-number">1.0</span></span> ,      <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">1.0</span></span>)\ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> output "figures/".iterator.".png";\ plot "./rdf.txt" <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> iterator <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> smooth csplines linewidth <span class="hljs-number"><span class="hljs-number">5</span></span> linecolor palette frac <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>;\ reread</code> </pre><br>  I wanted the graph to gradually change color, so I set a certain palette from green to purple.  Options <em>unset colorbox</em> and <em>set key off</em> - disable the display of the palette and the legend on the chart. <br><br>  The main commands in these scripts are: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> terminal png font <span class="hljs-string"><span class="hljs-string">"Droid, 14"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">output</span></span> <span class="hljs-string"><span class="hljs-string">"figures/"</span></span>.iterator.<span class="hljs-string"><span class="hljs-string">".png"</span></span></code> </pre><br>  The first one includes the export of graphics in png with the size of 750x750 and the Droid font, when the <em>plot</em> command is given, the second one sets the file name.  In the second command, we used the fact that gnuplot can concatenate integers (but not float!) With strings. <br><br>  The <i>if</i> command in the second script executes subsequent commands when the condition is met (note that all commands in the if-a body must be on the same line and separated by a semicolon).  The <i>reread</i> command reads the entire script from the very beginning, i.e.  it turns out a kind of cycle. <br>  The scripts are executed either by simply adding permissions to execute the file <i>animator.gp</i> and then launching it (in Unix) or using the command <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">load</span></span> "animator.gp"</code> </pre><br>  at the gnuplot command line (any OS). <br>  Having run the scripts, I got a number of pictures in the figures folder: 1.png, 2.png, etc.  Of these, you can already collect animation.  I did this using the free video editor <a href="http://avidemux.org/">Avidemux</a> . <br><br>  Assembling animation is easy.  Open the editor, click "Open", select the first image in the sequence (in my case it was "1.png") - ready, the animation is loaded.  You can click Play and check that everything is fine.  Then we save the animation in the format we need.  Here is my result: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/_CFtlWM1LHQ%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhfXJfr5m1vSeOQE7wK5epWbJu4tw" frameborder="0" allowfullscreen=""></iframe><br><br><h3>  Example 2. Overlay graphics on pictures </h3><br>  A more difficult task is to do the same, but the background should not be white, but be a picture, and it should also be animated.  I had such a need when I needed to visualize capillary fluctuations in a two-phase system according to the results of molecular dynamics (MD).  In principle, it is possible to impose, for example, the boundaries of cyclones on the map, the visualization of some velocity field on the video of the nozzle, and you never know.  So, we proceed. <br><br>  You will need gnuplot version not lower than 4.4 (Ubuntu users have it in the repository for versions later than 10.04. For 10.04 we download from the specified PPA).  The fact is that in this version gnuplot can upload png-files with alpha-channel to the chart.  I had about a thousand files with images of MD cells in png format and as many files containing the coordinates of the phase boundary.  <i>animator.gp</i> remains about the same: <br><pre> <code class="hljs pgsql">#!/usr/bin/gnuplot <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> xrange [<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">242.4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> yrange [<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">242.4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> xtics <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">242.4</span></span> # ,      #       <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ytics <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">242.4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> terminal png font "Droid, 14" size <span class="hljs-number"><span class="hljs-number">750</span></span>,<span class="hljs-number"><span class="hljs-number">750</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> size square iterations=<span class="hljs-number"><span class="hljs-number">100</span></span> #   iterator=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> "animate.gp"</code> </pre><br>  In <i>animate.gp we</i> add the loading of a picture from a png-file: <br><pre> <code class="hljs pgsql">iterator=iterator+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iterator &lt;= iterations)\ plot "pic_".iterator.".png" binary filetype=png dx=<span class="hljs-number"><span class="hljs-number">0.327567568</span></span> dy=<span class="hljs-number"><span class="hljs-number">0.327567568</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-string"><span class="hljs-string">'%uchar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>:(<span class="hljs-number"><span class="hljs-number">160</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> rgbalpha;\ #    replot "../surf_z/surface.".iterator.".cfg" <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> smooth csplines linewidth <span class="hljs-number"><span class="hljs-number">5</span></span>;\ #replot       #smooth csplines -    ,   <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> output iterator.".png";\ replot;\ reread</code> </pre><br>  Png is loaded with a command like <br><pre> <code class="hljs pgsql">plot "pic.png" binary filetype=png dx=<span class="hljs-number"><span class="hljs-number">0.327567568</span></span> dy=<span class="hljs-number"><span class="hljs-number">0.327567568</span></span> <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-string"><span class="hljs-string">'%uchar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>:(<span class="hljs-number"><span class="hljs-number">160</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> rgbalpha</code> </pre><br>  The <em>with rgbalpha option</em> requires that the chart be with four ‚Äúaxes‚Äù (R, G, B, alpha channels, oddly enough).  I did not have an alpha channel in the background pictures, and I simply set its value as (160).  The value of transparency was chosen by scientific method, so that the overlay graph was visible, and the background was not too faded. <br><br>  It starts all the same as last time, generated images and are collected in the video all the same Avidemux.  Here is the result: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DbWvjc7ruoA%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhx_dN3LtVr1siUEeMq1UxlXRbu3Q" frameborder="0" allowfullscreen=""></iframe><br><br>  Of course, you can add to the charts beautiful signatures of axes, legends, etc.  To do this, you need to add several commands to the scripts.  Interested people recommend the following sources: <br><ol><li>  <a href="http://www.gnuplot.info/docs_4.4/gnuplot.pdf">Gnuplot official guide (eng.)</a> </li><li>  The book "Gnuplot in Action" - it describes all the tricks available in gnuplot. </li><li>  Blog <a href="http://mydebianblog.blogspot.com/search/label/%25D0%25B3%25D0%25BD%25D1%2583%25D0%25BF%25D0%25BB%25D0%25BE%25D1%2582">"Debianshka notes"</a> - about gnuplot and not only. </li></ol><br>  Note: Origin, QtiPlot and, possibly, other graphic editors also have their own scripting languages.  But the author, because of his ardent adherence to gnuplot, did not bother to learn them and wrote about what he knew. <br>  <b>UPD:</b> made iteration by means of gnuplot, but not through bash.  Thanks <a href="http://habrahabr.ru/users/zeliboba/" class="user_link">zeliboba</a> for the tip. </div><p>Source: <a href="https://habr.com/ru/post/129407/">https://habr.com/ru/post/129407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129401/index.html">Serious vulnerability in all versions of FreeBSD</a></li>
<li><a href="../129402/index.html">And what is your last completed project?</a></li>
<li><a href="../129403/index.html">Review of the "sleeping" laptop Samsung 350U2B</a></li>
<li><a href="../129404/index.html">Princeton will be struggling with a paid subscription to scientific articles</a></li>
<li><a href="../129406/index.html">Plugin sliding panel with icons of social networks</a></li>
<li><a href="../129408/index.html">Parsing attacks into pieces: SYN-flood</a></li>
<li><a href="../129409/index.html">The basics of Dojo on the example of a self-made Habr-parser</a></li>
<li><a href="../129411/index.html">Review of the BlackBerry Bold 9900 and Torch 9810, 9860 - prospects?</a></li>
<li><a href="../129413/index.html">Habra Informer</a></li>
<li><a href="../129414/index.html">Anonymous predicted delisting of company stock</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>