<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unobvious feature in variable syntax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A completely innocent-looking piece of C ++ code is proposed. There are no templates, no virtual functions, no inheritance, but the creators of this w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unobvious feature in variable syntax</h1><div class="post__text post__text-html js-mediator-article">  A completely innocent-looking piece of C ++ code is proposed.  There are no templates, no virtual functions, no inheritance, but the creators of this wonderful language hid a rake in the middle of a clean field. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">struct</font> A { <br> A ( <font color="#0000ff">int</font> i) {} <br> }; <br> <br> <font color="#0000ff">struct</font> B { <br> B (A a) {} <br> }; <br> <br> <font color="#0000ff">int</font> main () { <br> <font color="#0000ff">int</font> i = 1; <br> B b(A(i)); <font color="#008000">// (1)</font> <br> <font color="#0000ff">return</font> 0; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Question: What is the type of variable b?  Not the one that would be supposed at first glance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Analysis </h4><br>  Of course, the type of variable b is not B, otherwise this article would not exist :) I will not give an answer right away, but instead I will tell you how you can reach it without digging into the thousand-page standard. <br><br>  First, let's add some debugging output: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;iostream&gt; <br> <font color="#0000ff">struct</font> A { <br> A ( <font color="#0000ff">int</font> i) { std::cout &lt;&lt; <font color="#A31515">'A'</font> ;} <br> }; <br> <br> <font color="#0000ff">struct</font> B { <br> B (A a) { std::cout &lt;&lt; <font color="#A31515">'B'</font> ;} <br> }; <br> <br> <font color="#0000ff">int</font> main () { <br> <font color="#0000ff">int</font> i = 1; <br> B b(A(i)); <font color="#008000">// (1)</font> <br> <font color="#0000ff">return</font> 0; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  If you try to run this code, it turns out that <b>nothing</b> is displayed <b>at all</b> .  But if you replace the line (1) with <br><blockquote> <code>B b(A(1)); <br></code> </blockquote><br>  suddenly everything starts working. <br><br>  And now we will look attentively at the output of the compiler with the maximum warning turned on. <br><blockquote> <code>$ g++ -W -Wall test.cpp <br> x.cpp:2: warning: unused parameter 'i' <br> x.cpp:6: warning: unused parameter 'a' <br> x.cpp: In function 'int main()': <br> x.cpp:10: warning: unused variable 'i' <br></code> </blockquote><br>  With the first two lines, everything is clear; indeed, the parameters of the constructors are not used.  But the last line looks very strange.  How was the variable i unused if it is used in the next line? <br><br>  In principle, this information is enough to, a little thought, to answer the question.  But if clever thoughts do not come to mind, and you want to add a little more, why not just ask the compiler?  RTTI comes to the rescue. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;iostream&gt; <br> #include &lt;typeinfo&gt; <br> <br> <font color="#0000ff">struct</font> A { <br> A ( <font color="#0000ff">int</font> i) {} <br> }; <br> <br> <font color="#0000ff">struct</font> B { <br> B (A a) {} <br> }; <br> <br> <font color="#0000ff">int</font> main () { <br> <font color="#0000ff">int</font> i = 1; <br> B b(A(i)); <font color="#008000">// (1)</font> <br> std::cout &lt;&lt; typeid(b).name() &lt;&lt; std::endl; <br> <font color="#0000ff">return</font> 0; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  When compiling GCC 4.3, the result of this program is the string <br><blockquote> <code>F1B1AE <br></code> </blockquote><br>  in which the type of variable information we need is encrypted (of course, another compiler will <a href="http://www.cplusplus.com/reference/std/typeinfo/type_info/">produce</a> another string, the output format <a href="http://www.cplusplus.com/reference/std/typeinfo/type_info/">type_info :: name ()</a> is not described in the standard and left to the discretion of the developer).  C ++ filt will help us to find out what these letters and numbers mean. <br><blockquote> <code>$ c++filt -t F1B1AE <br> B ()(A) <br></code> </blockquote><br>  Here is the answer: this is a function that takes a type A parameter as an input and returns a value of type B. <br><br><h4>  Cause </h4><br>  It remains to understand why our string was interpreted in such an unexpected way.  The thing is that in the type declaration of a variable, the extra brackets around the name are ignored.  For example, we can write <br><blockquote> <code><font color="#0000ff">int</font> (v); <br></code> </blockquote><br>  and it will mean exactly the same thing <br><blockquote> <code><font color="#0000ff">int</font> v; <br></code> </blockquote><br><br>  Therefore, the long-suffering line (1) can be rewritten without changing the meaning, removing an extra pair of brackets: <br><blockquote> <code>B b(A i); <br></code> </blockquote><br>  Now it can be seen with the naked eye that b is a declaration of a function with one argument of type A, which returns a value of type B. <br><br>  At the same time, we explained the weird worning about the unused variable i - indeed, it has nothing to do with the formal parameter i. <br><br><h4>  Workarounds </h4><br>  It only remains for us to explain to the compiler what we really want from it - that is, to get a variable of type B, initialized to a variable of type A. The easiest way is to add extra brackets, like this: <br><blockquote> <code>B b((A(i))); <br></code> </blockquote><br>  or so: <br><blockquote> <code>B b((A)(i)); <br></code> </blockquote><br>  This is enough to convince the parser that this is not a function declaration. <br><br>  Alternatively, you can use the form of invoking the constructor with an assignment, unless the constructor is explicit: <br><blockquote> <code>B b = A(i); <br></code> </blockquote><br>  Despite the presence of the '=' sign, no extra copying happens here, as can be easily seen by installing a private copy constructor in class B. <br><br>  Or you can simply enter an additional variable: <br><blockquote> <code>A a(i); <br> B b(a); <br></code> </blockquote><br>  True, this will require extra copying of the variable a, but in many cases this is acceptable. <br><br>  Choose the method that seems more understandable to you :) <br><br>  <font>Inspired by the <a href="http://stackoverflow.com/questions/1379932/trick-question-regarding-declaration-syntax-in-c">post in StackOverflow</a></font> <br><br>  PS Thank you <a href="https://habrahabr.ru/users/sse/" class="user_link">sse</a> for clarifying. <br></div><p>Source: <a href="https://habr.com/ru/post/68796/">https://habr.com/ru/post/68796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68788/index.html">Just for Fun. The story of an accidental revolutionary</a></li>
<li><a href="../68789/index.html">skype: traffic as currency</a></li>
<li><a href="../68790/index.html">Another divorce - search-gsm.ru</a></li>
<li><a href="../68791/index.html">Kaptchahabra, from what time you enter correctly?</a></li>
<li><a href="../68792/index.html">Opera 10.10 with Unite</a></li>
<li><a href="../68797/index.html">Biztimes - business magazine for entrepreneurs</a></li>
<li><a href="../68799/index.html">Skype <-> SIP gateway for SIPNET users</a></li>
<li><a href="../68802/index.html">Here are the three main sauces of media professionals. Which one do you prefer?</a></li>
<li><a href="../68805/index.html">Home server: Zotac IONITX-A and CFI-A8989 chassis</a></li>
<li><a href="../68806/index.html">Doctrine and sorting for many-to-one communication</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>