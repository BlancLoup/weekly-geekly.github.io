<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cicerone - simple navigation in Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this scheme, not the skeleton of the ancient inhabitant of the water depths and not the metro scheme of a certain megalopolis, this is a map of tra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cicerone - simple navigation in Android application</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/b78/579/568/b78579568f7a4a9488769b52f6c93adf.png"></p><br><p>  In this scheme, not the skeleton of the ancient inhabitant of the water depths and not the metro scheme of a certain megalopolis, this is a map of transitions on the screens of a very real Android application!  But, despite the complexity, we managed to successfully implement it, and the decision to issue in the form of a small library, which will be discussed in the article. </p><br><a name="habracut"></a><br><p>  To avoid questions about the name in advance, I‚Äôll clarify: Cicerone ( <em>‚Äúche-che-ro-non‚Äù</em> ) is an obsolete word with Italian roots, with the meaning ‚Äúguide for foreigners‚Äù. </p><br><p>  In our projects we try to adhere to architectural approaches that allow us to separate the logic from the display. </p><br><p>  Since I prefer MVP in this respect, the word ‚Äúpresenter‚Äù will often appear later in the text, but I want to note that the solution presented does not limit you in choosing the architecture (you can even use the ‚Äúeverything in Fragment‚Äù approach in the classical approach) and even in this case, Cicerone will give your profit!). </p><br><p>  Navigation is more business logic, so I prefer to assign responsibility for transitions to the presenter.  But in Android, not everything is so smooth: for making transitions between an Activity, switching Fragments, or changing the View inside a container </p><br><ol><li>  you can‚Äôt do without dependence on Context, which you don‚Äôt want to transfer to the logic layer, thereby linking it to the platform, <strong>complicating testing</strong> and <strong>risking memory leaks</strong> (if you forget to clear the link); </li><li>  you must take into account the life cycle of the container (for example, <em>java.lang.IllegalStateException: Can not perform this action afterSaveInstanceState</em> with Fragments). </li></ol><br><p>  Therefore, there was a solution implemented in Cicerone. <br>  I think it‚Äôs worth starting with the structure. </p><br><h2 id="struktura">  Structure </h2><br><p><img src="https://habrastorage.org/files/d1a/242/349/d1a2423490a24dc28e9c7e2baccdd5bf.png"></p><br><p>  There are four entities on the diagram: </p><br><ul><li>  Command is the simplest transition command that Navigator performs. </li><li>  Navigator is a direct implementation of ‚Äúscreen switching‚Äù inside the container. </li><li>  Router is a class that turns high-level navigation calls to a presenter into a set of Command. </li><li>  CommandBuffer - is responsible for the safety of the called navigation commands if at the time of their call there is no possibility to make the transition. </li></ul><br><p>  Now about each more. </p><br><h2 id="komandy-perehodov">  Transition teams </h2><br><p>  We noticed that any transition map (even quite complicated, as in the first image) can be implemented using four basic transitions, combining which we get the desired behavior. </p><br><h3 id="forward">  Forward </h3><br><p><img src="https://habrastorage.org/files/9de/c5e/3e1/9dec5e3e1d664c3b8ee6f5973f9a1474.png"></p><br><p>  <em>Forward (String screenKey, Object transitionData)</em> is a command that transitions to a new screen by adding it to the current screen chain. <br>  <em>screenKey</em> is a unique key for each screen. <br>  <em>transitionData</em> - data needed by the new screen. </p><br><p>  The letter R denotes the root screen, its only feature is that when you exit from this screen, we will exit the application. </p><br><h3 id="back">  Back </h3><br><p><img src="https://habrastorage.org/files/372/8e1/97d/3728e197d3344708adcc003bfc9f106d.png"></p><br><p>  <em>Back ()</em> is a command that removes the last active screen from the chain and returns to the previous one.  When you call on the root screen is expected to exit the application. </p><br><h3 id="backto">  Backto </h3><br><p><img src="https://habrastorage.org/files/715/8d5/392/7158d5392e6840e9b4ff42c2f8512742.png"></p><br><p>  <em>BackTo (String screenKey)</em> - a command that allows you to return to any of the screens in the chain, it is enough to specify its key.  If there are two screens in the chain with the same key, then the last one (the ‚Äúright‚Äù one) will be selected. </p><br><p>  It should be noted that if the specified screen is not found, or pass null in the key parameter, the transition to the root screen will be made. </p><br><blockquote>  In practice, this command is very convenient.  For example, for authorization: two screens.  Phone -&gt; SMS, and then access to the one from which the authorization was launched. </blockquote><br><h3 id="replace">  Replace </h3><br><p><img src="https://habrastorage.org/files/56b/f49/737/56bf49737c9f495c8f51a26766b79823.png"></p><br><p>  <em>Replace (String screenKey, Object transitionData)</em> is a command that replaces the active screen with a new one. <br>  Someone may argue that this result can be achieved by calling Back and Forward commands in succession, but then we will exit the application on the root screen! </p><br><p>  That's all!  In practice, these four teams are enough to build any transitions.  But there is another command that does not apply to navigation, but is very useful in practice. </p><br><h3 id="systemmessage">  Systemmessage </h3><br><p><img src="https://habrastorage.org/files/ff9/a22/9b3/ff9a229b3fbd418c8af545e5157be464.png"></p><br><p>  <em>SystemMessage (String message)</em> - a command that displays a system message (Alert, Toast, Snack, etc.). </p><br><p>  Sometimes it is necessary to exit the screen and show a message to the user.  <em>For example, that we saved the changes made.</em>  But the screen to which we return, should not be aware of someone else's logic, and therefore we rendered the display of such messages in a separate command.  It is very convenient! </p><br><blockquote>  All commands are marked with the Command marker marker.  If for some reason you need a new team, just create it, no restrictions! </blockquote><br><h2 id="navigator">  Navigator </h2><br><p>  The commands themselves do not implement the switching of screens, but only describe these transitions.  Navigator is responsible for their implementation. </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Navigator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Command command)</span></span></span></span>; }</code> </pre> <br><p>  Depending on the task, the Navigator will be implemented differently, but it will always be where the container for the switchable screens is located. </p><br><ul><li>  In Activity to switch Fragment'ov. </li><li>  In Fragment'e to switch nested (child) Fragment'ov. </li><li>  ... your option. </li></ul><br><p>  Since in the vast majority of Android applications, navigation relies on switching Fragments within the Activity, in order not to write the same type of code, the library already has a ready-made FragmentNavigator (and SupportFragmentNavigator for SupportFragments) that implements the commands presented. </p><br><p>  Enough: </p><br><p>  1) transfer the container ID and the FragmentManager to the constructor; <br>  2) implement methods for exiting the application and displaying the system message; <br>  3) implement the creation of Fragment'ov by screenKey. </p><br><blockquote>  For a more detailed example, I advise you to look into the Sample application. </blockquote><p>  The application does not need to have one Navigator.  Example (also real, by the way): in Activity there is a BottomBar, which is available to the user ALWAYS.  But each tab has its own navigation, which is preserved when switching tabs in BottomBar. </p><br><blockquote>  This is solved by a single navigator within the Activity, which switches tabs, and local navigators within each Fragment-a tab. <br>  Thus, each individual presenter is not tied to where he is: inside the chain of one of the tabs or in a separate Activity.  It is enough to provide him with the correct Router.  <strong>One Router is associated with only one Navigator at any one time.</strong>  About this a little further. </blockquote><br><h2 id="router">  Router </h2><br><p>  As mentioned above, <strong>combining teams</strong> , you can implement any transition.  This is exactly the task that Router does. </p><br><p>  For example, if there is a task for some event in the presenter: </p><br><p>  1) throw off the whole chain to the root screen; <br>  2) replace the root screen with a new one; <br>  3) and still show the system message; </p><br><p>  then a method is added to the Router, which sends a sequence of three commands to be executed in the CommandBuffer: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">navigateToNewRootWithMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String screenKey, Object data, String message)</span></span></span><span class="hljs-function"> </span></span>{ executeCommand(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BackTo(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); executeCommand(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Replace(screenKey, data)); executeCommand(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SystemMessage(screenKey, data)); }</code> </pre> <br><blockquote>  If the presenter himself called these methods, then after the first BackTo () command, he would have been destroyed (not quite, but conveys the essence) and did not complete the work correctly. </blockquote><p>  The library has a ready-made Router, used by default, with the most necessary transitions, but as with the navigator, no one forbids creating its own implementation. </p><br><p>  <em>navigateTo ()</em> - switch to the new screen. <br>  <em>newScreenChain ()</em> - resets the chain to the root screen and opens one new one. <br>  <em>newRootScreen ()</em> - reset the chain and replace the root screen. <br>  <em>replaceScreen ()</em> - replaces the current screen. <br>  <em>backTo ()</em> - return to any screen in the chain. <br>  <em>exit ()</em> - exit from the screen. <br>  <em>exitWithMessage ()</em> - exit from the screen + message display. <br>  <em>showSystemMessage ()</em> - display of the system message. </p><br><h2 id="commandbuffer">  CommandBuffer </h2><br><p>  CommandBuffer is a class that is responsible for delivering Navigator navigation commands.  It is logical that the link to the navigator instance is stored in the CommandBuffer.  It gets there through the NavigatorHolder interface: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NavigatorHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setNavigator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Navigator navigator)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeNavigator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  In addition, if commands are received in the CommandBuffer, and at the moment it does not contain a Navigator, they will be saved in the queue and will be executed immediately when installing the new Navigator.  Thanks to the CommandBuffer, we managed to solve all the problems of the life cycle. </p><br><p>  Specific example for the Activity: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); SampleApplication.INSTANCE.getNavigatorHolder().setNavigator(navigator); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SampleApplication.INSTANCE.getNavigatorHolder().removeNavigator(); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); }</code> </pre> <br><blockquote>  Why onResume and onPause?  For secure transaction Fragment'ov and display the system message in the form of an alert. </blockquote><br><h2 id="ot-teorii-k-praktike-kak-ispolzovat-cicerone">  From theory to practice.  How to use cicerone? </h2><br><p>  Suppose we want to implement navigation on Fragments in MainActivity: <br>  Add dependency to build.gradle </p><br><pre> <code class="hljs ruby">repositories { maven { url <span class="hljs-string"><span class="hljs-string">'https://dl.bintray.com/terrakok/terramaven/'</span></span> } } dependencies { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>Cicerone compile <span class="hljs-string"><span class="hljs-string">'ru.terrakok.cicerone:cicerone:1.0'</span></span> }</code> </pre> <br><p>  In the SampleApplication class, we initialize the ready router </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SampleApplication INSTANCE; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Cicerone&lt;Router&gt; cicerone; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(); INSTANCE = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; cicerone = Cicerone.create(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NavigatorHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNavigatorHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cicerone.getNavigatorHolder(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Router </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRouter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cicerone.getRouter(); } }</code> </pre> <br><p>  In the MainActivity create a navigator: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Navigator navigator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SupportFragmentNavigator(getSupportFragmentManager(), R.id.main_container) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Fragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String screenKey, Object data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(screenKey) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LIST_SCREEN: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ListFragment.getNewInstance(data); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DETAILS_SCREEN: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DetailsFragment.getNewInstance(data); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(‚ÄúUnknown screen key!‚Äù); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showSystemMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message)</span></span></span><span class="hljs-function"> </span></span>{ Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, message, Toast.LENGTH_SHORT).show(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ finish(); } }; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); SampleApplication.INSTANCE.getNavigatorHolder().setNavigator(navigator); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); SampleApplication.INSTANCE.getNavigatorHolder().removeNavigator(); }</code> </pre> <br><p>  Now, from anywhere in the application (ideally from the presenter), you can call the router's methods: </p><br><pre> <code class="java hljs">SampleApplication.INSTANCE.getRouter().backTo(...);</code> </pre> <br><h2 id="chastnye-sluchai-i-ih-reshenie">  Special cases and their solution </h2><br><h3 id="single-activity">  Single Activity? </h3><br><p>  Not!  But I don‚Äôt view Activity as screens, only as containers.  See: Router is created in the Application class, so when switching from one Activity to another, the active navigator will simply change, so it is quite possible to divide the application into independent Activities, within which there will already be screen switches.  Of course, it should be understood that the chains of screens in this case will be tied to a separate Activity, and the BackTo () command will work only in the context of one Activity. </p><br><h3 id="vlozhennaya-navigaciya">  Nested navigation </h3><br><p>  I gave an example above, but I repeat again: </p><br><p>  There is an activity with tabs.  The task is to ensure that within each tab there is an independent chain of screens that persists when changing tabs. </p><br><p>  This is solved by two types of navigation: global and local. </p><br><p>  <em>GlobalRouter</em> is an application router connected to the Activity navigator. <br>  A presenter handling clicks on tabs invites commands from GlobalRouter. </p><br><p>  <em>LocalRouter</em> - routers inside each Fragment container.  Navigator for LocalRouter'a implements the Fragment-container itself. <br>  Presenters related to local chains within tabs are obtained for LocalRouter navigation. </p><br><p>  Where is the connection?  In Fragment'ah containers there is access to the global navigator!  At the moment when the local chain inside the tab has ended and the Back () command is called, the Fragment sends it to the global navigator. </p><br><blockquote>  Tip: To customize dependencies between components, use Dagger 2, and CustomScopes to manage their lifecycle. </blockquote><br><h3 id="a-chto-s-sistemnoy-knopkoy-back">  And what about the system back button? </h3><br><p>  This question is not specifically addressed in the library.  Pressing the Back button should be perceived as user interaction and transmitted simply as an event to the presenter. </p><br><h3 id="no-est-ved-flow-ili-conductor">  But is there Flow or Conductor? </h3><br><p>  We looked at other solutions, but abandoned them, since one of the main tasks was to use the most standard approach and not to create another framework with our FragmentManager and BackStack. </p><br><p>  First, it will allow new developers to quickly connect to the project without having to learn third-party frameworks. </p><br><p>  Secondly, you will not have to fully rely on complex third-party solutions, which is fraught with difficult support. </p><br><h2 id="itog">  Total </h2><br><p>  Cicerone Library: </p><br><ul><li>  not tied to fragments; </li><li>  not a framework; </li><li>  provides short calls; </li><li>  easy to expand; </li><li>  adapted for tests; </li><li>  <strong>does not depend on the life cycle!</strong> </li></ul><br><h2 id="github">  Github </h2><br><p>  <a href="https://github.com/terrakok/Cicerone">Cicerone is a lightweight library app.</a> </p><br><p><img src="https://habrastorage.org/files/16d/2ee/6e3/16d2ee6e33a0428eb4f0dcab8ce6b294.gif"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/314838/">https://habr.com/ru/post/314838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314824/index.html">5 lessons of a seven-month stay in a start-up hell</a></li>
<li><a href="../314826/index.html">JetBrains Night in Moscow. Video. Kotlin as the first step to JVM</a></li>
<li><a href="../314830/index.html">How ABBYY technologies help improve data leak detection systems</a></li>
<li><a href="../314832/index.html">Work with cab-archives via IStream</a></li>
<li><a href="../314834/index.html">Go programming language - seven years</a></li>
<li><a href="../314840/index.html">Symfony - upload files to MongoDB GridFS</a></li>
<li><a href="../314842/index.html">Laboratory penetration testing "Test lab v.10" - beyond the hacker capabilities</a></li>
<li><a href="../314848/index.html">How to build RidgeRun SDK</a></li>
<li><a href="../314850/index.html">Patent lining smartphone Samsung Galaxy X</a></li>
<li><a href="../314852/index.html">Build a Voronoi diagram by 'divide and conquer'. Lloyd's Relaxation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>