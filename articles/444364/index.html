<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Playing for Rust in 24 hours: personal development experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you about the personal experience of developing a small game on Rust. It took about 24 hours to create a working version (...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Playing for Rust in 24 hours: personal development experience</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/019/753/9bf/0197539bf7364b198561856cd6dfd961.png" alt="image"></div><br>  In this article I will tell you about the personal experience of developing a small game on Rust.  It took about 24 hours to create a working version (mostly I worked in the evenings or on weekends).  The game is far from over, but I think the experience will be rewarding.  I will tell you what I learned and about some observations made when building a game from scratch. <br><a name="habracut"></a><br><blockquote>  <b>Skillbox recommends:</b> A two-year hands-on course <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Drust24">‚ÄúI am a PRO web developer</a> . <a href="https://iamwebdev.skillbox.ru/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DWEBDEVPRO%26utm_content%3Darticles%26utm_term%3Drust24">‚Äù</a> <br><br>  <b>We remind:</b> <i>for all readers of "Habr" - a discount of 10,000 rubles when recording for any Skillbox course on the promotional code "Habr".</i> </blockquote><br><h3>  Why Rust? </h3><br>  I chose this language because I heard a lot of good things about it and I see that it is becoming increasingly popular in the field of game development.  Before writing the game, I had little experience developing simple applications on Rust.  This was just enough to feel a certain freedom while writing the game. <br><br><h3>  Why the game and what game? </h3><br>  Making games is fun!  I would like more reasons, but for ‚Äúhome‚Äù projects I choose topics that are not too closely related to my regular work.  What game is this?  I wanted to do something like a tennis simulator that combines Cities Skylines, Zoo Tycoon, Prison Architect and tennis itself.  In general, it was a game about the academy of tennis, where people come to play. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Technical training </h3><br>  I wanted to use Rust, but I didn‚Äôt know exactly how much ‚Äúfrom scratch‚Äù I would need to get started.  I did not want to write pixel shaders and use drag-n-drop, so I was looking for the most flexible solutions. <br><br>  I found useful resources that I share with you: <br><br><ul><li>  <a href="http://arewegameyet.com/">Are we game yet</a> - a list of Rust elements necessary for developing games; </li><li>  <a href="https://www.reddit.com/r/rust_gamedev">Rust game dev sabreddit;</a> </li><li>  <a href="https://kenney.nl/">Free pixel art.</a> </li></ul><br>  I studied several Rust game engines, eventually choosing Piston and ggez.  I faced them during the work on the previous project.  In the end, I chose ggez, because it seemed more suitable for implementing a small 2D game.  The modular structure of Piston is too complicated for a novice developer (or someone who first works with Rust). <br><br><h3>  Game structure </h3><br>  I spent some time thinking about the architecture of the project.  The first step is to make the ‚Äúground‚Äù, people and tennis courts.  People have to move around the courts and wait.  Players must have skills that improve over time.  Plus, there should be an editor that allows you to add new people and courts, but this is no longer free. <br><br>  Having thought of everything, I set to work. <br><br><h3>  Game creation </h3><br>  <b>Start: Circles and Abstractions</b> <br><br>  I took an example from ggez and got a circle on the screen.  Amazing  Now some abstractions.  It seemed to me that it was a good idea to abstract from the idea of ‚Äã‚Äãa game object.  Each object must be rendered and updated as indicated here: <br><br><pre><code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// the game object trait trait GameObject { fn update(&amp;mut self, _ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt;; fn draw(&amp;mut self, ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt;; } // a specific game object - Circle struct Circle { position: Point2, } impl Circle { fn new(position: Point2) -&gt; Circle { Circle { position } } } impl GameObject for Circle { fn update(&amp;mut self, _ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt; { Ok(()) } fn draw(&amp;mut self, ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt; { let circle = graphics::Mesh::new_circle(ctx, graphics::DrawMode::Fill, self.position, 100.0, 2.0)?; graphics::draw(ctx, &amp;circle, na::Point2::new(0.0, 0.0), 0.0)?; Ok(()) } }</span></span></code> </pre> <br>  This piece of code allowed me to get an excellent list of objects that I can update and render in an equally excellent cycle. <br><br><pre> <code class="rust hljs">mpl event::EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MainState { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, context: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Context) -&gt; GameResult&lt;()&gt; { <span class="hljs-comment"><span class="hljs-comment">// Update all objects for object in self.objects.iter_mut() { object.update(context)?; } Ok(()) } fn draw(&amp;mut self, context: &amp;mut Context) -&gt; GameResult&lt;()&gt; { graphics::clear(context); // Draw all objects for object in self.objects.iter_mut() { object.draw(context)?; } graphics::present(context); Ok(()) } }</span></span></code> </pre> <br>  main.rs is necessary because all lines of code are in it.  I spent a little time to split the files and optimize the directory structure.  Here is how everything began to look after this: <br><br>  <i>resources -&gt; this is where all the assets are (images)</i> <i><br></i>  <i>src</i> <i><br></i>  <i>- entities</i> <i><br></i>  <i>- game_object.rs</i> <i><br></i>  <i>- circle.rs</i> <i><br></i>  <i>- main.rs -&gt; main loop</i> <br><br>  <b>People, floors and images</b> <br><br>  The next stage is the creation of the game Person object and the loading of images.  Everything should be built on the basis of tiles of size 32 * 32. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/642/4c6/65c/6424c665cb9442c5471a49d987954880.png"><br><br>  <b>Tennis courts</b> <br><br>  Having studied how tennis courts look, I decided to make them out of 4 * 2 tiles.  Initially, it was possible to make an image of this size, or to put together 8 individual tiles.  But then I realized that only two unique tiles are needed, and here's why. <br><br>  In total we have two such tiles: 1 and 2. <br><br>  Each section of the court consists of tile 1 or tile 2. They can be placed as usual or be turned upside down by 180 degrees. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26d/de1/e6f/26dde1e6f7ec2459c89752754a048c04.png"><br><br>  <b>The main mode of construction (assembly)</b> <br><br>  After it turned out to achieve the rendering of sites, people and maps, I realized that I also needed a basic build mode.  It is implemented as follows: when the button is pressed, the object is selected, and the click places it in the right place.  So, button 1 allows you to select a court, and button 2 allows you to select a player. <br><br>  But you still need to remember that we have 1 and 2, so I added a wireframe to make it clear which object is selected.  Here's what it looks like. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/63d/e17/e9663de17e6b402f43cab61e3905c874.gif"></div><br>  <b>Questions on architecture and refactoring</b> <br><br>  Now I have several game objects: people, courts and floors.  But in order for wired frames to work, each entity of the object needs to be informed whether the objects themselves are in demonstration mode, or whether the frame is simply drawn.  This is not very convenient. <br><br>  It seemed to me that it was necessary to rethink the architecture so that some limitations emerged: <br><br><ul><li>  the presence of an entity that displays and updates itself is a problem, since this entity cannot ‚Äúfind out‚Äù what it has to render - an image and a wireless frame; </li><li>  the absence of an instrument for the exchange of properties and behavior between individual entities (an example is the property is_build_mode or the drawing of behavior).  Inheritance could be used, although there is no normal way to implement it in Rust.  What I really needed was the layout; </li><li>  a tool for interaction between entities was needed to assign people to the courts; </li><li>  the entities themselves were a mixture of data and logic, which very quickly got out of control. </li></ul><br><blockquote>  <i>I conducted additional research and discovered the <a href="https://en.wikipedia.org/wiki/Entity_component_system">ECS - Entity Component System</a> architecture, which is commonly used in games.</i>  <i>Here are the benefits of ECS:</i> <i><br><br></i> <ul><li>  data is separated from logic; </li><li>  layout instead of inheritance; </li><li>  data-oriented architecture. </li></ul></blockquote><br>  ECS has three basic concepts: <br><br><ul><li>  Entities - the type of object referenced by the identifier (it can be a player, a ball or something else); </li><li>  components - are entities.  An example is the rendering component, locations, and others.  These are data warehouses; </li><li>  systems - they use both objects and components, plus they contain behavior and logic that are based on this data.  An example is a rendering system that iterates all entities with components for rendering and deals with rendering. </li></ul><br>  After studying it became clear that ECS solves such problems: <br><br><ul><li>  using layout instead of inheritance for the system organization of entities; </li><li>  getting rid of code hassle due to control systems; </li><li>  using methods like is_build_mode to store the logic of a wireframe in the same place - in the rendering system. </li></ul><br>  That's what happened after the introduction of ECS. <br><br>  <i>resources -&gt; this is where all the assets are (images)</i> <i><br></i>  <i>src</i> <i><br></i>  <i>- components</i> <i><br></i>  <i>- position.rs</i> <i><br></i>  <i>- person.rs</i> <i><br></i>  <i>- tennis_court.rs</i> <i><br></i>  <i>- floor.rs</i> <i><br></i>  <i>- wireframe.rs</i> <i><br></i>  <i>- mouse_tracked.rs</i> <i><br></i>  <i>- resources</i> <i><br></i>  <i>- mouse.rs</i> <i><br></i>  <i>- systems</i> <i><br></i>  <i>- rendering.rs</i> <i><br></i>  <i>- constants.rs</i> <i><br></i>  <i>- utils.rs</i> <i><br></i>  <i>- world_factory.rs -&gt; world factory functions</i> <i><br></i>  <i>- main.rs -&gt; main loop</i> <br><br><h3>  Appoint people to the courts </h3><br>  ECS has made life easier.  Now I had a system way of adding data to entities and adding logic based on this data.  And this, in turn, allowed to organize the distribution of people on the courts. <br><br>  What have I done: <br><br><ul><li>  added data about the assigned courts in Person; </li><li>  added data about distributed people in TennisCourt; </li><li>  Added CourtChoosingSystem, which allows you to analyze people and sites, discover available courts and distribute players to them; </li><li>  Added a PersonMovementSystem system that looks for people assigned to the courts, and if they are not there, then sends people where they need to. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b0/c8e/c95/7b0c8ec951007ad4d5895716c3ca7618.gif"></div><br><h3>  Summing up </h3><br>  I really enjoyed working on this simple game.  Moreover, I am pleased that I used Rust to write it, because: <br><br><ul><li>  Rust gives you what you need; </li><li>  he has excellent documentation, Rust is very elegant; </li><li>  consistency is cool; </li><li>  there is no need to resort to cloning, copying or other similar actions, which I often did in C ++; </li><li>  Options are very convenient for work, they also handle errors well; </li><li>  if the project was able to compile, then in 99% it works, and exactly as it should.  Compiler error messages, it seems to me, are the best I've seen. </li></ul><br>  Rust game development is just beginning.  But there is already a stable and rather large community working to open Rust for everyone.  Therefore, I look at the future of the language with optimism, looking forward to the results of our common work. <br><br><blockquote>  <b>Skillbox recommends:</b> <br><br><ul><li>  Online course <a href="https://skillbox.ru/frontend-developer/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DFRENDEV%26utm_content%3Darticles%26utm_term%3Drust24">"Profession frontend developer"</a> . </li><li>  Practical course <a href="https://skillbox.ru/agima/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DAGIMA%26utm_content%3Darticles%26utm_term%3Drust24">"Mobile Developer PRO"</a> . </li><li>  Practical annual course <a href="https://skillbox.ru/php/%3Futm_source%3Dskillbox.media%26utm_medium%3Dhabr.com%26utm_campaign%3DPHPDEV%26utm_content%3Darticles%26utm_term%3Drust24">"PHP developer from 0 to PRO"</a> . </li></ul><br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/444364/">https://habr.com/ru/post/444364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444350/index.html">For some reason, MVP does not start (minimally viable product)</a></li>
<li><a href="../444352/index.html">Kontur.Kampus: we invite you to a free student camp of industrial development near St. Petersburg</a></li>
<li><a href="../444356/index.html">React Training Course, Part 24: Second Form Work</a></li>
<li><a href="../444360/index.html">Injustice Google Play, like a good life experience</a></li>
<li><a href="../444362/index.html">Unity is working on a new physics engine with Havok</a></li>
<li><a href="../444366/index.html">Seminar "Requirements of information security: how business live with them"</a></li>
<li><a href="../444368/index.html">We just printed out the microphone on a 3D printer in the laboratory - and then there will be complete science fiction</a></li>
<li><a href="../444370/index.html">What is Mini PCI-e format capable of?</a></li>
<li><a href="../444372/index.html">Machine orientation over long distances with automated reinforcement learning</a></li>
<li><a href="../444374/index.html">Hipster effect: why nonconformists often look the same</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>