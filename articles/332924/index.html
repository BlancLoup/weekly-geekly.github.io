<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tcl / Tk. GUI development for command line utilities</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Testing a cloud token on various platforms, I did not abandon the thought of some injustice: why the PKCS # 11 token configuration utilities on MS Win...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tcl / Tk. GUI development for command line utilities</h1><div class="post__text post__text-html js-mediator-article">  Testing a <a href="https://geektimes.ru/post/288674/">cloud token</a> on various platforms, I did not abandon the thought of some injustice: why the PKCS # 11 token configuration utilities on MS Windows have a graphical interface, but for other platforms it does not.  And first of all, it concerns the base <a href="http://soft.lissi.ru/ls_product/utils/p11utils/">utility p11conf</a> , which is available for free use and is a command line utility, which is interacted with via standard I / O. <br><a name="habracut"></a><br><h3>  tkBuilder - graphic designer </h3><br>  The solution would be to write in C / C ++ GUI for the p11conf utility, for example, using the Qt library.  But here it came to mind that there is a scripting language of high level Tcl (Tool Command Language), which is in conjunction with the graphic library Tk (Tool Kit) and allows you to quickly create graphical interfaces for console programs or command line utilities.  I first met the <a href="https://www.tcl.tk/">Tk / Tcl package back</a> in 1997, when it was planned to write a graphical interface for the access control system (ACS).  Then the graphics capabilities of the package made a strong impression and, in particular, tetris: <br><br><img src="https://habrastorage.org/web/dd8/40e/a7b/dd840ea7bd424e4fa3f59bec5c28c637.png" alt="image"><br><br>  One of the reasons for which they refused to use Tk / Tcl was the absence for him at that time of a designer (designer) similar to the current one, say, QT-designer.  Refreshing the Tk / Tcl capabilities, and we were interested, in addition to the graphic capabilities, to organize interaction with the command line utilities, and making sure that we were on the right track, we set about searching for the designer.  After analyzing the available designers, the choice fell on the designer <a href="https://sourceforge.net/projects/tkbuilder84/">tkBuilder_for_tcl8.4</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/1f3/b5d/850/1f3b5d8507a540b8bf760f6ccd88eb2c.png" alt="image"><br><br>  Further development has shown the correctness of the choice.  The designer was not only with a clear interface, but has excellent functionality.  It allows during the development to track the project not only entirely: <br><br><img src="https://habrastorage.org/web/aec/5d0/963/aec5d096391543dba01c822fe909672d.png" alt="image"><br><br>  but also to control its individual parts: <br><br><img src="https://habrastorage.org/web/1f4/2e7/9d0/1f42e79d0a76448dbabaadfee7cab702.png" alt="image"><br><br>  The developer can always see the code of the entire project or its part: <br><br><img src="https://habrastorage.org/web/f4d/006/635/f4d006635f4b433d8c0d00629eff860b.png" alt="image"><br><br>  Interaction with the command line utility, for which the graphical shell is being developed, is conducted via a program channel: <br><br><img src="https://habrastorage.org/web/f16/d31/978/f16d31978e8f4f67a00cad7b9fcf332d.png" alt="image"><br><br>  When the project is completed, it is necessary to save it in the final tcl file: <br><br><img src="https://habrastorage.org/web/a44/883/ac8/a44883ac82e24ed1a8095936488f01fc.png" alt="image"><br><br><h3>  About fly in the ointment </h3><br>  It would seem that everything, take it and run the utility.  But without a spoon (in fact, two spoons) tar is impossible.  The first spoon is related to the formation of the xScrollCommand and yScrollComand commands in the widgets (in our case, the text widget), namely: <br><br><pre><code class="plaintext hljs">text .fr1.fr2_list -background #ffffff \ -yscrollcommand [list .fr1.ysc set] -xscrollcommand [list .fr1.scx set]</code> </pre> <br>  They do not want to get into the final file.  As a result, they had to register with pens.  Well, the second fly in the ointment is classic.  The designer tkBuilder_for_tcl8.4 refuses to work with Russian letters (maybe I didn‚Äôt understand anything).  I emphasize that this applies only to the designer and does not apply to Tcl / Tk, for which Russian is like a native language.  Here, too, had to work handles: <br><br><pre> <code class="plaintext hljs">#!/bin/sh # the next line restarts using wish \ exec wish8.5 "$0" ${1+"$@"} wm title . "GUI P11CONF" global p11conf global libpkcs11 set res "" set libpkcs11 "" set p11conf "/usr/local/bin64/p11conf" . configure -background #18f1d7 frame .fr1 -background #18f1d7 grid .fr1 -column 0 -row 0 button .fr1.b1 -command {InitTok . .fr1.fr2_list;} -padx 1 -text "" -width 24 grid .fr1.b1 -column 0 -row 0 button .fr1.b2 -command {ChangeUserPin . .fr1.fr2_list; } -padx 1 -text " USER PIN" -width 24 grid .fr1.b2 -column 0 -row 1 button .fr1.b6_3 -command {ChangeSOPin . .fr1.fr2_list "SO"; } -padx 1 -text " SO PIN" -width 24 grid .fr1.b6_3 -column 0 -row 2 button .fr1.b7 -command {InfoObj . .fr1.fr2_list "Obj"; } -padx 1 -text " " -width 24 grid .fr1.b7 -column 0 -row 3 button .fr1.b8 -command {InfoObj . .fr1.fr2_list "Clear";} -padx 1 -text "  " -width 24 grid .fr1.b8 -column 0 -row 4 button .fr1.b9_6 -command {InfoToken . .fr1.fr2_list; } -padx 1 -text "  " -width 24 grid .fr1.b9_6 -column 0 -row 5 button .fr1.b0 -command {InfoMech . .fr1.fr2_list;} -padx 1 -text " " -width 24 grid .fr1.b0 -column 0 -row 6 button .fr1.b3_8 -command {ChangeSOPin . .fr1.fr2_list "Deblock"; } -padx 1 -text " USER PIN" -width 24 grid .fr1.b3_8 -column 0 -row 7 button .fr1.b4_9 -command {InfoDump . .fr1.fr2_list; } -padx 1 -text "DUMP  " -width 24 grid .fr1.b4_9 -column 0 -row 8 button .fr1.b5_10 -command {exit} -text "" -width 10</code> </pre> <br>  As a result, we received GUI support for the p11conf command line utility through the GUITKP11Conf.tcl utility: <br><br><pre> <code class="bash hljs">bash-4.3$ ./GUITKP11Conf.tcl</code> </pre><br><img src="https://habrastorage.org/web/15c/923/dbf/15c923dbf26d4b4fb607283f35ffd4bb.png" alt="image"><br>  Now you can safely work with PKCS # 11 tokens, including the LIBLS11CLOUD cloud token, for example, to see which objects are stored on it: <br><br><img src="https://habrastorage.org/web/655/085/f8a/655085f8a8e242379e5fd1f8f1f43df3.png" alt="image"><br>  The GUIP11CONF.tkb project file and the GUIP11CONF.tcl utility <a href="">can be downloaded here</a> .  The p11conf utility for various platforms can be <a href="http://soft.lissi.ru/ls_product/utils/p11utils/">downloaded here</a> .  A little note.  In the GUIP11CONF.tcl utility, the path is specified in the p11conf utility (see above): <br><br><pre> <code class="plaintext hljs">global p11conf ‚Ä¶ set p11conf "/usr/local/bin64/p11conf"</code> </pre> <br>  Most likely, you will have to correct the path to the p11conf utility with your configuration. <br><br><h3>  Down and Out trouble started <br></h3><br>  In conclusion, I note that the appetite comes with eating and you already have the desire to write similar graphical shells for command line utilities such as <a href="https://www.openssl.org/">openssl</a> / <a href="http://soft.lissi.ru/ls_product/skzi/lirssl/">lirssl</a> (LINK) or NSS (Network Security Services) utilities.  As they say, the first step is the hardest. <br><br>  PS Continued <a href="https://habrahabr.ru/post/333742/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/332924/">https://habr.com/ru/post/332924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332914/index.html">20 materials about the methods of successful traffic to the site</a></li>
<li><a href="../332916/index.html">We implement touch logger for Android using CVE-2016‚Äì5195</a></li>
<li><a href="../332918/index.html">Gremlins and ELF magic: what if the ELF file is a container?</a></li>
<li><a href="../332920/index.html">Deploy and demonize the ASP.NET Core Linux application as a background service.</a></li>
<li><a href="../332922/index.html">How isometric worlds are created</a></li>
<li><a href="../332928/index.html">Implementing Elliptic curve Menezes-Vanstone cryptosystem based on the OpenSSL API</a></li>
<li><a href="../332930/index.html">Solution of the promo task from BI.ZONE CTF</a></li>
<li><a href="../332934/index.html">Setting up object archiving in SAP ERP for beginners</a></li>
<li><a href="../332936/index.html">Method of non-iterative learning of a single-layer network of direct distribution with a linear activation function</a></li>
<li><a href="../332938/index.html">How to build a small but good network?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>