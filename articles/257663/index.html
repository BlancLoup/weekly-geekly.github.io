<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LFS: The Dark Side of the Force. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 There are many ways to install Linux on your computer and start using it for specific tasks. The choice of distributions is extremely wide,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LFS: The Dark Side of the Force. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h1>  Foreword </h1><br>  There are many ways to install Linux on your computer and start using it for specific tasks.  The choice of distributions is extremely wide, for every taste and color - and ‚Äúfor housewives‚Äù and for advanced users, allowing any level of customization, including assembly from source codes for a specific hardware.  Installation of the system is, in principle, accessible to anyone who is a little bit competent PC user.  And, if you don‚Äôt dive into the popular today de-jing on the topic ‚ÄúLinux vs Other OS‚Äù, then using this system does not require knowledge that we had to say for a new Linux user 10 years ago.  From my deeply subjective point of view, in more than ten years that I have been watching the development of this system, Linux has become more friendly to beginners and got rid of many problems inherent in it in the past.  And this is good. <br><br>  <i>Handmade penguins ...</i> <br><img src="https://habrastorage.org/files/523/9a2/feb/5239a2febf22468fa4042a832747232e.jpg"><br><br>  On Habr√© already flashed a couple of articles on the topic of LFS, for example, <a href="http://habrahabr.ru/post/183714/">this one</a> , or <a href="http://habrahabr.ru/post/113615/">this one</a> .  Comments to the latter suggest a logical thought - if the set of options for installing Linux and studying it is already comprehensively wide, why do we need LFS? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will not tell you the stories about "how space ships plow ... and when the Earth was a fireball ...".  I will answer the question posed based on my position - I collect LFS because I‚Äôm just interested to do it.  I see in this process a good opportunity to look under the hood of the system.  I admit that this path can hardly be called optimal.  However, this article, and the subsequent ones, will be devoted to the process of manually assembling a Linux system.  These articles will not be a translation of the assembly documentation ‚Äî there is no particular need for this.  Emphasis will be placed on the specifics and nuances of the process, which the author had to face personally.  We will consider this cycle something like a neophyte diary. <br><br><a name="habracut"></a><br><h1>  1. System Requirements </h1><br>  To build LFS, you need a computer with GNU / Linux OS installed on it.  In principle, any distribution will work.  Suppose I use Arch Linux on my machines.  As for the Debian-based distributions (Linux Mint, Ubuntu, etc.), they also fit, of course, but I hasten to pay attention to the following - at one of the initial stages of the work, when the environment variables are initialized, a command shell warning appears <br><br><pre><code class="hljs pgsql">$ source ~/.bash_profile dircolors: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> SHELL environment variable, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> shell <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">option</span></span> given</code> </pre> <br>  I received this warning in Linux Mint 17 with indirectly calling dircolors (the command that color the terminal) from / etc / profile when the user re-entered and updated the environment variables with the source command.  It is not critical and can be ignored. <br><br>  On the host Linux system, the packages listed in the <a href="http://www.linuxfromscratch.org/lfs/view/stable/prologue/hostreqs.html">official system requirements</a> must be installed.  Most of these packages are included in the system "out of the box" or are installed by additional developer tools.  In any case, they are easily installed from the official repository of a specific distribution.  A good option is to use a <a href="http://www.knoppix.org/">Knoppix</a> LiveCD, then you can install LFS on a machine that does not contain any operating system.  In this sense, the choice is yours. <br><br>  In addition to iron and OS, patience and perseverance are also necessary.  The process of assembly and configuration is quite lengthy and time consuming.  You should not engage in copy-pasting to the terminal commands from the book: firstly, your case may be unique;  secondly - our goal is to understand the principle of building a workable OS, assembled from source codes, which means we will have to delve into the meaning of the processes that are taking place.  Each stage of the work must be approached intelligently and without haste. <br><br><h1>  2. Minimum system build documentation </h1><br>  All the necessary documentation is concentrated in the book <a href="http://www.linuxfromscratch.org/lfs/view/stable/">Linux Form Scratch</a> (the link leads to the online version of the most stable release).  The first advice that I would like to give to a newbie is to take the latest stable version in English.  There are Russian translations, but they always lag behind the current version.  In addition, the link to the latest <a href="http://linuxshare.ru/ihtml/show">Russian version of LFS 6.0</a> leads to a void, and the only translation available from the official site concerns <a href="http://linux.yaroslavl.ru/docs/book/lfsbook/">LFS 5.0,</a> but, to put it mildly, it is outdated.  The kernel of the system and the GNU project software undergo regular changes, moreover, those versions of packages that are described in older versions of LFS are not always available for download, and if they are available, they will have to be searched manually.  So our choice is the current English version of LFS. <br><br>  <b>Note</b> : while this article was being written, a link to the <a href="http://barracuda72.github.io/LFS-BOOK.pdf">translation of LFS 7.3</a> was found <a href="https://ru.wikipedia.org/wiki/Linux_From_Scratch">in the wiki article from LFS</a> , which is closer to the truth.  However, this translation is not yet complete - most of the books are in English. <br><br>  I also want to warn the reader that the use of Current Development in the edition of the book can also turn into unforeseen difficulties.  This version can be obtained from the daily updated SVN repository.  The book is downloaded by the team <br><br><pre> <code class="hljs ruby">$ mkdir ~<span class="hljs-regexp"><span class="hljs-regexp">/LFS &amp;&amp; cd ~/</span></span>LFS $ svn co <span class="hljs-symbol"><span class="hljs-symbol">svn:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/svn.linuxfromscratch.org/</span></span>LFS/trunk/BOOK/</code> </pre><br>  And it is easy to build, for example: <br><pre> <code class="hljs ruby">$ cd BOOK $ mkdir ../html $ make BASEDIR=../html</code> </pre><br><br>  This version is the latest, focused on the use of the recently released "skynet-version" of the Linux 4.0 kernel. <br><br><div class="spoiler">  <b class="spoiler_title">And here is SkyNet?</b> <div class="spoiler_text">  And with that: <br><br><img src="https://habrastorage.org/files/740/fd9/84e/740fd984e1b64b28b87c0ece5378caec.jpg"><br></div></div><br>  The first problem arises already when checking checksums of downloaded packages. <br><br><pre> <code class="hljs 1c">$ md5sum -c md5sums . . lfs-bootscripts-<span class="hljs-number"><span class="hljs-number">20150222</span></span>.tar.bz2:  . . md5sum: <span class="hljs-built_in"><span class="hljs-built_in"></span></span>: <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span>   </code> </pre><br><br>  The specified archive is unpacked, the file sizes are true.  Perhaps in the md5sums file containing the CRS list the error just crept in.  However, in order not to risk it, it is better to take a stable version of the book. <br><br><h1>  3. Soil preparation </h1><br>  First of all, to deploy LFS, we need disk space.  This may be a single partition (or several partitions) on the HDD, or maybe a directory in the host file system.  I stopped at the version with a partition on the HDD of the virtual machine, which I had previously installed 64-bit Arch Linux. <br><br>  The minimum size of the required disk space - 4 GB.  I created a logical partition of 40 GB in size by formatting it in EXT4.  This section must be mounted on the host system.  Mount point is convenient to save in a special environment variable. <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># export LFS=/mnt/lfs</span></span></code> </pre><br>  for along this path we will have to go very often.  We mount the partition with commands (in my case this is the sda6 partition, yours will probably be different in yours) <br><br><pre> <code class="hljs mel"># mkdir -v $LFS # mount /dev/sda6 $LFS</code> </pre><br><br>  Now we need to create two directories: $ LFS / sources - for storing tarballs with source codes;  $ LFS / tools - to accommodate temporary, rugged system assembly tools <br><br><pre> <code class="hljs dos"># <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -v $LFS/sources # <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -v $LFS/tools</code> </pre><br>  Set permissions on the $ LFS / sources directory: write (+ w) is allowed for all users (a) with the option of deletion only by the owner of the directory (t) <br><br><pre> <code class="hljs sql"><span class="hljs-comment"><span class="hljs-comment"># chmod -v a+wt $LFS/sources</span></span></code> </pre><br>  Download two files to the $ LFS / sources directory - <a href="http://www.linuxfromscratch.org/lfs/view/stable/wget-list">wget-list</a> downloads <a href="http://www.linuxfromscratch.org/lfs/view/stable/wget-list">list</a> and <a href="http://www.linuxfromscratch.org/lfs/view/stable/md5sums">md5sums</a> package checksums <a href="http://www.linuxfromscratch.org/lfs/view/stable/md5sums">list</a> <br><br><pre> <code class="hljs pgsql"># wget http://www.linuxfromscratch.org/lfs/<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">stable</span></span>/wget-list <span class="hljs-comment"><span class="hljs-comment">--directory-prefix=$LFS/sources # wget http://www.linuxfromscratch.org/lfs/view/stable/md5sums --directory-prefix=$LFS/sources</span></span></code> </pre><br>  The <i>--directory-prefix</i> switch specifies the path where the downloaded file should be placed.  After that, we proceed to downloading the source code of everything and everything that we have to install <br><br><pre> <code class="hljs mel"># wget --input-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>=$LFS/sources/wget-list --<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> --directory-prefix=$LFS/sources</code> </pre><br>  the <i>--input-file</i> switch points to the file containing the list of URLs of the packages being loaded;  <i>--continue</i> - enables resuming of partially downloaded files, in case the connection to the network was interrupted.  About 325 MB of archives with the source code of the required software as well as the patches necessary for the build will be downloaded.  After downloading, you must check the integrity of the downloaded packages. <br><br><pre> <code class="hljs dos"># <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> $LFS/source # md5sum -c md5sums # <span class="hljs-built_in"><span class="hljs-built_in">popd</span></span></code> </pre><br>  The test itself is a call to the md5sum utility, which calculates the checksums of all files contained in the md5sums list passed as a parameter and compares the result with the value specified in the same list.  The result, if successful, will look like this. <br><br><div class="spoiler">  <b class="spoiler_title">Package integrity check result</b> <div class="spoiler_text">  acl-2.2.52.src.tar.gz: OBJECTIVE <br>  attr-2.4.47.src.tar.gz: OBJECTIVE <br>  autoconf-2.69.tar.xz: GOAL <br>  automake-1.15.tar.xz: AIM <br>  bash-4.3.30.tar.gz: GOAL <br>  bc-1.06.95.tar.bz2: OBJECTIVE <br>  binutils-2.25.tar.bz2: OBJECTIVE <br>  bison-3.0.4.tar.xz: AIM <br>  bzip2-1.0.6.tar.gz: OBJECTIVE <br>  check-0.9.14.tar.gz: GOAL <br>  coreutils-8.23.tar.xz: AIM <br>  dejagnu-1.5.2.tar.gz: OBJECTIVE <br>  diffutils-3.3.tar.xz: AIM <br>  eudev-2.1.1.tar.gz: GOAL <br>  eudev-2.1.1-manpages.tar.bz2: AIM <br>  e2fsprogs-1.42.12.tar.gz: GOAL <br>  expat-2.1.0.tar.gz: GOAL <br>  expect5.45.tar.gz: GOAL <br>  file-5.22.tar.gz: OBJECTIVE <br>  findutils-4.4.2.tar.gz: OBJECTIVE <br>  flex-2.5.39.tar.bz2: AIM <br>  gawk-4.1.1.tar.xz: OBJECTIVE <br>  gcc-4.9.2.tar.bz2: GOAL <br>  gdbm-1.11.tar.gz: OBJECTIVE <br>  gettext-0.19.4.tar.xz: OBJECTIVE <br>  glibc-2.21.tar.xz: OBJECTIVE <br>  gmp-6.0.0a.tar.xz: OBJECTIVE <br>  gperf-3.0.4.tar.gz: GOAL <br>  grep-2.21.tar.xz: AIM <br>  groff-1.22.3.tar.gz: GOAL <br>  grub-2.02 ~ beta2.tar.xz: GOAL <br>  gzip-1.6.tar.xz: AIM <br>  iana-etc-2.30.tar.bz2: AIM <br>  inetutils-1.9.2.tar.gz: OBJECTIVE <br>  intltool-0.50.2.tar.gz: OBJECTIVE <br>  iproute2-3.19.0.tar.xz: OBJECTIVE <br>  kbd-2.0.2.tar.gz: GOAL <br>  kmod-19.tar.xz: AIM <br>  less-458.tar.gz: AIM <br>  lfs-bootscripts-20150222.tar.bz2: GOAL <br>  libcap-2.24.tar.xz: AIM <br>  libpipeline-1.4.0.tar.gz: OBJECTIVE <br>  libtool-2.4.6.tar.xz: OBJECTIVE <br>  linux-3.19.tar.xz: AIM <br>  m4-1.4.17.tar.xz: OBJECTIVE <br>  make-4.1.tar.bz2: AIM <br>  man-db-2.7.1.tar.xz: OBJECTIVE <br>  man-pages-3.79.tar.xz: AIM <br>  mpc-1.0.2.tar.gz: GOAL <br>  mpfr-3.1.2.tar.xz: OBJECTIVE <br>  ncurses-5.9.tar.gz: GOAL <br>  patch-2.7.4.tar.xz: AIM <br>  perl-5.20.2.tar.bz2: OBJECTIVE <br>  pkg-config-0.28.tar.gz: OBJECTIVE <br>  procps-ng-3.3.10.tar.xz: OBJECTIVE <br>  psmisc-22.21.tar.gz: OBJECTIVE <br>  readline-6.3.tar.gz: GOAL <br>  sed-4.2.2.tar.bz2: GOAL <br>  shadow-4.2.1.tar.xz: GOAL <br>  sysklogd-1.5.1.tar.gz: OBJECTIVE <br>  sysvinit-2.88dsf.tar.bz2: AIM <br>  tar-1.28.tar.xz: AIM <br>  tcl8.6.3-src.tar.gz: OBJECTIVE <br>  texinfo-5.2.tar.xz: AIM <br>  tzdata2015a.tar.gz: GOAL <br>  udev-lfs-20140408.tar.bz2: AIM <br>  util-linux-2.26.tar.xz: AIM <br>  vim-7.4.tar.bz2: OBJECTIVE <br>  XML-Parser-2.44.tar.gz: OBJECTIVE <br>  xz-5.2.0.tar.xz: AIM <br>  zlib-1.2.8.tar.xz: OBJECTIVE <br>  bash-4.3.30-upstream_fixes-1.patch: GOAL <br>  bc-1.06.95-memory_leak-1.patch: AIM <br>  bzip2-1.0.6-install_docs-1.patch: AIM <br>  coreutils-8.23-i18n-1.patch: GOAL <br>  glibc-2.21-fhs-1.patch: OBJECTIVE <br>  kbd-2.0.2-backspace-1.patch: GOAL <br>  mpfr-3.1.2-upstream_fixes-3.patch: OBJECTIVE <br>  readline-6.3-upstream_fixes-3.patch: GOAL <br>  sysvinit-2.88dsf-consolidated-1.patch: GOAL <br></div></div><br>  I paid special attention to a couple of pushd / popd commands.  Although I am a dedicated linuksoid, who has been using this system for a long time, these internal bash commands were new to me.  However, they are very convenient when you often have to skip the various points of the file system and then go back.  The pushd command temporarily transfers you to the directory you specified in the parameter.  Return back happens the popd team.  In this case, the route by which you jump is organized in the form of a stack and you do not need to re-enter the path that you should go back. <br><br>  Now we have everything we need to start the assembly, but it remains to perform the last preparatory operations. <br><br><h1>  4. Setting up the working environment </h1><br>  First, create a symbolic link to the $ LFS / tools directory in the root of the host system. <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ln -sv $LFS/tools /</span></span></code> </pre><br>  What is it for?  Generally, why do we need symbolic links?  They are created to ensure uniformity of access to certain points in the file system.  At the moment, in the host system the path to this directory looks like / mnt / lfs / tools.  When we move to a temporary system, the root of which will be located along the path / mnt / lfs, in this temporary system the contents of the directory will be available along the path / tools.  Those primary tools that we collect will access this directory along the / tools path, regardless of where they are run - this path will be hard-wired into the binaries after compilation.  Therefore, by creating the specified link, we provide the ability to access this directory along the / tools path, regardless of the current location of the system root.  Otherwise, immediately after the transition to the temporary system, we are waited for by failure at the first compilation. <br><br>  Now we will create a new group and a new user, on behalf of whom we will work at the first stage of building the temporary system.  You should not work as root exactly - for example, when configuring an installation package, you can confuse or forget to set the prefix for the installation directory and install the assembled package in the host system to break it (or complicate the package manager's work in the future).  Working from an unprivileged user, who is given write access only to certain directories, will allow you to avoid trouble. <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># groupadd lfs # useradd -s /bin/bash -g lfs -m -k /dev/null lfs</span></span></code> </pre><br>  The first command creates the lfs group.  The second is creating user lfs.  The meaning of the parameters is as follows: <br><br><ul><li>  -s / bin / bash - command shell used in user session </li><li>  -g lfs - user group </li><li>  -m indicates that you must create the home directory of the user / home / lfs </li><li>  -k / dev / null - empty directory of templates.  By default, when creating a home directory, it places files and folders located in / etc / skel.  If desired, this template can be changed, but we want to create an empty directory / home / lfs, which is indicated by passing a zero file as a template </li></ul><br><br>  We set the password to the user lfs <br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># passwd lfs</span></span></code> </pre><br>  and make it the owner of the $ LFS / sources and $ LFS / tools directories <br><br><pre> <code class="hljs mel"># chown -v lfs $LFS/sources # chown -v lfs $LFS/tools</code> </pre><br><br>  Login as lfs <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># su - lfs</span></span></code> </pre><br>  The line in the command parameters (short for the <i>-l</i> or <i>--login switch</i> ) indicates that a ‚Äúclean‚Äù session must be created for this user that does not inherit the values ‚Äã‚Äãof the environment variables from the previous session.  For this session, we will create our own set of environment variables. <br><br>  Create files in the user's home directory <br><br>  <b>~ / .bash_profile</b> <br><pre> <code class="hljs mel">[lfs@arch-guest ~]/$ cat &gt; ~/.bash_profile &lt;&lt; <span class="hljs-string"><span class="hljs-string">"EOF"</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> <span class="hljs-keyword"><span class="hljs-keyword">env</span></span> -i HOME=$HOME TERM=$TERM PS1=<span class="hljs-string"><span class="hljs-string">'\u:w\$ '</span></span> /bin/bash &gt; EOF</code> </pre><br>  <b>~ / .bashrc</b> <br><pre> <code class="hljs ruby">[lfs@arch-guest ~]/$ cat &gt; ~<span class="hljs-regexp"><span class="hljs-regexp">/.bashrc &lt;&lt; "EOF" &gt; set +h &gt; umask 022 &gt; LFS=/mnt</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lfs &gt; LC_ALL=POSIX &gt; LFS_TGT=$(uname -m)-lfs-linux-gnu &gt; PATH=/tools</span></span><span class="hljs-regexp"><span class="hljs-regexp">/bin:/bin</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/usr/bin</span></span> &gt; export LFS LC_ALL LFS_TGT PATH &gt; EOF</code> </pre><br><br>  The ~ / .bash_profile file defines individual user-specific settings for environment variables.  Team <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> <span class="hljs-keyword"><span class="hljs-keyword">env</span></span> -i HOME=$HOME TERM=$TERM PS1=<span class="hljs-string"><span class="hljs-string">'\u:W\$ '</span></span> /bin/bash</code> </pre><br>  creates a ‚Äúclean‚Äù user environment (the <i>-i</i> switch to ignore previous settings), assigning values ‚Äã‚Äãto environment variables <br><br><ul><li>  HOME - home directory, assign the current value of the variable equal to / home / lfs </li><li>  TERM - the type of terminal used, just leave the current one </li><li>  PS1 is a command prompt format.  In this case, the format is set to the form user name: current working directory $, where the special character \ u is the user name, \ W is the current working directory. </li><li>  / bin / bash - the command that starts a new instance of the shell </li></ul><br><br>  The ~ / .bashrc file determines what settings should be made when logging into this user session. <br><br><ul><li>  set + h - disables hashing in bash.  The command shell remembers the paths to executable files that were launched earlier, which certainly speeds up the system.  However, we will call different versions of the same programs located in different paths, so hashing will only harm us. </li><li>  umask 022 - set permissions for new files and directories set by default.  A value of 022 means that files will be created with the rights 644 (rw- r-- r--) and directories with the rights 755 (rwx rx rx).  Each coded umask bit means a reset of the corresponding bit in the rights attributes </li><li>  LFS = / mnt / lfs - the root of the assembled system </li><li>  LC_ALL = POSIX - defines the localization of the programs being run.  POSIX sets the display standard regardless of the character encoding method. </li><li>  LFS_TGT - sets the description of the target machine used when building temporary system assembly tools </li><li>  PATH - paths for searching executable files </li><li>  export - assigns the specified values ‚Äã‚Äãto the specified variables </li></ul><br><br>  Separately, you should pay attention to how to create files.  Why do we use the cat command, why can't we use our favorite console editor?  Well, well, while we are in the host system, a text editor is available to us.  But when we move to a temporary system, so we will not have any editor.  Therefore, you have to use the cat command, which redirects the output stream from one file to another.  The input file we have not specified - then the standard input stream will be used.  The output file is the file created by us, and the completion condition is the appearance in the input stream of the character sequence of the end of the file - EOF.  After entering the command, we will be able to type the text of the file being created directly in the terminal.  To terminate the process, enter the string EOF.  In this way, we turn the command shell into a primitive text editor. <br><br>  The created scripts will be executed at each login on behalf of lfs.  Update the user environment with the command <br><br><pre> <code class="hljs mel">[lfs@arch-guest ~]/$ <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> ~/.bash_profile</code> </pre><br><br>  Make sure the necessary environment variables are set. <br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">lfs@arch-guest~</span></span>]/$ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span></code> </pre><br><br><h1>  5. Build a temporary toolkit (Temporary System) </h1><br>  Starting to build the system, we are faced with the classic problem of "chicken and eggs."  To build the system we need a compiler, linker and library.  But we have none of the above, only their sources.  We have a compiler in the host system, and we‚Äôll begin to compile the necessary software.  However, if you simply build the same gcc with the default settings, it will not work in the LFS system at the initial stage of its construction - it uses the dynamic layout of the necessary libraries for the work.  All the code needed for operation will need to be statically linked, that is, explicitly included in the executable file. <br><br>  Thus, first of all, we will cross-compile some parts of the future system in order to be able to use them when building the final version. <br><br>  All work on building a temporary system is done in the $ LFS / sources directory, so we go there <br><br><pre> <code class="hljs ruby">[lfs@arch-guest ~]/$ cd $LFS/sources</code> </pre><br>  For all packages being assembled, the assembly order contains the following sequence of actions (unless otherwise specified!): <br><br><ul><li>  Unpack the archive with the package <br><pre> <code class="hljs vhdl">$ tar -pxf &lt;<span class="hljs-keyword"><span class="hljs-keyword">package</span></span>-archive-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>-name&gt;</code> </pre><br></li><li>  Go to the unpacked directory <br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> &lt;package-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>-name&gt;</code> </pre><br></li><li>  We carry out assembly instructions (each package has nuances described in detail in the documentation) <br></li><li>  Go to the directory above, back to $ LFS / source, and delete all created during unpacking and building directories <br></li></ul><br><br>  Packing time is different - from almost instant, to two and a half hours (the gcc build after ‚Äúchrut‚Äù with all the tests lasts about that).  Since the speed of computers is different, the relative unit, called the Standard Build Unit (SBU), is chosen as the unit of measure for the build time.  One SBU is equal to the build time of the binutils package, which is compiled the very first.  The duration of 1.0 SBU over time can be roughly estimated for your system, but more on that below, but for now <br><br>  <b>Recommendation</b> : do not collect the system in several streams.  If you have a multi-core processor, then the -j key will speed up the work, but later it may turn into a failure to pass some important tests and the unstable operation of the assembled software.  Build in one thread is not so long - much more time will be spent on raking up the problems accumulated by multithreaded assembly. <br><br>  We will not consider building each package ‚Äî there is the LFS book itself.  However, we will focus on some of the assembly‚Äôs nuances, considering compiling the most important packages. <br><br><h1>  6. Build Binutils - the first pass.  SBU measurement </h1><br>  Binutils is a package containing utility utilities for building software.  This includes the assembler (as) and linker (ld).  They are required by glibc and gcc to pass some tests, so this package is built first. <br><br>  Unpack the archive and go to the directory with its contents <br><br><pre> <code class="hljs ruby">$ tar -pxf binutils-<span class="hljs-number"><span class="hljs-number">2.25</span></span>.tar.bz2 $ cd binutils-<span class="hljs-number"><span class="hljs-number">2.25</span></span></code> </pre><br><br>  To build this package, it is recommended to create a separate directory, create it and go there. <br><br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> -v ../binutils-build $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../binutils-build</code> </pre><br><br>  Now you need to configure the package to generate the correct Makefile. <br><br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$ ../binutils-2.25/configure </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --prefix=/tools </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-sysroot=$</span></span>LFS <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --with-lib-path=/tools/lib <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --target=<span class="hljs-formula"><span class="hljs-formula">$LFS_TGT </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-nls </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-werror</span></span></code> </pre><br><br>  Special attention to the keys: <br><br><ul><li>  <i>--prefix = / tools</i> - indicates that the built packages will be installed in the / tools directory where the temporary system will be located <br></li><li>  <i>--with-sysroot = $ LFS</i> is the root directory of the system, relative to which libraries and other resources needed for running programs in the temporary system will be searched <br></li><li>  <i>--with-lib-path = / tools / lib</i> - the library search path specified for the ld linker <br></li><li>  <i>--target = $ LFS_TGT</i> - set the description of the target machine <br></li><li>  <i>--disable-nls</i> - disables the internationalization of collected packages.  At the moment, it is unnecessary, and its presence can cause a number of failures. <br></li><li>  <i>--disable-werror</i> - disables the compilation stop when receiving warnings from the host compiler <br></li></ul><br><br>  After running the configurator, we will get a Makefile at the output, intended for building and installing the package.  Build the package and measure the SBU <br><br><pre> <code class="hljs pgsql">$ <span class="hljs-type"><span class="hljs-type">time</span></span> { make; }</code> </pre><br>  Time is measured by the utility time {...}, which returns the execution time of commands enclosed in braces.  This will provide an opportunity to estimate SBU in order to have an idea about the build time of the remaining packages. <br><br>  <b>Note</b> : LFS recommends measuring build and installation configuration times.  But this recommendation is extensive.  The main time of the machine goes to make and tests.  In addition, other actions that you have to go into can be performed between make and make install.  So I made the decision to perform the assessment in the manner described above, taking into account the approximate nature of the measurement, which is still determined by the overall load of the system by other work. <br><br>    ‚Äî    4-  Intel Core i7 c 4096  ,       Intel Core i7-2600K (4   ) c 16   ‚Äî SBU  2  32      . <br><br>          SBU,          ,     (     gcc        ,     63 SBU ‚Äî       ) <br><br>     ,      .   ,    64-,        ,       . <br><br><pre> <code class="hljs ruby">$ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> $(uname -m) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &gt; x86_64) mkdir -v /tools/lib &amp;&amp; ln -sv lib /tools/lib64 ;; &gt; esac</code> </pre><br>     <br><br><pre> <code class="hljs sql">$ make <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre><br>        <br><br><pre> <code class="hljs ruby">$ cd .. $ rm -r binutils-<span class="hljs-number"><span class="hljs-number">2.25</span></span> $ rm -r binutils-build</code> </pre><br><br><h1> 7.  GCC ‚Äî   </h1><br>        .       ,     -.           ,       . <br><br> -          <br><br><pre> <code class="hljs ruby">$ tar -pxf gcc-<span class="hljs-number"><span class="hljs-number">4.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.tar.bz2 $ cd ../gcc-<span class="hljs-number"><span class="hljs-number">4.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><br>         : GMP, MPFR  MPC.          ,       gcc <br><br><pre> <code class="hljs ruby">$ tar -pxf ../gmp-<span class="hljs-number"><span class="hljs-number">6.0</span></span>.0a.tar.xz $ tar -pxf ../mpfr-<span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.tar.xz $ tar -pxf ../mpc-<span class="hljs-number"><span class="hljs-number">1.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.tar.gz $ mv -v gmp-<span class="hljs-number"><span class="hljs-number">6.0</span></span>.0a gmp $ mv -v mpfr-<span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> mpfr $ mv -v mpc-<span class="hljs-number"><span class="hljs-number">1.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> mpc</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, you will have to edit the gcc sources. The fact is that the search path for the linker ld in them is defined as for a normal working system. In our case, the linker is located in the / tools directory (it was compiled as part of binutils). Some of the macros should also refer to / tools, so we transform the sources using the monstrous command</font></font><br><br><pre> <code class="hljs ruby">$ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> \ &gt; $(find gcc/config -name linux64.h -o -name linux.h -o -name sysv4.h) &gt; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> &gt; cp -uv $file{,.orig} &gt; sed -e <span class="hljs-string"><span class="hljs-string">'s@/lib\(64\)\?\(32\)\?/ld@/tools&amp;@g'</span></span> \ &gt; -e <span class="hljs-string"><span class="hljs-string">'s@/usr@/tools@g'</span></span> $file.orig &gt; $file &gt; echo <span class="hljs-string"><span class="hljs-string">' &gt; #undef STANDARD_STARTFILE_PREFIX_1 &gt; #undef STANDARD_STARTFILE_PREFIX_2 &gt; #define STANDARD_STARTFILE_PREFIX_1 "/tools/lib/" &gt; #define STANDARD_STARTFILE_PREFIX_2 ""'</span></span> <span class="hljs-meta"><span class="hljs-meta">&gt;&gt; </span></span>$file &gt; touch $file.orig &gt; done</code> </pre><br> -‚Ä¶         .          inux64.h, linux.h, sysv4.h,       gcc/config.          *.orig (   ‚Äî          sed),          /tools     ld   /usr  /tools.           STANDARD_STARTFILE_PREFIX_1  STANDARD_STARTFILE_PREFIX_2, ,        .   touch         ,      -u  cp (  -    )        . <br><br><div class="spoiler"> <b class="spoiler_title">    sed   </b> <div class="spoiler_text"> sed ‚Äî   ,       ,   . <br><br>      LFS,      sed   ,           .         <br><br><ul><li>        "/",  sed      "@" <br></li><li>   "\(64\)\?"  "\(32\)\?"  sed-,      ,      ¬´64¬ª  ¬´32¬ª ‚Äî       . <br></li><li>  "&amp;" ,  /tools      (    "&amp;"    ) <br></li></ul><br><br>    's@/lib\(64\)\?\(32\)\?/ld@/tools&amp;@g'    ‚Äî   ,  "/lib", "/lib64"  "/lib32"      "/tools",   's@/usr@/tools@g' ‚Äî   ,  "/usr"     "/tools" <br><br></div></div><br>  ,    (   )     .      ,    .           ,        *nix-. <br><br>  : <br><br><pre> <code class="hljs matlab">$ sed -<span class="hljs-built_in"><span class="hljs-built_in">i</span></span> <span class="hljs-string"><span class="hljs-string">'/k prot/agcc_cv_libc_provides_ssp=yes'</span></span> gcc/configure</code> </pre><br>     ,           .         gcc   . <br><br>      <br><br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$ ../gcc-4.9.2/configure </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --target=$</span></span>LFS_TGT <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --prefix=/tools <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --with-sysroot=<span class="hljs-formula"><span class="hljs-formula">$LFS </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-newlib </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --without-headers </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-local-prefix=/tools </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-native-system-header-dir=/tools/include </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-nls </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-shared </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-multilib </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-decimal-float </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-threads </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libatomic </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libgomp </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libitm </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libquadmath </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libsanitizer </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libssp </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libvtv </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libcilkrts </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libstdc++-v3 </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --enable-languages=c,c++</span></span></code> </pre><br><br>    : <br><br><ul><li> <i>--with-newlib</i> ‚Äî    ,   libc ‚Äî      ,     <br></li><li> <i>--without-headers</i> ‚Äî     ,      <br></li><li> <i>--with-local-prefix=/tools</i> ‚Äî     GCC    .     /usr/local <br></li><li> <i>--with-native-system-header-dir=/tools/include</i> ‚Äî     <br></li><li> <i>--disable-shared</i> ‚Äî   ,        <br></li><li> <i>--disable-decimal-float, --disable-threads, --disable-libatomic, --disable-libgomp, --disable-libitm, --disable-libquadmath, --disable-libsanitizer, --disable-libssp, --disable-libvtv, --disable-libcilkrts, --disable-libstdc++-v3</i> ‚Äî         ‚Äî    ,   ,      C++   . <br></li><li> <i>--disable-multilib</i> ‚Äî    32-   64-  <br></li><li> <i>--enable-languages=c,c++</i> ‚Äî   C/C++ <br></li></ul><br><br>    ,      <br><pre> <code class="hljs ruby">$ make $ make install</code> </pre><br><br>      <br><pre> <code class="hljs ruby">$ cd .. $ rm -r gcc-build &amp;&amp; rm -r gcc-<span class="hljs-number"><span class="hljs-number">4.9</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br><h1> 8.      </h1><br>                LFS.     ‚Äî            ,        .        ,   ,  ,  . <br><br>           .   gcc   <br><br><ul><li>   Linux-3.19 ‚Äî   GLibc <br></li><li> Glibc-2.21 ‚Äî   C,   ,    ,  . <br><br>   Glibc      .           <br><br><pre> <code class="hljs ruby">$ echo <span class="hljs-string"><span class="hljs-string">'main(){}'</span></span> &gt; dummy.c $ $LFS_TGT-gcc dummy.c</code> </pre><br><br>              <br><br><pre> <code class="hljs cs">$ readelf -f a.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> | grep <span class="hljs-string"><span class="hljs-string">': /tools'</span></span></code> </pre><br>      : <br><br><pre> <code class="hljs json"> [Requesting program interpreter: /tools/lib64/ld-linux-x86<span class="hljs-number"><span class="hljs-number">-64.</span></span>so<span class="hljs-number"><span class="hljs-number">.2</span></span>]</code> </pre><br>       .      32- ,    64-,        . <br><br> ,    ,    <br><pre> <code class="hljs swift">$ rm -v dummy.<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> a.out</code> </pre><br></li><li> Libstdc++-4.9.2 ‚Äî   C++     g++ <br></li><li> Binutils-2.25 ‚Äî   ,      .          ,  ar (   binutils),  ,     CC, AR  RANLIB <br><br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$ CC=$</span></span>LFS_TGT-gcc <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; AR=<span class="hljs-formula"><span class="hljs-formula">$LFS_TGT-ar </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; RANLIB=$</span></span>LFS_TGT-ranlib <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt;../binutils-2.25/configure <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --prefix=/tools <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --disable-nls <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --disable-werror <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --with-lib-path=/tools/lib <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; --with-sysroot</code> </pre><br></li><li> GCC-4.9.2 ‚Äî  ,     <br><br><pre> <code class="hljs tex"><span class="hljs-formula"><span class="hljs-formula">$ CC=$</span></span>LFS_TGT-gcc <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; CXX=<span class="hljs-formula"><span class="hljs-formula">$LFS_TGT-g++ </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; AR=$</span></span>LFS_TGT-ar <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&gt; RANLIB=<span class="hljs-formula"><span class="hljs-formula">$LFS_TGT-ranlib </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; ../gcc-4.9.2/configure </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --prefix=/tools </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-local-prefix=/tools </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --with-native-system-header-dir=/tools/include </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --enable-languages=c,c++ </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libstdcxx-pch </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-multilib </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-bootstrap </span><span class="hljs-tag"><span class="hljs-formula"><span class="hljs-tag">\</span></span><span class="hljs-name"><span class="hljs-formula"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span></span><span class="hljs-formula">&gt; --disable-libgomp</span></span></code> </pre><br><br>    ,     ,         -.        <br><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$ </span></span>echo <span class="hljs-string"><span class="hljs-string">'main(){}'</span></span> &gt; dummy.c <span class="hljs-string"><span class="hljs-string">$ </span></span>cc dummy.c <span class="hljs-string"><span class="hljs-string">$ </span></span>readelf -l a.out | grep <span class="hljs-string"><span class="hljs-string">': /tools'</span></span> <span class="hljs-string"><span class="hljs-string">$ </span></span>[<span class="hljs-type"><span class="hljs-type">Requesting</span></span> program interpreter: /tools/lib64/ld-linux-x86<span class="hljs-number"><span class="hljs-number">-64.</span></span>so<span class="hljs-number"><span class="hljs-number">.2</span></span>] <span class="hljs-string"><span class="hljs-string">$ </span></span>rm -r dummy.c a.out</code> </pre><br><br></li><li> Tcl-8.6.3 ‚Äî    Tcl,     . <br></li><li> Expect-5.45 ‚Äî   ,    Tcl <br></li><li> DejaGNU-1.5.2 ‚Äî      <br></li><li> Check-0.9.14 ‚Äî    unit- C- <br></li><li> Ncurses-5.9 ‚Äî     UI,       (       Linux)      mc. <br></li><li> Bash-4.3.30 ‚Äî  .  No comments. <br></li><li> Bzip2-1.0.6 ‚Äî   bzip2. <br></li><li> Coreutils-8.23 ‚Äî     GNU-,    ,   cat, ls, rm    <br></li><li> Diffutils-3.3 ‚Äî      . <br></li><li> File-5.22 ‚Äî     . <br></li><li> Findutils-4.4.2 ‚Äî      .  , ,   find <br></li><li> Gawk-4.1.1 ‚Äî GNU-  awk ‚Äî          . <br></li><li> Gettext-0.19.4 ‚Äî     . <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grep-2.21 - text search utility in the input stream </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gzip-1.6 - another archiver </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M4-1.4.17 - the macro processor used by software configuration and build tools </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Make-4.1 - software automatic build utility </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Patch-2.7.4 - utility for working with source code patches </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perl-5.20.2 - Perl language interpreter </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sed-4.2.2 - Streaming Text Editor </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tar-1.28 - where do without it </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Texinfo-5.2 - utilities for working with info pages of documentation </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Util-linux-2.26 is the main linux utility package. </font><font style="vertical-align: inherit;">Contains, for example, mount</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Xz-5.2.0 is another archiver. </font></font><br></li></ul><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Trimming debug information </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After everything has been collected, it is recommended to save debugging information from the collected binaries to save space. </font><font style="vertical-align: inherit;">Make it teams</font></font><br><br><pre> <code class="hljs mel">$ <span class="hljs-keyword"><span class="hljs-keyword">strip</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">strip</span></span>-debug /tools/lib<span class="hljs-comment"><span class="hljs-comment">/* $ /usr/bin/strip --strip-unneeded /tools/{,s}bin/*</span></span></code> </pre><br><br>  ,         ‚Äî             <br><br><pre> <code class="hljs pgsql">$ rm -rf /tools/{,<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>}/{<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>,man,doc}</code> </pre><br><br><h1>  Total </h1><br>    ,    $LFS/tools  ,          GNU-   .      . <br><br>      ! <br><br>  <i><a href="http://habrahabr.ru/post/257941/">To be continued...</a></i> </div><p>Source: <a href="https://habr.com/ru/post/257663/">https://habr.com/ru/post/257663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257651/index.html">Announcement of the conference ThinkJava # 2</a></li>
<li><a href="../257653/index.html">Yii 2.0.4</a></li>
<li><a href="../257657/index.html">Game Exhibitions 2015</a></li>
<li><a href="../257659/index.html">OLED watch on arduino</a></li>
<li><a href="../257661/index.html">The digest of interesting materials for the mobile developer # 102 (on May 5-11)</a></li>
<li><a href="../257665/index.html">Classic notes for the new Opera</a></li>
<li><a href="../257667/index.html">IEnumerable interface in C # and LSP</a></li>
<li><a href="../257669/index.html">Redesign and promotion. Chicken and Egg Challenge</a></li>
<li><a href="../257671/index.html">Deploy web application with Fabric</a></li>
<li><a href="../257673/index.html">How 3CX solves security problems (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>