<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dlink switch study after thunderstorms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article you are currently reading is an extension of the article " Setting Access Level Switches in the Provider's Network ". I justify the correc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dlink switch study after thunderstorms</h1><div class="post__text post__text-html js-mediator-article"> The article you are currently reading is an extension of the article " <a href="https://habrahabr.ru/post/123038/">Setting Access Level Switches in the Provider's Network</a> ".  I justify the correctness of the approach of the author screens and their observations.  So, the photo of the test. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3c/290/05f/c3c29005fbc4dbf2313156736e107a55.jpg" alt="image"><br><br>  Just like in the DMB film, the plot is about the gopher: I also don‚Äôt see any cables, but there are links.  Switch settings reset to factory default <b>#reset system</b> command. <br><a name="habracut"></a><br>  For clarity, a few more screenshots: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/17c/849/0ca/17c8490ca9c225dca2d3fa88499f70e4.jpg" alt="dlink_1"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/137/4c1/bbe/1374c1bbe01bba3d863c69932fe6ce22.jpg" alt="dlink_2"><br><br>  The links have risen, the switch works, but how it is busy will tell us wireshark and see an amazing picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/391/3a7/1c8/3913a71c89e66333c59d071e30f7e8c3.jpg" alt="wireshark_1"><br><br>  The screenshot shows a large number of ARP packets that the switch itself generates, presumably as a result of the activity of the failed ports.  Based on this, we enable the Loop Detection function, the function is intended to form a switch tree using the STP protocol, but it also works when the STP is disabled: <br><br> <code>enable loopdetect <br> config loopdetect mode vlan-based <br> config loopdetect recover_timer 1800 <br> config loopdetect interval 10 <br> config loopdetect ports 1-9 state enable <br></code> <br>  Here is how the situation has changed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/cc5/8a3/56dcc58a331f4d3be2d67b9aed6812b4.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/00f/9bd/97b/00f9bd97b7805a5de12aeeb35fd0dfdc.jpg" alt="image"><br><br>  After applying the Loop Detection setting, a record is detected in the switch logs about the detected ring on the faulty port, the port itself goes into err-disabled mode, as can be seen in the screenshots attached above ( <b>mode vlan-based</b> allows you to configure ring detection on trunks, as a result only the traffic from the vlan in which the ring is detected, while the remaining vlans will work as normal). <br><br>  The type of traffic caught by wereshark has also changed.  Now we see a large number of dhcp requests (on the connected computer, the setting for automatically obtaining an IP address). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/762/ba9/2cf/762ba92cf2d1190e021ddd127dc2a4cb.jpg" alt="image"><br><br>  From this it follows that the situation with broadcast traffic has not changed.  This adversely affects the functioning of the network, as Broadcast packets are cloned by switches, and this leads to such a phenomenon as a broadcast storm.  Based on this, it was decided to limit the amount of broadcast traffic through a command (if the number of packets exceeds the level, then the packets are discarded): <br><br> <code>config traffic control 1-9 broadcast enable action drop threshold 64 countdown 5 time_interval 30 <br></code> <br>  In addition, we will forbid the switch to skip the DHCP request from all ports except Uplink.  In addition to restricting traffic, we get the ability to block subscriber dhcp-server Configuration example via CLI - ACL setting, which allows sending DHCP responses from port 10 and prohibiting from all other ports: <br><br> <code>create access_profile ip udp src_port_mask 0xFFFF profile_id 1 <br> config access_profile profile_id 1 add access_id 1 ip udp src_port 67 port 10 permit <br> config access_profile profile_id 1 add access_id 2 ip udp src_port 67 port 1-9 deny <br></code> <br><img src="https://habrastorage.org/getpro/habr/post_images/bc5/98d/f03/bc598df031d0297f5882a54d2864d400.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d97/a06/85a/d97a0685a864f3420f0905fa2d5f1e61.jpg" alt="image"><br><br><h5>  What was it all for, and what did you get as a result </h5><br>  So, after the configuration, we have normal traffic on the working port, small bursts of broadcast traffic, since the failed ports periodically turn on by timeout.  In addition, in the logs we get a line of the form ‚ÄúPort 1 VID 156 LBD recovered.  Loop detection restarted ‚Äù, and if necessary, <b>trap</b> to the monitoring server. <br><br>  All efforts will allow methodically working to eliminate the consequences of a thunderstorm in the conditions of a city network (replacement of switches).  As practice has shown (more than 5 years in a communications operator as a network administrator) Dlink DES3200-series loves thunderstorms very much. <br><br>  Thanks for taking the time to read.  Special thanks to colleagues for your comments and recommendations, as well as interest in this study. <br><br>  PS <br>  Cycle of articles <a href="https://habrahabr.ru/post/303128/">Constructive admin's laziness or how I have automated the config</a> whose purpose is to reduce the burden on all your favorite computer <a href="https://habrahabr.ru/post/303128/">users as</a> network administrator. </div><p>Source: <a href="https://habr.com/ru/post/303062/">https://habr.com/ru/post/303062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303046/index.html">Digest of gaming industry events for 2016</a></li>
<li><a href="../303050/index.html">DevOps - automate everything</a></li>
<li><a href="../303052/index.html">Oh, I have these databases: Sybase (ASE) and datetime</a></li>
<li><a href="../303058/index.html">Where to get logins or VoIP to help</a></li>
<li><a href="../303060/index.html">Virtual GPIO driver with QEMU-based ivshmem interrupt controller for Linux</a></li>
<li><a href="../303064/index.html">Creating an Android application or a project without a name</a></li>
<li><a href="../303066/index.html">DevConf :: Go - June 17 in Skolkovo, an exclusive workshop on Go June 18 in TASS</a></li>
<li><a href="../303068/index.html">Free webinar "WebLogic Application Server 12.2: multi-lending, high availability, Docker-containers"</a></li>
<li><a href="../303074/index.html">Investigation: where your site redirects users, and you don‚Äôt even know about it</a></li>
<li><a href="../303076/index.html">Seven notes of the deduction of the costs of your business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>