<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making Space Invaders on Love2d and Lua</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! Today we will make the classic game Space Invaders on the engine Love2d . For lovers of "code immediately" the final version of the game can...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making Space Invaders on Love2d and Lua</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/92a/03a/066/92a03a0667b54bf4aee39deb4ef5752d.png"><br><br>  Good day!  Today we will make the classic game Space Invaders on the engine <a href="https://love2d.org/">Love2d</a> .  For lovers of "code immediately" the final version of the game can be viewed on the <a href="https://github.com/vlfedotov/small_games/tree/games/space-invaders">githaba</a> .  Those who are interested in the development process, welcome under cat. <br><a name="habracut"></a><br>  Here I can not describe everything that is in the final version, it is not interesting and will make the article infinite.  I can say that in addition to what I‚Äôm going to figure out here, the game contains different modes (pause, loss, win), can display debug information (speed and number of objects, memory, etc.), the Player has lives and is being counted, there are different game levels (not complexity, but sequence).  All this can either be viewed in the code, or develop your own versions. <br><br>  So, <b>the work plan:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://habr.com/ru/post/328264/">Training</a> </li><li>  <a href="https://habr.com/ru/post/328264/">Add a player</a> </li><li>  <a href="https://habr.com/ru/post/328264/">Of enemies</a> </li><li>  <a href="https://habr.com/ru/post/328264/">Walls and collision handler</a> </li><li>  <a href="https://habr.com/ru/post/328264/">Teach the player to shoot</a> </li><li>  <a href="https://habr.com/ru/post/328264/">Attach graphics</a> </li></ul><br><a name="main"></a><h3>  Training </h3><br>  In the <em>main.lua</em> add calls to the main methods of love2d.  Each element or function that we will do later must be directly or indirectly associated with these methods, otherwise they will go unnoticed. <br><br><pre><code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keyreleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( key )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><a name="player"></a><h3>  Add a player </h3><br>  Add to the root of the project file <em>player.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> player = {} player.position_x = <span class="hljs-number"><span class="hljs-number">500</span></span> player.position_y = <span class="hljs-number"><span class="hljs-number">550</span></span> player.speed_x = <span class="hljs-number"><span class="hljs-number">300</span></span> player.width = <span class="hljs-number"><span class="hljs-number">50</span></span> player.height = <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">player.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.keyboard.isDown( <span class="hljs-string"><span class="hljs-string">"right"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> player.position_x &lt; ( love.graphics.getWidth() - player.width ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> player.position_x = player.position_x + ( player.speed_x * dt ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> love.keyboard.isDown( <span class="hljs-string"><span class="hljs-string">"left"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> player.position_x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> player.position_x = player.position_x - ( player.speed_x * dt ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">player.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> love.graphics.rectangle( <span class="hljs-string"><span class="hljs-string">"fill"</span></span>, player.position_x, player.position_y, player.width, player.height ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> player</code> </pre><br>  Also update <em>main.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> player = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'player'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> player.draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> player.update( dt ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  If you start the game, we will see a black screen with a white square at the bottom, which can be controlled with the left and right keys.  Moreover, he cannot go beyond the screen due to limitations in the Player‚Äôs code: <br><br><pre> <code class="lua hljs">player.position.x &lt; ( love.graphics.getWidth() - player.width ) player.position.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><a name="enemies"></a><h3>  Add enemies </h3><br>  Since we will fight against foreign invaders, we will call the <em>file</em> with them <em>invaders.lua</em> : <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> invaders = {} invaders.rows = <span class="hljs-number"><span class="hljs-number">5</span></span> invaders.columns = <span class="hljs-number"><span class="hljs-number">9</span></span> invaders.top_left_position_x = <span class="hljs-number"><span class="hljs-number">50</span></span> invaders.top_left_position_y = <span class="hljs-number"><span class="hljs-number">50</span></span> invaders.invader_width = <span class="hljs-number"><span class="hljs-number">40</span></span> invaders.invader_height = <span class="hljs-number"><span class="hljs-number">40</span></span> invaders.horizontal_distance = <span class="hljs-number"><span class="hljs-number">20</span></span> invaders.vertical_distance = <span class="hljs-number"><span class="hljs-number">30</span></span> invaders.current_speed_x = <span class="hljs-number"><span class="hljs-number">50</span></span> invaders.current_level_invaders = {} <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> initial_speed_x = <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> initial_direction = <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.new_invader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( position_x, position_y )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { position_x = position_x, position_y = position_y, width = invaders.invader_width, height = invaders.invader_height } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.new_row</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( row_index )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> row = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col_index=<span class="hljs-number"><span class="hljs-number">1</span></span>, invaders.columns - (row_index % <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_invader_position_x = invaders.top_left_position_x + invaders.invader_width * (row_index % <span class="hljs-number"><span class="hljs-number">2</span></span>) + (col_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (invaders.invader_width + invaders.horizontal_distance) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_invader_position_y = invaders.top_left_position_y + (row_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (invaders.invader_height + invaders.vertical_distance) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_invader = invaders.new_invader( new_invader_position_x, new_invader_position_y ) <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>( row, new_invader ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.construct_level</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> invaders.current_speed_x = initial_speed_x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row_index=<span class="hljs-number"><span class="hljs-number">1</span></span>, invaders.rows <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> invaders_row = invaders.new_row( row_index ) <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>( invaders.current_level_invaders, invaders_row ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.draw_invader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( single_invader )</span></span></span></span> love.graphics.rectangle(<span class="hljs-string"><span class="hljs-string">'line'</span></span>, single_invader.position_x, single_invader.position_y, single_invader.width, single_invader.height ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invader_row ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invaders.draw_invader( invader, is_miniboss ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.update_invader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt, single_invader )</span></span></span></span> single_invader.position_x = single_invader.position_x + invaders.current_speed_x * dt <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> invaders_rows = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invaders_rows = invaders_rows + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> invaders_rows == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.no_more_invaders = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invader_row ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invaders.update_invader( dt, invader ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> invaders</code> </pre><br>  Update <em>main.lua</em> <br><br><pre> <code class="lua hljs">... <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> invaders = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'invaders'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> invaders.construct_level() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... invaders.draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> ... invaders.update( dt ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  <em>love.load</em> is called at the very beginning of the application.  It calls the <em>invaders.construct_level</em> method, which creates the <em>invaders.current_level_invaders</em> table and fills it in rows and columns with separate <em>invader</em> objects, taking into account the height and width of objects, as well as the required distance between them horizontally and vertically.  It was necessary to complicate the <em>invaders.new_row</em> method a <em>little</em> to achieve the offset of even and odd rows.  If you replace the current design: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col_index=<span class="hljs-number"><span class="hljs-number">1</span></span>, invaders.columns - (row_index % <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_invader_position_x = invaders.top_left_position_x + invaders.invader_width * (row_index % <span class="hljs-number"><span class="hljs-number">2</span></span>) + (col_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (invaders.invader_width + invaders.horizontal_distance)</code> </pre><br>  like this: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col_index=<span class="hljs-number"><span class="hljs-number">1</span></span>, invaders.columns <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_invader_position_x = invaders.top_left_position_x + (col_index - <span class="hljs-number"><span class="hljs-number">1</span></span>) * (invaders.invader_width + invaders.horizontal_distance)</code> </pre><br>  then remove this effect and return the rectangular fill.  Comparison on pictures <br><table><tbody><tr><th>  Current option </th><th>  Rectangular option </th></tr><tr><td><img src="https://habrastorage.org/web/1e7/85e/166/1e785e16664545d8a3847a888da7fb32.png"></td><td><img src="https://habrastorage.org/web/17f/9e6/e92/17f9e6e92dcc468e808b9ec4ddefc24f.png"></td></tr></tbody></table><br>  The <em>invader</em> object is a table with properties: position_x, position_y, width, height.  All this is required to render the object, and later it will be required to check for collisions with shots. <br><br>  <em>love.draw</em> calls <em>invaders.draw</em> and <em>draws</em> all the objects in all rows of the <em>invaders.current_level_invaders</em> table. <br><br>  <em>love.update</em> , followed by <em>invaders.update</em> and update the current position of each invader, taking into account the current speed, which is so far only one - the original. <br><br>  The invaders have already begun to move, but for now just to the right, behind the screen.  We will fix that now. <br><a name="walls"></a><h3>  Add walls and collisions </h3><br>  New <em>walls.lua</em> file <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> walls = {} walls.wall_thickness = <span class="hljs-number"><span class="hljs-number">1</span></span> walls.bottom_height_gap = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span> * love.graphics.getHeight() walls.current_level_walls = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">walls.new_wall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( position_x, position_y, width, height )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { position_x = position_x, position_y = position_y, width = width, height = height } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">walls.construct_level</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> left_wall = walls.new_wall( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, walls.wall_thickness, love.graphics.getHeight() - walls.bottom_height_gap ) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> right_wall = walls.new_wall( love.graphics.getWidth() - walls.wall_thickness, <span class="hljs-number"><span class="hljs-number">0</span></span>, walls.wall_thickness, love.graphics.getHeight() - walls.bottom_height_gap ) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> top_wall = walls.new_wall( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, love.graphics.getWidth(), walls.wall_thickness ) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> bottom_wall = walls.new_wall( <span class="hljs-number"><span class="hljs-number">0</span></span>, love.graphics.getHeight() - walls.bottom_height_gap - walls.wall_thickness, love.graphics.getWidth(), walls.wall_thickness ) walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">"left"</span></span>] = left_wall walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">"right"</span></span>] = right_wall walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">"top"</span></span>] = top_wall walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">"bottom"</span></span>] = bottom_wall <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">walls.draw_wall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(wall)</span></span></span></span> love.graphics.rectangle( <span class="hljs-string"><span class="hljs-string">'line'</span></span>, wall.position_x, wall.position_y, wall.width, wall.height ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">walls.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, wall <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( walls.current_level_walls ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> walls.draw_wall( wall ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walls</code> </pre><br>  And a bit in <em>main.lua</em> <br><br><pre> <code class="lua hljs">... <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> walls = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'walls'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... walls.construct_level() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... <span class="hljs-comment"><span class="hljs-comment">-- walls.draw() end</span></span></code> </pre><br>  Similarly with the creation of invaders, the call <em>walls.construct_level</em> is responsible for creating the walls.  We only need walls for intercepting ‚Äúclashes‚Äù with invaders and shots, therefore we need to draw them unnecessarily.  But this may be necessary for debugging purposes, so the Walls object has a draw method, which is called standardly from <em>main.lua -&gt; love.draw</em> , but for the time being, debugging is not needed - it (the call) is commented out. <br><br>  Now we‚Äôll write a collision handler that I borrowed <a href="https://github.com/noooway/love2d_arkanoid_tutorial/wiki">from here</a> .  So, <em>collisions.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> collisions = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.check_rectangles_overlap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( a, b )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> overlap = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span>( ax + a.width &lt; bx <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> bx + b.width &lt; ax <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ay + a.height &lt; by <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> by + b.height &lt; ay ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> overlap = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.invaders_walls_collision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( invaders, walls )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> overlap, wall <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> invaders.current_speed_x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> wall, wall_type = walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">'right'</span></span>], <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> wall, wall_type = walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">'left'</span></span>], <span class="hljs-string"><span class="hljs-string">'left'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> a = { x = wall.position_x, y = wall.position_y, width = wall.width, height = wall.height } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invader_row ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> b = { x = invader.position_x, y = invader.position_y, width = invader.width, height = invader.height } overlap = collisions.check_rectangles_overlap( a, b ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> wall_type == invaders.allow_overlap_direction <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.current_speed_x = -invaders.current_speed_x <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> invaders.allow_overlap_direction == <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.allow_overlap_direction = <span class="hljs-string"><span class="hljs-string">'left'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> invaders.allow_overlap_direction = <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> invaders.descend_by_row() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.resolve_collisions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( invaders, walls )</span></span></span></span> collisions.invaders_walls_collision( invaders, walls ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collisions</code> </pre><br>  Add a couple of methods and a variable in <em>invaders.lua</em> <br><br><pre> <code class="lua hljs">invaders.allow_overlap_direction = <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.descend_by_row_invader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( single_invader )</span></span></span></span> single_invader.position_y = single_invader.position_y + invaders.vertical_distance / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.descend_by_row</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invader_row ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invaders.descend_by_row_invader( invader ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  And add a check for collisions in <em>main.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> collisions = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'collisions'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> ... collisions.resolve_collisions( invaders, walls ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now the invaders stumble on the wall of <em>collisions.invaders_walls_collision</em> and descend a little lower, and also change the speed to the opposite. <br><br>  It was necessary to introduce an additional test for equality of the type of the wall on which the invaders stumbled, and a variable in which the valid type is stored: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> wall_type == invaders.allow_overlap_direction <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ...</code> </pre><br>  due to the fact that all the invaders simultaneously stumble on the wall from the extreme column at the same time and the collision handler manages to ‚Äúfor everyone‚Äù and reduce the whole team by one row before the invaders turn around and come out of contact, as a result the armada descended immediately rows.  Here either to put some kind of block in the event of one collision for the next collision, or to arrange the invaders not exactly one under the other, either as done, or in some other way. <br><br><a name="bullets"></a><h3>  It's time for the player to learn how to shoot </h3><br>  New file and class <em>bullets.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> bullets = {} bullets.current_speed_y = <span class="hljs-number"><span class="hljs-number">-200</span></span> bullets.width = <span class="hljs-number"><span class="hljs-number">2</span></span> bullets.height = <span class="hljs-number"><span class="hljs-number">10</span></span> bullets.current_level_bullets = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.destroy_bullet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bullet_i )</span></span></span></span> bullets.current_level_bullets[bullet_i] = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.new_bullet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position_x, position_y)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { position_x = position_x, position_y = position_y, width = bullets.width, height = bullets.height } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.fire</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( player )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> position_x = player.position_x + player.width / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> position_y = player.position_y <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> new_bullet = bullets.new_bullet( position_x, position_y ) <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(bullets.current_level_bullets, new_bullet) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.draw_bullet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bullet )</span></span></span></span> love.graphics.rectangle( <span class="hljs-string"><span class="hljs-string">'fill'</span></span>, bullet.position_x, bullet.position_y, bullet.width, bullet.height ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, bullet <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(bullets.current_level_bullets) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> bullets.draw_bullet( bullet ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.update_bullet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt, bullet )</span></span></span></span> bullet.position_y = bullet.position_y + bullets.current_speed_y * dt <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bullets.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, bullet <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>(bullets.current_level_bullets) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> bullets.update_bullet( dt, bullet ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bullets</code> </pre><br>  Here the main method is <em>bullets.fire</em> .  We transfer the player to it, because  we want the bullet to fly out of it, which means we need to know its location.  Since  we don't have one patron, but a whole queue is possible, then we store it in the <em>bullets.current_level_bullets</em> table, we call the <em>draw</em> and <em>update</em> methods for it and for each patron.  The <em>bullets.destroy_bullet</em> method <em>is</em> needed in order to remove excess cartridges from memory when in contact with the invader or the ceiling. <br><br>  Add handling collisions bullet invader and bullet-ceiling. <br><br>  <em>collisions.lua</em> <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.invaders_bullets_collision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( invaders, bullets )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b_i, bullet <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( bullets.current_level_bullets) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> a = { x = bullet.position_x, y = bullet.position_y, width = bullet.width, height = bullet.height } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i_i, invader_row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i_j, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invader_row ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> b = { x = invader.position_x, y = invader.position_y, width = invader.width, height = invader.height } overlap = collisions.check_rectangles_overlap( a, b ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.destroy_invader( i_i, i_j ) bullets.destroy_bullet( b_i ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.bullets_walls_collision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( bullets, walls )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> wall = walls.current_level_walls[<span class="hljs-string"><span class="hljs-string">'top'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> a = { x = wall.position_x, y = wall.position_y, width = wall.width, height = wall.height } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b_i, bullet <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( bullets.current_level_bullets) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> b = { x = bullet.position_x, y = bullet.position_y, width = bullet.width, height = bullet.height } overlap = collisions.check_rectangles_overlap( a, b ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> overlap <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> bullets.destroy_bullet( b_i ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collisions.resolve_collisions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( invaders, walls, bullets )</span></span></span></span> ... collisions.invaders_bullets_collision( invaders, bullets ) collisions.bullets_walls_collision( bullets, walls ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  We will add a method to the invaders to destroy it, as well as to check for the presence of invaders in a specific row in the general table of invaders - if no one is left, then the row itself is deleted.  And also we increase the speed of the whole armada during the murder <br><br>  <em>invaders.lua</em> <br><pre> <code class="lua hljs">... invaders.speed_x_increase_on_destroying = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invaders.destroy_invader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( row, invader )</span></span></span></span> invaders.current_level_invaders[row][invader] = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> invaders_row_count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, invader <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pairs</span></span>( invaders.current_level_invaders[row] ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> invaders_row_count = invaders_row_count + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> invaders_row_count == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.current_level_invaders[row] = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> invaders.allow_overlap_direction == <span class="hljs-string"><span class="hljs-string">'right'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> invaders.current_speed_x = invaders.current_speed_x + invaders.speed_x_increase_on_destroying <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> invaders.current_speed_x = invaders.current_speed_x - invaders.speed_x_increase_on_destroying <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ...</code> </pre><br>  And update <em>mail.lua</em> : add a new class, send it to the collision handler, and hang up the shooting call on the Space key. <br><br><pre> <code class="lua hljs">... <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> bullets = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'bullets'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.keyreleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( key )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key == <span class="hljs-string"><span class="hljs-string">'space'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> bullets.fire( player ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... bullets.draw() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( dt )</span></span></span></span> ... collisions.resolve_collisions( invaders, walls, bullets ) bullets.update( dt ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Further work assumes modification of the existing code, therefore, what turned out at this stage is saved as <a href="https://github.com/vlfedotov/small_games/commit/21868d59adb3ea4dc358f2fecf0cc05548153410">version 0.5</a> . <br><br>  <b>NB</b> The code in the gita is different from the one discussed here.  Initially the <a href="https://github.com/vrld/hump">hump</a> library was used to work with vectors.  But then it became clear that it is quite possible to do without it, and in the final version I sawed out the library.  The code is equally working here and there, only, to run the code from the githab will have to initiate the submodules: <br><br><pre> <code class="bash hljs">git submodule update --init</code> </pre><br><a name="graphics"></a><h3>  Hanging texture </h3><br><img src="https://habrastorage.org/web/be4/392/9c1/be43929c136d4c08955a23d847cf6dda.png"><br>  These are three standard enemies, plus one mini-boss, whose device will not be considered here, but it is in the final <a href="https://github.com/vlfedotov/small_games/tree/games/space-invaders">version</a> .  And the player himself is a tank. <br><br>  Textures for the game kindly provided <a href="https://www.artstation.com/artist/annnushkkka">annnushkkka</a> . <br><br>  All images will be in the <em>images</em> directory in the project root.  Change Player in <em>player.lua</em> <br><br><pre> <code class="lua hljs">... player.image = love.graphics.newImage(<span class="hljs-string"><span class="hljs-string">'images/Hero.png'</span></span>) <span class="hljs-comment"><span class="hljs-comment">-- from https://love2d.org/forums/viewtopic.php?t=79756 function getImageScaleForNewDimensions( image, newWidth, newHeight ) local currentWidth, currentHeight = image:getDimensions() return ( newWidth / currentWidth ), ( newHeight / currentHeight ) end local scaleX, scaleY = getImageScaleForNewDimensions( player.image, player.width, player.height ) function player.draw() --   love.graphics.draw(player.image, player.position_x, player.position_y, rotation, scaleX, scaleY ) end ...</span></span></code> </pre><br>  The getImageScaleForNewDimensions function, peeking <a href="https://love2d.org/forums/viewtopic.php%3Ft%3D79756">from here</a> , fits the image to the dimensions we specified in <em>player.width, player.height</em> .  It is used here and for enemies, later we will move it into a separate <em>utils.lua</em> module.  The <em>player.draw</em> function <em>is</em> replaceable. <br><br>  When starting a former square player now - tank! <br><br>  We change enemies <em>invaders.lua</em> <br><br><pre> <code class="lua hljs">... invaders.images = {love.graphics.newImage(<span class="hljs-string"><span class="hljs-string">'images/bad_1.png'</span></span>), love.graphics.newImage(<span class="hljs-string"><span class="hljs-string">'images/bad_2.png'</span></span>), love.graphics.newImage(<span class="hljs-string"><span class="hljs-string">'images/bad_3.png'</span></span>) } <span class="hljs-comment"><span class="hljs-comment">-- from https://love2d.org/forums/viewtopic.php?t=79756 function getImageScaleForNewDimensions( image, newWidth, newHeight ) local currentWidth, currentHeight = image:getDimensions() return ( newWidth / currentWidth ), ( newHeight / currentHeight ) end local scaleX, scaleY = getImageScaleForNewDimensions( invaders.images[1], invaders.invader_width, invaders.invader_height ) function invaders.new_invader(position_x, position_y ) --  local invader_image_no = math.random(1, #invaders.images) invader_image = invaders.images[invader_image_no] return ({position_x = position_x, position_y = position_y, width = invaders.invader_width, height = invaders.invader_height, image = invader_image}) end function invaders.draw_invader( single_invader ) --  love.graphics.draw(single_invader.image, single_invader.position_x, single_invader.position_y, rotation, scaleX, scaleY ) end</span></span></code> </pre><br>  Add pictures of the enemies in the table and adjust the size via getImageScaleForNewDimensions.  When creating a new invader, a random image from our table of images is assigned to it in the image attribute.  And we change the rendering method itself. <br><br>  This is what happened: <br><br><img src="https://habrastorage.org/web/399/282/0aa/3992820aa7eb489695770c7f7383096f.png"><br><br>  If you start the game several times, you can see that the random combination of enemies is the same every time.  To avoid this, you must define <em>math.randomseed</em> before starting the game.  It‚Äôs good to do this by passing os.time as an argument.  Add this to <em>main.lua</em> <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">love.load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">randomseed</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>() ) ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now we have an almost full-fledged game, <a href="https://github.com/vlfedotov/small_games/commit/7d282a061cb77e07e05e91eb3ae8966bfa6808f8">version 0.75</a> .  Dismantled everything that was planned. <br><br>  I will be glad to feedback, comments, tips! </div><p>Source: <a href="https://habr.com/ru/post/328264/">https://habr.com/ru/post/328264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328246/index.html">Ethereum smart contracts: we structure tokens as stocks</a></li>
<li><a href="../328248/index.html">We write a script to synchronize folders with Google Drive, plus learn to use the Google Drive API</a></li>
<li><a href="../328250/index.html">5 of the "hottest" non-fiction novelties for March-April 2017</a></li>
<li><a href="../328252/index.html">How do we save half a million rubles a month with Slack</a></li>
<li><a href="../328256/index.html">DevOps in Enterprise and Finance. Is there life on Mars</a></li>
<li><a href="../328266/index.html">As I wrote my logger. Debriefing</a></li>
<li><a href="../328268/index.html">How to create a truly popular museum application on the example of "Weapons of Heroes." Victory Day is dedicated</a></li>
<li><a href="../328270/index.html">Podcast "Rules of the Game": accounting subtleties for technological (and other) business</a></li>
<li><a href="../328272/index.html">How softrender wrote yes the game wrote</a></li>
<li><a href="../328276/index.html">We do deface site using XSS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>