<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kalman filter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the Internet, including on Habr√©, you can find a lot of information about the Kalman filter. But it is hard to find an easily digestible conclusion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kalman filter</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/445/357/969/4453579698b1cecdc820557b719a4f54.png"><br><br>  On the Internet, including on Habr√©, you can find a lot of information about the Kalman filter.  But it is hard to find an easily digestible conclusion of the formulas themselves.  Without conclusion, all this science is perceived as a kind of shamanism, formulas look like a faceless set of symbols, and most importantly, many simple statements lying on the surface of the theory are beyond comprehension.  The purpose of this article will be to tell about this filter in the most accessible language. <br>  Kalman Filter is the most powerful data filtering tool.  Its main principle is that when filtering information is used on the physics of the phenomenon itself.  For example, if you are filtering data from the machine‚Äôs speedometer, the inertia of the machine gives you the right to perceive too fast speed jumps as a measurement error.  The Kalman filter is interesting because in some sense this is the best filter.  We will discuss in more detail below what exactly the words ‚Äúthe best‚Äù mean.  At the end of the article I will show that in many cases the formulas can be simplified to such an extent that almost nothing will remain of them. <br><a name="habracut"></a><br><h1>  Likbez </h1><br>  Before getting acquainted with the Kalman filter, I propose to recall some simple definitions and facts from probability theory. <br><br><h4>  Random value </h4><br>  When they say that a random variable is given <img src="https://habrastorage.org/files/38e/951/31e/38e95131ebb2473681f7332164b6eb2d.png">  , they mean that this value can take random values.  It takes different values ‚Äã‚Äãwith different probabilities.  When you roll, say, a bone, a discrete set of values ‚Äã‚Äãwill appear: <img src="https://habrastorage.org/files/18b/c01/826/18bc018265184c7e89b33daaa8482102.latex">  .  When it comes to, for example, the speed of a wandering particle, then, obviously, we have to deal with a continuous set of values.  "Fallen" values ‚Äã‚Äãof a random variable <img src="https://habrastorage.org/files/6ab/5a8/5c8/6ab5a85c879d406fba1093ac7dd8983d.latex">  we will denote by <img src="https://habrastorage.org/files/4bd/a90/84b/4bda9084b3dc4af99901f4ab81ce1572.latex">  but sometimes, we will use the same letter, which we denote a random variable: <img src="https://habrastorage.org/files/c22/f86/adb/c22f86adbb7e4c0591b3f78bd96cca8c.latex"><br>  In the case of a continuous set of values, a random variable characterizes the probability density <img src="https://habrastorage.org/files/06a/c34/f60/06ac34f60e20426f86d0eb5d29961b70.latex">  which dictates to us that the probability that a random variable ‚Äúfalls out‚Äù in a small neighborhood of a point <img src="https://habrastorage.org/files/ccf/876/992/ccf87699299a441a8d6cb877177213bb.latex">  long <img src="https://habrastorage.org/files/be7/907/21e/be790721e642458aa992e47c8a1cd665.latex">  equals <img src="https://habrastorage.org/files/e1f/1c6/c61/e1f1c6c610eb46fbbb584c6905129004.latex">  .  As we see from the picture, this probability is equal to the area of ‚Äã‚Äãthe shaded rectangle under the graph: <br><img src="https://habrastorage.org/storage2/ebd/c38/dbe/ebdc38dbe927cc6c0025a6479f8ec788.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Quite often in life, random variables are distributed in Gauss, when the probability density is <img src="https://habrastorage.org/files/f31/9fc/399/f319fc39951a432a9a0edc55a8d8c930.latex">  . <br><img src="https://habrastorage.org/storage2/08c/916/ab6/08c916ab6f5a376224903717302fbbce.png"><br>  We see that function <img src="https://habrastorage.org/files/06a/c34/f60/06ac34f60e20426f86d0eb5d29961b70.latex">  has a bell shape with a center at <img src="https://habrastorage.org/files/5ad/5f9/524/5ad5f95247a84cbe979943518cedb032.latex">  and with a characteristic width of the order <img src="https://habrastorage.org/files/576/8e4/c05/5768e4c05f7b4f739d4e5b8e3846847e.latex">  . <br>  Once we started talking about the Gaussian distribution, it would be a sin not to mention where it came from.  As well as numbers <img src="https://habrastorage.org/files/b8f/43a/388/b8f43a388ca146388605484af2c4d421.latex">  and <img src="https://habrastorage.org/files/f22/16f/0de/f2216f0dedc146029d6a8a56ea1c0367.latex">  firmly established in mathematics and are found in the most unexpected places, so the Gauss distribution took deep roots in probability theory.  One remarkable statement partially explaining Gaussian omnipresence is as follows: <br>  Let there be a random variable <img src="https://habrastorage.org/files/13c/454/6a2/13c4546a2de34c318e61a1aa92045599.latex">  having an arbitrary distribution (in fact, there are some restrictions on this arbitrariness, but they are not at all rigid).  Will hold <img src="https://habrastorage.org/files/e8f/8e9/367/e8f8e93675f540e9b6626875fea9a6cd.latex">  experiments and calculate the amount <img src="https://habrastorage.org/files/c93/2ad/ada/c932adada7c1406182c9304d35424036.latex">  "Dropped" values ‚Äã‚Äãof a random variable.  We will do a lot of such experiments.  It is clear that each time we will receive a different value of the amount.  In other words, this sum is in itself a random variable with its own specific distribution law.  It turns out that with sufficiently large <img src="https://habrastorage.org/files/e8f/8e9/367/e8f8e93675f540e9b6626875fea9a6cd.latex">  the distribution law of this sum tends to the Gaussian distribution (by the way, the characteristic width of the "bell" grows as <img src="https://habrastorage.org/files/753/353/b07/753353b07abb4996bf3e54a5769ad806.latex">  ).  We read in more detail in Wikipedia: the <a href="http://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B5%25D0%25BD%25D1%2582%25D1%2580%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0">central limit theorem</a> .  In life, very often there are quantities that are made up of a large number of equally distributed independent random variables, and therefore distributed according to Gauss. <br><br><h4>  Average value </h4><br>  The average value of a random variable is what we will get in the limit if we carry out a lot of experiments and calculate the arithmetic average of the values ‚Äã‚Äãthat have been dropped.  Mean value is denoted differently: mathematicians like to denote by <img src="https://habrastorage.org/files/acf/9f8/28b/acf9f828bf144a02ba787ec0055b2fbe.latex">  (mathematical expectation or mean value), and foreign mathematics through <img src="https://habrastorage.org/files/66b/557/db2/66b557db20284c91a2c6d7e620591490.latex">  (expectation).  Physics through <img src="https://habrastorage.org/files/06d/3ea/102/06d3ea102a394cad9b6b97407aab549d.latex">  or <img src="https://habrastorage.org/files/e0f/2f3/d28/e0f2f3d285b1407bab53054944c5ecd2.latex">  .  We will designate in a foreign way: <img src="https://habrastorage.org/files/66b/557/db2/66b557db20284c91a2c6d7e620591490.latex">  . <br>  For example, for Gaussian distribution <img src="https://habrastorage.org/files/f31/9fc/399/f319fc39951a432a9a0edc55a8d8c930.latex">  , the average value is <img src="https://habrastorage.org/files/5ad/5f9/524/5ad5f95247a84cbe979943518cedb032.latex">  . <br><br><h4>  Dispersion </h4><br>  In the case of the Gauss distribution, we clearly see that the random variable prefers to fall out in a certain neighborhood of its mean value. <img src="https://habrastorage.org/files/5ad/5f9/524/5ad5f95247a84cbe979943518cedb032.latex">  . <br><br><div class="spoiler">  <b class="spoiler_title">Once again admire the Gaussian distribution</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/08c/916/ab6/08c916ab6f5a376224903717302fbbce.png"><br></div></div><br>  As can be seen from the graph, the characteristic variation of the values ‚Äã‚Äãof the order <img src="https://habrastorage.org/files/576/8e4/c05/5768e4c05f7b4f739d4e5b8e3846847e.latex">  .  How to estimate this spread of values ‚Äã‚Äãfor an arbitrary random variable, if we know its distribution.  You can draw a graph of its probability density and estimate the characteristic width per eye.  But we prefer to go algebraically.  You can find the average length (modulus) of deviations from the mean: <img src="https://habrastorage.org/files/774/aad/1f1/774aad1f18df4142a91d5c040d1dc825.latex">  .  This value will be a good estimate of the characteristic variation of values. <img src="https://habrastorage.org/files/6ab/5a8/5c8/6ab5a85c879d406fba1093ac7dd8983d.latex">  .  But we all know very well that the use of modules in formulas is one headache, so this formula is rarely used to estimate the characteristic spread. <br>  An easier way (simpler in terms of calculations) is to find <img src="https://habrastorage.org/files/3cc/886/8b2/3cc8868b2a194d81a63d39ec554c8cd5.latex">  .  This value is called the variance, and is often referred to as <img src="https://habrastorage.org/files/36d/86e/f6d/36d86ef6d43549ca832bb2f449933ea7.latex">  .  The root of the variance is a good estimate of the spread of the random variable.  The root of the variance is also called the standard deviation. <br>  For example, for the Gaussian distribution <img src="https://habrastorage.org/files/86f/bc5/3ba/86fbc53ba7f54ec5bf29fb606f59ae66.latex">  it is possible to calculate that the variance determined above <img src="https://habrastorage.org/files/36d/86e/f6d/36d86ef6d43549ca832bb2f449933ea7.latex">  exactly equal to <img src="https://habrastorage.org/files/d51/e05/017/d51e0501780e4a0a934070506204a09f.latex">  and therefore the standard deviation is <img src="https://habrastorage.org/files/576/8e4/c05/5768e4c05f7b4f739d4e5b8e3846847e.latex">  , which agrees very well with our geometrical intuition. <br>  In fact, there is a small fraud.  The fact is that in the definition of a Gaussian distribution, under the exponent is the expression <img src="https://habrastorage.org/files/d7b/241/377/d7b241377db7433eac7cbffe6d5f4ca8.latex">  .  This deuce in the denominator is precisely to ensure that the standard deviation <img src="https://habrastorage.org/files/442/353/b3a/442353b3ae794e218b7c0e17b39db9cf.latex">  would be equal to the coefficient <img src="https://habrastorage.org/files/576/8e4/c05/5768e4c05f7b4f739d4e5b8e3846847e.latex">  .  That is, the Gaussian distribution formula itself is written in a form specially tailored for the fact that we will consider its standard deviation. <br><br><h4>  Independent random variables </h4><br>  Random variables are dependent and not.  Imagine that you are throwing a needle on a plane and recording the coordinates of its both ends.  These two coordinates are dependent, they are connected by the condition that the distance between them is always equal to the length of the needle, although they are random variables. <br>  Random variables are independent if the result of the fallout of the first one is completely independent of the result of the fallout of the second one.  If random values <img src="https://habrastorage.org/files/527/c8a/203/527c8a203fee4172a98a45ab96fc6c24.latex">  and <img src="https://habrastorage.org/files/aa7/7c4/481/aa77c44815f14b6bba37d3636f493ffe.latex">  are independent, then the average value of their product is equal to the product of their average values: <br><br><img src="https://habrastorage.org/files/878/7d4/acf/8787d4acfe324a9b839810be0321335b.latex"><br><br><div class="spoiler">  <b class="spoiler_title">Evidence</b> <div class="spoiler_text">  For example, having blue eyes and graduating from school with a gold medal is independent random values.  If the blue-eyed, say <img src="https://habrastorage.org/files/dea/5e4/851/dea5e4851a50408c9cf1ccc8feeca7f3.latex">  and gold medalists <img src="https://habrastorage.org/files/a26/46e/f43/a2646ef43af64a68932a64de2d88a8d2.latex">  the blue eyed medalists <img src="https://habrastorage.org/files/bc9/6a7/de4/bc96a7de44504cdaa2283a79929621ba.latex">  This example tells us that if random variables <img src="https://habrastorage.org/files/527/c8a/203/527c8a203fee4172a98a45ab96fc6c24.latex">  and <img src="https://habrastorage.org/files/527/c8a/203/527c8a203fee4172a98a45ab96fc6c24.latex">  given by their probability densities <img src="https://habrastorage.org/files/293/3c7/dd0/2933c7dd04b04b2ca3ea46026e3b552f.latex">  and <img src="https://habrastorage.org/files/0bd/1fe/95f/0bd1fe95f55048cc8135175d7656873d.latex">  , the independence of these quantities is expressed in the fact that the probability density <img src="https://habrastorage.org/files/efd/ae7/a35/efdae7a350664bbe83c322bac99d6dbe.latex">  (the first value fell <img src="https://habrastorage.org/files/ccf/876/992/ccf87699299a441a8d6cb877177213bb.latex">  and the second <img src="https://habrastorage.org/files/4f3/2ad/042/4f32ad042f97474c8715bcf506413a02.latex">  ) is according to the formula: <br><img src="https://habrastorage.org/files/223/021/086/2230210866d045afbffea0724b72b44d.latex"><br>  It immediately follows that: <br><img src="https://habrastorage.org/files/192/0e4/43b/1920e443b97744e8835a88821fbf5fcd.latex"><br>  As you can see, the proof is carried out for random variables that have a continuous spectrum of values ‚Äã‚Äãand are given by their probability density.  In other cases, the idea of ‚Äã‚Äãproof is similar. <br></div></div><br><h1>  Kalman filter </h1><br><h4>  Formulation of the problem </h4><br>  Denote by <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  the value that we will measure, and then filter.  This may be a coordinate, speed, acceleration, humidity, stink degree, temperature, pressure, etc. <br>  Let's start with a simple example that will lead us to the formulation of a common task.  Imagine that we have a radio-controlled machine that can only go back and forth.  Knowing the weight of the car, the shape, the road surface, etc., we calculated how the control joystick affects the speed of movement. <img src="https://habrastorage.org/files/ffd/ba2/458/ffdba2458ef442a98fe5695b0576f5da.latex">  . <br><br><img src="https://habrastorage.org/storage2/f3b/ac3/09c/f3bac309c4975ab560e4fd36a75349e9.png"><br><br>  Then the coordinate of the machine will change according to the law: <br><br><img src="https://habrastorage.org/files/9c1/9b9/1a2/9c19b91a2694405a81ac88a5cec06747.latex"><br><br>  In real life, we cannot take into account in our calculations the small perturbations acting on the car (wind, bumps, pebbles on the road), therefore the real speed of the car will differ from the calculated one.  A random variable will be added to the right side of the written equation. <img src="https://habrastorage.org/files/a3b/108/fb9/a3b108fb960448688ae2e69241fd13e1.latex">  : <br><br><img src="https://habrastorage.org/files/524/d2b/e67/524d2be673af47ef9465efcb620ad3ed.latex"><br><br>  We have a GPS-mounted sensor that tries to measure the true coordinate <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  cars, and, of course, can not measure it accurately, and measures with an error <img src="https://habrastorage.org/files/8c7/086/510/8c70865105984ca480ce6a38992ded10.latex">  which is also a random variable.  As a result, we get erroneous data from the sensor: <br><br><img src="https://habrastorage.org/files/567/852/13d/56785213d603422b9f57aeebc37b5473.latex"><br><br>  The challenge is that, knowing the wrong sensor readings <img src="https://habrastorage.org/files/db3/300/5bd/db33005bd69349668d6c6c0b23405442.latex">  , find a good approximation for the true coordinates of the machine <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  .  This is a good approximation we will denote as <img src="https://habrastorage.org/files/6c1/8ed/626/6c18ed6268f9482d8d896956fd70f15f.latex">  . <br>  In the formulation of the general problem, for the coordinate <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  can answer anything (temperature, humidity ...), and the member responsible for controlling the system from the outside, we denote <img src="https://habrastorage.org/files/852/9dc/888/8529dc8882cc4203a81a1a03abb2e675.latex">  (in the example with the machine <img src="https://habrastorage.org/files/83b/6f7/988/83b6f79883fb430d8ddd572fd20097e7.latex">  ).  The equations for the coordinates and sensor readings will look like this: <br><br><img src="https://habrastorage.org/storage2/6b9/e56/29f/6b9e5629f1d2bb9c868b600483d8f8e9.png">  (one) <br><br>  Let's discuss in detail what we know: <br><br><ul><li><img src="https://habrastorage.org/files/852/9dc/888/8529dc8882cc4203a81a1a03abb2e675.latex">  - This is a known value that controls the evolution of the system.  We know it from the physical model we built. <br></li><li>  Model error <img src="https://habrastorage.org/files/a3b/108/fb9/a3b108fb960448688ae2e69241fd13e1.latex">  and sensor error <img src="https://habrastorage.org/files/8c7/086/510/8c70865105984ca480ce6a38992ded10.latex">  - random variables.  And their distribution laws do not depend on time (on the iteration number <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  ). <br></li><li>  The mean values ‚Äã‚Äãof the errors are zero: <img src="https://habrastorage.org/files/ca7/d40/3fe/ca7d403fee4c48b08c49815b6cb7c89b.latex">  . <br></li><li>  The very law of the distribution of random variables may not be known to us, but their variances are known. <img src="https://habrastorage.org/files/36d/86e/f6d/36d86ef6d43549ca832bb2f449933ea7.latex">  and <img src="https://habrastorage.org/files/8ce/c40/9e5/8cec409e55554bf2976886cf50a0ab0c.latex">  .  Note that dispersions are independent of <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  because the distribution laws are independent of it. <br></li><li>  It is assumed that all random errors are independent of each other: what error will be at the moment of time <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  completely independent of the error at another point in time <img src="https://habrastorage.org/files/b8d/dd0/9f9/b8ddd09f941e4849af4fcaef58ab5399.latex">  . <br></li></ul><br>  It is worth noting that the filtering task is not a smoothing task.  We do not strive to smooth the data from the sensor, we strive to get the closest value to the real coordinate <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  . <br><br><h4>  Kalman algorithm </h4><br>  We will reason by induction.  Imagine that on <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  step, we have already found the filtered value from the sensor <img src="https://habrastorage.org/files/6c1/8ed/626/6c18ed6268f9482d8d896956fd70f15f.latex">  which brings the true coordinate of the system well <img src="https://habrastorage.org/files/4be/a33/278/4bea3327807f4cf79cf86660f186fc4a.latex">  .  Do not forget that we know the equation controlling the change in the unknown coordinate to us: <br><br><img src="https://habrastorage.org/files/1fb/bd3/e0f/1fbbd3e0f8294c33acd47d37fa5737b5.latex"><br><br>  therefore, without yet getting the value from the sensor, we can assume that in step <img src="https://habrastorage.org/files/0b6/770/8d4/0b67708d4b604261a20b6a77365ee2e2.latex">  the system evolves according to this law and the sensor will show something close to <img src="https://habrastorage.org/files/9ee/e09/093/9eee0909340b4beaa9014efcac6c0090.latex">  .  Unfortunately, while we can not say anything more accurate.  On the other hand, on the move <img src="https://habrastorage.org/files/0b6/770/8d4/0b67708d4b604261a20b6a77365ee2e2.latex">  we will have an inaccurate sensor reading <img src="https://habrastorage.org/files/bbd/951/eb9/bbd951eb93d442b69310be390834d58c.latex">  . <br>  The idea of ‚Äã‚ÄãKalman is that in order to get the best approximation to the true coordinate <img src="https://habrastorage.org/files/451/592/1d1/4515921d1650413389d38f295f400694.latex">  , we have to choose the middle ground between reading <img src="https://habrastorage.org/files/bbd/951/eb9/bbd951eb93d442b69310be390834d58c.latex">  inaccurate sensor and <img src="https://habrastorage.org/files/9ee/e09/093/9eee0909340b4beaa9014efcac6c0090.latex">  - our prediction of what we expected to see from him.  The sensor reading we give weight <img src="https://habrastorage.org/files/736/a9b/9b8/736a9b9b824848e78424d81c53001e9f.latex">  and the predicted value will be weight <img src="https://habrastorage.org/files/f35/a97/00e/f35a9700eeaa4c73ab95bdf131018bb7.latex">  : <br><br><img src="https://habrastorage.org/files/e50/2ba/fb1/e502bafb10244f20bf7ea475e9606523.latex"><br><br>  Coefficient <img src="https://habrastorage.org/files/45f/c7c/e04/45fc7ce045b0457ebce0da4919fc3c5b.latex">  called the Kalman coefficient.  It depends on the iteration step, so it would be better to write <img src="https://habrastorage.org/files/118/f49/3de/118f493de3584cf0a2d4c771ed5e9c49.latex">  , but for now, in order not to overload the calculation formulas, we will omit its index. <br>  We must choose the Kalman coefficient <img src="https://habrastorage.org/files/45f/c7c/e04/45fc7ce045b0457ebce0da4919fc3c5b.latex">  so that the resulting optimal value of the coordinate <img src="https://habrastorage.org/files/39e/df2/cca/39edf2cca16741e8ba860e6ed0322b6b.latex">  would be closest to the true coordinate <img src="https://habrastorage.org/files/451/592/1d1/4515921d1650413389d38f295f400694.latex">  .  For example, if we know that our sensor is very accurate, then we will trust its readings more and give the value <img src="https://habrastorage.org/files/bbd/951/eb9/bbd951eb93d442b69310be390834d58c.latex">  more weight ( <img src="https://habrastorage.org/files/45f/c7c/e04/45fc7ce045b0457ebce0da4919fc3c5b.latex">  close to one).  If the sensor, on the contrary, is not at all accurate, then we will focus more on the theoretically predicted value. <img src="https://habrastorage.org/files/9ee/e09/093/9eee0909340b4beaa9014efcac6c0090.latex">  . <br>  In general, to find the exact value of the Kalman coefficient <img src="https://habrastorage.org/files/45f/c7c/e04/45fc7ce045b0457ebce0da4919fc3c5b.latex">  you just need to minimize the error: <br><br><img src="https://habrastorage.org/files/4b3/f73/52a/4b3f7352ae0d441dadc6cdf91911f098.latex"><br><br>  Use equations (1) (those that are on a blue background in a frame) to rewrite the expression for the error: <br><br><img src="https://habrastorage.org/files/5e0/a53/b6b/5e0a53b6b0fa4f96b67b1026ce18f519.latex"><br><br><div class="spoiler">  <b class="spoiler_title">Evidence</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b29/d64/00f/b29d6400fc104651940156ef1bf86e42.latex"><br></div></div><br>  Now it's time to discuss what the expression means to minimize the error?  After all, the error, as we see, is in itself a random variable and each time takes on different values.  In fact, there is no unambiguous approach to determining what the error means is minimal.  Just as in the case of the variance of a random variable, when we tried to estimate the characteristic width of its spread, so here we will choose the most simple criterion for calculations.  We will minimize the average of the squared error: <br><br><img src="https://habrastorage.org/files/d5b/99f/35b/d5b99f35bf4a4aca9c14e0f0fb092103.latex"><br><br>  Let's write the last expression: <br><br><img src="https://habrastorage.org/files/7a0/835/ffb/7a0835ffb3c64dda951e0fafe2cf80bb.latex"><br><br><div class="spoiler">  <b class="spoiler_title">key to proof</b> <div class="spoiler_text">  From the fact that all random variables in the expression for <img src="https://habrastorage.org/files/798/4b7/2d7/7984b72d7e5d4272a5f3761a69928e9a.latex">  , independent and average values ‚Äã‚Äãof sensor errors and models are zero: <img src="https://habrastorage.org/files/1b4/452/af1/1b4452af15144baeb416490ef196fd57.latex">  , it follows that all "cross" members are equal to zero: <br><img src="https://habrastorage.org/files/5ec/67c/7c7/5ec67c7c7f17459a84907c40c2412bdb.latex">  . <br>  Plus, the formulas for dispersions look much simpler: <img src="https://habrastorage.org/files/e24/ecf/7b6/e24ecf7b6d234342b43048ac3415d5f5.latex">  and <img src="https://habrastorage.org/files/731/1e6/a63/7311e6a635fa423197bdc568b0bb386f.latex">  (because <img src="https://habrastorage.org/files/1b4/452/af1/1b4452af15144baeb416490ef196fd57.latex">  ) <br></div></div><br><br>  This expression takes the minimum value when (we equate the derivative with zero) <br><br><img src="https://habrastorage.org/files/c2c/06a/dd7/c2c06add76ee43b283cb076ba33941c3.latex"><br><br>  Here we are already writing the expression for the Kalman coefficient with the step index <img src="https://habrastorage.org/files/0b6/770/8d4/0b67708d4b604261a20b6a77365ee2e2.latex">  , thus we emphasize that it depends on the iteration step. <br>  Substitute the expression for the root-mean-square error <img src="https://habrastorage.org/files/673/2fd/0b0/6732fd0b0594404a90ccd3a8c65b95c8.latex">  minimizing its value of the Kalman coefficient <img src="https://habrastorage.org/files/118/f49/3de/118f493de3584cf0a2d4c771ed5e9c49.latex">  .  We get: <br><br><img src="https://habrastorage.org/files/99a/ad7/836/99aad78367b94d65ae08bfb2e3dbe2a8.latex">  . <br><br>  Our problem is solved.  We obtained an iterative formula for calculating the Kalman coefficient. <br><br><div class="spoiler">  <b class="spoiler_title">All formulas in one place</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/a7b/7a0/1c5/a7b7a01c59d4b2910dd4478206929a46.png"><br></div></div><br><br><h4>  Example </h4><br>  The advertising picture at the beginning of the article filtered data from a fictional GPS sensor mounted on a fictional car that travels evenly accelerated with known fictional acceleration <img src="https://habrastorage.org/files/491/eaa/f85/491eaaf856da478b8b06eecbd439a33b.latex">  . <br><br><img src="https://habrastorage.org/files/7b9/d4d/4a2/7b9d4d4a2f284b0baf50c4fd2508078e.latex"><br><br><div class="spoiler">  <b class="spoiler_title">Look again at the result of filtering.</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/445/357/969/4453579698b1cecdc820557b719a4f54.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Code on matlabe</b> <div class="spoiler_text"><pre><code class="matlab hljs">clear all; N=<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment">% number of samples a=0.1 % acceleration sigmaPsi=1 sigmaEta=50; k=1:N x=k x(1)=0 z(1)=x(1)+normrnd(0,sigmaEta); for t=1:(N-1) x(t+1)=x(t)+a*t+normrnd(0,sigmaPsi); z(t+1)=x(t+1)+normrnd(0,sigmaEta); end; %kalman filter xOpt(1)=z(1); eOpt(1)=sigmaEta; % eOpt(t) is a square root of the error dispersion (variance). It's not a random variable. for t=1:(N-1) eOpt(t+1)=sqrt((sigmaEta^2)*(eOpt(t)^2+sigmaPsi^2)/(sigmaEta^2+eOpt(t)^2+sigmaPsi^2)) K(t+1)=(eOpt(t+1))^2/sigmaEta^2 xOpt(t+1)=(xOpt(t)+a*t)*(1-K(t+1))+K(t+1)*z(t+1) end; plot(k,xOpt,k,z,k,x)</span></span></code> </pre> <br></div></div><br><br><h4>  Analysis </h4><br>  If you follow up with an iteration step <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  Kalman coefficient changes <img src="https://habrastorage.org/files/37b/401/565/37b401565d07419293d42f7664572e58.latex">  then it can be shown that it always stabilizes to a certain value. <img src="https://habrastorage.org/files/5f5/3ed/68f/5f53ed68f3684d08aa86ff5b19a2909d.latex">  .  For example, when the mean square errors of the sensor and the models relate to each other as ten to one, the graph of the Kalman coefficient depending on the iteration step looks like this: <br><br><img src="https://habrastorage.org/storage2/86e/872/08e/86e87208ece7ba8d17f59fc428cc11b7.png"><br><br>  In the following example, we will discuss how this will help to significantly ease our lives. <br><br><h4>  Second example </h4><br>  In practice, it often happens that we do not know anything at all about the physical model of what we filter.  For example, you wanted to filter readings from your favorite accelerometer.  You also do not know in advance by what law you intend to turn the accelerometer.  The maximum information you can use is the variance of the sensor error. <img src="https://habrastorage.org/files/a91/c72/c36/a91c72c36bb4408085dd2c71c9f6fdc0.latex">  .  In such a difficult situation, all ignorance of the motion model can be driven into a random variable. <img src="https://habrastorage.org/files/a3b/108/fb9/a3b108fb960448688ae2e69241fd13e1.latex">  : <br><br><img src="https://habrastorage.org/files/b26/26c/9a4/b2626c9a4f89426e80e98a38f4154ab9.latex"><br><br>  But, frankly, such a system does not at all satisfy the conditions that we imposed on a random variable. <img src="https://habrastorage.org/files/a3b/108/fb9/a3b108fb960448688ae2e69241fd13e1.latex">  because now all the physics of motion unknown to us is hidden there, and therefore we cannot say that at different times the model errors are independent of each other and that their average values ‚Äã‚Äãare zero.  In this case, by and large, the theory of Kalman filter is not applicable.  But, we will not pay attention to this fact, and, stupidly apply all the colossus of formulas, choosing the coefficients <img src="https://habrastorage.org/files/2ba/4ca/d29/2ba4cad2916a4c78a83df585bd622201.latex">  and <img src="https://habrastorage.org/files/a91/c72/c36/a91c72c36bb4408085dd2c71c9f6fdc0.latex">  on the eye, so that the filtered data looked pretty. <br>  But you can go the other way, a much simpler way.  As we saw above, the Kalman coefficient <img src="https://habrastorage.org/files/37b/401/565/37b401565d07419293d42f7664572e58.latex">  with increasing step number <img src="https://habrastorage.org/files/bad/aa5/f1d/badaa5f1dbb044f7837e8bb34938f793.latex">  always stabilizes to the value <img src="https://habrastorage.org/files/5f5/3ed/68f/5f53ed68f3684d08aa86ff5b19a2909d.latex">  .  Therefore, instead of choosing coefficients <img src="https://habrastorage.org/files/2ba/4ca/d29/2ba4cad2916a4c78a83df585bd622201.latex">  and <img src="https://habrastorage.org/files/a91/c72/c36/a91c72c36bb4408085dd2c71c9f6fdc0.latex">  and find the complex ratio of Kalman coefficient <img src="https://habrastorage.org/files/37b/401/565/37b401565d07419293d42f7664572e58.latex">  , we can assume that this coefficient is always constant, and select only this constant.  This assumption will not spoil anything.  First, we are already illegally using the Kalman theory, and secondly, the Kalman coefficient quickly stabilizes to a constant.  In the end, everything is very simplified.  We do not need any formulas from the Kalman theory, we just need to find an acceptable value. <img src="https://habrastorage.org/files/5f5/3ed/68f/5f53ed68f3684d08aa86ff5b19a2909d.latex">  and paste into the iterative formula: <br><br><img src="https://habrastorage.org/files/97c/ebf/bf0/97cebfbf02ae499984d9b245699ebc69.latex"><br><br>  The following graph shows data filtered in two different ways from a fictional sensor.  Provided that we know nothing about the physics of the phenomenon.  The first method is honest, with all the formulas from Kalman's theory.  And the second is simplified, without formulas. <br><br><img src="https://habrastorage.org/storage2/92b/0a4/a06/92b0a4a06d5b0c9aafb27201a0c0c425.png"><br><br>  As we see, the methods are almost the same.  A small difference is observed only at the beginning, when the Kalman coefficient has not yet stabilized. <br><br><h4>  Discussion </h4><br>  As we have seen, the main idea of ‚Äã‚Äãthe Kalman filter is to find the coefficient <img src="https://habrastorage.org/files/45f/c7c/e04/45fc7ce045b0457ebce0da4919fc3c5b.latex">  such that the filtered value <br><br><img src="https://habrastorage.org/files/5ca/e8e/e11/5cae8ee11dc7409cab8862afaf0c7836.latex"><br><br>  on average, the least would be different from the real value of the coordinate <img src="https://habrastorage.org/files/451/592/1d1/4515921d1650413389d38f295f400694.latex">  .  We see that the filtered value <img src="https://habrastorage.org/files/39e/df2/cca/39edf2cca16741e8ba860e6ed0322b6b.latex">  there is a linear function of sensor readings <img src="https://habrastorage.org/files/bbd/951/eb9/bbd951eb93d442b69310be390834d58c.latex">  and previous filtered value <img src="https://habrastorage.org/files/6c1/8ed/626/6c18ed6268f9482d8d896956fd70f15f.latex">  .  And the previous filtered value <img src="https://habrastorage.org/files/6c1/8ed/626/6c18ed6268f9482d8d896956fd70f15f.latex">  is, in turn, a linear function of the sensor reading <img src="https://habrastorage.org/files/db3/300/5bd/db33005bd69349668d6c6c0b23405442.latex">  and the previous previous filtered value <img src="https://habrastorage.org/files/2a1/2c3/31a/2a12c331a7b448588790862de8c919e5.latex">  .  And so on, until the chain fully unfolds.  That is, the filtered value depends on <b>all</b> previous sensor readings linearly: <br><br><img src="https://habrastorage.org/files/542/81e/8f1/54281e8f1ba24da2b103e9eab16d6bd9.latex"><br><br>  Therefore, the Kalman filter is called a linear filter. <br>  It is possible to prove that of all linear filters, the Kalman filter is the best.  Best in the sense that the mean square error of the filter is minimal. <br><br><h4>  Multidimensional case </h4><br>  The whole theory of the Kalman filter can be generalized to the multidimensional case.  The formulas there look a little worse, but the very idea of ‚Äã‚Äãtheir derivation is the same as in the one-dimensional case.  In this beautiful article you can see them: <a href="http://habrahabr.ru/post/140274/">http://habrahabr.ru/post/140274/</a> . <br>  And in this wonderful <a href="http://www.youtube.com/watch%3Fv%3DFkCT_LV9Syk">video,</a> an example of how to use them is analyzed. <br><br><h1>  Literature </h1><br>  You can download the original Kalman article here: <a href="http://www.cs.unc.edu/~welch/kalman/media/pdf/Kalman1960.pdf">http://www.cs.unc.edu/~welch/kalman/media/pdf/Kalman1960.pdf</a> . <br>  This post can be read in English <a href="http://david.wf/kalmanfilter">http://david.wf/kalmanfilter</a> </div><p>Source: <a href="https://habr.com/ru/post/166693/">https://habr.com/ru/post/166693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166683/index.html">Enot J101 Tablet: 7 inches for 75 dollars</a></li>
<li><a href="../166685/index.html">CES results: new Samsung monitors at the international consumer electronics exhibition</a></li>
<li><a href="../166687/index.html">And which scheme of the Moscow metro seems to be better for Habrakhabr's readers?</a></li>
<li><a href="../166689/index.html">I-Teco OpenStack Cloud: Results, Questions and Survey</a></li>
<li><a href="../166691/index.html">"Syntology" - notes on the Chinese Internet</a></li>
<li><a href="../166695/index.html">Acceptance of online payments in Europe in 2013</a></li>
<li><a href="../166697/index.html">Review of offers of Coursera and edX</a></li>
<li><a href="../166699/index.html">Degrees are the key to fast hierarchy in a relational database</a></li>
<li><a href="../166701/index.html">Efficient string concatenation in .NET</a></li>
<li><a href="../166705/index.html">New asteroid development project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>