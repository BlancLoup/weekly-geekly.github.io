<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMS sending using jSMPP methods UDH, SAR, Payload</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our company is engaged in email and sms mailings. At the initial stages for SMS mailings, we used the intermediary API. The company is growing and the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMS sending using jSMPP methods UDH, SAR, Payload</h1><div class="post__text post__text-html js-mediator-article">  Our company is engaged in email and sms mailings.  At the initial stages for SMS mailings, we used the intermediary API.  The company is growing and there are more and more clients, we have decided to write our software to send SMS using the smpp protocol.  This allowed us to send a set of bytes to the provider, and it has already distributed traffic across countries and internal operators. <br><br>  After reading the available and free libraries to send SMS, the choice fell on <a href="https://code.google.com/archive/p/jsmpp/">jsmpp</a> .  Information on use, except <a href="https://habrahabr.ru/post/202142/">this one</a> , was mainly analyzed from <a href="https://code.google.com/archive/p/jsmpp/issues">google by jsmpp</a> .  Description of the protocol SMPP in Russian <a href="https://ru.scribd.com/document/68185006/%25D0%259E%25D0%25BF%25D0%25B8%25D1%2581%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB%25D0%25B0-SMPP-v3-4">tyts</a> . <br><br>  I hope that with this article I will make life easier for many when writing the SMPP service. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  Let's start with a phased analysis of sending SMS.  The logic of sending SMS is as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. The client sends you an SMS that he wants to send (in the form of json): <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"sms_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"test_sms_123"</span></span>, <span class="hljs-string"><span class="hljs-string">"sender"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"phone"</span></span>: <span class="hljs-string"><span class="hljs-string">"380959999900"</span></span>, <span class="hljs-string"><span class="hljs-string">"text_body"</span></span>: <span class="hljs-string"><span class="hljs-string">"!   1000000$!"</span></span>, <span class="hljs-string"><span class="hljs-string">"flash"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  The flash parameter says that this is not a <a href="https://ru.wikipedia.org/wiki/Flash-SMS">flash sms</a> . <br><br>  2. When we receive data, we begin to prepare them for the way in which we will send it to the provider, namely: <b>UDH, SAR, Payload</b> .  It all depends on what method your provider supports. <br><br>  3. You transfer the data to the provider and he gives you back a line that identifies the SMS receiving by the provider, I called it <b>transaction_id</b> . <br><br>  4. Sending SMS leaves the provider the right to return you the final status (delivered, undelivered, etc.) within 48 hours.  Therefore, you will have to save your <b>sms_id</b> and received <b>transaction_id</b> . <br><br>  5. When the SMS is delivered to the recipient, the provider will send you <b>transaction_id</b> and status (DELIVERED). <br><br><h3>  Statuses </h3><br>  According to statuses I will advise 2 articles: only 10 statuses <a href="http://www.smssolutions.net/tutorials/smpp/smppdeliveryreports/">are</a> described and given <a href="http://smpp.w2wts.com/SMPP_Developers.aspx">here</a> , and <a href="http://smpp.w2wts.com/SMPP_Developers.aspx">here</a> is the full list of status codes and their full description. <br><br>  Maven dependency for jSmpp API: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.jsmpp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jsmpp<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.1.0-RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I will describe the main classes with which we will work: <br><br><ul><li>  <b>SMPPSession</b> - a session that is created for the user whom you have registered with the provider and from whose account the money is withdrawn; </li><li>  <b>SessionStateListener</b> - the listener notifies you that the status of your session has been changed, for example, the session has been closed; </li><li>  <b>MessageReceiverListener</b> - the listener returns a <b>DeliverSm</b> object, which stores the <b>transaction_id</b> , <b>status</b> and <b>mobile number</b> ; </li></ul><br><h3>  Dispatch method Payload </h3><br>  The easiest way to send is <b>payload</b> .  Regardless of what length of SMS you send, you send SMS with one data packet.  The provider takes care of splitting the sms into parts.  Gluing the parts is already happening on the recipient's phone.  We will start the review of SMS sending implementation from it. <br><br>  First we need to connect to the provider.  To do this, we need to create a session and its listener, as well as a listener who responds to receiving the statuses of sent SMS.  Below is an example of the <b>createSmppSession</b> method of connecting to an ISP whose data is stored in the <b>SmppServer</b> class I created.  It contains the following data: username, password, ip, port, etc. <br><br><div class="spoiler">  <b class="spoiler_title">The method creates an SMPP connection</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> SMPPSession session; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> SmppServer server; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ExecutorService receiveTask; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SessionStateListener stateListener; ... <span class="hljs-comment"><span class="hljs-comment">// some of your code public void createSmppSession() { StopWatchHires watchHires = new StopWatchHires(); watchHires.start(); log.info("Start to create SMPPSession {}", sessionName); try { session = new SMPPSession(); session.connectAndBind(server.getHostname(), server.getPort(), new BindParameter( BindType.BIND_TRX, server.getSystemId(), server.getPassword(), server.getSystemType(), TypeOfNumber.UNKNOWN, NumberingPlanIndicator.UNKNOWN, null)); stateListener = new SessionStateListenerImpl(); session.addSessionStateListener(stateListener); session.setMessageReceiverListener(new SmsReceiverListenerImpl()); session.setTransactionTimer(TRANSACTION_TIMER); if (Objects.isNull(receiveTask) || receiveTask.isShutdown() || receiveTask.isTerminated()) { this.receiveTask = Executors.newCachedThreadPool(); } watchHires.stop(); log.info("Open smpp session id {}, state {}, duration {} for {}", session.getSessionId(), session.getSessionState().name(), watchHires.toHiresString(), sessionName); } catch (IOException e) { watchHires.stop(); if (SmppServerConnectResponse.contains(e.getMessage())) { log.error("Exception while SMPP session creating. Reason: {}. Duration {}, {}", e.getMessage(), watchHires.toHiresString(), sessionName); close(); return; } else if (e instanceof UnknownHostException) { log.error("Exception while SMPP session creating. Unknown hostname {}, duration {}, {}", e.getMessage(), watchHires.toHiresString(), sessionName); close(); return; } else { log.error("Failed to connect SMPP session for {}, duration {}, Because {}", sessionName, watchHires.toHiresString(), e.getMessage()); } } if (!isConnected()) { reconnect(); } }</span></span></code> </pre><br></div></div><br>  From this example, we can see that we use the obsms of the <b>SmsReceiverListenerImpl</b> and <b>SessionStateListenerImpl classes</b> to create a session.  The first is responsible for receiving the statuses sent by SMS, the second - the session listener. <br><br>  The <b>SessionStateListenerImpl</b> class in the <b>onStateChange</b> method gets the class of the old session state and the new one.  In this example, if the session is not connected, a reconnection attempt is made. <br><br><div class="spoiler">  <b class="spoiler_title">SMPP session listener</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * This class will receive the notification from {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> SMPPSession} for the * state changes. It will schedule to re-initialize session. */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SessionStateListenerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SessionStateListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStateChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SessionState newState, SessionState oldState, Object source)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!newState.isBound()) { log.warn(<span class="hljs-string"><span class="hljs-string">"SmppSession changed status from {} to {}. {}"</span></span>, oldState, newState, sessionName); reconnect(); } } }</code> </pre><br></div></div><br>  <b>SmsReceiverListenerImpl</b> example.  You will have to override 3 methods: <i>onAcceptDeliverSm</i> , <i>onAcceptAlertNotification</i> , <i>onAcceptDataSm</i> .  We only need the first to send SMS.  He will receive from the provider <b>transaction_id</b> , under which the provider registered our SMS and status.  In this example, you will encounter two classes: <b>SmppErrorStatus</b> and <b>StatusType</b> are <i>enum</i> classes that store error status and send status (sent to the provider, not sent to the provider, etc.), respectively. <br><br><div class="spoiler">  <b class="spoiler_title">SMS status listener</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/*The logic on this listener should be accomplish in a short time, because the deliver_sm_resp will be processed after the logic executed.*/</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SmsReceiverListenerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageReceiverListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAcceptDeliverSm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DeliverSm deliverSm)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ProcessRequestException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Objects.isNull(deliverSm)) { log.error(<span class="hljs-string"><span class="hljs-string">"Smpp server return NULL delivery answer"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// this message is delivery receipt DeliveryReceipt delReceipt = deliverSm.getShortMessageAsDeliveryReceipt(); //delReceipt.getId() must be equals transactionId from SMPPServer String transactionId = delReceipt.getId(); StatusType statusType; String subStatus; if (MessageType.SMSC_DEL_RECEIPT.containedIn(deliverSm.getEsmClass())) { // &amp;&amp; delReceipt.getDelivered() == 1 statusType = getDeliveryStatusType(delReceipt.getFinalStatus()); SmppErrorStatus smppErrorStatus = SmppErrorStatus.contains(delReceipt.getError()); if (smppErrorStatus != null) subStatus = smppErrorStatus.name(); else subStatus = delReceipt.getError(); } else { statusType = StatusType.SMS_UNDELIVERED; // this message is regular short message log.error("Delivery SMS event has wrong receipt. Message: {}", deliverSm.getShortMessage()); subStatus = SmppErrorStatus.INVALID_FORMAT.name(); } // some providers return phone number in deliverSm.getSourceAddr() String phoneNumber = deliverSm.getDestAddress(); saveDeliveryStatus(transactionId, statusType, subStatus, phoneNumber)); log.info("Receiving delivery receipt from {} to {}, transaction id {}, status {}, subStatus {}", deliverSm.getSourceAddr(), deliverSm.getDestAddress(), transactionId, statusType, subStatus); } catch (InvalidDeliveryReceiptException e) { log.error("Exception while SMS is sending, destination address {}, {}", deliverSm.getDestAddress(), e.getMessage(), e); } } @Override public void onAcceptAlertNotification(AlertNotification alertNotification) { log.error("Error on sending SMS message: {}", alertNotification.toString()); } @Override public DataSmResult onAcceptDataSm(DataSm dataSm, Session source) throws ProcessRequestException { log.debug("Event in SmsReceiverListenerImpl.onAcceptDataSm!"); return null; } private StatusType getDeliveryStatusType(DeliveryReceiptState state) {&lt;cut /&gt; if (state.equals(DeliveryReceiptState.DELIVRD)) return StatusType.SMS_DELIVERED; else if (state.equals(DeliveryReceiptState.ACCEPTD)) return StatusType.ACCEPTED; else if (state.equals(DeliveryReceiptState.DELETED)) return StatusType.DELETED; else if (state.equals(DeliveryReceiptState.EXPIRED)) return StatusType.EXPIRED; else if (state.equals(DeliveryReceiptState.REJECTD)) return StatusType.REJECTED; else if (state.equals(DeliveryReceiptState.UNKNOWN)) return StatusType.UNKNOWN; else return StatusType.SMS_UNDELIVERED; } }</span></span></code> </pre><br></div></div><br>  Well, finally, the most important method - the method of sending SMS.  I desserialized the above described JSON into the <b>SMSMessage</b> object, therefore, meeting an object of this class, be aware that it contains all the necessary information about the SMS sent. <br><br>  The <i>sendSmsMessage</i> method, described below, returns an object of the class <b>SingleSmppTransactionMessage</b> , which contains the data about the sent SMS with the <b>transaction_id</b> , which was assigned by the provider. <br><br>  Class <b>Gsm0338</b> helps to determine the content of Cyrillic characters in SMS.  This is important, as we must inform the provider of this.  This class was built from a <a href="http://www.smsitaly.com/Download/ETSI_GSM_03.38.pdf">document</a> . <br><br>  The Enum class <b>SmppResponseError</b> was built on the basis of errors that the provider‚Äôs SMPP server can return, link <a href="https://www.nowsms.com/smpp-error-code-reference">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">SMS sending method</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SingleSmppTransactionMessage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSmsMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SMSMessage message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String bodyText = message.getTextBody(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> smsLength = bodyText.length(); OptionalParameter messagePayloadParameter; String transportId = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; String error = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isUSC2 = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isFlashSms = message.isFlash(); StopWatchHires watchHires = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StopWatchHires(); watchHires.start(); log.debug(<span class="hljs-string"><span class="hljs-string">"Start to send sms id {} length {}"</span></span>, message.getSmsId(), smsLength); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] encoded; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((encoded = Gsm0338.encodeInGsm0338(bodyText)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { messagePayloadParameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OptionalParameter.OctetString( OptionalParameter.Tag.MESSAGE_PAYLOAD.code(), encoded); log.debug(<span class="hljs-string"><span class="hljs-string">"Found Latin symbols in sms id {} message"</span></span>, message.getSmsId()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { isUSC2 = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; messagePayloadParameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OptionalParameter.OctetString( OptionalParameter.Tag.MESSAGE_PAYLOAD.code(), bodyText, <span class="hljs-string"><span class="hljs-string">"UTF-16BE"</span></span>); log.debug(<span class="hljs-string"><span class="hljs-string">"Found Cyrillic symbols in sms id {} message"</span></span>, message.getSmsId()); } GeneralDataCoding dataCoding = getDataCodingForServer(isUSC2, isFlashSms); log.debug(<span class="hljs-string"><span class="hljs-string">"Selected data_coding: {}, value: {}, SMPP server type: {}"</span></span>, dataCoding.getAlphabet(), dataCoding.toByte(), server.getServerType()); transportId = session.submitShortMessage( <span class="hljs-string"><span class="hljs-string">"CMT"</span></span>, TypeOfNumber.ALPHANUMERIC, NumberingPlanIndicator.UNKNOWN, message.getSender(), TypeOfNumber.INTERNATIONAL, NumberingPlanIndicator.ISDN, message.getPhone(), ESM_CLASS, ZERO_BYTE, ONE_BYTE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, rd, ZERO_BYTE, dataCoding, ZERO_BYTE, EMPTY_ARRAY, messagePayloadParameter); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (PDUException e) { error = e.getMessage(); <span class="hljs-comment"><span class="hljs-comment">// Invalid PDU parameter log.error("SMS id:{}. Invalid PDU parameter {}", message.getSmsId(), error); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } catch (ResponseTimeoutException e) { error = analyseExceptionMessage(e.getMessage()); // Response timeout log.error("SMS id:{}. Response timeout: {}", message.getSmsId(), e.getMessage()); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } catch (InvalidResponseException e) { error = e.getMessage(); // Invalid response log.error("SMS id:{}. Receive invalid response: {}", message.getSmsId(), error); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } catch (NegativeResponseException e) { // get smpp error codes error = String.valueOf(e.getCommandStatus()); // Receiving negative response (non-zero command_status) log.error("SMS id:{}, {}. Receive negative response: {}", message.getSmsId(), message.getPhone(), e.getMessage()); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } catch (IOException e) { error = analyseExceptionMessage(e.getMessage()); log.error("SMS id:{}. IO error occur {}", message.getSmsId(), e.getMessage()); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } catch (Exception e) { error = e.getMessage(); log.error("SMS id:{}. Unexpected exception error occur {}", message.getSmsId(), error); log.debug("Session id {}, state {}. {}", session.getSessionId(), session.getSessionState().name(), e); } watchHires.stop(); log.info("Sms id:{} length {} sent with transaction id:{} from {} to {}, duration {}", message.getSmsId(), smsLength, transportId, message.getSender(), message.getPhone(), watchHires.toHiresString()); return new SingleSmppTransactionMessage(message, server.getId(), error, transportId); } private GeneralDataCoding getDataCodingForServer (boolean isUCS2Coding, boolean isFlashSms){ GeneralDataCoding coding; if (isFlashSms) { coding = isUCS2Coding ? UCS2_CODING : DEFAULT_CODING; } else { coding = isUCS2Coding ? UCS2_CODING_WITHOUT_CLASS : DEFAULT_CODING_WITHOUT_CLASS; } return coding; } /** * Analyze exception message for our problem with session * While schedule reconnecting session sms didn't send and didn't put to resend */ private String analyseExceptionMessage(String exMessage){ if(Objects.isNull(exMessage)) return exMessage; if (exMessage.contains("No response after waiting for")) return SmppResponseError.RECONNECT_RSPCTIMEOUT.getErrCode(); else if (exMessage.contains("Cannot submitShortMessage while")) return SmppResponseError.RECONNECT_CANNTSUBMIT.getErrCode(); else if (exMessage.contains("Failed sending submit_sm command")) return SmppResponseError.RECONNECT_FAILEDSUBMIT.getErrCode(); return exMessage; }</span></span></code> </pre><br></div></div><br>  In the next article I will describe the method of sending SMS using UDH, the link will be here  This option obliges you to translate the message into bytes, then divide them into sub-messages and indicate their numbering and number in the first bits.  It will be fun. <br><br>  <a href="https://github.com/unisender-dev/unismpp">Github link</a>  I hope my article will simplify the development of your SMPP service.  Thanks for reading. </div><p>Source: <a href="https://habr.com/ru/post/310828/">https://habr.com/ru/post/310828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310816/index.html">The first project on FPGA Altera and USB-Blaster connection in Linux</a></li>
<li><a href="../310818/index.html">SObjectizer: the problem of overloading agents and means of dealing with it</a></li>
<li><a href="../310820/index.html">How to use the Mongoose schema to generate graphQL types</a></li>
<li><a href="../310824/index.html">Principles of reactive programming using a simple RSS aggregator using ReactiveX for Python</a></li>
<li><a href="../310826/index.html">Unit testing in complex applications</a></li>
<li><a href="../310830/index.html">How to get the most out of code minification</a></li>
<li><a href="../310832/index.html">Implementing Row Level Security on MySQL</a></li>
<li><a href="../310834/index.html">Protection of digital content: how to apply DMCA and not go on the path of litigation?</a></li>
<li><a href="../310836/index.html">Functional safety, Part 3 of 7. IEC 61508: Systematic randomness or random systematicity?</a></li>
<li><a href="../310838/index.html">As MegaFon and Nokia in Nizhny Novgorod, 5G networks demonstrated</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>