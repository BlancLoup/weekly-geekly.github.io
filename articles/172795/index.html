<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we moved from 30 servers to 2: Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How we moved from 30 servers to 2: Go 
 When we released the first version of IronWorker about 3 years ago, it was written in Ruby, and the API was wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we moved from 30 servers to 2: Go</h1><div class="post__text post__text-html js-mediator-article"><h4>  How we moved from 30 servers to 2: Go </h4><br>  When we released the first version of IronWorker about 3 years ago, it was written in Ruby, and the API was written in Rails.  After a while, the load began to grow rapidly and we quickly reached the limits of our Ruby applications.  In short, we switched to Go.  And if you want to know the details - keep reading ... <a name="habracut"></a><br><br><h5>  First version </h5><br>  First, a bit of history: we wrote the first version of IronWorker, originally called SimpleWorker (not a bad name, is it?) In Ruby.  We were a consulting company building applications for other companies, and at that time there were 2 popular things: Amazon Web Services and Ruby On Rails.  And so we created applications using Ruby on Rails and AWS, and attracted new customers.  The reason we created IronWorker was to "scratch where it itches."  We had several customers using devices that constantly sent data in 24/7 mode and we had to accept and convert this data into something useful.  This task was solved by launching heavy processes on a schedule that processed data every hour, every day, and so on.  We decided to create something that we can use for all of our clients, without the need to constantly raise and maintain a separate infrastructure for each of them to process its data.  Thus, we created a ‚Äúhandler as a service‚Äù, which we first used for our tasks, and then we decided that maybe someone else would need a similar service and we made it public.  IronWorker was born that way. <br><br>  Constant loading of processors on our servers was about 50-60%.  When the load increased, we added more servers to keep the CPU load at about 50%.  It suited us while we were satisfied with the price we paid for so many servers.  The bigger problem was how we dealt with load jumps.  The next load jump (traffic) created a domino effect that could damage a whole cluster.  During such a jump in load, exceeding the usual by only 50%, our Rails servers started using the processor at 100% and stopped responding.  This made the load balancer think that this server fell and redistribute the load among the other servers.  And, since, in addition to processing the requests of the fallen server, the remaining servers had to handle the peak load, it usually took a while before the next server crashed, which was again excluded from the balancer pool, and so on.  Pretty soon, all servers were down: This phenomenon is also known as colossal clusterf ** k ( <a href="https://plus.google.com/105758962966211996971">+ Blake Mizerany</a> ) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/ef1/39d/0b7/ef139d0b78f109c41e4363882d68a5a3.png"><br><br>  The only way to avoid this with the applications that we had at that time was to use a huge amount of additional capacity to reduce the load on our servers and be ready for peak loads.  But it meant spending a lot of money.  Something had to change. <br><br><h5>  We rewrote it </h5><br>  We decided to rewrite the API.  It was a simple solution. To be honest, our API, written in Ruby on Rails, was not scalable.  Based on many years of experience developing such things in Java, which could handle a large load using far less resources than Ruby on Rails, I knew that we could do this much better.  Thus, the decision came down to which language to use. <br><br><h5>  Language selection </h5><br>  I was open to new ideas, since the last thing I wanted to do was return to Java.  Java is (was?) A great language, with many advantages, such as performance, but after writing Ruby code for several years, I was fascinated by how productively I could write code.  Ruby is a convenient, understandable and simple language. <br><br>  We looked at other scripting languages ‚Äã‚Äãwith better performance than Ruby (which was easy), such as Python and JavaScript / Node.js.  We also looked at JVM-based Scala and Clojure, and other languages ‚Äã‚Äãlike Erlang (which uses AWS) and Go (golang).  <b>Go won</b> .  That competition was a fundamental part of the language was excellent;  the standard kernel library contained almost everything we needed to build an API;  it is capacious;  it compiles quickly;  programming on Go is just nice ‚Äî just like Ruby, and in the end, numbers don't lie.  After building a prototype and testing performance, we realized that we can handle large loads without problems using Go.  And, after some discussions with the team (‚ÄúIt's all right, it is supported by Google‚Äù), we decided to use Golang. <br><br>  When we first decided to try Go, it was a risky decision.  There was not a large community, there was not a large number of open source projects, there were no successful cases of Go in production.  We were also not sure that we could hire talented programmers if we chose Go.  But we soon realized that we could hire the best programmers <i>precisely because</i> we chose Go.  We were one of the first companies that publicly announced the use of Go in production, and the first company to post a vacancy announcement on the golang mailing list.  After that, the best developers wanted to work for us, because they could use Go in their work. <br><br><h5>  After go </h5><br>  After we launched the Go version, we reduced the number of servers to two (the second one needs more for reliability).  The load on the server was minimal, as if nothing and did not use resources.  The processor load was less than 5%, and the application used several hundred KB of memory (at startup) compared to Rails applications that ate ~ 50 MB (at startup).  Compare this with the JVM!  Much time has passed.  And since then, we have never had colossal clusterf ** k. <br><br>  We have grown a lot since those times.  Now we have a lot more traffic, we have launched additional services (IronMQ and IronCache), and now we use hundreds of servers to cover the needs of customers.  And the whole backend is implemented on Go.  In retrospect, it was a great decision - to choose Go, because it allowed us to build great products to grow and scale, as well as attract talented people.  And, I think that the choice made will continue to help us grow in the foreseeable future. <br><br>  PS Translated with the permission of Travis, and if there are any questions, he and other members of the Iron.io team will be happy to answer them. </div><p>Source: <a href="https://habr.com/ru/post/172795/">https://habr.com/ru/post/172795/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172785/index.html">Happy (sausage) refactorings</a></li>
<li><a href="../172787/index.html">Development of a mechanism for extracting DTO from a database using LINQ</a></li>
<li><a href="../172789/index.html">We limit the speed on the Cisco router. Technology rate-limit</a></li>
<li><a href="../172791/index.html">Crossbrowser bookmarks</a></li>
<li><a href="../172793/index.html">Easy penetration or fight with an uncomplicated virus</a></li>
<li><a href="../172797/index.html">Science and morality</a></li>
<li><a href="../172799/index.html">TP-LINK backdoor</a></li>
<li><a href="../172807/index.html">Learn a better bundler</a></li>
<li><a href="../172809/index.html">Ukrainian received a patent for an industrial design of a tablet computer</a></li>
<li><a href="../172811/index.html">Google will separate maps and commerce</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>