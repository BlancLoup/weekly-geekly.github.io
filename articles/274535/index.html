<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animation of falling snow on Canvas is more effective than animation on DOM several times.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=".  In comparison with native JS on DOM elements, the implementation of animation algorithms on Canvas is usually more productive many times. This is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animation of falling snow on Canvas is more effective than animation on DOM several times.</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://spmbt.github.io/snowfalls/jSnowMultiWin.htm">.</a> <a href="http://spmbt.github.io/snowfalls/jSnowMultiWin.htm"><img src="https://habrastorage.org/files/dfa/01c/6af/dfa01c6af10147b49e7fcacc7da23c54.png" align="right"></a>  In comparison with native JS on DOM elements, the implementation of animation algorithms on Canvas is usually more productive many times.  This is a well-known fact (but with features for a small number of particles, as it will turn out later), and it can find a realization that hinders the traditional way under NG but is driven by rational users of ‚Äúfalling snow‚Äù.  So that the load was small, in recent years it is considered good form to ‚Äúlaunch‚Äù snow on the site barely noticeable, with a minimum amount of snowflakes (5-15).  Here and the effect is, and the load on the processor is almost no. <br><br>  Therefore, while <s>the NG still has a few more days</s> in winter, I propose to arrange a hackathon to implement the best algorithms on the canvas and their analogues on the DOM, taking as a basis mainly the ancient native algorithms that were wrapped in jQuery as a maximum to make it convenient to connect.  Most of these algorithms do not match the load on the processor or are inefficient, so even with a small number of snowflakes, the processor is loaded at 100%.  <a href="http://www.jqueryrain.com/2012/04/top-jquery-snow-falling-effect-plugin-tutorial-with-example/">Here is an example of a review article</a> , where more than 10 implementations are considered, not all that occur in nature.  In addition, we will consider a few chosen ones in order to get the groundwork for the development of the algorithm and its implementation with good efficiency (we will get another 5-6 options).  On this basis, you can build a revision.  <a href="https://github.com/spmbt/snowfalls">Github</a> with 12 demos (links are repeated below) and several algorithms. <br><a name="habracut"></a><br>  As usual, the life of an article on Habr√© does not last more than 1.5 days, so you can‚Äôt count an effective stock.  But after the New Year, various miracles happen: the flow of visitors is falling, and random lunatics get a chance not to forget one article for 5 whole days.  They bet on. <br><br>  It is better if it is tied to a lengthy process, for example, to the club of anonymous Santa Clauses, by going to which you can always get a link to the discussion and development of the options of "snow fall" and at the same time it is not tied rigidly to the holiday.  The result at present is here: <a href="https://geekadm.ru/">geekadm.ru/#/2015</a> , and there are, of course, intermediate experiments of the type <a href="http://46.101.141.171/snow.html%3Fv%3D4">46.101.141.171/snow.html?v=4</a> - snow for HabraAdm with additional effects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A preliminary "hackathon" was arranged by a couple of participants and (or) club visitors - <a href="http://habrahabr.ru/users/kafeman/">(1)</a> , <a href="http://habrahabr.ru/users/spmbt/">(2)</a> .  As a result, it turned out up to 10 options on the engine with Canvas.  Their number can be much larger, but free time is needed for everything, so the action turned into an open one.  For example, you can ‚Äúscrew‚Äù a model of snowflakes falling by the author Peter Gehrig, already written in 2003, to the engine.  The revision in 2005-2006 shows on modern browsers that 20-30 snowflakes slightly load the processor (10-20%, depends on the power and the video card; hereinafter we will <b>talk about loading one processor core</b> , since JS is single-threaded), and according to the testimony of the old forums, it was the same on older browsers like Opera 9 and IE6, but somewhat worse.  On the Canvas with the same algorithm, it would be possible to run 5 times more objects. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5c9/34c/312/5c934c312ad343beaeefb56ae257c6f5.jpg"></div><br>  demo <div style="text-align:center;"><img src="https://habrastorage.org/files/e03/ae7/7a4/e03ae77a46a1490cb78752a4613dbfdd.png"></div><br><br><h2>  Let's look at the history and look at its course. </h2><br>  Let's start from the beginning, from 2002-2005 approximately.  Javascript showed the ability to animate the falling snowflakes.  True, it turned out, and it was natural, the animation on the script is either unproductive, or it loads the processor heavily.  Therefore, in those old days, it was necessary either to save resources very much, or to load the processor to the maximum, 100% in the browser stream (on 1 core), which slowed down the other tabs (in those browsers like Opera 9, where they were) and windows, and this caused poorly concealed indignation of visitors to such pages. <br><br>  After 8 years there was a solution to this problem at the browser level.  The main browsers, starting with Chrome, began to suspend the execution of scripts on invisible tabs.  This helped not to interfere with viewing other windows and programs (but does not pause when switching to another window, it only reduces the load if the window is not drawn on the screen or partially visible).  True, in connection with the mobile era, the opening of the pages with the loading animation is still not perceived positively. <br><br>  But over the years, a more advanced animation mechanism has emerged - Canvas.  Immediately, it should be noted that another innovative mechanism - animations in CSS - does not help save the load, and they spend exactly as much processor power as animation on Javascript + DOM.  That is, if you look for the best solution, you have to do it in Canvas. <br><br>  Canvas, as will be seen in the examples, allows you to run a hundred snowflakes with a load of 30-40% for an average desktop computer or laptop.  This is about 5 times more efficient than the best optimized algorithms on JS + DOM. <br><br>  As a tribute to history, we will consider the ‚Äúclassical‚Äù algorithms, which are waiting in the wings for optimization and transfer to Canvas. <br><br>  A lot of algorithms are easy to find by searching in Github according to the words ‚Äúsnowfall js‚Äù, ‚Äúsnow flakes js‚Äù.  They will complement a good selection of <a href="http://www.jqueryrain.com/2012/04/top-jquery-snow-falling-effect-plugin-tutorial-with-example/">12 scripts with demo links mentioned above</a> (or an <a href="http://blog.platinastudio.com/jquery-snow-falling-effect-plugins/">extended copy</a> ). <br><br><h2>  Overview of algorithms with examples </h2><br>  <i>(When browsing the pages with examples, be prepared to sometimes 100% CPU load. When showing a link in the article about the level of loading is warned.)</i> <br><br>  Many algorithms, besides being inefficient, are not yet similar in behavior to the actual behavior of snowflakes.  Probably, many people remember the striking discrepancy between reality and the movement of snowflakes along a sinusoid.  Once <a href="http://www.dynamicdrive.com/dynamicindex3/snow.htm">seen</a> (or <a href="http://loktar00.github.io/JQuery-Snowfall/">newer</a> ), it is remembered for a long time as a negative example.  Therefore, the task of the algorithm is to be not only effective, but also reflecting reality.  (In terms of efficiency, the calculation of harmonic functions should also lose.) <br><br>  Of the previously revised algorithms, two are the closest to reality - with random movements (you need to vary the speed, not the coordinates) and the mentioned algorithm Peter Gehrig (2003), in which the movement is controlled by 4 variables, and one of them is harmonically changing, which creates periodic effects of "turbulence".  However, one can argue about this and add new implementations to the piggy bank. <br><br>  From the found implementations of the P.Gehrig algorithm, a page with an example was found: <a href="http://www.softtime.ru/javascript/snow-falling.html">www.softtime.ru/javascript/snow-falling.html</a> .  It is clear what it is about.  A small amount of snowflakes (15-20) still does not load much processors (10-20% for not weak laptops), works in Chrome and Firefox, although Opera 9, IE5 and 6 and some early Firefox are read in the support list.  Of course, the Canvas did not know then. <br><br>  We will reduce what we saw in the table, where we show: <br>  *) number of particles; <br>  *) animation type; <br>  *) availability of a sandbox for experiments; <br>  *) CPU usage (MacBook, Firefox 43) (Chrome is usually% 10 more efficient); <br>  *) comments about features. <br><br>  (The real data of the processor load will differ from those indicated for different computers, for computers with different video cards and for mobile devices over a wide range. Given for orientation is for a medium-power notebook with integrated graphics.) <br><br>  Let's look faster at scripts using Canvas. <br><table><tbody><tr><th>  Not pure js </th><th colspan="3">  Demo: 400x400, <a href="https://www.khanacademy.org/computer-programming/snowman-with-falling-snow/1017930778">Snowman with Falling Snow</a> </th></tr><tr><td>  Particles on demo: <b>100</b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/cc9/512/f98/cc9512f9811d45a8ab7571629b6309f4.png"></div></td></tr><tr><td>  Type: Canvas </td></tr><tr><td>  Sandbox - <b>YES</b> </td></tr><tr><td>  Download: <b>70%</b> </td></tr><tr><td>  Code lines: <b>106</b> + ProcessingJS (800K) </td></tr><tr><td colspan="4">  Drawn in 800K uncompressed code <a href="http://processingjs.org/reference/">ProcessingNS</a> environment that creates a ‚ÄúRapier‚Äù type language.  The snowman is drawn with the same code.  An example is a special one.  Shows that you can do anything with shells (to solve simple problems in complex ways), and even in this case, Canvas does not catastrophically lose out to solutions on the DOM. </td></tr><tr><th>  <a href="http://www.jqueryrain.com/%3F_ol9H3hd">Article (en)</a> , 2012 </th><th>  Code: <a href="https://github.com/sebleedelisle/live-coding-presentations/tree/master/2011/JSSnow">Github</a> </th><th colspan="2">  Demo: <a href="http://sebleedelisle.com/demos/JSSnowNew/snow3d.html">full screen</a> </th></tr><tr><td>  Particles on demo: <b>500</b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/cf5/6c8/df3/cf56c8df38b549bfb9348ff5ab6cad73.png"></div></td></tr><tr><td>  Type: Canvas </td></tr><tr><td>  Sandbox?  <b>Not</b> </td></tr><tr><td>  Download: <b>100%</b> </td></tr><tr><td>  Code lines: <b>50</b> + 100 in * .html + ThreeCanvasJS (72K) </td></tr><tr><td colspan="4">  72K compressed unpacked code of the ThreeCanvas.js library.  3D scene with the rotation of its mouse movement.  Here, for the sake of smooth movement, a small bitrate is set, so everything is beautiful, but as a background action it is not very appropriate. </td></tr><tr><th>  Year: 2010 </th><th>  Code: <a href="">JS</a> </th><th colspan="2">  Demo and description: <a href="http://www.goat1000.com/snow.php">full screen</a> </th></tr><tr><td>  Particles on the demo: <b>60</b> , spinning in the plane of the picture </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/fdf/927/b7b/fdf927b7b16a44b392ee25860d2531b9.png"></div></td></tr><tr><td>  Type: Canvas </td></tr><tr><td>  Sandbox?  <b>Not</b> </td></tr><tr><td>  Download: <b>100%</b> </td></tr><tr><td>  Code Lines: <b>160</b> </td></tr><tr><td colspan="4">  Very frequent animation does not allow to appreciate the advantages of Canvas here too.  There is a rotation of drawing snowflakes around its axis, a slow drop with wanderings.  But some of them ‚Äúwalk‚Äù along sinusoids, torsion in one plane does not at all give realism, which, on the contrary, rejects from the perception of the effect, creates, rather, the effect of intrusiveness.  The code, on the contrary, shows its power and compactness.  In sum, the excellent efforts are aimed at achieving a little bit of the effects that, for the consumer, are no better than energy-consuming engines on the DOM. </td></tr><tr><td colspan="4"><br>  Let's look at examples of scripts working with DOM (layers), without the Canvas. <br><br></td></tr><tr><th>  Year: 2009 </th><th colspan="2">  Demo: <a href="http://demos.9lessons.info/happyxmas.html">jSnow - jQuery Snow Effect</a> , full screen </th><th>  Code: <a href="http://shadowmint.blogspot.ru/2009/12/jsnow-mods.html">JS</a> (uncompressed old version) </th></tr><tr><td>  Particles on demo: <b>25</b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/265/4c5/83d/2654c583dae94209a07327056aeda4c8.png"></div></td></tr><tr><td>  Type: DOM </td></tr><tr><td>  Sandbox?  <b>Not</b> </td></tr><tr><td>  Download: <b>70%</b> </td></tr><tr><td>  Code Lines: <b>160</b> + jQuery </td></tr><tr><td colspan="4">  Options in Fiddle sandboxes (character snowflakes are used everywhere): <br><ul><li>  Packaged (obfuscated) <a href="http://jsfiddle.net/spmbt/vhccLbzm/3/embedded/result,js,html,css/"><b>original code in a sandbox</b></a> with adaptation to jQuery 2. <br></li><li>  Unpacked, but poorly moving (small sinusoids) <a href="http://jsfiddle.net/spmbt/vhccLbzm/embedded/result,js,html,css/">mod1 mod code in the sandbox</a> with adaptation to jQuery 2. <br></li><li>  Rebuilt with refactoring of names, style, the <a href="https://jsfiddle.net/spmbt/xcez6ha6/1/">most similar and working code (Fiddle) of</a> this script in the sandbox.  Stops / starts by the stop button.  In compressed form - 1.5K. <br></li><li>  Extended to the ability to run multiple objects in blocks or in the whole window.  Run by collection.  In compressed form - 1.8 K, less than the original, which is 2.2-2.4 for different mods. </li></ul></td></tr><tr><td colspan="4">  This script has a characteristic style of movement of particles (strongly to the sides).  If you look closely, these are just very large sine waves perceived as one big whirlwind in the middle of the window.  He is very restrained in waste of resources.  Source code version 1.2 - lost or always obfustsirovan packer;  Unpacked versions 1.1.mod2 (modified by other authors) are in the Codepen sandbox, but do not work with the new jQuery, because they refer to the canceled $ .browser.  And they show signs of unpacking.  Looks great in low headlines ( <a href="http://www.brazicraciun.com/">example</a> ), when sinusoids do not have time to look through.  Of the dozens of examples, if you should look at a couple of them (by execution and code), then this example is one of them.  Therefore, we will take the jSnow version thoroughly by running it in a sandbox. <br></td></tr></tbody></table>  Interestingly, the packaged version of the author, 1.1 or 1.2 works much faster - with the same external settings it <a href="http://jsfiddle.net/spmbt/vhccLbzm/3/embedded/result,js,html,css/">loads the processor by 40%</a> , and <a href="http://jsfiddle.net/spmbt/vhccLbzm/1/embedded/result,js,html,css/">1.1.mod2 - by 55%</a> .  (Fiddle also does not work faster in multi-window mode.) Most likely, this is the effect of unnecessary checks in the snowflake drawing cycle (features have been added to the mods).  The code itself is not extremely optimized - it writes inline styles that can be defined by rules. <br><br>  Further, it became more interesting - in the code with the tested settings, a number of bugs showed up (and this does not mean that all were found).  Some changes in the code will have to be done (to remove incompatibility with jQ 2+, to calculate the initial position of the snowflake, not to let them go beyond the left edge of the window - in poppies this leads to a ‚Äúflashing‚Äù scroll bar, and it is useful to do the same for the lower border ), so use better modified modern versions. <br><br>  Versions-mods (2009-2010) added a couple of pressing ‚Äúfeatures‚Äù - setting the smooth disappearance of snowflakes below (fadeAway: 1) and the ability to scroll with the snowflakes field not moving (followScroll: 1).  The names are left original, which they called the developers. <br><br>  The goal of debugging old code is to transfer the algorithm to Canvas and compare the speeds.  <s>(The cripple to win is not enough honor.)</s> In the settings I repeat the same mistakes that I criticized others over.  For the developer, it does not matter that the multi-colored snow falling in 2D does not happen - the main thing is to have a technical opportunity to paint.  And yet, not snowflakes are flying, but clumps in reality.  But 3/4 of the population of the Earth does not know this, so we are waiting for success ... In the set of snowflakes, most of the Unicode characters that are similar to snowflakes are used - they already accumulated 8. You can find as many more. <br><br>  So, we have a readable code, 20 lines shorter (90 lines) and 30% less packed in packed form (1.5K) than the best mod samples, without losing the functions and adding a stop-start button.  This intermediate option is compact, but it works, as before, with a window and can absolutely set the height (height: number) in the parameters.  This is not very convenient, especially since the plugin does not use the context collection at all, so it feels fine with a strange-looking $ (). JSnow (...) call, i.e.  without context.  It turned out pretty simple, we <a href="http://spmbt.github.io/snowfalls/jSnowSimple.htm">limit ourselves here to a link to the demo</a> . <br><br>  And let's complicate the task - start working with contextual jQuery collections.  Save this behavior when there is no context - we choose to work with the window, as in the context of window and $ ('body')) and add work with the container block (for example, run on $ ('. ContSnow'). JSnow (.. .)).  The container will have to be prepared, it needs position: relative, so that the inserted block with absolute feels good.  The block that covers the whole window will also start behaving differently, will cover the window, so all the page content will need to be lifted if there is such a block.  (It is possible and otherwise, in the old way, but why complicate things? Rather, they will use either the first script or the second one.) It will turn out like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b73/e65/d37/b73e65d37c994f55a502a446a68e805f.png"></div>  demo, <a href="">(code in repo)</a> .  This is DOM, load 30% per stream (15% total) with a bit rate of 12. <br>  Somewhat influenced by the fact that the pictures - large and transparent. <br><br>  In fact, why work with only one container if jQuery can provide a collection?  It turns out something <a href="http://spmbt.github.io/snowfalls/jSnowMultiWin.htm">like this</a> , a load of 30-50% for a sum of 70-120 particles.  Stop-start can also be divided by buttons or make common. <br><br>  When trying to apply what is written, the impracticality of running the script on the collection is immediately apparent.  Run - yes, you can, even dozens of instances of scripts, handing out a bit of snowflakes to each.  But all the blocks of the collection are given the same parameters, and this is impractical, because  more often you want to do another task - run a few windows (virtual, on divs), but with different parameters, and for this you have to report them to one element.  It turns out, most often, that how many elements, so many starts .jSnow are needed, that it turns out long, although clearly. <br><br>  Here there is an analogy with writing rules for CSS.  The rules are the same parameter declarations that we do when launching plug-ins, even selectors for plug-ins are in place.  But now there are no mechanisms to gradually accumulate descriptions of the rules (just as in one ‚Äî font-size, in the other ‚Äî position).  The second launch of the plug-in on the same element adds another instance of the plug-in (long-playing function with closure and the ability to turn off), but does not add properties to the already running one.  In this case, it would be more convenient to list selectors (just strings with classes), rather than JSON settings.  But not a single plugin will be remembered, where such a method of constructing settings would be needed and worked.  At the most advanced version of the demo, we will write the launch in 4 areas as the plugin can now: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dfa/01c/6af/dfa01c6af10147b49e7fcacc7da23c54.png"></div><br>  demo, <a href="https://github.com/spmbt/snowfalls/blob/gh-pages/jSnowMultiWin.htm">(cat in repo)</a> , load 50% with 75 particles and 12 FPS. <br><br>  Improvements to the plugin have added about 300 bytes of compressed code, but now it can be called a plugin with more reason.  True, without a single method. <br><br><h2>  Other scripts for working with DOM </h2><br>  Such attention is paid to one script, not the most advanced, because if you look ahead, it turns out to be a small competitor to the Canvas scripts, not the one above, but well, economically written.  Inefficiently written will not become competitors, so the code can not allow anything extra, so that there is something to compare with. <br><br>  For example, there is a very popular DOM script called <a href="https://github.com/scottschiller/snowstorm/">Snowstorm</a> , with compressed code of 20K, a very large number of settings, disabling in mobile devices - there is something to learn for small scripts.  But to study what is there too much and whether it leads to losses is too difficult a task.  It's easier to write small and expand settings.  The significance of each is found out on tests and practice. <br><br>  Quickly go through another small script that is not found among the well-designed demos and sandboxes, but has interesting behavior (mentioned above, by P.Gehrig).  There are no big difficulties in placing it in the sandbox - no bugs are required for modifications, jQuery does not use, but it took a lot of training for the modern doctype.  Also, it used to be bad with special Unicode characters in system fonts, now it is better, therefore, the falling letters are replaced with falling textual (highlighted) snowflakes. <br><table><tbody><tr><td colspan="2">  Year: 2005, <a href="http://spmbt.github.io/snowfalls/falling-snow.htm">falling-snow with settings</a> , <a href="https://github.com/spmbt/snowfalls/blob/gh-pages/falling-snow.htm">code</a> , <a href="https://jsfiddle.net/spmbt/haL5g3o7/1/">jsFiddle</a> </td></tr><tr><td>  Particles on demo: <b>25</b> </td><td rowspan="5"><img src="https://habrastorage.org/files/de0/550/5b4/de05505b41e44142ae57c970a26c6d8c.png"></td></tr><tr><td>  Type: <b>DOM</b> </td></tr><tr><td>  Sandbox?  <b>YES</b> </td></tr><tr><td>  Load: <b>10%</b> (due to 8 FPS) </td></tr><tr><td>  Code Lines: <b>90</b> </td></tr><tr><td colspan="2">  Such a small system load in the original script settings is caused by a low FPS exposure.  This, of course, is noticeable in the movements as a frequent slideshow.  It was necessary for old browsers and is warned in old comments to the script.  At 30 FPS - load 35%, about the same as the previous script will have with the same settings. <br><br>  This script has a modification with the addition of the Brownian motion and with the fall as if from a distance from the screen, increasing and melting (increasing transparency) near or below. <br></td></tr><tr><td colspan="2">  Year: 2006, <a href="http://falling-snow-brownmov.htm/">falling-snow with a "distant" fall with settings</a> , <a href="https://jsfiddle.net/spmbt/zqm64eq8/">jsFiddle</a> </td></tr><tr><td>  Particles on demo: <b>25</b> </td><td rowspan="5"> <a href=""><img src="https://habrastorage.org/files/5d6/253/db8/5d6253db8c1048efa45f2d8d54d341dd.png" width="605" height="382"><br></a>  <a href=""><i>(watch in full screen)</i></a> </td></tr><tr><td>  Type: <b>DOM</b> </td></tr><tr><td>  Sandbox?  <b>YES</b> </td></tr><tr><td>  Download to jsFiddle: <b>60%</b> (16 FPS) </td></tr><tr><td>  Code Lines: <b>100</b> </td></tr><tr><td colspan="2">  Here, the size settings are quite ‚Äúcapricious‚Äù - with a small change in the growth rate, you can get huge snowflakes or not growing, so other behavioral scenarios need to be selected, and the effectiveness will ultimately depend on the window size and behavior (it does not adjust itself).<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A noticeable increase in load is associated with drawing large transparent characters (images). </font><font style="vertical-align: inherit;">(The source code is written tightly, the actual amount of the code after thinning would be 2 times more.)</font></font><br></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's write all the variants of the code with snow on Gitkhab. </font><font style="vertical-align: inherit;">We take into account the shortcomings of predecessors who did not write demo pages, and therefore far fewer people looked at their code. </font><font style="vertical-align: inherit;">Github allows you to extremely easily run the demo, if you work in the gh-pages branch. </font><font style="vertical-align: inherit;">Now all versions of versions are easily recorded in the change history and the differences look. </font><font style="vertical-align: inherit;">Github: </font></font><a href="https://github.com/spmbt/snowfalls"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/spmbt/snowfalls</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What's up with CSS animations? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We look at examples written by others, further, in search of efficient algorithms and spectacular results. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. An example (almost the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only one with CSS animations</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) of heavily loading animation on CSS3 with rotating DOM snowflakes is </font></font><a href="http://www.jqueryscript.net/animation/jQuery-Plugin-For-Snowfall-Effect-with-Rotating-Snowflakes.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.jqueryscript.net/animation/jQuery-Plugin-For-Snowfall-Effect-with-Rotating-Snowflakes.html</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (This site has everything - description, code and demo for each script, but without sandboxes.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Animation on </font></font><a href="http://codepen.io/NickyCDK/pen/AIonk"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 picture layers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in CSS (Codepen). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We try to watch more animations on the canvas in order to find a script that does not heavily load the system.</font></font><br><br>    Canvas,    ,   ,     ‚Äî      200-300,   50-100   ‚Äî <a href="http://www.jqueryscript.net/animation/Yet-Another-Falling-Snow-Animation-with-jQuery-Canvas-GlauserChristmas.html">www.jqueryscript.net/animation/Yet-Another-Falling-Snow-Animation-with-jQuery-Canvas-GlauserChristmas.html</a> . <br><br>     Canvas  ,      : <a href="http://www.jqueryscript.net/animation/Nice-Snow-Falling-Effect-with-jQuery-Canvas-Nice-Snowing.html">www.jqueryscript.net/animation/Nice-Snow-Falling-Effect-with-jQuery-Canvas-Nice-Snowing.html</a> . <br><br>   ,  Canvas, -  ,     100% (,  ,     JS).        . <i>(,       .)</i> <br><br><h2> -    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Among the scripts with snow, there are very few load-saving processors, although they are for both the DOM and Canvas. </font><font style="vertical-align: inherit;">We show that the same effect of a full load can be achieved not for 100, but for a couple of thousand snowflakes, and it is better to consider normal load of a kernel by 10-20% for 200-400 pieces.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Choosing an effective Canvas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, there was one economical script on a clean Canvas. </font><font style="vertical-align: inherit;">We will do our examples approximately in his style.</font></font><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Year: 2015 </font></font></th><th colspan="2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Demo: </font></font><a href="http://thecodeplayer.com/walkthrough/html5-canvas-snow-effect"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snow Effect using HTML5 Canvas and Javascript</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , full screen</font></font></th><th> <a href="https://jsfiddle.net/spmbt/mbdardty/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copy on jsFiddle</font></font></a> </th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Particles on demo: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25</font></font></b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/519/1fb/5ae/5191fb5ae533450bbb0fcf6c42c8a1b4.png"></div></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canvas</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sandbox - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YES</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Download: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">45%</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code Lines: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90</font></font></b> </td></tr><tr><td colspan="4">  ,      ,     ,      ,   .    200  ( )  45% (  2  3  ‚Äî Chrome   Chrome helper)  60%  2000.  Firefox ‚Äî   ,    10%  (  )     . </td></tr></tbody></table><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But Canvas is problematic at low loads. The load with 2 particles is often 40-60% and the same for 25, and 0 for the non-started setInterval (). Any drawing of it loads the processor (at 30 FPS - 30 percent), and the volume of drawing does not matter much. Obviously, with a worse video card, the results will be worse, and somewhere we will stop seeing improvements, it will always start to slow down if there is a Canvas, and it will only be possible to fix it by decreasing the FPS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In more detail, the results are as follows. We take jsFiddle as less affecting the results, </font></font><a href="https://jsfiddle.net/spmbt/mbdardty/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copy the example with the addition</font></font></a>  .    ,   ,     (  ,   ).    Activity Monitor (MacBook   Intel HD Graphics 5000).    Windows, ,  4- ,      25%.     <b>100%     </b> , .. 25%     4.    -   ,        ,    ,     . <br><br>   -10%  (). <br> 0  ‚Äî 30%; <br> 2  ‚Äî 35%; <br> 25  ‚Äî 40%; <br> 200  ‚Äî 50%; <br> 1000 ‚Äî 55%; <br> 2000 ‚Äî 65%. <br>      ,        . <br><br>    ,    Canvas       . ,              ,       ¬´ ¬ª,     ,   ,        20%.         5     .     ,  IE8,   Canvas,   <a href="http://alexvaleev.ru/browserstat/2015/12/"> 0.5 </a> . <br><br><h2>     </h2><br>       .              ,      .   ,      .   ‚Äî ,      ,     . <br><br>      . <br><table><tbody><tr><th> : 2015 </th><th colspan="2"> <a href="http://spmbt.github.io/snowfalls/snow-canvasTorus.htm"></a>  : <a href="https://jsfiddle.net/spmbt/963b3cyg/1/">      </a> ,  ,    </th><th></th></tr><tr><td>   : <b>100</b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/7dc/9e7/fd8/7dc9e7fd80d643af92f2730dbf161be0.png"></div></td></tr><tr><td> : <b>Canvas</b> </td></tr><tr><td>  ‚Äî <b></b> </td></tr><tr><td> : <b>35%</b> </td></tr><tr><td>  : <b>50</b> </td></tr><tr><td colspan="4">     ,   ,    , ,        .  ¬´¬ª  ,       .  *.999     ¬´¬ª.     ,        .      ,      . <br><br>   ‚Äî   .       , , ,     (       ,  ). </td></tr><tr><th></th><th colspan="2"> <a href="http://spmbt.github.io/snowfalls/snow-canvasMelt.htm"> 2</a>  : <a href="https://jsfiddle.net/spmbt/963b3cyg/">     </a> ,   </th><th></th></tr><tr><td>   : <b>1000</b> </td><td rowspan="5" colspan="3"><div style="text-align:center;"><img src="https://habrastorage.org/files/bd1/969/22c/bd196922cb6d4527b4df08291868cf1a.png"></div></td></tr><tr><td> : <b>Canvas</b> </td></tr><tr><td>  ‚Äî <b></b> </td></tr><tr><td> : <b>40-50%</b> (30 FPS) </td></tr><tr><td>  : <b>50</b> </td></tr><tr><td colspan="4">     ,    :   ,     .         ¬´¬ª . <br><br>      ,    .       ,       .  . <br><br>    , ,      .            .      <a href="https://fiddle.jshell.net/spmbt/963b3cyg/9/show/light/">  </a> ,       ( <a href="http://jsfiddle.net/spmbt/963b3cyg/9/embedded/result,js,html,css/">  </a> , 30% , 120 ). </td></tr></tbody></table><br><br><h2>  Kafeman    </h2><br>          <a href="https://habrahabr.ru/users/kafeman/" class="user_link">kafeman</a> . <br>   ‚Äî  <a href="https://geekadm.ru/"> </a>      . <a href="http://46.101.141.171/snow.html%3Fv%3D4">   </a> ,      .    ,       ( <a href="https://www.youtube.com/watch%3Fv%3DHbgoKKj7TNA">1</a> , <a href="https://www.youtube.com/watch%3Fv%3DCx8n9jhN6aA">2</a> , <a href="https://www.youtube.com/watch%3Fv%3DRuqVnqNPyC0">3</a> )        . <a href="https://jsfiddle.net/yueuo01x/">   </a> ,     ,        .           . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we must somehow grow the snow cover: </font></font><a href="https://jsfiddle.net/162e4jte/3/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsfiddle.net/162e4jte/3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but not so that it swallows the entire planet with an astronaut on it. At first, he, too, lay down in bumps and melted: </font></font><a href="https://jsfiddle.net/162e4jte/1/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsfiddle.net/162e4jte/1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This behavior was found in the scripts of other authors. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, for the future, the idea of ‚Äã‚Äãcombining engine generators into one also deserves execution. According to the results, in addition to the mass of third-party scripts, we have 3-4 particle motion algorithms and 2 methods of implementation, the common parts of which are well enough represented by the sandboxes and repos that are tracked.</font></font><br><br>  Some statistics.        <a href="https://www.google.com/trends/explore">    Javascript</a> ,   <a href="https://www.google.com/trends/explore"> </a> ‚Äî ,    <a href="https://www.google.com/trends/explore">Canvas  Javascript</a> ‚Äî .   ,       . <br><br><h2>  Conclusion </h2><br> 2        ‚Äî DOM-  Canvas ‚Äî    .   50   DOM,     ,  ,      .    .  50 (  ‚Äî  200) ‚Äî       ‚Äî  Canvas.       ‚Äî  30%  .    ‚Äî      , ,     .     ¬´¬ª  5 ,         ,     200   DOM   5000  Canvas. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All the excess of the algorithm for a typical commercial application (the user's attention in the area of ‚Äã‚Äãholidays) must be removed, tested algorithms on different devices and make decisions about the niche of user coverage. There may be more advantageous low-rate illumination on the Canvas or short-term fireworks on it. It does not hurt to tell which button to turn off the animation and to remember in the settings of the user that the action has worked. Since the snow is not as cash as the Yandex browser, there is no reason to "break" this button consciously. After another couple of years, one can hope that the situation with the canvas will improve, and he will slowly select for himself an area of ‚Äã‚Äãa small number of particles and an increased bitrate.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The expressive possibilities of snow scripts are mostly exhausted at this stage (nothing qualitatively new has appeared in recent years in this group). Sufficiently completed scripts have a number of properties that are recognized as necessary, and some properties that are impossible to perform in terms of performance (rotating snowflakes in 3D format) are not performed, but this does not bother anyone. But because of the productive rendering on the canvas, you can expect such scripts to appear (with a load of 30%). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perspectives of coding - you can write constructors that would give an object for the DOM or Canvas according to the settings. Designers could write different authors. With this approach, a project was organized in HabraADM (Githab): </font></font><a href="https://github.com/clubadm/snowmachine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/clubadm/snowmachine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Run the current code from this repo </font></font><a href="https://jsfiddle.net/9qxyq2vj/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via jsFiddle</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div><p>Source: <a href="https://habr.com/ru/post/274535/">https://habr.com/ru/post/274535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274519/index.html">Programming microcomputer LEGO NXT Mindstorms 2.0. Introduction</a></li>
<li><a href="../274523/index.html">Angular 2 vs. React: And there will be blood</a></li>
<li><a href="../274527/index.html">Solving the puzzle Galakub on Python</a></li>
<li><a href="../274529/index.html">Sound Manager for small games and prototypes on Unity</a></li>
<li><a href="../274533/index.html">Deanonymization of a programmer is possible not only through the source code, but also through a compiled binary file</a></li>
<li><a href="../274539/index.html">Configure logrotate + access to collect logs via SFTP</a></li>
<li><a href="../274545/index.html">Method Swizzling and Swift: but there is a nuance</a></li>
<li><a href="../274547/index.html">IBM has released more than 100 business applications with Apple</a></li>
<li><a href="../274549/index.html">Results of 2015 for C ++</a></li>
<li><a href="../274555/index.html">PayPal API Go Client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>