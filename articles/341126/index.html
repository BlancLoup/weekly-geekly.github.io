<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vibe.js - an attempt to make state management without pain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All yo, habrazhiteli. 


 In general, it happened that I have been writing in JavaScript for quite a long time, and one of the most important tasks ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vibe.js - an attempt to make state management without pain</h1><div class="post__text post__text-html js-mediator-article"><p>  All yo, habrazhiteli. </p><br><p>  In general, it happened that I have been writing in JavaScript for quite a long time, and one of the most important tasks has always been the organization of the application state. <br>  Tl;  DR; <br>  There is nothing more familiar in the world <br>  How to write a wheel on a bicycle </p><br><p>  I want to cache something, update something, and update everywhere, and not just in the local component, I don‚Äôt want to redraw the entire component if the entire Store has changed (shout out to Vuex), but I want to subscribe to what you use (shout out to MobX). </p><a name="habracut"></a><br><p>  I really disliked several aspects of Redux: </p><br><p>  1) Too much boilerplate code.  Of course, there are many ways and approaches to make mutations more pleasant for programmers, but nevertheless, all the same, this part is overloaded with IMHO. </p><br><p>  2) Fragmentation of entities.  At one time, when I wrote mobile applications on ReactNative, we worked with the JSON API server, that is, it returned an answer in the <a href="http://jsonapi.org/">json api specification</a> format, including the entities and relations of these entities.  I really liked the specification, although at first I did not dub.  And immediately an example of a problem: we have a list of dialogs, we entered a dialogue - the user is online there.  Returned to the list of dialogs - user is offline.  I think it is familiar to users of the VC. </p><br><p>  In Vuex, in principle, I like everything, but the problem of the fragmentation of entities is not solved there are nuances. </p><br><h2 id="v-chem-ideya-vibejs">  What is the idea of ‚Äã‚ÄãVibe.js </h2><br><p>  When I wrote the proof of concept, I was repelled by the following ideas: </p><br><p> 1) I want the entity to be in one place.  As in the database: 1 id = 1 entity. <br>  2) I want to be able to subscribe only to the necessary entities. <br>  3) At the same time, I want to combine different entities and attributes so as not to turn up a bunch of subscriptions to the necessary entities each time. <br>  4) I want to be able to directly reactively update the state - <code>entity.name = "Vasiliy"</code> , but at the same time be able to make mutations with payload and somehow debug mutations, at least, for example, by adding a text message to them. </p><br><h2 id="chto-poluchilos">  What happened </h2><br><p>  Now in Vibe.js there are the following concepts: </p><br><h3 id="model-entitysubject">  Model, EntitySubject </h3><br><p>  A class that allows you to define an entity model. <br>  Usage example: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">structure</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: types.Attribute, <span class="hljs-attr"><span class="hljs-attr">bestFriend</span></span>: types.Reference(<span class="hljs-string"><span class="hljs-string">'User'</span></span>), <span class="hljs-attr"><span class="hljs-attr">additionalInfo</span></span>: { <span class="hljs-attr"><span class="hljs-attr">age</span></span>: types.Attribute } }, <span class="hljs-attr"><span class="hljs-attr">computed</span></span>: { bestFriendsName(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bestFriend &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bestFriend.name || <span class="hljs-string"><span class="hljs-string">"No best friend :C"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">mutations</span></span>: { setName(newName){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mutate({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: newName }, <span class="hljs-string"><span class="hljs-string">"User.setName"</span></span>) } } });</code> </pre> <br><p>  The constructor allows you to describe the structure of the entity, the calculated values, as well as mutations. <br>  The structure can be described using <code></code> , <code></code> or nested objects. </p><br><p>  I note that the username can be changed directly: <code>someUser.name = "New name"</code> , <br>  but mutations are a more standardized approach. </p><br><p>  The model instance itself can do almost nothing - it only stores the structures from the constructor. </p><br><p>  If we want to add an entity: </p><br><pre> <code class="javascript hljs">User.insertEntity(<span class="hljs-number"><span class="hljs-number">1</span></span>, { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Yura"</span></span>, <span class="hljs-attr"><span class="hljs-attr">bestFriend</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-comment"><span class="hljs-comment">// sad when the best friend of yourself is you additionalInfo: { age: 17 } });</span></span></code> </pre> <br><p>  If any values ‚Äã‚Äãare not specified, the default <code>null</code> will be used.  To use this entity now, we call the <code>observe</code> method. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entity = User.observe(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = entity.interface; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(user.name) <span class="hljs-comment"><span class="hljs-comment">// -&gt; "Yura"</span></span></code> </pre> <br><p>  There is a nuance, yes?  Too much to write to work with the entity.  On the lines. </p><br><p>  1) <code>entity</code> = <code>EntitySubject</code> instance.  It subscribes to entity changes and updates the <code>interface</code> .  You can also subscribe to it. <br>  2) <code>interface</code> = Reactive interface for working with an entity.  It has values ‚Äã‚Äãfor the state of the entity, computed values ‚Äã‚Äãand mutations.  It should be noted that if the entity does not yet exist in the <code>EntityStore</code> , then <code>entity.interface</code> will be `null. </p><br><h3 id="entitystore">  EntityStore </h3><br><p>  This, as the name implies, is the entity repository.  It stores all states, all <code>observable</code> , models and contains methods used by <code>Model</code> or <code>Subject</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">structure</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: types.Attribute, <span class="hljs-attr"><span class="hljs-attr">bestFriend</span></span>: types.Reference(<span class="hljs-string"><span class="hljs-string">'User'</span></span>), <span class="hljs-attr"><span class="hljs-attr">additionalInfo</span></span>: { <span class="hljs-attr"><span class="hljs-attr">age</span></span>: types.Attribute } }, <span class="hljs-attr"><span class="hljs-attr">computed</span></span>: { bestFriendsName(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bestFriend &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bestFriend.name || <span class="hljs-string"><span class="hljs-string">"No best friend :C"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">mutations</span></span>: { setName(newName){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mutate({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: newName }, <span class="hljs-string"><span class="hljs-string">"User.setName"</span></span>) } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityStore([User]);</code> </pre> <br><p>  We initialize our entity store with an array of models so that the <code>EntityStore</code> can then link all relationships, links, subscriptions ... </p><br><h3 id="directory-directorysubject">  Directory, DirectorySubject </h3><br><p>  Directories are similar to singleton entities.  They are not identifiers, they are static.  Also, they do not need to be specified when initializing the <code>EntityStore</code> , because entities cannot subscribe to them.  In essence, directories are "directories" that have some kind of local state in the form of attributes and an entity reference. </p><br><p>  For example, if we look at books in an online store, then such a directory could be used: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EntityStore([Book]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BooksList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Directory(<span class="hljs-string"><span class="hljs-string">'BooksList'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">structure</span></span>: { <span class="hljs-attr"><span class="hljs-attr">page</span></span>: types.Attribute, <span class="hljs-attr"><span class="hljs-attr">searchWord</span></span>: types.Attribute, <span class="hljs-attr"><span class="hljs-attr">fetchedBooks</span></span>: types.Array(types.Reference(Book.name)) } }, Store);</code> </pre> <br><p>  Directories also support computed values ‚Äã‚Äãand mutations, and you can also subscribe to them. </p><br><h3 id="a-chto-naschet-podpisok">  What about subscriptions? </h3><br><p>  Vibe.js is organized so that an entity or directory will be subscribed only to those entities that are currently in their state.  That is, if we have an array of displayed elements in the directory and replace it, then after changing the state, it will be written from the entities from the previous array and will be signed only with new ones. </p><br><h3 id="nu-i-vse-eto-protestirovano">  Well, all this is tested </h3><br><p>  Or not all.  I love to write tests and I want to write more of them, because it seems to me that they are not enough.  In that regard, they do not cover everything that can go wrong. </p><br><h3 id="ssylki">  Links </h3><br><p>  <a href="https://github.com/enchantinggg4/vibejs">Github library repository</a> </p><br><p>  <a href="https://www.npmjs.com/package/vibejs">NPM module</a> </p><br><p>  <a href="https://github.com/enchantinggg4/vibe-examples">Repository with an example Todo list on react</a> </p><br><p>  <a href="http://vibe-js.github.io/">Github pages with generated ESDOC documentation</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341126/">https://habr.com/ru/post/341126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341114/index.html">Another virtual machine architecture (part two)</a></li>
<li><a href="../341116/index.html">‚ÄúI will find out! I recognize my brother Kohl! "- The realities of modern information security in the field of wireless technologies</a></li>
<li><a href="../341118/index.html">Those. support. How much money can you make on this? (Part 2 - "Abroad")</a></li>
<li><a href="../341120/index.html">The project is blind: we dive headlong</a></li>
<li><a href="../341122/index.html">Yulmart game theory</a></li>
<li><a href="../341128/index.html">Economic experiments in virtual reality</a></li>
<li><a href="../341130/index.html">Chronology of CO level in the atmosphere of the USA (solution of the Kaggle problem using Python + Feature Engineering)</a></li>
<li><a href="../341132/index.html">Environment for developing TypeScript and React web applications: from 'hello world' to modern SPA. Part 2</a></li>
<li><a href="../341134/index.html">Design pattern "state" twenty years later</a></li>
<li><a href="../341138/index.html">Step-by-step tutorial on working with Antlr4 with Maven project for Java through Intellij Idea</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>