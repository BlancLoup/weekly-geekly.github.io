<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QML and C ++. We chase the data, we estimate the speed of interaction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About how to send data from QML to C ++ and after manipulating them to return them (data) back, it has already been repeatedly told . Most articles pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QML and C ++. We chase the data, we estimate the speed of interaction</h1><div class="post__text post__text-html js-mediator-article">  About how to send data from QML to C ++ and after manipulating them to return them (data) back, it has already been repeatedly <a href="http://habrahabr.ru/post/138837/">told</a> .  Most articles provide the same examples or, at best, slightly modified by the authors of the articles. <br><br>  Let's look at a couple of the most explicit ways to transfer data from QML to C ++ and vice versa.  We also estimate their effectiveness. <a name="habracut"></a><br><br><h4>  Well, let's start </h4><br>  We take the simplest thing that can come to mind: there is a window with text, when you click on the text, we need to do some manipulations with this text using c ++ tools and then show the final version in the same window. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The first version of the implementation of such a complex task:</b> from QML we call the slot described in the C ++ class and pass it our text.  After changing the text, we call the signal and along with this signal we transmit the modified text to QML. <br><br>  File <b>main.cpp</b> |  We create an instance of a class in which our signal and slot are described, we declare a context property (as if we pass a link to our class in qml) <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QApplication&gt; #include "qmlapplicationviewer.h" #include &lt;QDeclarativeContext&gt; #include "asd.h" Q_DECL_EXPORT int main(int argc, char *argv[]) { QScopedPointer&lt;QApplication&gt; app(createApplication(argc, argv)); QmlApplicationViewer viewer; asd ASD; viewer.rootContext()-&gt;setContextProperty("ASD", &amp;ASD); viewer.setOrientation(QmlApplicationViewer::ScreenOrientationAuto); viewer.setMainQmlFile(QLatin1String("qml/habr1/main.qml")); viewer.showExpanded(); return app-&gt;exec(); }</span></span></span></span></code> </pre> <br><br>  File <b>asd.h</b> (header of our class with signal and slot) <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> ASD_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ASD_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QObject&gt; class asd : public QObject { Q_OBJECT public: explicit asd(QObject *parent = 0); signals: void transmitNewText(QString text); public slots: void getOldText(QString text); }; #endif // ASD_H</span></span></span></span></code> </pre><br><br>  File <b>asd.cpp</b> (we describe our slot) |  As can be seen from the code, the slot accepts the text, adds the word to it and then calls the signal <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"asd.h"</span></span></span><span class="hljs-meta"> asd::asd(QObject *parent) : QObject(parent) { } void asd::getOldText(QString text){ emit transmitNewText(text + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" Hello!"</span></span></span><span class="hljs-meta">); }</span></span></code> </pre><br><br>  Well, <b>main.qml</b> (our window with the text) |  By clicking the mouse button (onClicked), we call the slot and wait for the signal (onTransmitNewText) upon receipt of which we change the text of the message in our window <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.1</span></span> Rectangle { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">360</span></span> height: <span class="hljs-number"><span class="hljs-number">360</span></span> Connections { <span class="hljs-attr"><span class="hljs-attr">target</span></span>: ASD onTransmitNewText: text1.text = text } Text { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: text1 text: qsTr(<span class="hljs-string"><span class="hljs-string">"Hello World."</span></span>) anchors.centerIn: parent } MouseArea { anchors.fill: parent onClicked: ASD.getOldText(text1.text) } }</code> </pre><br><br>  At this boring part ends.  Let's turn it on and see how long it takes to call a slot and send our modified text with a signal. <br><br><img src="https://habrastorage.org/storage2/0ad/d00/e5a/0add00e5ac152f4808dbfe515fa026d2.png"><br><br>  For the purity of the experiment, click on the text 20 times: <br><img src="https://habrastorage.org/storage2/073/8a0/ad0/0738a0ad0929bdb99048a97d4bbfa35d.png"><br><br>  We see two lines called ‚ÄúSignals‚Äù.  Open the timeline, make sure that to estimate the speed of the whole process, we need only the top line from our picture, since  namely, it lasts from the beginning of the call to the time the signal is sent: <br><img src="https://habrastorage.org/storage2/070/52c/caf/07052ccaf6b5ba6d644e5842ee29f76c.png"><br><br>  <b>The second embodiment:</b> when you click on the text, we generate a signal, connect this signal to the slots of a class already familiar to us, after which we call the same signal all the same way after changing the text and respond to it with the slot described in QML. <br><br>  At first glance it may seem that this will take more time than in the first version. <br><br>  We change our <b>main.cpp</b> (everything is simple and clear here, we connect slots and signals) <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QApplication&gt; #include "qmlapplicationviewer.h" #include &lt;QGraphicsObject&gt; #include "asd.h" Q_DECL_EXPORT int main(int argc, char *argv[]) { QScopedPointer&lt;QApplication&gt; app(createApplication(argc, argv)); QmlApplicationViewer viewer; viewer.setOrientation(QmlApplicationViewer::ScreenOrientationAuto); viewer.setMainQmlFile(QLatin1String("qml/habr2/main.qml")); asd ASD; QObject *qml = viewer.rootObject(); QObject::connect(qml, SIGNAL(transmitOldText(QString)), &amp;ASD, SLOT(getOldText(QString))); QObject::connect(&amp;ASD, SIGNAL(transmitNewText(QVariant)), qml, SLOT(getNewText(QVariant))); viewer.showExpanded(); return app-&gt;exec(); }</span></span></span></span></code> </pre><br><br>  <b>asd.h</b> (slightly change the heading of our class) |  because  In qml, when defining a function, you cannot explicitly specify the data type, you have to replace <i>QString</i> with <i>QVariant</i> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> ASD_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ASD_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QObject&gt; #include &lt;QVariant&gt; class asd : public QObject { Q_OBJECT public: explicit asd(QObject *parent = 0); signals: void transmitNewText(QVariant text); public slots: void getOldText(QString text); }; #endif // ASD_H</span></span></span></span></code> </pre><br><br>  <b>asd.cpp</b> (added the same <i>QVariant</i> ) <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"asd.h"</span></span></span><span class="hljs-meta"> asd::asd(QObject *parent) : QObject(parent) { } void asd::getOldText(QString text){ emit transmitNewText(QVariant(text + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" Hello!"</span></span></span><span class="hljs-meta">)); }</span></span></code> </pre><br><br>  Well, our new window <b>main.qml</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QtQuick <span class="hljs-number"><span class="hljs-number">1.1</span></span> Rectangle { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: rth width: <span class="hljs-number"><span class="hljs-number">360</span></span> height: <span class="hljs-number"><span class="hljs-number">360</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNewText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">)</span></span>{ text1.text = text } signal transmitOldText(string text) Text { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: text1 text: qsTr(<span class="hljs-string"><span class="hljs-string">"Hello World."</span></span>) anchors.centerIn: parent } MouseArea { anchors.fill: parent onClicked: transmitOldText(text1.text) } }</code> </pre><br><br>  Check how much time we need this time: <br><img src="https://habrastorage.org/storage2/2aa/2db/3e2/2aa2db3e2e7d09ec36121dc38a3e5938.png"><br><br><h4>  At the request of readers, we add to our testing function that returns the value </h4><br>  So, <b>main.cpp</b> remains exactly as it was in the first version.  All the context property is also declared (reference to an instance of our class) <br><pre> <code class="cpp hljs">asd ASD; viewer.rootContext()-&gt;setContextProperty(<span class="hljs-string"><span class="hljs-string">"ASD"</span></span>, &amp;ASD);</code> </pre><br><br>  Slightly change our C ++ slot (now it returns a value) <br><pre> <code class="cpp hljs">QString asd::getOldTextTransmitNewText(QString text){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text + <span class="hljs-string"><span class="hljs-string">" Hello!"</span></span>; }</code> </pre><br><br>  Then we change <b>main.qml a</b> little <br><pre> <code class="javascript hljs">MouseArea { anchors.fill: parent onClicked: text1.text = ASD.getOldTextTransmitNewText(text1.text) }</code> </pre><br><br>  Turn on, look at the time spent: <br><img src="https://habrastorage.org/storage2/6f0/063/1d7/6f00631d70d4e8f4f8cdce687698661d.png"><br><br>  Same option, only with <i>Q_INVOKABLE</i> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Q_INVOKABLE QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOldTextTransmitNewText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QString text)</span></span></span></span>;</code> </pre><br><br>  It turns out quite a bit slower slots: <br><img src="https://habrastorage.org/storage2/60f/f4b/801/60ff4b8010021810025fc291826e7ce1.png"><br><br><h4>  Summing up (I remind you that the milliseconds given are the sum for 20 calls) </h4><br>  The longest was the first method (calling a slot from qml followed by catching the signal): <b>14.885 ms</b> . <br>  The second option (where we connected slots and signals) turns out to be faster: <b>13.993 ms</b> . <br>  The fastest option is to call a function that returns a value: <b>13.456 ms</b> .  for slot and <b>13.508 ms</b> .  for <i>Q_INVOKABLE</i> (within the margin of error). <br><br>  Yes, the thing, of course, is not very noticeable, but no one expected the difference in milliseconds at 20. You can refer to the error, but with repeated repetition of this experiment, if I may say so, the experiment, the result turned out to be approximately equal to that given in this article. <br><br>  <b>Why and for whom was</b> all this done?  For some reason this thought came to my mind, for I had never dealt with such ‚Äúnonsense‚Äù.  Well, after I decided to share the results with you. </div><p>Source: <a href="https://habr.com/ru/post/171341/">https://habr.com/ru/post/171341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171329/index.html">Add WDS universality</a></li>
<li><a href="../171331/index.html">About abstraction, loosely coupled architecture and design in general</a></li>
<li><a href="../171335/index.html">Change of programming paradigm to C #, transition to signals and queues (slots)</a></li>
<li><a href="../171337/index.html">Podcast ‚Ññ294. Startup industry and Internet business news: February 25 - March 1</a></li>
<li><a href="../171339/index.html">Automatic generation of typed data structures for C</a></li>
<li><a href="../171343/index.html">Development of an online store of 13,000+ products on the MODX Revolution. Part 1</a></li>
<li><a href="../171351/index.html">Russian Wikipedia again overtook Spanish</a></li>
<li><a href="../171353/index.html">Voting for 2013 setyanina</a></li>
<li><a href="../171355/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 11</a></li>
<li><a href="../171357/index.html">Popularly about the genealogy of 3D printers. Who is who?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>