<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GrSecurity / PaX: preset security level</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(An article for those already in the subject. The rest will be more interesting to first read my previous articles about Hardened Gentoo: description ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GrSecurity / PaX: preset security level</h1><div class="post__text post__text-html js-mediator-article"> (An article for those already in the subject. The rest will be more interesting to first read my previous articles about Hardened Gentoo: <a href="http://habrahabr.ru/blogs/linux/13094/">description</a> , <a href="http://habrahabr.ru/blogs/linux/13095/">installation</a> , <a href="http://habrahabr.ru/blogs/linux/13097/">configuration</a> , <a href="http://habrahabr.ru/blogs/linux/13098/">impressions</a> .) <br><br>  It will be about setting up <a href="https://ru.wikipedia.org/wiki/Grsecurity">GrSecurity</a> / <a href="https://ru.wikipedia.org/wiki/PaX">PaX</a> (I gave Russian-language links, but English-language ones are <a href="https://en.wikipedia.org/wiki/Grsecurity">much more</a> <a href="https://en.wikipedia.org/wiki/PaX">informative</a> ) in the linux kernel.  Everything described above is relevant for <a href="https://ru.wikipedia.org/wiki/Hardened_Gentoo">Hardened Gentoo</a> (kernel 3.1.5), but applicable in any distribution (there will not be any pre-installed Gentoo security level workstation / server / virtualization, but according to my description in this article, they will be easily implemented manually). <br><br>  In addition, I conducted a small performance test to determine how much the use of GrSecurity / PaX slows down the system.  The tests were conducted on Core2Duo in a 32-bit OS in single user mode on compiling the kernel with -j3, the average user + sys was taken over three runs (the kernel build speed was compared with the reference one: with GrSecurity and PaX disabled in the core and using the usual, not hardened , gcc). <br><a name="habracut"></a><br>  So, we have 6 preset security levels ( <code>Security options ‚Üí Grsecurity ‚Üí Security Level</code> ): <ol><li>  Low </li><li>  Medium </li><li>  High </li><li>  Hardened Gentoo [server] </li><li>  Hardened Gentoo [workstation] </li><li>  Hardened Gentoo [virtualization] </li></ol>  I did not test Low and Medium - I don‚Äôt think they are being used by anyone. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is a list of kernel options that differ between these security levels ("+" means that the option is turned on, "-" that the option is turned off, nothing - that the value of the option does not change): <table><tbody><tr><th></th><th>  high </th><th>  server </th><th>  ws </th><th>  virt </th></tr><tr><td>  CONFIG_X86_32_LAZY_GS </td><td>  - </td><td>  - </td><td></td><td></td></tr><tr><td>  CONFIG_CC_STACKPROTECTOR </td><td>  - </td><td>  - </td><td></td><td></td></tr><tr><td>  CONFIG_GRKERNSEC_IO </td><td></td><td>  + </td><td></td><td></td></tr><tr><td>  CONFIG_GRKERNSEC_KERN_LOCKOUT </td><td>  + </td><td></td><td></td><td></td></tr><tr><td>  CONFIG_GRKERNSEC_PROC_ADD </td><td>  + </td><td>  + </td><td></td><td></td></tr><tr><td>  CONFIG_GRKERNSEC_SYSFS_RESTRICT </td><td>  + </td><td></td><td></td><td></td></tr><tr><td>  CONFIG_GRKERNSEC_PROC_IPADDR </td><td></td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CONFIG_GRKERNSEC_RWXMAP_LOG </td><td></td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CONFIG_GRKERNSEC_SYSCTL </td><td></td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CONFIG_GRKERNSEC_SYSCTL_ON </td><td></td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CONFIG_PAX_PER_CPU_PGD </td><td>  + </td><td>  + </td><td>  + </td><td>  - </td></tr><tr><td>  CONFIG_PAX_ELFRELOCS </td><td>  + </td><td></td><td></td><td></td></tr><tr><td>  CONFIG_PAX_KERNEXEC </td><td>  + </td><td>  + </td><td>  + </td><td>  - </td></tr><tr><td>  CONFIG_PAX_KERNEXEC_MODULE_TEXT </td><td>  four </td><td>  four </td><td>  four </td><td>  - </td></tr><tr><td>  CONFIG_PAX_MEMORY_SANITIZE </td><td></td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CONFIG_PAX_MEMORY_UDEREF </td><td>  + </td><td>  + </td><td></td><td>  - </td></tr></tbody></table>  (Disabling CC_STACKPROTECTOR caused by the inclusion of PAX_MEMORY_UDEREF.) <br><br>  As you see, by switching between different levels, you can get different sets of options at the same level - for example, switching from server to workstation we will get UDEREF turned on, and switching from virtualization to workstation we will get disabled UDEREF.  This is the correct behavior, but it must be borne in mind in order not to forget to recheck all the settings after switching the predefined security levels. <br><br>  Next, here is a list of options that are not changed by any of the predefined security levels, i.e.  given completely under the control of the user (for convenience of perception, I will show them both in the CONFIG_ * format and in the menuconfig format): <br><pre> <code class="hljs erlang-repl">CONFIG_GRKERNSEC_ACL_HIDEKERN CONFIG_GRKERNSEC_EXECLOG CONFIG_GRKERNSEC_CHROOT_EXECLOG CONFIG_GRKERNSEC_AUDIT_PTRACE CONFIG_GRKERNSEC_AUDIT_CHDIR CONFIG_GRKERNSEC_AUDIT_TEXTREL CONFIG_GRKERNSEC_BLACKHOLE CONFIG_PAX_EMUTRAMP CONFIG_PAX_MPROTECT_COMPAT CONFIG_PAX_MEMORY_STACKLEAK Grsecurity ---&gt; [*] Grsecurity Role Based Access Control Options ---&gt; [ ] Hide kernel processes Kernel Auditing ---&gt; [ ] Exec logging [ ] Log execs within chroot [ ] Ptrace logging [ ] Chdir logging [ ] ELF text relocations logging (READ HELP) Network Protections ---&gt; [ ] TCP/UDP blackhole and LAST_ACK DoS prevention PaX ---&gt; [*] Enable various PaX features Non-executable pages ---&gt; [ ] Emulate trampolines [ ] Use legacy/compat protection demoting (read help) Miscellaneous hardening features ---&gt; [ ] Sanitize kernel stack</code> </pre><br>  All other GrSecurity / PaX options are enabled at all security levels. <br><br>  Now for performance.  The inclusion of all possible options that increase safety leads to a <b>5%</b> drop in performance.  Disabling CONFIG_PAX_MEMORY_STACKLEAK reduces the performance drop by up to <b>3%</b> .  Additional disconnection CONFIG_PAX_MEMORY_SANITIZE - up to <b>1%</b> .  Honestly, my personal opinion is that both of these options are absolutely not needed on workstations, and on most servers.  To lose 1% of performance in exchange for almost all the features of GrSecurity / PaX is definitely worth it, but decide whether to lose another 4% on these two features. <br><br>  And finally: the compatibility of all this with a regular home workstation - where you need Xs, proprietary drivers nvidia, skype and vmware.  At the moment, of course, in the future the situation may change. <ul><li>  Xorg.  Disable CONFIG_GRKERNSEC_IO. </li><li>  VMware.  You need to disable CONFIG_PAX_KERNEXEC and CONFIG_PAX_MEMORY_UDEREF.  If either (or both) of these options is enabled, then VMware overloads the host OS when trying to start the guest OS! </li><li>  Nvidia  If CONFIG_PAX_KERNEXEC is enabled, then you need to increase the CONFIG_PAX_KERNEXEC_MODULE_TEXT value from 4 (default) to 16 - the nvidia driver weighs ~ 10MB and, with a limit of 4MB, simply cannot boot. </li><li>  Skype  Now works without requiring special treatment.  Some time ago, version 2.2 did not start up with CONFIG_PAX_EMUTRAMP turned off (which is actually strange - firstly 2.1 worked fine without it, and secondly, for EMUTRAMP to work, you need to enable the option in the core, but also activate it via paxctl for a specific program , and 2.2 started to work without requiring activation via paxctl - most likely this was caused by a bug in the kernel, which was already fixed). </li><li>  Wireshark.  When started not under root, CONFIG_GRKERNSEC_BRUTE works and kills all processes of the current user for 15 minutes.  You must either disable this option or disable kernel.grsecurity.deter_bruteforce via sysctl (or simply do not run wireshark as a regular user until this bug is fixed).  <b>Update: I</b> just managed to catch this bug - the problem is in libpcap-1.1.1-r1, and in libpcap-1.2.1 it has already been fixed (wireshark still does not work under a normal user, but it does not crash anymore).  <b>Update2:</b> Disabling CONFIG_GRKERNSEC_SYSFS_RESTRICT and enabling CONFIG_NF_CT_NETLINK enables wireshark to work correctly under a regular user even on libpcap-1.1.1-r1. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/137171/">https://habr.com/ru/post/137171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137166/index.html">The results of the tender tender VKontakte to create smiles</a></li>
<li><a href="../137167/index.html">Announced the winners of the contest for smiles for VK</a></li>
<li><a href="../137168/index.html">Some details about Class Based View, part 1</a></li>
<li><a href="../137169/index.html">Social synchronization service. Looking for co-programmers</a></li>
<li><a href="../137170/index.html">VimCommander: working with a remote system via ssh</a></li>
<li><a href="../137172/index.html">Why I won't hire you</a></li>
<li><a href="../137173/index.html">Mozilla Firefox vibrates</a></li>
<li><a href="../137175/index.html">Casio CFX-9850G. Color graphing calculator, 1996</a></li>
<li><a href="../137177/index.html">PlanetLab Overview</a></li>
<li><a href="../137179/index.html">Notification of unread incoming letter using Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>