<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>X.509 Certificate Spurs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Monster oblo, mischievous, huge, gentleman and barking . 

 The set of technologies, which we habitually call SSL certificates, is a hefty iceberg, on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>X.509 Certificate Spurs</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <em>Monster oblo, mischievous, huge, gentleman and barking</em> . </blockquote><p> The set of technologies, which we habitually call SSL certificates, is a hefty iceberg, on top of which is a green lock to the left of the domain name in the address bar of your browser.  The correct name is <code>X.509 </code> , which dates back to <code>X.500</code> standard ITU-T <code>DAP (Directory Access Protocol)</code> .  DAP did not take off, in the IETF it was considered inconvenient for use with all these OSI piles and invented LDAP instead, Lightweight DAP where the first letter means "lightweight".  Those who had to tune, or worse, debug it can appreciate the irony to the fullest.  The first letter of the abbreviation has never lied like this, except for SNMP. </p><br><p><img src="https://habrastorage.org/webt/9x/id/rg/9xidrg1hkzutajsa7aszptcb1nm.png" alt="Spurs"></p><br><p>  By the way, what do LDAP, SNMP and X.509 have in common, besides the fact that they will not soon have to assemble stadiums of fans?  They are united by <strong>ASN.1</strong> - a meta-language for describing objects of antiquity.  If these technologies were created now, <em>XML, DTD</em> or some other ML would be used.  But at the time, standards were created by titans, for whom even SNMP was a simple matter. </p><a name="habracut"></a><br><h2 id="slovarnyy-zapas">  Lexicon </h2><br><p>  The definition of X.509 certificates is in <a href="http://www.itu.int/rec/T-REC-X.509-200508-S">the ITU-T archive</a> </p><br><pre> <code class="hljs pgsql">Certificate ::= <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> { tbsCertificate TBSCertificate, signatureAlgorithm AlgorithmIdentifier, signatureValue <span class="hljs-type"><span class="hljs-type">BIT</span></span> STRING } TBSCertificate ::= <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>] EXPLICIT <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> v1, serialNumber CertificateSerialNumber, signature AlgorithmIdentifier, issuer <span class="hljs-type"><span class="hljs-type">Name</span></span>, validity Validity, subject <span class="hljs-type"><span class="hljs-type">Name</span></span>, subjectPublicKeyInfo SubjectPublicKeyInfo, issuerUniqueID [<span class="hljs-number"><span class="hljs-number">1</span></span>] IMPLICIT UniqueIdentifier OPTIONAL, <span class="hljs-comment"><span class="hljs-comment">-- If present, version MUST be v2 or v3</span></span></code> </pre> <br><p>  In order to thoroughly understand the notation and syntax, it is necessary to read the <a href="https://www.itu.int/rec/T-REC-X.680-201403-S!Cor2/en">specs of the X.680 edition of 2008</a> , where there is a full description of <strong>ASN.1</strong> .  In terms of <strong>ASN.1,</strong> <code>SEQUENCE</code> means roughly the same as the <code>struct</code> in C.  This can be confusing, because by semantics it should have been more likely to correspond to an array.  And yet. </p><br><p>  The X.690 standard defines the following rules for encoding data structures created in accordance with <strong>ASN.1</strong> : <code>BER</code> (Basic Encoding Rules), <code>CER</code> (Canonical Encoding Rules), <code>DER</code> (Distinguished Encoding Rules).  There is even <code>XER</code> (XML Encoding Rules), <a href="https://www.itu.int/en/ITU-T/asn1/Pages/xer.aspx">which</a> I have never met in practice. </p><br><p>  Yes, but why do we need X.509 certificates that deliver so much headache?  <strong>The first</strong> and main function of X.509 certificates is to serve as a <em>public key or public key</em> storage (PKI).  There are no complaints about this function, but the second one is not so simple. </p><br><p>  <strong>The second</strong> function of X.509 certificates is that the bearer of this person is accepted by a person, or the program as the true owner of a certain digital asset: a domain name, a web site, etc. This turns out differently, not all certificates have high liquidity, if use financial terminology.  Six months ago, Google <a href="https://goo.gl/i4ovo5">threatened</a> Simantec companies that they would no longer trust their certificates due to the fact that they issued as many as 30,000 faulty certificates. </p><br><h2 id="nomenklatura-sertifikatov">  Nomenclature of certificates </h2><br><p>  Let's look at what X.509 certificates are found in nature, if we consider them by location in <del>  food grade </del>  chain of trust. </p><br><ul><li>  <strong>Root certificates</strong> are made in the root CA (certifying center) and have the following attributes: the <code>issue</code> and <code>subject</code> attributes are identical, and in the <code>basicConstraints</code> extension, the <code>basicConstraints</code> attribute is <code>TRUE</code> . </li><li>  <strong>Intermediate certificates</strong> - a vague term for certificates not signed by the root CA, which can form a chain of arbitrary length, starting from the <em>root certificate</em> and ending with the <em>certificate of the final subject</em> . </li><li>  <strong>End-entity</strong> certificates are final certificates in a chain that cannot sign other <em>intermediate certificates</em> with their private key. </li></ul><br><p>  By degree <del>  steepness </del>  expensive and reliable certificates are divided into 3 types: <strong>DV</strong> , <strong>OV</strong> and <strong>EV</strong> . </p><br><ul><li>  <strong>DV</strong> - Domain Name Identity Certificates are easy to get.  They are issued automatically and instantly after the certificate authority verifies that the applicant has the right to the domain name.  Most often, it‚Äôs enough to open a message and follow the link.  Naturally, the message will be sent to the mailbox with a domain name that should be verified. </li><li>  <strong>OV</strong> - not the domain name will be indicated in the certificate, but the name of the applicant‚Äôs organization itself.  There is already no automatic speech dispensing, it will take several working days.  The availability of the name of the applicant‚Äôs organization in the <code>whois</code> database is subject to verification.  Can check the state registration and the validity of the phone number. </li><li>  <strong>EV</strong> - these certificates and get hard and they are not cheap.  They can be identified by the name of the organization on the green lock on the address bar panel. <br><br><img src="https://habrastorage.org/webt/17/s0/i6/17s0i6vxrotekhjiwgkpvkekte0.png" alt="EV certificate"></li></ul><br><p>  Rarely, who is ready to fork out for it.  Offhand Yandex, StackOverflow.com and Habr can live without it.  But those who are willing to make sacrifices for this must fulfill the following requirements: </p><br><ol><li>  Audit of legal, physical and operational activities of the organization. </li><li>  You should make sure that the organization has the exclusive right to use the domain name. </li><li>  You must make sure that the organization is authorized to issue a certificate of this type. </li></ol><br><p>  More details can be found in <a href="https://habrahabr.ru/company/tuthost/blog/150433/">Hutrapes company TutHost</a> .  Also, the <code>subject</code> attribute of the X.509 EV certificate contains the <code>jurisdictionOfIncorporationCountryName</code> , <code>businessCategory</code> , and <code>serialNumber</code> . </p><br><p>  By their properties, certificates are of the following types. </p><br><ul><li>  <strong>Multi-Domain Certificates</strong> ‚Äî A certificate can span multiple domain names using <code>SAN</code> , the <code>subjectAltName</code> attribute. </li><li>  <strong>Multi-host certificates</strong> - in cases where the <code>subject</code> attribute contains the <code>CN=example.net</code> record, while the DNS server can have several <code>A / AAAA</code> type, where one host name can correspond to several IP addresses.  In this case, an X.509 certificate with the same <code>hostname</code> can be successfully restored on all such nodes. </li><li>  <strong>Certificates with the possibility of substitution, wildcard certificates</strong> - this is when the <code>subject</code> attribute contains the entry <code>CN=*.example.net</code> .  It works the same way as in usual regular expressions, that is, it can be used on all sub-domains <code>*.example.net</code> . </li><li>  <strong>Qualified Certificates</strong> - <a href="https://tools.ietf.org/html/rfc3739">RFC 3739</a> defines this term as referring to <em>personal</em> certificates, referring to the <em>European Union's Electronic Signature Directive</em> .  In particular, RFC allows the <code>subject</code> attribute to contain values: <br><ul><li>  commonName (CN =), </li><li>  givenName (GN =), </li><li>  pseudonym =. <br><br>  Also <code>subjectDirectoryAttributes</code> includes the values: </li><li>  dateOfBirth =, </li><li>  placeOfBirth =, </li><li>  gender =, </li><li>  countryOfCitizenship =, </li><li>  countryOfResidence =. </li></ul></li></ul><br><p>  In Russia, the concept of a QS of a <em>qualified certificate is</em> <a href="http://r77.center-inform.ru/support/qualified-certificate/">defined by law</a> in connection with access to state services.  By <a href="https://habrahabr.ru/post/325998/">slander</a> Habrapost with the epic about the extraction of personal data from the COP. </p><br><h2 id="otkuda-berutsya-sertifikaty">  Where do certificates come from? </h2><br><p>  More recently, there were only 2 ways to get the X.509 certificate, but times have changed and there is a third way since recently. </p><br><ol><li>  Create your own certificate and sign it yourself.  Pros - it's free, cons - the certificate will be accepted only by you and, at best, by your organization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/hz/1b/bz/hz1bbztu4oyvmgxcfam2lm2-umg.png" alt="not trusted"></li><li>  Purchase a certificate in the CA.  It will cost money depending on its various characteristics and capabilities mentioned above. </li><li>  <a href="https://habrahabr.ru/post/270273/">Get a</a> free <a href="https://letsencrypt.org/">LetsEncrypt</a> certificate, only the simplest <strong>DV</strong> certificates are available. </li></ol><br><p>  For the first scenario, a couple of commands are enough and in order not to get up 2 times, we will create a certificate with an algorithm of <strong>elliptic curves</strong> .  The first step is to create a private key.  It is believed that encryption with an elliptic curve algorithm provides <a href="https://blog.cloudflare.com/ecdsa-the-digital-signature-algorithm-of-a-better-internet/">greater exhaust</a> , if measured in CPU cycles, or bytes of the key length.  ECC support is <em>not</em> uniquely defined in TLS &lt;1.2. </p><br><pre> <code class="hljs cs">openssl ecparam -name secp521r1 -genkey -param_enc <span class="hljs-keyword"><span class="hljs-keyword">explicit</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>-key.pem</code> </pre> <br><p>  Next, it creates a CSR - certificate signing request. </p><br><pre> <code class="hljs cs">openssl req -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -sha256 -key <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> server.csr -days <span class="hljs-number"><span class="hljs-number">730</span></span></code> </pre> <br><p>  And sign up. </p><br><pre> <code class="hljs cs">openssl x509 -req -sha256 -days <span class="hljs-number"><span class="hljs-number">365</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> server.csr -signkey <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>.crt</code> </pre> <br><p>  The result can be viewed with the command: </p><br><pre> <code class="hljs pgsql">openssl x509 -<span class="hljs-type"><span class="hljs-type">text</span></span> -noout -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>.crt</code> </pre> <br><p>  <code>Openssl</code> has a huge number of options and commands.  Man page is not very useful, the directory is more convenient to use as follows: </p><br><pre> <code class="hljs sql">openssl -<span class="hljs-keyword"><span class="hljs-keyword">help</span></span> openssl x509 -<span class="hljs-keyword"><span class="hljs-keyword">help</span></span> openssl s_client -<span class="hljs-keyword"><span class="hljs-keyword">help</span></span></code> </pre> <br><p>  Exactly the same can be done using the <code>java</code> utility <code>keytool</code> . </p><br><pre> <code class="hljs pgsql">keytool -genkey -keyalg RSA -<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> selfsigned -keystore keystore.jks -storepass <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> -validity <span class="hljs-number"><span class="hljs-number">360</span></span> -keysize <span class="hljs-number"><span class="hljs-number">2048</span></span></code> </pre> <br><p>  A series of questions follows to remember what the <code>owner</code> and <code>issuer</code> fields are. </p><br><pre> <code class="hljs pgsql">What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> your first <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> last <span class="hljs-type"><span class="hljs-type">name</span></span>? What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your organizational unit? What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your organization? What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your City <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Locality? What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your State <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Province? What <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> the two-letter country code <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> this unit? <span class="hljs-keyword"><span class="hljs-keyword">Is</span></span> CN=Johnnie Walker, OU=<span class="hljs-type"><span class="hljs-type">Unknown</span></span>, O=<span class="hljs-type"><span class="hljs-type">Unknown</span></span>, L=Moscow, ST=Moscow, C=RU correct?</code> </pre> <br><p>  We convert the keychain from proprietary format to PKCS12. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">keytool</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-importkeystore</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-srckeystore</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">keystore</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jks</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-destkeystore</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">keystore</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jks</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-deststoretype</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pkcs12</span></span></code> </pre> <br><p>  We look at the result: </p><br><div class="spoiler">  <b class="spoiler_title">keytool -list -v -alias selfsigned -storepass password -keystore keystore.jks</b> <div class="spoiler_text"><pre> <code class="hljs ruby">Alias <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> selfsigned Creation <span class="hljs-symbol"><span class="hljs-symbol">date:</span></span> <span class="hljs-number"><span class="hljs-number">20.01</span></span>.<span class="hljs-number"><span class="hljs-number">2018</span></span> Entry <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> PrivateKeyEntry Certificate chain <span class="hljs-symbol"><span class="hljs-symbol">length:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Certificate[<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-symbol"><span class="hljs-symbol">Owner:</span></span> CN=Johnnie Walker, OU=Unknown, O=Unknown, L=Moscow, ST=Moscow, C=RU <span class="hljs-symbol"><span class="hljs-symbol">Issuer:</span></span> CN=Johnnie Walker, OU=Unknown, O=Unknown, L=Moscow, ST=Moscow, C=RU Serial <span class="hljs-symbol"><span class="hljs-symbol">number:</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>f170cb9 Valid <span class="hljs-symbol"><span class="hljs-symbol">from:</span></span> Sat Jan <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">33</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">42</span></span> MSK <span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-symbol"><span class="hljs-symbol">until:</span></span> Tue Jan <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">33</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">42</span></span> MSK <span class="hljs-number"><span class="hljs-number">2019</span></span> Certificate <span class="hljs-symbol"><span class="hljs-symbol">fingerprints:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">MD5:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">B3:</span></span><span class="hljs-symbol"><span class="hljs-symbol">E9:</span></span><span class="hljs-number"><span class="hljs-number">92</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">87</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">13</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">71</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">D:</span></span><span class="hljs-number"><span class="hljs-number">36</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">60</span></span><span class="hljs-symbol"><span class="hljs-symbol">:AD</span></span><span class="hljs-symbol"><span class="hljs-symbol">:B5</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">F:</span></span><span class="hljs-number"><span class="hljs-number">24</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">16</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">51</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-symbol"><span class="hljs-symbol">SHA1:</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>08<span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">39</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">19</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">31</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">53</span></span><span class="hljs-symbol"><span class="hljs-symbol">:C5</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">43</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-symbol"><span class="hljs-symbol">ED:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">78</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">36</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">43</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">54</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">9</span></span><span class="hljs-symbol"><span class="hljs-symbol">B:</span></span><span class="hljs-symbol"><span class="hljs-symbol">EA:</span></span><span class="hljs-symbol"><span class="hljs-symbol">D4:</span></span><span class="hljs-symbol"><span class="hljs-symbol">EF:</span></span><span class="hljs-number"><span class="hljs-number">9</span></span>A <span class="hljs-symbol"><span class="hljs-symbol">SHA256:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">FD:</span></span><span class="hljs-number"><span class="hljs-number">42</span></span><span class="hljs-symbol"><span class="hljs-symbol">:C9</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">6</span></span><span class="hljs-symbol"><span class="hljs-symbol">D:</span></span><span class="hljs-symbol"><span class="hljs-symbol">F6:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">A:</span></span><span class="hljs-symbol"><span class="hljs-symbol">F1:</span></span><span class="hljs-symbol"><span class="hljs-symbol">A3:</span></span><span class="hljs-symbol"><span class="hljs-symbol">BC:</span></span><span class="hljs-number"><span class="hljs-number">24</span></span><span class="hljs-symbol"><span class="hljs-symbol">:EA</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">34</span></span><span class="hljs-symbol"><span class="hljs-symbol">:DC</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">12</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">02</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">69</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">86</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">39</span></span><span class="hljs-symbol"><span class="hljs-symbol">:F1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:FC</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">B:</span></span><span class="hljs-number"><span class="hljs-number">64</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">07</span></span><span class="hljs-symbol"><span class="hljs-symbol">:FD</span></span><span class="hljs-symbol"><span class="hljs-symbol">:E1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">02</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">57</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">64</span></span><span class="hljs-symbol"><span class="hljs-symbol">:D1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">55</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">02</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">3</span></span>D Signature algorithm <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> SHA256withRSA Subject Public Key <span class="hljs-symbol"><span class="hljs-symbol">Algorithm:</span></span> <span class="hljs-number"><span class="hljs-number">2048</span></span>-bit RSA key <span class="hljs-symbol"><span class="hljs-symbol">Version:</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Extensions:</span></span> <span class="hljs-comment"><span class="hljs-comment">#1: ObjectId: 2.5.29.14 Criticality=false SubjectKeyIdentifier [ KeyIdentifier [ 0000: 30 95 58 E3 9E 76 1D FB 92 44 9D 95 47 94 E4 97 0.X..v...D..G... 0010: C8 1E F1 92 .... ] ]</span></span></code> </pre> </div></div><br><p>  The value of <code>ObjectId: 2.5.29.14</code> corresponds to the definition of ASN.1, according to <a href="https://tools.ietf.org/html/rfc3280.html">RFC 3280</a> it is always <code>non-critical</code> .  Similarly, you can find out the meaning and possible values ‚Äã‚Äãof other <code>ObjectId</code> that are present in the X.509 certificate. </p><br><pre> <code class="hljs pgsql">subjectKeyIdentifier <span class="hljs-keyword"><span class="hljs-keyword">EXTENSION</span></span> ::= { SYNTAX SubjectKeyIdentifier IDENTIFIED <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> id-ce-subjectKeyIdentifier } SubjectKeyIdentifier ::= KeyIdentifier</code> </pre> <br><h3 id="letsencrypt">  Leadtsrypt </h3><br><p>  You can get the X.509 <em>LetsEncrypt</em> certificate for <em>free</em> and you don‚Äôt even need to go to the website, you only need to install <code>certbot</code> . </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">emerge</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-av</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certbot</span></span> # <span class="hljs-selector-tag"><span class="hljs-selector-tag">Gentoo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">apt-get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certbot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">stretch-backports</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Debian</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dnf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certbot</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Fedora</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sudo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certbot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certonly</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--standalone</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">example</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">www</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.example</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span></code> </pre> <br><h2 id="scenariy-1---nayti-sleduyuschego-v-svyazke">  Scenario number 1 - find the next in a bunch </h2><br><p>  <strong>Linking Certificates</strong> - Combine multiple X.509 certificates into one file, most often in <code>PEM</code> format.  The bundle is transmitted over the network at the time of the SSL / TLS handshake protocol. </p><br><p><img src="https://habrastorage.org/webt/j7/hw/75/j7hw75jciknulrevtxqtthlfpvu.png" alt="Trust chain"></p><br><p>  The juice starts when dealing with a bunch of certificates, ak a <code>certificate chain</code> .  Often looking through the noodles in the <code>jks</code> not easy to understand how to find the parent certificate when there is a scattering of new and old certificates for several domain names. </p><br><p>  Consider a bunch of certificates <code>*.novell.com</code> .  The <code>Authority Key Identifier (AKI)</code> extension must match the <code>Subject Key Identifier (SKI)</code> senior in the bundle. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Certificate</span></span> Authority Key Identifier Size: <span class="hljs-number"><span class="hljs-number">20</span></span> Bytes / <span class="hljs-number"><span class="hljs-number">160</span></span> Bits <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> ff <span class="hljs-number"><span class="hljs-number">90</span></span> af <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">75</span></span> 3c cc d9 <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> a2 <span class="hljs-number"><span class="hljs-number">12</span></span> b8 <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> 3b</code> </pre> <br><p>  That's right, the DigiCert <code>SKI</code> certificate has the same meaning. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Certificate</span></span> Subject Key ID Size: <span class="hljs-number"><span class="hljs-number">20</span></span> Bytes / <span class="hljs-number"><span class="hljs-number">160</span></span> Bits <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span> ff <span class="hljs-number"><span class="hljs-number">90</span></span> af <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">75</span></span> 3c cc d9 <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> a2 <span class="hljs-number"><span class="hljs-number">12</span></span> b8 <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> 3b</code> </pre> <br><p><img src="https://habrastorage.org/webt/-e/rr/19/-err19aa8xzxvrddhulug-hfgjq.png" alt="Novell cert chain"></p><br><p>  For root certificate <code>AKI = SKI</code> , as well as <code>isCa=true</code> </p><br><pre> <code class="hljs pgsql">Certificate Basic Constraints Critical <span class="hljs-keyword"><span class="hljs-keyword">Is</span></span> a Certificate Authority</code> </pre> <br><h2 id="scenariy-2---ispolzuy-subjectaltnname-lyuk">  Scenario number 2 - use subjectAltnName, Luke </h2><br><p>  Imagine you have a web server application: wiki, wordpress or cacti.  You set up access via <code>https</code> , purchased or generated and signed the certificate yourself.  Everything should be fine, but there is still no green lock.  The browser suspects that the certificate was prepared by the wrong bees, due to the fact that the <code>FQDN</code> server and the <code>hostname</code> specified in the address bar do not match.  So sometimes it happens that the DNS server points to <code>mars.domain.com</code> , and the web server is configured to <code>venus.domain.com</code> . </p><br><p>  If the administrator, by virtue of perfectionism, needs besides the drive, checkers are also needed - a coveted green lock, then you need to redo the X.509 certificate, defining the <code>subjectAltName</code> in it. </p><br><p>  Open the <code>openssl.cnf</code> file and add the following lines in the <code>req</code> section. </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta"> alternate_names </span></span>] DNS<span class="hljs-number"><span class="hljs-number">.1</span></span> = example.com DNS<span class="hljs-number"><span class="hljs-number">.2</span></span> = www.example.com DNS<span class="hljs-number"><span class="hljs-number">.3</span></span> = mail.example.com DNS<span class="hljs-number"><span class="hljs-number">.4</span></span> = ftp.example.com</code> </pre> <br><p>  Further, in the <code>[ v3_ca ]</code> section, specify. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">subjectAltName</span></span> = <span class="hljs-variable"><span class="hljs-variable">@alternate_names</span></span></code> </pre> <br><p>  And then everything as usual, create a private key and sign the certificate. </p><br><pre> <code class="hljs cs">openssl genrsa -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key <span class="hljs-number"><span class="hljs-number">3072</span></span> openssl req -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -x509 -key <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>.key -sha256 -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> certificate.pem -days <span class="hljs-number"><span class="hljs-number">730</span></span></code> </pre> <br><h3 id="ispolzovannye-materialy">  Used materials </h3><br><ul><li>  <a href="http://zytrax.com/tech/survival/ssl.html">Survival guides - TLS / SSL and SSL (X.509) Certificates</a> </li><li>  <a href="https://habrahabr.ru/post/194664/">Parse the x.509 certificate</a> </li><li>  <a href="https://zonena.me/2016/02/creating-ssl-certificates-in-3-easy-steps/">Creating ECDSA SSL Certificates in 3 Easy Steps</a> </li><li>  <a href="https://www.safaribooksonline.com/library/view/implementing-ssltls-using/">Implementing SSL / TLS Using Cryptography and PKI</a> </li><li>  <a href="https://www.sysadmins.lv/blog-en/certificate-chaining-engine-how-this-works.aspx">Certificate Chaining Engine - how it works</a> </li><li>  <a href="https://stackoverflow.com/questions/21488845/how-can-i-generate-a-self-signed-certificate-with-subjectaltname-using-openssl">How can I generate a self-signed certificate with SubjectAltName using OpenSSL?</a>  <a href="https://stackoverflow.com/questions/21488845/how-can-i-generate-a-self-signed-certificate-with-subjectaltname-using-openssl">[closed]</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/346798/">https://habr.com/ru/post/346798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346788/index.html">How to build a community. Translation of Social Architecture: Chapter 3. ZeroMQ Community</a></li>
<li><a href="../346790/index.html">Addition to the article "Subtleties of resume in German IT-companies"</a></li>
<li><a href="../346792/index.html">Implementation of an asynchronous secure communication system based on TCP sockets and central OpenVPN server</a></li>
<li><a href="../346794/index.html">How to make friends team admins with development teams?</a></li>
<li><a href="../346796/index.html">ICO analysis: technical approach. Part I - general conclusions</a></li>
<li><a href="../346800/index.html">Basic API sets for implementing transparent proxying services</a></li>
<li><a href="../346802/index.html">Using Docker CE (Community Edition) with Kubernetes</a></li>
<li><a href="../346804/index.html">Reverse Engineering iPhone 2G</a></li>
<li><a href="../346806/index.html">Who is a Data Scientist - the eyes of the employer</a></li>
<li><a href="../346808/index.html">How to kill a techie in tmlide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>