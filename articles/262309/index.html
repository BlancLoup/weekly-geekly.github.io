<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Legends and myths of modern implementations of x265 / HEVC or x264 vs x265 in comparison of screenshots</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surprisingly, but a fact - the video compression standard High Efficiency Video Coding (HEVC) is over three years old. There are not only software, bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Legends and myths of modern implementations of x265 / HEVC or x264 vs x265 in comparison of screenshots</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/770/f1c/af0/770f1caf0bf34ebb87c4b67d9e3b8d0e.jpg"></div><br>  Surprisingly, but a fact - the video compression standard High Efficiency Video Coding (HEVC) is over three years old.  There are not only software, but also hardware coding solutions and even <a href="http://dune-hd.com/eng/products/set_top_boxes/43">home media players</a> that support this format.  The Internet is littered with <s>praiseworthy,</s> enthusiastic <s>advertising</s> reviews and reviews, and observers, depending on the <s>audacity of</s> <s>ignorance of</s> gullibility, promise an improvement in compression by 30-50% compared to h.264 with the same picture quality.  Theoretically, it probably is, and I have absolutely nothing against the standard itself, all this higher mathematics, the multiplicity of profiles, and the objective assessment of the subjective perception of psycho-physiological parameters using PSNR.  The driving motive for writing this unscientific article was pure distrust, the desire to independently feel the currently available free implementations of video encoders in this format (x265) and compare the results with the good old x264. <br><a name="habracut"></a><br>  To understand the scale of the problem and the degree of my distrust, I note that <a href="http://habrahabr.ru/company/intel/blog/228713/">I don‚Äôt believe in hardware coding in h.264 / AVC</a> (or rather I‚Äôm sure that pure software x264.exe can work with the same speed and better quality) I use video coding with CUDA and DXVA and consider all implementations of such "encoders" pure quackery and do not believe in magic two-button programs that can "encode quickly and well."  <i>I also do not believe in democracy, antiviruses and modern higher education, but these are purely my problems not related to video encoding :)</i> <br>  Now, having charged with a fair amount of skepticism, we take one of the compiled versions of the <a href="http://x265.ru/builds/">free x265 encoder</a> , or rather, the eight-bit GCC assembly 1.7 + 286 and all further actions will be performed with it. <br>  <i>At this point, by the way, my incredulity again bucked and had to spend about 6 hours to compare 11 different assemblies from different sites to calm her down.</i>  <i>It turned out that the coding results with similar parameters were identical to the degree of mixing, and the coding time differed by no more than 5-6 percent.</i> <br>  To begin with, we take as the source the above-mentioned <a href="https://yadi.sk/i/lcSv-PTMWGeTf">excerpt from Avatar splash-tree-fog</a> and to exclude decoder brakes, save 100 frames and from it as an uncompressed YUV4MPEG2 file, which will be encoded later.  In x265, the default CRF compression method with constant quality is used, so we encode it in x264 also in CRF mode with a quality score of 17.2.  The figure is not taken from the ceiling, but empirically found that any increase in this figure leads to a decrease in both the bitrate and image quality at the output, and a decrease only increases the bitrate without any noticeable increase in quality.  Of course, the remaining encoding parameters were also at the maximum and as a result we got a <a href="https://yadi.sk/i/-CUH1FyHhoGxg">compressed file with a bitrate of 17.6 Mb / s</a> (which is almost 2 times lower than the original 31 Mb / s on a BD disk).  <b>Encoding time 100 frames - 40 seconds</b> .  The picture quality turned out to be almost identical in comparison with the source code and you should not even lay out a comparison.  In the following, we will compare the 12th B-frame of the x264-17.2.mkv file with different encoding options in the HEVC. <br><br>  x265 pleases us with many <a href="http://x265.readthedocs.org/en/1.7/cli.html">ready-made presets</a> , but of course we will be interested in the latest one - the placebo.  <i>In fact, even placebo does not provide maximum settings, but more on that later.</i>  By default, x265 encodes with a quality score of 28 (perhaps this is a deep meaning, but I did not catch it).  With such settings, the output file bitrate is less than 2 Mb / s (for 1080p) and instead of a picture on the output is such a soap that it is impossible to look and it makes no sense to compare.  Therefore, for the first time, we tighten the conditions quite a bit and use the shortest possible command line. <br><pre><code class="css hljs">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265_64-8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span>" "<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">avatar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">raw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y4m</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">--crf</span></span> 23 <span class="hljs-selector-tag"><span class="hljs-selector-tag">--preset</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">placebo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--output</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">avatar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265-test1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mkv</span></span>"</code> </pre>  As a result, we get a <a href="https://yadi.sk/d/7eKs87cDhoJSs">file with a bitrate of 5.4 Mb / s.</a>  <b>Coding time just under 7 minutes.</b>  The quality is not bad in principle, but so far it's far from x264.  The link is a comparison of screenshots with a total weight of about 6 MB on the website screenshotcomparison.com (to blame, but I do not know of another convenient way to compare screenshots) <br> <a href="http://screenshotcomparison.com/comparison/134402"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br>  We will work to increase the rate by lowering the quality indicator and watch the results. <br><br>  Attempt # 2, crf 20, bitrate 9050 kb / s - better, but still not <br> <a href="http://screenshotcomparison.com/comparison/134406"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And here it is time to remember that the placebo preset uses far <a href="http://x265.readthedocs.org/en/1.7/presets.html">from the maximum possible parameters</a> .  The most important ones here are - me star (at the maximum value of full) and - subme 5 (at the maximum 7).  Let's try to tighten the conditions and manually say <br><pre> <code class="css hljs">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265_64-8</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span>" "<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">avatar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">raw</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.y4m</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">--preset</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">placebo</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--me</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">full</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--subme</span></span> 7 <span class="hljs-selector-tag"><span class="hljs-selector-tag">--psy-rd</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--psy-rdoq</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--output</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">E</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Video</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">avatar</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">x265-test1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mkv</span></span>"</code> </pre>  Immediately it becomes clear why the developers did not dare to insert the maximum values ‚Äã‚Äãof the parameters into the "maximum" profile.  Coding time increased more than 10 times <br><img src="https://habrastorage.org/files/2e3/aa7/577/2e3aa757768a4535a6525bbc34668f13.png"><br>  And was the result of these sacrifices worth?  not sure‚Ä¶ <br>  So try # 3, crf 20, -me full - subme 7, bitrate 9045 kb / s - 77 minutes of coding <br> <a href="http://screenshotcomparison.com/comparison/134420"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br><br>  And here is a comparison of the results of the placebo preset with the manually set -me full --subme 7 <br> <a href="http://screenshotcomparison.com/comparison/134419"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br><br>  We throw out manually set me, subme and we creep further. <br>  Attempt # 4, crf 18, bit rate 12922 kb / s - almost good, but x264 is better <br> <a href="http://screenshotcomparison.com/comparison/134427"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br><br>  Now let's see what happens if we encode in x265 with the same bitrate as x264 and with maximum parameters. <br>  The same bit rate was achieved when the value of crf 16.2.  This time the encoding took 90 minutes. <br>  <a href="https://yadi.sk/d/lgFAKE_VhoHzW">File link</a> <br> <a href="http://screenshotcomparison.com/comparison/134579"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br>  The results are very close, but still x264 retained a bit more detail and added a little less soap. <br>  Conclusion: <b>Current x265 implementations are losing in x264 quality at high bit rates.</b> <br><br>  Here we come to the main message of the whole article.  Formats of video compression along with the rest of the world are rolling towards simplifying and dulling the population.  No one is interested in having a consumer who looks at screenshots of comparisons, fights for every extra pixel of distortion, reads in coding parameters, etc.  Everything is sharpened on the fastest and funniest encoding profiles with minimal bitrates.  Surely at low bitrates x265 will have a significant advantage over x264.  Although there and there will be a lot of distortion and soap, but x264 will be more.  Check it out. <br>  Attempt # 5, x265 5371 kb / s, <a href="https://yadi.sk/d/lgFAKE_VhoHzW">x264 5374 kb / s</a> <br> <a href="http://screenshotcomparison.com/comparison/134622"><img src="https://habrastorage.org/files/7b4/caa/c16/7b4caac164be457b9dcea8da4333bacc.png"></a> <br><br>  But they didn‚Äôt guess :) Even in the native x265 bitrate, the x264 looks more decent. <br><br>  Draw your own conclusions, while I hopefully await objective criticism :) </div><p>Source: <a href="https://habr.com/ru/post/262309/">https://habr.com/ru/post/262309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262289/index.html">The best reports of the DevCon 2015 conference - Top 10</a></li>
<li><a href="../262295/index.html">Evolution go</a></li>
<li><a href="../262299/index.html">WPF pitfalls</a></li>
<li><a href="../262301/index.html">Iron unlock iCloud on Apple iPad Air 2 Cellular A1567</a></li>
<li><a href="../262305/index.html">Black archeology of datamining: how dangerous are the ‚Äúplums‚Äù of big data</a></li>
<li><a href="../262311/index.html">AGTH reverse to recreate an alternate GUI</a></li>
<li><a href="../262315/index.html">Yii 2.0.5 (security fix)</a></li>
<li><a href="../262317/index.html">At St.Petersburg State University of Economics, the acceptance of applicants' documents for the direction ‚ÄúApplied Mathematics and Computer Science‚Äù with a deep study of Wolfram Mathematica began</a></li>
<li><a href="../262319/index.html">Another critical vulnerability has been discovered in Adobe Flash Player.</a></li>
<li><a href="../262321/index.html">Three thoughts for Android fans based on I / O 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>