<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virtual cube - instead of OLAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When you do the opposite and get the same ... 

 Having the task of analytical (computational / aggregative) data processing, we have to find a compro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virtual cube - instead of OLAP</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <em>When you do the opposite and get the same ...</em> </blockquote><p>  Having the task of analytical (computational / aggregative) data processing, we have to find a compromise between responsiveness, speed and convenience. </p><br><p>  Some systems are well indexed and found, others are able to quickly calculate and aggregate data, others are simple.  Somewhere it is necessary to organize the preloading and indexing of data with all the attendant difficulties, and somewhere the user is provided with an abstraction of his model of source and aggregated data on top of the built-in or external physical storages and databases used directly during the calculations.  In any case, the user, from programmer to analyst, has to do relatively great work, starting with the preparation of raw data and querying, the computation model, and the visual design of the result on widgets, of course ‚ÄúSexy‚Äù - beautiful, responsive and understandable - otherwise All the work done will go down the drain.  And often, unfortunately, after going through the agony of decision making, we notice how simple and understandable at first glance the task grows into an eerie monster, with which it is useless to fight with available means, and we need to urgently invent something - a blackjack and hooky bike ¬©  Our bike rode, even goes around bumps well and copes with obstacles, which previously could only be guessed. <br> <a href=""><img src="https://habrastorage.org/webt/_c/yq/kp/_cyqkpcr3okpjz01osvwajd-pje.png"></a> </p><br><p>  Below will be described one side of the original internal device of the fictional "Rubik's Cube" - computational processing for interactive data visualization. </p><a name="habracut"></a><br><blockquote>  <em>A simple task should be solved simply, and a complex one should also be simple, but longer ...</em> </blockquote><p>  Starting to create a system of small forces, we went from simple to complex.  Creating a constructor, we were internally convinced that we understand the purpose of the system well, while fighting the desire not to do too much and the opposite desire to automate everything and everyone, creating a framework for everything.  Moreover, one of our wonderful framework was already ready and even run in production - jsBeans.  So, we started to develop a new data processing system, which has grown and is now also a self-sufficient product ‚Äî a designer and a platform for developing a whole class of data processing systems.  Conditionally in the article we will call it "Rubik's Cube" in order to do without advertising, but to describe interesting, in our opinion, solutions. </p><br><h2 id="kub-srez-izmerenie">  Cube, cut, dimension </h2><br><p>  The main task is to have a set of unrelated data, including heterogeneous external databases and files, to form a multidimensional model of interconnected elements of the source data and the results of their analytical processing for visualization on dynamic dashboards and interrelated widgets. </p><br><p>  Simply put, for example, in the form of a clickable dashboard: </p><br><p><img src="https://habrastorage.org/webt/9r/1u/w1/9r1uw1pcuwqt4i_l0dbav0bqhsk.png" alt="Schools rated dashboard example"></p><br><p>  Such a multidimensional data model in our system is called "Cube" and literally represents an abstract collection of variable data sets called "Slice", interconnected by common output (displayed) fields / columns or internal fields called "Dimensions" and used for filtering and linking cuts to each other. </p><br><p>  A slice can be represented as a virtual table or a view ( <abbr title="Common Table Expression">CTE</abbr> ) with parameters and a variable query body, depending on the filtering conditions.  The main thing is that the output data changes depending on the conditions of the contextual search (inside the widget) and the global filter, which is built by selecting values ‚Äã‚Äãon the widgets and applying basic logic functions (AND / OR / NOT) and combinations. </p><br><p>  The global filter allows you to "rotate the Rubik's Cube", as in the <a href="https://www.youtube.com/watch%3Fv%3DWxvey5PByQQ">video</a> : </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Wxvey5PByQQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  If the output slice field is simultaneously a measurement in another slice, it has the same name, then the system perceives the values ‚Äã‚Äãof this field as ‚Äúfacts‚Äù (if we talked about <abbr title="Online Analytical Processing, Online Analytical Processing">OLAP</abbr> ) specified in the form of a global filter that changes the initial data sets during calculations and aggregation .  As a result, there is a dynamic interaction of widgets, in which the values ‚Äã‚Äãof the displayed indicators depend on the selected elements and filters. </p><br><p>  A slice is a changeable ‚Äúby measurements‚Äù data set ‚Äî initial or analytical results;  characterized by output fields / columns, a list of supported measurements and a set of parameters with default values;  described by a relatively elegant query in a visual editor that supports filtering, sorting, grouping / aggregation, intersection (JOIN), union (UNION), recursion, and other manipulations. </p><br><p>  Sections that use each other as sources describe the internal structure of the cube, for example: </p><br><p><img src="https://habrastorage.org/webt/u5/ev/ay/u5evay1gcdf76whlfgmdxijmu_0.jpeg" alt="Cube structure example"></p><br><p>  An example of a slice in the editor: </p><br><p><img src="https://habrastorage.org/webt/ow/p_/on/owp_onr465vphjta2gginzvywf8.png" alt="Example slice query editor"></p><br><p>  The slice supports both measurements explicitly specified in the output fields and also inherits the measurements from the sources of the request ‚Äî this means that the output of the slice can be changed even as a result of changes in other source slices.  In other words, the results of the slice can be filtered not only by the output fields, but also by the internal fields-measurements of sources, somewhere in the depth of the query, up to the primary database tables. </p><br><p>  The query structure is expanded and modified by the system automatically at the time of execution, depending on the current global filter and input parameters, dragging them deeper into the query according to the cube model, the declared dimensions and slices. </p><br><p>  An example of a simple global filter, literally, when a user has committed or selected values ‚Äã‚Äãon several widgets: </p><br><p><img src="https://habrastorage.org/webt/vd/aj/li/vdajlihvw-uymjxya7qr565mx_8.png" alt="An example of a global filter on a dashboard"></p><br><p>  Global filter is saved in JSON request: </p><br><p><img src="https://habrastorage.org/webt/t0/uu/lb/t0uulbpjpqaf_pndtyczt3mvt6k.png" alt="Global filter JSON example in request body"></p><br><p>  The request comes to the primary source (in the database) in a prepared form, passing through several basic steps: </p><br><ul><li>  Assembling a query, including selecting and embedding optimal slices, taking into account the current global filter (when there is no filter or simple, you can select simple / fast slices; when the filter is complex - slices with a complex structure and additional dimensions); </li><li> Embedding a global filter and adding filters to the bodies of queries and subqueries; </li><li>  Embedding macros and template query expressions; </li><li>  Query optimization, including the removal of unused fields and expressions; </li><li>  Additional operations with a query for the specifics of primary databases (for example, if there is no SQL speech and there is no WITH in the database, then named queries are embedded). </li></ul><br><p>  And the final stage is the translation of the request to the format of the primary source, for example in SQL: </p><br><p><img src="https://habrastorage.org/webt/ui/rd/ls/uirdlsovx8idhgtxgyovng8gg2a.png" alt="Example of a final query with an inline filter"></p><br><h2 id="kogda-istochniki-raznye">  When sources are different </h2><br><p>  As a rule, everything is simple and clear when you have to work with a single data store.  But when there are several of them and they are fundamentally different - you have to apply different tricks for each specific task.  And you always want to have a universal solution that would always be suitable, preferably "out of the box", as a maximum with a few modifications.  For this, another abstraction suggests itself - over data warehouses, firstly, realizing the coordination of formats and query languages, secondly, ensuring data interdependence, at least at the level of additional filtering conditions in queries to one source by values ‚Äã‚Äãfrom another. </p><br><p>  To do this, we have developed a universal query language that is suitable both for the presentation of a virtual cube data model and for working with arbitrarily arbitrary repositories by translating the query to the desired format and language.  By luck, the query language, originally designed for simple mapping and filtering data from different sources, easily expanded into a full-fledged search and data processing language, allowing you to build computational structures from very simple to very complex in several pages and with many subqueries. </p><br><p>  Sources can be divided into three types: </p><br><ol><li>  data files that require loading into the system; </li><li>  databases that support full data processing and other operations; </li><li>  repositories that support only data retrieval with or without filtering, including various external services. </li></ol><br><p>  With the first type, everything is unambiguous - an import module is integrated in the system, which parses various input formats and immerses the results in the storage.  A special constructor has also been developed for import, which is worth telling separately. </p><br><p>  The second type is self-sufficient databases, to work with which you only need to translate the original request to the desired format and query language, dialect. </p><br><p>  The third type requires at least post-processing of data.  And all types, when used simultaneously, may also require post-processing ‚Äî intersections, joins, aggregation, and final calculations.  This occurs when data processing in one database must be performed taking into account the results of filtering in another external one. </p><br><p>  <em>The simplest example is when a fuzzy search is performed in one database, and at the output you need to get an aggregation of indicators stored in another database on another server, taking into account the search results.</em> </p><br><p>  To implement such a scheme, a simple algorithm is implemented in our system: the initial request is simultaneously prepared by several interpreters, each of which can either refuse to execute the request if it is incompatible, or return an iterator with data, or convert the request and initiate the work of the next request preparation chain by another interpreter .  In the end, for one query, we get from one to several lazy iterators that form the same result, but in different ways, from which the best one is selected (according to various criteria defined by the developer in the configuration). </p><br><p>  The iterator selection strategy is specified in the configuration or query parameters.  Currently, several basic strategies are supported: </p><br><ul><li>  first, any, last; </li><li>  priority type of database; </li><li>  on the priority of the chain that formed the iterators; </li><li>  according to the weighting function "query weighting"; </li><li>  by the first result - a parallel launch of all iterators is performed and the first result is expected, as a result, the fastest iterator is used, the rest are closed. </li></ul><br><p>  As a result of such a combination for a single input request, we get several variants of its execution, both using different sources and with different execution strategies - choosing the main / target database, in which the main part of the query and the final assembly of results will be performed. </p><br><p>  If the target DBMS supports the connection of external sources, it becomes possible to create a return circuit, in which the DBMS connects to the system API to receive small amounts of data from the system, for example, to filter large amounts "on site".  Such integration is transparent for the end user and analytics - the cube model does not change, and all operations are performed by the system automatically. </p><br><p><img src="https://habrastorage.org/webt/az/ie/vx/azievxht98zpnyahcnoymfdcgr8.png" alt="Simplified sequence diagram when querying multiple integrated databases in a single query"></p><br><p>  For more complex cases, the system implements an internal in-memory query interpreter on the remarkable H2 Embedded database engine, which allows integrating any supported databases out of the box.  Literally, it works this way - the request is broken into pieces by groups of sources, sent for execution, after which the assembly and final processing of the results in memory in H2 is performed. </p><br><p>  At first glance, such a data integration scheme at the level of the internal interpreter seems to be ‚Äúheavy‚Äù, and this is true if you have to work with large amounts of input data and the need to make calculations after intersecting and combining sets from external sources.  In fact, this circumstance is partially leveled - at the same time the request is executed by several processors in different versions, therefore, the interpreter is used only in the most extreme cases, as a universal solution out of the box.  In the end, any integration is limited to typical transportation costs for preparation, transmission over the network and data reception, and this is a completely different task. </p><br><h2 id="tehnicheskaya-storona">  Technical side </h2><br><p>  On the technical side, without which, probably, it is impossible to do without affecting this topic, the system is also arranged according to the principle - to trick more, but to simplify everything as much as possible. </p><br><p>  The data processing system is implemented on top of the jsBeans client-server framework as a set of additional modules and specific build projects.  jsBeans, in turn, is implemented in Java, works as an application server, by and large is a bunch of Rhino, Jetty and Akka, and also includes the client-server bean technology developed by our team, and a rich library of components built over several years of successful use. </p><br><p>  Rubik's cube is fully implemented on JavaScript in the form of a set of js-bins (* .jsb files), some of which operate only on the server.  The other part is on the client, and the rest are an integral component, functioning as a distributed whole, the parts of which interact with each other, is transparent to the developer, but is under his control.  Js-bins can have different life strategies, for example, with or without reference to a user session and much more.  The bean is isomorphic, it allows both on the client and on the server to work with it as with a virtual instance of the usual class.  The bean is described in one file and includes three sections - for fields and methods running on the client, for server ones, as well as a section for common synchronized fields. </p><br><p>  Since the article has already turned out to be verbose, in order not to bore readers, it‚Äôs time to move on to completion, with the intention to soon describe the details and the most interesting architectural solutions in the implementation of JsBeans and our projects based on it - the designed visualization subsystem, analytical processes, ontological designer of subject areas, language requests, data import and something else ... </p><br><h2 id="pochemu-tak">  Why is that? </h2><br><blockquote>  <em>Never was this, and here again ...</em> </blockquote><p>  At first, there were few primary data sets.  Subject areas and tasks were quite specific.  It would seem, why such torment?  The task looked simple, everyone wanted to get a result right away - especially when the quick solution lay on the surface, and the right one required assiduity and balanced decisions, adherence to the initial installation.  We went in the opposite direction, from difficult and long decisions to simple and fast, along the path of generalizing particular problems. </p><br><p>  The main condition is that new dashboards should be built quickly, even if a new subject area and analytical needs are very different from previous ones.  Obviously you can not guess half of the future requirements, the system should be primarily malleable.  Refining the library of components, analytical algorithms, connecting new types of sources is an integral part of the system adaptation.  In other words, the link has earned - analysts build queries and deshboards, and programmers quickly implement new needs for them.  And we, as programmers, initially sought to simplify the work themselves in the future, trying not to harm usability. </p><br><p>  And the system was immediately created universal and adaptive - we built a "constructor constructor", developing a framework on top of the framework previously created with a similar, but even more general goal. </p><br><p>  <strong><a href="http://cubisio.online/mosedu">The rating of Moscow schools based on the results of the Unified State Exam and Olympiads</a></strong> is an example of a dashboard constructed in the manner described above from downloading from the open data portal of the Government of Moscow. </p><br><p>  <strong>"Rubik-Rubik"</strong> is a basic platform for the development of information and analytical systems.  Developed as a branch and a logical continuation of jsBeans.  It includes all the necessary modules for solving problems of collection, processing, analysis (computational and process-oriented) and visualization. </p><br><p>  <strong><a href="http://jsbeans.org/">jsBeans</a></strong> - an isomorphic "full-stack" web framework that implements client-server JavaScript-beans technology, is developed with an open license as a universal tool.  During use, he proved himself well, in most cases ideally fitting into the tasks before us. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/452154/">https://habr.com/ru/post/452154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452142/index.html">How do we deal with copying content, or the first adversarial attack in the sale</a></li>
<li><a href="../452144/index.html">China and Iran use replay attacks to combat Telegram</a></li>
<li><a href="../452146/index.html">So what will happen with authentication and passwords? The second part of the Javelin Strong Authentication Status Report</a></li>
<li><a href="../45215/index.html">A highly developed AI must have a soul.</a></li>
<li><a href="../452152/index.html">What solutions does Rostelecom have for IIoT?</a></li>
<li><a href="../452162/index.html">Bot for VK in Python with MySQL in an hour, part 1</a></li>
<li><a href="../452164/index.html">ModLook - register scanner ModBus. We celebrate the 20th anniversary of the program</a></li>
<li><a href="../452172/index.html">Complex systems. Critical level</a></li>
<li><a href="../452174/index.html">He does not give you a rook</a></li>
<li><a href="../452178/index.html">Parsing: 23 common mistakes in writing English and how to avoid them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>