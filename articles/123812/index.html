<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Your ASP.NET Session Store Provider Using Redis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 

 In this article I would like to share the experience of writing your own Session Store Provider using Redis as a repository. 

 About Red...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Your ASP.NET Session Store Provider Using Redis</h1><div class="post__text post__text-html js-mediator-article">  Greetings <img src="https://habrastorage.org/storage1/2bb1666a/c264dde9/fa77ed2d/50cf5585.png" align="right"><br><br>  In this article I would like to share the experience of writing your own Session Store Provider using Redis as a repository. <br><br>  About Redis a lot has been written.  But in short, Redis is a very fast storage in key-value format (and not only).  It seems to me that it is very well suited for such tasks and I have long been interested in trying it in my project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Also, for those who want to try the result in, I will give a link to the source. <br><a name="habracut"></a><br><h3>  Why is all this necessary? </h3><br>  It took me a session repository that meets the following requirements: <br><br>  <b>1. Control over the process of recording / reading session</b> <br>  I will explain later why. <br><br>  <b>2. Distribution between multiple application instances.</b> <br>  To scale the application to multiple servers. <br><br>  <b>3. Speed.</b> <br>  Everything is clear why. <br><br><h5>  Disclaimer </h5><br>  I‚Äôll say right away that while this code at the prototype stage, made in my spare time, just see what happens.  I did not decide to use it in the project or not, but I think the one described here will be interesting to someone.  There is also a mercenary intent of this publication - maybe someone will point out the shortcomings of this approach, before I decide to use it in production :) <br><br>  Redis I use almost a couple of hours myself, so there is probably something to improve (I will be glad to hear it in the comments). <br><br>  The Redis installation process is omitted.  I can say that I picked up Ubuntu Server on VirtualBox, and then it was a matter of several commands and editing several files (for a static IP and for allowing Redis to accept connections not only from localhost). <br><br>  Also, I have to mention that there are already existing solutions, for example, Windows Server AppFabric Cache with its session provider, but due to point 1, you still need to write your provider (using only its functional cache), and in speed I think Redis will be faster. <br><br><h5>  Why you need your provider </h5><br>  The session is essentially a collection of key-value, this dictionary gets at the beginning of the request, and is recorded (in case of changes) at the end of the request. <br>  If you have <b>several requests that use the session</b> , and not only read (read), but also change some values ‚Äã‚Äãin it, then <b>these requests will not be executed in parallel</b> .  This is because in standard providers only one session can use an exclusive session (which is necessary for recording). <br><br>  We have several blocks on each page that are loaded in parallel (AJAX), and in all we need access to the session (each block changes its variables).  With any standard provider, they are executed one by one.  And we need parallel. <br><br><h5>  Classes for implementing Session Store Provider </h5><br>  There are 2 main and 1 additional classes that you need to implement for your session provider. <br><br><ol><li>  <b>RedisNoLockSessionStateStoreProvider</b> inherited from SessionStateStoreProviderBase.  Responsible for ‚Äúretrieving‚Äù a session (i.e. an entire collection) from the repository.  Here it should be noted that at first I was always confused by the names of his methods: GetItem, RemoveItem, ... By names, you can decide that the class is responsible for individual objects in the session, but this is not so. <br><br>  In an implementation in which the elements of a session can be changed in several requests in parallel, this class takes almost nothing. <br><blockquote><code><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> <font color="black">Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { //... <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; //      RedisNoLockSessionStateItemsCollection <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } //... }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/22397/s"></a> <a href="http://s-c.me/22397/h"></a> Copy Source | Copy HTML <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateStoreProvider</font> : <font color="#2b91af">SessionStateStoreProviderBase</font> { <font color="#008000">//...</font> <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> CreateNewStoreData(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">int</font> timeout) { <font color="#0000ff">string</font> sessionId = context.Request.Cookies[RedisNoLockSessionIDManager.CookieName].Value; <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (sessionId, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), timeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItem(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { lockAge = <font color="#2b91af">TimeSpan</font> .Zero; lockId = <font color="#0000ff">null</font> ; locked = <font color="#0000ff">false</font> ; actions = <font color="#2b91af">SessionStateActions</font> .None; <font color="#008000">//      RedisNoLockSessionStateItemsCollection</font> <font color="#0000ff">return new</font> <font color="#2b91af">SessionStateStoreData</font> ( <font color="#0000ff">new</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> (id, _defaultTimeout, _redisServer, _redisDb), SessionStateUtility.GetSessionStaticObjects(context), _defaultTimeout); } <font color="#0000ff">public override</font> <font color="#2b91af">SessionStateStoreData</font> GetItemExclusive(System.Web. <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> locked, <font color="#0000ff">out</font> <font color="#2b91af">TimeSpan</font> lockAge, <font color="#0000ff">out object</font> lockId, <font color="#0000ff">out</font> <font color="#2b91af">SessionStateActions</font> actions) { <font color="#0000ff">return this</font> .GetItem(context, id, <font color="#0000ff">out</font> locked, <font color="#0000ff">out</font> lockAge, <font color="#0000ff">out</font> lockId, <font color="#0000ff">out</font> actions); } <font color="#008000">//...</font> }</font></code> </li> </ol></blockquote><br><br></li><li>  <b>RedisNoLockSessionStateItemsCollection</b> inherited from ISessionStateItemCollection is a class that implements everything necessary for accessing session elements.  In the current implementation, he takes on almost all the work. <br>  I think from the code below it is clear how everything is arranged there.  The idea is that each item is obtained and saved separately. <br><br><blockquote> <code><a href="http://s-c.me/22396/s"></a> <a href="http://s-c.me/22396/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionStateItemsCollection</font> : <font color="#2b91af">RedisSessionConfig</font> , <font color="#2b91af">ISessionStateItemCollection</font> </li><li>  { </li><li>  <font color="#008000">// ...</font> </li><li>  <font color="#0000ff">public object this</font> [ <font color="#0000ff">string</font> name] </li><li>  { </li><li>  <font color="#0000ff">get</font> </li><li>  { </li><li>  <font color="#0000ff">string</font> key = GetKey (name); </li><li>  <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> redis = SingleRedisPool.GetClient (_redisServer)) </li><li>  { </li><li>  <font color="#0000ff">return</font> redis.Get &lt; <font color="#0000ff">object</font> &gt; (key); </li><li>  } </li><li>  } </li><li>  <font color="#0000ff">set</font> </li><li>  { </li><li>  <font color="#0000ff">string</font> key = GetKey (name); </li><li>  <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> redis = SingleRedisPool.GetClient (_redisServer)) </li><li>  { </li><li>  <font color="#0000ff">bool</font> result = redis.Set &lt; <font color="#0000ff">object</font> &gt; (key, <font color="#0000ff">value</font> ); </li><li>  } </li><li>  } </li><li>  } </li><li>  <font color="#008000">// ...</font> </li><li>  } </li></ol></blockquote><br><br></li><li>  Well, the third class RedisNoLockSessionIDManager which is responsible for creating the session ID and writing a cookie, it is quite simple. <br><blockquote> <code><a href="http://s-c.me/22398/s"></a> <a href="http://s-c.me/22398/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">public class</font> <font color="#2b91af">RedisNoLockSessionIDManager</font> : <font color="#2b91af">RedisSessionConfig</font> , <font color="#2b91af">ISessionIDManager</font> </li><li>  { </li><li>  <font color="#0000ff">public string</font> CreateSessionID ( <font color="#2b91af">HttpContext</font> context) </li><li>  { </li><li>  <font color="#0000ff">Return</font> <font color="#2b91af">Guid</font> .NewGuid (). ToString ( <font color="#A31515">"N"</font> ); </li><li>  } </li><li></li><li>  <font color="#0000ff">public string</font> GetSessionID ( <font color="#2b91af">HttpContext</font> context) </li><li>  { </li><li>  <font color="#0000ff">var</font> cookie = context.Request.Cookies.Get (CookieName); </li><li>  <font color="#0000ff">return</font> cookie! = <font color="#0000ff">null</font> ?  cookie.Value: <font color="#0000ff">null</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">public bool</font> InitializeRequest ( <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">bool</font> suppressAutoDetectRedirect, <font color="#0000ff">out bool</font> supportSessionIDReissue) </li><li>  { </li><li>  supportSessionIDReissue = <font color="#0000ff">false</font> ; </li><li>  <font color="#0000ff">return false</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">public void</font> SaveSessionID ( <font color="#2b91af">HttpContext</font> context, <font color="#0000ff">string</font> id, <font color="#0000ff">out bool</font> redirected, <font color="#0000ff">out bool</font> cookieAdded) </li><li>  { </li><li>  <font color="#2b91af">HttpCookie</font> cookie = <font color="#0000ff">new</font> <font color="#2b91af">HttpCookie</font> (CookieName, id); </li><li>  cookie.Expires = <font color="#2b91af">DateTime</font> .Now.Add (Configuration.Timeout); </li><li>  context.Response.Cookies.Add (cookie); </li><li></li><li>  redirected = <font color="#0000ff">false</font> ; </li><li>  cookieAdded = <font color="#0000ff">true</font> ; </li><li>  } </li><li></li><li>  <font color="#0000ff">public bool</font> Validate ( <font color="#0000ff">string</font> id) </li><li>  { </li><li>  <font color="#0000ff">return true</font> ; </li><li>  } </li><li>  <font color="#008000">// ..</font> </li><li>  } </li></ol></blockquote><br></li></ol>  That's all.  The moments of getting configuration settings from web.config are omitted, but this part has a rather mediocre relation to the session itself; you can see this part in the source code. <br><br><h5>  Conclusion </h5><br>  A few things I would like to say in conclusion. <br><ul><li>  This version is built of interest, although at first glance it solves all my problems.  It is worth using it carefully. </li><li>  Almost 100% will be a problem if several requests try to change the same element in a session. </li><li>  The source also has a version with a more classical implementation, i.e.  with ‚Äúpulling out‚Äù and lock of the entire collection, but I almost never tested it.  There is a page that emulates parallel requests from one user, you can see how this works when you enable different session implementations. </li><li>  Well, the source code itself is here <a href="http://redissessionstore.codeplex.com/">redissessionstore.codeplex.com</a> </li></ul><br>  I will be glad to hear your comments.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/123812/">https://habr.com/ru/post/123812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123802/index.html">Facebook is testing a new home page design.</a></li>
<li><a href="../123804/index.html">Mash of flags: how to find out more about an exotic country</a></li>
<li><a href="../123805/index.html">Search engine job dataflow</a></li>
<li><a href="../123808/index.html">Attackers have access to data from users of the Washington Post</a></li>
<li><a href="../123810/index.html">Flash drive cryptex for lovers of design and cryptography</a></li>
<li><a href="../123813/index.html">Textile printer do it yourself - continued</a></li>
<li><a href="../123816/index.html">Fixed point math in Marmalade SDK</a></li>
<li><a href="../123818/index.html">Do you need a G + (+1) button on Habrahabr?</a></li>
<li><a href="../123819/index.html">Portable Areas as a modularity option in MVC</a></li>
<li><a href="../123821/index.html">Python unknown</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>