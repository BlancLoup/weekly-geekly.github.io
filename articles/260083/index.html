<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculate Pi using Intel Threading Building Blocks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many Android devices use processors with multiple processing cores, so the ability to create multi-threaded programs is becoming increasingly importan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculate Pi using Intel Threading Building Blocks</h1><div class="post__text post__text-html js-mediator-article">  Many Android devices use processors with multiple processing cores, so the ability to create multi-threaded programs is becoming increasingly important in the mobile application development industry.  Intel offers valuable tools for developing ‚Äúparallel‚Äù applications ‚Äî it's called <b>Intel Threading Building Blocks</b> (Intel TBB).  Essentially, Intel TBB is a cross-platform template library for creating parallel programs.  It allows you to create and synchronize data streams, leaving behind details of the architecture and allowing you to work at a high level of abstraction.  Intel TBB supports all architectures.  As for the Android OS, you should use version 4.3 and higher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fb/a1a/24e/0fba1a24e2c57ac2051c0451c88a0e94.png" alt="image"></div><a name="habracut"></a><br><h2>  <font color="#0071c5">Create Intel TBB</font> </h2><br><ol><li>  Download Intel TBB, you can find it here: <a href="https://www.threadingbuildingblocks.org/">www.threadingbuildingblocks.org</a> . <br><br></li><li>  Add NDK to PATH.  For Windows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs sql">$ <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>=%<span class="hljs-keyword"><span class="hljs-keyword">PATH</span></span>%;</code> </pre> <br>  For Linux: <br><br><pre> <code class="hljs pgsql">$ export <span class="hljs-type"><span class="hljs-type">PATH</span></span>=$<span class="hljs-type"><span class="hljs-type">PATH</span></span>:</code> </pre> <br></li><li>  Unzip TBB and go to the source directory and the src folder. <br><br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /src/</code> </pre> <br></li><li>  Run TBB for Android: <br><br><pre> <code class="hljs ruby">$ /ndk-build ‚ÄìC /src/ arch=intel64 compiler=gcc target=android clean tbb tbbmalloc ‚Äìj</code> </pre> <br>  This command creates TBB for the 64-bit version of Android 64. To form the TBB for the 32-bit version of Android, replace arch = intel64 with arch = ia32. <br><br></li><li>  Library is created.  In the corresponding directory (/ build /) you will find subdirectories with libraries: libgnustl_shared.so, libtbbmalloc_proxy.so, libtbbmallolo.so and libtbb.so.  libtbb.so and libgnustl_shared.  Now they can be used in our application. </li></ol><br><h2>  <font color="#0071c5">Calculate Pi</font> </h2><br>  To calculate Pi, you can choose in Wikipedia any formula with a definite <a href="https://en.wikipedia.org/wiki/List_of_formulae_involving_%25CF%2580">integral</a> .  I chose the following formula: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d37/b2a/156/d37b2a156151f5659d15070706cc01fc.jpg" alt="image"></div><br>  For this program, I modified this formula: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b72/691/65d/b7269165d9aaace7e1aae8b29b3333f4.jpg" alt="image"></div><br>  To calculate the integral, I used the rectangle method.  The integrable function is divided into N = 10 <sup>7</sup> equal subintervals of length h = 2 ¬∑ 10 <sup>-7</sup> .  Then, the approximation of the integral is calculated by adding the areas (base x height) of N rectangles using the formula: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84f/015/c82/84f015c8227931ca7a5d08f146d6d560.jpg" alt="image"></div><br><h2>  <font color="#0071c5">Create application</font> </h2><br>  Create a new Android application: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84f/d5c/a6a/84fd5ca6a30ef2092f10fee3101d048c.jpg" alt="image"><br><br>  Create a ‚ÄúMain Activity‚Äù (Main Activity).  Copy the following code into res / layout / activity_main.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"intel.example.pitbbcalc.MainActivity"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAppearance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/textAppearanceLarge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/startButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/start"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/pi_equally"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/pi_equally"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAppearance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/textAppearanceLarge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/pi_val"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAppearance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/textAppearanceLarge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And in res / values ‚Äã‚Äã/ strings.xml, this code: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app_name"</span></span></span><span class="hljs-tag">&gt;</span></span>PiTBBCalc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_settings"</span></span></span><span class="hljs-tag">&gt;</span></span>Settings<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag">&gt;</span></span>Start<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span>Calculation of œÄ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pi_equally"</span></span></span><span class="hljs-tag">&gt;</span></span>œÄ = <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now the Main Activity looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f5/e46/d6e/2f5e46d6e4e7019d93dd56efbb034bcd.jpg" alt="image"><br><br>  Next, we need to implement a Java interface for our activity.  Add the following code to the src / intel.example.pitbbcalc / MainActivity.java file: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> intel.example.pitbbcalc; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Menu; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.MenuItem; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View.OnClickListener; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.TextView; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClickCalc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextView piEqually; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextView piVal; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Button startButton = (Button) findViewById(R.id.startButton); piEqually = (TextView) findViewById(R.id.pi_equally); piVal = (TextView) findViewById(R.id.pi_val); piEqually.setVisibility(View.INVISIBLE); piVal.setVisibility(View.INVISIBLE); startButton.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// TODO    double val = onClickCalc(); piVal.setText(String.valueOf(val)); piEqually.setVisibility(View.VISIBLE); piVal.setVisibility(View.VISIBLE); } }); System.loadLibrary("PiTBBCalc"); System.loadLibrary("tbb"); } @Override public boolean onCreateOptionsMenu(Menu menu) { //  ;     ,  . getMenuInflater().inflate(R.menu.main, menu); return true; } @Override public boolean onOptionsItemSelected(MenuItem item) { //    .   //      Home/Up,  //  AndroidManifest.xml   . int id = item.getItemId(); if (id == R.id.action_settings) { return true; } return super.onOptionsItemSelected(item); } }</span></span></code> </pre> <br>  In Project Explorer -&gt; Android Tools -&gt; Add Native Support, you can specify native support for right-clicking on our project.  In the next window, enter the name of the library of our project and click on Finish. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/569/c31/f58/569c31f58b78741ec6a90e2b653554a1.jpg" alt="image"><br><br>  So, we have implemented the native code to calculate the integral in one stream.  Add the following code to the jni / PiTBBCalc.cpp file: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;jni.h&gt; #include &lt;math.h&gt; double piIntFunc (const double x) { return sqrt(1 - pow(x, 2.0)); } double calcPi() { const unsigned int n = pow(10.0, 7); double a(-1), b(1); double h = (b - a) / n; double x (a); for (unsigned int i (0); i &lt; n; ++i) { sum += piIntFunc(x); x += h; } sum *= h; return 2 * sum; } extern "C" JNIEXPORT jdouble JNICALL Java_intel_example_pitbbcalc_MainActivity_onClickCalc(JNIEnv *env, jobject obj) { return calcPi(); }</span></span></span></span></code> </pre> <br>  Let's try to run our application and calculate the pi number in single-threaded mode: <br><br><img src="https://software.intel.com/sites/default/files/managed/4d/9c/pi-result.jpg" alt="image"><br><br>  To add parallel computations to the project using Intel TBB, jni / Android.mk needs to be edited.  Android.mk is the Makefile for our project, and you need to add the Intel TBB libraries to it: <br><br><pre> <code class="hljs ruby">LOCAL_PATH <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= $(call my-dir) TBB_PATH <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= &lt;tbb_sources&gt; TBB_BUILD_PATH <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= <span class="hljs-regexp"><span class="hljs-regexp">/build/linux</span></span>_intel64_gcc_android_cc4.<span class="hljs-number"><span class="hljs-number">9_</span></span>NDKr10b_version_android-L_release <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS) LOCAL_MODULE <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= PiTBBCalc LOCAL_SRC_FILES <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= PiTBBCalc.cpp LOCAL_CFLAGS += -DTBB_USE_GCC_BUILTINS -std=c++<span class="hljs-number"><span class="hljs-number">11</span></span> -fexceptions -Wdeprecated-declarations -I$(TBB_PATH)/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> -I$(TBB_PATH)$(TBB_BUILD_PATH) LOCAL_LDLIBS <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= -llog -ltbb -L./ -L$(TBB_PATH)$(TBB_BUILD_PATH) LOCAL_SHARED_LIBRARIES += libtbb <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(BUILD_SHARED_LIBRARY) <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(CLEAR_VARS) LOCAL_MODULE <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= libtbb LOCAL_SRC_FILES <span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= $(TBB_PATH)$(TBB_BUILD_PATH)/libtbb.so <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $(PREBUILT_SHARED_LIBRARY)</code> </pre> <br>  In the jni / directory, create the Application.mk file and add the following lines to it: <br><br><pre> <code class="hljs go">APP_ABI := x86_64 APP_GNUSTL_FORCE_CPP_FEATURES := exceptions rtti APP_STL := gnustl_shared</code> </pre> <br>  Here, the purpose of Application.mk is to describe the native modules that we need for our application (that is, static / shared libraries).  In the line APP_ABI: = x86_64, we define our target architecture. <br><br>  Now we will try to start the application.  If you see the main screen of the application, the Intel TBB libraries are linked successfully, and we can start developing our application. <br><br>  To add concurrency, we need to include the Intel TBB header: #include "tbb / tbb.h", remove the loop, and add the following code: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">double</span></span> sum = tbb::parallel_reduce( tbb::blocked_range&lt;unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>,n), <span class="hljs-type"><span class="hljs-type">double</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>), //    [&amp;](const tbb::blocked_range&lt;unsigned <span class="hljs-type"><span class="hljs-type">int</span></span>&gt;&amp; r, <span class="hljs-type"><span class="hljs-type">double</span></span> sum)-&gt;<span class="hljs-type"><span class="hljs-type">double</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i=r.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); i!=r.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++i ) { sum += piIntFunc(x); x += h; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum; //       }, []( <span class="hljs-type"><span class="hljs-type">double</span></span> x, <span class="hljs-type"><span class="hljs-type">double</span></span> y )-&gt;<span class="hljs-type"><span class="hljs-type">double</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x+y; //     } );</code> </pre> <br>  And now, if you run the application, it will work in multi-threaded mode. <br><br><h2>  <font color="#0071c5">The end</font> </h2><br>  As you can see, the development of parallel applications is very simple.  Using the calculation of Pi as an example, we were able to successfully demonstrate how the concepts of single-threaded code are applied in multi-threaded code. <br><br>  Mistress note: <br><br>  " <a href="https://www.threadingbuildingblocks.org/">Threading Building Blocks - the basic elements of multithreading</a> <br>  ¬ª <a href="https://software.intel.com/en-us/android/articles/parallel-android-applications-for-64-bit-architecture">Creating parallel Android applications for a 64-bit architecture using Intel TBB</a> <br>  ¬ª <a href="https://software.intel.com/en-us/android/articles/android-tutorial-writing-a-multithreaded-application-using-intel-threading-building-blocks">Android tutorial: writing multi-threaded applications with Intel Threading Building Blocks</a> </div><p>Source: <a href="https://habr.com/ru/post/260083/">https://habr.com/ru/post/260083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260069/index.html">Squires of microelectronics. Video report from the San Francisco Electronics Design Conference</a></li>
<li><a href="../260071/index.html">Charm Solitaire game defense study</a></li>
<li><a href="../260073/index.html">The construction of Bitcoin data centers continues, despite the fall in the cost of cryptocurrency</a></li>
<li><a href="../260077/index.html">WWDC15. Third day. Interesting</a></li>
<li><a href="../260081/index.html">On the organization of the workflow of the photographer. (Comparing with the opinion of the magazine What Digital Camera)</a></li>
<li><a href="../260085/index.html">We write SSL tunnel in python</a></li>
<li><a href="../260087/index.html">‚ÄúTabtabus 2015‚Äù - do you need it?</a></li>
<li><a href="../260089/index.html">Mobile applications and the main factors of freemium monetization. Part 1</a></li>
<li><a href="../260091/index.html">Freemium in mobile applications. The story of one failure and one success</a></li>
<li><a href="../260093/index.html">Once again about the design of the mobile application. What color to choose for your program's icon?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>