<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>5 Common Rails Developers Mistakes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I worked with Rails for a decent amount of time, and during that time I saw a lot of Rails applications, and I also read and wrote a lot of bad Ruby c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>5 Common Rails Developers Mistakes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/142/0cc/61f/1420cc61fa48df00da2fb97eafeb7459.png" align="right"><br>  I worked with Rails for a decent amount of time, and during that time I saw a lot of Rails applications, and I also read and wrote a lot of bad Ruby code.  And here are the 5 most common mistakes that I have seen in almost every application. <br><a name="habracut"></a><br><h4>  1. Migrations without restrictions </h4><br>  Your data model is the heart of your application.  Without schema constraints, due to bugs in your code, data will slowly collapse until you can rely on any field at all in your database.  Here is a schematic of the <i>Contact</i> model: <br><br><pre><code class="ruby hljs">create_table <span class="hljs-string"><span class="hljs-string">"contacts"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|t|</span></span> t.integer <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> t.string <span class="hljs-string"><span class="hljs-string">"name"</span></span> t.string <span class="hljs-string"><span class="hljs-string">"phone"</span></span> t.string <span class="hljs-string"><span class="hljs-string">"email"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  What is missing here?  Most likely <i>Contact</i> belongs to ( <i>belongs_to</i> ) user ( <i>User</i> ) and the contact must have at least a name - use database restrictions for this.  By adding " <i>: null =&gt; false</i> " we will always be sure of the integrity of the model, even if there are bugs in the validation code, because the database itself will not allow us to keep the model that violates these restrictions. <br><br><pre> <code class="ruby hljs">create_table <span class="hljs-string"><span class="hljs-string">"contacts"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|t|</span></span> t.integer <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:null</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> t.string <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:null</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> t.string <span class="hljs-string"><span class="hljs-string">"phone"</span></span> t.string <span class="hljs-string"><span class="hljs-string">"email"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  <b>Bonus hint</b> : use " <i>: limit =&gt; N</i> " to indicate the reasonable size of your string fields.  By default, the length of the string is set to 255 characters, and probably the ‚Äú <i>phone</i> ‚Äù field is completely useless, is it logical? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. Object Oriented Programming </h4><br>  Most Rails developers do not write object-oriented Ruby code.  They write MVC-oriented code by expanding the models and controllers in the right folders.  Some add auxiliary modules with class methods to the ‚Äúlib‚Äù folder, but no more.  This lasts 2-3 years before the developer realizes: ‚ÄúRails is just Ruby.  I can create simple objects and link them with the framework as I like, and not as he prescribes. ‚Äù <br><br>  <b>Bonus hint</b> : make facades for third-party services that you use.  Create a facade-mock for use in your tests, so as not to pull third-party services during testing. <br><br><h4>  3. HTML concatenation in helpers </h4><br>  If you create helper methods (well done!), Then at least you are trying to keep your templates clean.  But very often, developers do not know the basics of creating tags inside the helpers, which leads to a jumble of glued strings. <br><br><pre> <code class="ruby hljs">str = <span class="hljs-string"><span class="hljs-string">"&lt;li class='vehicle_list'&gt; "</span></span> str += link_to(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{vehicle.title.upcase}</span></span></span><span class="hljs-string"> Sale"</span></span>, show_all_styles_path(vehicle.id, vehicle.url_title)) str += <span class="hljs-string"><span class="hljs-string">" &lt;/li&gt;"</span></span> str.html_safe</code> </pre><br>  Tin!  This is ugly and easily leads to XSS vulnerabilities.  <i>content_tag</i> is your friend! <br><br><pre> <code class="ruby hljs">content_tag <span class="hljs-symbol"><span class="hljs-symbol">:li</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:class</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'vehicle_list'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> link_to(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{vehicle.title.upcase}</span></span></span><span class="hljs-string"> Sale"</span></span>, show_all_styles_path(vehicle.id, vehicle.url_title)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  <b>Bonus hint</b> : start using helpers that take a block as an argument.  Nested blocks are great when you need to generate nested HTML. <br><br><h4>  4. Huge requests load everything into memory. </h4><br>  You need to fix something in the data and you just go through them all in a loop and fix them, right? <br><br><pre> <code class="ruby hljs">User.has_purchased(<span class="hljs-literal"><span class="hljs-literal">true</span></span>).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|customer|</span></span> customer.grant_role(<span class="hljs-symbol"><span class="hljs-symbol">:customer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now imagine that you have a commercial site and a million users.  Let each object of class <i>User</i> occupy 500 bytes in memory.  Your code will have 500 MB of memory.  Better option: <br><br><pre> <code class="ruby hljs">User.has_purchased(<span class="hljs-literal"><span class="hljs-literal">true</span></span>).find_each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|customer|</span></span> customer.grant_role(<span class="hljs-symbol"><span class="hljs-symbol">:customer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  <i>find_each</i> uses the <i>find_in_batches</i> method inside itself, selecting 1000 entries at a time and significantly reducing memory consumption. <br><br>  <b>Bonus hint</b> : use <i>update_all</i> or bare SQL to perform bulk data updates.  SQL takes some time to learn, but the benefits you get will be huge: up to x100 performance gains. <br><br><h4>  5. Review Code </h4><br>  I assume that you are using GitHub, and I also assume that you are <u>not</u> using pull requests.  If you spend a day or two to implement a new feature, then do it in a separate branch and use the pull request.  Your team will be able to check your code, suggest what can be improved, and also point you to some points that you might have missed.  I guarantee that this will improve the quality of your code. <br><br>  <b>Bonus hint</b> : Do not take pool requests without tests that pass successfully.  Testing is invaluable for maintaining your application in a stable state and for your peaceful sleep. <br><br><hr><br><h5>  Bonus: useful commentary on the original article. </h5><br>  <i>find_each</i> and <i>find_in_batches are</i> preferred for large samples, however, you need to keep in mind that you change the application memory for processor cycles for the database. <br><br>  Suppose you are making a request that returns 1'000'000 records. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> unindexed_field = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  If you make <i>User.all.each</i> , the database will make one huge query, calculating the entire result at once.  If you make <i>User.where (...). Find_each (: batch_size =&gt; 100)</i> , then the database will have to do the same query 1'000'000 / 100 = 10'000 times.  And if you are using MySQL, it will recalculate the result every time.  Those.  for records 100-200, he will calculate the first 200 records, for 200-300 - the first 300 records, then for 300-400 - the first 400 records and so on up to 999900-1000000. <br><br>  So for large samples it is certainly better to use <i>find_each</i> or <i>find_in_batches</i> , but keep in mind that this can also cause problems for you. <br><br>  The general ‚Äúhack‚Äù for solving this problem is: <br><br><pre> <code class="ruby hljs">ids = User.where(...).select(<span class="hljs-symbol"><span class="hljs-symbol">:id</span></span>).all ids.in_groups_of(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|id_group|</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... end</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/143569/">https://habr.com/ru/post/143569/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143564/index.html">CISCO ACE - Application Balancing</a></li>
<li><a href="../143565/index.html">Alternative method of visualization of the progress of the IT project</a></li>
<li><a href="../143566/index.html">What does your application code look like?</a></li>
<li><a href="../143567/index.html">Codeception - project news</a></li>
<li><a href="../143568/index.html">433MHz radio channel and time synchronization from GPS</a></li>
<li><a href="../143570/index.html">Post office. Linux tuning basics</a></li>
<li><a href="../143571/index.html">How was the Moscow Facebook Garage</a></li>
<li><a href="../143572/index.html">Qt Creator 2.5.0 has been released!</a></li>
<li><a href="../143574/index.html">Improving the "endless scrolling"</a></li>
<li><a href="../143575/index.html">Screwing Head Up Display to MonoDevelop or how the global menu is crookedly done in Ubuntu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>