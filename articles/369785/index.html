<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to do a search for users on GitHub on WebAssembly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! On August 24, 2018, Go version 1.11 was released with experimental support for WebAssembly (Wasm). The technology is interesting and I immediat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to do a search for users on GitHub on WebAssembly</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/7c8/ee1/568/7c8ee156890a802bdb318b9abc7e3555.png" alt="image"></p><br><p>  Hello!  On August 24, 2018, <a href="">Go</a> version <a href="">1.11 was released</a> with experimental support for WebAssembly (Wasm).  The technology is interesting and I immediately had a desire to experiment.  To write "Hello World" is boring (and by the way it is in the documentation), especially the trend of last summer is an article from the series "How to search for users on GitHub &lt;insert your favorite JS framework&gt;" </p><a name="habracut"></a><br><p>  So, this article is a continuation of the cycle.  Here are the previous chapters: <br>  <a href="https://habr.com/post/419559/">How to search for users on GitHub using React + RxJS 6 + Recompose</a> <br>  <a href="https://habr.com/post/419653/">How to search for users on GitHub without React + RxJS 6 + Recompose</a> <br>  <a href="https://habr.com/post/420351/">How to search for users on GitHub using Vue</a> <br>  <a href="https://habr.com/post/419933/">How to do a search for users on Github using Angular</a> <br>  <a href="https://habr.com/post/419893/">How to search for users on Github using VanillaJS</a> </p><br><p>  Task: it is necessary to implement a search for users on GitHub with login input and dynamic HTML generation.  As previous publications show, this is done elementarily, but in our case we will not use JavaScript.  It should be this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c2/020/f20/9c2020f205bbbbaeae6734360cf7bfe9.gif" alt="image"></p><br><p>  <em>Attention!</em>  <em>This article does not call to throw JS and rewrite all web applications on Go, but only shows the possibilities of working with JS API from WASM.</em> </p><br><h2 id="ustanovka">  Installation </h2><br><p>  First of all, it is worth upgrading to the latest version of Go (at the time of writing of article 1.11) <br>  Copy two files with HTML &amp; JS support into your project </p><br><pre><code class="bash hljs">cp $(go env GOROOT)/misc/wasm/wasm_exec.{html,js} .</code> </pre> <br><p>  Hello World and the basic HTTP server settings I‚Äôll skip, details can be found on the <a href="https://github.com/golang/go/wiki/WebAssembly">Go Wiki</a> </p><br><h2 id="vzaimodeystvie-s-dom">  DOM interaction </h2><br><p>  It is carried out through the <a href="https://tip.golang.org/pkg/syscall/js/"><code>syscall/js</code></a> package <br>  The article will use the following functions and methods for managing JavaScript: </p><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// ,   JavaScript js.Value //    JavaScript,    `window` func Global() Value //      func (v Value) Call(m string, args ...interface{}) Value //     func (v Value) Get(p string) Value //     func (v Value) Set(p string, x interface{})</span></span></code> </pre> <br><p>  All methods have analogues in JS, and will become clearer in the course of the article. </p><br><h2 id="pole-vvoda">  Entry field </h2><br><p>  To begin with, we will create a field in which the user will enter a login for the search, this will be a classic <code>input</code> tag with <code>placeholder</code> . <br>  In the future, we will need to create another tag, so we immediately write the HTML element constructor. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Element <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { tag <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> params <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br><p>  The structure of the HTML element contains the tag name of the <code>tag</code> (for example, <code>input</code> , <code>div</code> , etc.) and additional <code>params</code> parameters (for example: <code>placeholder</code> , <code>id</code> , etc.) </p><br><p>  The constructor itself looks like this: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(el *Element)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Value</span></span></span></span> { e := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"document"</span></span>).Call(<span class="hljs-string"><span class="hljs-string">"createElement"</span></span>, el.tag) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> attr, value := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> el.params { e.Set(attr, value) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e }</code> </pre> <br><p>  <code>e := js.Global().Get("document").Call("createElement", el.tag)</code> is an analogue of <code>var e = document.createElement(tag)</code> in JS <br>  <code>e.Set(attr, value)</code> analogue of <code>e.setAttribute(attr, value)</code> <br>  This method only creates elements, but does not add them to the page. </p><br><p>  To add an element to a page, you need to define the place of its insertion  In our case, this is a <code>div</code> with <code>id="box"</code> (in <code>wasm_exec.html</code> string <code>&lt;div id="box"&gt;&lt;/div&gt;</code> ) </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Box <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { el js.Value } box := Box{ el: js.Global().Get(<span class="hljs-string"><span class="hljs-string">"document"</span></span>).Call(<span class="hljs-string"><span class="hljs-string">"getElementById"</span></span>, <span class="hljs-string"><span class="hljs-string">"box"</span></span>), }</code> </pre> <br><p>  In box.el there is a link to the main container of our application. <br>  <code>js.Global().Get("document").Call("getElementById", "box")</code> in JS is <code>document.getElementById('box')</code> </p><br><p>  The method of creating the input element itself: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Box)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createInputBox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Value</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//  el := Element{ tag: "input", params: map[string]string{ "placeholder": "GitHub username", }, } //   input := el.createEl() //     div  id="box" b.el.Call("appendChild", input) return input }</span></span></code> </pre> <br><p>  This method returns a link to the created item. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"GitHub username"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2 id="konteyner-vyvoda-rezultatov">  Output Container </h2><br><p>  The results should be displayed on the page, let's add a <code>div</code> c <code>id="search_result"</code> by analogy with <code>input</code> </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Box)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createResultBox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">js</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Value</span></span></span></span> { el := Element{ tag: <span class="hljs-string"><span class="hljs-string">"div"</span></span>, params: <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"search_result"</span></span>, }, } div := el.createEl() b.el.Call(<span class="hljs-string"><span class="hljs-string">"appendChild"</span></span>, div) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> div }</code> </pre> <br><p>  A container is created and the element reference is returned. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search_result"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  It's time to define the structure for our entire Web application. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { inputBox js.Value resultBox js.Value } a := App{ inputBox: box.createInputBox(), resultBox: box.createResultBox(), }</code> </pre> <br><p>  <code>inputBox</code> and <code>resultBox</code> are links to previously created <code>&lt;input placeholder="GitHub username"&gt;</code> and <code>&lt;div id="search_result"&gt;&lt;/div&gt;</code> respectively </p><br><p>  Fine!  We have added two elements to the page.  Now the user can enter data into the <code>input</code> and look at the empty <code>div</code> , not bad, but so far our application is not interactive.  Let's fix it. </p><br><h2 id="sobytie-vvoda">  Input event </h2><br><p>  We need to track when the user enters the login in <code>input</code> and receive this data, for this we subscribe to the keyup event, to make it very simple </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { a.input.Call(<span class="hljs-string"><span class="hljs-string">"addEventListener"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyup"</span></span>, js.NewCallback(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { e := args[<span class="hljs-number"><span class="hljs-number">0</span></span>] user := e.Get(<span class="hljs-string"><span class="hljs-string">"target"</span></span>).Get(<span class="hljs-string"><span class="hljs-string">"value"</span></span>).String() <span class="hljs-built_in"><span class="hljs-built_in">println</span></span>(user) })) }</code> </pre> <br><p>  <code>e.Get("target").Get("value")</code> - getting the value of <code>input</code> , analogue of <code>event.target.value</code> in JS, <code>println(user)</code> normal <code>console.log(user)</code> </p><br><p>  Thus, we will consolidate all user actions on entering a login into <code>input</code> . <br>  Now we have data with which we can form a request to the GitHub API </p><br><h2 id="zaprosy-k-github-api">  GitHub API Requests </h2><br><p>  We will request information on registered users: get-request for <a href="https://api.github.com/users/:username">https://api.github.com/users/:username</a> <br>  But first, let's define the response structure of the GitHub API. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Search <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Response Response Result Result } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Response <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Status <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }<span class="hljs-string"><span class="hljs-string">` `</span></span><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Result <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Login <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"login"`</span></span> ID <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"message"`</span></span> DocumentationURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"documentation_url"`</span></span> AvatarURL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"avatar_url"`</span></span> Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> PublicRepos <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"public_repos"`</span></span> PublicGists <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"public_gists"`</span></span> Followers <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"followers"`</span></span> }</code> </pre> <br><p>  <code>Response</code> - contains the server's response, for our application only the <code>Status string</code> is needed - it will be required for output on the error page. <br>  <code>Result</code> - the response body in abbreviated form, only the required fields. </p><br><p>  Requests themselves are formed through the standard <code>net/http</code> package </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserCard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { resp, err := http.Get(ApiGitHub + <span class="hljs-string"><span class="hljs-string">"/users/"</span></span> + user) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> resp.Body.Close() b, err := ioutil.ReadAll(resp.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> search Search json.Unmarshal(b, &amp;search.Result) search.Response.Status = resp.Status a.search &lt;- search }</code> </pre> <br><p>  Now that we have a method for retrieving user information from the GitHub API, let's modify <code>userHandler()</code> and in the meantime expand the structure of the <code>App</code> Web application by adding a <code>chan Search</code> channel to transfer data from the <code>getUserCard()</code> </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { inputBox js.Value resultBox js.Value search <span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> Search } a := App{ inputBox: box.createInputBox(), resultBox: box.createResultBox(), search: <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> Search), } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { a.input.Call(<span class="hljs-string"><span class="hljs-string">"addEventListener"</span></span>, <span class="hljs-string"><span class="hljs-string">"keyup"</span></span>, js.NewCallback(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { e := args[<span class="hljs-number"><span class="hljs-number">0</span></span>] user := e.Get(<span class="hljs-string"><span class="hljs-string">"target"</span></span>).Get(<span class="hljs-string"><span class="hljs-string">"value"</span></span>).String() <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> a.getUserCard(user) })) }</code> </pre> <br><h2 id="shablonizator">  Template engine </h2><br><p>  Perfectly!  We received user information and we have a container for insertion.  Now we need an HTML template and, of course, some simple template engine.  In our application we will use <a href="http://mustache.github.io/">mustache</a> - this is a popular template engine with simple logic. <br>  Installation: <code>go get github.com/cbroglie/mustache</code> </p><br><p>  The <code>user.mustache</code> HTML template <code>user.mustache</code> is located in the <code>tmpl</code> directory of our application and looks like this: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"github-card user-card"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"header User"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/{{Result.Login}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{Result.AvatarURL}}&amp;s=80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{Result.Name}}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{{Result.Name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"status"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/{{Result.Login}}?tab=repositories"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>{{Result.PublicRepos}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>Repos <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://gist.github.com/{{Result.Login}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>{{Result.PublicGists}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>Gists <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/{{Result.Login}}/followers"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>{{Result.Followers}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>Followers <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  All styles are written in <code>web/style.css</code> </p><br><p>  The next step is to get the template as a string and drop it into our application.  To do this, again expand the App structure by adding the required fields there. </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { inputBox js.Value resultBox js.Value userTMPL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> errorTMPL <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> search <span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> Search } a := App{ inputBox: box.createInputBox(), resultBox: box.createResultBox(), userTMPL: getTMPL(<span class="hljs-string"><span class="hljs-string">"user.mustache"</span></span>), errorTMPL: getTMPL(<span class="hljs-string"><span class="hljs-string">"error.mustache"</span></span>), search: <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> Search), }</code> </pre> <br><p>  <code>userTMPL</code> is a <code>user.mustache</code> user information output template.  <code>errorTMPL</code> - <code>error.mustache</code> error handling template </p><br><p>  To get the template from the application, use the usual Get-request </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTMPL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { resp, err := http.Get(<span class="hljs-string"><span class="hljs-string">"tmpl/"</span></span> + name) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> resp.Body.Close() b, err := ioutil.ReadAll(resp.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(b) }</code> </pre> <br><p>  There is a template, there is data. Now we are trying to render an HTML representation. </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmpl <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { search := &lt;-a.search <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> search.Result.ID { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">// TMPL for Error page tmpl = a.errorTMPL default: tmpl = a.userTMPL } data, _ := mustache.Render(tmpl, search) // Output the resultBox to a page a.resultBox.Set("innerHTML", data) } }</span></span></code> </pre> <br><p>  This is a horutin that expects data from the &lt;-a.search channel and renders HTML.  Conventionally, we assume that if there is a user ID search.Result.ID in the data from the GitHub API, then the result is correct, otherwise we return an error page. <br>  <code>data, _ := mustache.Render(tmpl, search)</code> - renders ready HTML, and <code>a.resultBox.Set("innerHTML", data)</code> displays HTML on the page </p><br><h2 id="debounce">  Debounce </h2><br><p>  Works!  But there is one problem - if you look at the console, we see that a request to the GitHub API is sent to every keystroke, in this situation, we will quickly rest in limits. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ccf/7bc/340/ccf7bc340966fcca87b2319ba5437b7d.gif" alt="image"></p><br><p>  The solution is Debounce.  This is a function that defers a call to another function for a specified time.  That is, when a user clicks a button, we must postpone the request to the GitHub API for X milliseconds, and if another event is triggered by pressing the button, the request is postponed for another X milliseconds. </p><br><p>  Debounce in Go is implemented using channels.  The working version took from the article <a href="https://drailing.net/2018/01/debounce-function-for-golang/">debounce function for golang</a> </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">debounce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interval time.Duration, input </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, cb </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">func</span></span></span></span><span class="hljs-function"><span class="hljs-params">(arg </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> timer := time.NewTimer(interval) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> item = &lt;-input: timer.Reset(interval) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> &lt;-timer.C: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item != <span class="hljs-string"><span class="hljs-string">""</span></span> { cb(item) } } } }</code> </pre> <br><p>  Rewrite the method <code>(a *App) userHandler()</code> with Debounce: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { spammyChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> debounce(<span class="hljs-number"><span class="hljs-number">1000</span></span>*time.Millisecond, spammyChan, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Get Data with github api go a.getUserCard(arg) }) a.inputBox.Call("addEventListener", "keyup", js.NewCallback(func(args []js.Value) { e := args[0] user := e.Get("target").Get("value").String() spammyChan &lt;- user println(user) })) }</span></span></code> </pre> <br><p>  The <code>keyup</code> event is <code>keyup</code> triggered, but requests are sent only 1000ms after the last event is completed. </p><br><h2 id="poliruem">  Polish </h2><br><p>  And finally, we will slightly improve our UX by adding the loading indicator "Loading ..." and emptying the container in the case of an empty <code>input</code> </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadingResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { a.resultBox.Set(<span class="hljs-string"><span class="hljs-string">"innerHTML"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;b&gt;Loading...&lt;/b&gt;"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { a.resultBox.Set(<span class="hljs-string"><span class="hljs-string">"innerHTML"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) }</code> </pre> <br><p>  The final version of the <code>(a *App) userHandler()</code> method looks like this: </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a *App)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { spammyChan := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> debounce(<span class="hljs-number"><span class="hljs-number">1000</span></span>*time.Millisecond, spammyChan, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Get Data with github api go a.getUserCard(arg) }) a.inputBox.Call("addEventListener", "keyup", js.NewCallback(func(args []js.Value) { // Placeholder "Loading..." a.loadingResults() e := args[0] // Get the value of an element user := e.Get("target").Get("value").String() // Clear the results block if user == "" { a.clearResults() } spammyChan &lt;- user println(user) })) }</span></span></code> </pre> <br><p>  Done!  Now we have a full search for users on GitHub without a single line on JS.  In my opinion it's cool. </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  Writing a Web application that works with the DOM on wasm is possible, but is it a question whether it should be done.  Firstly, it‚Äôs not yet clear how to test the code, secondly, in some browsers it‚Äôs not working stably (for example, in Chrome it fell with an error once, in FF it‚Äôs better), thirdly, all work with DOM is done through the JS API what should have an impact on performance (though I didn‚Äôt do measurements, that's why everything is subjective) </p><br><p>  By the way, most of the examples are <a href="https://github.com/stdiopt/gowasm-experiments">working with graphics on canvas</a> and performing heavy calculations, most likely wasm was designed specifically for these tasks.  Although ... time will tell. </p><br><h2 id="sborka-i-zapusk">  Build and Run </h2><br><h4 id="kloniruem-repozitoriy">  Clone the repository </h4><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> work_dir git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/maxchagin/gowasm-example ./gowasm-example <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gowasm-example</code> </pre> <br><h4 id="sborka">  Assembly </h4><br><pre> <code class="bash hljs">GOARCH=wasm GOOS=js go build -o web/test.wasm main.go</code> </pre> <br><h4 id="zapusk-servera">  Server startup </h4><br><pre> <code class="bash hljs">go run server.go</code> </pre> <br><h4 id="prosmotr">  View </h4><br><pre> <code class="bash hljs">http://localhost:8080/web/wasm_exec.html</code> </pre> <br><p>  <a href="https://github.com/maxchagin/gowasm-example">Sources on github</a> <br>  <a href="http://wasm.lovefrontend.ru/web/wasm_exec.html">Interactive demo on lovefrontend.ru</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/369785/">https://habr.com/ru/post/369785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../369775/index.html">Reusable spacecraft</a></li>
<li><a href="../369777/index.html">Three-kilowatt teapots, television without ads, or why British energy producers watch soap operas at work</a></li>
<li><a href="../369779/index.html">Mercedes-Benz: for an autonomous car, driver's life is paramount</a></li>
<li><a href="../369781/index.html">Yoga Book: the first tablet with notes and sketches</a></li>
<li><a href="../369783/index.html">LED lamps REV</a></li>
<li><a href="../369787/index.html">Tesla Motors presented the new improved autopilot</a></li>
<li><a href="../369793/index.html">The display indicator on electronic ink "lives" on solar energy and never requires recharging</a></li>
<li><a href="../369795/index.html">The inclination of the axis of rotation of the sun can be explained by the influence of the undiscovered planet of the solar system</a></li>
<li><a href="../369799/index.html">Absurd patents. Rectangles on the screen</a></li>
<li><a href="../369801/index.html">Australian scientists have increased qubit stability 10 times</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>