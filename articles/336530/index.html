<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Self-sufficient controls on Xamarin.Forms. Part 3. We understand with NuGet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In past chapters, we built the application architecture on Xamarin so that individual controls can be reused in the most simple way in other applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Self-sufficient controls on Xamarin.Forms. Part 3. We understand with NuGet</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/338/941/036/3389410364644f5ab659bc8a4b0b7044.png"><br>  In past chapters, we built the application architecture on Xamarin so that individual controls can be reused in the most simple way in other applications.  In this part, we will wrap these controls into a separate NuGet package, publish it on <a href="https://www.nuget.org/">nuget.org</a> and try to reuse them in another application, while writing the minimum amount of code. <br><a name="habracut"></a><br>  In the <a href="https://habrahabr.ru/company/mobile_dimension/blog/327576/">first</a> and in the <a href="https://habrahabr.ru/company/mobile_dimension/blog/331196/">second</a> chapters, we developed an application that consisted of 3 main controls: authorization, product catalog, shopping cart.  This is perhaps the typical set for any online store.  The structure of the application was as follows: <br><br>  Authorization ‚Üí Catalog of goods ‚Üí Basket. <br><br>  Initially, the user sees the authorization window, then adds products from the catalog to the basket.  Imagine a lamp situation where a customer EXTREMELY wants to change this structure to the following: on the first screen, show immediately the catalog of products that can be viewed, but cannot be added to the basket until the user is authorized to fill the basket in a separate window. <br><img src="https://habrastorage.org/web/8b7/ca2/2f8/8b7ca22f8a84405b9b507f67fe5a79b6.png"><br><blockquote>  <i>‚Ä¶ lyrical digression</i> <i><br></i>  <i>In Agile conditions, this situation can occur very often and we, the developers, should be ready for such changes in requirements.</i>  <i>Unfortunately, I increasingly encounter situations where, in order to implement such requirements of the customer, the team is working on crutches to release a new version of the application as soon as possible.</i>  <i>Gradually, the number of crutches increases, they can generate new bugs and the project becomes difficult to maintain.</i>  <i>As a result, it is necessary to spend weeks, or even months, on refactoring of entangled links between modules.</i>  <i>On the other hand, it was possible to spend this time at the start of the project to create an architecture ready for such changes.</i>  <i>The main idea of ‚Äã‚Äãthis architecture is that controls (self-contained controls) should not depend on other controls so that they can be isolated, changed, combined with each other, etc. But their interaction should be carried out according to the model of subscriptions in one particular place.</i>  <i>It turns out that some kind of microservice architecture, but at the front end.</i>  <i>:)</i> </blockquote><br>  Were a little embarrassed, let's proceed to the task. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Chapter 1. Creating a NuGet package and publishing it in nuget.org.</b> <br><br>  For the task set forth above, of course, it is not necessary to create nuget packages, but why not simultaneously deal with how it all works.  And it works in the truth is very simple.  Take the project that we created during the previous 2 articles, it consists of 3 modules: Android, IOS and the so-called Portable Class Library.  We will create packages in Visual Studio for Mac. <br><br>  1) Go to the properties of the PCL project (right mouse button on the project name -&gt; Options) <br>  2) We are looking for the tab NuGet Package ‚Üí Metadata <br><br><img src="https://habrastorage.org/web/b87/a11/b93/b87a11b9327840e19990d7d89f0833f1.png"><br><br>  Fill in the fields in General.  They are required.  It is recommended to immediately come up with some kind of unique ID.  You can go to the site nugget.org and try to find a library with your ID.  If this is not - you can take it.  Unfortunately, there is no check for uniqueness right in VS.  Version: 1.0.0.  The version must be specified exactly so that it would be easier to update the assembly later.  Close the window, build the project. <br><br>  3) Click on the project name with the right mouse button, select the item ‚ÄúCreate NuGet Package‚Äù <br><br><img src="https://habrastorage.org/web/e50/f71/df6/e50f71df6d3042709325f0617364debc.png"><br><br>  Packages will be created and saved in the &lt;project name&gt; / &lt;project name&gt; / bin / debug / &lt;package ID&gt;. &lt;Version&gt; .nupkg folder. <br><br>  In my case it is ... / test5 / test5 / bin / debug / my_test_nuget.1.0.0.nupkg <br><br>  This package we will upload to nuget.org <br><br>  4) Go to the website nuget.org.  Log in / register.  Go to the Upload tab, and load the file with the .nupkg permission from item 3. <br><br><img src="https://habrastorage.org/web/f26/2bc/cd8/f262bccd81fa49759693c9bcb6729143.png"><br><br>  We can add some additional information and click Submit.  We will not find this package in NuGet search (it will appear in it after indexing - usually it is an hour), but this package can be added to any projects via the console ... <br><br><img src="https://habrastorage.org/web/846/cdb/c39/846cdbc3903747738d53d2d6f0b0eb9e.png"><br><br>  If you see such a message, then you did everything right. <br><br>  <b>Chapter 2. The use of self-sufficient controls in other projects</b> <br><br>  So, I created and published controls from previous chapters (authorization, product catalog and shopping cart) <br><br>  Create a new project and add a published assembly to it.  I called it shop_controls_toolkit.  You can add it in several ways: <br><br>  1) From the Nuget console (Install-Package shop_controls_toolkit -Version 1.0.8) <br>  2) Or find it in the NuGet search (Packaged -&gt; Add Package) <br><br>  Add the necessary controls to MainPage.xaml <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContentPage</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://xamarin.com/schemas/2014/forms"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2009/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:testapp2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testapp2.testapp2Page"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:controls</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:testcontrols;assembly=testcontrols"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:ProductsListing</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"listing"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:ProductsListing</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"menu"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:AuthorizationView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"auth"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:AuthorizationView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:BasketView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"basket"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:BasketView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Clicked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Handle_Clicked"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"burger.png"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContentPage</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It is necessary to register xmlns so that at this level the controls from the added library are visible. <br><br><pre> <code class="xml hljs">xmlns:controls="clr-namespace:testcontrols;assembly=testcontrols"</code> </pre> <br>  For the corresponding visual effect, you also need to specify the location of the Vertical and Horizontal Options controls. <br><br>  In the code-behind, you need to initialize the use of all controllers and services from the testcontrols library, you can do this, for example, in the App.cs constructor <br><br><pre> <code class="cs hljs">testcontrols.Core.DI.Bootstrapper.RegisterIoC();</code> </pre> <br>  You also need to subscribe to the appropriate services, as described in part 2. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testapp2Page</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); _authService = Container.GetInstance&lt;IAuthorizationService&gt;(); _authService.AuthorizationChanged += AuthService_AuthorizationChanged; listing.AddProductRequest += Listing_AddProductRequest; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthService_AuthorizationChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isAuth</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isAuth) { basket.IsVisible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; auth.IsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { basket.IsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; auth.IsVisible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre><br>  Those.  show the cart or authorization depending on whether a person is authorized. <br><br>  Similarly, you can subscribe to events in the listing of goods.  For example, we want to restrict the addition of goods to the cart so that they can be added only when an authorized client. <br><br>  Subscribe in the designer for the Action control of the AddProductRequest product catalog <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Listing_AddProductRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sku</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_isAuth) { _basketService.StartAddingProduct(sku); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> DisplayAlert(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">$" ,       "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre><br>  Well, then you can subscribe to the entire event without delving into the implementation of the controls itself.  BasketService also has fields such as TotalCount or TotalPrice ... <br><br><img src="https://habrastorage.org/web/168/247/5c3/1682475c3d7b4bb3a33aefcfc8caa7de.gif" width="300"><br><br>  <b>Update Nuget Packages</b> <br><br>  If suddenly we want to update something in the control library, we need to increase the project version in the project's Options, and upload the file with the enlarged version on nuget.org. .  Nuget itself will understand that this is just a new version of an existing library, and will update its version. <br><br>  After a while (usually up to 10 minutes) in the project that uses this library, a label will appear next to the name of the assembly, which will mean that the version can be updated.  Updating ... <br><br><img src="https://habrastorage.org/web/f0d/7f3/ee5/f0d7f3ee5cf84197b1c0ba71f88d4fa9.png"><br><br>  That's all. <br><br>  Thanks to this approach, we can create different controls, wrap them in a separate NuGet package and reuse it in all applications. <br><br>  You can overload the package initialization method, where additional settings will be available, for example: URL back-end API of the application, data cache storage time, etc., to make controls even more universal.  In the application we will not delve into the implementation of these controls - the main thing is to use them correctly.  The speed of development will increase, the number of crutches will decrease, and our managers will be happy with the speed of making the changes necessary for the business. <br><br>  ‚Üí The project <a href="https://github.com/MobileDimension/XamarinControllsToolkit">is available in GitHub</a> <br><br>  It is interesting what Habr's users think about this approach - leave comments.  We are planning to create a universal library for any online store in order to simplify the creation of such B2C or B2B applications. <br><br>  Read previous articles in the cycle <a href="https://habrahabr.ru/company/mobile_dimension/blog/331196/">here</a> and <a href="https://habrahabr.ru/company/mobile_dimension/blog/327576/">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/336530/">https://habr.com/ru/post/336530/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336520/index.html">DevOps Evolution</a></li>
<li><a href="../336522/index.html">Who are all these people? Let's ask K50</a></li>
<li><a href="../336524/index.html">As a rule of thumb, ‚Äúwinner takes all‚Äù works and does not work in development.</a></li>
<li><a href="../336526/index.html">Why with NDFLka.ru you will love the queue</a></li>
<li><a href="../336528/index.html">Creating an outbound application in the 3CX Call Flow Designer development environment</a></li>
<li><a href="../336532/index.html">Do yourself and the company a service: reduce the meeting by 2 times</a></li>
<li><a href="../336540/index.html">Managing the development of technologically complex Internet applications in the context of an acute shortage of time</a></li>
<li><a href="../336542/index.html">3 main process of working with clients, which should automate the CRM system. How not to miss with a choice. Part 1</a></li>
<li><a href="../336550/index.html">Perl Script to help HTML coder</a></li>
<li><a href="../336552/index.html">Why CNTK?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>