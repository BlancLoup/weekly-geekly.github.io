<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android component from scratch - 2 - Magnifier for image</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From time to time on the Internet, mainly on the sites of various stores and marketplaces, we are confronted with a software magnifying glass that all...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android component from scratch - 2 - Magnifier for image</h1><div class="post__text post__text-html js-mediator-article">  From time to time on the Internet, mainly on the sites of various stores and marketplaces, we are confronted with a software magnifying glass that allows us to examine in more detail photos of various goods (something similar is implemented on the site <a href="http://www.ebay.com/">www.ebay.com</a> ).  Creating a magnifying glass for the Android platform, we will do (especially for beginners). <a name="habracut"></a><br><br>  Task: Develop a component-magnifier for a more detailed consideration of photos.  Initially, the screen shows a picture whose dimensions are proportional to the screen of the device (the picture is shown on the screen in full).  When you touch your finger on the screen, the picture should increase and show this area relative to the touch; P. <br><br><h4>  Training </h4><br>  Create a new project and the ‚ÄúPZoom‚Äù class, use the View class as an ancestor. <br>  We are interested in the following functions: <br>  PZoom - class constructor; <br>  onDraw - the drawing function, is called every time it is necessary to redraw the component; <br>  onTouchEvent - the function of tracking external events, is called each time the user presses the screen with the finger and hits the component, as well as when he leads his finger over the component and also presses the finger. <br>  Simplify your task, we will use only one image previously placed in the Drawable folder with the name ‚Äúimg‚Äù (the more the picture is, the more visual effect you will get).  At the beginning of the class we will declare a new object of type Drawable. <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Drawable image; <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre> <br>  Next, in the constructor, put the desired image in the image and set the frame: <br><pre> <code class="java hljs">image = context.getResources().getDrawable(R.drawable.img); image.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, image.getIntrinsicWidth(), image.getIntrinsicHeight());</code> </pre><br>  Now re-create the drawing procedure: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas); canvas.save(); <span class="hljs-comment"><span class="hljs-comment">//    (,   .....) image.draw(canvas); //      canvas.restore(); //  ,      }</span></span></code> </pre><br>  Go to the main class of the application and modify the class constructor as follows: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PZoom(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); }</code> </pre><br>  These actions create the Pzoom class and define it as the main one, that is, now only this component will be displayed on the screen. <br>  Now, if you run the application, you will see on the screen only a part of the downloaded picture, since it does not fit completely on the screen (the picture is larger than the screen). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Functional </h4><br>  To begin with, we will do so that by default the picture is placed in the middle of the screen and its dimensions are proportional to the screen.  To do this, we write a separate function SetCenter, which determines the position of the picture on the surface, as well as the correct multiplier for the proportion. <br>  We declare additional variables at the beginning of the class: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X = <span class="hljs-number"><span class="hljs-number">0</span></span>,Y = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     float scale = 0; //    int pX = 0, pY = 0; //     int dWidth = 0, dHeight = 0; //  </span></span></code> </pre><br>  Now the body of the function itself (there is no sense to chew on it, this is elementary mathematics): <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCenter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     if(dWidth&gt;dHeight) // scale = (float)dHeight/image.getIntrinsicHeight(); else scale = (float)dWidth/image.getIntrinsicWidth(); //    if((dWidth-image.getIntrinsicWidth()*scale)&gt;0){ X = (int)((dWidth-(image.getIntrinsicWidth()*scale))/2/scale); Y = 0; } else { X = 0; Y = (int)((dHeight-(image.getIntrinsicHeight()*scale))/2/scale); } }</span></span></code> </pre><br>  Now we add the widget's drawing function: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas); canvas.save(); <span class="hljs-comment"><span class="hljs-comment">//    (,   .....) if (dWidth==0){ //        dWidth = canvas.getWidth(); dHeight = canvas.getHeight(); } if (pX==0) { //    SetCenter(); //      } canvas.scale(scale, scale); // ZooM canvas.translate(X,Y); //   image.draw(canvas); //      canvas.restore(); //  ,      }</span></span></code> </pre><br>  At the beginning, there is a data availability check in the variable size of the widget; if they are equal to zero, then we know the dimensions of the widget.  Next, there is a data availability check in the variable position of the cursor, if it is even zero (the user's finger is not on the widget) then we start the function of centering the picture.  After that, the image is resized in accordance with the stretch value.  Then the map is shifted.  At the end, the picture is drawn and the matrices are reset. <br>  Moving on to the most important thing - changing the size and position of the image relative to the pressed finger.  First of all, you should override the finger positioning procedure on the <b>onTouchEvent</b> screen: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   pX=(int) event.getX(); //   X pY=(int) event.getY(); //   Y int Action=event.getAction(); //  //   if (Action==MotionEvent.ACTION_UP){ pX = 0; pY = 0; } invalidate(); //   return true; }</span></span></code> </pre><br>  I will not describe, who are interested then refer to the <a href="http://habrahabr.ru/post/188092/">first</a> article.  It remains to create a procedure for calculating the new position of the image on the screen, it will look like this: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ scale = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    //          X = (int)((float)-image.getIntrinsicWidth()*((float)pX/dWidth)+((float)dWidth*((float)pX/dWidth))); Y = (int)((float)-image.getIntrinsicHeight()*((float)pY/dHeight)+((float)dHeight*((float)pY/dHeight))); //         if (X&gt;0) X=0; if (Y&gt;0) Y=0; }</span></span></code> </pre><br>  Slightly changing the rendering function of the video view, namely, if the variable position of the cursor is not empty, then we calculate the new position: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pX==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    SetCenter(); //      } else { NewPosition(); //      }</span></span></code> </pre><br>  If everything is done correctly, then when you click on the picture, it will increase and move around the screen relative to the user's finger.  Have a good test! <br><br>  The final view of the magnifying class picture: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.gc986.photozoom; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Canvas; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.drawable.Drawable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.MotionEvent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PZoom</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Drawable image; <span class="hljs-comment"><span class="hljs-comment">//   int X = 0,Y = 0; //     float scale = 0; //    int pX = 0, pY = 0; //     int dWidth = 0, dHeight = 0; //   public PZoom(Context context) { super(context); //     image = context.getResources().getDrawable(R.drawable.img); image.setBounds(0, 0, image.getIntrinsicWidth(), image.getIntrinsicHeight()); } @Override protected void onDraw(Canvas canvas) { super.onDraw(canvas); canvas.save(); //    (,   .....) if (dWidth==0){ //        dWidth = canvas.getWidth(); dHeight = canvas.getHeight(); } if (pX==0) { //    SetCenter(); //      } else { NewPosition(); //      } canvas.scale(scale, scale); // ZooM canvas.translate(X,Y); //   image.draw(canvas); //      canvas.restore(); //  ,      } /** */ void SetCenter(){ //     if(dWidth&gt;dHeight) // scale = (float)dHeight/image.getIntrinsicHeight(); else scale = (float)dWidth/image.getIntrinsicWidth(); //    if((dWidth-image.getIntrinsicWidth()*scale)&gt;0){ X = (int)((dWidth-(image.getIntrinsicWidth()*scale))/2/scale); Y = 0; } else { X = 0; Y = (int)((dHeight-(image.getIntrinsicHeight()*scale))/2/scale); } } /**   */ void NewPosition(){ scale = 1; //    //          X = (int)((float)-image.getIntrinsicWidth()*((float)pX/dWidth)+((float)dWidth*((float)pX/dWidth))); Y = (int)((float)-image.getIntrinsicHeight()*((float)pY/dHeight)+((float)dHeight*((float)pY/dHeight))); //         if (X&gt;0) X=0; if (Y&gt;0) Y=0; } @Override public boolean onTouchEvent(MotionEvent event) { //   pX=(int) event.getX(); //   X pY=(int) event.getY(); //   Y int Action=event.getAction(); //  //   if (Action==MotionEvent.ACTION_UP){ pX = 0; pY = 0; } invalidate(); //   return true; } }</span></span></code> </pre><br>  So it should happen ideally - <a href="http://youtu.be/GHB91_RzORY">http://youtu.be/GHB91_RzORY</a> <br>  The archive of the example with all the comments can be downloaded from the following link - <a href="">http://www.anprog.com/documents/Photo_Zoom.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/191898/">https://habr.com/ru/post/191898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191886/index.html">Attraction of unprecedented generosity from the University of Eastern Finland</a></li>
<li><a href="../191888/index.html">RailsClub'Moscow 2013. Interview with Ernie Miller</a></li>
<li><a href="../191892/index.html">To GIF or not to GIF?</a></li>
<li><a href="../191894/index.html">3CXPhone for Android user guide published</a></li>
<li><a href="../191896/index.html">MegaFon launches Russian accounting system in housing and public utilities</a></li>
<li><a href="../191902/index.html">Create autonomous robot Frank. Part two</a></li>
<li><a href="../191904/index.html">PowerLoader 64-bit updated with new LPE exploits</a></li>
<li><a href="../191906/index.html">Highscreen Omega Prime XL Review</a></li>
<li><a href="../191908/index.html">Loc Kit: localization management and machine translation</a></li>
<li><a href="../191910/index.html">Pixel-perfect layout of Android layouts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>