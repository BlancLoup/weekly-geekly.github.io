<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The danger of using "training" crypto protocols</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post was inspired not by the post by EugeneSukhov himself , but by the first comment from @AstralMan. 

 Indeed, often seeing a description or ev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The danger of using "training" crypto protocols</h1><div class="post__text post__text-html js-mediator-article"> This <a href="http://habrahabr.ru/blogs/web_security/120876/">post was</a> inspired not by the <a href="http://habrahabr.ru/blogs/web_security/120876/">post</a> by <a href="http://habrahabr.ru/users/eugenesukhov/" class="user_link">EugeneSukhov himself</a> , but by the first comment from @AstralMan. <br><br>  Indeed, often seeing a description or even a ready-made implementation (corresponding to the description) of a high-level cryptographic protocol, some people try to incorporate it right into their own project and announce this to the general public (please do not take this as a stone in the AstralMan garden).  But such a decision is not the best!  The description of the crypto protocol, as a rule, does not contain the various necessary checks on the side of the participants and clarifications that are of critical importance in actual use.  History knows many examples of a protocol based on strong and time-tested encryption, hashing, etc.  It turned out to be hacked precisely because of the very logic of construction, and because of such ‚Äútrifles‚Äù as checks and clarifications.  The description of the crypto protocol, demonstrating its very idea, will be called educational. <br><a name="habracut"></a><br>  Immediately, I note that the authentication protocol from the article EugeneSukhov is educational.  This means that under certain conditions it is quite possible to attack him, as will be demonstrated in the future.  However, this does not mean that the protocol is bad, and its author is not a professional.  This means only that the author wanted to convey to the readers a high-level concept of the protocol, and lowered the exact, meticulous specification of the protocol, which was transferred to the developers for further "combat" implementation, for reasons of irrelevance. <br><br>  Take, for example, at least RSA and suppose that we decided to transmit only one byte using this cryptosystem.  Using RSA training will naturally end in failure!  Having intercepted the ciphertext, the attacker instantly recovers the plaintext (the same byte) using a full enumeration of numbers from zero to 255. The ‚Äúcombat‚Äù RSA of such arbitrariness must not allow that to happen with a competent implementation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the future, we will assume that the attacker (or offender) has access to the full arsenal of assorted nasty actions, such as ‚Äúlistening‚Äù to the communication channel, saving all intercepted messages, changing messages, sending previously intercepted messages, etc.  We will also assume that the intruder can steal the database from the server.  I‚Äôll clarify that all these assumptions do not disagree with the assumptions of the author of the analyzed educational crypto protocol. <br><br>  We now turn to the kind of protocol that the author presented. <br><br><img src="http://img-fotki.yandex.ru/get/5409/61030386.0/0_60c0f_f1734eb9_L.jpg" alt="image"><br><br>  Pay attention to the latest transfer from the client to the server M = hash (RND).  It would seem, why hashing?  You can simply send the RND and finish it.  But not everything is so simple.  To begin with, let's consider a weakened version of the authentication protocol, without using hashing on the last transfer, and point out its shortcomings.  The protocol scheme will look like this: <br><br><img src="http://img-fotki.yandex.ru/get/5606/61030386.0/0_60c0e_3d21528_L.jpg" alt="image"><br><br>  The first drawback is that in the weakened version of the protocol the client plays the role of the so-called ‚ÄúOracle Decryption‚Äù.  Indeed, the server sends a message to the client (in our case, RND) encrypted in the client's public key.  The client decrypts the message with its private key and sends the message in clear text back to the server.  Such protocol building strategies are ‚Äúnon-standard‚Äù, carry potential vulnerabilities and, in a sense, speak of the author of the protocol amateurishness. <br><br>  The second drawback is more serious and lies in the fact that the protocol is cracked with some reservations almost instantly.  We describe the attack.  Suppose the intruder has recognized the number N - the RSA cryptosystem module.  Whether he did this by intercepting the data at the registration stage, or has it stolen the database from the server is not important.  The main thing is that he knows N.  Also suppose that in order to encrypt the message {d || N} on the symmetric key K, the counter mode is chosen (quite real situation).  This means that the intruder will be able to easily form the message {d || p} _K by modifying the message {d || N} _K, where p is a prime number chosen by him, and send a message to the client.  I would like to lay the truth of this statement on the shoulders of the reader.  Further.  The attacker chooses the number p in such a way that p-1 has a ‚Äúgood‚Äù (in a cryptographic sense) factoring out and also exceeds d (the client's private key).  Then, instead of {RND} _e, the intruder sends g - forming groups Z_p ^ *.  The unsuspecting client in full compliance with the protocol on the last transfer sends the attacker g ^ d (mod p).  Using the Polig-Hellman algorithm, the intruder calculates the client's private key d in polynomial time.  After that, the offender will always be able to impersonate a client. <br><br>  And now we will return to the consideration of the protocol ‚Äúin the original‚Äù, as it was presented by the author (with hashing at the last transfer).  I argue that <i>if k is the client's private key length d in bits, then it is realistic to calculate the private key in less than k client attempts to authenticate with the server.</i>  I will not give the mathematical calculations proving the statement presented in the article itself, since they are quite voluminous and not intended for a wide circle of readers.  However, in order not to be unfounded, I will describe how you can calculate a few lower bits of the d key for a single attempt to authenticate a client on the server.  It is obvious that the possibility of such a calculation indicates the vulnerability of the training protocol.  Once again, I‚Äôll draw the reader‚Äôs attention to the fact that the vulnerability of the training protocol is a ‚Äúregular‚Äù situation that can absolutely say nothing about the persistence of the ‚Äúcombat‚Äù protocol.  Earlier assumptions that the attacker knows the number N and that the counter mode is used for symmetric encryption are still valid. <br><br>  Take for our humble example the prime number p = 65537 = 2 ^ 16 + 1. In Z_p ^ *, choose the element g that generates Z_p ^ *.  We calculate the values ‚Äã‚Äãof hash (g), hash (g ^ 2), hash (g ^ 3), ..., hash (g ^ {p-1}) and store them on your computer as a table.  Time and memory for this operation will take very little.  Intercepting data from the server to the client and, as previously described, replace N with p, RND with g.  As a result, we get a hash from the client from an unknown element - hash (g ^ i), find it on our computer in the table and restore i.  So we come to the equation <br>  g ^ d = g ^ i mod p <br><br>  It follows from it that d = i + a (p-1), where a is some unknown number.  We obtain that d = i + 2 ^ 16 * a.  If we represent the number i as a bit string of length 16, then it will be the last 16 bits of the client's private key. <br><br>  <i><b>Note.</b></i>  <i>If this fact is not immediately obvious to someone, then consider the decimal number system.</i>  <i>For example, let A = B + 10 ^ 3 * C.</i>  <i>Then B is the remainder of dividing the number A by 10 ^ 3 = 1000. And since 1000 is a power of 10 (we work in the decimal number system), then B is the last three digits of A. If A = 12345, then A = 345 + 12 * 1000 and such a decomposition is unique for a non-negative B &lt;= 1000.</i> <br><br>  Naturally, during the attack, we could calculate a greater number of low bits of the private key.  Note that this number directly depends on the available memory on our computer, in which we can store a table of hashes, and on the performance of the PC. <br><br>  <b>Afterword</b> : In this article I would like to emphasize that those ‚Äúready-made‚Äù solutions, algorithms and protocols in the field of cryptography, which can be found in the public domain in the literature or the Internet are not at all ‚Äúready-made‚Äù, they are educational.  If you want your project to have really reliable protective mechanisms, take care of the presence in your team of a person with specialized education and experience in the field of information security.  This area is extremely extensive, complex and diverse, to understand it with a swoop, I assure you.  All success and thank you for your attention! </div><p>Source: <a href="https://habr.com/ru/post/124090/">https://habr.com/ru/post/124090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124080/index.html">Protection from unauthorized copying applications Blackberry PlayBook</a></li>
<li><a href="../124082/index.html">Installing SMS Linux (Slackware) on eBox-2300SX</a></li>
<li><a href="../124086/index.html">Chinese iPad 3</a></li>
<li><a href="../124088/index.html">QIWI Wallet no longer works with VKontakte rubles (earned again 07/19/11)</a></li>
<li><a href="../124089/index.html">Support for Web Sockets reverse proxying in Nginx</a></li>
<li><a href="../124091/index.html">Release PuTTY 0.61, or surprise after 5 years of development</a></li>
<li><a href="../124097/index.html">Simple SDK to embed chat in iOS app</a></li>
<li><a href="../124098/index.html">Paid and free applications: two in one</a></li>
<li><a href="../124099/index.html">Roscomix</a></li>
<li><a href="../124100/index.html">Installing and Configuring Functional Testing in Symfony2 with Behat and Mink</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>