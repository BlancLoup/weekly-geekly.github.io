<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fix MySQL dump (in less than 30 lines)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A long time ago (it seems last Wednesday) I got into the hands of a dump of the MySQL database, which should be immediately deployed on my machine. Wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fix MySQL dump (in less than 30 lines)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/288/17f/134/28817f134c904d6bbb753576e5aeed2a.png">  A long time ago (it seems last Wednesday) I got into the hands of a dump of the MySQL database, which should be immediately deployed on my machine.  Why this was needed and where the dump came from, I will not tell, it is hardly interesting to anyone.  It is important that the dump was from MySQL 4.1.22 and was removed using one well-known <a href="https://www.webyog.com/product/sqlyog">tool</a> (version 5.23). <br>  He decisively refused to turn around with me ... <br><br><a name="habracut"></a><br><pre><code class="hljs vbscript">... <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> occured at:<span class="hljs-number"><span class="hljs-number">2016</span></span><span class="hljs-number"><span class="hljs-number">-02</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span> Line no.:<span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> Code: <span class="hljs-number"><span class="hljs-number">2013</span></span> - Lost connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> MySQL <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> during query</code> </pre> <br>  The error, as usual, was rather indistinct, but since it was preceded by a long (too long) SQL query, its reason was obvious.  In order to reduce the number of inserts (undoubtedly, a good undertaking), SQLyog ‚Äústicks together‚Äù them, approximately as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> abc(a, b, c) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>),(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>),(<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>),...</code> </pre><br>  When there is a lot of data, the resulting giant request is broken into pieces, but somehow it turns out that the size of these pieces (~ 1 megabyte) still remains too large.  I didn‚Äôt find a control handle for SQLyog to make the captured dump more sane (I might have looked badly), and in any case, the original dump (the one in question in this article) was not shot by me and I had something to do with it. do something  In general, the fairy tale has a long effect, but the work itself is done much faster: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (&lt;&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">chomp</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">length</span></span>($_) &lt; <span class="hljs-number"><span class="hljs-number">4096</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"$_\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-regexp"><span class="hljs-regexp">/^(insert.*values\s+)\((.*)\);$/</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $hd = $1; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $tx = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> @bd = <span class="hljs-keyword"><span class="hljs-keyword">split</span></span>(<span class="hljs-regexp"><span class="hljs-regexp">/\),\(/</span></span>, $2); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> $st (@bd) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($tx) { $tx .= <span class="hljs-string"><span class="hljs-string">',('</span></span> . $st . <span class="hljs-string"><span class="hljs-string">')'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $tx = $hd . <span class="hljs-string"><span class="hljs-string">'('</span></span> . $st . <span class="hljs-string"><span class="hljs-string">')'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">length</span></span>($tx) &gt; <span class="hljs-number"><span class="hljs-number">4096</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"$tx;\n"</span></span>; $tx = <span class="hljs-string"><span class="hljs-string">''</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($tx) { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"$tx;\n"</span></span>; } } } }</code> </pre><br>  Favorite <a href="https://ru.wikipedia.org/wiki/Perl">Perl</a> didn't let me down this time either.  Perhaps the code could be written and somehow more elegant, but I'm quite happy with how it works.  Long inserts are broken into pieces of about 4 kilobytes in size (maybe more, I have not experimented).  Who needs it - take it and use it. <br></div><p>Source: <a href="https://habr.com/ru/post/277101/">https://habr.com/ru/post/277101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277089/index.html">Google refuses to flash in advertising</a></li>
<li><a href="../277091/index.html">Security Week 06: bank robbery on the stream, breaking the grid, Poseidon / Amebey / Kianokhet</a></li>
<li><a href="../277093/index.html">Working with USB devices in Android</a></li>
<li><a href="../277097/index.html">UFCS in the programming language D</a></li>
<li><a href="../277099/index.html">Katya, Go, Dcoin and Android</a></li>
<li><a href="../277103/index.html">Machine Learning Revolution: General Principles and Effects on SEO</a></li>
<li><a href="../277105/index.html">Bear, the dismemberment and February 14</a></li>
<li><a href="../277107/index.html">Sandy Metz and Object-Oriented Design in Ruby</a></li>
<li><a href="../277109/index.html">Vision-based SLAM: tutorial</a></li>
<li><a href="../277111/index.html">Problems of access control based on the access list in ECM systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>