<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flying robot to the competition and a bunch of rake with him</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Platform 

 Last year we announced a contest for flying robots with a prize of one million rubles. The task would seem simple - take off, go around an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flying robot to the competition and a bunch of rake with him</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d38/138/671/d3813867119fd67ba2bf4d82ee0a84f4.jpg"><br>  <i>Platform</i> <br><br>  Last year we announced a <a href="http://habrahabr.ru/company/croc/blog/151471/">contest for flying robots</a> with a prize of one million rubles.  The task would seem simple - take off, go around an obstacle and sit on the landing marker.  The obstacle and the marker are shifted from task to task.  The robot flies by itself, without commands from the ground (more precisely, it takes only two: "start" and "emergency shutdown"). <br><br>  At the time of the competition, our team of engineers and programmers from the department of information technology has never been involved in the development of UAVs.  But we decided to buy our robot and participate in the competition on a par with everyone.  More precisely, not quite on a par - we will not be able to take a medal place or receive a prize according to the conditions, that is, we go beyond the standings. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first time we took the robot in the hands in the summer of 2012, when the package arrived from a Belgian online store.  By the way, we were lucky - the robot was only 3 weeks old.  Part of the teams withdrew from the competition due to the fact that their platforms did not have time to arrive. <br><br>  It was the first and last luck in the preparation.  From this moment began the history of a rake several months long. <a name="habracut"></a><br><br><h4>  At first, everything looked just </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/d91/b8c/363/d91b8c363d8036ee10a531648790002e.jpg"><br>  <i>Polygon layout</i> <br><br>  So, the first task is just to take off and hover at one point.  That is, you need to try so that the robot does not fall, does not fly up and does not scour.  The second is, in fact, a journey through the maze, so as not to bump into the wall.  The third is recognition.  All these tasks can, one way or another, be solved separately.  And a bunch of auxiliary tasks like filtering data from sensors (for example, due to the inconstancy of lighting conditions and various flooring textures). <br><br>  At the same time, the high-level algorithms of the robot are most important to us, therefore, it was allowed to use a number of ready-made libraries and platforms: for example, not to write pattern recognition from scratch and a system for stabilizing a multi-rotor platform in space. <br><br>  <b>So, from the moment we opened the package, the tricky R &amp; D began</b> .  There is a person in the team with a wealth of experience in managing quadrocopters, but nobody wrote software to manage them.  Therefore, we began to thoroughly understand everything from scratch.  I had to read a number of books and articles.  Remember what we were taught 10 years ago at the university, to understand the physics of flight. <br><br>  It must be said that the platform we initially acquired is rather ‚Äústupid,‚Äù that is, for example, it does not know how to stabilize itself horizontally.  We worked out most of the algorithms ourselves.  Now we already know how to hang, move, fly around obstacles.  But we fly while we slowly and carefully, about 30 centimeters per second.  We are working on this, because the robot that wins the task in the shortest time wins the competition, so we must be an example to the other participants. <br><br>  Surprisingly, the easiest part was the mathematics of obstacle avoidance and the construction of the robot's trajectory.  At least, so far it seems to us. <br><br><h4>  About sensors </h4><br>  For orientation in space, we allowed the use of a GPS signal, but we ourselves proceeded from the fact that the drone can be used in closed spaces or in the absence of a GPS signal.  Therefore, in our robot there are other sensors.  Fortunately, we, as representatives of one of the largest IT companies in Russia, can afford it. <br><br>  Another limitation that we have introduced for ourselves is that all the computing power must be on the robot itself (under the terms of the competition, you can use an autonomous computing unit mounted not on the platform itself).  We used Intel NUC, it weighs only 200 grams. <br><br><img src="https://habrastorage.org/storage2/a8a/e9c/137/a8ae9c137309a4446b0b2226f8899dcb.jpg"><br>  <i>Intel NUC</i> <br><br>  <b>Our laser rangefinder</b> (more precisely, the lidar) on the passport hits 30 meters.  That is, if the robot is at the beginning of the polygon, then it can ‚Äúsee‚Äù the far wall.  This allows you to accurately understand where we are now.  In theory.  In practice, the lidar hits only 10 meters, because the data for the passport was written almost in the conditions of perfect reflection of the beam from the walls.  In reality, with our covers now there are "blind zones".  Therefore, the original plan with the fact that we always see the entire "box" of the landfill now does not work, and we need to somehow measure the current speed.  For example, on the principle of optic flow, that is, using a sensor that looks down at the floor (as in a mouse). <br><br>  The appearance of the robot from below and above somewhere in the middle of development: <br><img src="https://habrastorage.org/storage2/f9a/e44/a8b/f9ae44a8b57b3bf393746019a3830983.jpg"><br><br><img src="https://habrastorage.org/storage2/7f2/908/1b0/7f29081b0cb2ea9f2d6f3e645a348e7e.jpg"><br><br>  And this is how the platform looks like on the website of the Belgian microcopter online store: <br><img src="https://habrastorage.org/storage2/a20/7bc/3ce/a207bc3cef58ad2df502050a05b1fd95.jpg"><br><br>  <b>Adding new sensors is a lot of work</b> .  First, you need to look at the firmware.  Then it is necessary to carry out field tests, which often result in structural failure.  It may take several days to restore it.  For example, when we tested a downward ultrasound sonar in a robot, the algorithm for hanging in place failed, and we got a bunch of curved iron instead of a flying platform.  Why?  Because sonars can be "deaf" or return data with an unacceptable delay.  There are sonars that work well in the office, but do not work well on asphalt or other surfaces, and so on. <br><br>  We went over six sonars.  The first time we tested the retention solution in the office.  Then they went outside and realized that the sonar on the street of the earth no longer sees.  Then we started screwing the optic flow sensor, and it also has a sonar.  So, we have to throw out the old sonar. <br><br>  Or landing.  After our robot flies through the gate (obstacle), the image from the camera begins to be analyzed for the search for a landing marker.  As soon as the marker is in the picture - it is necessary to solve the geometrical problem and give the robot coordinates for landing.  And then there are more tests: somewhere the error of the sensors interferes, somewhere we incorrectly take into account the mathematics, somewhere the iron fails and so on. <br><br><h4>  Tests </h4><br>  To test the algorithms, we use the gazebo simulator, in which we created a fairly accurate model of our kopter and sensors, and also recreated the polygon model.  As for the real tests, at first we flew in a room about 10 by 10 meters.  To do this, it was necessary to do everything neatly and accurately, because: a flying robot in such a small space can make a lot of things.  There he held a position with us with an accuracy of 10 centimeters. <br><br>  After that, we made a copy of the competitive testing ground on the roof of the KROK main office parking lot, and we already started checking the robot in ‚Äúcombat‚Äù conditions. <br><br>  If we learn to quickly go through the maze - we can ease the robot by replacing the battery with a less capacious and therefore lighter.  This will facilitate the design - now it weighs 2.3 kilograms, and this is already the limit for comfortable control. <br><br><h4>  About iron </h4><br>  Our platform is the Mikrokoper quadro XL.  Here is the original hardware layout: <br><br><img src="https://habrastorage.org/storage2/b16/48d/e38/b1648de38b03e63bcdc86cffaeba1247.jpg"><br><br>  The scheme was eventually changed from the originally planned.  For example, we assumed that one battery would, in fact, be on the flying structure itself (on motors), and one battery would be used to power the sensors and the computer.  Now it is combined in one battery.  Plus, as I said, the sonar model has changed.  Rather, instead of a sonar, there was another motherboard, the Px4flow, which already includes the sonar.  While we are optimistic about her.  Perhaps the accelerometer will be added to the circuit. <br><br>  In the first scheme, we planned a calculator based on ARM processors.  But then we stopped on the software architecture based on the ROS Framework (Robot Operating System).  This Framework has rather strict requirements for operating systems, they guarantee certain functions only on certain versions of the Ubuntu system based on Linux.  And not all ARMovskie computers this system is installed cloudless, so to speak.  NUC weighs more, and eats more food, but on it everything goes fine.  It saved us a lot of time.  Some of the teams also tried it. <br><br>  Here is the actual software architecture: <br><br><img src="https://habrastorage.org/storage2/38c/99a/1c1/38c99a1c16d407485b24f24d24fe0f02.jpg"><br><br><h4>  Polygon </h4><br>  There were many problems with the fact that the main peak of the tests of the robot came in the winter.  And for us on an open platform to land in a snowdrift is not the most desirable situation.  Even shook the film. <br><br>  When we built the test site, we had plywood walls with film (something like laminate), and everything went smoothly on it.  But it was enough to paint them - and that was all, the accuracy of the sensors dropped sharply due to a drop in the reflectivity of the material. <br><br>  The other robot came to us from Belgium the other day.  We will need it as a reserve for the competition, if something happens to the first one. <br><br><h4>  Video </h4><br>  We shoot videos of everything that happens during test flights and post it on YouTube. <br><br>  Here you can see how we test the robot in strong wind conditions: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/W6655qxmNR4%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhi7bqLzgHSXQBb6yvqZCUXEOgPA6Q" frameborder="0" allowfullscreen=""></iframe><br><br>  Here is an old video from the time when we flew in a small room: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/TJlwbSbgLtM%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhJzbceX9gG4U6-th0g0sotqSWtfw" frameborder="0" allowfullscreen=""></iframe><br><br>  And here is a small sketch from the simulator - a test for speed limit: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/n6-Lg4uGSD4%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhr8j_INdH0hKncq-SiMzXo-2J8sg" frameborder="0" allowfullscreen=""></iframe><br><br>  This can also be interesting: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/KF8RM3N32Jk%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhJG9o5vpQ-4QmXh5tfoE4i6YbO-Q" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Other commands </h4><br>  The first teams began to fall off at the very beginning due to delivery problems.  The next significant dropout was in April-May, when the teams trivially smashed their models.  And it is very disappointing, when there are already developments, there is an understanding of how to solve problems, there are two thousand lines of written code.  They wrote how sorry it was to throw it all away. <br><br>  There are teams that fly on the standard AR.Drone.  On AR.Drone there are sonars and two cameras: a front HD and a low-resolution camera that looks vertically down.  That is, in principle, you can do everything as needed, but the task will be quite complex algorithmically.  You can, of course, put the robot nose to the landing marker and solve the problem of finding a marker directly below him.  But it is necessary to intervene and everything will fail. <br><br>  There are guys who do not use any ready-made platform.  It is possible that they poisoned part of the schemes themselves. <br><br>  There are teams that are far from programming, but they have a 20-year experience in aircraft modeling, they have been doing this since the days of the Soviet Union.  Take to yourself the developer, try. <br><br>  We try to help other teams: we still have good access to the hardware. <br><br>  Now, at our test site, test flights have already passed within the framework of the competition, and the developers of the UAVs not participating in the battle could come: check out the test site, fly.  Now it is flying within the last checkpoint (the last day is July 21) among residents of Moscow and the region.  If you participate, just write to robots@croc.ru, we will make a pass.  I advise you to hurry with the record, in the days from Thursday to Sunday is already a stir. </div><p>Source: <a href="https://habr.com/ru/post/186740/">https://habr.com/ru/post/186740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186728/index.html">Interesting and informative: we are witnessing milestones in the history of astronautics with the Orbiter</a></li>
<li><a href="../186730/index.html">Game "sea battle": the placement of ships</a></li>
<li><a href="../186732/index.html">Using screen to log user actions (auditing) on ‚Äã‚ÄãLinux</a></li>
<li><a href="../186736/index.html">The most antimagnetic watch in the world</a></li>
<li><a href="../186738/index.html">"Thread" - a real rope for cultural, educational and social projects</a></li>
<li><a href="../186744/index.html">New backdoors in HP server products</a></li>
<li><a href="../186746/index.html">What would the modern world look like without smartphones?</a></li>
<li><a href="../186750/index.html">RWpod. 19th edition of the 01 season. Rspec 2.14, try Elixir, PivotTable.js, GorillaScript, etc.</a></li>
<li><a href="../186752/index.html">How Yandex.Disk works: bootloader</a></li>
<li><a href="../186758/index.html">Experience of entering the ‚Äúbusy‚Äù market of regional real estate portals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>