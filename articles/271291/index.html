<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to 3D Touch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the release of the iPhone 6s and iPhone 6s Plus, Apple introduced us to a completely new way to interact with our phones: a hard-pressing gesture...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to 3D Touch</h1><div class="post__text post__text-html js-mediator-article">  With the release of the iPhone 6s and iPhone 6s Plus, Apple introduced us to a completely new way to interact with our phones: a hard-pressing gesture.  As you know, this feature is already available on the Apple Watch and MacBook and in the MacBook Pro called Force Touch.  This - literally - added a new concept to the user interface. <br><br>  If you are wondering why the Force Touch has been renamed to 3D Touch for iPhone, then you are not alone.  Shortly after <a href="https://en.wikipedia.org/wiki/Craig_Federighi">Craig Federighi</a> , who was also clearly puzzled by the name, introduced this new feature, a lot of speculation arose.  What did not suit the name Force Touch?  Too many Star Wars jokes? <br><br>  But there is a difference!  Obviously, Force Touch can only recognize a hard press, while the <b>3D Touch</b> function is more sensitive and can highlight several levels of pressure based on how hard you press. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/724/f2b/33b/724f2b33bbc964950e528581cb950444.jpg" alt="Introduction to 3D Touch"><br><a name="habracut"></a><br>  Although the changes may seem minor, they allow developers to make measurements on the iPhone more accurate.  Take this <a href="https://medium.com/swlh/turning-the-iphone-6s-into-a-digital-scale-f2197dc2b6e7">Gravity</a> app, for example, which turns your iPhone into a digital scale using Force Touch.  Although it was rejected by Apple for unclear reasons, the idea is remarkable.  So, to show you how 3D Touch works, let's try to make a similar application! <br><br><h3>  let's start </h3><br>  To get started, <a href="">download this project template</a> that I created.  In fact, this is just an empty creation application based on the <i>Single View iPhone application</i> .  I created a project posted <i>(UILabels &amp; UIImage)</i> and connected <i>IBOutlets</i> to <i>ViewController.swift</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00c/b57/49c/00cb5749c29ea2565f0de5a7a374ffd8.png" alt="image"><br><br>  The design of our application is quite simple: we have one controller with 2 labels: one is the title and the second is the label that shows the percentage of pressing force on the iPhone screen. <br><br>  Let's start the development!  On the iPhone 6s and 6s Plus, UITouch objects have two new properties like CGFloat, called <b>force</b> and <b>maximumPossibleForce</b> .  Force represents how strong the touch is, where 1.0 is the average touch.  MaximumPossibleForce shows maximum touch strength. <br><br>  Whenever a user clicks on a sensor, the touchesBegan method is called, and then touchesMoved, if the user moves his finger across the screen, then <i>touchedCancelled</i> or TouchesEnded is called, depending on the situation.  For our purposes, the <i>touchesMoved</i> method is the only way we need.  TouchesMoved has two parameters: touches and events.  Tangencies is a collection (an unordered collection of different objects) of UITouch objects.  To touch, there must be exactly one UITouch object, but we may not be careful enough, so it is strongly recommended to check whether touches.first (the first UITouch object of the sensor set) is equal to nil using the additional anchor.  Insert the following method in <i>ViewController.swift</i> : <br><pre><code class="objectivec hljs">override func touchesMoved(touches: Set&lt;<span class="hljs-built_in"><span class="hljs-built_in">UITouch</span></span>&gt;, withEvent event: <span class="hljs-built_in"><span class="hljs-built_in">UIEvent</span></span>?) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let touch = touches.first { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-meta"><span class="hljs-meta">#available(iOS 9.0, *) { if traitCollection.forceTouchCapability == UIForceTouchCapability.Available { // 3D Touch capable } } } }</span></span></code> </pre> <br>  Using the <b>if statement,</b> we check if the device supports 3D Touch.  This part is optional if you are doing this project for fun.  However, if you are going to publish the app in the App Store, this is a mandatory requirement, validation, as older devices such as the iPhone 6 do not support 3D Touch. <br><br>  Please note that I also checked whether the device is running on iOS 9.0 or later.  I do this with the new <b>#available</b> syntax introduced in Swift 2.0.  If you want to learn more about the new features and capabilities in Swift 2.0, I recommend that you read this article.  Again this check is optional if your target platform is for application 9.0 or higher. <br><br>  To get the push force as a percentage, simply divide the touch force by the maximum force (i.e. touch.maximumPossibleForce), which is the maximum pressing force.  Then update the label text.  You can update the method as follows: <br><pre> <code class="objectivec hljs">override func touchesMoved(touches: Set&lt;<span class="hljs-built_in"><span class="hljs-built_in">UITouch</span></span>&gt;, withEvent event: <span class="hljs-built_in"><span class="hljs-built_in">UIEvent</span></span>?) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let touch = touches.first { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-meta"><span class="hljs-meta">#available(iOS 9.0, *) { if traitCollection.forceTouchCapability == UIForceTouchCapability.Available { // 3D Touch capable let force = touch.force/touch.maximumPossibleForce forceLabel.text = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\(force)% force"</span></span></span><span class="hljs-meta"> } } } }</span></span></code> </pre><br>  If you run the application on iPhone 6s / 6s Plus, it should show the pressing force in percent when you tap the screen.  However, since we are making a scale, you may want to add the number of grams that you weigh on your iPhone.  According to <a href="https://medium.com/swlh/turning-the-iphone-6s-into-a-digital-scale-f2197dc2b6e7">Ryan MacLead</a> , the sensor will weigh a maximum weight of ~ 385g.  Thus, the <b>maximumPossibleForce</b> corresponds to 385 grams (approximately 3.8 <b>Newtons</b> ).  By simple calculations, you can convert% force to grams.  All we need to do is multiply the percentage of pressing force by 385. For objects weighing 385 grams or more, we simply change the label to ‚Äú385+ grams‚Äù. <br><br>  Now update the method using the following code snippet: <br><pre> <code class="objectivec hljs">override func touchesMoved(touches: Set&lt;<span class="hljs-built_in"><span class="hljs-built_in">UITouch</span></span>&gt;, withEvent event: <span class="hljs-built_in"><span class="hljs-built_in">UIEvent</span></span>?) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let touch = touches.first { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-meta"><span class="hljs-meta">#available(iOS 9.0, *) { if traitCollection.forceTouchCapability == UIForceTouchCapability.Available { if touch.force &gt;= touch.maximumPossibleForce { forceLabel.text = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"385+ grams"</span></span></span><span class="hljs-meta"> } else { let force = touch.force/touch.maximumPossibleForce let grams = force * 385 let roundGrams = Int(grams) forceLabel.text = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\(roundGrams) grams"</span></span></span><span class="hljs-meta"> } } } } }</span></span></code> </pre><br>  <i>Cool!</i>  <i>You have made your Digital Scale application.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/044/447/4b3/0444474b338751b4da1ab66357077066.png" alt="image"><br><br>  At the moment, the application does not drop the weight to zero after you remove the item or stop touching your screen.  You can implement the touchesEnded method to reset the label. <br><pre> <code class="objectivec hljs">override func touchesEnded(touches: Set&lt;<span class="hljs-built_in"><span class="hljs-built_in">UITouch</span></span>&gt;, withEvent event: <span class="hljs-built_in"><span class="hljs-built_in">UIEvent</span></span>?) { forceLabel.text = <span class="hljs-string"><span class="hljs-string">"0 gram"</span></span> }</code> </pre><br><br><h3>  Quick actions on the main screen </h3><br>  Another great use of 3D Touch is the quick action on the main screen.  Quick Actions give users a menu to go to the directory of your application directly.  Just press the program icon hard and you will see a menu.  With the advent of 3D Touch technology, applications like <a href="https://itunes.apple.com/ru/app/twitter/id333903271%3Fmt%3D8">Twitter</a> and <a href="https://itunes.apple.com/ru/app/instagram/id389801252%3Fmt%3D8">Instagram</a> and some other applications have shown how to use this new feature. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/529/654/f2b/529654f2b304ece9ac253d66de613e0b.png" alt="image"><br><br>  Let's add Quick Actions for our application we just made, with which we will open the application with a blue background instead of white.  To add Quick Actions, open your project's <i>info.plist</i> file (Click the Scale workspace in the project navigator, select the Scale target, and go to the Info tab).  In the file, add the 'UIApplicationShortcutItems' type select array (Array).  Each element of the array is a dictionary containing the properties of one quick action: <br><ul><li>  <b>UIApplicationShortcutItemType</b> ( <i>required</i> ): a string that identifies the quick action.  Note that this string must be unique, specifically for the application.  A good idea is to add a prefix with your id or some other tricks to make a unique string. </li><li>  <b>UIApplicationShortcutItemTitle</b> ( <i>required</i> ): a string that represents the header for the Quick Action that is shown to the user.  An example would be ‚ÄúShow last picture taken‚Äù. </li><li>  <b>UIApplicationShortcutItemSubtitle</b> ( <i>optional</i> ): a string for the name of your Quick Action.  An example would be ‚ÄúLast picture taken yesterday‚Äù.  If you want to add an icon for Quick Action, you have two options: a system icon from Apple or a custom icon. </li><li>  <b>UIApplicationShortcutItemIconType</b> ( <i>optional</i> ): a string indicating which system icon will be displayed next to the Quick Action. </li><li>  <b>UIApplicationShortcutItemIconFile</b> ( <i>optional</i> ): a string indicating which custom icon will be displayed next to the Quick Action. </li><li>  <b>UIApplicationShortcutItemUserInfo</b> ( <i>optional</i> ): A dictionary containing some additional information that you want to perform using the Quick Action. </li></ul><br>  In the array, we define four elements to configure the Quick Action "OpenBlue".  Now <b>info.plist</b> should look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e7/415/bb7/5e7415bb79fc513a10f45ec02804c595.png" alt="image"><br><br>  <i>Please note that I used ' <b>$ (PRODUCT_BUNDLE_IDENTIFIER)</b> ' instead of ' <b>com.appcoda.Scale</b> ' or any other identifier that you use.</i>  <i>This is for security reasons: if, for any reason, I change the Bundle ID to 'General', the whole project will be affected and the identifier will be changed everywhere.</i>  <i>Otherwise, I will have to change it everywhere manually.</i>  <i>In your info.plist file, you can see that the <b>Bundle Identifier</b> key uses the same approach: ' <b>$ (PRODUCT_BUNDLE_IDENTIFIER)</b> ' describes the path to your project identifier.</i> <br><br>  The last thing left to do is implement Quick action when the user starts it.  Main work is handled in the <i>AppDelegate.swift</i> method in <i>performActionForShortcutItem</i> .  When Quick Action is activated, the method will be called.  Therefore, you must implement this method to handle quick actions: <br><pre> <code class="objectivec hljs">func application(application: <span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>, performActionForShortcutItem shortcutItem: <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationShortcutItem</span></span>, completionHandler: (Bool) -&gt; Void) { <span class="hljs-comment"><span class="hljs-comment">// Handle quick actions completionHandler(handleQuickAction(shortcutItem)) }</span></span></code> </pre><br>  As expected, call the handler and pass a zero value to it, depending on the success / failure of the fast action.  Here we create a separate <i>handleQuickAction</i> function to process the action.  A great way to represent multiple instances of Quick Action is to use enums with ' <i>UIApplicationShortcutItemType</i> ' as the raw value.  Declare the enumeration and implement the <i>handleQuickAction</i> method, as shown below, to set the background color to blue when the application is launched through quick action: <br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Shortcut: String { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openBlue = <span class="hljs-string"><span class="hljs-string">"OpenBlue"</span></span> } func handleQuickAction(shortcutItem: <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationShortcutItem</span></span>) -&gt; Bool { var quickActionHandled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> let type = shortcutItem.type.componentsSeparatedByString(<span class="hljs-string"><span class="hljs-string">"."</span></span>).last! <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let shortcutType = Shortcut.init(rawValue: type) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> shortcutType { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .openBlue: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.window?.backgroundColor = <span class="hljs-built_in"><span class="hljs-built_in">UIColor</span></span>(red: <span class="hljs-number"><span class="hljs-number">151.0</span></span>/<span class="hljs-number"><span class="hljs-number">255.0</span></span>, green: <span class="hljs-number"><span class="hljs-number">187.0</span></span>/<span class="hljs-number"><span class="hljs-number">255.0</span></span>, blue: <span class="hljs-number"><span class="hljs-number">255.0</span></span>/<span class="hljs-number"><span class="hljs-number">255.0</span></span>, alpha: <span class="hljs-number"><span class="hljs-number">1.0</span></span>) quickActionHandled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> quickActionHandled }</code> </pre><br>  It is quite simple.  If you now launch the app and launch it through quick actions, the background will turn blue. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d6/9df/3ca/2d69df3ca0fefa9cae86b083593c3439.png" alt="image"><br><br><h3>  What you need not forget? </h3><br>  There is one point that should be considered.  From the point of view of the startup sequence, there is a difference between an application that is launched and an application that is restarted using the Quick Action.  As you know, when the application is launched, the <i>willFinishLaunchingWithOptions</i> methods are <i>called,</i> then the <i>anddidFinishLaunchingWithOptions</i> method.  But when the application is resumed by Quick Actions, it only provokes the execution of the <i>performActionForShortcutItem</i> method. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b47/ce7/392/b47ce7392df0ad539bb62a99465ab8e0.png" alt="image"><br><br>  If you look at the didFinishLaunchingWithOptions method, then you will see that we have a line of code to set the background color to white.  It is used when the application starts normally, through the application icon. <br><pre> <code class="objectivec hljs">func application(application: <span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>, didFinishLaunchingWithOptions launchOptions: [<span class="hljs-built_in"><span class="hljs-built_in">NSObject</span></span>: AnyObject]?) -&gt; Bool { <span class="hljs-comment"><span class="hljs-comment">// Override point for customization after application launch. self.window?.backgroundColor = UIColor.whiteColor() return true }</span></span></code> </pre><br>  This is where the problem comes from: when you start an application using a quick action, <i>willFinish</i> , <i>didFinish are called</i> , and then <i>performActionForShortcutItem</i> .  Therefore, the white background color is set first, and then changed to blue.  Obviously, you do not want to set the background color to white when the user starts the application using quick actions. <br><br>  To solve this problem, we need to check in the <i>didFinishLaunchingWithOptions</i> method: <br><pre> <code class="objectivec hljs">func application(application: <span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span>, didFinishLaunchingWithOptions launchOptions: [<span class="hljs-built_in"><span class="hljs-built_in">NSObject</span></span>: AnyObject]?) -&gt; Bool { print(<span class="hljs-string"><span class="hljs-string">"didFinishLaunchingWithOptions called"</span></span>) var isLaunchedFromQuickAction = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">// Check if it's launched from Quick Action if let shortcutItem = launchOptions?[UIApplicationLaunchOptionsShortcutItemKey] as? UIApplicationShortcutItem { isLaunchedFromQuickAction = true // Handle the sortcutItem handleQuickAction(shortcutItem) } else { self.window?.backgroundColor = UIColor.whiteColor() } // Return false if the app was launched from a shortcut, so performAction... will not be called. return !isLaunchedFromQuickAction }</span></span></code> </pre><br>  To determine if an application is running via Quick Action, you can check the launch <i>softkey UIApplicationLaunchOptionsShortcutItemKey</i> .  The <i>UIApplicationShortcutItem</i> object is available as a launch softkey value.  If the application is launched via Quick Action, we simply call <i>handleQuickAction</i> to change the background to blue. <br><br>  Since we have already processed the fast action in <i>didFinishLaunchingWithOptions</i> , we do not want to call <i>performActionForShortcutItem</i> to perform <i>handleQuickAction</i> again.  Therefore, we return false, telling the system not to call the performActionForShortcutItem method. <br><br>  That's all!  You can now test the application.  Quick Action should work fine. <br><br><h3>  Total </h3><br>  <b>3D Touch</b> is a great way to add convenient and enjoyable features to your application.  However, you should know that not all devices support 3D Touch, although this may change in the future. <br><br>  After reading this article, you can add Quick Actions to your iOS application and determine the touch strength. <br><br>  For comparison, you can <a href="">download the full Xcode project</a> .  Do not forget to share your thoughts in the comments about this manual and 3D Touch. </div><p>Source: <a href="https://habr.com/ru/post/271291/">https://habr.com/ru/post/271291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271281/index.html">Angular and RequireJS project builder and some build thoughts</a></li>
<li><a href="../271283/index.html">Trash in bookmarks and disabling side panels in the assembly Vivaldi 1.0.330.3</a></li>
<li><a href="../271285/index.html">Regular expressions and math parser</a></li>
<li><a href="../271287/index.html">Development of secure banking applications: the main problems and how to avoid them</a></li>
<li><a href="../271289/index.html">Transfer server farms to more advanced and energy efficient server cooling technologies</a></li>
<li><a href="../271293/index.html">Drupal 8 released</a></li>
<li><a href="../271295/index.html">Security Week 47: {not} Hacked Tor, Gmail Warns About Decryption, Barcode Attack</a></li>
<li><a href="../271297/index.html">Typical rakes in the way of a programmer from Junior to Senior</a></li>
<li><a href="../271299/index.html">CsConsoleFormat: Console formatting in a new way (.NET)</a></li>
<li><a href="../271301/index.html">What's new in Ruby 2.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>