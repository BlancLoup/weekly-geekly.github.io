<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii2-advanced: Making internationalization with a source in Redis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Yii2, it is possible to implement three options for internationalization: 



1. File with an array, type: key => translation (flexible) Help Link:...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii2-advanced: Making internationalization with a source in Redis</h1><div class="post__text post__text-html js-mediator-article">  In Yii2, it is possible to implement three options for internationalization: <br><br><ol><li><div class="spoiler">  <b class="spoiler_title">File with an array, type: key =&gt; translation (flexible)</b> <div class="spoiler_text">  Help Link: <br><ul><li>  <a href="https://thecodeninja.net/2014/12/i18n-with-yii-2-advanced-template/">thecodeninja.net</a> </li><li>  <a href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">yiiframework</a> </li><li>  <a href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-i18n/">yiiframework</a> </li></ul><br><h2>  Create a configuration file for the collector </h2><br>  Execute the console command <br><pre><code class="php hljs">php ./yii message/config @common/config/i18n.php <span class="hljs-comment"><span class="hljs-comment">//   php ./yii message/config-template @common/config/i18n.php</span></span></code> </pre> <br>  ps For windows php yii environment ... Work with the console should be configured ie  necessary components must be connected. <br><br>  The file /common/config/i18n.php should be created: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'sourcePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR, <span class="hljs-string"><span class="hljs-string">'languages'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'pt-PT'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>,<span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>,<span class="hljs-string"><span class="hljs-string">'en-US'</span></span>], <span class="hljs-comment"><span class="hljs-comment">//      'translator' =&gt; 'Yii::t', 'sort' =&gt; false, 'removeUnused' =&gt; false, 'only' =&gt; ['*.php'],//       'except' =&gt; [//   '.svn', '.git', '.gitignore', '.gitkeep', '.hgignore', '.hgkeep', '/messages', '/vendor', ], 'format' =&gt; 'php',//    'messagePath' =&gt; __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'messages', 'overwrite' =&gt; true, ];</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Create a common / messages folder to store translations!</b> <br><a name="habracut"></a><br><h2>  Add the i18n component </h2><br>  In the common / main.php configuration file <br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'pt-PT'</span></span>,<span class="hljs-comment"><span class="hljs-comment">//  'sourceLanguage' =&gt; 'uk-UA',//  'components' =&gt; [ ... 'i18n' =&gt; [ 'translations' =&gt; [ 'frontend*' =&gt; [ 'class' =&gt; 'yii\i18n\PhpMessageSource', 'basePath' =&gt; '@common/messages', /* fileMap ,       .        'fileMap' =&gt; [ 'app' =&gt; 'app.php', 'app/error' =&gt; 'error.php', ],*/ ], 'backend*' =&gt; [ 'class' =&gt; 'yii\i18n\PhpMessageSource', 'basePath' =&gt; '@common/messages', ], //       *     '*' =&gt; [ 'class' =&gt; 'yii\i18n\PhpMessageSource', 'basePath' =&gt; '@common/messages', 'on missingTranslation' =&gt; ['common\components\TranslationEventHandler', 'handleMissingTranslation']//     ], ], ], ....</span></span></code> </pre><br><br><h2>  What should be in the submissions </h2><br>  Examples from the <a href="">Yii :: t ()</a> documentation <br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">//     /        frontend/home.php echo \Yii::t('frontend/home', 'key home'); echo \Yii::t('frontend/login', 'key login');</span></span></code> </pre><br>  It is better if the category names contain the name of the page on which they will be used.  When searching for a translation, Yii samples the entire category. <br><br><h2>  Handler not found translations </h2><br><pre> <code class="php hljs"> common\components\TranslationEventHandler.php <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">i18n</span></span>\<span class="hljs-title"><span class="hljs-title">MissingTranslationEvent</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TranslationEventHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleMissingTranslation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MissingTranslationEvent $event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $event-&gt;translatedMessage = "@MISSING: {$event-&gt;category}.{$event-&gt;message} FOR LANGUAGE {$event-&gt;language} @"; //    } }</span></span></code> </pre><br><br><h2>  Starting the construction of keys </h2><br> <code>php yii message/extract @common/config/i18n.php</code> <br>  Then files should be created: <br><ul><li>  common \ messages \ ru-RU \ frontend \ home.php </li><li>  common \ messages \ uk-UA \ frontend \ home.php </li><li>  common \ messages \ en-US \ frontend \ home.php </li><li>  common \ messages \ ru-RU \ frontend \ login.php </li><li>  common \ messages \ uk-UA \ frontend \ login.php </li><li>  common \ messages \ en-US \ frontend \ login.php </li><li>  .... </li></ul><br>  The folder structure depends on the category name.  This one is based on frontend / login and frontend \ home <br>  If we used this type of category (keys) <code>Yii::t('frontend','home')</code> <br>  then all one file for each language would be created (common \ messages \ ru-RU \ frontend.php) in which there would be all translations and to translate one view, Yii would load all translations that we don‚Äôt need on this page. <br><br>  Files have the following form: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'key home'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'key login'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ];</code> </pre><br>  We will translate ourselves already. <br><br>  If you create the file views / site / ru-RU / index.php and the default language is language = ru-RU, then this view will first be rendered. <br><br></div></div><br></li><li><div class="spoiler">  <b class="spoiler_title">File with the extension .po, .mo binary (need compiler, fast)</b> <div class="spoiler_text">  Help Link: <br><ul><li>  <a href="https://poedit.net/download">Compiler poedit to .mo files for windows</a> </li><li>  <a href="https://thecodeninja.net/2014/12/i18n-with-yii-2-advanced-template/">thecodeninja</a> </li><li>  <a href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">yiiframework</a> </li><li>  <a href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-i18n/">yiiframework</a> </li></ul><br><h2>  Creating a configuration file </h2><br>  Team <code>php yii message/config @common/config/i18n.php</code> <br>  get the file common / config / i18n.php <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'color'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'interactive'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'sourcePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR, <span class="hljs-string"><span class="hljs-string">'languages'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'pt-PT'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>,<span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>,<span class="hljs-string"><span class="hljs-string">'en-US'</span></span>], <span class="hljs-string"><span class="hljs-string">'translator'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Yii::t'</span></span>, <span class="hljs-string"><span class="hljs-string">'sort'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'removeUnused'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'only'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'*.php'</span></span>], <span class="hljs-string"><span class="hljs-string">'except'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'.svn'</span></span>, <span class="hljs-string"><span class="hljs-string">'.git'</span></span>, <span class="hljs-string"><span class="hljs-string">'.gitignore'</span></span>, <span class="hljs-string"><span class="hljs-string">'.gitkeep'</span></span>, <span class="hljs-string"><span class="hljs-string">'.hgignore'</span></span>, <span class="hljs-string"><span class="hljs-string">'.hgkeep'</span></span>, <span class="hljs-string"><span class="hljs-string">'/messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'/vendor'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'po'</span></span>, <span class="hljs-string"><span class="hljs-string">'messagePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'overwrite'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ];</code> </pre><br>  It is the same as in the case of the php format.  It differs only in the format :) <code>'format' =&gt; 'po'</code> <br><br>  <b>Create a common / messages folder to store translations!</b> <br><br>  The difference of this format from the php format is only in the fact that after collecting keys from an application using the <code>php yii message/extract @common/config/i18n.php</code> command, <code>php yii message/extract @common/config/i18n.php</code> in the common \ messages folder create files with the .so extension (frontend.so) that should be compiled by the program , for example, <a href="https://poedit.net/download">poedit windows</a> and simply saving it will create binary files with the extension .so. <br><br></div></div><br></li><li><div class="spoiler">  <b class="spoiler_title">Mysql database, two tables for keys and translations</b> <div class="spoiler_text">  Help Link: <br><ul><li>  <a href="https://thecodeninja.net/2014/12/i18n-with-yii-2-advanced-template/">thecodeninja.net</a> </li><li>  <a href="http://www.yiiframework.com/doc-2.0/guide-tutorial-i18n.html">yiiframework</a> </li><li>  <a href="https://yiiframework.com.ua/ru/doc/guide/2/tutorial-i18n/">yiiframework</a> </li></ul><br><h2>  Create a configuration file common / config / i18n.php </h2><br>  Having executed the command <br> <code>php yii message/config @common/config/i18n.php</code> <br>  Create such a file common / config / i18n.php: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'color'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'interactive'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'help'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'sourcePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR, <span class="hljs-string"><span class="hljs-string">'messagePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'messages'</span></span>, <span class="hljs-string"><span class="hljs-string">'languages'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'pt-PT'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>,<span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>,<span class="hljs-string"><span class="hljs-string">'en-US'</span></span>],<span class="hljs-comment"><span class="hljs-comment">//       'translator' =&gt; 'Yii::t', 'sort' =&gt; false, 'overwrite' =&gt; true, 'removeUnused' =&gt; false, 'markUnused' =&gt; true, 'except' =&gt; [ '.svn', '.git', '.gitignore', '.gitkeep', '.hgignore', '.hgkeep', '/messages', '/BaseYii.php', ], 'only' =&gt; [ '*.php', ], 'format' =&gt; 'db', 'db' =&gt; 'db', 'sourceMessageTable' =&gt; '{{%source_message}}',//      'messageTable' =&gt; '{{%message}}',//     'ignoreCategories' =&gt; ['yii'],//   ];</span></span></code> </pre><br><br><h2>  Add a component </h2><br>  Examples of the component are in the version with php format <br>  In the common / main.php configuration file <br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>,<span class="hljs-comment"><span class="hljs-comment">//  'sourceLanguage' =&gt; 'uk-UA',//  'components' =&gt; [ ... 'i18n' =&gt; [ 'translations' =&gt; [ // * -   '*' =&gt; [ 'class' =&gt; 'yii\i18n\DbMessageSource', 'on missingTranslation' =&gt; ['common\components\TranslationEventHandler', 'handleMissingTranslation'] ], ], ], ....</span></span></code> </pre><br><br>  the handler for not found translations common \ components \ TranslationEventHandler is also in the example with the php format <br><br>  In the views, there should be calls to the method of the Yii :: t () component see. Help Link <br>  For example: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> \Yii::t(<span class="hljs-string"><span class="hljs-string">'frontend/home'</span></span>, <span class="hljs-string"><span class="hljs-string">'key home'</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> \Yii::t(<span class="hljs-string"><span class="hljs-string">'frontend/login'</span></span>, <span class="hljs-string"><span class="hljs-string">'key login'</span></span>) ;</code> </pre><br><br><h2>  Execute migrate </h2><br>  To store translations, execute the table creation script. <br> <code>php yii migrate --migrationPath=@yii/i18n/migrations</code> <br>  Two tables will be created: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  CREATE TABLE IF NOT EXISTS `source_message` ( `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `category` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL, `message` text COLLATE utf8_unicode_ci, KEY `idx_source_message_category` (`category`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci; --  CREATE TABLE IF NOT EXISTS `message` ( `id` int(11) NOT NULL PRIMARY KEY, `language` varchar(16) COLLATE utf8_unicode_ci NOT NULL, `translation` text COLLATE utf8_unicode_ci, KEY `idx_message_language` (`language`), CONSTRAINT `fk_message_source_message` FOREIGN KEY (`id`) REFERENCES `source_message` (`id`) ON DELETE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</span></span></code> </pre><br><br>  Now you can run the console command to collect all categories and save them to the database <br> <code>php yii message/extract @common/config/i18n.php</code> <br> </div></div></li></ol><br><h5>  You can also store translations in Mongo: </h5><br>  But the key collection will have to write yourself. <br><div class="spoiler">  <b class="spoiler_title">yii \ mongodb \ i18n \ MongoDbMessageSource</b> <div class="spoiler_text">  Similarly‚Ä¶ <br><div class="spoiler">  <b class="spoiler_title">I18n component</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>,<span class="hljs-comment"><span class="hljs-comment">//'ru-RU', //.... 'components' =&gt; [ // ... 'i18n' =&gt; [ 'translations' =&gt; [ '*' =&gt; [ 'class' =&gt; 'yii\mongodb\i18n\MongoDbMessageSource' ] ] ], ] ];</span></span></code> </pre><br></div></div><br>  Create a collection: <br><br><pre> <code class="php hljs">$messages=Yii::$app-&gt;mongodb-&gt;getCollection(<span class="hljs-string"><span class="hljs-string">'messages'</span></span>); $messages-&gt;insert([ <span class="hljs-string"><span class="hljs-string">"_id"</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"frontend/index"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"uk"</span></span>, <span class="hljs-string"><span class="hljs-string">"messages"</span></span>=&gt;[<span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"—ñ Welt!"</span></span>,<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"—ñ"</span></span>] ]); $messages-&gt;insert([ <span class="hljs-string"><span class="hljs-string">"_id"</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"frontend/index"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"messages"</span></span>=&gt;[<span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">" Welt!"</span></span>,<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">""</span></span>] ]);</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">we receive such documents:</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">{ <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span>: <span class="hljs-string"><span class="hljs-string">"frontend/index"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>: <span class="hljs-string"><span class="hljs-string">"uk"</span></span>, <span class="hljs-string"><span class="hljs-string">"messages"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>: <span class="hljs-string"><span class="hljs-string">"—ñ Welt!"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>: <span class="hljs-string"><span class="hljs-string">"—ñ"</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"category"</span></span>: <span class="hljs-string"><span class="hljs-string">"frontend/index"</span></span>, <span class="hljs-string"><span class="hljs-string">"language"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"messages"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hallo Welt!"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }</code> </pre><br></div></div><br><br>  And when calling a transfer <br> <code><br> echo \Yii::t('frontend/index', 'Hello'); <br> echo \Yii::t('frontend/index', 'Hello world!'); <br></code> <br>  work out a sample from the collection of messages by language <code>'language'=&gt; 'uk-UA'</code> <br>  and categories <code>"category": "frontend/index"</code> Getting all the category keys at once, it makes sense to determine the category that uses all translations to the maximum. <br></div></div><br><br>  Or your own version, taking as a basis the storage of transfers in the database but with your own management (key generation, transfers and their storage). <br><br><h3>  <font color="green">Main</font> </h3><br><ul><li>  The transfer call remains standard Yii :: t (); </li><li>  Store translations with keys will be in MySQL; </li><li>  Temporary storage by language in Redis; </li><li>  Key collection (categories) remains the same; </li></ul><br><h4>  What are the advantages: </h4><br><ul><li>  rapidity; </li><li>  flexibility; </li></ul><cut><br><h3>  <font color="green">Creating a configuration file i18n.php</font> </h3><br>  Let's start by creating a key collector configuration file with this console command: <br><br><pre> <code class="hljs lua">php yii message/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span> @common/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/i18n.php</code> </pre> <br>  After this console command, the i18n.php file will appear in common / config / or simply create it like this: <br><br><div class="spoiler">  <b class="spoiler_title">common / config / i18n.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'color'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'interactive'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'help'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'sourcePath'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>. <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR . <span class="hljs-string"><span class="hljs-string">'..'</span></span> . DIRECTORY_SEPARATOR, <span class="hljs-string"><span class="hljs-string">'languages'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>,<span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>,<span class="hljs-string"><span class="hljs-string">'en-US'</span></span>],<span class="hljs-comment"><span class="hljs-comment">//    'translator' =&gt; 'Yii::t', 'sort' =&gt; false, 'overwrite' =&gt; true, 'removeUnused' =&gt; false, 'markUnused' =&gt; true, 'except' =&gt; [ '.svn', '.git', '.gitignore', '.gitkeep', '.hgignore', '.hgkeep', '/messages', '/BaseYii.php', ], 'only' =&gt; [ '*.php', ], 'format' =&gt; 'db', 'db' =&gt; 'db', //'messageTable' =&gt; '{{%message}}', //       gr_dictionary 'sourceMessageTable' =&gt; '{{%gr_dictionary}}',//   'ignoreCategories' =&gt; ['yii'], ];</span></span></code> </pre></div></div><br><h3>  <font color="green">Creating tables in MySQL</font> </h3><br>  Next, create three tables for the main storage of all languages ‚Äã‚Äãwith translations: <br><br><div class="spoiler">  <b class="spoiler_title">gr_language (languages)</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`gr_language`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">`code_lang`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`local`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`code_lang`</span></span> (<span class="hljs-string"><span class="hljs-string">`code_lang`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`local`</span></span> (<span class="hljs-string"><span class="hljs-string">`local`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`gr_language`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`code_lang`</span></span>, <span class="hljs-string"><span class="hljs-string">`local`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'en-US'</span></span>, <span class="hljs-string"><span class="hljs-string">'English'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'uk'</span></span>, <span class="hljs-string"><span class="hljs-string">'uk-UA'</span></span>, <span class="hljs-string"><span class="hljs-string">'—ó'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">gr_dictionary_keys (keys)</b> <div class="spoiler_text"><pre> <code class="sql hljs"> <span class="hljs-comment"><span class="hljs-comment">--    CREATE TABLE IF NOT EXISTS `gr_dictionary_keys` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT PRIMARY KEY, `key` varchar(250) NOT NULL, UNIQUE KEY `id` (`id`), KEY `key` (`key`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">gr_dictionary (translations)</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--    CREATE TABLE IF NOT EXISTS `gr_dictionary` ( `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY, `language_id` smallint(5) unsigned NOT NULL, `key` int(10) unsigned NOT NULL, `value` varchar(255) NOT NULL COMMENT '', `translator` text NOT NULL COMMENT '', `type` set('w','m') DEFAULT NULL COMMENT 'w/m /', `status` tinyint(4) NOT NULL DEFAULT '1', CONSTRAINT `gr_dictionary_ibfk_1` FOREIGN KEY (`language_id`) REFERENCES `gr_language` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `gr_dictionary_ibfk_2` FOREIGN KEY (`key`) REFERENCES `gr_dictionary_keys` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, UNIQUE KEY `language_id` (`language_id`,`key`,`type`), KEY `code_lang` (`language_id`), KEY `type` (`type`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span></span></code> </pre><br></div></div><br><h3>  <font color="green">Redefine the console controller</font> </h3><br>  Now, before collecting the keys, override the console controller \ yii \ console \ controllers \ MessageController which is responsible for collecting all the keys.  To do this, create your controller which is inherited from it. <br><br>  Create a file console \ controllers \ Message2Controller.php of this type: <br><br><div class="spoiler">  <b class="spoiler_title">console \ controllers \ Message2Controller.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">console</span></span>\<span class="hljs-title"><span class="hljs-title">controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">console</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message2Controller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">controllers</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Saves messages to database * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $messages     [[]=&gt;[[],[...]] ,... ] * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \yii\db\Connection $db * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $sourceMessageTable     * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $messageTable   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> boolean $removeUnused * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $languages    languages  i18n.php ['ru-RU',...] * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> boolean $markUnused */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveMessagesToDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($messages, $db, $sourceMessageTable, $messageTable, $removeUnused, $languages, $markUnused)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ $pr_iskey=Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"SELECT `id` FROM `gr_dictionary_keys` WHERE `key`=:key"</span></span>); $pr_inskey=Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"INSERT INTO `gr_dictionary_keys`( `key`) VALUES (:key)"</span></span>); $pr_delkey=Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"DELETE FROM `gr_dictionary_keys` WHERE `id`=:id"</span></span>); $id_lang=[]; $pr_l=Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"SELECT SQL_NO_CACHE id FROM gr_language WHERE local=:local LIMIT 1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($languages <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $language) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($id_lang[$language])){ $id_language=(int)$pr_l-&gt;bindValue(<span class="hljs-string"><span class="hljs-string">":local"</span></span>, $language,<span class="hljs-number"><span class="hljs-number">2</span></span>)-&gt;queryScalar(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($id_language)){ <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// throw new Exception("Unknow lang type $language"); } $id_lang[$language]=(int)$id_language; } } if(empty($id_lang))throw new Exception("empty lang"); //ALTER TABLE `yii2advanced`.`gr_dictionary` ADD UNIQUE (`language_id`, `key`, `type`); $pr_d=Yii::$app-&gt;db-&gt;createCommand("INSERT IGNORE INTO `gr_dictionary`( `language_id`, `key`, `value`, `type`) VALUES (:language_id,:key,:value,:type)"); foreach ($messages as $category =&gt; $msgs){ list($type,$key)=explode(":", $category); if(empty($id=$pr_iskey-&gt;bindValue(":key", $key,2)-&gt;queryScalar())){ $pr_inskey-&gt;bindValue(":key", $key,2)-&gt;execute(); $id=Yii::$app-&gt;db-&gt;lastInsertID; } foreach ($id_lang as $id_language) { $pr_d-&gt;bindValue(":language_id", $id_language,1) -&gt;bindValue(":key", $id,1) -&gt;bindValue(":value", $msgs[0],2) -&gt;bindValue(":type", $type,2) -&gt;execute(); } } //     status=1 (   ) $query=Yii::$app-&gt;db-&gt;createCommand("SELECT SQL_NO_CACHE dk.`id`,CONCAT(d.`type`,':',dk.`key`) as 'key_' FROM `gr_dictionary` d,gr_dictionary_keys dk WHERE d.`key`=dk.id AND status=1")-&gt;query(); //$pr_del=Yii::$app-&gt;db-&gt;createCommand("DELETE FROM `gr_dictionary` WHERE `key`=:key"); while(($data=$query-&gt;read())!=false){ if(array_key_exists($data['key_'], $messages)===false){ //$pr_del-&gt;bindValue(":key", $data['id'],1)-&gt;execute(); $pr_delkey-&gt;bindValue(":id", $data['id'],1)-&gt;execute(); } } Yii::$app-&gt;db-&gt;createCommand("ALTER TABLE gr_dictionary AUTO_INCREMENT = 1;")-&gt;execute(); }catch (\Exception $e){ //   } } }</span></span></code> </pre><br><br></div></div><br>  The point here is that we need only one method saveMessagesToDb, which fills the gr_dictionary table from the common / config / i18n.php configuration file <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'sourceMessageTable'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'{{%gr_dictionary}}'</span></span></code> </pre> <br>  collected keys from our site, which we previously called via <a href="">Yii :: t ()</a> . But you can also use another table, here we already decide how we feel better.  Added the deletion of keys, and with them the transfers by reference to a foreign key if this key is no longer used on the site. <br><br>  Now we can call the collection of keys by the team to our controller: <br><br><pre> <code class="php hljs">php yii message2/extract @common/config/i18n.php</code> </pre> <br>  As a result, two tables should be filled (gr_dictionary and gr_dictionary_keys).  An entry for translation will be created for each language from the gr_language table. <br><br><h3>  <font color="green">Add components i18n</font> </h3><br>  Next, add the common \ config \ main.php configuration file to the i18n component: <br><br><div class="spoiler">  <b class="spoiler_title">common \ config \ main.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> ... <span class="hljs-string"><span class="hljs-string">'language'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">'sourceLanguage'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'en-US'</span></span>, <span class="hljs-string"><span class="hljs-string">'components'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'i18n'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'translations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'common\models\AltDbMessageSource'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   yii\i18n\DbMessageSource ], ], ], 'lng' =&gt; [ 'class' =&gt; '\common\components\LanguageExtension', ], ...</span></span></code> </pre><br></div></div><br><ol><li>  The Yii i18n component will work on calls to Yii :: $ app-&gt; t (). The class responsible for this is yii \ i18n \ DbMessageSource but we will override it with common \ models \ AltDbMessageSource. <br><br></li><li>  The lng component is our class \ common \ components \ LanguageExtension responsible for working with Redis </li></ol><br><h3>  <font color="green">Override yii \ i18n \ DbMessageSource</font> </h3><br>  The class responsible for the translation, we implement in our <br><br><div class="spoiler">  <b class="spoiler_title">yii \ i18n \ DbMessageSource</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AltDbMessageSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i18n</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sourceLanguage; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sourceLanguage === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sourceLanguage = Yii::$app-&gt;sourceLanguage; } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translateMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($category, $message, $language)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    (w:key)         lng    w  m    ,          . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($type,) = explode(<span class="hljs-string"><span class="hljs-string">":"</span></span>,$category); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Yii::$app-&gt;lng-&gt;$type($category); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($category, $message, $language)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $language !== <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sourceLanguage ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;translateMessage($category, $message, $language); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } }</code> </pre><br></div></div><br>  The translateMessage method is called when we call Yii :: t ('category', 'value').  Here it is important how we are going to organize the appearance of the key.  It is possible through the separator <code>:</code> with the help of which folders with hierarchy will be created in Redis, which gives clarity.  For example: such keys <br>  <code>Yii::t('ru-RU:type:uniq_view','')</code> will look in RedisAdmin like this: <br><br><ul><li>  ru-RU: <br><ul><li>  type: <br><ul><li>  uniq_view: value </li><li>  uniq_view: value </li><li>  uniq_view: value </li></ul></li></ul></li></ul><br>  What will allow to do with Redis such selections: <br><pre> <code class="php hljs">$redis-&gt;executeCommand(<span class="hljs-string"><span class="hljs-string">"KEYS"</span></span>,[<span class="hljs-string"><span class="hljs-string">"KEY"</span></span> =&gt; $lang_key.<span class="hljs-string"><span class="hljs-string">":"</span></span>.$type.<span class="hljs-string"><span class="hljs-string">":*"</span></span>]); $redis-&gt;executeCommand(<span class="hljs-string"><span class="hljs-string">"KEYS"</span></span>,[<span class="hljs-string"><span class="hljs-string">"KEY"</span></span> =&gt; $lang_key.<span class="hljs-string"><span class="hljs-string">":*"</span></span>]);</code> </pre> <br>  The language key ru-RU and others will be added at the time of filling Redis in the component \ common \ components \ LanguageExtension. <br><br><h3>  <font color="green">Let's write the component \ common \ components \ LanguageExtension</font> </h3><br>  The component is needed to receive a translation by key from Redis or an array if Redis has fallen off. <br><br><div class="spoiler">  <b class="spoiler_title">common \ components \ LanguageExtension</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>\<span class="hljs-title"><span class="hljs-title">extensions</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">components</span></span>\<span class="hljs-title"><span class="hljs-title">exceptions</span></span>\<span class="hljs-title"><span class="hljs-title">LanguageException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">db</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PDO</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class LanguageExtension * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@package</span></span></span><span class="hljs-comment"> common\components\extensions * : *   *   redis */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguageExtension</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $language; <span class="hljs-comment"><span class="hljs-comment">//   -   ru private $w = []; //   private $m = []; //   private $storageConnection; //     private $storageStatus; //     private $numbDb; //  redis private $default_key; //    private $expire; public function __construct() { try{ $this-&gt;expire = Yii::$app-&gt;params['secretKeyExpire']??(60 * 60 * 60); $this-&gt;language = \Yii::$app-&gt;language; $language=LanguageExtension::currentLang(); if(!empty($language)){ if($this-&gt;idKeyLang($language)) { $this-&gt;language= $language; } } $this-&gt;numbDb=Yii::$app-&gt;params['redisLangDB']??11; $this-&gt;storageStatus = false; $this-&gt;default_key= $this-&gt;language.":index"; $this-&gt;storageConnection = new \yii\redis\Connection([ 'hostname' =&gt; Yii::$app-&gt;params['redisHost'], // 'password' =&gt; '', 'port' =&gt; 6379, 'database' =&gt; $this-&gt;numbDb, ]); if(empty($this-&gt;language)) throw new LanguageException("not default language",0); $this-&gt;init(); }catch ( LanguageException $event){ // echo $event-&gt;getMessage(); }catch ( \yii\db\Exception $event){ $this-&gt;init(); }catch (\Exception $event){ // echo $event-&gt;getMessage(); } } public function __destruct() { try{ if($this-&gt;storageConnection-&gt;isActive) $this-&gt;storageConnection-&gt;close(); }catch (\Exception $event){ } } /** *  . *  .      . *     . */ public function init(){ try{ $this-&gt;storageConnection-&gt;open(); //     redis if(!$this-&gt;isFullData()){ //   mysql    redis $this-&gt;loadRedis(); } $this-&gt;storageStatus = true; } catch ( \yii\db\Exception $event) { $this-&gt;storageStatus = false; //  . //     $w  $m     . $this-&gt;loadVariable(); } } public static function currentLang(){ try{ $language = isset($_COOKIE['userLang']) ? $_COOKIE['userLang'] : null; if(!$language &amp;&amp; Yii::$app-&gt;session-&gt;has('userLang')) { $language = Yii::$app-&gt;session('userLang'); } if(empty($language))$language=\Yii::$app-&gt;language; return $language; } catch (\Exception $e){ print_r($e-&gt;getMessage());exit; } } private function idKeyLang(string $key){ if(!empty($key)){ return Yii::$app-&gt;db-&gt;createCommand("SELECT `id` FROM `gr_language` WHERE local=:local") -&gt;bindValue(":local", $key,PDO::PARAM_STR) -&gt;queryScalar(); } return false; } /** * @param string $type * @param string $key * @return string *   */ private function getKeyMD5(string $type,string $key):string { return $this-&gt;language.":".$type.":".md5($key); } /** * @return bool *     */ private function loadVariable():bool{ try{ //  . //     $w  $m     . $language_id=$this-&gt;idKeyLang($this-&gt;language); $res=\Yii::$app-&gt;db-&gt;createCommand("SELECT d.`type`,d.`value`,d.`translator`, dk.`key` FROM `gr_dictionary` d,gr_dictionary_keys dk WHERE d.`key`=dk.id AND d.language_id=:language_id") -&gt;bindValue(":language_id", $language_id,PDO::PARAM_INT)-&gt;query(); $this-&gt;w=$this-&gt;m=[]; while(($data=$res-&gt;read())!=false){ if(method_exists($this, $data['type'])){ $this-&gt;{$data['type']}[$this-&gt;getKeyMD5($data['type'],$data['key'])]=$data['translator']; } } return true; }catch (\Exception $event){ echo $event-&gt;getLine()."|".$event-&gt;getMessage();exit; return false; } } /** * @return bool *    redis  mysql ( ) */ private function loadRedis():bool{ try{ $language_id=$this-&gt;idKeyLang($this-&gt;language); $res=\Yii::$app-&gt;db-&gt;createCommand("SELECT d.`type`,dk.`key`, d.`value`,d.`translator` FROM `gr_dictionary` d,gr_dictionary_keys dk WHERE d.`key`=dk.id AND d.language_id=:language_id") -&gt;bindValue(":language_id", $language_id,PDO::PARAM_INT)-&gt;query(); $this-&gt;storageConnection-&gt;executeCommand('SETEX', [ "KEY" =&gt; $this-&gt;default_key,"SECONDS"=&gt;$this-&gt;expire,"VALUE"=&gt; "1"]); while(($data=$res-&gt;read())!=false){ $this-&gt;storageConnection-&gt;executeCommand('SETEX', ["KEY" =&gt; $this-&gt;getKeyMD5($data['type'],$data['key']),"SECONDS"=&gt;$this-&gt;expire,"VALUE"=&gt; $data['translator']]); } if(empty($this-&gt;storageConnection-&gt;executeCommand('LASTSAVE', [] ))) $this-&gt;storageConnection-&gt;executeCommand('BGSAVE', [] ); return true; }catch (\Exception $event){ echo $event-&gt;getMessage();exit; } } /** *  Redis */ public function flushdb(){ try{ if($this-&gt;storageConnection-&gt;isActive) $this-&gt;storageConnection-&gt;executeCommand('FLUSHDB'); else { $this-&gt;w=[]; $this-&gt;m=[]; } }catch (\Exception $event){ } } /** * @return bool *    redis         */ private function isFullData():bool { try{ $res= $this-&gt;storageConnection-&gt;executeCommand('INFO', [ ] ); preg_match("/.*db$this-&gt;numbDb:keys=([\d])*.*?/uis",$res,$arr); if(isset($arr[1]) &amp;&amp; $arr[1]&gt;1){ return $this-&gt;exists($this-&gt;default_key); } return false; }catch (\Exception $event){ echo $event-&gt;getMessage(); return false; } } /** * @param string $key * @return string *         */ public function w(string $key) : string { return $this-&gt;getKeyValue($key, 'w'); } /** * @param string $key * @return string *         */ public function m(string $key) : string { return $this-&gt;getKeyValue($key, 'm'); } /** * @param string $key * @param string $type * @return string *    *  .      -. */ private function getKeyValue ( string &amp;$key, string $type ) : string { try{ if(!$key=trim($key)) throw new LanguageException("Error dictionary ".addslashes($key).". The ".addslashes($key)." can not be empty or contain only whitespace.", 777001); if($this-&gt;storageStatus) $value = $this-&gt;storageConnection-&gt;executeCommand("GET",["KEY" =&gt;$this-&gt;getKeyMD5($type,$key)]); else{ $value = @$this-&gt;$type[$this-&gt;getKeyMD5($type,$key)]; } /*   if(!$value){ if ($this-&gt;hasEventHandlers(\yii\i18n\MessageSource::EVENT_MISSING_TRANSLATION)) { $event = new \yii\i18n\MissingTranslationEvent([ 'category' =&gt; $key, 'message' =&gt; $key, 'language' =&gt; $this-&gt;language, ]); $this-&gt;trigger(\yii\i18n\MessageSource::EVENT_MISSING_TRANSLATION, $event); } }*/ return $value ? $value : $key; }catch (\Exception $event){ return $key; } } /** * @param $key * @return bool *   */ public function del($key):bool{ try{ if($this-&gt;storageConnection-&gt;isActive){ return $this-&gt;storageConnection-&gt;executeCommand("DEL",["KEY" =&gt;$key]);// keys test:1:v }else{ list($lang_key,$type,$key_)= explode(":", $key); if(method_exists($this, $type) &amp;&amp; isset($this-&gt;$type[$key_])){ unset($this-&gt;$type[$key_]); return true; } return false; } }catch (\Exception $event){ return false; } } /** * @param string $lang_key * @param null $type * @return bool *         */ public function delAll(string $lang_key,$type=null){ try{ if($this-&gt;storageConnection-&gt;isActive){ $keys= $this-&gt;keys($lang_key,$type); if(!empty($keys)){ foreach ($keys as $key){ $this-&gt;del($key); } if($type==null) $this-&gt;del($lang_key.":index"); } }else{ $this-&gt;w=$this-&gt;m=[]; return true; } }catch (\Exception $event){ return false; } } /** * @param $type * @param $key * @return array *     */ public function keys(string $lang_key,$type=null):array{ try{ if($this-&gt;storageConnection-&gt;isActive){ if($type!=null) return $this-&gt;storageConnection-&gt;executeCommand("KEYS",["KEY" =&gt; $lang_key.":".$type.":*"]); else return $this-&gt;storageConnection-&gt;executeCommand("KEYS",["KEY" =&gt; $lang_key.":*"]); }else{ if($type!=null){ return $this-&gt;w+$this-&gt;m; }else{ if(method_exists($this, $type))return $this-&gt;$type; } return []; } }catch (\Exception $event){ return []; } } /** * @param $type * @param $key * @return bool *    */ public function exists($key):bool{ try{ if($this-&gt;storageConnection-&gt;isActive){ return $this-&gt;storageConnection-&gt;executeCommand("EXISTS",["KEY" =&gt;$key]); }else{ // return (method_exists($this, $type) &amp;&amp; isset($this-&gt;$type[$key])); list($lang_key,$type,$key_)= explode(":", $key); if(method_exists($this, $type))return isset($this-&gt;$type[$key_]); return false; } return false; }catch (\Exception $event){ return false; } } }</span></span></code> </pre><br></div></div><br><h4>  The essence </h4><br>  Storing the entire language dictionary by default <code>Yii::$app-&gt;language</code> value, if there is no COOKIE data, in Redis or in the array if Redis did not work, according to the type of the value <code>$this-&gt;w[]  ,$this-&gt;m[] </code> .    ,         . <br><br><h4>  How does he work </h4><br>     Redis.      ,      ,      MySQL. <br><br>  ,           ,     <code>ru-RU:index</code>        . <br><br>  ,  MySQL  4 .      ru-RU ,   ?   Redis  MySQL  ru-RU       ,     en-US,   Redis   ,        . <br><br>               <br><br><pre> <code class="php hljs">$redis-&gt;executeCommand(<span class="hljs-string"><span class="hljs-string">'SETEX'</span></span>, [<span class="hljs-string"><span class="hljs-string">"KEY"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getKeyMD5($data[<span class="hljs-string"><span class="hljs-string">'type'</span></span>],$data[<span class="hljs-string"><span class="hljs-string">'key'</span></span>]),<span class="hljs-string"><span class="hljs-string">"SECONDS"</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;expire,<span class="hljs-string"><span class="hljs-string">"VALUE"</span></span>=&gt; $data[<span class="hljs-string"><span class="hljs-string">'translator'</span></span>]]);</code> </pre> <br><h2>    </h2><br><div class="spoiler"> <b class="spoiler_title">frontend\widgets\WLang</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">widgets</span></span>\<span class="hljs-title"><span class="hljs-title">WLang</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">frontend</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PDO</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WLang</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Widget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'index'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'current'</span></span> =&gt; \common\components\LanguageExtension::currentLang(), <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; \Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"SELECT `id`, `code_lang`, `local`, `name`, `default_lang`, `status` FROM `gr_language` WHERE local=:local LIMIT 1"</span></span>)-&gt;bindValue(<span class="hljs-string"><span class="hljs-string">":local"</span></span>,\common\components\LanguageExtension::currentLang(),PDO::PARAM_STR)-&gt;queryOne(PDO::FETCH_OBJ), <span class="hljs-string"><span class="hljs-string">'langs'</span></span> =&gt;\Yii::$app-&gt;db-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">"SELECT `id`, `code_lang`, `local`, `name`, `status` FROM `gr_language` WHERE 1"</span></span>)-&gt;queryAll(PDO::FETCH_OBJ), ]); } } &lt;div&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">yii</span></span>\<span class="hljs-title"><span class="hljs-title">helpers</span></span>\<span class="hljs-title"><span class="hljs-title">Html</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;script&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">click_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(el)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lang = $(el).attr(<span class="hljs-string"><span class="hljs-string">'data-lang'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date; date.setDate(date.getDate() + <span class="hljs-number"><span class="hljs-number">1</span></span>); document.cookie = <span class="hljs-string"><span class="hljs-string">"userLang="</span></span> + lang + <span class="hljs-string"><span class="hljs-string">"; path=/; expires="</span></span> + date.toUTCString() + <span class="hljs-string"><span class="hljs-string">";"</span></span>; location.reload(); } &lt;/script&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"lang"</span></span>&gt; &lt;span id=<span class="hljs-string"><span class="hljs-string">"current-lang"</span></span>&gt; &lt;span <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">more</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">" &gt;  &lt;?= $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current</span></span></span><span class="hljs-class">;?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ul</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">langs</span></span></span><span class="hljs-class">"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foreach</span></span></span><span class="hljs-class"> ($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">langs</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">as</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">):?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">item</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">"&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="#" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onclick</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">click_</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">)" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">="&lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">local</span></span></span><span class="hljs-class">?&gt;"&gt;&lt;?=$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">code_lang</span></span></span><span class="hljs-class">?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endforeach</span></span></span><span class="hljs-class">;?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ul</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole point of the widget is to display all available languages ‚Äã‚Äãand install COOKIE data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Further, when more translations are added or deleted on the pages of our application, we simply call for the collection of keys and enter their values ‚Äã‚Äãinto MySQL. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">good luck, </font></font><a href="https://habrahabr.ru/users/jekshmek/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jekshmek</font></font></a></b> </cut></div><p>Source: <a href="https://habr.com/ru/post/318102/">https://habr.com/ru/post/318102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318086/index.html">Build your open source AWS S3 server</a></li>
<li><a href="../318088/index.html">What does the operator monitor hide from the client?</a></li>
<li><a href="../318096/index.html">Ember - Best Practices: Avoid Leaking Condition into the Factory</a></li>
<li><a href="../318098/index.html">Yandex mobile experience in three video courses: design, development, interfaces</a></li>
<li><a href="../318100/index.html">Christmas Easter eggs</a></li>
<li><a href="../318104/index.html">Elixir in bioinformatics</a></li>
<li><a href="../318106/index.html">Intercepting Linux system calls using LSM</a></li>
<li><a href="../318110/index.html">SPI Flash Programming with Arduino and SD Card</a></li>
<li><a href="../318112/index.html">How IT professionals work. Ilya Kosmodemyansky, PostgreSQL-Consulting LLC</a></li>
<li><a href="../318116/index.html">Three more online Mail.Ru Group courses in open mode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>