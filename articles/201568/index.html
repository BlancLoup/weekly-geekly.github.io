<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create backup copies of SQL Server 2014 CTP2 database in Windows Azure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Actually, the idea to reserve a base in the Cloud is not new. This functionality appeared in the current SQL Server 2012 with the release of 01/01/201...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create backup copies of SQL Server 2014 CTP2 database in Windows Azure</h1><div class="post__text post__text-html js-mediator-article"> Actually, the idea to reserve a base in the Cloud is not new.  This functionality appeared in the current SQL Server 2012 with the release of <a href="http://support.microsoft.com/kb/2772858">01/01/2013 of the</a> cumulative update No. 2 to Service Pack 1 ( <a href="http://support.microsoft.com/kb/2790947">Build 11.0.3339.0</a> ).  We analyzed it in the post <a href="http://habrahabr.ru/post/171901/">Create a backup copy of the database in Azure Storage</a> .  Therefore, I will not repeat that this is a very convenient feature that provides data migration from on-premise SQL Server to the cloud (IaaS) and vice versa, as well as facilitates the transfer of the database between two separated on-premise SQL Servers when the Cloud performs the role of a hub.  Until now, this could only be done from the T-SQL script.  In the 2014 CTP version, two new features have been added to this process.  First, you can now back up to Windows Azure directly from the SQL Server Management Studio interface and <a href="http://msdn.microsoft.com/en-us/library/dn449496(v%3Dsql.120).aspx">include it on a regular basis in an automated database support plan</a> , and second, and importantly, encrypt backups using certificates or asymmetric keys on based cryptographic protection algorithms.  However, first things first. <br><a name="habracut"></a><br>  In this post, I will do, in fact, the same as in the <a href="http://habrahabr.ru/post/171901/">previous one</a> , just not from the command line, but from a new graphical interface.  In contrast to the laconic scripting solution, there will be more pictures. <br>  To begin, we, as you might guess, will need, in fact, SQL Server 2014 CTP2, which can be taken <a href="http://www.microsoft.com/en-us/sqlserver/sql-server-2014.aspx">here</a> .  This trial version expires March 31, 2014. When downloading, you will need to select the distribution type (iso / cab / Azure), bit depth (32-bit or 64-bit) and language.  Currently available in English, German, Spanish, Japanese, Chinese (Traditional).  In the release of Russian, as always, will be supported, well, so far here is what is.  Installation does not cause any surprises / difficulties compared to the current version.  I put 2014 CTP2 side by side with a named instance near 2012. <a href="http://habrahabr.ru/company/microsoft/blog/197008/">They coexist</a> normally, do not fight, unlike <a href="http://habrahabr.ru/company/microsoft/blog/197008/">PAGE1</a> .  You can begin to experiment. <br><br>  We start new SQL Server Management Studio.  For happy owners of Windows 8.x who do not use the detailed tiles on the start screen, where they are grouped by SQL Server 2012, SQL Server 2014, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a7/adb/9e8/1a7adb9e8ac0e67f496f4c6000854b03.jpg"><br>  Pic1 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      but prefer to quickly type something like "sql" in the search bar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f8e/74a/996/f8e74a9963ff589693739dcd2db932cb.jpg"><br>  Pic2 <br><br>  Now there are several of these tiles.  You need to select the one that belongs to C: \ ProgramData \ Microsoft \ Windows \ Start Menu \ Programs \ Microsoft SQL Server 2014 CTP2, i.e.  refers to C: \ Program Files (x86) \ Microsoft SQL Server \ 120 \ Tools \ Binn \ ManagementStudio \ Ssms.exe. <br><br>  In SSMS, from the context menu of the database, we choose, as always, Tasks -&gt; Back Up and note that in the new backup interface, along with the traditional disk, another URL has appeared as an alternative option to host a backup. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c8/31c/765/4c831c7651f7101e0d962a927e21f30d.jpg"><br>  Pic.3 <br><br>  If in SSMS 2014 CTP2 you connect an instance of server version 2012 and below, this option will not be available for it.  For instances of 2014 PP2, it is available regardless of the compatibility level in which the base is located. <br>  After selecting Back up to = URL, the interface of the Destination section is modified so as to provide the ability to enter parameters that we previously used in the <a href="http://habrahabr.ru/post/171901/">BACKUP DATABASE ... TO URL command</a> (see Script 2).  Required to ask.  File name - the name of the backup file that will be saved in the Windows Azure history. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/531/5ad/569/5315ad5690f212646648b73b2e9dba06.jpg"><br>  Pic.4 <br><br>  Pressing the Create button next to SQL Credential corresponds to the execution of the <a href="http://habrahabr.ru/post/171901/">CREATE CREDENTIAL command</a> (see Script 2).  To confirm authenticity when accessing a cloud subscription, you can use <a href="http://msdn.microsoft.com/ru-ru/library/windowsazure/gg551722.aspx">a management certificate</a> or a publication profile (a file with the .publishsettings extension).  We used the second method in the post <a href="http://habrahabr.ru/company/microsoft/blog/196618/">Introduction to the development and testing of applications in the Cloud</a> (Figure 16-17), so here for a change we will look at the first method. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/673/412/3d3/6734123d354faf757942c2f0c370bbdf.jpg"><br>  Pic.5 <br><br>  Open the Visual Studio command line on behalf of the administrator and create a self-signed certificate for working with Windows Azure with a key length of at least 2048 bits, which is stored in the default certificate store - Personal. <br> <code>makecert -sky exchange -r -n "CN=AzureCert" -pe -a sha1 -len 2048 -ss My</code> <br>  Script 1 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/475/936/74c/47593674ceafa706b1050eacaa17e23d.jpg"><br>  Pic.6 <br><br>  If Visual Studio is not present, you can download the makecert utility, for example, as part of the <a href="http://msdn.microsoft.com/en-us/windows/hardware/hh852363.aspx">Windows 8 SDK</a> .  After that, you need to look for it somewhere in C: \ Program Files (x86) \ Windows Kits \ 8.x \ bin \ x64. <br>  To verify that the certificate was created successfully, we call the usual command window (again, better as an administrator) and enter certmgr.msc.  In the Personal section we see the newly created certificate. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20a/475/a64/20a475a64ba9355812a1e05f2e335bac.jpg"><br>  Fig.7 <br><br>  We export it (without a private key) to a .cer file.  From the context menu of the certificate, select All Tasks -&gt; Export: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d1/5f0/60a/4d15f060ad6681e881a6dabade8622bd.jpg"><br>  Fig.8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/621/db3/61e/621db361e9d208c075c72f2516456000.jpg"><br>  Fig.9 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e2/d0d/e34/4e2d0de3442c64e9834b1c4540d332c8.jpg"><br>  Pic.10 <br><br>  Now we go to the Windows Azure administration portal, select the last Settings item in the panel on the left, Management Certificates in the top menu, and click the Upload button at the bottom and specify the .cer file exported in Figure 10. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4da/456/b19/4da456b1930d7e29fb57ba19f62a0a2b.jpg"><br>  Figure 11 <br><br>  It appears in the list of certificates: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db4/6d1/35f/db46d135fec7aa5e17ffbeaa940a86f7.jpg"><br>  Fig.12 <br><br>  We return to Figure 5, click the Select button (management certificate from the certificate store) and in the opened window select the line with the newly created AzureCert certificate: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c88/780/3a0/c887803a02e555e4601d0697e6e2b1c8.jpg"><br>  Fig.13 <br><br>  A thumbprint of the specified certificate appears in the text box to the left of the Select button. <br>  It remains to enter a subscription - its name or ID can be read there, in the Settings Portal of the Windows Azure Administration (Fig.11-12), if in the top menu move to the left by the Subcriptions item. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d1a/c91/b3f/d1ac91b3f21a7decd2f42275efe64728.jpg"><br>  Fig.14 <br><br>  After entering the Windows Azure Management Certificate and Subscription ID, we move to the Storage Account box.  There is a slight pause, during which SSMS tries to go to the cloud, indicating the specified subscription and certificate, it all works out and the list of Azure storage accounts belonging to this subscription opens at the bottom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/359/873/76c/35987376cf54789a0cc71f31a505319b.png"><br>  Fig.15 <br><br>  We select the interesting one, in which the backup will take place, and press the Create button.  Credential is created, and we return to Fig.4.  It remains to specify the container of the selected Azure storage account.  As well as in the <a href="http://habrahabr.ru/post/171901/">previous post</a> , I will specify the public container container1.  The prefix URL field is automatically populated.  If everything is correct, editing is not required. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26c/bf8/b73/26cbf8b73c79a6d4f5e3c8394cd5f1e9.jpg"><br>  Figure 16 <br><br>  Click the OK button, the backup starts to run. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/668/5c4/0f1/6685c40f1fb15771725aad754f675f74.jpg"><br>  Pic.17 <br><br>  After it is finished, go to the container1 container tststorage storage account on the Windows Azure management portal and observe the blob that was recently created in it, which contains the backup file for the AdventureWorks database: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb7/6df/81f/fb76df81f860a839244223c20f0a713a.jpg"><br>  Pic.18 <br><br>  Recovery is similar. <br>  In the next series, we will analyze the new encryption features of backups. </div><p>Source: <a href="https://habr.com/ru/post/201568/">https://habr.com/ru/post/201568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201552/index.html">The digest of news from the world of mobile development in the last week ‚Ññ31 (November 4‚Äî10, 2013)</a></li>
<li><a href="../201554/index.html">Video lectures on 3D bioprinting (conducted by Dr. B. Novoselov, Ph.D., by MD, Ph.D., V. Mironov)</a></li>
<li><a href="../201556/index.html">Unique Carnegie Mellon University Password Database Study</a></li>
<li><a href="../201558/index.html">Zend's new ZCPE certificate based on PHP 5.5</a></li>
<li><a href="../201564/index.html">Unite extension overview and setup</a></li>
<li><a href="../201572/index.html">Sprite Lamp: dynamic lighting of 2D objects</a></li>
<li><a href="../201574/index.html">Smart Resize and other winners of Nokia Future / Capture</a></li>
<li><a href="../201578/index.html">How to make a contribution to Kickstarter, get the goods + pick up your money? The story of one deception</a></li>
<li><a href="../201582/index.html">UrlEye.com is a free website control service.</a></li>
<li><a href="../201586/index.html">Installing the latest version of Firebird on Ubuntu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>