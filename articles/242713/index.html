<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Runner under iOS with five characters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 It so happened that I have been developing for iOS for a long time, but what a bad luck - I never wrote a game. After the snake at age 13...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Runner under iOS with five characters</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  It so happened that I have been developing for iOS for a long time, but what a bad luck - I never wrote a game.  After the snake at age 13, under the IBM 386, there was a break until 2014, when I gained strength to make the warm tube dream a reality.  What came out of it?  The graphics came down like this: <br><br><img src="https://habrastorage.org/files/982/27a/7c3/98227a7c32524ea3a2ca68847eeff561.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And the gameplay wanted to make it look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/356/d20/ed0/356d20ed05f2be64f24569d39e31519b.gif"><br>  If interested, please under the cat!  (many pictures!) <br><a name="habracut"></a><br>  The project is a non-commercial, without a purse, advertising and SMS, and at the current stage it is more like a concept.  Perhaps the second picture is familiar to Habr's readers - one fine day I saw her in <a href="http://habrahabr.ru/post/216869/">this post</a> , yes, my enthusiastic comments.  First, a few words about the graphics. <br><br><h2>  Graphics </h2><br>  I, fortunately or unfortunately, are an ordinary programmer and draw quite a pity, so I had to look for an artist.  And what budget can offer a married man for his razvlelochochki?  Well, it turned out about $ 1000 in the end, but of course this would not be enough for a professional game artist, so after some time I went to a girl who paints in watercolors very well, but did not see photoshop in her eyes.  We started with the background and, as I always wanted to make horror, eerie trees.  The scans came out like this (the pictures are clickable): <br><br> <a href=""><img src="https://habrastorage.org/files/8f1/862/bc8/8f1862bc8de8422d87885cf65fa24c51.jpg"></a> <br> <a href=""><img src="https://habrastorage.org/files/e9a/6eb/bdc/e9a6ebbdc212424e8c776aabb95602d6.jpg"></a> <br> <a href=""><img src="https://habrastorage.org/files/7cc/bc1/b29/7ccbc1b2960246a2950ee9560e459154.png"></a> <br><br>  The last scan - the platform - so generally reminded me of something the first StarCraft according to the color scheme.  And I liked this watercolor so much that I decided not to translate it into a vector and leave it as it is, cutting it out and retouching a little in Photoshop.  As a result, out of the many sketches in the game, 13 types of trees, 2 platform variations and 5 characters appeared, for which it is proposed to play simultaneously to the player.  In paper, it looks like this: <br><br><img src="https://habrastorage.org/files/cf6/b61/12e/cf6b6112ee9541b3a80ce8385536c69e.jpg"><br><br>  C characters got harder.  Of many, many options for children, we chose a very long time.  Initially, I didn‚Äôt even know how many there would be - it was more natural with the keys, but there isn‚Äôt much space on the iPhone screen as on the midi-keyboard.  After long experiments, there are 5 of them left. The entire list barely fit into the photo: <br><br><img src="https://habrastorage.org/files/426/28a/b3a/42628ab3a2434e9e986e2698b6c5c243.jpg"><br><br>  After the information of the entire screenshot with the winners looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d3/abe/f8f/5d3abef8fa8030074e460b9ae5b457c8.jpg"><br><br>  All the characters were given nicknames, for example the most skinny - Auschwitz.  Some were named after their resemblance to colleagues.  It was difficult with the animation, it was even necessary to redo the auschwitz (in the current version, it twitches like a paralytic, in version 1.1 I‚Äôll take the update).  I brought everything in layers in Photoshop, checked it with animated hyphae.  It took about 3 hours to mix and cut one character: <br><br><img src="https://habrastorage.org/files/bb7/118/6ce/bb71186cee1e4701b428a0b7317ad9bd.png"><br><br>  But I am very pleased with the result.  Of course, modern designers and animators reproached a small FPS animation - it consists of eight frames for each player - but the pictures turned out to be very similar to the cartoons of the 20s and 30s of the last century: <br><br><img src="https://habrastorage.org/files/dc0/543/69e/dc054369ef6c425da4704d37bbcc82b1.gif"><br><br>  It immediately became interesting to me - all these points, shading, scuffs appearing on the frames in old cartoons appeared due to the aging of the film, or just like in ours - from random pencil movements over the paper?  After all, they did not have the concept of post-production, the pictures were most likely taken and pasted as is.  If anyone has information or ideas, please share in the comments. <br><br><h2>  Programming </h2><br>  Initially, I developed a fully working prototype on Cocos2D + Box2D, but I didn‚Äôt like a few nuances: <br><ul><li>  From the point of view of Box2D, each player is a parallelepiped.  If one player had run, some flaws and errors in the calculation of physics would have been simply imperceptible, and with the synchronous running of five players in arbitrary parts of time, the distance between them would be reduced by a couple of pixels, then on the contrary would increase.  With what it was connected, I did not figure it out, but I found information on the Internet that such complex engines should not be used in the runners for at least this reason - it turns out that it was not me who came across this rake; </li><li>  I didn‚Äôt really like Cocos2D due to its weak encapsulation - in SpriteKit the code is shorter and more understandable, due to the lack of HUGE OF VIEW_OPENGLES3_CONSTANT and other direct OpenGL calls that sometimes reminded me of the WinAPI nightmare - I need to know it thoroughly or smoke a bunch of documentation and forums eventually lead to a thorough knowledge of a huge number of constants, without which I live well. </li></ul><br><br>  As a result, I rewrote everything on SpriteKit (and that, I have the right, the project is mine), and as physics I wrote a primitive engine - no more than is required for a 2D runner, 100 lines. There is nothing interesting or new in it, any programmer will write the same for the day.  But the units of measurement from spherical in vacuum turned into pixels for a second and a second squared - it‚Äôs quite a pleasure to work with such, unlike the abstract meters for a device :) <br><br>  But I had to tinker with the world notably - initially I wanted to write an endless scroller with an autogenerated world, which gave me a lot of pleasant and not very impressions.  All layers of the visible world are generated randomly, according to certain laws, some of which (for example, the algorithm for generating trees in the background) I can not figure out until now.  The code is replete with magical constants of the form ‚Äúthree two-by-two roots‚Äù, which over time have lost meaning for me - but it looks cool!  Probably, it would be worth writing a separate article about it. <br><br>  I also made a pretty clever parallax of trees - when you turn the phone in your hands, they depict a 3D effect.  I added an invisible view whose parallax is computed by iOS itself, and for each tick of the game I read the delta of its coordinates, which I multiply by the distance of the tree from the user (1 is the furthest, 0 is the closest) and add it to (X; Y) the tree itself.  It turns out pretty nice and productive. <br><br>  By the way, I also had to tinker with performance, but more because of inexperience - for example, the biggest brake turned out to be that I turned to the UIKit element on each redraw cycle.  Finally, I realized why the game engines have their own buttons and labels!  And I, the ignoramus, made a HUD on ordinary iOS controls. <br><br><h2>  Conclusion </h2><br>  As an acquaintance, the music was written to me by the leader of one Belarusian rap group for a nominal fee to 1 bank of my grandmother's adzhika, whom he has loved since his studies at the institute.  In my opinion, it is beautiful in itself (and music, and adzhika).  The rest of the sounds were found by our tester Igor on the drains, for which he thanks a lot as well as everyone who helped me in creating the toy.  I almost forgot, <a href="https://itunes.apple.com/us/app/rush-out-escape-from-nightmare/id933863959%3Fls%3D1%26mt%3D8">link to upstor</a> , <a href="https://itunes.apple.com/us/app/rush-out-escape-from-nightmare/id933863959%3Fls%3D1%26mt%3D8">enjoy the</a> game!  I will be glad to every comment! <br><br>  UPD: <a href="https://www.youtube.com/watch%3Fv%3D02MqiUGp2kE%26feature%3Dyoutu.be">on the</a> video <a href="https://www.youtube.com/watch%3Fv%3D02MqiUGp2kE%26feature%3Dyoutu.be">link</a> gameplay. </div><p>Source: <a href="https://habr.com/ru/post/242713/">https://habr.com/ru/post/242713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242699/index.html">Explore the internal mechanisms of Hyper-V</a></li>
<li><a href="../242701/index.html">A / B testing: 70 resources that will serve as a good start for beginners</a></li>
<li><a href="../242707/index.html">The story of how a mobile operator wrote off money from the developer Dr. Tariff (grab popcorn)</a></li>
<li><a href="../242709/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ133 (November 3 - 9, 2014)</a></li>
<li><a href="../242711/index.html">Polytech 2.0: First chips!</a></li>
<li><a href="../242715/index.html">Blade syntax extension</a></li>
<li><a href="../242725/index.html">Automatic connection of network multifunction devices with the ability to scan [Part 2]</a></li>
<li><a href="../242727/index.html">Analyzing HTTP traffic with Mitmproxy</a></li>
<li><a href="../242729/index.html">Configuring Ruby Module</a></li>
<li><a href="../242731/index.html">Low cost, small, networked computers - a small overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>