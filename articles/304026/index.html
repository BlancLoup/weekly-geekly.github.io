<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSON and PostgreSQL 9.5: with even more powerful tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PostgreSQL 9.5 introduced a new feature associated with JSONB, greatly enhancing its existing NoSQL features. With the addition of new operators and f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSON and PostgreSQL 9.5: with even more powerful tools</h1><div class="post__text post__text-html js-mediator-article">  PostgreSQL 9.5 introduced a new feature associated with JSONB, greatly enhancing its existing NoSQL features.  With the addition of new operators and functions, it is now possible to easily modify data stored in JSONB format.  This article will present these new operators with examples of how they can be used. <br><br>  With the addition of the JSON data type in version 9.2, PostgreSQL has finally started supporting JSON natively.  Despite the fact that with the release of this version it became possible to use PostgreSQL as a ‚ÄúNoSQL‚Äù database, not much could actually be done at that time due to the lack of operators and interesting functions.  Since the release of version 9.2, JSON support has improved significantly in each subsequent version of PostgreSQL, today resulting in a complete overcoming of the initial limitations. <br><a name="habracut"></a><br>  Probably the most memorable changes were adding a JSONB data type to PostgreSQL 9.4 and, in the current version of PostgreSQL 9.5, introducing new operators and functions that allow you to modify and manage JSONB data. <br><br>  In this article, we will focus on the new features brought by Postgres 9.5.  However, before diving into this topic, if you want to learn more about the differences between JSON and JSONB data types, or if you have doubts about the relevance of using ‚ÄúNoSQL‚Äù database in your case, I recommend reading the following articles on The above topics (the titles of the articles and the authors are left in the original): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="http://blog.2ndquadrant.com/nosql-postgresql-9-4-jsonb/">NoSQL with PostgreSQL 9.4 and JSONB</a> by Giuseppe Broccolo </li><li>  <a href="http://blog.2ndquadrant.com/jsonb-type-performance-postgresql-9-4/">JSONB type performance in PostgreSQL 9.4</a> by Marco Nenciarini </li><li>  <a href="http://blog.2ndquadrant.com/postgresql-anti-patterns-unnecessary-jsonhstore-dynamic-columns/">PostgreSQL anti-patterns: Unnecessary json / hstore dynamic columns</a> by Craig Ringer </li></ul><br><h2>  <b>New JSONB Operators</b> </h2><br>  Operators and functions that were present in PostgreSQL before version 9.4 allowed only to extract JSONB data.  Therefore, in order to change this data, you had to retrieve it, modify it, then re-insert it into the database.  Not very practical, some would say. <br><br>  The new operators introduced in PostgreSQL 9.5, which were based on the <i>jsonbx</i> extension for PostgreSQL 9.4, were able to change this, greatly improving the interoperability of JSONB data. <br><br><h4>  <b>Concatenation with ||</b> </h4><br>  Now you can concatenate two JSONB objects using the operator ||: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'{"name": "Marie", "age": 45}'</span></span>::jsonb || <span class="hljs-string"><span class="hljs-string">'{"city": "Paris"}'</span></span>::jsonb; ?column? <span class="hljs-comment"><span class="hljs-comment">---------------------------------------------- {"age": 45, "name": "Marie", "city": "Paris"} (1 row)</span></span></code> </pre> <br><br>  In this example, the <i>city</i> key is added to the first JSONB object. <br><br>  In addition, this operator can be used to overwrite existing values: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'{"city": "Niceland", "population": 1000}'</span></span>::jsonb || <span class="hljs-string"><span class="hljs-string">'{"population": 9999}'</span></span>::jsonb; ?column? <span class="hljs-comment"><span class="hljs-comment">------------------------------------------- {"city": "Niceland", "population": 9999} (1 row)</span></span></code> </pre><br>  In this case, the value of the <i>population</i> key was rewritten to the value from the second object. <br><br><h4>  <b>Uninstalling with -</b> </h4><br>  Operator <b>-</b> can remove a key / value pair from a JSONB object: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'{"name": "Karina", "email": "karina@localhost"}'</span></span>::jsonb - <span class="hljs-string"><span class="hljs-string">'email'</span></span>; ?column? <span class="hljs-comment"><span class="hljs-comment">------------------- {"name": "Karina"} (1 row)</span></span></code> </pre><br>  As you can see, the <i>email</i> key specified by the <b>-</b> operator has been removed from the object. <br><br>  In addition, it is possible to remove an element from an array: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'["animal","plant","mineral"]'</span></span>::jsonb - <span class="hljs-number"><span class="hljs-number">1</span></span>; ?column? <span class="hljs-comment"><span class="hljs-comment">----------------- ["animal", "mineral"] (1 row)</span></span></code> </pre><br>  The superior example shows an array consisting of 3 elements.  Knowing that the first element of the array corresponds to the 0 position ( <i>animal</i> ), the operator points to the element located at position 1 and removes <i>plant</i> from the array. <br><br><h4>  <b>Removing with # -</b> </h4><br>  The difference in comparison with the operator <b>-</b> is that <b># - the</b> operator can delete the nested key / value pair if the path to it is specified: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'{"name": "Claudia", "contact": { "phone": "555-5555", "fax": "111-1111"}}'</span></span>::jsonb <span class="hljs-comment"><span class="hljs-comment">#- '{contact,fax}'::text[]; ?column? --------------------------------------------------------- {"name": "Claudia", "contact": {"phone": "555-5555"}} (1 row)</span></span></code> </pre><br>  Here, the <i>fax</i> key is embedded in <b>contact</b> .  We use the <b>#</b> operator <b>-</b> with the path to the <i>fax</i> key to delete it. <br><br><h2>  New JSONB functions </h2><br>  For more power when working with JSONB data, instead of just deleting and rewriting it, we can now use the new JSONB function: <br><br><h4>  jsonb_set </h4><br>  The new <i>jsonb_set</i> processing <i>function</i> allows <i>you</i> to change the value for a specific key: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> jsonb_set( <span class="hljs-string"><span class="hljs-string">'{"name": "Mary", "contact": {"phone": "555-5555", "fax": "111-1111"}}'</span></span>::jsonb, <span class="hljs-string"><span class="hljs-string">'{contact,phone}'</span></span>, <span class="hljs-string"><span class="hljs-string">'"000-8888"'</span></span>::jsonb, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); jsonb_replace <span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------------------------------------- {"name": "Mary", "contact": {"fax": "111-1111", "phone": "000-8888"}} (1 row)</span></span></code> </pre><br>  It is much easier to understand the upstream example by knowing the structure of the <i>jsonb_set</i> function.  It has 4 arguments: <br><ul><li>  target jsonb: JSONB value to be changed </li><li>  path text []: path to the value of interest, represented as a text array </li><li>  new_value jsonb: a new key / value binding that needs to be changed (or added) </li><li>  create_missing boolean: An optional field that allows the creation of a new key / value bundle if it does not already exist </li></ul><br>  Looking back at the previous example, this time understanding its structure, we see that the <i>phone</i> key nested in the <i>contact has</i> been changed by the <b>jsonb_set</b> function. <br><br>  Here is another example, this time creating a new key by using the boolean value <b>true</b> (4th argument in the structure of the <i>jsonb_set</i> function).  As mentioned above, this argument is <i>true</i> by default, so it is not necessary to specify it explicitly in the following example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> jsonb_set( <span class="hljs-string"><span class="hljs-string">'{"name": "Mary", "contact": {"phone": "555-5555", "fax": "111-1111"}}'</span></span>::jsonb, <span class="hljs-string"><span class="hljs-string">'{contact,skype}'</span></span>, <span class="hljs-string"><span class="hljs-string">'"maryskype"'</span></span>::jsonb, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); jsonb_set <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------------------------ {"name": "Mary", "contact": {"fax": "111-1111", "phone": "555-5555", "skype": "maryskype"}} (1 row)</span></span></code> </pre><br>  The <i>skype</i> key / value <i>binding</i> , which is not present in the original JSONB object, was added and is at the nesting level that was specified in the second argument of the <b>jsonb_set</b> function. <br><br>  If instead of <b>true</b> , the 4th argument of the <i>jsonb_set</i> function is <i>set</i> to <b>false</b> , then the <i>skype</i> key will not be added to the original JSONB object. <br><br><h4>  <b>jsonb_pretty</b> </h4><br>  Reading JSONB entries is not so easy, considering that it does not store spaces.  The <b>jsonb_pretty</b> function formats the output, making it easier to read: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> jsonb_pretty( jsonb_set( <span class="hljs-string"><span class="hljs-string">'{"name": "Joan", "contact": { "phone": "555-5555", "fax": "111-1111"}}'</span></span>::jsonb, <span class="hljs-string"><span class="hljs-string">'{contact,phone}'</span></span>, <span class="hljs-string"><span class="hljs-string">'"000-1234"'</span></span>::jsonb)); jsonb_pretty <span class="hljs-comment"><span class="hljs-comment">--------------------------------- { + "name": "Joan", + "contact": { + "fax": "111-1111", + "phone": "000-1234" + } + } (1 row)</span></span></code> </pre><br>  Again, in this example, the value of the <i>phone</i> key nested in <i>contact</i> is changed to the value passed in the 3rd argument of the <i>jsonb_set</i> function.  The only difference is that we used it now with the <i>jsonb_pretty</i> function, the output is now shown in a more understandable and readable form. <br><br><h2>  Conclusion </h2><br>  Despite the fact that they are trying to prove to us that a non-relational database cannot be a universal solution, not everyone will agree with this. <br><br>  Therefore, when speaking of ‚ÄúNoSQL‚Äù databases, you need to keep in your mind the thought of whether such a database is better for you than a relational one.  PostgreSQL, with its JSONB features, can give you an advantage: you can use both options (both document-oriented and relational databases) provided by the same solution, avoiding all the difficulties of using two different products. </div><p>Source: <a href="https://habr.com/ru/post/304026/">https://habr.com/ru/post/304026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304008/index.html">Installing Firebird on D-Link DNS-325</a></li>
<li><a href="../304014/index.html">We investigate protection and restore arcades Namco System ES1</a></li>
<li><a href="../304016/index.html">Business processes: the good, the bad and the ugly</a></li>
<li><a href="../304020/index.html">Why did not Pied Piper take off: our analysis of the 9th series of the 3rd season of the series ‚ÄúSilicon Valley‚Äù</a></li>
<li><a href="../304024/index.html">"Cut the Gordian knot" or overcoming the problems of encrypting information in Windows</a></li>
<li><a href="../304028/index.html">In St. Petersburg to be: reports of the "confrontation" NeoQUEST-2016</a></li>
<li><a href="../304030/index.html">Testing. Errors in certification or ISTQB I really need</a></li>
<li><a href="../304032/index.html">Cloud Storage: API Update</a></li>
<li><a href="../304034/index.html">History of programming languages: 100% "pure" C, without a single "plus"</a></li>
<li><a href="../304036/index.html">Full list of extensions for SQL Server Management Studio (SSMS)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>