<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Full Disk Encryption (FDE)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In most cases, disk encryption is unnecessary or even harmful. However, when it comes to a laptop, paranoia does not hurt. Having received a new lapto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Full Disk Encryption (FDE)</h1><div class="post__text post__text-html js-mediator-article">  In most cases, disk encryption is unnecessary or even harmful.  However, when it comes to a laptop, paranoia does not hurt.  Having received a new laptop in my hands, it was the first time I encrypted the disk and took care of it. <br><br>  At the moment, many distributions out of the box have the opportunity to create encrypted partitions.  However, all the options that I came across, provide unencrypted / boot.  Not a critical, but unpleasant omission.  Information on how to make a fully encrypted disk is searched on the Internet quite easily, but the overwhelming part of it is in English and some of the pitfalls are still not described.  I will try in the most concise, understandable and step by step to combine this information in one text. <br><a name="habracut"></a><br><h3>  What will we use </h3><br>  <b>Distribution</b> : Slackware Linux 14.2 (but I think everything can be easily adapted to any Linux distribution) <br>  <b>Encryption</b> : Luks <br>  <b>Markup</b> : LVM <br>  <b>Loader</b> : Grub2 <br><br><h3>  Partitioning and disk encryption </h3><br>  We start with disk layout.  So, as we plan to encrypt the entire disk, we need to create only one partition (I do not use UEFI). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">parted /dev/sda mklabel msdos parted -a optimal /dev/sda mkpart primary 0% 100%</code> </pre> <br>  Now format this section under Luks and connect it. <br><br><pre> <code class="bash hljs">cryptsetup luksFormat /dev/sda1 cryptsetup luksOpen /dev/sda1 lda</code> </pre><br><br>  After running luksOpen, we got a block device lda, which we can already mark up using LVM. <br><br><pre> <code class="bash hljs">pvcreate /dev/mapper/lda vgcreate vga /dev/mapper/lda lvcreate -L4G -n swap vga lvcreate -L32G -n root vga lvcreate -l100%FREE -n home vga</code> </pre><br>  Create a swap partition. <br><br><pre> <code class="bash hljs">mkswap /dev/vga/swap</code> </pre><br>  Then you can start installing the system on the created LVM sections.  After the installation is completed, do not reboot, but exit to the terminal and continue to engage in magic. <br><br><h3>  Loading </h3><br>  First of all, we need to create an initrd / initramfs in the way that the kernel is not able to access the encrypted disk on its own.  It should be noted here that most of the boxed distributions are designed to boot from the / boot partition without encryption and that the password to access the encrypted disk must be entered at boot time (system initialization).  For us, this means that we will have to enter the password twice, which is not very convenient.  This problem can be solved by creating a luks-key and placing it in the initrd. <br><br><pre> <code class="bash hljs">dd bs=512 count=4 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/urandom of=/root/boot.key cryptsetup luksAddKey /dev/sda1 /root/boot.key</code> </pre><br>  I strongly recommend that you refer to the documentation for the utility to create the initrd / initramfs of your distribution.  It can support the addition of luks-keys.  In Slackware, I was faced with the fact that working with such keys is supported, but the key must be placed on an unencrypted medium (for example, on a flash drive).  I had to cheat as follows: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  initrd mkinitrd -c -k 4.4.14 -m ext4 -f ext4 -r /dev/vga/root -C /dev/sda1 -L #   install -D -m 0600 /root/boot.key /boot/initrd-tree/mountkey/boot.key #  initrd mkinitrd -c -k 4.4.14 -m ext4 -f ext4 -r /dev/vga/root -C /dev/sda1 -L -K :/boot.key</span></span></code> </pre><br><h3>  Grub </h3><br>  I didn‚Äôt look for too long, but from what I‚Äôve come across, only Grub2 supports booting from an encrypted disk. <br>  In order for the loader to access the files on the disk, we need to add the corresponding key in / etc / default / grub: <br><br><pre> <code class="bash hljs">GRUB_ENABLE_CRYPTODISK=y GRUB_CRYPTODISK_ENABLE=y</code> </pre><br>  As you can see, I have specified both GRUB_ENABLE_CRYPTODISK and GRUB_CRYPTODISK_ENABLE.  This is the first underwater stone that I stumbled upon.  I did not delve into the nature of this phenomenon, but according to the documentation one should use the first one, and grub-mkconfig checks the second one for ‚Äúy‚Äù. <br><br>  Install the bootloader. <br><pre> <code class="bash hljs">grub-mkconfig -o /boot/grub/grub.cfg grub-install /dev/sda</code> </pre><br>  At this point, the installation can be considered complete.  As a result, we have to get a system that lives entirely on an encrypted disk and, when loading, only ask for a password once, at the start stage of Grub. <br><br><h3>  Materials on the topic and sources </h3><br>  <a href="http://www.pavelkogan.com/2014/05/23/luks-full-disk-encryption/">Full disk encryption with LUKS (including / boot)</a> - Pavel Kogan <br>  <a href="">Installing Slackware on encrypted volumes</a> - Eric Hameleers </div><p>Source: <a href="https://habr.com/ru/post/306606/">https://habr.com/ru/post/306606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306596/index.html">Gitlab-ci</a></li>
<li><a href="../306598/index.html">ITU new generation Cisco Firepower 4100 series close-up</a></li>
<li><a href="../306600/index.html">In Q2 2016, encryptors top the list of cyber attacks</a></li>
<li><a href="../306602/index.html">When to use unstructured data types in PostgreSQL? Comparison Hstore vs. JSON vs. Jsonb</a></li>
<li><a href="../306604/index.html">The less the better - about the possibilities of programming languages</a></li>
<li><a href="../306608/index.html">Yota support service online</a></li>
<li><a href="../306612/index.html">How to mark your TODO, FIXME and ERROR in Xcode</a></li>
<li><a href="../306616/index.html">Terms of Reference for revision: 10 rules and a little tediousness</a></li>
<li><a href="../306618/index.html">World of Warcraft: one line of code to lose everything</a></li>
<li><a href="../306622/index.html">Web application vulnerabilities: users hit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>