<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WD Advanced Format on Windows Server 2003</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the full functioning of the disk with Advanced Format tenology under WinXP, it is desirable to align it - these are the official recommendations a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WD Advanced Format on Windows Server 2003</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/65059f65/478e3081/04828024/5e16129b.jpg" align="left">  For the full functioning of the disk with Advanced Format tenology under WinXP, it is desirable to align it - these are the official recommendations and test results.  For XP, there are utilities laid out on the WD website.  There are no problems in Vista / 7/2008 Server either - Advanced Format is supported by them out of the box.  As for Win2003, there is no official information about the use of disks with AF, either from WD or from MS.  Moreover, the partition alignment utility (WD Align) refuses to work in Win2003. <br><br>  The purpose of this small study was to experimentally confirm the need to align disk partitions with Advanced Format technology, operating under Windows Server 2003. As well as identifying ways of this alignment.  Under the cut a bit of theory, practice, conclusions and instructions. <br><a name="habracut"></a><br><h4>  1. Theory </h4><br><h5>  1.1.  Advanced format </h5><br>  Technology WD Advanced Format is to use the so-called "long sectors" the size of 4kb on the physical disk level.  While the traditional sector size is 512 bytes.  Modern operating systems can work with 4kb sectors, but WinXP and Win2003 do not belong to those.  For backward support, the clever WD made a hardware emulation: ‚Äúinside‚Äù the disk information is stored in 4kb-sectors, but the ‚Äúoutside‚Äù of the OS works with it through 512-byte sectors. <br>  Details about the technology can be read, for example, <a href="http://www.thg.ru/storage/wd_4k_sector/index.html">here</a> , <a href="http://www.fcenter.ru/forprint.shtml%3Fonline/articles/hardware/hdd/28121">here</a> or <a href="http://en.wikipedia.org/wiki/Advanced_Format">here</a> .  I will introduce a little squeeze. <br><br><img src="https://habrastorage.org/storage/afa57f1e/1b324263/4c4fb9d2/33b20331.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first problem with this emulation is that when writing a 512-byte sector, the disk has to read 4 kb sector, change the 512-byte sector, recalculate ECC and write the changed 4 kb sector back.  But this problem fades into the background when formatting a disk in WinXP / Win2003 - in this case, the beginning of the partition does not coincide with the boundaries of the physical 4kb sectors.  Because of this formatting feature, the created partition is shifted to one 512-byte sector. <br><br><img src="https://habrastorage.org/storage/68969ab1/a7cc428c/3a12cc63/c25b2fc6.gif"><br><br>  As a result, when querying the operating system, the disk in some cases has to work not with one physical 4kb sector, but with two neighboring ones.  This, of course, reduces performance. <br><br>  As a solution to this problem, WD proposes to align the sectors of the section along the boundaries of the physical sectors.  Two solutions are proposed for this: hardware and software.  The hardware solution is to install a jumper 7-8 on the hard disk.  To align the sections programmatically in universal access lined utility called <a href="http://support.wdc.com/product/download.asp%3Fgroupid%3D805">WD Align</a> . <br><br>  There are some limitations in the hardware solution: WD does not guarantee normal operation when partitioning a disk into several (&gt; 1) partitions.  In addition, the hardware solution (jumper) is not visible either in the utility or in the operating system.  So, theoretically, you can first plug in the jumper, and then perform the alignment programmatically (or create a partition in the modern OS) - and as a result get a ‚Äúdouble‚Äù shift. <br>  For these reasons, software alignment will be discussed further (but hardware will also be tested). <br><br><h5>  1.2.  WD Align and Windows Server 2003 </h5><br>  Under the above link for software sector leveling, WD offers two utilities: from Paragon and from Acronis.  The version from Paragon in general refuses to be installed on Win2003 (and, by the way, it is honestly not in Supported Operating Systems).  The version from Acronis is installed in Win2003, but it also defines the disk as ‚ÄúNot a Western Digital Advanced Format format disk,‚Äù and the section as ‚ÄúNot optimally aligned section‚Äù.  Alignment section of the utility in this situation can not be done. <br><br>  There are no official announcements about the support of Advanced Format technology in Windows Server 2003, the use of WD Align too.  According to the theory - in Win2003 almost the same core as in WinXP.  And that means that they should work with disks (almost?) Equally.  To test this possible "almost" performance tests were performed. <br><br><h4>  2. Practice </h4><br>  It should immediately be said: the purpose of the tests was not to measure the maximum speed of the disk and, moreover, not to compare it with other disks or other tests.  The purpose of these tests was to identify the relative difference in the speed of the disk with aligned and non-aligned sections. <br><br>  The WD20EARS of 2TB was used as a test subject, and <a href="http://www.iometer.org/doc/downloads.html">Iometer 2006.07.27 was used</a> as a test <a href="http://www.iometer.org/doc/downloads.html">tool</a> .  A rather detailed <a href="http://iometer.cvs.sourceforge.net/viewvc/iometer/iometer/Docs/Iometer.pdf">guide in English is</a> attached to the program.  In Russian with a description of the main settings can be found, for example, <a href="http://blog.aboutnetapp.ru/archives/485">here</a> . <br>  Many tests have been performed with different access specifications, including the following variations: <br>  - Read / Write - read / write <br>  - Sequential / Random - random / sequential disk access <br>  - Transfer Request Size - a different block size when accessing a disk (512 / 2k / 4k / 16k / 64k) <br>  - Outstanding I / Os - different number of simultaneous disk requests (1/4/16/64/256) <br><br>  Out of the whole set of obtained data, I present results that can be shown, sufficiently and sufficiently, whether there is a difference between aligned and non-aligned sections.  Access specification parameters are as follows: <br>  - Read / Write: 50% / 50% <br>  - Sequential / Random: 100% Sequential <br>  - Transfer Request Size: 512 / 2k / 4k / 16k / 64k <br>  - Outstanding I / Os: 1 <br>  The disk was tested in the following formatting options: <br>  1. Unaligned unpartitioned disk.  Unallocated <br>  2. Unaligned marked disk.  Unaligned. <br>  3. The aligned (jumper) marked disk.  Aligned (hard). <br>  4. Aligned (WD Align) marked disk.  Aligned (soft). <br>  To reduce the influence of random factors on the system under test, all ‚Äúunnecessary‚Äù services were turned off and the network connection was turned off. <br>  Each access specification was tested for 5 minutes with a delayed reading (Ramp Up Time) of 15 seconds. <br><br>  Test results are as follows: <br><img src="https://habrastorage.org/storage/ae149786/fd9ad1ad/61475205/95cd095e.png"><br><br>  Verdict: you need to align partitions on disks with Advanced Format under Windows Server 2003, which is consistent with theory.  Of course, a disk with unaligned partitions will work, but the speed is lame. <br><br><h4>  3. Leveling Instructions </h4><br>  As it was already said in the theoretical part, using WD Align utility under Win2003 will not work.  Therefore it is necessary to perform alignment in a different environment, and then give Win2003 for use.  You can choose from: <br>  - Creating partitions using standard Windows Server 2003 tools, and then aligning WD Align from the boot disk. <br>  - Creating partitions using standard Windows XP tools, and then leveling WD Align in the same XP. <br>  - Creating partitions using standard Windows Vista / 7/2008 tools. <br>  - Modification of the installer WD Align from Paragon, so that it can be installed in Win2003. <br><br>  In most cases, having Win2003, the first option is simpler and more reliable (the rest of the options were not checked by me personally).  Therefore, I provide a detailed description of the option with the boot disk: <br>  0. Do not forget to remove the jumper 7-8 if you inserted it. <br>  1. Download and install WD Align <u>from Acronis</u> ( <a href="http://support.wdc.com/product/download.asp%3Fgroupid%3D805">take here</a> ). <br>  2. Run the WD Align Bootable Media Builder utility and create a bootable disk. <br>  3. In order for WD Align to later see the hard disk, you need to initialize it and create partitions on it (you can format it with fast formatting). <br>  4. Boot from the created boot disk and align the partitions (now the utility should define the disk as WD Advanced Format). <br>  5. Reboot into Win2003.  To check, you can run WD Align, opposite the sections should be an icon "Optimally aligned section".  Opposite the drive there will be an icon ‚ÄúNot a disc of Western Digital Advanced Format format‚Äù, but there's nothing to be done with this glitch. </div><p>Source: <a href="https://habr.com/ru/post/108697/">https://habr.com/ru/post/108697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../108687/index.html">Tim Berners-Lee: Facebook can fragment the Web</a></li>
<li><a href="../108689/index.html">Olympiad hobby. Waste disposal task</a></li>
<li><a href="../108690/index.html">Routing and policy-routing in Linux with iproute2</a></li>
<li><a href="../108691/index.html">Increase netfilter performance using ipset</a></li>
<li><a href="../108695/index.html">Success tracing</a></li>
<li><a href="../108698/index.html">Social network for google</a></li>
<li><a href="../108699/index.html">Founder of OpenStreetMap goes to work at Microsoft, and OSM gets access to Bing satellite images</a></li>
<li><a href="../108701/index.html">The war in the cyber epoch: the concept of geocentric theater</a></li>
<li><a href="../108704/index.html">HTC Desire brilliant white</a></li>
<li><a href="../108705/index.html">Examine JS speed and page display algorithm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>