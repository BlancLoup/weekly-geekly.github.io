<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a plug-in for XBMC with its own interface: Part III - API and micro-framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 This is part III of a series of articles on writing plug-ins for XBMC with its own interface. In the previous sections ( Part I and Par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a plug-in for XBMC with its own interface: Part III - API and micro-framework</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  This is part III of a series of articles on writing plug-ins for XBMC with its own interface.  In the previous sections ( <a href="http://habrahabr.ru/post/193704/">Part I</a> and <a href="http://habrahabr.ru/post/194124/">Part II</a> ) I talked about the basic principles of creating an interface for XBMC plug-ins and gave some simple examples.  In this part, I want to briefly describe the various APIs for interacting with XBMC, to demonstrate the micro-framework written by me, which simplifies the layout of the interface. <a name="habracut"></a><br><br>  <b>Update as of November 3, 2014:</b> while writing the first two parts, I promised to write the 3rd part of the article soon.  But, unfortunately, life makes its own adjustments, and the writing of the third part had to be postponed until better times.  Now I will try to fulfill the promise, although not fully: the story of the micro-framework will be somewhat simplified. <br><br><h4>  API </h4><br>  A story about writing plugins for XBMC would be incomplete without at least a short story about various APIs that allow plug-ins to interact with XBMC.  Until now, the articles dealt with the API for creating an interface, but after all, plug-ins need to perform other tasks: obtaining information about media files, managing playback, etc. To perform these tasks, XBMC has 4 main APIs: Python API, built-in functions (built-ins), JSON-RPC protocol and Infolabels.  Further, quite briefly talk about each of them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Python API </h5><br>  A set of 5 Python modules: xbmc, xbmcgui, xbmcplugin, xbmcaddon, xbmcvfs for interacting with XBMC.  Modules are written in C ++ using the Python-C API (SWIG).  Below is a brief overview: <br>  xbmc - general interaction with XBMC; <br>  xbmcgui - interaction with the GUI; <br>  xbmcplugin - organization of plug-in sources of content; <br>  xbmcaddon - access to various plug-in parameters (settings, language files, etc.); <br>  xbmcvfs - work with the file system. <br><br><h5>  Built-in functions (builtins) </h5><br>  A set of commands to control XBMC.  To call built-in functions, it is not necessary to write program code: they can, for example, be tied to a keypad or keyboard button by editing the corresponding configuration file.  A list of built-in functions can be found <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DList_of_built-in_functions">here</a> . <br>  To call built-in functions from Python scripts, there is a function xbmc.executebuiltin (). <br><br><h5>  JSON-RPC protocol </h5><br>  A protocol for local and remote control of XBMC based on JSON-RPC.  Provides extensive interoperability with XBMC, including two-way communication.  Read more about the JSON-RPC protocol in XBMC <a href="http://wiki.xbmc.org/%3Ftitle%3DJSON-RPC_API">here</a> . <br>  For local control and information exchange via the JSON-RPC protocol, the xbmc.executeJSONRPC () function is used.  In addition, the standard Python library includes the json module, which simplifies the handling of JSON strings. <br>  Remote interaction with XBMC on other computers can be performed using the standard library's urllib2 module. <br><br><h5>  Infolabels </h5><br>  API for getting various info from XBMC.  A list of all available infolabels can be found <a href="http://kodi.wiki/view/InfoLabels">here</a> . <br>  To request information, use the xbmc.getInfoLabel () function. <br><br>  The capabilities of these APIs overlap, and the same operation can often be performed in different ways. <br><br>  Note: Up to version 11.0, XBMC also had a Web API, which allowed XBMC to be controlled using commands in URL-encoded notation.  However, starting with version 12.0, it was removed due to redundancy, since JSON-RPC provides much more features. <br><br><h4>  PyXBMCt - microform to simplify the layout of the plug-in interface </h4><br>  As can be seen from the previous parts of this series of articles, the API for creating plug-in interfaces based on the Window / WindowDialog classes and the descendants of the Control class is not very convenient: you have to operate with absolute coordinates, and the graphical design of the interface is completely left to the developer. <br><br>  The idea of ‚Äã‚Äãcreating a micro-framework that would simplify the creation of an interface of plug-ins (of course, within the capabilities of the XBMC Python API), was born during my writing of my own plug-in for downloading subtitles.  In XBMC before version 13.0, subtitle plugins were fully autonomous scripts, and the creation of the interface was assigned to the developer.  By the way, in version 13.0, the subtitle plug-in architecture was completely changed, and now they work similarly to <a href="http://habrahabr.ru/post/193374/">content-source plug-ins</a> , and the base code XBMC is responsible for the interface (by the way, from the 14th version the media center will be called Kodi). <br>  In order not to tinker with the absolute coordinates of the interface elements, I wrote a wrapper around the Window / WindowDialog / Control classes, implementing the similarity of the Grid geometry manager, and decorated the whole thing with textures taken from the default XBMC skin - Confluence.  It turned out well, and I decided to make on the basis of this a full-fledged micro-framework.  PyQt was taken as a sample, so the framework was called PyXBMCt. <br><br>  The framework offers 4 base container classes and 9 ready-to-use widgets, or, as they are called in XBMC, controls.  The Grid geometry manager is responsible for placing controls on the screen, and interactive controls are associated with functions / methods similarly to the signal-slot mechanism in PyQt.  Those familiar with PyQt / PySide should master PyXBMCt in two accounts. <br><br>  For clarity, we consider a very simple example. <br>  The PyXBMCt micro framework is present in the official XBMC / Kodi repository, so in order to use it, you need to add the following line to the addon.xml section of your plugin (for more information about the plug-in architecture <a href="http://habrahabr.ru/post/193374/">here</a> ): <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">addon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script.module.pyxbmct"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.1.4"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Now when you install your plug-in from the repository or ZIP file, the micro-framework will be pulled from the official repository automatically.  In addition, Kodi 14.0 "Helix" finally got the opportunity to install service plugins manually, and you can install the PyXBMCt plugin yourself. <br>  As the simplest example, of course, take ‚ÄúHello World‚Äù: <br><div class="spoiler">  <b class="spoiler_title">Hello world</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- #   PyXBMCt. import pyxbmct.addonwindow as pyxbmct class MyWindow(pyxbmct.AddonDialogWindow): def __init__(self, title=''): #    . super(MyWindow, self).__init__(title) #     ,     (Grid): # 2   3 . self.setGeometry(350, 150, 2, 3) #   . label = pyxbmct.Label('This is a PyXBMCt window.', alignment=pyxbmct.ALIGN_CENTER) #    . self.placeControl(label, 0, 0, columnspan=3) #  . button = pyxbmct.Button('Close') #    . self.placeControl(button, 1, 1) #     . self.setFocus(button) #    . self.connect(button, self.close) #     . self.connect(pyxbmct.ACTION_NAV_BACK, self.close) #   . window = MyWindow('Hello, World!') #   . window.doModal() #      . del window</span></span></code> </pre><br></div></div><br>  If everything is done correctly, this window will appear on the screen with the button: <br><img src="https://habrastorage.org/files/f31/16b/42c/f3116b42cbc2448ab0dd24316a1602b6.jpg"><br><br>  Now, a detailed analysis.  To display line numbers, use a text editor with the appropriate function, such as Notepad ++.  I think those who are familiar with PyQt / PySide or with other ‚Äúadult‚Äù GUI frameworks will immediately understand what is happening, so I‚Äôm missing obvious things. <br><br>  Line 13: the self.setGeometry () method sets the width and height of the window, as well as the resolution of the coordinate grid of the parent window in which the controls are placed.  The principle is completely analogous to the QtGui.QGridLayout linker.  By default, the window is placed in the center of the screen, but if you wish, you can specify the exact coordinates of the window as additional parameters of this method. <br><br>  Line 17: The self.placeControl () method places the selected control into a grid.  As in the present QtGui.QGridLayout, a control can occupy several rows and columns. <br>  <b>Attention!</b>  Any methods of the instance of the control (for example, setLabel () to change the text of the label) must be called only after this control is added to the window using placeControl ().  Otherwise, various glitches are possible, funny and not so. <br><br>  Line 23: The setFocus () method sets the initial focus to the selected control.  If there are any interactive controls, this method is <b>mandatory</b> , otherwise you simply cannot control your plugin from the keyboard / remote. <br>  If there are several interactive controls, you also need to set up navigation rules between them (see the previous parts). <br><br>  Lines 25 and 27: the self.connect () method associates a control or numeric key of a keyboard event with a function / method.  Naturally, a function reference is used here (without parentheses <b>()</b> ), and not a function call.  Also here you can use <b>lambda</b> - all as in the present PyQt. <br>  You can link only those controls that generate an event when they are activated: these are <b>Button</b> , <b>RadioButton</b> and <b>List</b> .  Other controls do not generate events, and linking them is useless. <br>  The numeric event codes generated by the controls (keyboard, mouse, joystick, etc.) can be found <a href="">here</a> .  PyXBMCt includes symbolic names for frequently used events. <br>  A numeric code <b>ACTION_PREVIOUS_MENU</b> or <b>10</b> (by default, the ESC key on the keyboard) is always associated with the close () method that closes the window and cannot be reassigned.  This is done so that the plug-in window can always be closed. <br><br>  Line 35: after use, the window instance is forcibly deleted (the destructor of the window instance and all objects associated with it is called).  The point here is that the Garbage Collector for some reason does not remove the objects of the xbmcgui classes after the plug-in is completed, which can lead to memory leaks.  Therefore, open windows based on xbmcgui / PyXBMCt must be removed from memory forcibly. <br><br>  A practical example of using PyXBMCt can be seen in <a href="https://github.com/romanvm/ex.ua.alternative/blob/master/plugin.video.ex.ua.alternative/resources/lib/login_window.py">my ex.ua.alternative plugin</a> , where a micro-framework is used to create a login box for a website: <br><br><div class="spoiler">  <b class="spoiler_title">Login window on ex.ua</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f58/e95/f01/f58e95f017154c8a85d399933aefa13b.jpg"><br></div></div><br><br>  More information about PyXBMCt can be found at the links below (English). <br><br>  <a href="https://dl.dropboxusercontent.com/u/24356082/PyXBMCt_QuickStart.pdf">PyXBMCt QuickStart Guide</a> . <br><br>  <a href="http://romanvm.github.io/PyXBMCt/docs">Automatically generated documentation on PyXBMCt classes and methods</a> . <br><br>  <a href="https://github.com/romanvm/script.module.pyxbmct">The PyXBMCt repository on Github</a> . <br><br>  <a href="http://forum.kodi.tv/showthread.php%3Ftid%3D174859">Subject on the official forum XBMC (Kodi)</a> . <br><br>  <a href="">Plugin demonstrating the features of PyXBMCt</a> (screenshot below is the spoiler). <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot PyXBMCt Demo</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/98d/e0c/f70/98de0cf7027143cda619aeee98682d82.jpg"><br></div></div><br><br>  Of course, the plugin interface created on the basis of PyXBMCt is inferior in its capabilities and ‚Äúembellishments‚Äù to the interface based on the XML-skin.  However, in many cases, its capabilities are quite sufficient, and those who are familiar with ‚Äúdesktop‚Äù GUI frameworks, in particular PyQt / PySide, can learn PyXBMCt very quickly. <br><br><h4>  Conclusion </h4><br>  This concludes the series of articles on writing plugins for XBMC (Kodi).  Unfortunately, due to a number of circumstances, the third part comes out with a considerable delay, but, as they say, "better late than never." <br><br>  PS Added info about InfoLabels. <br><br><h4>  Previous articles </h4><br>  <a href="http://habrahabr.ru/post/193374/">Detailed anatomy of a simple XBMC plugin</a> . <br>  <a href="http://habrahabr.ru/post/193704/">We write a plugin for XBMC with its own interface: Part I - the theory and the simplest example</a> . <br>  <a href="http://habrahabr.ru/post/194124/">We are writing a plugin for XBMC with its own interface: Part II - dialogues and embellishments</a> . </div><p>Source: <a href="https://habr.com/ru/post/194380/">https://habr.com/ru/post/194380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194364/index.html">iOS 7 does not support Connect On Demand in Always On mode</a></li>
<li><a href="../194370/index.html">New Evernote for iOS 7</a></li>
<li><a href="../194372/index.html">iOS 7 and Xamarin</a></li>
<li><a href="../194376/index.html">The best tricks to increase the speed of your website</a></li>
<li><a href="../194378/index.html">Mitsuku Chatbot wins AI Loebner this year</a></li>
<li><a href="../194382/index.html">Red Pitaya - 5 tools in 1 for $ 400</a></li>
<li><a href="../194388/index.html">Retail analytics: today you didn‚Äôt buy condoms, and the store already knows when a discount on baby food will come in handy</a></li>
<li><a href="../194390/index.html">We program in Python</a></li>
<li><a href="../194392/index.html">Intelligent motor cooling fan control relay</a></li>
<li><a href="../194394/index.html">Backstage flight reservations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>