<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Panoramas on Stereo Pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue experiments with the Raspberry Pi, equipped with two cameras simultaneously. Let me remind you that all the games occur around the Raspber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Panoramas on Stereo Pi</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/kc/wg/lv/kcwglvzlvc5sfcbzdm5yfm6lnfu.jpeg" alt="image"><br><br>  We continue experiments with the Raspberry Pi, equipped with two cameras simultaneously.  Let me remind you that all the games occur around the Raspberry Pi Compute Module 3 Lite, inserted into the StereoPi crib. <br><br>  In previous reviews, we installed cameras in parallel and worked with stereo.  Here, the approach is exactly the opposite: the cameras look in different directions, but they are equipped with wide-angle lenses (200 degrees).  And we will glue a spherical panorama of 360 degrees! <br><a name="habracut"></a><br><h2>  Introductory </h2><br>  Distraction: since on Habr√© there is no co-authorship of articles, I will mention the main text.  This experiment was conducted jointly, with me - iron and experiments in the field, and with <a href="https://habr.com/users/Gol/">@Gol</a> - the software part. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start from the end: here is the <a href="http://www.g0l.ru/test/stereopi/pano1/">result, the actual panorama</a> . <br><br>  So, this time, let's try to make a spherical panorama.  In vain, perhaps, we have two cameras on board.  Of course, it was possible to connect two cameras to a normal raspberry, in multiplexing mode (either one camera works, then the other, the choice of the right one - via GPIO).  But then the shots will be taken sequentially, and in the presence of movement it is not very gut.  However, when ‚Äúsimultaneous‚Äù shooting from two cameras, stereo recordings are also no synchronization, stupidly two raspistill simultaneously start.  But there are more chances that the objects on the border will not run very fast.  Also, the video can be simultaneously shot with two cameras, and then sewed into a spherical video panorama.  But I'll try it sometime later, first you need to figure it out with photo panoramas. <br><br><h2>  Iron </h2><br>  We have <a href="http://stereopi.com/">StereoPi</a> , there are two cameras with a fish lens (200 degrees).  These are the cameras: <a href="https://onpad.ru/catalog/cubie/raspberrypi/cameras/2505.html">RPi Camera (M) WaveShare</a> <br><br>  We have two cameras pop-to-pope: <br><br><img src="https://habrastorage.org/webt/wm/zn/c6/wmznc6yll8-u0hxzfu9pfs4lpss.jpeg" alt="image"><br><br>  We take photos from both cameras.  Ideally - at the same time, but it can be alternately.  raspistill to help us.  We get these two pictures: <br><br><img src="https://habrastorage.org/webt/gj/ly/bh/gjlybhfu5wrpt3vxt0jsi-oinj4.jpeg" alt="image"><br>  <a href="">Full size</a> <br><br><img src="https://habrastorage.org/webt/yg/9f/-x/yg9f-xbtdlvqu6n69slo2yv_wgk.jpeg" alt="image"><br>  <a href="">Full size</a> <br><br><h2>  Stitching panorama </h2><br>  Then a problem arose - how to automatically make a picture with an equidistant projection from these two phishing pictures, which is eaten by almost all viewers of panoramas.  You want to do the conversion right on board the stereo recordings, without using special panoramic software. <br><br>  After much research, the <a href="https://github.com/BrianBock/360-camera">360-camera</a> project was found, from where the scripts were taken as the basis. <br><br>  But first, we still have to use a separate panoramic program to prepare a template for conversion.  The program is called Hugin, you can download it here <a href="http://hugin.sourceforge.net/download/">http://hugin.sourceforge.net/download/</a> <br><br>  1. So, downloaded, installed, launched. <br>  2. Select the ‚ÄúSimple‚Äù option in the ‚ÄúInterface‚Äù menu. <br><br><img src="https://habrastorage.org/webt/no/jt/aw/nojtaweqaqdd2uhtwxiz6teypma.jpeg" alt="image"><br><br>  3. Click the button ‚ÄúUpload images ...‚Äù and add our two files (21.jpg and 21-2.jpg). <br><br><img src="https://habrastorage.org/webt/zu/12/c7/zu12c7gypxdmexopttcdf1oxulg.jpeg" alt="image"><br><br>  4. Set the "Lens Type" - "Circular VyrvIglaz."  The ‚Äúfocal length‚Äù of 1.2mm and the ‚Äúfocal length multiplier‚Äù of 7.6x.  And in the ‚ÄúProjection‚Äù tab, we are convinced that there is a field of view 360x180 and ‚ÄúEquidistant‚Äù.  By default, the way it should be. <br><br><img src="https://habrastorage.org/webt/_g/wc/gn/_gwcgnb4_s89l_tvxsvnnfndinq.jpeg" alt="image"><br><br>  5. Click the button ‚Äú2.  Align ... ".  The search for control points will begin, there should be somewhere between 10 and 13 points.  The panorama is already starting to look like a panorama. <br><br><img src="https://habrastorage.org/webt/eb/hf/8m/ebhf8mtccgv4klnjvmbuuchfiko.jpeg" alt="image"><br><br>  6. Now the most important thing is to save the project, since it is we who will need it for the subsequent automatic gluing of all subsequent panoramas shot by these two of our two fish cameras.  ‚ÄúFile‚Äù -&gt; ‚ÄúSave As‚Äù -&gt; file name stereopi-template.pto <br><br>  7. Go back to the ‚ÄúAssistant‚Äù tab (if we suddenly left it) and click ‚ÄúCreate panorama ...‚Äù An additional window will open, select the height 1944, the width will be calculated.  LDR Format (output picture format) we set JPEG.  Quality - what you want, by default - 90. Corrections do not touch yet.  Click OK.  Set the file name with the result.  And click "Save." <br><br><img src="https://habrastorage.org/webt/dq/nu/ug/dqnuugzu3rnmuyrev21cnpzcp7q.jpeg" alt="image"><br><br>  8. Another pair of windows will open, one of which will display the process log. <br><br><img src="https://habrastorage.org/webt/sb/hb/bg/sbhbbgmef-068ukos3jaknlmy-w.jpeg" alt="image"><br><br>  9. In the end, you‚Äôll get something like this: <br><br><img src="https://habrastorage.org/webt/sb/hb/bg/sbhbbgmef-068ukos3jaknlmy-w.jpeg" alt="image"><br><br>  <a href="">Full size</a> <br><br>  This is the equidistant projection of our spherical panorama that we need! <br><br><h2>  We transfer stitching on board </h2><br>  But it's all lyrics! <br><br>  We do not want to bathe with each photo, we need to automate this process.  To do this, you will need a project file, which we saved on step 6. We take our project file (I have this <a href="">stereopi-template.pto</a> ) and copy it to a stereo. <br><br>  There we also copy the <a href="">glue</a> script <a href="">stereopi-stich.sh. The</a> script needs two input parameters - the file names of the phishing photo files to be glued into an equidistant projection. <br><br>  But first you need to install all the necessary software on the stereo.  Just download this script and run it on the steropishka.  <a href="">installer.sh</a> <br><br>  Now we run the glue script: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ./stereopi-stich.sh 21.jpg 21-2.jpg Stiching files 21.jpg and 21-2.jpg Generating pto file... Reading /opt/Pano/test1/21-2.jpg... Reading /opt/Pano/test1/21.jpg... Assigned 1 lenses. Written output to /opt/Pano/test1/tmp/project.pto Written output to ./tmp/project.pto number of cmdline args: 1 ================================== Stitching panorama ================================== nona -z LZW -r ldr -m TIFF_m -o 21_21-2-pano -i 0 ./tmp/project.pto nona -z LZW -r ldr -m TIFF_m -o 21_21-2-pano -i 1 ./tmp/project.pto checkpto --generate-argfile= project.pto_21_21-2-pano.arg ./tmp/project.pto enblend --compression=90 -w -f2688x1344 -o 21_21-2-pano.jpg -- 21_21-2-pano0000.tif 21_21-2-pano0001.tif enblend: info: loading next image: 21_21-2-pano0000.tif 1/1 enblend: info: loading next image: 21_21-2-pano0001.tif 1/1 enblend: info: writing final output Bogus input colorspace exiftool -overwrite_original_in_place -TagsFromFile /opt/Pano/test1/21-2.jpg -WhitePoint -ColorSpace -@ /usr/share/hugin/data/hugin_exiftool_copy.arg -@ project.pto_21_21-2-pano.arg 21_21-2-pano.jpg 1 image files updated ================================== Remove temporary files ================================== rm project.pto_21_21-2-pano.arg 21_21-2-pano0000.tif 21_21-2-pano0001.tif</span></span></code> </pre> <br>  The process takes about 50 seconds.  It would be necessary to look for optimization possibilities, but so far so good. <br><br>  The result is a file. <br><br><img src="https://habrastorage.org/webt/hs/pr/7i/hspr7itivnfhaasliblr1zuhuiw.jpeg" alt="image"><br><br>  <a href="">Full size</a> <br><br>  Everything!  We automatically glued the two fish in equidistant!  And the same script can be glued together and all subsequent photos, the main thing is that the mutual placement of our cameras does not change much, and then the gluing will go. <br><br>  Now you need it vpendyurit somewhere on the site.  To view our panorama on the site you need a panoramic player. <br><br>  IMHO, the best embedded player for panoramas - KRPano.  It can both photo and video.  Yes, paid.  I already bought a license for it five years ago, but then the player was made on a flash and HTML5 could not.  And now he can, but you need to buy a license again. <br><br>  You can download <a href="">my archivist</a> , where inside is already everything you need to <a href="http://www.g0l.ru/test/stereopi/pano1/">see this</a> .  The most nishtyak is Little Planets (choice of viewing mode - right-click). <br><br><img src="https://habrastorage.org/webt/al/uc/8u/aluc8urvbvd9__ro_6syw1jfzxs.jpeg" alt="image"><br><br>  We hope that our experiment will be not only interesting for you, but also useful as a recipe.  Thanks for attention! <br><br><h2>  Useful links: </h2><br>  <a href="https://wiki.panotools.org/Equirectangular_Projection">Equirectangular projection</a> <br>  <a href="http://paulbourke.net/dome/dualfish2sphere/">A lot of theory on phishing and equidistant projection</a> <br>  <a href="https://wiki.panotools.org/Panorama_Viewers">Software for viewing panoramas</a> <br>  <a href="http://hugin.sourceforge.net/docs/manual/Panorama_scripting_in_a_nutshell.html">Large manual for automatic gluing</a> <br>  <a href="https://github.com/BrianBock/360-camera">BrianBock / 360-camera</a> </div><p>Source: <a href="https://habr.com/ru/post/432898/">https://habr.com/ru/post/432898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432886/index.html">How to pump a product team: culture, experiments and structure</a></li>
<li><a href="../432888/index.html">How Heisenbug works</a></li>
<li><a href="../432892/index.html">Search results for your search: fuzzy search implementation</a></li>
<li><a href="../432894/index.html">December 19, Moscow - OpsFormations</a></li>
<li><a href="../432896/index.html">AXIS P1425-LE Mk II vs IDIS DC-T3233HRXL: Compare CCTV Cameras</a></li>
<li><a href="../432900/index.html">Features of work in an international team. Japan</a></li>
<li><a href="../432902/index.html">Failed flight to the moon: what does the previously unknown recording of the Soviet mission Zond-6 tell us</a></li>
<li><a href="../432904/index.html">The best employers in IT 2018: the annual rating of "My Circle"</a></li>
<li><a href="../432906/index.html">Editing CSV-files, so as not to break the data</a></li>
<li><a href="../432908/index.html">Russia plans to introduce additional control over payments on the Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>