<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Petya.A, Petya.C, PetrWrap or PetyaCry? New virus threat for companies in Russia and Ukraine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, we released an article on integrated proactive protection against targeted attacks and encryption viruses, which included the latest ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Petya.A, Petya.C, PetrWrap or PetyaCry? New virus threat for companies in Russia and Ukraine</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, we released an article on integrated proactive protection against targeted attacks and encryption viruses, which included the latest major virus infections of malware such as Ransomware. We can add another example to the piggy bank. <br><br>  June 27, 2017 registered a massive hacker attack on servers and workstations of networks of large Russian, Ukrainian companies and organizations around the world, the list of which is being replenished continuously and more and more similar photos appear on social networks: <br><br><img src="https://habrastorage.org/web/17d/e17/9ff/17de179ff9204d5ab59acd8030e1b464.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The virus is a modification of the 2016 extortioner Petya.A / Petya.C, which has been acclaimed in 2016.  The new Petya.C virus is spreading in several ways: <br><br><ul><li>  by exploiting vulnerabilities in SMB MS17-010 (similar to the May Wanna Cry); </li><li>  by directed emailing malware </li><li>  vulnerability used to execute malicious code: <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0199">CVE-2017-0199</a> </li><li>  used vulnerability to spread and infect: <a href="https://www.cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2017-0144">CVE-2017-0144</a> , aka EternalBlue </li></ul><a name="habracut"></a><br>  When a user opens malware attached to an e-mail disguised as a document (these can be Order-20062017.doc files (or another date), myguy.xls, or modifications), the computer calls <a href="http://84.200.0.16/">84.200.16</a> [.] 242, downloading the malicious the Myguy.xls file to the root of the C: \ drive.  After downloading, the following operations occur: <br><br><ul><li>  opening a malicious file using the utility C: \ Windows \ System32 \ mshta.exe; </li><li>  cipher loader download at <a href="http://french-cooking/">french-cooking</a> [.] com; </li><li>  Files appear on the computer: C: \ Windows \ perfc.dat, C: \ myguy.xls.hta </li><li>  connecting the infected computer to the addresses <a href="http://111.90.0.139/">111.90.139</a> [.] 247, <a href="http://coffeeinoffice/">coffeeinoffice</a> [.] xyz; </li><li>  spreading the virus over the network through TCP ports: 1024-1035, 135, 445 using the vulnerability CVE-2017-0144; </li><li>  infection MBR (master boot record Windows).  If the MBR infection is successful (for this, the virus needs to obtain local administrator privileges, which allows to realize a known vulnerability in SMB), the computer issues a blue screen of death Windows and reboots, the encrypter loads on reboot and the encryption of the entire hard disk begins the screen with the standard procedure for analyzing the hard disk in Windows in case of an unexpected failure is displayed - Check Disk. <br><br><img src="https://habrastorage.org/web/0ed/d83/d9f/0edd83d9f147495b9d8949a72cef4bd7.jpg"><br><br>  In case the virus fails to obtain local administrator rights and infect the MBR partition, it launches the file encryption utility on the disk, with the exception of the Windows system directory, as well as folders containing browser files (unlike WannaCry, which scanned the system and encrypted certain files). formats), similar to the behavior of the old extortionist Mischa - this behavior was observed in laboratory studies, the vast majority of victims were subjected to full disk encryption and blocking access to the system after restarting  ki. </li></ul><br>  After the reboot, the user is shown a window demanding payment of $ 300 in Bitcoin equivalent to the wallet 1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX.  At 23:30, the attackers had already transferred 3.277 BTC (paid by 31 people), at the current rate (at the time of publication, 1 BTC is equivalent to $ 2,409) it is $ 7894. <br><br><h3>  How to protect yourself from data encryption? <br></h3><br>  The first step is to update the anti-virus software signatures on servers and workstations (if anti-virus software is available) - the signature database should be updated on 06/27/2017 no earlier than 20:00 (the first mentions of adding Petya.C to the signature database started arriving at 19h).  Here is a list of malicious files and their hash values: <br><br><ul><li>  Order-20062017.doc file, size 6215 bytes, SHA1: 101CC1CB56C407D5B9149F2C3B8523350D23BA84, MD5: 415FE69BF </li><li>  32634CA98FA07633F4118E1, SHA256: FE2E5D0543B4C8769E401EC216D78A5A3547DFD426FD47E097DF04A5F7D6D206; </li><li>  file myguy.xls, size is 13893 bytes, SHA1: 736752744122A0B5EE4B95DDAD634DD225DC0F73, MD5: 0487382A4DAF8EB9660F1C67E30F8B25, EE29B9C01318A1E23836B9494Pfeyfends; </li><li>  bcpd </li></ul><br>  On already infected systems, the specified files are located in the file system in the following folders: <br><br><ul><li>  C: \ Windows \ perfc.dat </li><li>  C: \ myguy.xls.hta </li><li>  % APPDATA% \ 10807.exe </li></ul><br>  In the malware's code, experts found an interesting opportunity to protect against Petya.C by manually creating the C: \ Windows \ perfc.dll file using a standard Notepad. <br><br>  In addition to updating antivirus software, we recommend that you apply additional protection measures: <br><br><ul><li>  Manually block requests to resources on the Internet (brackets near points are inserted so that there are no hyperlinks): <br><br>  - 84.200.16 [.] 242 <br>  - 84.200.16 [.] 242 / myguy.xls <br>  - french-cooking [.] Com / myguy.exe <br>  - 111.90.139 [.] 247 <br>  - COFFEINOFFICE [.] XYZ <br><br></li><li>  If there are already infected workstations or servers on the network, you should disable TCP ports 1024-1035, 135 and 445. </li><li>  If the workstation is already infected and the user sees the ‚Äúblue screen of death for Windows‚Äù, the computer starts to reboot itself by running the Check Disk utility, it is <u>urgent to turn it off via power</u> , in this case the data on the hard disk <u>will not be encrypted</u> . </li><li>  Install security update for Windows KB4013389 dated March 14, 2017 (see Microsoft Security Bulletin MS17-010).  Download the update <a href="https://technet.microsoft.com/en-us/library/security/ms17-010.aspx">by the link</a> . <br>  On computers with outdated Windows XP and Windows 2003, you need to install security patches manually by downloading them from direct links: <br><br>  - <a href="">Windows XP SP3</a> <br>  - <a href="">Windows Server 2003 x86</a> <br>  - <a href="">Windows Server 2003 x64</a> <br></li><li>  Install security update for Microsoft Office.  Download updates for your version <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0199">by the link</a> . </li><li>  If it is impossible to install security updates, disable the SMB v1 / v2 / v3 protocol on workstations and servers in accordance with the <a href="https://support.microsoft.com/en-us/help/2696547/how-to-enable-and-disable-smbv1,-smbv2,-and-smbv3-in-windows-vista,-windows-server-2008,-windows-7,-windows-server-2008-r2,-windows-8,-and-windows-server-2012">instructions</a> . </li><li>  If you have NGFW / NGTP / IPS protection, configure blocking attacks that exploit EternalBlue (MS17-010) </li></ul><br><h3>  What to do after infection? </h3><br>  In no case do not transfer money to the account of the attackers, their email is blocked, and in any case you will not be able to recover the data in this way. <br>  When infecting a workstation / server on the network, it is necessary to take appropriate measures to eliminate malware: <br><br><ul><li>  Disconnect the infected machine from the local network; </li><li>  When an MBR is infected, in some cases it is possible to recover using bootrec / RebuildBcd, bootrec / fixMbr, bootrec / fixboot; </li><li>  If there is no backup, make a backup of the encrypted disk (if a decoder appears, data can be restored. Hope is instilled by the previous XData malware extortionist previous large-scale attack in Ukraine - the creator of the virus published the encryption keys a few days after the spread of the virus, promptly appeared Software for data decryption); </li><li>  Boot from the boot disk / flash drive, install the system, fully formatting the encrypted hard drive; </li><li>  Install the latest Windows security updates ( <a href="https://technet.microsoft.com/en-us/library/security/ms17-010.aspx">KB4013389 is required</a> ); </li><li>  Install antivirus software, update the signature database; </li><li>  Restore data from backup (in case of backup of unencrypted data, before infection). </li></ul><br>  Data from hard drives encrypted with the old Petya virus was recovered <a href="https://www.bleepingcomputer.com/news/security/petya-ransomwares-encryption-defeated-and-password-generator-released/">as follows</a> .  The descrambler for the old version of Petya was published <a href="https://github.com/leo-stone/hack-petya">on Github</a> .  Decoder for the new version of Petya.C yet. <br><br><h3>  Detection of the spread of the virus over the network </h3><br>  In the course of distribution over the network, a version of the Microsoft Windows Sysinternals tool, PsExec, is supposedly used. <br><br>  There is a SIGMA rule for detecting PsExec usage, it can be automatically converted to a Splunk and ElasticSearch request: <br><br><blockquote>  title: PsExec tool execution on destination host <br>  status: experimental <br>  description: Detect PsExec installation and execution events (service and Sysmon) <br>  author: Thomas Patzke <br>  reference: <a href="https://www.jpcert.or.jp/english/pub/sr/ir_research.html">www.jpcert.or.jp/english/pub/sr/ir_research.html</a> <br>  logsource: <br>  product: windows <br>  detection: <br>  service_installation: <br>  EventID: 7045 <br>  ServiceName: 'PSEXESVC' <br>  ServiceFileName: '* \ PSEXESVC.exe' <br>  service_execution: <br>  EventID: 7036 <br>  ServiceName: 'PSEXESVC' <br>  sysmon_processcreation: <br>  EventID: 1 <br>  Image: '* \ PSEXESVC.exe' <br>  User: 'NT AUTHORITY \ SYSTEM' <br>  condition: service_installation or service_execution or sysmon_processcreation <br>  falsepositives: <br>  - unknown <br>  level: low </blockquote><br><h3>  An epidemic again? </h3><br>  The reason for the wide spread of the virus is the failure to implement the basic necessary measures to protect against targeted attacks of this kind: <br><br><ul><li>  timely update of system software; </li><li>  raising awareness of employees in the field of information security and the formation of the principles of safe work with email. </li></ul><br>  Organizational measures cannot provide reliable and effective protection against targeted attacks and extortionate software; therefore, a set of technical measures is required, which we described in our previous article. <br><br>  <i>Author: Evgeny Borodulin, Chief Architect, Informzaschita</i> <i><br></i>  <i>e.borodulin@infosec.ru</i> </div><p>Source: <a href="https://habr.com/ru/post/331788/">https://habr.com/ru/post/331788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331776/index.html">SD-WAN "on the fingers": pros, cons, pitfalls</a></li>
<li><a href="../331778/index.html">As we wrote a strategic clicker on the hackathon ReactRiot</a></li>
<li><a href="../331780/index.html">It's time to throw! Migration Experience from Objective-C to Swift</a></li>
<li><a href="../331784/index.html">Million WebSocket and Go</a></li>
<li><a href="../331786/index.html">The problem of continuous protection of web applications. View from the side of researchers and operators</a></li>
<li><a href="../331790/index.html">Early bury java</a></li>
<li><a href="../331792/index.html">IT & City Android hackathon in Nizhny Novgorod</a></li>
<li><a href="../331794/index.html">"Now he counted you" or Data Science from Scratch</a></li>
<li><a href="../331796/index.html">Leaflet 1.xx vs Openlayers 4.xx Part 1. Source Code</a></li>
<li><a href="../331800/index.html">Interesting Factorio Study: Plant Simulator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>