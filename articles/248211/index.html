<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple acceptance of bank card payments in Windows Universal Apps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2013, PayOnline, with the support of Microsoft, released the PayOnline Payment SDK . This allowed developers of mobile applications under Windows (...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple acceptance of bank card payments in Windows Universal Apps</h1><div class="post__text post__text-html js-mediator-article">  In 2013, PayOnline, with the support of Microsoft, <a href="http://habrahabr.ru/company/payonline/blog/195854/">released the PayOnline Payment SDK</a> .  This allowed developers of mobile applications under Windows (at that time - under the Windows Store and Windows Phone) to integrate payment acceptance into applications in a matter of minutes.  In this post we will briefly talk about the Payment SDK, its transition to Universal Apps, and the support of recurrent (regular) payments in applications that have appeared. <br><br><img src="https://habrastorage.org/files/385/525/e41/385525e41f68496ca6b7d680d85bcd3d.jpg"><br><a name="habracut"></a><habracut text="  Payment SDK -  ."><br><br>  The video from one of Windows Camp, where PayOnline‚Äôs team lead showed a bit of ‚Äústreet magic‚Äù, helps to understand what the PayOnline Payment SDK is: showed in real-time how the SDK is integrated into the application and conducted a test transaction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/HCwzHHTkupI%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhhSVCoKl15SF8w3_7szRTaNLa7_NQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Since then, Microsoft has the opportunity to create Universal Apps - applications adapted for use on both smartphones and desktops.  As promised by Microsoft's guideline, the transition was easy and quick (we‚Äôll talk about this later). <br><br>  Also in 2014, our SDK received support for recurring payments (regular payments initiated by the payer and debited from the payer's card without its participation).  This type of payment is strongly recommended to use services that operate on the basis of a paid subscription model: the payer will be able to acquire card data once and agree to automatic deductions once, for example, in a quarter. <br><br>  First things first. <br><br><h1>  WHY DEVELOP A PAYMENT SDK APP? </h1><br>  PayOnline provides Internet acquiring services for sites and applications that have commercial functionality ‚Äî that is, legally allowed goods and services that sell money.  To integrate payment acceptance into mobile applications, in the early 2010s, a Pay-Mobile payment solution was developed.  Since then, we have been constantly engaged in simplifying the connection procedure both from a technical and operational point of view.  One of the tasks aimed at simplifying technical integration is the implementation of the Payment SDK for popular mobile platforms. <br><br>  Like any ‚Äúadult‚Äù payment service provider, PayOnline has its own API.  We transfer it to the developers, and from the received ‚Äúdesigner‚Äù they build on their side that part of the payment service that will be responsible for the interaction of the payer and the acquiring bank. <br><br>  Internet acquiring is a method of receiving money on the Internet, and, accordingly, fraud protection technologies have been developed taking into account the specifics of the Internet.  One of the methods of protection is the 3-D Secure protocol proposed by the global VISA payment system and adopted as a standard by other payment systems. <br><br><div class="spoiler">  <b class="spoiler_title">How 3D Secure Works</b> <div class="spoiler_text">  Most often, the 3-D Secure protocol at work looks like this: you make a payment on the website or in a store, enter the card details, then go to the issuing bank page, where you enter the code received in the SMS.  After that, your payment is successfully completed. <br><br>  The name 3-D comes from 3-Domain (three domains), as organizations in three domains participate in the verification of payment under this protocol: issuer domain (payer and issuing bank), acquirer domain (payment processing bank, and online store) ) and domain interaction (MPS).  This is a simplified scheme for verifying payment under the 3-D Secure protocol: <br><img src="https://habrastorage.org/files/a78/921/261/a7892126153046b98c0a4637e037003b.jpg"><br>  The payer enters these cards in the online store, they reach the acquiring bank (1), go to the IPU (2), from where they are sent to the issuing bank (3).  You can find out which bank has issued the card by the first six digits of the card number.  The issuing bank informs that the card is subscribed to 3-D Secure, forms a unique code, as well as a link to the code entry page (4).  The link is returned to the MSP or IPSP (5), which redirect the cardholder‚Äôs browser to this page (6.7).  At this moment, the issuer sends the cardholder through another channel (for example, via SMS) the code that he enters on the page.  If the code is entered correctly, the issuing bank informs about the successful completion of the check (8), and the funds are debited from the payer's card (9, 10). </div></div><br>  The simplest form of payment acceptance integration in mobile applications is the built-in browser.  You need to embed a browser to display the payment page of the acquiring bank or payment gateway - and the page for entering the verification confirmation code 3-D Secure.  But what if you make a full-fledged native application and do not want to embed browser support? <br><br>  In this case, the API that we wrote above comes to the rescue.  But when using the API, a significant amount of work on integrating the application with the payment gateway falls on the shoulders of the application developer, especially with regard to the implementation of the 3-D Secure protocol. <br><br>  And here we come to the most interesting - the description of the SDK, which allows you to quickly and smoothly integrate card payments into applications. <br><br><h1>  FIELD NOTES: USING PAYMENT SDK </h1><br><h2>  Code example </h2><br>  Consider sample code for a Windows Store application.  It is enough to ensure acceptance of payments in the application. <br><br><div class="spoiler">  <b class="spoiler_title">See sample code</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration { MerchantId = <span class="hljs-number"><span class="hljs-number">1</span></span>, Key = <span class="hljs-string"><span class="hljs-string">"PrivateKey"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PayRequest { Amount = <span class="hljs-number"><span class="hljs-number">30</span></span>m, Currency = Currency.Rub, OrderId = <span class="hljs-string"><span class="hljs-string">"335636462808"</span></span>, CardExpMonth = <span class="hljs-number"><span class="hljs-number">1</span></span>, CardExpYear = <span class="hljs-number"><span class="hljs-number">2018</span></span>, CardCvv = <span class="hljs-number"><span class="hljs-number">100</span></span>, CardHolderName = <span class="hljs-string"><span class="hljs-string">"CARD HOLDER"</span></span>, CardNumber = <span class="hljs-string"><span class="hljs-string">"4111111111111111"</span></span>, Email = <span class="hljs-string"><span class="hljs-string">"cardholder@example.com"</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> po = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Processing(conf); po.ThreeDs += po_ThreeDs; po.Success += po_Success; po.Decline += po_Decline; po.Error += po_Error; po.Pay(request); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">po_Error</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, Exceptions.PaymentSDKException e</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">po_Decline</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PayResponse e</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">po_Success</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PayResponse e</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">po_ThreeDs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PayResponse e</span></span></span><span class="hljs-function">)</span></span> { ((Processing)sender).NavigateToAcsUrl(Browser, e); } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Configuration</span></span> : <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MerchantId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Key { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> </div></div><br><h2>  What's going on here </h2><br>  To make a payment, you must use the Processing object ‚Äî the receiving object, which must implement the IConfiguration interface.  The implementation is very simple, two fields: your ID and secret key, which is issued when you connect. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Configuration</span></span> : <span class="hljs-title"><span class="hljs-title">IConfiguration</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MerchantId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Key { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  <b>The Processing object provides four events:</b> <br><ul><li>  Success - occurs in case of successful payment. </li><li>  Decline - occurs in case of failure to conduct. </li><li>  Error - if at the time of the payment any errors occurred, for example, the network is unavailable. </li><li>  ThreeDs - you need to undergo additional testing on 3-D Secure. </li></ul><br>  In the latter case, it is necessary to show the user of the issuing bank page to enter a code or password, and process the response.  You can do everything manually, or you can use the NavigateToAcsUrl method, which takes as parameters a user control ‚Äî a browser (it has its own for each platform) and a PayResponse object. <br><br>  <b>Finally, to call the Pay method, it needs to pass a PayRequest object containing the fields:</b> <br><ul><li>  Amount - amount of payment. </li><li>  Currency - currency (supported rubles, US dollars and euros). </li><li>  OrderId - ID of the order that you generate in your system. </li><li>  CardExpMonth - month of expiration of the card. </li><li>  CardExpYear - the year of expiry of the card. </li><li>  CardCvv - CVC2 / CVV2. </li><li>  CardHolderName is the name of the cardholder. </li><li>  CardNumber - card number. </li><li>  Email - the payer's e-mail. </li></ul><br><h2>  One-click and regular payments </h2><br>  In 2014, support for recurrent payments was added to the SDK (Rebill technology).  Rebill technology allows you to organize regular acceptance of payments in your application: automatic cancellation for services, renewal of subscriptions, etc. <br><br>  <b>The technology can be used in two modes:</b> <br><ol><li>  The user once agrees to the terms of the automatic debiting of funds (for example: 100 rubles every 3 months), enters the card details and makes the first payment.  Further write-offs are made without the participation of the client. </li><li>  The user enters the data card when you first pay in the application.  Further payments are made without entering the card data, but with the participation of the payer.  There may be a 3D Secure protocol check or CVV input, depending on the settings. </li></ol><br><h2>  Interface </h2><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rebill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RebillRequest request</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  The following describes what a recurring payment request looks like. <br><table border="1" cellpadding="5" width="700"><tbody><tr><th align="left" width="120">  Property <br></th><th align="left" width="100">  Type of <br></th><th align="left">  Description <br></th></tr><tr><th align="left">  RebillAnchor <br></th><td align="left">  line <br></td><td align="left">  Link to the transaction to make a second payment <br></td></tr><tr><th align="left">  OrderId <br></th><td align="left">  line <br></td><td align="left">  Order ID in your system <br></td></tr><tr><th align="left">  Amount <br></th><td align="left">  decimal <br></td><td align="left">  Re-debit amount <br></td></tr><tr><th align="left">  Currency <br></th><td align="left">  currency <br></td><td align="left">  Recurring currency <br></td></tr></tbody></table><br><h2>  Universal Apps Support </h2><br>  With the advent of Microsoft's ability to create <a href="http://dev.windows.com/en-us/develop/building-universal-windows-apps">Universal Apps</a> , applications that work equally on both the Windows 8.1 platform and the Windows Phone 8 platform, we have prepared an updated SDK with Universal Apps support. <br><br>  You can independently familiarize yourself with the code of the Windows Universal App demo application, which includes the <a href="http://www.payonline.ru/developers/SDK/WinPhone/">PayOnline Payment SDK</a> . <br><br><h2>  Transition to Universal Apps technology </h2><br>  Problems with the transition to a new technology did not arise.  After we made a new branch of our SDK, it took only three steps: <br><br><h5>  After downloading the project, the studio offered to add support for Windows 8.1. </h5><br><img src="https://habrastorage.org/files/1f9/c92/bd3/1f9c92bd36064fd99faaa6bce6d6c355.jpg"><br><br><h5>  Solution Explorer selected Retarget Windows Store projects to Windows 8.1 </h5><br><img src="https://habrastorage.org/files/21d/c51/747/21dc51747bd64b8081f3b97e47cbd3ec.png"><br><br><h5>  Then, in the properties of the project, in the Targeting property, we selected support for Windows 8.1 and Windows Phone 8.1 </h5><br><img src="https://habrastorage.org/files/c24/ac8/648/c24ac8648f8e4f9fbc4a516b366579c7.png"><br><br>  After rebuilding, it was only necessary to eliminate a couple of comments about obsolete methods. <br><br><h2>  About development plans Payment SDK </h2><br>  Now we are actively engaged in the technology of p2p transfers, which allows owners of applications and sites to earn on payments made between users (transfer of funds from card to card).  The technology can be useful for trading floors, bulletin boards, labor exchanges, crowdfunding organizations, micro-credit services, etc. <br><br>  We plan to integrate the p2p technology into the PayOnline Payment SDK in the first half of 2015, and we will immediately notify the mobile application development community. </habracut></div><p>Source: <a href="https://habr.com/ru/post/248211/">https://habr.com/ru/post/248211/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248199/index.html">7 secrets of successful trading on Amazon</a></li>
<li><a href="../248201/index.html">Cisco information security in 2014: a brief summary</a></li>
<li><a href="../248203/index.html">Test Automation with Ruby and WATIR</a></li>
<li><a href="../248205/index.html">PHDays V: Botnet Detection, NFC Stunts, and ‚ÄúSocial Engineers‚Äù Competitions</a></li>
<li><a href="../248207/index.html">Xargs: a variety of use cases</a></li>
<li><a href="../248213/index.html">The path from beginner to pro: CMS development on the Kohana 3.3 framework</a></li>
<li><a href="../248215/index.html">7 common mistakes when designing a checkout process</a></li>
<li><a href="../248217/index.html">Try / Catch / Finally</a></li>
<li><a href="../248219/index.html">Home automation with openHAB: lighting and remote control of heaters. Part 1</a></li>
<li><a href="../248225/index.html">Yandex investigation: full disclosure about the virus on Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>