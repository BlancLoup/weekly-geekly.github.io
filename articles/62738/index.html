<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Image filtering by convolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of this topic is Habrayuzer Popik, who himself can not post this topic for astral reasons. 

 Introduction 
 Probably, the majority of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Image filtering by convolution</h1><div class="post__text post__text-html js-mediator-article">  The author of this topic is Habrayuzer Popik, who himself can not post this topic for astral reasons. <br><br><h2>  Introduction </h2><br><img src="http://ipicture.ru/uploads/090623/KgSRWLxxWc.jpg" align="right">  Probably, the majority of the HF community knows firsthand about image processing filters, such as blurring, sharpening, edge detection, embossing, and so on.  Some worked more closely with them, some used them for granted.  However, do they all know how exactly the image is filtered, and what is common between the listed filters?  In this topic, I will try in general terms to describe the algorithm by which all this is done, as well as give its implementation. <br><br><a name="habracut"></a><br><h2>  A bit of theory. </h2><br>  So, the filters that have been listed, as well as many others, are based on <u>convolution</u> .  What is convolution?  A convolution is an operation that shows the ‚Äúsimilarity‚Äù of one function to a reflected and shifted copy of another.  The concept of convolution is generalized for functions defined on groups, as well as measures.  A bit complicated definition, isn't it?  Those who are interested in the mathematical theoretical part can look at the link to <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%2591%25D1%2580%25D1%2582%25D0%25BA%25D0%25B0_(%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7)">Wikipedia</a> , and, perhaps, learn something useful for themselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will try to give my definition-explanation of the convolution ‚Äúon the fingers‚Äù only for the case of image processing, which may not be as clever and accurate as in the scientific literature, but it seems to me that allows us to understand the essence of this process. <br><br>  So, convolution is the operation of calculating the new value of the selected pixel, taking into account the values ‚Äã‚Äãof the surrounding pixels.  A matrix called <i>convolution kernel is</i> used to calculate the value.  Usually, the convolution kernel is a square matrix n * n, where n is odd, but nothing prevents to make the matrix rectangular.  During the computation of the new value of the selected pixel, the convolution kernel is ‚Äúapplied‚Äù by its center (the oddness of the matrix size is important here) to this pixel.  The surrounding pixels are also covered by the core.  Next, the sum is calculated, where the items are the product of the pixel values ‚Äã‚Äãand the cell values ‚Äã‚Äãof the core that covered the pixel.  The sum is divided by the sum of all elements of the convolution kernel.  The resulting value is just the new value of the selected pixel.  If we apply convolution to each pixel of the image, the result will be some effect depending on the selected convolution kernel. <br><br>  This concludes the theory and proceeds to the examples and the implementation of this algorithm.  Is the brain still alive?  :) <br><br><h2>  A few examples. </h2><br><img src="http://ipicture.ru/uploads/090623/g5dh3PzVII.jpg"><br><img src="http://ipicture.ru/uploads/090623/7SThe03STs.jpg"><br><img src="http://ipicture.ru/uploads/090623/iED6ywC3vX.jpg"><br><img src="http://ipicture.ru/uploads/090623/cdtiJYiciy.jpg"><br><br><h2>  The implementation of the algorithm. </h2><br>  I will give only the main part of the C # code, the complete source code for the convolution and a small program for visual testing can be downloaded from the link at the end of the article.  I will make a reservation in advance that the code was not written as something very optimal, and there is still a field for optimizations.  For example, you can increase the speed using pre-calculated pixel values, but this is not the point. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> Convolution <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#2B91AF">Bitmap</font> Apply( <font color="#2B91AF">Bitmap</font> input, <font color="#0000ff">double</font> [,] kernel) <br> { <br> <font color="#008000">//  </font> <br> <font color="#0000ff">byte</font> [] inputBytes = BitmapBytes.GetBytes(input); <br> <font color="#0000ff">byte</font> [] outputBytes = <font color="#0000ff">new</font> <font color="#0000ff">byte</font> [inputBytes.Length]; <br> <br> <font color="#0000ff">int</font> width = input.Width; <br> <font color="#0000ff">int</font> height = input.Height; <br> <br> <font color="#0000ff">int</font> kernelWidth = kernel.GetLength(0); <br> <font color="#0000ff">int</font> kernelHeight = kernel.GetLength(1); <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> x = 0; x &lt; width; x++) <br> { <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> y = 0; y &lt; height; y++) <br> { <br> <font color="#0000ff">double</font> rSum = 0, gSum = 0, bSum = 0, kSum = 0; <br> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; kernelWidth; i++) <br> { <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> j = 0; j &lt; kernelHeight; j++) <br> { <br> <font color="#0000ff">int</font> pixelPosX = x + (i - (kernelWidth / 2)); <br> <font color="#0000ff">int</font> pixelPosY = y + (j - (kernelHeight / 2)); <br> <font color="#0000ff">if</font> ((pixelPosX &lt; 0) || <br> (pixelPosX &gt;= width) || <br> (pixelPosY &lt; 0) || <br> (pixelPosY &gt;= height)) <font color="#0000ff">continue</font> ; <br> <br> <font color="#0000ff">byte</font> r = inputBytes[3 * (width * pixelPosY + pixelPosX) + 0]; <br> <font color="#0000ff">byte</font> g = inputBytes[3 * (width * pixelPosY + pixelPosX) + 1]; <br> <font color="#0000ff">byte</font> b = inputBytes[3 * (width * pixelPosY + pixelPosX) + 2]; <br> <br> <font color="#0000ff">double</font> kernelVal = kernel[i, j]; <br> <br> rSum += r * kernelVal; <br> gSum += g * kernelVal; <br> bSum += b * kernelVal; <br> <br> kSum += kernelVal; <br> } <br> } <br> <br> <font color="#0000ff">if</font> (kSum &lt;= 0) kSum = 1; <br> <br> <font color="#008000">//  </font> <br> rSum /= kSum; <br> <font color="#0000ff">if</font> (rSum &lt; 0) rSum = 0; <br> <font color="#0000ff">if</font> (rSum &gt; 255) rSum = 255; <br> <br> gSum /= kSum; <br> <font color="#0000ff">if</font> (gSum &lt; 0) gSum = 0; <br> <font color="#0000ff">if</font> (gSum &gt; 255) gSum = 255; <br> <br> bSum /= kSum; <br> <font color="#0000ff">if</font> (bSum &lt; 0) bSum = 0; <br> <font color="#0000ff">if</font> (bSum &gt; 255) bSum = 255; <br> <br> <font color="#008000">//    </font> <br> outputBytes[3 * (width * y + x) + 0] = ( <font color="#0000ff">byte</font> )rSum; <br> outputBytes[3 * (width * y + x) + 1] = ( <font color="#0000ff">byte</font> )gSum; <br> outputBytes[3 * (width * y + x) + 2] = ( <font color="#0000ff">byte</font> )bSum; <br> } <br> } <br> <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> BitmapBytes.GetBitmap(outputBytes, width, height); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <a href=""><strong>Download program sample</strong></a> <br><br>  That's all.  I hope that this material was useful and gave you something new.  If you are interested in this topic, I can write more about the basic methods of forming convolution kernels, as well as about optimizing this algorithm.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/62738/">https://habr.com/ru/post/62738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62723/index.html">Seven-inch netbook Kohjinsha SK3 UMPC</a></li>
<li><a href="../62725/index.html">Image Bluetooth Nica Headset</a></li>
<li><a href="../62726/index.html">Play with Sid Meier</a></li>
<li><a href="../62731/index.html">Yandex robot takes into account wishes</a></li>
<li><a href="../62737/index.html">MonkeyLectric</a></li>
<li><a href="../62739/index.html">Man-Gryzlov</a></li>
<li><a href="../62744/index.html">Creating a GWT application with GWT-Ext controls running on JBoss using NetBeans. Step by step</a></li>
<li><a href="../62748/index.html">The benefits of monitoring critical backend URLs</a></li>
<li><a href="../62750/index.html">Coming soon ICFPC 2009</a></li>
<li><a href="../62754/index.html">Olympiad on Habr√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>