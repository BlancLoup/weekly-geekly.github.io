<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring access level switches in the provider's network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the article I will talk about how we (a small regional provider) configure access level switches. 

 In the beginning, briefly go over what the hie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring access level switches in the provider's network</h1><div class="post__text post__text-html js-mediator-article">  In the article I will talk about how we (a small regional provider) configure access level switches. <br><br>  In the beginning, briefly go over what the hierarchical model of building a network is, what functions are recommended to hang at each level and how exactly the network is arranged, using which I will set out the switch configuration for example.  Well, and then configure the switch based on the proposed requirements. <br><a name="habracut"></a><br><h5>  Hierarchical network building model </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/f68/9b4/d7f/f689b4d7f9342789b36e93dbaf408db9.jpg" alt="image"><br>  And so, in a hierarchical model of building a switching network, there are three levels - an access layer (access layer), an <b>aggregation level</b> (distibution layer) and a core layer.  The division into levels allows you to achieve greater ease of handling the network: simplifies network scalability, it is easier to configure devices, it is easier to introduce redundancy, to design a network, and the like. <br><br>  Each level requires a certain set of functions, so at the access level (in the provider‚Äôs network) devices are required <br><ul><li>  Connecting end users at 100 Mbps </li><li>  Connection (preferably via SFP) to a switch distribution level at 1 Gbit / s </li><li>  VLAN support </li><li>  Port security support </li><li>  Acl support </li><li>  Support for other security features (loopback detection, storm control, bpdu filtering, etc.) </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With reference to the provider network, the following picture is obtained: <br><br><ul><li>  <b>Residential building</b> - access level switch </li><li>  <b>Microdistrict</b> - switch distribution level, we connect individual houses to it </li><li>  <b>DPC</b> - core level switch, we connect individual neighborhoods to it </li></ul><br><br>  At the ditribtution level and, especially, at the core level, as a rule, advanced <b>Cisco</b> and / or <b>Juniper</b> switches work, but at the access level you have to install cheaper hardware.  As a rule, this is <b>D-Link</b> (or <b>Linksys</b> or <b>Planet</b> ). <br><br><h5>  A few words about the network device </h5><br>  And so, with the access level in the first approximation, we figured out, now, before proceeding to directly setting up the switch, a few words about how the network in which the switch has to work is arranged. <br><br>  First, we do not use VLAN per user.  The network is quite old and began to be built at a time when Q-in-Q was not yet a standard, so most of the old equipment does not support double tagging. <br>  Secondly, we use PPPoE.  And do not use DHCP.  That is, the client receives one white address, through the PPP protocol, the home network is missing as a class. <br>  Thirdly, all switches live in a separate VLAN allocated only for them, all home PPPoE clients also live in one VLAN. <br><br><h5>  Switch Setup </h5><br>  As an experimental switch I will use <a href="http://dlink.ru/ru/products/1/1277.html">D-Link DES-3200-10</a> , because <br><ol><li>  In our city, D-Link is the easiest to buy, so this brand is preferred over Planet, Linksys and other competitors. </li><li>  This switch has all the functionality we need. </li></ol><br><br>  And so, let's go.  All commands are given for the above model D-Link, however, it will be easy to do the same thing on the device of another vendor. <br><br>  Based on the above requirements for the access level switch, we will formulate what we want to configure on it and do it. <br><br>  And so, on the need ... <br><br>  Create two VLANs, one for clients, the other for controlling the switch and assign them to the switch ports.  100 megabit ports - client, gigabit ports - uplinks. <br> <code>create vlan USER tag 2 <br> create vlan MANAGEMENT tag 3 <br> config vlan USER add untagged 1-8 <br> config vlan USER add tagged 9-10 <br> config vlan MANAGEMENT add tagged 9-10 <br></code> <br>  Configure port security by banning more than one mac address on the port (this way we are fighting an undesirable and potentially dangerous situation when a client connects to the provider's network not a router, but a switch, merging the broadband domain of his home network with the broadband domain of the provider) <br> <code>config port_security ports 1-8 admin_state enable max_learning_addr 1 lock_address_mode DeleteOnTimeout <br></code> <br>  Prohibit STP on client ports so that users cannot spoil packets with BPDU provider <br> <code>config stp version rstp <br> config stp ports 1-8 fbpdu disable state disable <br></code> <br>  Configure loopback detection so that 1) buggy network cards that reflect packets back and 2) users who create rings on the second level in their apartment do not interfere with the network <br> <code>enable loopdetect <br> config loopdetect recover_timer 1800 <br> config loopdetect interval 10 <br> config loopdetect ports 1-8 state enable <br> config loopdetect ports 9-10 state disable <br></code> <br>  Create acl that will prevent non-PPPoE packets from passing to USER vlan (blocking DHCP, IP, ARP and all other unnecessary protocols that allow users to communicate directly with each other, ignoring the PPPoE server). <br> <code>create access_profile ethernet vlan 0xFFF ethernet_type profile_id 1 <br> config access_profile profile_id 1 add access_id 1 ethernet vlan USER ethernet_type 0x8863 port 1-10 permit <br> config access_profile profile_id 1 add access_id 2 ethernet vlan USER ethernet_type 0x8864 port 1-10 permit <br> config access_profile profile_id 1 add access_id 3 ethernet vlan USER port 1-10 deny <br></code> <br>  Create an ACL that prevents PPPoE PADO packets from client ports (we block fake PPPoE servers). <br> <code>create access_profile packet_content_mask offset1 l2 0 0xFFFF offset2 l3 0 0xFF profile_id 2 <br> config access_profile profile_id 2 add access_id 1 packet_content offset1 0x8863 offset2 0x0007 port 1-8 deny <br></code> <br>  And, finally, enable STORM Control to combat brodcast and multicast floods.  It may seem that we have already solved this problem by banning non-PPPoE traffic, but there is a but.  In PPPoE, the first request (to search for a PPPoE server) is sent by Broadcast, and if the client's equipment, due to a glitch, virus or other reasons, sends such requests intensively, this may well disable the network. <br> <code>config traffic control 1-8 broadcast enable multicast enable action drop threshold 64 countdown 5 time_interval 5 <br></code> <br><br>  Thus, we solve many of the problems inherent in a flat network - fake DHCP and PPPoE servers (often many include such things unintentionally, and not by knowledge, that is, there is no malicious intent, but other clients are hampered by work), broadcasted storms, buggy network cards and other </div><p>Source: <a href="https://habr.com/ru/post/123038/">https://habr.com/ru/post/123038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123033/index.html">PageBreaker extension for MODX - pagination of texts</a></li>
<li><a href="../123034/index.html">Brainfuck BAT Interpreter</a></li>
<li><a href="../123035/index.html">Blurring Gaussian Images with SVG</a></li>
<li><a href="../123036/index.html">Space Odyssey 2011</a></li>
<li><a href="../123037/index.html">SMS about incoming messages Vkontakte</a></li>
<li><a href="../123039/index.html">HTML Captcha without using images</a></li>
<li><a href="../12304/index.html">Grow three times faster than the market</a></li>
<li><a href="../123040/index.html">How to safely go to GTD</a></li>
<li><a href="../123042/index.html">Why don't girls play video games?</a></li>
<li><a href="../123044/index.html">Mango - for all developers!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>