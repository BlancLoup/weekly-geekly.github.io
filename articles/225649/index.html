<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a custom component based on a ListView</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For an Android application, I needed an interface element, vaguely reminiscent of a DatePicker. He should be able to: 


- scroll through the list fro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a custom component based on a ListView</h1><div class="post__text post__text-html js-mediator-article">  For an Android application, I needed an interface element, vaguely reminiscent of a DatePicker.  He should be able to: <br><ul><li>  scroll through the list from beginning to end (but not in a circle), so as to highlight the central element. </li><li>  as the element is removed from the center of the component, change the font and transparency of the numbers </li><li>  ‚ÄúBring‚Äù the list to the desired item </li><li>  display the specified number of items on the screen </li><li>  determine scroll direction (up or down) </li><li>  draw shadow for text box contents </li></ul><br><a name="habracut"></a>  It should be a component of this type: <br><img src="https://habrastorage.org/getpro/habr/post_images/05c/e58/672/05ce586721dafadb41a1106c5eb04333.png"><br><br>  We will inherit our RollView component from LinearLayout with a ListView child element.  Inside the component, we implement the OnScrollListener interface to define the ListView behavior when scrolling. <br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RollView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinearLayout</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnScrollListener</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ListView innerListView; }</code> </pre> <br><br>  In the constructor, initialize the ListView through the xml file and assign it to the listener. <br>  To view the data, create an internal adapter with the overridden getView () method: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RollAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LayoutInflater mInflater; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (convertView == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ convertView = mInflater.inflate(R.layout.roll_view_adapter, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); convertView.setLayoutParams(mParams); } TextView tv = (TextView) convertView.findViewById(R.id.text); tv.setTag(position); <span class="hljs-comment"><span class="hljs-comment">//    tv.setText(getItem(position)); convertView.setTag(tv); //   TextView   if (!listViews.contains(convertView)) listViews.add(convertView); //        return convertView; } }</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All View from the getView method will be written to the ArrayList to change their parameters.  The refreshLayoutParams () method sets sizes for list items depending on the number of visible items.  We won't do anything else in the adapter class. <br><br>  In order to be able to shift the first element of the list in the middle, add empty lines to the beginning and end of the array. <br>  Now you need to handle scrolling in the onScroll and onScrollStateChanged methods: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastFirstVisibleElement; <span class="hljs-comment"><span class="hljs-comment">//   "  "     private int centralIndex; //     @Override public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) { refreshTextViews(); //     //    if (lastFirstVisibleElement &gt; firstVisibleItem){ Log.i("RollView", "Scroll up"); } else if (lastFirstVisibleElement &lt; firstVisibleItem){ Log.i("RollView", "Scroll down"); } lastFirstVisibleElement = firstVisibleItem; } @Override public void onScrollStateChanged(AbsListView view, int scrollState) { //   if (scrollState == SCROLL_STATE_IDLE){ //  smoothScrollToPositionFromTop(centralIndex - totalElementVisible / 2 , 0, 1); }</span></span></code> </pre><br><br>  The refreshTextViews () method is responsible for changing the text size and transparency depending on the position of the element: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshTextViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> maxTextSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (View v : listViews){ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerOfViewY = v.getBottom() - (mAdapter.mParams.height / <span class="hljs-number"><span class="hljs-number">2</span></span>); ShadowTextView tv = (ShadowTextView) v.getTag(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> coefficient = (Math.abs(centerOfViewY - mAdapter.centerLineY)) / (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)mAdapter.centerLineY; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> scale = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   1 -      if (coefficient &lt; 1) scale = Math.abs(coefficient - 1); tv.setAlpha(scale); //          float textSize = CENTRAL_TEXT_SIZE * scale; if (textSize &gt; maxTextSize){ maxTextSize = textSize; centralIndex = (Integer) tv.getTag(); } tv.setTextSize(textSize); } }</span></span></code> </pre><br><br>  It remains to add a shadow for the text.  To do this, create the ShadowTextView component inherited from TextView.  To draw text with shadows, you need to create a brush (Paint) and set its parameters: <br><div class="spoiler">  <b class="spoiler_title">Brush options</b> <div class="spoiler_text">  private final Paint mPaint = new Paint (); <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      private void initPaint(){ mPaint.setAntiAlias(true); mPaint.setTextSize(getTextSize()); mPaint.setColor(Color.WHITE); mPaint.setStrokeWidth(2.0f); mPaint.setStyle(Paint.Style.FILL); mPaint.setTextAlign(Paint.Align.CENTER); mPaint.setShadowLayer(10.0f, 0.0f, 0.0f, Color.BLACK); }</span></span></code> </pre><br></div></div><br>  and in the onDraw () method redraw the component: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Rect mBounds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(); <span class="hljs-comment"><span class="hljs-comment">//   @Override protected void onDraw(Canvas canvas){ canvas.drawColor(Color.TRANSPARENT); int x = getWidth() / 2; int y = (getHeight() + mBounds.height()) / 2; canvas.drawText(getText().toString(), x, y, mPaint); } }</span></span></code> </pre><br>  To redraw the shadows from RollView, add the redraw () method: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ text = getText().toString(); mPaint.setTextSize(getTextSize()); mPaint.getTextBounds(text, <span class="hljs-number"><span class="hljs-number">0</span></span>, getText().toString().length() , mBounds); invalidate(); }</code> </pre><br>  It remains only to replace TextView in with ShadowTextView and call tv.redraw () method in the refreshTextViews method; <br>  Now, to get the user-selected value, all that remains is to add the getCurrentItemValue () and getCurrentItemIndex () methods. <br>  Visual demonstration of the work: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/D4uu9wZT7rQ%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhxM3fFp9fYSVNee6BiD0mGHfehmQ" frameborder="0" allowfullscreen=""></iframe><br>  Link to the full project: <br>  <a href="http://bitbucket.org/msinchevskaya/rollview">https://bitbucket.org/msinchevskaya/rollview</a> </div><p>Source: <a href="https://habr.com/ru/post/225649/">https://habr.com/ru/post/225649/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225639/index.html">Mikrotik and GNS3</a></li>
<li><a href="../225641/index.html">New Optional class in Java 8, not a panacea for NullPointerException</a></li>
<li><a href="../225643/index.html">Antenna for Wi-Fi on your knee in 10 minutes</a></li>
<li><a href="../225645/index.html">Development of Iframe applications on VK API. From the first cones to the two millionth audience</a></li>
<li><a href="../225647/index.html">IText: we take out the text from PDF</a></li>
<li><a href="../225651/index.html">How to teach a player to understand your application, not nullifying the work of artists, not offending programmers and not considering players mentally retarded</a></li>
<li><a href="../225653/index.html">MIDI Wavy: make controlled color music using Arduino and MIDI</a></li>
<li><a href="../225655/index.html">Syncthing sync + installer review on Raspberry Pi and Macbook</a></li>
<li><a href="../225657/index.html">How to legalize income from Google AdSense for PI</a></li>
<li><a href="../225659/index.html">AngularJS. Data organization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>