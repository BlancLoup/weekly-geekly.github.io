<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration tests for Java using TestContainers. Less madness, more order, all automatically</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© there is absolutely no information about TestContainers . At the time of this writing, search results have announcements of our same conferen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration tests for Java using TestContainers. Less madness, more order, all automatically</h1><div class="post__text post__text-html js-mediator-article"><p>  On Habr√© there is absolutely no information about <a href="https://github.com/testcontainers/testcontainers-java">TestContainers</a> .  At the time of this writing, search results have <a href="https://habrahabr.ru/company/jugru/blog/341666/">announcements of our same conferences</a> , that's all.  Meanwhile, <a href="https://github.com/testcontainers/testcontainers-java">in the project on GitHub</a> , they already have <strong>more than 700 commits, 54 contributors and 5 years of history</strong> .  It seems that all these five years the project has been carefully hidden by the special services and UFOs.  It is time to get out of the shadows into the light. </p><br><p><img src="https://habrastorage.org/webt/ge/js/_l/gejs_lh3eulyddiuwlqo-ozutvo.png"></p><br><p>  Chukchi - a reader, not a writer.  Therefore, instead of writing my own text, I asked permission to translate the relevant <a href="https://zeroturnaround.com/rebellabs/java-integration-testing-with-testcontainers/">article from the RebelLabs blog</a> . </p><br><p>  So, here we will share a few words about the latest Java library for integration testing - <a href="https://github.com/testcontainers/testcontainers-java">TestContainers</a> .  In addition, there will be a little about why integration testing is so important for ZeroTurnaround and their requirements for integration tests.  And of course, there will be a full-featured integration test sample for the Java agent.  If someone has never seen the Java agent code, now is the time.  Welcome under the cut! </p><a name="habracut"></a><br><h1 id="integracionnoe-testirovanie-v-kompanii-zeroturnaround">  Integration Testing at ZeroTurnaround </h1><br><p>  ZeroTurnaround's products integrate with much of the Java ecosystem.  In particular, JRebel and XRebel are based on the technology of Java agents and integrate with Java applications, frameworks, application servers, and so on. </p><br><p>  Using the <a href="https://zeroturnaround.com/rebellabs/how-to-inspect-classes-in-your-jvm/">Java agent,</a> you can instrument the Java code to add the extra functionality you need.  To test how an application behaves after applying a patch, you need to run it through a pre-configured Java agent.  Once the application has started and started working, you can send an HTTP request to it to reproduce the desired behavior. </p><br><p>  To run such tests on a large scale, you need to have an automated system that can start and stop the runtime environment, including the application server or any other external dependencies on which the application depends.  It should be possible to run about the same things in the continuous integration environment and on the developer's computer. </p><br><p>  The result is a bunch of tests, they do not work very quickly, and therefore we definitely want to run them in parallel.  This automatically means that tests should be isolated so that there are no conflicts over resources.  For example, if we run multiple instances of Tomcat on the same host, we would like to avoid port usage conflicts. </p><br><p>  In such an integration test helps us a small beautiful library <strong>TestContainers</strong> .  She didn‚Äôt just come up with the requirements voiced above - after its implementation we received an impressive performance increase. </p><br><h1 id="testcontainers">  Testcontainers </h1><br><p>  The official TestContainers documentation says the following: </p><br><blockquote>  ‚ÄúTestContainers is a Java library that supports JUnit tests and provides light, temporary instances of core databases, web browsers for Selenium, or anything else that can be run in a Docker container.‚Äù </blockquote><p>  TestContainers provides an API to automate environment configuration.  It launches the necessary Docker-containers exactly for the duration of our tests and extinguishes them as soon as the tests are completed.  Next we look at several demos based on official examples <a href="https://github.com/testcontainers/testcontainers-java-examples">in their GitHub repository</a> . </p><br><h1 id="genericcontainer">  GenericContainer </h1><br><p> When using TestContainers, the <code>GenericContainer</code> class is often used: </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedisBackedCacheTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GenericContainer redis = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GenericContainer(<span class="hljs-string"><span class="hljs-string">"redis:3.0.6"</span></span>) .withExposedPorts(<span class="hljs-number"><span class="hljs-number">6379</span></span>);</code> </pre> <br><p>  Its constructor takes as its parameter a string in which the Docker image is specified, which we will use in the future.  During startup, TestContainers automatically loads the corresponding image (if it has not been downloaded before). </p><br><p>  Important note: in the <code>withExposedPorts(6379)</code> method, 6379 is the port on which the container will hang.  Next, we will be able to find the corresponding associated port by calling the <code>getMappedPort(6379)</code> method <code>getMappedPort(6379)</code> on the container instance.  Combining this with <code>getContainerIpAddress()</code> , we can get the full URL of the service running in the container: </p><br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">String</span></span> redisUrl = redis.getContainerIpAddres() + ‚Äú:‚Äù + redis.getMappedPort(<span class="hljs-number"><span class="hljs-number">6379</span></span>);</code> </pre> <br><p>  You can see that the field from this example is marked with the <code>@Rule</code> annotation.  <a href="https://github.com/junit-team/junit4/wiki/rules">The @Rule annotation from JUnit</a> determines that we will receive a new <code>GenericContainer</code> instance in each test method of this class.  If we want to reuse the container instance, for this there is the <code>@ClassRule</code> annotation. </p><br><h1 id="konteynery-pod-zadachu">  Task containers </h1><br><p>  The <code>GenericContainer</code> are specialized containers.  To test the level of access to data, out of the box are containerized MySQL, PostgreSQL and Oracle images. </p><br><pre> <code class="hljs cs">PostgreSQLContainer postgreSQLContainer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostgreSQLContainer(<span class="hljs-string"><span class="hljs-string">"postgres:9.6.2"</span></span>) .withUsername(POSTGRES_USERNAME) .withPassword(POSTGRES_PASSWORD);</code> </pre> <br><p>  With just this one line you can get a copy of the container, which will remain with us throughout the test.  On the machine where the tests will run, you do not need to manually install the database.  This gives an especially big gain if you want to test on several versions of the same database. </p><br><h1 id="svoi-sobstvennye-konteynery">  Own containers </h1><br><p>  Inheriting from <code>GenericContainer</code> , it is possible to make new container types.  This is quite convenient if you want to encapsulate the corresponding services and logic.  For example, you can use <a href="http://www.mock-server.com/">MockServer</a> to lock the dependencies of a distributed system in which applications communicate with each other via HTTP: </p><br><pre> <code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockServerContainer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseContainer&lt;MockServerContainer&gt;</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">MockServerClient</span></span> client; public <span class="hljs-type"><span class="hljs-type">MockServerContainer</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"jamesdbloom/mockserver:latest"</span></span>); withCommand(<span class="hljs-string"><span class="hljs-string">"/opt/mockserver/run_mockserver.sh -logLevel INFO -serverPort 80"</span></span>); addExposedPorts(<span class="hljs-number"><span class="hljs-number">80</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> void containerIsStarted(<span class="hljs-type"><span class="hljs-type">InspectContainerResponse</span></span> containerInfo) { client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MockServerClient</span></span>(getContainerIpAddress(), getMappedPort(<span class="hljs-number"><span class="hljs-number">80</span></span>)); } }</code> </pre> <br><p>  In this example, immediately after the container is initialized, the <code>containerIsStarted(...)</code> callback is used, which initializes the <code>MockServerClient</code> instance.  Thus, we hid all the implementation details specific to the container inside our own container type.  Thanks to this, we got a cleaner client code and a tidier API for testing. </p><br><p>  Next we will see that manually defined containers help in structuring the environment for testing Java agents. </p><br><h1 id="testirovanie-java-agenta-s-pomoschyu-testcontainers">  Testing the Java agent with TestContainers </h1><br><p>  To demonstrate the idea, let us use <a href="https://github.com/bsideup/javaagent-boilerplate">an example</a> kindly provided by <a href="https://twitter.com/bsideup">Sergey @bsideup Egorov</a> , a co-driver of the TestContainers project. </p><br><h2 id="demonstracionnoe-prilozhenie">  Demo application </h2><br><p>  Let's start with a test application.  We need a web application that responds to HTTP GET requests.  Fat frameworks are not required - so why not take <a href="https://zeroturnaround.com/rebellabs/sparkjava-is-an-amazing-java-web-framework-do-you-really-need-it/">SparkJava</a> ?  To add fun, let's start code on Groovy right away!  Here we will test this application: </p><br><pre> <code class="hljs pgsql">//app.groovy @Grab("com.sparkjava:spark-core:2.1") <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> static spark.Spark.* <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/hello/") { req, res -&gt; "Hello!" }</code> </pre> <br><p>  This is a simple Groovy script that uses <a href="http://docs.groovy-lang.org/latest/html/documentation/grape.html">Grape</a> to load dependencies on SparkJava, and defines one HTTP endpoint that responds with a ‚ÄúHello!‚Äù Message. </p><br><h2 id="java-agent">  Java agent </h2><br><p>  The agent we are going to check patches the Jetty server and adds an additional header to it in the HTTP response. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Agent</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">premain</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String args, Instrumentation instrumentation</span></span></span><span class="hljs-function">)</span></span> { instrumentation.addTransformer( (loader, className, clazz, domain, buffer) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"spark/webserver/JettyHandler"</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">equals</span></span>(className)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ClassPool cp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassPool(); cp.appendClassPath(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoaderClassPath(loader)); CtClass ct = cp.makeClass(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayInputStream(buffer)); CtMethod ctMethod = ct.getDeclaredMethod(<span class="hljs-string"><span class="hljs-string">"doHandle"</span></span>); ctMethod.insertBefore(<span class="hljs-string"><span class="hljs-string">"{ $4.setHeader(\"X-My-Super-Header\", \"42\"); }"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ct.toBytecode(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Throwable e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buffer; }); } }</code> </pre> <br><p>  In this example, Javassist is used to <code>JettyHandler.doHandle</code> method, to which an additional command is added that sets the <code>X-My-Super-Header</code> . </p><br><p>  Of course, to become a Java agent, you need to properly assemble into a package and add the appropriate attributes to the <code>MANIFEST.MF</code> file.  All this is done for us by the build script, so as not to clutter up the article, it is posted on GitHub, see the contents of the <a href="https://github.com/bsideup/javaagent-boilerplate/blob/master/build.gradle">build.grade</a> file. </p><br><h2 id="sobstvenno-test">  Actually, the test! </h2><br><p>  The test will be quite simple: you need to make a request to our application and check the answer for the presence of a special header, which the Java agent, in theory, should add there.  If the title is found and the value of the title matches the expected value - the test was successfully passed.  Take a look at the code: </p><br><pre> <code class="hljs pgsql">@Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> testIt() throws <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> { // <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> Feign client <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> the request Response response = app.getClient().getHello(); assertThat(response.headers().<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("X-My-Super-Header")) .isNotNull() .hasSize(<span class="hljs-number"><span class="hljs-number">1</span></span>) .containsExactly("42"); }</code> </pre> <br><p>  You can run it directly from the IDE, or from the command line, or even in a continuous integration environment.  TestContainers help us launch an application so that the agent is in an isolated environment, in a Docker container. </p><br><p>  To run the application, you need a Docker image with Groovy support.  To make ourselves comfortable, we have a <a href="https://hub.docker.com/r/zeroturnaround/groovy/">zeroturnaround / groovy</a> Docker image, it lies on the Docker Hub.  Here's how to use it, inheriting from the <code>GenericContainer</code> : </p><br><pre> <code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroovyTestApp&lt;SELF</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroovyTestApp&lt;SELF&gt;&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenericContainer&lt;SELF&gt;</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-type"><span class="hljs-type">GroovyTestApp</span></span>(<span class="hljs-type"><span class="hljs-type">String</span></span> script) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"zeroturnaround/groovy:2.4.5"</span></span>); withClasspathResourceMapping(<span class="hljs-string"><span class="hljs-string">"agent.jar"</span></span>, <span class="hljs-string"><span class="hljs-string">"/agent.jar"</span></span>, <span class="hljs-type"><span class="hljs-type">BindMode</span></span>.<span class="hljs-type"><span class="hljs-type">READ_ONLY</span></span>); withClasspathResourceMapping(script, <span class="hljs-string"><span class="hljs-string">"/app/app.groovy"</span></span>, <span class="hljs-type"><span class="hljs-type">BindMode</span></span>.<span class="hljs-type"><span class="hljs-type">READ_ONLY</span></span>); withEnv(<span class="hljs-string"><span class="hljs-string">"JAVA_OPTS"</span></span>, <span class="hljs-string"><span class="hljs-string">"-javaagent:/agent.jar"</span></span>); withCommand(<span class="hljs-string"><span class="hljs-string">"/opt/groovy/bin/groovy /app/app.groovy"</span></span>); withLogConsumer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Slf4jLogConsumer</span></span>(<span class="hljs-type"><span class="hljs-type">LoggerFactory</span></span>.getLogger(script))); } public <span class="hljs-type"><span class="hljs-type">String</span></span> getURL() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"http://"</span></span> + getContainerIpAddress() + <span class="hljs-string"><span class="hljs-string">":"</span></span> + getMappedPort(getExposedPorts().get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } }</code> </pre> <br><p>  See how the API provides us with methods for obtaining the IP address of the container, as well as the associated port (which is actually randomized).  In a sense, the port will be different each time the test is run.  Therefore, if you run all the tests at the same time, there will be no conflicts between the ports, and the tests will not sprinkle. </p><br><p>  Now we have a special class <code>GroovyTestApp</code> for simple running scripts on Groovy, in our case - for testing a demo application: </p><br><pre> <code class="hljs vhdl">GroovyTestApp app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GroovyTestApp(‚Äúapp.groovy‚Äù) .withExposedPorts(<span class="hljs-number"><span class="hljs-number">4567</span></span>); //the <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> SparkJava .setWaitStrategy(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpWaitStrategy().forPath(<span class="hljs-string"><span class="hljs-string">"/hello/"</span></span>));</code> </pre> <br><p>  Run the tests, look at the exhaust: </p><br><pre> <code class="hljs vbscript">$ ./gradlew test <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:<span class="hljs-number"><span class="hljs-number">51.462</span></span> [I] d.DockerClientProviderStrategy - Accessing unix domain socket via TCP proxy (/var/run/docker.sock via localhost:<span class="hljs-number"><span class="hljs-number">50652</span></span>) ‚Ä¶ ‚Ä¶ ‚Ä¶ <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">01.497</span></span> [I] app.groovy - STDERR: [Thread<span class="hljs-number"><span class="hljs-number">-1</span></span>] INFO spark.webserver.SparkServer - == Spark has ignited ... <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">01.498</span></span> [I] app.groovy - STDERR: [Thread<span class="hljs-number"><span class="hljs-number">-1</span></span>] INFO spark.webserver.SparkServer - &gt;&gt; Listening <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">4567</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">01.511</span></span> [I] app.groovy - STDERR: [Thread<span class="hljs-number"><span class="hljs-number">-1</span></span>] INFO org.eclipse.jetty.<span class="hljs-built_in"><span class="hljs-built_in">server</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Server</span></span> - jetty<span class="hljs-number"><span class="hljs-number">-9.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>.v20130417 <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">01.825</span></span> [I] app.groovy - STDERR: [Thread<span class="hljs-number"><span class="hljs-number">-1</span></span>] INFO org.eclipse.jetty.<span class="hljs-built_in"><span class="hljs-built_in">server</span></span>.ServerConnector - Started ServerConnector@<span class="hljs-number"><span class="hljs-number">72</span></span>f63426{HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span>}{<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">4567</span></span>} <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>:<span class="hljs-number"><span class="hljs-number">02.199</span></span> [I] ?<span class="hljs-number"><span class="hljs-number">.4</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>] - Container zeroturnaround/groovy:<span class="hljs-number"><span class="hljs-number">2.4</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> started AgentTest &gt; testIt STANDARD_OUT Got <span class="hljs-built_in"><span class="hljs-built_in">response</span></span>: HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK content-length: <span class="hljs-number"><span class="hljs-number">6</span></span> content-type: text/html; charset=UTF<span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-built_in"><span class="hljs-built_in">server</span></span>: Jetty(<span class="hljs-number"><span class="hljs-number">9.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>.v20130417) x-my-super-header: <span class="hljs-number"><span class="hljs-number">42</span></span> Hello! BUILD SUCCESSFUL Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">36.014</span></span> secs</code> </pre> <br><p>  This test is not very fast.  It takes some time to download Grapes - but only the very first time.  However, this is a complete integration test that runs a Docker container, an application using the HTTP stack, and makes HTTP requests.  In addition, the application runs in isolation, and it‚Äôs really easy to do.  And all this thanks to TestContainers! </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  "Works on my computer" is a popular excuse, but it should no longer be an excuse at all.  As containerization technology becomes available to more and more developers, it becomes possible to do more and more deterministic tests. </p><br><p>  TestContainers reduce the amount of madness in Java application integration tests.  This library is very easy to integrate into existing tests.  You no longer need to manually manage external dependencies, and this is a huge victory, especially in a continuous integration environment. </p><br><p>  If you like what you have just read, we highly recommend looking at the recording from the GeekOut Java conference, where Richard North, the original author of the project, <a href="https://vimeo.com/222501136">provides background information on TestContainers</a> , including development plans.  Or at least look at the <a href="https://www.slideshare.net/rich.north/testcontainers-geekout-ee-2017-presentation">slides of this presentation</a> . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/222501136" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><br><p>  A couple of words from the translator. </p><br><p>  Firstly, if you find any inaccuracies, errors and typos - you need to go to the <a href="https://habrahabr.ru/users/olegchir/" class="user_link">olegchir</a> in <a href="https://habrahabr.ru/users/olegchir/" class="user_link">person</a> and describe everything as it is.  I really read messages and fix bugs. </p><br><p>  <strong>If you are interested in Java</strong> , new technologies and libraries, then you should visit our Java conferences.  Nearest - <a href="https://jpoint.ru/">JPoint</a> and <a href="https://2018.jbreak.ru/">JBreak</a> .  By the way, ZeroTurnaround employees often speak at our conferences as speakers and work as members of the Program Committee. </p><br><p>  <strong>If testing is more interesting for you</strong> , then we are <a href="https://heisenbug-moscow.ru/">holding a</a> conference <a href="https://heisenbug-moscow.ru/">Heisenbug 2017 Moscow</a> , which will be held in just a week and a half.  The topic of testing using Docker there is somehow present <a href="https://heisenbug-moscow.ru/talks/2017/msk/jjnfwa6ewsussuce2kmoe/">in many reports</a> . </p><br><h1 id="budete-li-vy-polzovatsya-testcontainers-ponravilas-ideya-est-somneniya-pishite-v-kommentariyah">  Will you use TestContainers?  Do you like the idea, have doubts?  Write in the comments! </h1></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/343298/">https://habr.com/ru/post/343298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343286/index.html">How high-frequency trading changed the situation on world markets: 4 conclusions of analysts at Credit Suisse</a></li>
<li><a href="../343288/index.html">How do you implement authentication, buddy?</a></li>
<li><a href="../343290/index.html">Creating remakes of games using emulation: proof of concept</a></li>
<li><a href="../343294/index.html">Parser on PHP knee or how I replenished my music collection</a></li>
<li><a href="../343296/index.html">The story of several hard forks: how did the bitcoin network evolve</a></li>
<li><a href="../343300/index.html">We compare what is impossible: cheap hosting and cloud on the VMware stack</a></li>
<li><a href="../343302/index.html">ScadaPy JSON server</a></li>
<li><a href="../343304/index.html">Binary Matrix Neural Network</a></li>
<li><a href="../343306/index.html">How to deal with cheaters and not rewrite all code</a></li>
<li><a href="../343308/index.html">Quantum versus classical: why do we need so many digits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>