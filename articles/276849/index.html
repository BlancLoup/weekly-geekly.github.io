<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Review of physics in Sonic games. Part 2: Running</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuation of a series of articles on physics in games about Sonic. 

 Note : 

 The review covers all four parts of the game on Genesis / Mega Driv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Review of physics in Sonic games. Part 2: Running</h1><div class="post__text post__text-html js-mediator-article"><img width="640" src="https://habrastorage.org/files/8f6/6f0/390/8f66f03906d448129efacbe830b14e4f.png"><br><br>  <a href="https://habrahabr.ru/post/276669/">Continuation of a</a> series of articles on physics in games about Sonic. <br><br>  <i>Note</i> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The review covers all four parts of the game on Genesis / Mega Drive and <i>Sonic CD</i> . <br><br>  Everything written below refers to the situation when Sonic is on a flat dry surface, not having special bonuses.  Curves, physics of behavior in water, bonuses Super Sonic and Speed ‚Äã‚ÄãShoes will be discussed in separate articles.  Under the <i>steps</i> in the article refers to software cycles, not the steps of the character. <br><a name="habracut"></a><br>  <b>Links to other parts of the series:</b> <br>  <a href="https://habrahabr.ru/post/276669/">Part 1: hard tiles</a> <br>  <a href="https://habrahabr.ru/post/278373/">Parts 3 and 4: Jumping and Spinning</a> <br>  <a href="https://habrahabr.ru/post/305312/">Parts 5 and 6: the loss of rings and being under water</a> <br>  <a href="https://habrahabr.ru/post/306756/">Parts 7 and 8: springs and gizmos, super speeds</a> <br><br><ul><li>  <a href="https://habr.com/ru/post/276849/">1 Variables</a> </li><li>  <a href="https://habr.com/ru/post/276849/">2 Principles of movement</a> <br><ul><li>  <a href="https://habr.com/ru/post/276849/">2.1 Acceleration</a> </li><li>  <a href="https://habr.com/ru/post/276849/">2.2 Slowdown</a> </li><li>  <a href="https://habr.com/ru/post/276849/">2.3 Friction force</a> </li><li>  <a href="https://habr.com/ru/post/276849/">2.4 Maximum speed</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/276849/">3 Principles of animation</a> <br><ul><li>  <a href="https://habr.com/ru/post/276849/">3.1 Running Animation</a> </li><li>  <a href="https://habr.com/ru/post/276849/">3.2 Animation braking</a> </li><li>  <a href="https://habr.com/ru/post/276849/">3.3 Differences in the physics of different characters</a> </li></ul></li></ul><br><a name="Variables"></a>  <b>Variables</b> <br><br>  In this section, the following variables and constants will often be used: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Xsp:     Ysp:     // acc: 0.046875 dec: 0.5 frc: 0.046875 ( acc) top: 6</span></span></code> </pre> <br><a name="Movement_Rules"></a>  <b>Principles of movement</b> <br><div class="spoiler">  <b class="spoiler_title">Gif on topic (4.7MB)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/336/2d6/fbe/3362d6fbeacb4ca5a0e048cbeb4f6cd2.gif"><br></div></div><br><a name="Acceleration"></a>  <b>Acceleration</b> <br><br>  By pressing and holding the button <img src="https://habrastorage.org/files/63e/6d8/116/63e6d8116ade4ba8a16c1a21a2ff6ecc.png">  from standing mode, the speed of the <i>Xsp</i> starts to increase each step by <i>acc</i> .  By pressing and holding the button <img src="https://habrastorage.org/files/aaa/d74/0aa/aaad740aaf194ee1bb3dd5adb48bdf17.png">  from standing mode, the speed of the <i>Xsp</i> begins each step to decrease by <i>acc</i> . <br><br><a name="Deceleration"></a>  <b>Slowdown</b> <br><br>  If Sonic is already moving, and not worth it when you press <img src="https://habrastorage.org/files/aaa/d74/0aa/aaad740aaf194ee1bb3dd5adb48bdf17.png">  or <img src="https://habrastorage.org/files/63e/6d8/116/63e6d8116ade4ba8a16c1a21a2ff6ecc.png">  The computer checks if the button is pressed in the direction in which it is already moving.  If so, then <i>acc is</i> added to the <i>Xsp</i> , as usual.  If the button is pressed in the opposite direction, the deceleration constant ( <i>dec</i> ) is added instead.  Thanks to this, Sonic can quickly turn around.  If the difference between <i>acc</i> and <i>dec were</i> missing, Sonic's speed change would take too much time, annoying the player.  A good engine should not make such childish mistakes. <br><br>  You might think that when <i>Xsp</i> = 0.1 after clicking <img src="https://habrastorage.org/files/aaa/d74/0aa/aaad740aaf194ee1bb3dd5adb48bdf17.png">  <i>dec</i> will be <i>subtracted</i> , and the <i>Xsp</i> value will be -0.4.  Strange, but in the case of games for the Mega Drive it is not.  If the result of adding or subtracting <i>dec</i> leads to a change in the sign of <i>Xsp</i> , then <i>Xsp is</i> assigned the value <i>dec</i> .  For example, in the above case, <i>Xsp</i> will become equal to -0.5.  The funny result is this behavior: you can click <img src="https://habrastorage.org/files/aaa/d74/0aa/aaad740aaf194ee1bb3dd5adb48bdf17.png">  in one step and then click <img src="https://habrastorage.org/files/63e/6d8/116/63e6d8116ade4ba8a16c1a21a2ff6ecc.png">  (or vice versa), and start running faster than if you just clicked <img src="https://habrastorage.org/files/63e/6d8/116/63e6d8116ade4ba8a16c1a21a2ff6ecc.png">  !  The final speed is still lower than one pixel per step, so this is not so noticeable, but nevertheless, this is true.  When you create your engine, you can not try to copy this strange behavior. <br><br><a name="Friction"></a>  <b>Friction force</b> <br><br>  If you do not click <img src="https://habrastorage.org/files/aaa/d74/0aa/aaad740aaf194ee1bb3dd5adb48bdf17.png">  or <img src="https://habrastorage.org/files/63e/6d8/116/63e6d8116ade4ba8a16c1a21a2ff6ecc.png">  , the friction force comes into <i>play</i> ( <i>frc</i> ).  At each step in which the game does not receive signals from the controller's horizontal movement buttons, <i>frc</i> multiplied by the <i>Xsp</i> sign is subtracted from <i>Xsp</i> until the absolute value of <i>Xsp</i> is less than <i>frc</i> ;  in this case, <i>Xsp is</i> simply equal to zero. <br><br><a name="Top_Speed"></a>  <b>Max speed</b> <br><br>  Sonic can only accelerate to a certain limit.  At some point, it reaches maximum speed and can no longer be accelerated on its own.  After adding <i>acc</i> to <i>Xsp, the</i> computer checks to see if <i>Xsp is</i> greater than the <i>top</i> value.  If it exceeds, then it is assigned the value <i>top</i> . <br><br>  This means that if Sonic somehow gained a higher speed, which he could not reach himself (for example, he reached it by pushing away from the spring), then when you press a button in the direction of his movement, the computer adds <i>acc</i> , notices that <i>Xsp</i> exceeds <i>top</i> , and equates <i>Xsp</i> to <i>top</i> .  Thus, you can reduce the momentum by pressing the direction button.  This is a flaw!  You can eliminate it when developing the engine by checking whether <i>Xsp is</i> less than <i>top</i> before adding <i>acc</i> .  Only if <i>Xsp is</i> less than <i>top the</i> computer should add <i>acc</i> and check if <i>Xsp is</i> greater than the value of <i>top</i> .  Problem solved. <br><br>  In fact, a similar fix is ‚Äã‚Äãused in the <i>Sonic CD</i> because Sonic can perform a quick jerk ( <i>Super Peel Out</i> ) (which is called <i>Dash</i> in the Japanese version of the game), which pushes him forward at a speed of 12 pixels per step.  Under normal conditions, Sonic cannot accelerate this way, but if he reaches this speed with a jerk, he can continue to run with her while the player presses the button in the direction of his movement.  When you release the button, the friction force does its job.  When pressed again, the friction force ceases to act, and the <i>Xsp</i> remains constant, but it cannot rise to 12 without a new jerk. <br><br>  <i>Sonic CD</i> programmers did not use this fix for a situation where Sonic is in the air, so if he uses a jerk and then falls off the ledge while the button is held in the direction of its movement, then when <i>removed</i> from the ground, <i>Xsp</i> can drop to 6, regardless of how high the speed was at that time.  This is also a big flaw. <br><br>  Here is the pseudocode that emulates motion and friction force precisely: <br><br><pre> <code class="dos hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (   "") { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xsp &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { xsp -= dec; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xsp &gt; -top) { xsp = xsp-acc; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (   "") { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xsp &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { xsp += dec; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xsp &lt; top) { xsp = xsp+acc; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> xsp = xsp-minimum(absolute(xsp), frc)*sign(xsp);</code> </pre><br><a name="Animation_Rules"></a>  <b>Principles of animation</b> <br><br><a name="Running_Animation"></a>  <b>Running animation</b> <br><br>  If we consider <i>Sonic CD</i> , then Sonic has three different running animations.  He is depicted as standing only if <i>Xsp</i> is zero.  If it has any other <i>Xsp</i> , it goes into a walk animation, in which the frame change depends on the speed of movement along the ground. <br><br>  As soon as <i>Xsp</i> becomes equal (or greater) 6, it goes into running animation with ‚Äúspinning‚Äù legs.  When <i>Xsp</i> is equal to or greater than 10, it goes into a figure-eight jerk animation.  The jerk animation is only <i>Sonic CD</i> . <br><br><img src="https://habrastorage.org/files/43a/76b/7a7/43a76b7a706b4d719b55843c1fbed76f.gif"><br>  <i>Walking</i> <br><br><img src="https://habrastorage.org/files/18c/3a0/a35/18c3a0a354884da697cec8de49024836.gif"><br>  <i>Run</i> <br><br><img src="https://habrastorage.org/files/8ff/67c/b47/8ff67cb472914fbe8ccbc6248bf2d401.gif"><br>  <i>Jerk</i> <br><br><a name="Braking_Animation"></a>  <b>Braking animation</b> <br><br>  Sonic goes into braking animation when turning, only if the absolute value of <i>Xsp</i> is equal to or greater than 4.5.  In <i>Sonic 1</i> and <i>Sonic CD,</i> it remains in the braking animation mode until <i>Xsp</i> reaches zero or changes sign.  In the remaining three games, Sonic returns to the walk animation mode after completing the playback of all the frames of the drag animation. <br><br><img src="https://habrastorage.org/files/1ad/870/dbc/1ad870dbc9de4192ac643cb034cd6e76.gif"><br>  <i>Braking</i> <br><br><a name="Character_Specific"></a>  <b>Differences in the physics of different characters</b> <br><br>  All characters - <i>Sonic</i> , <i>Tails</i> and <i>Knackles</i> (Sonic, Tails and Knuckles) - have the same values ‚Äã‚Äãof acceleration, deceleration, maximum speed, running and braking.  They are treated the same, with the exception of their special moves and sprites (and the annoying fact that the Knuckles jumps lower than the other two). </div><p>Source: <a href="https://habr.com/ru/post/276849/">https://habr.com/ru/post/276849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276839/index.html">Objective Perl Code Quality Criteria</a></li>
<li><a href="../276841/index.html">On February 13, a conference of software developers Dev2Dev Just.Net will take place in Krasnoyarsk</a></li>
<li><a href="../276843/index.html">New free courses virtual academy Microsoft Virtual Academy, February 2016</a></li>
<li><a href="../276845/index.html">himawari8 wallpaper for linux</a></li>
<li><a href="../276847/index.html">Configuring rsyslog to collect logs over the network via an encrypted connection</a></li>
<li><a href="../276851/index.html">AlfaCtrakhovanie Mobile. How we combined several IT systems in one application: case</a></li>
<li><a href="../276855/index.html">Cognitive computing - work faster than thought</a></li>
<li><a href="../276857/index.html">Using FPGA and DSL to speed up HFT trading</a></li>
<li><a href="../276859/index.html">Foster Day at the Foreign Ministry</a></li>
<li><a href="../276863/index.html">ARP: Cisco equipment features and interesting cases. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>