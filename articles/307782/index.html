<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of Ultima 2C and Ebay. Personal experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The partner developer agreed to share his personal integration experience with EBay. 


 We will try to analyze the whole process step by step, let us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of Ultima 2C and Ebay. Personal experience</h1><div class="post__text post__text-html js-mediator-article"><p>  The partner developer agreed to share his personal integration experience with EBay. </p><br><p>  We will try to analyze the whole process step by step, let us indicate which details of the connection should be paid particularly careful attention;  what basic logic will need to be implemented in the handlers and services of your configuration for regular interaction with EBAY.  Well and also, we will highlight typical difficulties and inconveniences that you absolutely inevitably encounter with this integration (both you and customers). </p><br><a name="habracut"></a><br><h1>  1.Ebay Features </h1><br><p>  First of all, of course, the unpleasant features of Ebay, which not only the developer will have to deal with: </p><br><ol><li><p>  Ebay does not like RF.  Technical support - stripped down, some functions in the most native cabinet of the Ebay seller can periodically fall off.  Connect the API reluctantly. </p><br></li><li><p>  Of course, no problem to trade as a non-Russian seller.  And specify in the settings another country of origin.  But you will need a real legal entity (in my case, a specially registered Chinese, for example), a phone with the code of the specified country for confirmation.  PayPal, as the main payment system, very carefully checks the data, especially for legal entities and merchants.  Billing address and other data must be real </p><br></li><li>  EBay is introducing more and more limits on products that you can post for free.  We do not post the whole range, we choose what is needed. </li></ol><br><h1>  2. Merchant Integration Platform (MIP) </h1><br><p>  What is it you can read <a href="https://go.developer.ebay.com/merchant-integration-platform">here</a> . </p><br><p>  But only the introductory part.  This talmudic work is not worth detailed examination.  It will take technically very little.  And the help at bugs and muffled errors of integration - any. </p><br><p>  Briefly, this is api ‚Äìadjusting the Ebay API.  The latter has its own <a href="https://developer.ebay.com/devzone/xml/docs/Reference/ebay/index.html">Trading Api and Shopping Api</a> , but too cumbersome, and EBAY support itself wraps up at the MIP saying that in order to avoid any of your particular problem, you must use the MIP. </p><br><p>  MIP allows you to send all the data to enter the ibeya account (goods, availability, prices, seller‚Äôs rules) and receive everything important at the output (actually orders) via the xml feeds system. </p><br><h2>  2.1 Administrative tasks </h2><br><p>  To arrange according to all the rules the account of the seller with the legal entity, link paypal, write in support of the MIP from your account with the request of the MIP to connect to the store. </p><br><h2>  2.2 The task of the developer </h2><br><ul><li>  Configure the data in the EBAY office after connecting the MIP. </li><li>  Save access data to constants (or directory if you plan to use multiple EBAY accounts). </li><li>  Make the class a generic input feed with our data. </li><li>  Make an input parser. </li></ul><br><h1>  3. Connection steps: </h1><br><h2>  3.1 Seller integration platform </h2><br><p>  After the MIP reports that your store has been connected, the menu item ‚ÄúSeller integration platform‚Äù will appear on the ebay website in My Ebay -&gt; Overview -&gt; Account. </p><br><h2>  3.2 Some more settings: </h2><br><ul><li>  go to the international settings </li><li>  fill in the address and stuff </li><li>  Create Rules </li></ul><br><p><img src="http://www.ultima2c.com/support/downloadAttachment?taskId=277202&amp;id=32014" alt="regulations"></p><br><p>  We are talking about the rules of <strong>payment, delivery, return</strong> . </p><br><p>  When you click on them, the client is sent to the appropriate point of the cabinet, where he creates policies for each of these sections. </p><br><p>  <em>Important!</em> </p><br><ol><li><p>  <em>The Cabinet allows you to create as many as you want.</em>  <em>BUT MIP accepts only 1 payment policy, 1 delivery, 1 return.</em>  <em>Therefore, the task in the settings within one record is to set all possible rules: For Any Weight, Region, and so on.</em> </p><br></li><li>  <em>The policy is invited to give a name, there are no restrictions on input.</em>  <em>But for MIP it is necessary that the policy be called Latin, without spaces or underscores.</em> </li></ol><br><p><img src="http://www.ultima2c.com/support/downloadAttachment?taskId=277202&amp;id=32012" alt="politics"></p><br><h2>  3.3 Ribbon Scheme </h2><br><p>  Then go to the "Ribbon Scheme" and choose the format (recommended by Ebay) and the file format (we prefer XML).  You can also download the archive with examples of feeds (and file structures on the FTP server). </p><br><p><img src="http://www.ultima2c.com/support/downloadAttachment?taskId=277202&amp;id=32015" alt="scheme"></p><br><h2>  3.4 FTP Setup </h2><br><p>  There we receive / generate data for access to the MIP FTP server, where we will load feeds with goods and from where we will collect feeds with reserves. (Server, port, username, password.) </p><br><p>  Setup is complete, then - to the logic </p><br><h2>  3.5 Preparing metadata for storing settings with us </h2><br><p>  For all the above settings for connecting to Mip, you need to create a directory. </p><br><p>  In the reference book, it is proposed to immediately score constants indicating references to the data that will be sent to the MIP and used when pumping reserves. </p><br><pre><code class="hljs pgsql"> EbayAccountSetting ID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-type"><span class="hljs-type">Name</span></span> string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, MipServerAddress string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, MipServerPort Ineteger <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, MipServerLogin string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, MipServerPassword string(<span class="hljs-number"><span class="hljs-number">2048</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, NotifyEmails string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, ), -      ,      ShippingPolicy string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, ReturnPolicy string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, PaymentPolicy string(<span class="hljs-number"><span class="hljs-number">256</span></span>) Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, IsSuborder <span class="hljs-type"><span class="hljs-type">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, LangID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Language</span></span> , - ,    FirmID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> Firm, - ,    OfficeReserveID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> Store, -   StoreReserveID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> Store, -   CurrencyID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> Currency,   PriceTypeID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> PriceType, -    PriceZoneID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> PriceZone, -    AgentGroupID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> AgentGroup, -   PaymentTypeID Long <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> , Reference <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span> PaymentType -     </code> </pre> <br><p>  I recommend adding informational fields, such as a link to an ebay account, a username and password from the site, and so on, so as not to debug this information if necessary. </p><br><p>  Depending on the needs of the client and the specifics of accounting for sales documents, we add links to other directories defining the properties of the created reserves or unloaded goods. </p><br><p>  We also need to make a simple table in the oracle to keep track of what products we loaded into ebay. </p><br><p>  We will need to remove these goods from the sale, if in the main request (goods that are currently in the sample) they will not (availability or price disappear), but in another way they will be pulling out a chore and uncomfortable. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> EBAY_EXPORTED_GOODS ( EBAY_ACOUNT_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">18</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, - FK    EBAY_ACCOUNT_SETTINGS ARTICLE_ID <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>(<span class="hljs-number"><span class="hljs-number">18</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, - FK    ARTICLES UPLOAD_DT <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span> )</code> </pre> <br><p>  We also need to send for each product the code of its category in the EBAy system, and so that managers can easily map our products to their categories will need a directory of Ebay categories. </p><br><p>  We can take as a basis our directory of product categories ArticleGroups.  The new directory will also be a tree. </p><br><pre> <code class="hljs vala">EbayCategories ID <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> PK Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ‚Äì varchar(<span class="hljs-number"><span class="hljs-number">2048</span></span>) ParentID <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> (referential   ) Code ‚Äì <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> (   ebay    PK   SQL    ID         )</code> </pre> <br><p>  Directory must be tree-by-ParentID. </p><br><p>  Finally, in our basic ArticleGroups reference, we will make an EbayCode string. </p><br><p>  In the Editing Form of our native product categories, you need to make sure that the manager can select the appropriate Ebay category.  After selecting, while saving our category in the field </p><br><p>  EbayCode of our ArticleGroups will save the Code of the selected entry from the Ebay Category directory. </p><br><p>  Next, we will need to create Sales Documents, Customers, Shipping Addresses, when importing orders. </p><br><p>  To do this, in the Sale document add EbayDocumentNo string (2048) <br>  In the CustomerAttribute add EbayUserID string (256) <br>  In DeliveryAddress EbayAddressID string (256) </p><br><h1>  4 Integration </h1><br><h2>  4.1 Feed System </h2><br><p>  If we look at the Mip admin panel in the seller‚Äôs office, go to the FTP server with the credentials obtained in 3.4, and also look at the example of feeds downloaded in 3.3, we will see the same structure <br><img src="http://www.ultima2c.com/support/downloadAttachment?taskId=277202&amp;id=32016" alt="feeds1"><br><img src="http://www.ultima2c.com/support/downloadAttachment?taskId=277202&amp;id=32013" alt="feeds2"></p><br><p>  Feeds are divided into folders.  The folders contain feeds of the same name (Availability.xml, Distribution.xml ...) </p><br><p>  3 feeds, we must give ebay, informing about our products, their availability and prices (Availability, Distribution, Product) </p><br><p>  1 feed we need to upload - Order </p><br><p>  The feeds that we download from us to EBAY are placed by us in the root of the corresponding folder.  Everything.  Next, Ebay enqueues itself, transfers it to the processing folder, then to the archive folder, issues a log. </p><br><p>  The feed that we upload from EBAY to us is also taken from the root of the order.  Editing, deleting or doing something else with the file is not necessary. </p><br><p>  Consider which class to write and, most importantly, parse XML to be as convenient as possible. </p><br><p>  Maximum flexibility is desirable, the ability not to go by tags, but to jump over elements and grab them by enumerators, since most of the feed will be slag, which is not necessary to import. </p><br><p>  <a href="https://msdn.microsoft.com/ru-ru/library/system.xml.linq.xdocument(v%3Dvs.110).aspx">System.Xml.Linq.XDocument</a> was enough for <a href="https://msdn.microsoft.com/ru-ru/library/system.xml.linq.xdocument(v%3Dvs.110).aspx">me</a> </p><br><p>  Three feeds are responsible for transferring data from us to Ebay: </p><br><h3>  4.1.1 Product </h3><br><p>  Descriptive info for goods.  Name, attributes (characteristics), category. </p><br><p>  All required tags look in the downloaded example. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productRequest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span>369866<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productInformation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">localizedFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en_US"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>LCD cable for Acer for Aspire 3820, 3820T, 3820G, 3820TG, 3820TZ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productDescription</span></span></span><span class="hljs-tag">&gt;</span></span>LCD cable for Acer for Aspire 3820, 3820T, 3820G, 3820TG, 3820TZ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productDescription</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pictureURL</span></span></span><span class="hljs-tag">&gt;</span></span>http://oursite.com/good_big_pics/369866.jpg<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pictureURL</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">categoryType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"EBAY_LEAF_CATEGORY"</span></span></span><span class="hljs-tag">&gt;</span></span>168061<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- categoryType should be EBAY_LEAF_CATEGORY for the category to be applied. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span>New<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionDescription</span></span></span><span class="hljs-tag">&gt;</span></span>Brand new<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionDescription</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productInformation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">productRequest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Remarks: </p><br><pre> <code class="hljs xml">-<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span>New<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionDescription</span></span></span><span class="hljs-tag">&gt;</span></span>Brand new<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">conditionDescription</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Can be considered constant.  We were unable to understand personally the limitations on posting used goods - The names of Enumerable states that you dig out in the documentation.  The item must be new. </p><br><p>  All tags with the localizedFor = "en_US" attribute mean that for one product you can place different information for different ebay subsites corresponding to the specified locale (for example, different names for En and Ru) </p><br><h3>  4.1.2 Availability </h3><br><p>  Transmits only availability in units. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inventoryRequest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inventory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span>369866<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">totalShipToHomeQuantity</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">totalShipToHomeQuantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inventory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inventoryRequest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  4.1.3 Distribution </h3><br><p>  Prices, purchase limits, POLICIES, which we talked about in 3.2 <br>  Then just need English.  Shipping, Return and Payment Names. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listingDetails</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shippingPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span>BaseShipping<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shippingPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replace business policy names with your seller's business policy names. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxQuantityPerBuyer</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxQuantityPerBuyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span>Base<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replace business policy names with your seller's business policy names. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">returnPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span>BaseReturn<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">returnPolicyName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replace business policy names with your seller's business policy names. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pricingDetails</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listPrice</span></span></span><span class="hljs-tag">&gt;</span></span>7.58<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pricingDetails</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The currency is not indicated here, it is indicated by the client in the personal account. </p><br><h3>  4.1.4 Feed Relationship </h3><br><p>  The rules for posting feeds are very simple. </p><br><ol><li><p>  You yourself set the frequency with which they fast in Ebay, there are no limits.  Accordingly, the task that will generate feeds is adjusted according to the work schedule of other tasks updating the essential parameters of the goods (availability, prices).  Too often, it should not be tugged, since the MIP has its own turn, and sometimes a bulk feed can stand in a queue for a couple of hours. </p><br></li><li><p>  The SKU tag serves as a unique product identifier in 3 feeds; accordingly, it‚Äôs better not to be original, and not to add complex constructions with part numbers there, but to post something equally unambiguous and unique - our product code. </p><br></li><li><p>  Feeds are ‚Äúperceived‚Äù in turn.  First you have to go to the FTP Product, then Availabiliy, then Distribution. </p><br></li><li><p>  Removal of goods is made by sending availability = 0. <br>  Therefore, in advance, provide a table in which you will store goods that have already been posted in MIP </p><br></li><li><p>  Each xml is packaged in zip and put on ftp, in the same folder.  Provide a library to work with FTP. <br>  We took Renci.SshNet.SftpClient <br>  An example of a file upload method by this library </p><br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> Upload(long accountId, string zipFileName, string innerPath) { var EbayAccount = DictionaryManager.GetRecord&lt;EbayAccountSettings&gt;(accountId); var serverAdr = EbayAccount.MipServerAddress; //mip.ebay.com; var port = (<span class="hljs-type"><span class="hljs-type">int</span></span>)EbayAccount.MipServerPort;// <span class="hljs-number"><span class="hljs-number">22</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> = EbayAccount.MipServerLogin; // my acc var <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = EbayAccount.MipServerPassword; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(var fStream = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.FileStream(zipFileName, <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.FileMode.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(var c = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Renci.SshNet.SftpClient(serverAdr, port, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>)) { c.<span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span>(); c.OperationTimeout = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); var fullPath = innerPath +<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Path.GetFileName(zipFileName); <span class="hljs-comment"><span class="hljs-comment">/*innerPath ‚Äì       . , store/availability. zipFileName ‚Äì         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c.<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>(fullPath)) { try { c.DeleteFile(fullPath); } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { LogManager.GetLogger().<span class="hljs-keyword"><span class="hljs-keyword">Info</span></span>(@" ebay files to mip. error delete exist file. fileName = {0}; error = {1}", fullPath, e.Message); } } c.UploadFile(fStream, fullPath, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } } }</code> </pre> <br></li><li>  After a while (depending on the ebay queue), the result of the MIP processing is placed on the FTP in the same folder, in a subfolder <br>  Output / {current_date: M-dd-YYYY} / ....  .xml </li></ol><br><p>  For example: </p><br><pre> <code class="hljs lua">       FTP   /store/availability    /store/availability/<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>/Jul<span class="hljs-number"><span class="hljs-number">-18</span></span><span class="hljs-number"><span class="hljs-number">-2016</span></span>/</code> </pre> <br><ol><li><p>  You can also load in parallel or just watch the results of feed processing in the office in the Tape Archive </p><br></li><li>  In 99% of cases, if there was any mistake, at the Product.xml and Availability.xml stages, MIP will keep silent and say that everything is ok.  The error will be, unless at you frankly malformed xml. </li></ol><br><p>  Even if errors are related to these feeds, errors will only be visible as a result of processing the last feed, Distribution.xml </p><br><ol><li>  The question of whether it makes sense to parse the results of uploading to our epers is an extremely controversial one. <br>  There is no consistency, no serializability in errors. </li></ol><br><p>  Moreover, by interest 70 of them have to apply in writing in support of the MIP, which in itself is an event with 50% performance.  Requests often have to be sent several times, since the success of the request depends on the employee you get. </p><br><p>  Google errors helps a little. </p><br><p>  Also, it often turns out that just Mip himself had some kind of issue about those.  details of which they do not apply, simply stating that Use for Health, we have fixed. </p><br><p>  Also, the presence of an error in the response does not guarantee that all other goods are not loaded. </p><br><p>  Sometimes one mistake blocks all products, even those to which it does not apply, sometimes only from the entire feed. </p><br><p>  Summarizing, we can say that it makes sense to just follow the results of unloading in the office. </p><br><p>  For the sake of tautology, you can stop at this solution: </p><br><p>  Parsing by dates the contents of the folder / output / distribution.  Only capture tags in xml <br></p><p>  And in the textually-informative-list form, simply duplicate them into a separate directory in the date, if the client wants to look at the error in the time, and not in the office. </p><br><p>  Defect response example </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- RequestID: 5089523166 --&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">distributionResponse</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">responseMessage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span>6124<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span>EBAY_RU<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>FAILURE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">errorID</span></span></span><span class="hljs-tag">&gt;</span></span>API_95<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">errorID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">severity</span></span></span><span class="hljs-tag">&gt;</span></span>ERROR<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">severity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag">&gt;</span></span>REQUEST<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">message</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[         .]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">responseMessage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>FAILURE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">distributionResponse</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  So, let's try to generate and fill in successively 3 feeds. </p><br><pre> <code class="hljs ruby">var startDate = DateTime.Now; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,    ,     var accountId = <span class="hljs-number"><span class="hljs-number">1</span></span>L; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  var account = DictionaryManager.GetRecord&lt;EbayAccountSetting&gt;(accountId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  var productDoc = ExportXmlProducts(account, startDate); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> xml   ZipAndUploadFile(accountId, productDoc, <span class="hljs-string"><span class="hljs-string">"Product"</span></span>, <span class="hljs-string"><span class="hljs-string">"/store/product/"</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> var availDoc = ExportXmlAvailability(account, startDate); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> xml   ZipAndUploadFile(accountId, availDoc, <span class="hljs-string"><span class="hljs-string">"Availability"</span></span>, <span class="hljs-string"><span class="hljs-string">"/store/availability/"</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> var distrDoc = ExportXmlAvailability(account, startDate); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> xml     ZipAndUploadFile(accountId, availDoc, <span class="hljs-string"><span class="hljs-string">"Distribution"</span></span>, <span class="hljs-string"><span class="hljs-string">"/store/distribution/"</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span></code> </pre> <br><p>  We form xml Products Products.xml </p><br><pre> <code class="hljs pgsql">private XDocument ExportXmlProducts(EbayAccountSetting account, DateTime startDate) { var listings = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("productRequest"); //   ,       ,    Ebay var <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> = @" SELECT A.ID, NVL(PT.STRING_VALUE, A.ONLINE_NAME) AS NAME, P.VALUE PRICE, CASE WHEN PH.ARTICLE_ID IS NOT NULL THEN PH.ARTICLE_ID||'_'||PH.VIEW_ID ELSE '' END ICON_ID, A.FEATURE_SET_ID, B.NAME, AG.EBAY_CODE EBAY_CODE FROM ARTICLES A JOIN /*        */ VTB_STOCK VB ON VB.ARTICLE_ID=A.ID and VB.STORE_ID =:vStoreID JOIN PRICES P ON A.ID=P.ARTICLE_ID AND P.PRICE_TYPE_ID=:vPriceTypeD AND P.PRICE_ZONE_ID=:vPriceZoneID /*        */ JOIN BRANDS B ON A.BRAND_ID=B.ID JOIN ARTICLE_GROUPS AG ON A.GROUP_ID=AG.ID LEFT JOIN ARTICLE_PHOTOS PH ON A.ID=PH.ARTICLE_ID AND PH.PHOTO_ORDER=1 LEFT JOIN KERNEL.PROP_TRANSLATIONS PT ON PT.VALUE_ID = a.ID AND PT.OBJECT_ID = :vObjectID AND PT.LANG_ID = :vLangID WHERE VB.QUANTITY&gt;VB.RESERVE_QUANTITY /*    */ AND P.VALUE&gt;0 /*    */ AND AG.EBAY_CODE IS NOT NULL /*   Ebay */ "; var pars = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span>&lt;string, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;{ {"vObjectID", productObjectId}, {"vLangID", account.LangID}, {"vStoreID", account.StoreReserveID}, {"vPriceTypeD", account.PriceTypeID}, {"vPriceZoneID", account.PriceZoneID}}; var goods = SqlService.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, pars); // <span class="hljs-type"><span class="hljs-type">xml</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var good <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> goods) { var propNode = GetProperties(Convert.ToInt64(good["ID"]), account.LangID);//   - var productNode = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("product", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("SKU", good["ID"].ToString()), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("productInformation", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XAttribute("localizedFor", "en_US"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("title", good["NAME"].ToString()), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("description", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("productDescription", good["NAME"].ToString())) , "",//propNode, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("pictureUrl", String.Format(@"http://mysite.com/good_pics/{0}.jpg", good["ICON_ID"].ToString())), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("category", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XAttribute("Type", "eBayLeafCategory"), good["EBAY_CODE"].ToString()), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("conditionInfo", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("Condition", "new"), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("conditionDescription", @"Brand new"))) ); listings.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(productNode); AddToExported(Convert.ToInt64(good["ID"]), account.ID, startDate); } var doc = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XDocument(listings); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doc; }</code> </pre> <br><p>  A couple of important notes: </p><br><ul><li>  If you are placing goods not on the Russian-language site, do not forget to pick up the necessary translations of properties. </li><li>  THE CODES OF OBJECTS OF METADATA, WHICH ARE SUBJECT TO TRANSFER, BETTER MOVE INTO A CONSTANT, THEY ARE EQUAL AND INVARIANT FOR A NUCLEUS. <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> productObjectId = <span class="hljs-number"><span class="hljs-number">2952</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> valueObjectId = <span class="hljs-number"><span class="hljs-number">3485</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> featureObjectId = <span class="hljs-number"><span class="hljs-number">3458</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> unitObjectId= <span class="hljs-number"><span class="hljs-number">7680</span></span>;</code> </pre> </li></ul><br><p>  We need to send the characteristics of the goods.  We recall the structure of patterns of description and characteristics.  Our task is to bring all the characteristics of the goods to the form CHARACTERISTIC (string) - VALUE (string), even in cases when it is a matter of several values ‚Äã‚Äãfor one characteristic. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProperties</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> articleId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> langId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sql = <span class="hljs-string"><span class="hljs-string">@"WITH T AS ( WITH T AS (SELECT F.ID AS PROP_ID, NVL(PT.STRING_VALUE, F.NAME) AS PROP_NAME, V.SORT_ORDER, CASE WHEN F.TYPE_ID=1 THEN TO_CHAR(D.NUMBER_VALUE) WHEN F.TYPE_ID=2 THEN TO_CHAR(D.BOOLEAN_VALUE) WHEN F.TYPE_ID=3 THEN (D.STRING_VALUE) WHEN F.TYPE_ID=4 THEN TEXT_VALUE WHEN F.TYPE_ID in (5,6,7) THEN nvl(PT1.STRING_VALUE,V.VALUE) END VAL, CASE WHEN UN.ID IS NOT NULL THEN ' '|| NVL(PT2.STRING_VALUE, UN.NAME) ELSE '' END AS UNIT_NAME FROM ARTICLE_FEATURE_VALUES D JOIN ARTICLE_FEATURES F ON D.FEATURE_ID=F.ID LEFT JOIN ARTICLE_FEATURE_UNITS UN ON F.UNIT_MEASUREMENT_ID=UN.ID LEFT JOIN ARTICLE_FEATURE_VALID_VALUES V ON D.VALUE_ID=V.ID LEFT JOIN KERNEL.PROP_TRANSLATIONS PT ON PT.VALUE_ID = F.ID AND PT.OBJECT_ID = :vPropObjectID AND PT.LANG_ID = :vLangID LEFT JOIN KERNEL.PROP_TRANSLATIONS PT1 ON PT1.VALUE_ID = V.ID AND PT1.OBJECT_ID = :vValObjectID AND PT1.LANG_ID = :vLangID LEFT JOIN KERNEL.PROP_TRANSLATIONS PT2 ON PT2.VALUE_ID = UN.ID AND PT2.OBJECT_ID = :vUnitObjectID AND PT2.LANG_ID = :vLangID WHERE D.ARTICLE_ID=:vProdID ) SELECT PROP_ID, PROP_NAME, LISTAGG(VAL||UNIT_NAME, ',')WITHIN GROUP (ORDER BY SORT_ORDER) VAL FROM T GROUP BY PROP_ID, PROP_NAME"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;{ {<span class="hljs-string"><span class="hljs-string">"vLangID"</span></span>, langId}, {<span class="hljs-string"><span class="hljs-string">"vProdID"</span></span>, articleId}, {<span class="hljs-string"><span class="hljs-string">"vValObjectID"</span></span>, valueObjectId}, {<span class="hljs-string"><span class="hljs-string">"vUnitObjectID"</span></span>, unitObjectId}, {<span class="hljs-string"><span class="hljs-string">"vPropObjectID"</span></span>, featureObjectId} }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> features = SqlService.Select(sql, pars); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> featuresqueue = features.Select(r =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XElement(<span class="hljs-string"><span class="hljs-string">"attribute"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XAttribute(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)r[<span class="hljs-string"><span class="hljs-string">"PROP_NAME"</span></span>]), (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)r[<span class="hljs-string"><span class="hljs-string">"VAL"</span></span>]).ToString()) .ToList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Join(<span class="hljs-string"><span class="hljs-string">""</span></span>, featuresqueue); }</code> </pre> <br><p>  Let's create the residual file Availability.xml </p><br><pre> <code class="hljs pgsql">private XDocument ExportXmlAvailability(EbayAccountSetting account, DateTime startDate) { var listings = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("inventoryRequest"); //        .         -    -   = <span class="hljs-number"><span class="hljs-number">0</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span> = @" SELECT EG.aRTICLE_ID ID, case when last_export_date &lt; :vDat then NVL(VB.QUANTITY, 0) - NVL(VB.RESERVE_QUANTITY, 0) else 0 end QUANTITY FROM EBAY_EXPORTED_GOODS EG LEFT JOIN VTB_STOCK VB ON VB.ARTICLE_ID=EG.ARTICLE_ID and VB.STORE_ID =:vStoreID WHERE EG.EBAY_ACCOUNT_ID=:vId "; var pars = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dictionary</span></span>&lt;string, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;{ {"vId", account.ID}, {"vStoreID", account.ReserveStoreID}}; var goods = SqlService.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>, pars); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var good <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> goods) { var productNode = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("inventory", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("SKU", good["ID"].ToString()), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XElement("totalShipToHomeQuantity", good["QUANTITY"].ToString())); listings.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(productNode); } var doc = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XDocument(listings); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doc; }</code> </pre> <br><p>  By the same principle we form Distribution.xml </p><br><p>  We pack our xml in zip and uploaded the method we already described </p><br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> ZipAndUploadFile(long accountId, XDocument doc, string fileName, string innerPath) { var tempDirectory = @"C:\WINDOWS\Temp\EbayTemp";//     .  ,      <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Directory.CreateDirectory(tempDirectory); var cFullFileName = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Path.Combine(tempDirectory, fileName); var xmlFileName = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Path.ChangeExtension(cFullFileName, "xml"); doc.Save(xmlFileName); var zipFullFileName = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.Path.ChangeExtension(cFullFileName, "zip"); var zipper = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ZipBuilder(); zipper.AddFile(xmlFileName, <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); zipper.SaveArchive(zipFullFileName); Upload(accountId, zipFullFileName, innerPath); }</code> </pre> <br><p>  For the transfer of orders from Ebay to us is responsible 1 feed. </p><br><h3>  4.1.5 Order </h3><br><p>  Orders fall into the order / output folder </p><br><p>  There are also files grouped by date. <br>  {date: M-dd-YYYY} / ....  .xml <br>  For example / store / order / output / Jul-10-2016 / </p><br><p>  You can parse the output folder by date. </p><br><p>  But for convenience, MIP dumps the last response feed into the file / store / order / output / order-latest </p><br><p>  Moreover, the recent order is not overwritten by new ones, but is held there for a certain time.  So even despite the possibility of the file task, current clients had quite regularly (every 5‚Äì10 minutes) to parse this particular file. </p><br><p>  Life hacking: </p><br><p>  For convenience of testing, you can take out logic from the task to the service and create a user command, and for the test, make it possible to transfer the input to the xml file parameter.  Then, for testing, you can download the document in ibeya‚Äôs office or via FTP and run it several times. </p><br><p>  In the header of the sales document, add the EBAY Number field.  When processing an order, we check that there are no orders with such a number (otherwise, we just ignore). </p><br><p>  Finally, all feed orders have already been paid.  The settlement scheme in this case is equivalent to acquiring, where the bank is paypal.  Accordingly, after creating an order, it is necessary to create the appropriate acquiring documents (in the basic configuration via the PaymentService methods). </p><br><p>  The order feed contains the following important information. </p><br><ol><li><p>  INFA client: Fio, email, phone </p><br></li><li><p>  Address, detail, including zip </p><br></li><li><p>  List of products with a unique identifier that you submitted in feeds 1-3 in the SKU tag </p><br></li><li><p>  Price of goods <br>  <em>Do not forget that at the moment of import you can‚Äôt get the actual price for the column, because it is not known what the price of the feed was for which the customer saw and bought this product.</em>  <em>We take it from Ebay.</em> </p><br></li><li>  Delivery price <br>  Total import algorithm should look roughly like this: <br><ul><li>  Take the order number Ebay.  Check whether it has not imported it. </li><li>  Make GetOrCreateAgent - by data (# Fio, email, phone #) </li><li>  We do the agent GetOrCreateDeliveryAddress </li><li>  We create a reserve, fill out the goods with the necessary prices. </li><li>  We activate delivery tch, we put down an address code and the price from Ebay. </li></ul></li></ol><br><p>  Feed example </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pendingOrderFulfillmentResponse</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pendingOrderFulfillment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">orderID</span></span></span><span class="hljs-tag">&gt;</span></span>222034713176-1766499808012<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">orderID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span>EBAY_US<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-07-20T12:45:09.000Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyerID</span></span></span><span class="hljs-tag">&gt;</span></span>andreyka.mosin.1997-3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyerID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">firstName</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">firstName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lastName</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lastName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span>andreyka.mosin.1997@mail.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">email</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">buyer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">seller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sellerID</span></span></span><span class="hljs-tag">&gt;</span></span>pdirect.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sellerID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">seller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logisticsPlan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fulfillmentType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SHIP"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shipping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">shippingType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DIRECT"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shippingService</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">method</span></span></span><span class="hljs-tag">&gt;</span></span>RU_ExpeditedMoscowOnly<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">method</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shippingService</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shipToAddress</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressID</span></span></span><span class="hljs-tag">&gt;</span></span>4504234220015<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phone</span></span></span><span class="hljs-tag">&gt;</span></span>9527720655<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phone</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressLine1</span></span></span><span class="hljs-tag">&gt;</span></span> 16<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressLine1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressLine2</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">city</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">city</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stateOrProvince</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">postalCode</span></span></span><span class="hljs-tag">&gt;</span></span>607183<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">postalCode</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">country</span></span></span><span class="hljs-tag">&gt;</span></span>RU<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">country</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shipToAddress</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">expectedDeliveryDate</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shipping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logisticsPlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lineItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lineItemID</span></span></span><span class="hljs-tag">&gt;</span></span>222034713176-1766499808012<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lineItemID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listing</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span>CustomCode<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channelID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">itemID</span></span></span><span class="hljs-tag">&gt;</span></span>222034713176<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">itemID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span>413480<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SKU</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>ELM327 BlueTooth V1.5 BIG  ELM327 BlueTooth V1.5 BIG chip pic18f25k80<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">listing</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">quantity</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unitPrice</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>990.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">unitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtotal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ITEM"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>990.00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SHIPPING"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span>350.00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ITEM_TAX"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>SalesTax<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>0.00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RECYCLING"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>ElectronicWasteRecyclingFee<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>0.00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sumtotal</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>1340.00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sumtotal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">subtotal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lineItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">payment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentID</span></span></span><span class="hljs-tag">&gt;</span></span>3TD678480B805680J<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>1340.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">payment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ITEM"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>990.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ITEM_TAX"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SHIPPING"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>350.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DISCOUNT"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">amount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">priceline</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sumtotal</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyCode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RUB"</span></span></span><span class="hljs-tag">&gt;</span></span>1340.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sumtotal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">total</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentStatus</span></span></span><span class="hljs-tag">&gt;</span></span>PAID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">paymentStatus</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logisticsStatus</span></span></span><span class="hljs-tag">&gt;</span></span>NOT_SHIPPED<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logisticsStatus</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">note</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">order</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pendingOrderFulfillment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pendingOrderFulfillmentResponse</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Import examples </p><br><pre> <code class="hljs ruby">var accountId = <span class="hljs-number"><span class="hljs-number">1</span></span>L; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  var EbayAccount = DictionaryManager.GetRecord&lt;EbayAccountSetting&gt;(accountId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     var doc = Download(accountId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Renci foreach (var ordXml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> doc.Root.Elements(<span class="hljs-string"><span class="hljs-string">"pendingOrderFulfillment"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ordXml.Elements(<span class="hljs-string"><span class="hljs-string">"order"</span></span>).Count() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { continue; } CreateReserve(ordXml.Elements(<span class="hljs-string"><span class="hljs-string">"order"</span></span>).First(), EbayAccount); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  }</code> </pre> <br><p>  We organize the jump as well as upload our feed to Ebay </p><br><pre> <code class="hljs pgsql">private XDocument Download(long accountId) { var EbayAccount = DictionaryManager.GetRecord&lt;EbayAccountSetting&gt;(accountId); var serverAdr = EbayAccount.MipServerAddress; //mip.ebay.com; var port = (<span class="hljs-type"><span class="hljs-type">int</span></span>)EbayAccount.MipServerPort;// <span class="hljs-number"><span class="hljs-number">22</span></span> var <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> = EbayAccount.MipServerLogin; // my acc var <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = EbayAccount.MipServerPassword; var doc = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XDocument(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(var c = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Renci.SshNet.SftpClient(serverAdr, port, <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>)) { c.<span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span>(); c.OperationTimeout = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); byte[] fileBytes = c.ReadAllBytes(@"/store/order/output/order-latest"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( fileBytes == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || fileBytes.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doc; } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var stream = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO.MemoryStream(fileBytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) { try { doc = XDocument.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Xml.XmlTextReader(stream)); } catch(<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { LogManager.GetLogger().<span class="hljs-keyword"><span class="hljs-keyword">Info</span></span>(@"Import ebay files. error = {0}", e.Message); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doc; }</code> </pre> <br><p>  Actually creating a sales document. </p><br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> CreateReserve(XElement ebayOrdXml, EbayAccountSetting EbayAccount) { var ebayOrderID = ebayOrdXml.Elements("orderID").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CheckOrderExists(ebayOrderID)) //   Ebay      .   .   - . { LogManager.GetLogger().<span class="hljs-keyword"><span class="hljs-keyword">Info</span></span>(@"  "); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } var shippingXml = ebayOrdXml.Elements("logisticsPlan").First().Elements("shipping").First().Elements("shipToAddress").First(); var delivAmountFromEbay = <span class="hljs-number"><span class="hljs-number">0</span></span>M; //  .    ,            . delivAmountFromEbay = <span class="hljs-type"><span class="hljs-type">Decimal</span></span>.Parse(ebayOrdXml.Elements("total").First().Elements("priceline").First().Elements("amount").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>.Trim(), <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Globalization.NumberStyles.AllowDecimalPoint, <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Globalization.CultureInfo.InvariantCulture); //       var phone = shippingXml.Elements("phone").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var firstName = shippingXml.Elements("firstName").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var lastName = shippingXml.Elements("lastName").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var Street1 = shippingXml.Elements("addressLine1").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var Street2 = shippingXml.Elements("addressLine2").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var CityName = shippingXml.Elements("city").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var StateOrProvince = shippingXml.Elements("stateOrProvince").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var PostalCode = shippingXml.Elements("postalCode").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var EbayAddressID = shippingXml.Elements("addressID").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; var ebayBuyerUserID = ebayOrdXml.Elements("buyerID").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>.Trim(); var email =ebayOrdXml.Elements("buyer").First().Elements("email").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; //    var agentID = CreateAgent(firstName, lastName, email, phone,Street1,ebayBuyerUserID, EbayAccount); //    var adressID = CreateAgentAddress(agentID, PostalCode, firstName, phone, CityName, StateOrProvince, EbayAddressID, Street1, Street2); //  ,   var initialSubtype = SaleDocument.Subtypes.Reserve; var document = DocumentManager.NewDocument&lt;SaleDocument&gt;(initialSubtype); document.AgentID = agentID; document.OfficeID = EbayAccount.OfficeReserveID; document.PriceTypeID = EbayAccount.PriceTypeID; document.FirmID = EbayAccount.FirmID; document.StoreID = EbayAccount.StoreReserveID; //  ,  ,  SKU <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(var transXml <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ebayOrdXml.Elements("lineItem")) { var articleNo= Convert.ToInt64(transXml.Elements("listing").First().Elements("SKU").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>); var qty= Convert.ToInt64(transXml.Elements("quantity").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>); //  .    ,            . var price = <span class="hljs-type"><span class="hljs-type">Decimal</span></span>.Parse(transXml.Elements("unitPrice").First().<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>.Replace(".", ",")); document.Articles.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SaleArticleTablePartRow { ArticleID = articleNo, SaleQuantity = qty, ReservedQuantity = qty, OriginalPrice = price, SalePrice = price, Amount = price * qty }); } //         .     outsource.     var deliveryWizardRow = WebService.GetDeliveryWizardRow(document, adressID, AgentType.Constants.CustomerID, DateTime.Now, "outsource", EbayAccount.ID, delivAmountFromEbay); document.DeliveryWizard.Clear(); document.DeliveryWizard.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(deliveryWizardRow); document.Delivery.AddRange(DeliveryService.CreateDeliveries(document)); DocumentManager.SaveDocument(document); }</code> </pre> <br><p>      Ebay </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckOrderExists</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ebayOrderID</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DataContext.GetTable&lt;SaleDocument&gt;().Where(x =&gt; x.EbayDocumentNo == ebayOrderID) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> d).Any(); }</code> </pre> <br><p>       .        Ebay,     ‚Äì  </p><br><pre> <code class="hljs pgsql">private long CreateAgent(string firstName, string lastName, string email, string phone, string Street1, string ebayBuyerUserID, EbayAccountSetting EbayAccount) { var customer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CustomerAttribute() {}; var privatePerson = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PrivatePersonAttribute() {}; var agent = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Agent() {}; var exAgents = (<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DataContext.GetTable&lt;Agent&gt;().<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(x =&gt; x.Customer.EbayUserID == ebayBuyerUserID) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { Id = d.ID, CustomerID = d.CustomerID, PrivatePersonID = d.PrivatePersonID }).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exAgents.<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>()) { customer = DictionaryManager.GetRecord&lt;CustomerAttribute&gt;(exAgents.First().CustomerID.GetValueOrDefault()); privatePerson = DictionaryManager.GetRecord&lt;PrivatePersonAttribute&gt;(exAgents.First().PrivatePersonID.GetValueOrDefault()); agent = DictionaryManager.GetRecord&lt;Agent&gt;(exAgents.First().Id); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { customer = DictionaryManager.NewRecord(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CustomerAttribute { EbayUserID = ebayBuyerUserID, PriceTypeID = EbayAccount.PriceTypeID //. .  }); privatePerson = DictionaryManager.NewRecord(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> PrivatePersonAttribute { GenderID = Gender.Constants.Undisclosed, }); agent = DictionaryManager.NewRecord(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Agent { TypeID = AgentType.Constants.CustomerID, FormID = AgentForm.Constants.PrivatePersonID, GroupID = EbayAccount.AgentGroupID }); } customer.ReserveLifetime = <span class="hljs-number"><span class="hljs-number">1</span></span>; DictionaryManager.SaveRecord(customer); privatePerson.FirstName = firstName; privatePerson.LastName = lastName; privatePerson.Phone =phone; privatePerson.Email = email; DictionaryManager.SaveRecord(privatePerson); agent.Name = string.Format("{0} {1}", lastName, firstName); agent.PrivatePersonID = privatePerson.ID; agent.CustomerID = customer.ID; DictionaryManager.SaveRecord(agent); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> agent.ID; } private long CreateAgentAddress(long agentID, string PostalCode, string firstName, string phone, string CityName, string StateOrProvince, string EbayAddressID, string Street1, string Street2) { var address = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DeliveryAddress() {}; var exAddress = DictionaryManager.GetRecords&lt;DeliveryAddress&gt;(x =&gt; x. EbayAddressID == EbayAddressID);//  . . ebay <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exAddress.<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>()) { address = exAddress.First(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { address = DictionaryManager.NewRecord(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DeliveryAddress { // .        DeliveryAreaID = DeliveryArea.Constants.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>, Latitude = <span class="hljs-number"><span class="hljs-number">0</span></span>M, Longitude = <span class="hljs-number"><span class="hljs-number">0</span></span>M, EbayAddressID = EbayAddressID }); } address.Address = String.Format("{1}, {2}, {3}, {4}", PostalCode, CityName, StateOrProvince, Street1, Street2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address.Latitude == <span class="hljs-number"><span class="hljs-number">0</span></span>) { //   var locations = GeoService.GetLocations(address.Address); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locations.<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>()) { address.Latitude = locations.First().Latitude; address.Longitude = locations.First().Longitude; address.DeliveryAreaID = DeliveryService.FindDeliveryArea(address.Latitude, address.Longitude); } } address.ContactPersonName = firstName; address.ContactPersonPhones = phone; DictionaryManager.SaveRecord(address); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> address.ID; }</code> </pre> <br><h1> 5. Ebay </h1><br><p>  Ebay     .      <br> <a href="http://www.ebay.com/sch/allcategories/all-categories">http://www.ebay.com/sch/allcategories/all-categories</a> </p><br><p>     ,    ,      Ebay,       . </p><br><p> MIP         ,  Products.xml    ,      -         , ,     ). <br></p><p>             (    );      ,    ,             ,     ,      . </p><br><p>    : </p><br><ul><li><p>         Ebay (  3.5) </p><br></li><li><p>     Ebay      (  3.5) </p><br></li><li><p>         </p><br></li><li>      . </li></ul><br><h2> 5.1    Ebay. </h2><br><p>      . Ebay          .    ,          . </p><br><p>       HTML,      <a href="http://www.ebay.com/sch/allcategories/all-categories">http://www.ebay.com/sch/allcategories/all-categories</a>      ,           Api Ebay. </p><br><p>   Api,     MIP,       .         ,            .       ‚Äì  Ebay     Mip. </p><br><h2>  5.2.  API Ebay. </h2><br><p>    Api Ebay     Ebay Developer. <a href="https://developer.ebay.com/base/membership/signin/fyp">https://developer.ebay.com/base/membership/signin/fyp</a>     ,       ,     . </p><br><p>      Application     AppId, DevId  CertId.    ,            Ebay,        ,     . </p><br><h2>  5.3.      </h2><br><p>      string ,    -  Ebay,            . </p><br><p> ,     string </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EbayAppId</span></span> EbayAppToken EbayDevId EbayCertId</code> </pre> <br><p>        Ebay,    ,   . </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EbayEndPoint</span></span> EbayVersion EbaySiteId ‚Äì <span class="hljs-number"><span class="hljs-number">215</span></span>,      .</code> </pre> <br><h2> 5.4  wsdl </h2><br><p>  wsdl    <a href="">http://developer.ebay.com/webservices/latest/ebaySvc.wsdl</a> <br>  ,   ,     <a href="https://go.developer.ebay.com/api-documentation">https://go.developer.ebay.com/api-documentation</a> . <br>       wsdl. <br> ,   . </p><br><p>   wsdl.exe (   c:\Program Files (x86)\Microsoft SDKs\Windows\v8.1A\bin\NETFX 4.5.1 Tools),        . </p><br><p>  : </p><br><pre> <code class="hljs tex">&gt;"c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files (x86)<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Microsoft</span></span></span></span> SDKs<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Windows</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v</span></span></span></span>8.1A<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bin</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NETFX</span></span></span></span> 4.5.1 Tools<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wsdl</span></span></span></span>.exe http://wstest.dpd.ru/services/geography?wsdl /out:MyEbayclass.cs</code> </pre> <br><p> : </p><br><p> a)   x64 .     </p><br><p> )    ,      </p><br><p>      ,     </p><br><h2> 5.5. - </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We put down the handler code the code of the generated wsdl class. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We need to create an object of our class to use it later.</font></font></p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _lock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> eBayAPIInterfaceService EbayService { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_instance == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> ( _lock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_instance == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> eBayAPIInterfaceService(); _instance.Timeout = <span class="hljs-number"><span class="hljs-number">1200000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } }</code> </pre><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get a list of categories from ebay. </font></font></p><br><pre> <code class="hljs cmake">var a = Constants.Url; var endpoint = Constants.Ebay.ApiEndpoint; var callName = <span class="hljs-string"><span class="hljs-string">"GetCategories"</span></span>; var siteId = <span class="hljs-string"><span class="hljs-string">"215"</span></span> ;//  var appId = Constants.EbayAppId;// '// use your app ID var devId = Constants.EbayDevId;// use your dev ID var certId = Constants.EbayCertId; // use your cert ID var version= <span class="hljs-string"><span class="hljs-string">"405"</span></span>; var token = Constants.EbayToken; // Build the request URL var requestURL = endpoint + <span class="hljs-string"><span class="hljs-string">"?callname="</span></span> + callName + <span class="hljs-string"><span class="hljs-string">"&amp;siteid="</span></span> + siteId + <span class="hljs-string"><span class="hljs-string">"&amp;appid="</span></span> + appId + <span class="hljs-string"><span class="hljs-string">"&amp;version="</span></span> + version + <span class="hljs-string"><span class="hljs-string">"&amp;routing=default"</span></span>; EbayService.Url = requestURL; // <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> credentials EbayService.RequesterCredentials = new CustomSecurityHeaderType(); EbayService.RequesterCredentials.eBayAuthToken = token; EbayService.RequesterCredentials.Credentials = new UserIdPasswordType() EbayService.RequesterCredentials.Credentials.AppId = appId; EbayService.RequesterCredentials.Credentials.DevId = devId; EbayService.RequesterCredentials.Credentials.AuthCert = certId; GetCategoriesRequestType request = new GetCategoriesRequestType(); request.Version = <span class="hljs-string"><span class="hljs-string">"405"</span></span>; request.CategorySiteID = <span class="hljs-string"><span class="hljs-string">"215"</span></span>; request.CategoryParent = new <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] {<span class="hljs-string"><span class="hljs-string">"0"</span></span>}; request.ViewAllNodes = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; request.LevelLimit = <span class="hljs-number"><span class="hljs-number">0</span></span>; request.DetailLevel = new DetailLevelCodeType[] {DetailLevelCodeType.ReturnAll}; var a = ConstantManager[<span class="hljs-string"><span class="hljs-string">"Url"</span></span>].ToString(); var endpoint = ConstantManager[<span class="hljs-string"><span class="hljs-string">"Ebay. Api Endpoint"</span></span>].ToString(); var callName = <span class="hljs-string"><span class="hljs-string">"GetCategories"</span></span>; var siteId = <span class="hljs-string"><span class="hljs-string">"215"</span></span> ;//  var appId = ConstantManager[<span class="hljs-string"><span class="hljs-string">"EbayAppId"</span></span>].ToString() ;// '// use your app ID var devId = ConstantManager[<span class="hljs-string"><span class="hljs-string">"EbayDevId"</span></span>].ToString();// use your dev ID var certId = ConstantManager[<span class="hljs-string"><span class="hljs-string">"EbayCertId"</span></span>].ToString(); // use your cert ID var version= <span class="hljs-string"><span class="hljs-string">"405"</span></span>; var token = onstantManager[<span class="hljs-string"><span class="hljs-string">"EbayToken"</span></span>].ToString(); // Build the request URL var requestURL = endpoint + <span class="hljs-string"><span class="hljs-string">"?callname="</span></span> + callName + <span class="hljs-string"><span class="hljs-string">"&amp;siteid="</span></span> + siteId + <span class="hljs-string"><span class="hljs-string">"&amp;appid="</span></span> + appId + <span class="hljs-string"><span class="hljs-string">"&amp;version="</span></span> + version + <span class="hljs-string"><span class="hljs-string">"&amp;routing=default"</span></span>; GetCategoriesResponseType cats = EbayService.GetCategories(request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cats.Errors != null &amp;&amp; cats.Errors.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(var er in cats.Errors) { //     } throw new Exception(<span class="hljs-string"><span class="hljs-string">"      "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( cats.CategoryArray == null || cats.CategoryArray.Length &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { //   ,     ,     } CategoryType[] catArray = cats.CategoryArray; SyncronizeCats(-<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, catArray); //    </code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's write the function of importing lines with categories from Ebay, let's not forget to delete records from us that do not come anymore. </font><font style="vertical-align: inherit;">It is better to go ladder on the directory tree</font></font></p><br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> SyncronizeCats(long parentID, string ebayParentCode, CategoryType[] catArray) { //          var ourEbayCats = DictionaryManager.GetRecords&lt;ArticleGroup&gt;(x =&gt; (x.ParentID == parentId)); //    var processedCodes = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;string&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(var ebayCat <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> catArray.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(c =&gt; (string.IsNullOrEmpty(ebayParentCode) &amp;&amp; c.CategoryLevel == <span class="hljs-number"><span class="hljs-number">1</span></span> ) || (c.CategoryParentID != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; c.CategoryParentID.<span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>(h =&gt; h.Trim() != c.CategoryID &amp;&amp; h.Trim() == ebayParentCode)))) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!string.IsNullOrEmpty(ebayCat.CategoryID) &amp;&amp; !string.IsNullOrEmpty(ebayCat.CategoryName)) { GetOrCreateCategory(bayCat.CategoryID.Trim(), ebayCat.CategoryName, parentID); processedCodes.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(ebayCat.CategoryID.Trim()); } } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(var catRow <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ourEbayCats) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(processedCodes.Contains(catRow.EbeyCode))) { // ,       DictionaryManager.DeleteRecord&lt;ArticleGroup&gt;(catRow.ID); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //   SyncronizeCats(catRow.ID, catRow.Code, catArray); } } }</code> </pre> <br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And finally, an update or the creation of a category. </font></font></p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrCreateCategory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ebayCategoryID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ebayCatCategoryName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parentID</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ebayCat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArticleGroup() { }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cats = DictionaryManager.GetRecords&lt;ArticleGroup&gt;(x =&gt; x.Name == ebayCatCategoryName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cats.Any()) { ebayCat = cats.First(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ebayCat = DictionaryManager.NewRecord( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArticleGroup() { }); } <span class="hljs-comment"><span class="hljs-comment">// ,     DictionaryManager.SaveRecord(ebayCat); }</span></span></code> </pre> <br><h1>  Total </h1><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Technically, integration is not difficult (the entire volume of the code does not exceed several killobytes), but in detail a lot of pitfalls emerge with some of which we tried to introduce you. </font></font></p><p></p><p></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307782/">https://habr.com/ru/post/307782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307770/index.html">Secrets of cloud PBX: a few words about recording conversations</a></li>
<li><a href="../307774/index.html">Android application traffic analysis: certificate pinning bypass without reverse engineering</a></li>
<li><a href="../307776/index.html">Basics of game design: 20 board games. Part Six: Nuclear War, Paranoia, Call of Cthulhu</a></li>
<li><a href="../307778/index.html">Record time: how we increased the launch speed of Mail.Ru Mail application on iOS</a></li>
<li><a href="../307780/index.html">Breaking Equation Group: Stuxnet, Duqu and Flame creator files are sold at auction</a></li>
<li><a href="../307784/index.html">How to check website availability online? Service overview HostTracker. Part 2</a></li>
<li><a href="../307786/index.html">Waiting for Linux version: checking the code of the graphical editor Inkscape</a></li>
<li><a href="../307788/index.html">The killer bug. Figak, figak and Therac-25</a></li>
<li><a href="../307790/index.html">The first post on Habr√© or Why we are engaged in clouds</a></li>
<li><a href="../307792/index.html">Known cyber-grouping Equation Group could undergo large-scale hacking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>