<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to refactor 17 thousand lines of CSS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many of us are working on big projects. The one I‚Äôm talking about has been living for 15 years now and has a couple of dozen web applications on ASP.N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to refactor 17 thousand lines of CSS</h1><div class="post__text post__text-html js-mediator-article">  Many of us are working on big projects.  The one I‚Äôm talking about has been living for 15 years now and has a couple of dozen web applications on ASP.NET WebForms, the main one of which contains about 1,500 aspx pages. <br><br>  Why so much?  The desire to adapt to customers with different requirements makes itself felt.  Everyone wants some of their own special functionality and eventually gets it.  But it's not about that.  In addition to a large number of pages, we had a lot of CSS styles.  Lots of. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ff3/174/0c9/ff31740c9bd042969c0789ff46e10e36.jpg" alt="Picture to attract attention"></div><br>  Source: Ursus Wehrli.  The art of clean up 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Initially, there was one web project.  He had one CSS file.  The file was not too large, and its readability did not cause anyone questions.  Time went by, people came, created new functionality and added selectors to the CSS file.  It didn‚Äôt look very scary, the contents could still be sorted out. <br><br>  Then the time came for complex functionality, when the styles of controls, located on certain pages, on which a certain class was hung, overlapped.  UI was liked by designers and users, and the class moved to other pages without any semantic connection with the original place.  At some point, the file turned into a giant garbage dump of 17 thousand lines. <br><br>  In order not to seem too simple, the system invented custom-made skins (separate styles) for individual customers.  These 17 thousand lines for all are common, and here we‚Äôll render a little more to customize text and background colors.  In fact, it was not at all a bit, but very much.  Kilometers of CSS, and some of them could be quite common for everyone. <br><br><h1>  Problem </h1><br>  We knew that despite the apparent <em>visual</em> integrity of the design, there are a lot of exceptions to the rules in the project.  Here, for example: <br><ul><li>  12 different grids that look not so similar, but not so completely different. </li><li>  4 variants of toolbars over grids with three variants of buttons and drop-down lists (also different, but suspiciously similar in style). </li><li>  Even informational messages, which are just a text with an icon on a red, yellow or blue background, and then there were 2 options. </li></ul><br>  Here we must say one more thing.  We have more than one web project.  Controls and styles for each of them developed in parallel for quite a long time, when, finally, someone had no bright idea to combine all this and bring to the library of common controls with some of the common styles (which can then be overlapped in each of the projects).  The writing of this library did not mark the unification of everything and everything and the removal of duplicates.  Instead, the controls and styles became even more.  A common grid in a shared library is a useful thing, but you cannot delete the 12 available from three hundred places throughout the project - not a single normal team will subscribe to it.  In general, at some point, the people no longer understand which of our many controls should be used in this or that case.  Each of them can implement any specific behavior that occurred to the designer at the time of design of a specific functionality. <br><br>  And we also stumbled upon a known problem in Internet Explorer 9, which for some reason refused to accept more than 4095 selectors in our glorious file. <br><br>  And so we had to completely change the entire design of the application.  It was clear that simply changing the design would be more expensive for us - we need to refactor CSS first.  All CSS.  Product owners understood the situation and we got the go-ahead for refactoring. <br><br><h1>  Getting started </h1><br>  So, we all agreed and got freedom of action - we begin to rake rubble.  What we have in stock? <br><ul><li>  One giant CSS file with 17 thousand lines for the main web application </li><li>  More than 50 custom skins, for each separate CSS file.  In theory, only minor differences should be present in it, in practice, quite sickly pieces of the common code were encountered. </li><li>  CSS file with the library of controls, which was used not only mainly, but also in other applications. </li><li>  CSS files additional applications.  It was all easy if only because they were all with copy-paste, but rather small </li></ul><br>  The first thing we started with was the removal of unused styles.  Everything is simple with the C # code, the analyzer included the solution, and it showed which public methods can be removed.  With styles, the only way is a text search by solution.  If you are ever asked to clean 17 thousand lines in a CSS file in a solution from two hundred and fifty projects in this way, ask yourself an SSD disk.  The process will go a little faster. <br><br>  But if you are only planning to write such a giant project from scratch, here are some tips for you: <br><br><h2>  Always use the selector name in the code completely. </h2><br>  Never break it apart, for example: <br><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ProgressBar = <span class="hljs-string"><span class="hljs-string">"progressbar"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ProgressBarSmall = ProgressBar + <span class="hljs-string"><span class="hljs-string">"small"</span></span>;</code> </pre> <br>  You will find a large progress bar, and remove a small progress bar as unused when refactoring.  Then you have to restore.  Do you think, and so remember what is used and what is not?  In the project from one and a half thousand pages?  And with hundreds of settings that enable and disable various features? <br><br>  Also, do not be smart with designs of this type: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Feedback</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> CssClass = GetType().ToString(); }</code> </pre><br>  Firstly, for class heirs it still does not work ( <code>GetType()</code> should be changed to <code>typeof(Feedback)</code> ), secondly, it is impossible to look for. <br><br>  Just store the text.  Search in the text in the solution with preserve case and whole word.  Do not complicate your life. <br><br><h2>  Use prefixes. </h2><br>  About this is to tell separately below.  For now, let us omit the possibility of conditionally dividing selectors belonging to different modules, giving them separate prefixes. <br><br>  Using CSS classes with the following names is impossible to search: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.hidden</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.visible</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.error</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span></code> </pre><br>  Much nicer with prefixes.  The first two can be conditionally attributed to helpers - helpers.  Give them the prefixes: <code>.h-hidden</code> and <code>.h-visible</code> .  Already you can search!  If the classes are specific, then the project name can be used.  <code>MyProject</code> ?  Let it be <code>.mp-</code> .  Say <code>.mp-login-page</code> .  Are controls common?  - <code>.ct-</code> <br><br>  Some third party libraries also use prefixes.  By prefix it becomes easy to distinguish what the code belongs to.  In addition, a small risk of crossing names is eliminated. <br><br><h2>  Do not use the same selector names for different needs. </h2><br>  Let's say <code>.error</code> and <code>.text</code> from the previous example is a completely neglected case.  Selectors are not always unique and can be used quite differently in different cases. <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.mp-login-page</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.error</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red; } <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-feedback</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.error</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: red; }</code> </pre><br>  I would replace it with the following selectors: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.mp-login-page-error</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>:red; } <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-feedback-error</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: red; }</code> </pre><br>  Bulky?  Sure.  But well searched and removed. <br><br><h2>  Make yourself a list of styles </h2><br>  Make yourself a static class indicating if not all, then at least often used styles.  It will be much easier to search and then rename. <br><br><h1>  Acting </h1><br>  My uncle always said that even at the construction stage, it is necessary to think about how to make it so that, if desired, all this could be most easily broken. <br><br>  Do you think your project is small and you don‚Äôt have to?  We did not think either, and the project turned into <s>a</s> very large <s>monster</s> .  In general, the removal of unused styles is quite a normal situation.  There were a lot of unused classes, quite often it was possible to delete several text screens in a row.  As a result, in our file of 17 thousand lines there are only ... 16 thousand.  Is it true that we use all of this?  Yes!  This is our all acquired over the years.  All you need! <br><br>  What's next?  It turned out that we still have a lot of selectors, and after cleaning all 100% of them are used.  When we deleted unused styles, we paid attention to such selectors, in which the class name was found only once. <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.personal-report-bottom-section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.users-overview-header</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-left</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; }</code> </pre><br>  It turned out somehow quite stupid.  A bunch of similar styles in single-use classes.  The idea was borrowed from <a href="http://getbootstrap.com/">Bootstrap</a> - use helper classes.  Let's say for <code>margin-top: 10px</code> you can use the name <code>.h-mt10</code> , for <code>padding-left: 15px;</code>  - <code>.h-pdl15</code> .  This helped to clear out many more places. <br><br>  Then they began to look for repeating pieces.  The most popular was to have a hyperlink or plain text with a picture on the left (): <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ct-imagewithtext</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: none; } <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-imagewithtext</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-imagewithtext</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; } <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-imagewithtext</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">4px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-imagewithtext</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">span</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: underline; }</code> </pre><br>  I think that there were 20 similar styles in the code, no less.  But each time the class names were new, the styles sometimes differed slightly, and sometimes quite seriously.  In the process of transformation, the project began to improve visually - small but noticeable differences on different pages began to wear out. <br><br>  Later we managed to refactor similar controls with completely different styles - we removed rarely used ones, changing them for analogues.  If there were too many uses, they took the most successful from the point of view of the CSS control and ‚Äúput on‚Äù everything else for it.  Not everything was able to remove or make up, but more on that later. <br><br>  Finally, the hands reached the library of common controls.  As I already wrote, only a part of styles was brought to the general part.  Then these styles already overlapped in each of our web applications.  The idea was not very successful - everything that overlapped overlapped in each application in the same way, i.e.  It was actually copy-paste.  However, not quite.  When the design needed a bit of color change, it was changed only in one place, forgetting about the rest.  We carried it all into a common part and then killed copy-paste for a long time.  Applications are good - toolbars, grids and other controls of different colors became similar to each other. <br><br>  At some point, we realized that it would be nice to bring some kind of CSS Reset to this library.  Prior to this, CSS Reset was presented in only two applications, and each has its own.  As a result, it was decided to use <a href="">Normalize.css</a> , which we included at the very beginning.  There we also added basic styles for our application - the size and typeface (also different everywhere) and many other things. <br><br>  At that moment, we were still doing some sort of copy-paste removal and style unification.  Finally, the hands reached the custom skins.  In fact, they didn‚Äôt change the interface much, but for some reason they contained a huge amount of styles.  The skins were about 50, some older ones were handwritten, the newer ones used LESS.  Despite this, there was no common pattern, the generation was done manually, and the result was then docked to some common part.  We started with them.  First of all, the general pattern was taken out (not all coincided) and the repeating part.  Secondly, we configured the generation of CSS files during the project build using the <a href="https://github.com/duncansmart/less.js-windows">lessc</a> utility.  Then they proceeded to the old skins, where LESS was not used. <br><br>  Despite the large amount of code, everything turned out to be not much changed by copy-paste.  In the end, we got the same common part for everyone, a 1.5 screen template and 50 less-files with 15 variables for individual customization of the skin. <br><br>  The common piece was carried to the end of our giant file.  Since, with equal weights of CSS selectors, the priority will be beyond what is below in the text, this is important.  At a further stage of refactoring, the add-on to Visual Studio - <a href="http://vswebessentials.com/">Web Essentials</a> helped us a lot.  A piece is very useful, if briefly, a kind of resharper for CSS.  In addition to finding syntax errors and tips to add the missing vendor prefix, Web Essentials helps you look for the same classes inside a file.  And it turned out that such a situation often occurred in our code. <br><br>  The selector is defined, say, on the 6255th line: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.topmenu-links</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: blue; }</code> </pre><br>  Then somewhere on the 13467th: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.topmenu-links</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: green; }</code> </pre><br>  I exaggerate a little, but it was like this.  And the case was not a single, but a massive one.  Reached and to four overlappings.  Web Essentials mercilessly swears at such things, so that all of them were found and deleted.  As I said, when the selector weights are equal, the priority is lower, so we remove the selectors from above and combine them.  The process is a bit risky.  With a large number of different styles, hung on the same element and the scatter of selectors in the file, movement is fraught with a change of priority.  But there's nothing you can do.  During the whole work, our QA periodically walked through all the pages of the system and compared the view with the production. <br><br>  At some point, we were ripe to break our huge CSS into pieces by segment.  It turned out 120. With the build, the file was going back to one.  And after a while we switched to LESS. <br><br><h1>  How is it now </h1><br>  Let's see how it all looks like an <a href="https://github.com/yarosf1/CssSampleSolution">example</a> . <br><br>  Let's slightly simplify the task and imagine that we have a library of common controls ( <code>CommonControls</code> ) and a project for static content (CDN), which is used in the main web project. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b33/49d/ee9/b3349dee96454a89b091fe59bff13fb0.png" alt="Screenshot of solution with projects"></div><br><br>  In the library with controls, LESS-files that are built into one ( <code>common-controls.less</code> ) during a build and then translated into CSS ( <code>common-controls.css</code> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6a6/e04/af3/6a6e04af3a884b2289f27cfefd4253ea.png" alt="CommonControls Project Screenshot"></div><br><br>  Consider a little more detail what is stored. <br><ul><li>  <code>01-essentials.less</code> stores only variables and mixins.  They are used by LESS files of the library of controls, as well as files of other projects. </li><li>  <code>02-normalize.less</code> .  I already talked a little about him.  It stores the CSS normalization code, slightly modified for the needs of the project. </li><li>  <code>03-default-styles.less</code> stores common styles (for example, the background color of the <code>body</code> element, the typeface of the font used, etc.) </li><li>  <code>04-helpers.less</code> stores helper classes, like the margins, paddings already described. </li><li>  Next come the actual control styles. </li></ul><br>  Customize Build Events for the CommonControls project.  I put everything in a separate file so as not to edit and merge the project file each time the contents of the script change. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c62/b91/44f/c62b9144fd434ffa8449efe79ebe7504.png" alt="The build events settings window"></div><br><br>  The script code is very simple.  Putting together all the LESS files in the <code>Stylesheets</code> folder and transferring the result to the <code>CombinedStylesheets</code> folder.  Then we run the preprocessor and get the finished CSS. <br><pre> <code class="hljs perl">set ProjectDir=%~<span class="hljs-number"><span class="hljs-number">1</span></span> copy <span class="hljs-string"><span class="hljs-string">"%ProjectDir%Stylesheets\*.less"</span></span> %ProjectDir%CombinedStylesheets\common-controls.less call <span class="hljs-string"><span class="hljs-string">"%ProjectDir%..\Tools\lessc\lessc.cmd"</span></span> %ProjectDir%CombinedStylesheets\common-controls.less %ProjectDir%CombinedStylesheets\common-controls.css</code> </pre><br>  Now look at the styles of the Cdn project.  In the <code>_cssparts</code> folder are project styles, which are then <code>_cssparts</code> into the <code>combined.less</code> file.  There are a lot of files in a real project.  In the screenshot, everything is a bit simplified. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d4c/ff7/5d9/d4cff75d9296487eb8ec1dc5e8370aa8.png" alt="Cdn Project Screenshot"></div><br><br>  The sequence of files does not really matter, except for the first and the last one. <br><br>  <code>001-imports.less</code> contains the following code: <br><pre> <code class="css hljs">// <span class="hljs-selector-tag"><span class="hljs-selector-tag">Importing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">LESS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">template</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CommonControls</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"../../CommonControls/Stylesheets/01-essentials.less"</span></span>; // <span class="hljs-selector-tag"><span class="hljs-selector-tag">Usual</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">CSS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"common-controls.css"</span></span>;</code> </pre><br>  The first directive imports the contents of the LESS file, in this case <code>01-essentials.less</code> .  This is the same as if we were concatenating this file along with the rest when combined.  Import allows you to use all the variables and mixins that we defined in the <code>CommonControls</code> library.  The second directive - classic import - is generated in the resulting CSS as is.  In general, CSS imports are not recommended, and the only reason why it is here is IE9. <br><br>  <code>z-ie9-special.less</code> contains one single selector, which is the most recent in the combined file and is used on a special page to understand whether it is used or not.  If the total number of selectors has exceeded 4095, the style will not apply.  So you need to break the file into pieces.  In fact, we had to not combine the resulting CSS of the control library and the actual CSS for the web project. <br><br>  When building, the following things happen: <br><pre> <code class="hljs perl">@REM Copy common controls stylesheet COPY %ProjectDir%..\CommonControls\CombinedStylesheets\common-controls.css <span class="hljs-string"><span class="hljs-string">"%ProjectDir%Skins\common-controls.css"</span></span> /Y @REM Combine CDN LESS files <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> run preprocessor copy <span class="hljs-string"><span class="hljs-string">"%ProjectDir%Skins\_cssparts\*.less"</span></span> %ProjectDir%Skins\combined.less call <span class="hljs-string"><span class="hljs-string">"%ProjectDir%..\Tools\lessc\lessc.cmd"</span></span> %ProjectDir%Skins\combined.less %ProjectDir%Skins\combined.css</code> </pre><br>  The combined <code>Skins</code> library of kontrol and CSS for the web project gets to the root <code>Skins</code> folder.  In real projects, combining the resulting CSS can be made more elegant than file concatenation, but this is just an example. <br><br>  Now let's look at the generation of custom skins. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/165/4d1/2af/1654d12afafa4e6abae19bf8be89849d.png" alt="Screenshot of the folder with custom skins in the Cdn project"></div><br><br>  In the <code>_custom-parts</code> folder <code>_custom-parts</code> is a template for generating <code>custom-template.less</code> .  Suppose that for the time being we need only to customize the colors of the H1 and H2 headers (in reality, of course, there are a lot more things).  <code>custom-template.less</code> will look like this: <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: @h1Color; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: @h2Color; }</code> </pre><br>  <code>Default-values.less</code> will contain the values ‚Äã‚Äãof variables by default (to be able to overlap in the skin, not everything, but only some of the values): <br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">h1Color</span></span>: #F58024; @<span class="hljs-keyword"><span class="hljs-keyword">h2Color</span></span>: #E67820;</code> </pre><br>  In each of the skins ( <code>skin.less</code> ) there will be something like this code: <br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"..\_custom-parts\default-values.less"</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">h1Color</span></span>: #<span class="hljs-number"><span class="hljs-number">000</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">h2Color</span></span> : #<span class="hljs-number"><span class="hljs-number">707050</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"..\_custom-parts\custom-template.less"</span></span>;</code> </pre><br>  Import the default values, overlap them with your values ‚Äã‚Äãand import the template. <br><br>  To generate all this, we write such code in the pre build event: <br><pre> <code class="hljs vbscript">@<span class="hljs-keyword"><span class="hljs-keyword">REM</span></span> Regenerate customskins using their LESS templates <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /r <span class="hljs-string"><span class="hljs-string">"%ProjectDir%Skins\"</span></span> %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.less) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"%%~nxi"</span></span>==<span class="hljs-string"><span class="hljs-string">"skin.less"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-string"><span class="hljs-string">"%ProjectDir%..\Tools\lessc\lessc.cmd"</span></span> <span class="hljs-string"><span class="hljs-string">"%%~dpnxi"</span></span> <span class="hljs-string"><span class="hljs-string">"%%~dpni.css"</span></span> )</code> </pre><br>  At the output, next to each <code>skin.less</code> we obtain <code>skin.css</code> for an example above of this type: <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#000000</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">h2</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#707050</span></span>; }</code> </pre><br>  In general, at first, the contents of our LESS files (not counting custom skins) were no different from regular CSS.  With a few exceptions, when the parser refused to accept an invalid code, let's say this: <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">margin-top</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-4px</span></span>\0/<span class="hljs-selector-tag"><span class="hljs-selector-tag">IE8</span></span>+9;</code> </pre><br>  Not sure what the hack for IE looks like, but God bless him.  In LESS, you can escape a string using <code>~""</code> characters: <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">margin-top</span></span>: ~"<span class="hljs-selector-tag"><span class="hljs-selector-tag">-4px</span></span>\0/<span class="hljs-selector-tag"><span class="hljs-selector-tag">IE8</span></span>+9";</code> </pre><br>  Everything else went without problems.  Soon began to appear unpretentious variables: <br><pre> <code class="css hljs">@<span class="hljs-keyword"><span class="hljs-keyword">tDefaultFontSize</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>;</code> </pre><br>  Then the mixins are more complicated: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.hAccessibilityHidden</span></span>() { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>: -<span class="hljs-number"><span class="hljs-number">10000px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: -<span class="hljs-number"><span class="hljs-number">4000px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overflow</span></span>: hidden; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span>; }</code> </pre><br>  The meaning of this mixin is that in addition to its use in the auxiliary class, it is also used in some others.  In our case, it has become even more interesting.  When at some point we realized that it was not possible to rewrite, and even ‚Äúmake up‚Äù the styles of 12 grids, it was a good idea to take out common colors and styles into variables and mixins.  It turns out that for old projects LESS is even more interesting than for new ones.  In general, there is where to roam.  For example, background-image generation for buttons of various types in the presence of a sprite: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-helper</span></span>(@<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, @name, @buttonHeight: <span class="hljs-number"><span class="hljs-number">30</span></span>, @buttonBorderThickness: <span class="hljs-number"><span class="hljs-number">1</span></span>) { @<span class="hljs-keyword"><span class="hljs-keyword">className</span></span>: ~<span class="hljs-string"><span class="hljs-string">".ct-button-@{name}"</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>: (@buttonHeight - <span class="hljs-number"><span class="hljs-number">2</span></span>*@buttonBorderThickness - @buttonIconSize) / <span class="hljs-number"><span class="hljs-number">2</span></span>; @<span class="hljs-keyword"><span class="hljs-keyword">positionY</span></span>: @offset - (@index * (@buttonIconSize + @buttonIconSpacingInSprite)); @{<span class="hljs-selector-tag"><span class="hljs-selector-tag">className</span></span>} { <span class="hljs-attribute"><span class="hljs-attribute">background-position</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unit</span></span>(@positionY, px); } @{<span class="hljs-selector-tag"><span class="hljs-selector-tag">className</span></span>}<span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-rightimage</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-position</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unit</span></span>(@positionY, px); } }</code> </pre><br>  Call something like this: <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-helper</span></span> (0, "<span class="hljs-selector-tag"><span class="hljs-selector-tag">save</span></span>"); <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-helper</span></span> (1, "<span class="hljs-selector-tag"><span class="hljs-selector-tag">save</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[disabled]</span></span>"); <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-helper</span></span> (2, "<span class="hljs-selector-tag"><span class="hljs-selector-tag">cancel</span></span>"); <span class="hljs-selector-class"><span class="hljs-selector-class">.ct-button-helper</span></span> (3, "<span class="hljs-selector-tag"><span class="hljs-selector-tag">cancel</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[disabled]</span></span>");</code> </pre><br>  It is also good to generate CSS for font descriptions, although the mixin implementation often depends on the specific font. <br><br><h1>  Summary </h1><br>  Let's take a quick look at what we did. <br><ul><li>  We cleaned out a huge amount of unused styles. </li><li>  Removed a large number of classes that are used only in one place, replacing them with auxiliary classes.  In fact, this is a very significant part of all the CSS in the project, do not underestimate this point. </li><li>  Brought the general part of the custom skins, adding it to the end of the main CSS.  This item was important to perform before the following.  Used LESS to generate custom skins. </li><li>  We removed a large number of overlaps of the same class several times in the same CSS file.  This is where WebEssentials helped.  This item was also important to perform before the next one. </li><li>  Split common CSS into pieces for easy editing.  When building, all these parts are assembled into one file. </li><li>  Brought overlapping styles of controls into the styles of controls themselves.  Removed copy-paste in the styles of other applications. </li><li>  Since all applications used a uniform design style, the common parts (normalize.css, font sizes, background colors) were also brought to the library of controls, removing pieces of CSS from all web applications. </li><li>  Switched to LESS in all web applications. </li><li>  Brought some of the frequently used things into variables and mixins in the library of controls, connected them to each web application, so that you can use them everywhere. </li><li>  Made a C # wrapper (a simple static class with static plugs) for commonly used CSS classes.  Not for everyone, there are a lot of them, and there is not always meaning. </li><li>  Introduced prefixes ... Not in all places, but in frequently used ones.  We try to use prefixes for all new styles <s>, but don't care</s> . </li></ul><br>  In general, we regained control over the code.  Subsequent redesign was no problem.  In addition, they made it smarter by changing component by component.  Not to say that the code was perfect or that it was 10 times smaller.  We still have a lot of things, and it can be difficult to understand.  But on the other hand, the number of copy-paste has significantly reduced, and as a result there are fewer visual differences in different parts of the system, which in theory should look the same. </div><p>Source: <a href="https://habr.com/ru/post/265433/">https://habr.com/ru/post/265433/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265415/index.html">REG.RU introduces the verification and treatment of sites for viruses and threats with the help of Virusday.Server</a></li>
<li><a href="../265417/index.html">VAD (Voice Application Designer). Part 1 Review</a></li>
<li><a href="../265419/index.html">Why does Microsoft Edge hate bookmarks?</a></li>
<li><a href="../265421/index.html">HostGator vs Bluehost. Which one is better?</a></li>
<li><a href="../265427/index.html">The world is driven by language C</a></li>
<li><a href="../265435/index.html">Callback services: what customers want</a></li>
<li><a href="../265437/index.html">Primary key - GUID or autoincrement?</a></li>
<li><a href="../265441/index.html">Vim as not IDE</a></li>
<li><a href="../265443/index.html">Dijkstra's algorithm and our perishable world</a></li>
<li><a href="../265445/index.html">Windows 10 through 10. Issue # 1. How to increase the visibility and frequency of installations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>