<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculation errors in the vicinity of machine zero</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Periodically on Habr√© there are great articles about the intricacies of floating point arithmetic. Actually, the mentioned publication was one of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculation errors in the vicinity of machine zero</h1><div class="post__text post__text-html js-mediator-article">  Periodically on Habr√© there are <a href="http://habrahabr.ru/blogs/cpp/112953/">great articles</a> about the intricacies of floating point arithmetic.  Actually, the mentioned publication was one of the first sources read in attempts to deal with the problem.  This did not immediately become clearer, but nevertheless, the organization of neural connections somehow got streamlined.  Get to the point. <br><br>  The problem was formed when performing calculations in the framework of a single project and a future master's thesis on the hydrodynamics of a porous medium.  I don‚Äôt hide the fact that the roots are hidden partly in the author‚Äôs personal curvature and neglecting commonplace known tips regarding the processing of small numbers, but nevertheless, this led to quite interesting observations and reflections. <br><br><a name="habracut"></a>  If we discard the physical essence, the task is to solve the system of seven partial differential equations.  Said and done, there is no difficulty in this particular - we write an explicit finite-difference scheme, parallelize on OpenMP and after final syntax debugging and speed optimization <a href="http://bash.org.ru/quote/401019">‚Äúthe machine starts to rustle‚Äù</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Computational configuration: an HP 550 with a Core 2 Duo 1.8 GHz onboard, running Ubuntu 11.04. <br><br>  Compilers: gfortran 4.5.2 and Intel Fortran Compiler 12.1.0. <br><br>  In the initial conditions, it is assumed that there is no water in the liquid state inside the calculated area ‚Äî it appears during phase transformations.  And it is precisely this absence that played the main role in our performance. <br><br>  So, there is no water in the area.  What do you want to write in the initial condition?  Naturally, 0.0D + 00 was immediately written (the program was written with double precision of real numbers).  The account at the initial stages goes in the immediate vicinity of the machine zero.  What are the results?  Let's look at the chart: <br><br><img src="https://habrastorage.org/storage2/479/3a0/2ca/4793a02ca66dca69caeda2c93021bb49.png" alt="Zero"><br><br>  Here is the pore saturation distribution with water along the coordinate in the most interesting part of the computational domain after a little more than a day of the physical time of the model. <br><br>  <i>The necessary digression about the signatures in the legend of the schedule: a total of 18 different key combinations were tested (6 for gfortran and 12 for ifort), but many of them gave exactly the same results, and therefore were combined.</i>  <i>The square brackets in the legend mean that any of the options contained in them could have been written.</i>  <i>For example, ‚Äúencryption‚Äù -O [1,2,3] [-fp-model [strict] [precise]] says that the compiler was used with the optimization of all possible levels, and in addition one floating-point model could be included (and could not be included).</i>  <i>Three options (two from -fp-model and one without it) multiplied by three levels of optimization - a total of nine combinations.</i>  <i>All of them were equivalent.</i> <br><br>  And now the result.  Something realistic and physically possible was obtained only on gfortran without the inclusion of compliance with the IEEE 754 standard (key -ffloat-store).  The rest of the chaos of lines does not contain a single drop of physical meaning, because even mathematically, equations do not allow this.  The initially suspected instability of the difference scheme was justified, since no methods of dealing with it were successful. <br><br>  It was noted that when water is available at the initial moment, the score remains stable and the differences between options and compilers are hidden in the vicinity of the sixth significant digit.  And since  According to the graphs obtained, the characteristic orders of magnitude should be around 1.0e-2, then a non-zero value was entered into the initial condition, but very small.  The selection was able to establish that for 8-byte real it should be at least 1.0e-21.  And then: <br><br><img src="https://habrastorage.org/storage2/27c/d74/6f5/27cd746f589aba0948275076efe0ed62.png" alt="Almost zero"><br><br>  Yes, here, as written in the legend, in fact, five graphs.  Simply, we get the very difference within the sixth significant figure. <br><br>  The reasons?  Quite obvious.  They lie in the intricacies of the simultaneous processing of large and small numbers.  And the fact that the phenomenon is so significant in scale was, in general, expected.  But, above all, the interest is caused by the instability of the work of a truly excellent tool from Intel against the background of the relative success of gfortran 4.5.2.  It should be noted that similar problems were also found when calculating the old version of gfortran 4.1.2 with optimization turned on and without other options installed on the available cluster (running Slamd64), but they were not given due attention at that time. <br><br>  Compliance with IEEE 754, oddly enough, played a critical role for gfortran.  Without it, the bill is fairly stable and accurate.  For the brainchild of Intel, this turned out to be not so significant, because it did not work correctly anyway. <br><br>  So, the conclusions and thoughts about the causes of what he saw. <br><br><ul><li>  The most likely candidate for the role of the cause of the observed behavior of calculations seems to be the subtleties of rounding numbers.  Because  in the initial distribution of the value, a zero value is specified, then in the first steps the count is made almost at the boundary of machine accuracy.  Accordingly, this leads to the accumulation of noticeable errors, which manifest themselves in the final result. </li><li>  The loss of accuracy in the algorithm is obviously caused by the fact that the dimensional system of seven differential equations in partial derivatives is solved, the variables in each of which have their own characteristic values ‚Äã‚Äãthat are significantly different from the others.  With the right choice of scale factors, in a dimensionless system of equations to get close at least in order of magnitude values ‚Äã‚Äãof all variables, although during initial attempts to make the dimensionless, there were small coefficients in front of the derivatives, which was the reason for the rejection of this procedure. </li><li>  The question of why gfortran, which does not meet the standard for floating-point calculations, is capable of producing an acceptable result, remains open.  It is reasonable to assume that there are some own, different from the standard, rounding rules that ensure the preservation of a stable account, as well as their adjustment and refinement in the compiler development process.  ‚ÄúFragile balance of mistakes‚Äù or a well-considered correction of the approach?  Alas, at my level of knowledge about the toolkit, aimed primarily at the use of compilers, rather than testing them and studying properties, this is unknown.  But it makes one think and remember the warnings about possible loss of accuracy in various places of the programs, given at the first stages of teaching numerical methods at the university. </li></ul><br><br>  Compiler testing for IEEE 754 compliance was performed using <a href="http://orion.math.iastate.edu/burkardt/f_src/paranoia/paranoia.html">FORTRAN-version of</a> William Kahan's ‚ÄúFloating point paranoia‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/137000/">https://habr.com/ru/post/137000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136995/index.html">Comparison of several popular Russian cloud / regular Windows VPS providers</a></li>
<li><a href="../136996/index.html">GlassFish clustering in Jelastic</a></li>
<li><a href="../136997/index.html">Student Project Competition Intersystems Student Programming Competition 2012</a></li>
<li><a href="../136998/index.html">Simple soldering station on a microcontroller</a></li>
<li><a href="../136999/index.html">Not very fair PHP DOC file generation</a></li>
<li><a href="../137001/index.html">Comparative analysis of mobile operating systems</a></li>
<li><a href="../137002/index.html">Mobile marketing'2012 - what can we expect?</a></li>
<li><a href="../137004/index.html">Carefully, Hetzner uses old and worn disks.</a></li>
<li><a href="../137005/index.html">3D buttons with CSS3</a></li>
<li><a href="../137006/index.html">Video analysis in perimeter protection systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>