<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wiren Board 5: what we changed in the ‚Äústuffing‚Äù of the controller for automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Recently, we wrote that we have released a new version of the controller for automation - Wiren Board 5. Today we will describe in detail how t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wiren Board 5: what we changed in the ‚Äústuffing‚Äù of the controller for automation</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  Recently, we <a href="https://geektimes.ru/company/wirenboard/blog/274530/">wrote</a> that we <a href="https://geektimes.ru/company/wirenboard/blog/274530/">have</a> released a new version of the controller for automation - Wiren Board 5. Today we will describe in detail how the electronic part of the device has changed. </p><br><p><img src="https://hsto.org/getpro/geektimes/post_images/b66/208/383/b6620838396277435d513db4222c5f18.png" alt="image"></p><a name="habracut"></a><br><h1>  CPU and memory </h1><br><p>  In the previous version of the device, we used a WB-IMX233-CORE self-made processor module.  It was based on the design of the Olinuxino Micro on an i.MX233 processor. </p><br><p><img src="https://habrastorage.org/getpro/geektimes/post_images/f8a/fb9/345/f8afb9345810d41d99c6667d75f0f302.png" alt="image" width="48%"><img src="https://habrastorage.org/getpro/geektimes/post_images/109/ead/b74/109eadb74f8cee8ce5f857e77345dc06.jpg" alt="image" width="48%"></p><br><p>  In WB5, the <a href="http://otladka.com.ua/index.php%3Fpage%3Dshop.product_details%26amp%3Bflypage%3Dvmj_naru.tpl%26amp%3Bproduct_id%3D239%26amp%3Bcategory_id%3D18%26amp%3Boption%3Dcom_virtuemart%26amp%3BItemid%3D71">EV-IMX287-SODIMM</a> module is used instead. </p><br><p>  The module is built on the i.mx287 processor - the next model from the same NXP line.  Although the processor is newer and will be available at least until 2025, it is fully software compatible with the previous one. </p><br><p>  What else has changed: there is now more RAM and it is faster (128MB DDR2).  The eMMC chip on 4GB instead of microSD is used as a storage device - it is a more reliable solution.  Other minor improvements: USB OTG-port, separate Ethernet, support for CAN and SPDIF, hardware serial ports. </p><br><h1>  Power and battery. </h1><br><p>  The power supply circuit was slightly altered - the maximum allowable input voltage was raised to 28V, the power of the 5V line was increased. </p><br><p>  The GSM module on a fresh chipset from Mediatek requires a lower voltage than before, so the 4.5V line is replaced by 4.0V.  From the same powerful line, the processor is now directly powered, which reduces consumption. </p><br><p>  A 3.3V voltage in the device is obtained using several LDOs, which also isolate parts of the circuit from each other.  Outgoing to the outside world 5V on the USB connector and the terminal strip ‚Äú5V out‚Äù have a current limit and allow software shutdown. </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d5c/db8/8c9/d5cdb88c95aeba6a39df5a2cbdf976f4.png" alt="image"><br><p>  Operating experience with the battery WB4 showed that: </p><br><ol><li><p>  Not every battery will fit inside the case.  Those buyers who were going to use Wiren Board with a battery wisely bought it from us. </p><br></li><li>  The battery was mounted in a double-sided tape case.  Unreliable. </li></ol><br><p>  Since  in the case there are places for mounting the board on the second or third floor, we decided to make a separate board with a charging circuit, and attach the battery to it. </p><br><p>  The default unit comes with a 1800 mAh quality EEMB battery. </p><br><p><img src="https://habrastorage.org/getpro/geektimes/post_images/37e/7ca/723/37e7ca723e6cf0da3d93e3de5b918079.png" alt="image" width="48%"><img src="https://habrastorage.org/getpro/geektimes/post_images/d5b/15c/222/d5b15c222a2243296844d9b6568349e5.png" width="48%"></p><br><h1>  Universal inputs Ain. </h1><br><p>  The terminal blocks are the most ‚Äúexpensive‚Äù part in the controller, the space on the sides of the case is in short supply.  To save money, some functions can be combined, ‚Äúmultiplexed‚Äù onto one terminal block.  The open collector outputs are well combined with the ADC input.  The ADC input is high-resistance, does not interfere with the work output.  If the transistor is closed, it does not interfere with voltage measurement. </p><br><p>  In parallel with the analog input on the Ain terminals there is a digital input. <br>  The input represents the Schmitt trigger on an operational amplifier.  The input impedance is large, you can set the input actuation level, hysteresis. <br>  It is important that the digital input is ‚Äúfair‚Äù and not emulated on analog.  This allows you to use the input as a source of interrupts and to measure the pulse duration with great accuracy, which is necessary, for example, when connecting meters. </p><br><img src="https://habrastorage.org/getpro/geektimes/post_images/38b/a7d/69f/38ba7d69fbcf1a7f72b1f324f5c50952.png" alt="image"><br><h1>  CAN </h1><br><p>  In controller version 3.5 (known as Wiren Board Smart Home) there was a CAN port (bus controller + transceiver).  CAN is a very good protocol: fast, jam-proof, with packet transmission and collision resolution, etc.  One sadness is that there is no equipment at an affordable price and few people used it on the controller.  Therefore, it was removed from the fourth version - it occupied a couple of terminal blocks and a lot of space on the board.  However, in the new CAN processor is already there, you only need a transceiver. </p><br><p>  To save terminal blocks, the CAN port in the controller is combined with one of the RS-485 ports.  You can work with only one of them at a time.  In receive mode, the CAN and RS-485 transceivers do not affect each other.  And what would the extension of the RS-485 lines (A and B) not spoil the CAN lines (L and H), and connect them with L, B and H. <br>  In addition to the integrated CAN port, you can add another isolated CAN port to Wiren Board 5 using the appropriate expansion module. </p><br><p>  Some manufacturers call the word CAN a non-standard bus, which uses the physical layer from CAN, and the logical one from UART.  Such a solution is found mainly in meters, for example, in the popular electricity meters ‚ÄúMercury‚Äù.  The controller also supports this bus using a special UART-CAN expansion module, and the Mercury protocol (and many others) too. </p><br><h1>  1-Wire </h1><br><p>  1-Wire - a bidirectional bus operating on two or three wires, including power wires.  Mainly used for temperature sensors. </p><br><p>  The number of devices on the bus in this case is limited primarily by the total consumption. </p><br><p>  The radical solution is to use a separate wire for power supply (three-wire connection).  But there is another way that improves reliability when using a two-wire bus: the so-called active line tightening.  Those.  while there is no data transfer, close the line with a transistor to power. </p><br><p>  So we did in WB5. </p><br><h1>  S / PDIF </h1><br><p>  In previous versions of the controller, there was an analog stereo audio output.  The DAC was built right into the i.mx233 processor (and the DAC turned out to be there, because i.mx233 is based on the STMP3780 chip for MP3 players, which Freescale bought together with Sigmatel and converted it into an industrial processor). <br>  In the new i.MX28 processor there is no analog sound, but there is a digital S / PDIF output.  It and brought to the optical transponder.  S / PDIF is of course not plugged into cheap speakers, which may not be convenient, but it allows using the controller as a network player with a normal, high-quality sound.  To convert to analog, you can use external inexpensive converters. </p><br><h1>  Infrared transceiver. </h1><br><p>  There are IR receivers and IR transmitters, usually with a jack3.5 connector with three contacts.  And fortunately, they are conditionally compatible on the contacts. </p><br><table><thead><tr><th>  Connector pin </th><th>  Receiver </th><th>  Transmitter </th></tr></thead><tbody><tr><td>  one </td><td>  V + </td><td>  Out </td></tr><tr><td>  2 </td><td>  In </td><td>  NC </td></tr><tr><td>  3 </td><td>  GND </td><td>  GND </td></tr></tbody></table><br><p>  Therefore, in the controller placed one universal connector.  But for some applications it may be necessary to work with the receiver and with the transmitter.  I had to develop my own transceiver, with parasitic receiver power from the signal line. </p><br><h1>  Conclusion </h1><br><p>  In this article, we did not talk about hardware solutions that are used in expansion modules and input-output modules for Wiren Board.  Since the material turns out to be voluminous (there are already more than a dozen modules!), We will publish it in one of the following articles. </p><br><p>  We remind you that until May 15, the unprecedented generosity of pre-order for controllers, which we described <a href="https://geektimes.ru/company/wirenboard/blog/274530/">in the last article</a> , continues.  And in the presence of the device is at normal prices. </p><br><p>  As always, we will be glad to comment! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/372163/">https://habr.com/ru/post/372163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../372153/index.html">45 km from Chernobyl produce milk with a tenfold excess of strontium-90</a></li>
<li><a href="../372155/index.html">A new state of water molecules has been discovered.</a></li>
<li><a href="../372157/index.html">Non-cash society: what gives people the rejection of traditional money?</a></li>
<li><a href="../372159/index.html">A well-known athlete, in whose bike they found a hidden electric motor, was disqualified for six years</a></li>
<li><a href="../372161/index.html">Alaska Aquarium is heated with carbon dioxide and ocean water</a></li>
<li><a href="../372165/index.html">How to fly to Alpha Centauri - technical details</a></li>
<li><a href="../372167/index.html">Controlling ventilation with the MT8057 carbon dioxide detector</a></li>
<li><a href="../372169/index.html">‚ÄúSmart Home‚Äù from Beltelecom. Part 1</a></li>
<li><a href="../372171/index.html">Inertial tracker based on Arduino and GY-85</a></li>
<li><a href="../372173/index.html">On Mars, they actually found the Beagle 2 probe missing 12 years ago.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>