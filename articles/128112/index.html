<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting to know XNA and writing the first music game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all novice game developers and just good people. Today, I want to introduce you to the wonderful XNA framework (the dotNet managed runtime to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting to know XNA and writing the first music game</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/8f1d45cb/ca521558/cadb0ad6/238829c1.png" align="left">  Hello to all novice game developers and just good people.  Today, I want to introduce you to the wonderful XNA framework (the dotNet managed runtime toolkit).  We will program in C #. <br>  In order to introduce you to XNA closer, I propose to write a simple "musical" 2D toy.  The rest is under the cut. <br><a name="habracut"></a><br><br><h5>  Short description on wikipedia </h5><br>  <b>Microsoft XNA</b> ( <i>XNA's Not Acronymed</i> ) is a set of tools with a controlled runtime environment (.NET) created by Microsoft that makes it easy to develop and manage computer games.  XNA seeks to free game development from writing recurring pattern code. <br><br><h5>  What do we need for this? </h5><br>  1) Fresh DirectX ( <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D8109">for example June 2010</a> ) <br>  2) Microsoft Visual C # 2010 EXPRESS ( <a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-csharp-express">free license</a> ) <br>  3) <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D23714">Microsoft XNA Game Studio 4.0</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  What is supposed to be dismantled and done in this lesson? </h5><br><ul><li>  Connect the XNA Framework assembly </li><li>  Create an empty application with background painting </li><li>  Learning to load content </li><li>  Learn to work with sound </li><li>  Learn how to work with graphics </li></ul><br><br><h5>  What game will we implement? </h5><br>  The mechanics of the game is simple to madness.  The meaning will be built on the music, in the case of this game, the composition of Isaac Shepard - Leaves in the Wind will be used.  It will be necessary to catch the mouse "notes", the speed and number of which will be dependent on the current position in the music, roughly speaking, the game "visualizer".  For variety, there are 5 types of notes: <i>normal</i> , <i>red</i> (enemies), <i>purple</i> (power), <i>blinking</i> (turns everything into yellow), <i>yellow</i> (increases the speed of scoring and size). <br><br><h5>  Packing up an empty project </h5><br>  To begin with, we put all the necessary components in order, then we start Microsoft Visual C # 2010 EXPRESS and create the Windows Game (4.0) project and call it music_catch: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/21fa7ada/60fdd115/13a3eb87/b334e105.png"></div><br>  An empty project is created, which, when compiled, only cleans up the ‚Äúscreen‚Äù of the application, let's take a closer look at the structure of the new project. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/3f06c605/3b6b5b7f/9f05e8e6/92731f93.png"></div><br><br>  <b>The music_catch project</b> is the ‚Äúlogic‚Äù of our application. <br>  <b>Game1.cs</b> is the main class of the application, inherited from <a href="http://msdn.microsoft.com/en-us/library/microsoft.xna.framework.game.aspx">Microsoft.Xna.Framework.Game</a> <br>  <b>Program.cs</b> - ‚Äúentry point‚Äù in the application, it is not interesting to us. <br>  <b>The music_catchContent project</b> is the ‚Äúcontent‚Äù of our application, where we will add resources. <br><br>  <b>Take a</b> closer look at <b>Game1.cs</b> <br>  It can highlight the main features, such as: <br>  <b>Game1 ()</b> is a class constructor. <br>  <b>Initialize ()</b> - initialization of the application. <br>  <b>LoadContent ()</b> - loading content. <br>  <b>UnloadContent ()</b> - download content. <br>  <b>Update (GameTime gameTime)</b> - update application logic (for example physics, etc) <br>  <b>Draw (GameTime gameTime)</b> - drawing games.  ATTENTION, any drawing operations should be carried out here and only here. <br><br>  The empty project is assembled, we go further, we add resources to the application, we ‚Äúthrow‚Äù all the necessary resources into the music_catch \ music_catchContent folder.  In our case - five PNG files and one musical accompaniment.  Add this all to the project: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/748fd6ae/33bad904/3cf74f32/4d9a8032.png"></div><br><br>  In the same place we create a font, in the body of SpriteFont1.spritefont we specify the name and size: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FontName</span></span></span><span class="hljs-tag">&gt;</span></span>Segoe UI Mono<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FontName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Size</span></span></span><span class="hljs-tag">&gt;</span></span>14<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Size</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/82e7a526/c0305a04/205ae8b8/88fb086c.png"></div><br><br>  Create variables for future content: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Texture2D&gt; MelList; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Texture2D mouse; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Song song; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteFont font;</code> </pre> <br><br>  And we load it into LoadContent (): <br><br><pre> <code class="cpp hljs">MelList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Texture2D&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; a &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>; a++) MelList.Add(Content.Load&lt;Texture2D&gt;(<span class="hljs-string"><span class="hljs-string">"mel"</span></span> + a)); mouse = Content.Load&lt;Texture2D&gt;(<span class="hljs-string"><span class="hljs-string">"mouse"</span></span>); song = Content.Load&lt;Song&gt;(<span class="hljs-string"><span class="hljs-string">"Leaves_in_the_Wind"</span></span>); font = Content.Load&lt;SpriteFont&gt;(<span class="hljs-string"><span class="hljs-string">"SpriteFont1"</span></span>);</code> </pre> <br><br>  By the way, the content is loaded as follows: Content.Load &lt;&gt; ("asset") is called; <br>  The content processor is indicated in triangular brackets, in our case it is Texture2D, Song, SpriteFont.  You can use your processors, I'll tell you about it later. <br><br>  Content is loaded, go to the Game1 constructor () and write: <br><pre> <code class="cpp hljs">graphics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphicsDeviceManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); graphics.PreferredBackBufferWidth = <span class="hljs-number"><span class="hljs-number">800</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   graphics.PreferredBackBufferHeight = 600; //   graphics.IsFullScreen = false; //    graphics.ApplyChanges(); //   Content.RootDirectory = "Content";</span></span></code> </pre> <br><br>  The application is initialized. <br><br><h5>  Writing "game logic" </h5><br><br>  Now we need to create a controller of the particle system and the particles themselves (notes), which we will masterfully catch with the mouse. <br>  We create two classes: Catcher (the particles themselves) and CatcherHolder (particle system). <br><br>  Listing Catcher with comments: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Audio; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Content; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.GamerServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Graphics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Input; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Media; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> MusicCatch { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Catcher</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Texture2D Texture { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   public Vector2 Position { get; set; } //   public Vector2 Velocity { get; set; } //   public float Angle { get; set; } //    public float AngularVelocity { get; set; } //    public Color Color { get; set; } //   public float Size { get; set; } //   public int TTL { get; set; } //    private float RComponent; //   RGB private float GComponent; //   RGB private float BComponent; //   RGB public int type; //   private Random random; //    public Catcher(Texture2D texture, Vector2 position, Vector2 velocity, float angle, float angularVelocity, int type, float size, int ttl) { //     Texture = texture; Position = position; Velocity = velocity; Angle = angle; AngularVelocity = angularVelocity; this.type = type; Size = size; TTL = ttl; SetType(type); //      } public void ApplyImpulse(Vector2 vector) //   ( ) { Velocity += vector; } public void Update() //    { TTL--; Position += Velocity; Angle += AngularVelocity; if (type != -1) { Velocity = new Vector2(Velocity.X, Velocity.Y - .1f); Size = (10 + Velocity.Y) / 20; if(Size &gt; 0.8f) Size = 0.8f; } if (type == 0) { GComponent -= 0.005f; BComponent += 0.005f; Color = new Color(RComponent, GComponent, BComponent); } else if (type == 4) { Color = new Color((float)(1f * random.NextDouble()), (float)(1f * random.NextDouble()), (float)(1f * random.NextDouble())); } } public void Draw(SpriteBatch spriteBatch) //   { Rectangle sourceRectangle = new Rectangle(0, 0, Texture.Width, Texture.Height); Vector2 origin = new Vector2(Texture.Width / 2, Texture.Height / 2); spriteBatch.Draw(Texture, Position, sourceRectangle, Color, Angle, origin, Size, SpriteEffects.None, 0f); } public void SetType(int type) //    { this.type = type; Color StartColor = new Color(1f, 1f, 1f); switch (type) { case 0: StartColor = new Color(0f, 1f, 0f); break; //  case 1: StartColor = new Color(1f, 0f, 0f); break; //  case 2: StartColor = new Color(1f, 0f, 1f); break; //  case 3: StartColor = new Color(1f, 1f, 0f); break; //  case 4: random = new Random(); break; //  } RComponent = ((int)StartColor.R) / 255f; GComponent = ((int)StartColor.G) / 255f; BComponent = ((int)StartColor.B) / 255f; Color = new Color(RComponent, GComponent, BComponent); if (type == -1) { Color = new Color(1f, 1f, 1f, 0.1f); } } } }</span></span></code> </pre> <br><br>  Listing CatcherHolder with comments: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Audio; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Content; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.GamerServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Graphics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Input; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Media; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> MusicCatch { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatcherHolder</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Random random; <span class="hljs-comment"><span class="hljs-comment">//    public List&lt;Catcher&gt; particles; //   (Catcher) private List&lt;Texture2D&gt; textures; //   public List&lt;float&gt; accomulator { get; set; } //  float-,      accomulator ‚Äî   . public CatcherHolder(List&lt;Texture2D&gt; textures) { this.textures = textures; this.particles = new List&lt;Catcher&gt;(); random = new Random(); accomulator = new List&lt;float&gt;(); //       128  ‚Äî 1.0f for (int a = 0; a &lt; 128; a++) { accomulator.Add(1.0f); } } //    // Wave - ,   0f   . private Catcher GenerateNewParticle(float Wave) { Texture2D texture = textures[random.Next(textures.Count)]; //      Vector2 position = new Vector2(Wave, 0); //   Vector2 velocity = new Vector2((float)(random.NextDouble() - 0.5), (float)(random.NextDouble() * 10)); //  , 0.5f  X  10f  Y float angle = 0; //   = 0 float angularVelocity = 0.05f * (float)(random.NextDouble()*2 - 1 ); //    Color color = new Color(0f, 1f, 0f); //   (     Catcher) float size = (float)random.NextDouble()*.8f + .2f; //   int ttl = 400; //    400 (400    , .. 400 / 60 ‚Äî 6   . int type = 0; ‚Äî   0 //   if (random.Next(10000) &gt; 9900) //  type = 1; else if (random.Next(10000) &gt; 9950) //  type = 3; else if (random.Next(10000) &gt; 9997) //  type = 2; else if (random.Next(10000) &gt; 9998) //  type = 4; return new Catcher(texture, position, velocity, angle, angularVelocity, type, size, ttl); //      } //         public void GenerateYellowExplossion(int x, int y, int radius) { Texture2D texture = textures[random.Next(textures.Count)]; Vector2 direction = Vector2.Zero; float angle = (float)Math.PI * 2.0f * (float)random.NextDouble(); float length = radius * 4f; direction.X = (float)Math.Cos(angle); direction.Y = -(float)Math.Sin(angle); Vector2 position = new Vector2(x, y) + direction * length; Vector2 velocity = direction * 4f; float angularVelocity = 0.05f * (float)(random.NextDouble() * 2 - 1); float size = (float)random.NextDouble() * .8f + .2f; int ttl = 400; int type = 3; particles.Add(new Catcher(texture, position, velocity, 0, angularVelocity, type, size, ttl)); } // "" ,   public void Beat(float Wave) { particles.Add(GenerateNewParticle(Wave)); } public void Update() //    { for (int particle = 0; particle &lt; particles.Count; particle++) { particles[particle].Update(); if (particles[particle].Size &lt;= 0 || particles[particle].TTL &lt;= 0) { //        ,   particles.RemoveAt(particle); particle--; } } //  ,     1f,   ,     Constants ‚Äî ACCUMULATE_SPEED,  Constanst - . for (int a = 0; a &lt; 128; a++) if (accomulator[a] &lt; 1.0f) accomulator[a] += Constanst.ACCUMULATE_SPEED; } public void Draw(SpriteBatch spriteBatch) { //   ,   BlendState.Additive,     "". spriteBatch.Begin(SpriteSortMode.Immediate, BlendState.Additive); for (int index = 0; index &lt; particles.Count; index++) { particles[index].Draw(spriteBatch); } spriteBatch.End(); } } }</span></span></code> </pre> <br><br>  Listing Constant.cs: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> MusicCatch { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Constanst</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> BEAT_COST = <span class="hljs-number"><span class="hljs-number">.4</span></span>f; <span class="hljs-comment"><span class="hljs-comment">// "" ,        public const float ACCUMULATE_SPEED = .01f; //   public const float BEAT_REACTION = .5f; //    ""   public const float ACCOMULATOR_REACTION = .5f; //      ,      } }</span></span></code> </pre> <br><br>  I will explain what a mysterious battery is and why it is needed.  Let's talk about the "musical" spectrum. <br><br>  The music signal is food for the audio system.  More precisely - not so.  The speakers do not listen to music, our brain restores it, receiving a complex signal containing many frequency components. <br>  So, the idea is to listen to the ‚Äúfrequencies‚Äù of each Update and write them to some, for example, VisualizationData.  Simply put, in an array of 128 elements that vary from 0f to 1f. <br><br>  <i>How can this be used?</i> <br>  Each Update: the values ‚Äã‚Äãin the array change in accordance with the music, we need to check all 128 elements, if the value of the element is greater than 0.6f, call the Beat function and pass the Wave to it (the index of the array element in which the event occurred).  Everything is good, you can create a particle note in Beat.  But imagine that we have three Update'a in a row, in which in the same index - value&gt; 0.6f, as a result there will be 100500 particles per second.  To prevent such things from happening, you can use a battery.  Its meaning is simple: with Beat, the BEAT_COST constant is subtracted from the cell of the battery array of the corresponding Wave index.  Each Update adds ACCUMULATE_SPEED to all battery cells.  Before calling Beat it is checked whether the condition is satisfied - the value of the battery&gt; ACCOMULATOR_REACTION, if yes, then call the Beat.  This solves the problem. <br><br>  By the way, BEAT_REACTION is the value after which you need to check whether it is worth calling the Beat. <br><br>  Further I will give the full listing of GameLogic (Game1).  A lot of code, but I will try to write in the comments. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Audio; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Content; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.GamerServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Graphics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Input; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Xna.Framework.Media; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> MusicCatch { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game1</span></span></span><span class="hljs-class"> :</span></span> Microsoft.Xna.Framework.Game { GraphicsDeviceManager graphics; SpriteBatch spriteBatch; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Texture2D&gt; MelList; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Texture2D mouse; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CatcherHolder m_cHolder; MediaLibrary mediaLibrary; <span class="hljs-comment"><span class="hljs-comment">//   "" Song song; //   VisualizationData visualizationData; SpriteFont font; private int scores = 0; //  private float self_size = 1f; //  "" private int xsize = 1; //   private float power = 0f; //     private float activity = 0f; //     public Game1() { graphics = new GraphicsDeviceManager(this); graphics.PreferredBackBufferWidth = 800; graphics.PreferredBackBufferHeight = 600; graphics.IsFullScreen = false; graphics.ApplyChanges(); Content.RootDirectory = "Content"; //   mediaLibrary = new MediaLibrary(); visualizationData = new VisualizationData(); scores = 0; } protected override void Initialize() { m_cHolder = new CatcherHolder(MelList); MediaPlayer.Play(song); //    MediaPlayer.IsVisualizationEnabled = true; //   base.Initialize(); } protected override void LoadContent() { spriteBatch = new SpriteBatch(GraphicsDevice); MelList = new List&lt;Texture2D&gt;(); for(int a = 1; a &lt;= 5; a++) MelList.Add(Content.Load&lt;Texture2D&gt;("mel" + a)); mouse = Content.Load&lt;Texture2D&gt;("mouse"); song = Content.Load&lt;Song&gt;("Leaves_in_the_Wind"); font = Content.Load&lt;SpriteFont&gt;("SpriteFont1"); } protected override void UnloadContent() { } protected override void Update(GameTime gameTime) { m_cHolder.Update(); MediaPlayer.GetVisualizationData(visualizationData); //   // ""   ,   for (int a = 0; a &lt; 128; a++) { if (visualizationData.Frequencies[a] &gt; Constanst.BEAT_REACTION &amp;&amp; m_cHolder.accomulator[a] &gt; Constanst.ACCOMULATOR_REACTION) { m_cHolder.Beat(a * 3.125f * 2); //  "",   . m_cHolder.accomulator[a] -= Constanst.BEAT_COST; //   } } // ,   ,       if (power &gt; 0f) { for (int particle = 0; particle &lt; m_cHolder.particles.Count; particle++) { if (m_cHolder.particles[particle].type != 1) //   ,   { float body1X = m_cHolder.particles[particle].Position.X; float body1Y = m_cHolder.particles[particle].Position.Y; float body2X = (float)Mouse.GetState().X; float body2Y = (float)Mouse.GetState().Y; float Angle = (float)Math.Atan2(body2X - body1X, body2Y - body1Y) - ((float)Math.PI / 2.0f); //     float Lenght = (float)(5000f * power) / (float)Math.Pow((float)Distance(body1X, body1Y, body2X, body2Y), 2.0f); //   m_cHolder.particles[particle].ApplyImpulse(AngleToV2(Angle, Lenght)); //    } } power -= 0.001f; //   } activity -= 0.001f; //    if (activity &lt; 0.0f) activity = 0.0f; else if (activity &gt; 0.5f) activity = 0.5f; //     0f  .5f //    :    for (int particle = 0; particle &lt; m_cHolder.particles.Count; particle++) { int x = (int)m_cHolder.particles[particle].Position.X; int y = (int)m_cHolder.particles[particle].Position.Y; int radius = (int)(16f * m_cHolder.particles[particle].Size); if (circlesColliding(Mouse.GetState().X, Mouse.GetState().Y, (int)(16f * self_size), x, y, radius)) { scores += (int)(10f * m_cHolder.particles[particle].Size * xsize); //  ,        activity += 0.005f; //   int type = m_cHolder.particles[particle].type; //   ,     switch (type) { case 3: //  self_size += 0.1f; xsize += 1; //      if (self_size &gt; 4.0f) self_size = 4.0f; break; case 2: //  power = 1f; //   ,       break; case 4: //  for (int b = 0; b &lt; m_cHolder.particles.Count; b++) m_cHolder.particles[b].SetType(3); //     ‚Äî  break; case 1: //  () for(int a = 1; a &lt; xsize; a++) m_cHolder.GenerateYellowExplossion(Mouse.GetState().X, Mouse.GetState().Y, (int)(16f * self_size)); xsize = 1; self_size = 1f; scores -= (int)(scores / 4); break; } //   m_cHolder.particles[particle].TTL = 0; m_cHolder.particles.RemoveAt(particle); particle--; } } base.Update(gameTime); } protected override void Draw(GameTime gameTime) { GraphicsDevice.Clear(Color.Black); m_cHolder.Draw(spriteBatch); //  CatcherHolder spriteBatch.Begin(); Rectangle sourceRectangle = new Rectangle(0, 0, mouse.Width, mouse.Height); //   Vector2 origin = new Vector2(mouse.Width / 2, mouse.Height / 2); // offset  Vector2 mouse_vector = new Vector2(Mouse.GetState().X, Mouse.GetState().Y); // ()  string xtext = "x" + xsize.ToString(); //  Vector2 text_vector = font.MeasureString(xtext) / 2.0f; //  offset'a  spriteBatch.Draw(mouse, mouse_vector, sourceRectangle, new Color(0.5f - power/2.0f + activity, 0.5f, 0.5f - power/2.0f), 0.0f, origin, self_size, SpriteEffects.None, 0f); //   spriteBatch.DrawString(font, xtext, mouse_vector - text_vector, Color.White); //   spriteBatch.DrawString(font, "Score: " + scores.ToString(), new Vector2(5, graphics.PreferredBackBufferHeight - 34), Color.White); //   spriteBatch.End(); base.Draw(gameTime); } // ,       bool circlesColliding(int x1, int y1, int radius1, int x2, int y2, int radius2) { int dx = x2 - x1; int dy = y2 - y1; int radii = radius1 + radius2; if ((dx * dx) + (dy * dy) &lt; radii * radii) { return true; } else { return false; } } //      public Vector2 AngleToV2(float angle, float length) { Vector2 direction = Vector2.Zero; direction.X = (float)Math.Cos(angle) * length; direction.Y = -(float)Math.Sin(angle) * length; return direction; } //  public float Distance(float x1, float y1, float x2, float y2) { return (float)Math.Sqrt((float)Math.Pow(x2 - x1, 2) + (float)Math.Pow(y2 - y1, 2)); } } }</span></span></code> </pre><br><br>  This is such a simple toy.  <b>XNA 4.0</b> and <b>.NET</b> must be installed on the user's end machine; <br><br>  Links: <a href="http://zalil.ru/31672726">the game itself</a> ( <a href="">direct</a> ) |  <a href="http://zalil.ru/31672727">source</a> ( <a href="">direct</a> ) |  <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D20914">XNA Framework End-user</a> <br><br>  Screenshot: <br><img src="http://habrastorage.org/storage1/c19d2f10/eb19bf08/7ddd21ab/587f5e7d.png"><br><br>  <i>PS The idea is not mine, this game has already been <a href="http://armorgames.com/play/3303/music-catch-2">released under flash</a> .</i>  <i>This game was written exclusively for the article, it will not receive further development accordingly.</i> <br>  <i>PSS I will also help to understand the XNA / lesson, for this, write to me in a personal on Habr√© or on contacts that are in the profile.</i> </div><p>Source: <a href="https://habr.com/ru/post/128112/">https://habr.com/ru/post/128112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128104/index.html">From the dusty archive to the Internet: how ABBYY Recognition Server digitizes libraries</a></li>
<li><a href="../128106/index.html">Turn-based strategy as a hobby</a></li>
<li><a href="../128108/index.html">Sports programming: ‚ÄúWhere to start?‚Äù</a></li>
<li><a href="../128110/index.html">PHP moves to git</a></li>
<li><a href="../128111/index.html">Some details about the main function</a></li>
<li><a href="../128115/index.html">Statistical data visualization with Highcharts</a></li>
<li><a href="../128117/index.html">Home server Part 2. FTP, Samba and rTorrent</a></li>
<li><a href="../128118/index.html">Anonymity on Habr√©</a></li>
<li><a href="../128119/index.html">Work on the IAS - ‚ÄúMeans of information protection. Site Protection ¬ª</a></li>
<li><a href="../128120/index.html">We invent a programming language for brain training. Or an esoteric programming language in 5 minutes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>