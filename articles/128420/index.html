<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing FreeBSD 9.0-BETA2 as DomU in PV mode</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The bottom line is that there is Debian + Xen 4.1.1, you need to install FreeBSD there. A quick reference, starting with FreeBSD 8.0, can work in Xen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing FreeBSD 9.0-BETA2 as DomU in PV mode</h1><div class="post__text post__text-html js-mediator-article">  The bottom line is that there is Debian + Xen 4.1.1, you need to install FreeBSD there.  A quick reference, starting with FreeBSD 8.0, can work in Xen in PV mode, before that only the HVM mode was available and only if the kernel includes the necessary drivers and options.  Also, only the i386 version works in PV mode. <br><a name="habracut"></a><br>  There are 2 methods for installing FreeBSD on Xen: <br><ul><li>  Creating a system image on another FreeBSD and transferring it to Xen </li><li>  Initial installation in HVM and subsequent transfer to PV </li></ul><br><br><br>  Since I don‚Äôt have another FreeBSD machine with a good upload, I decided to follow Method 2. <br><br><h2>  Training </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We need: <br><br><ul><li>  Configured dom0 </li><li>  ISO image of installer (FreeBSD 8.2 should work too) </li><li>  VNC Client </li></ul><br><br>  <i>If you have Mac OS X: the only VNC client that has worked for me is normal - TightVNC Java Viewer.</i> <br><br>  Initial config for xm: <br><pre><code class="python hljs">kernel = <span class="hljs-string"><span class="hljs-string">"hvmloader"</span></span> builder=<span class="hljs-string"><span class="hljs-string">'hvm'</span></span> memory = <span class="hljs-number"><span class="hljs-number">256</span></span> name = <span class="hljs-string"><span class="hljs-string">"FreeBSD-Dev"</span></span> vif = [ <span class="hljs-string"><span class="hljs-string">'type=ioemu'</span></span> ] disk = [ <span class="hljs-string"><span class="hljs-string">'phy:/dev/tank/freebsd--disk,ioemu:hda,w'</span></span>, <span class="hljs-string"><span class="hljs-string">'file:/root/FreeBSD-9.0-BETA2-i386-dvd1.iso,hdc:cdrom,r'</span></span> ] device_model = <span class="hljs-string"><span class="hljs-string">'qemu-dm'</span></span> boot=<span class="hljs-string"><span class="hljs-string">"cd"</span></span> vnc=<span class="hljs-number"><span class="hljs-number">1</span></span> vnclisten=<span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span> vncpasswd=<span class="hljs-string"><span class="hljs-string">'freebsdinstall'</span></span> serial=<span class="hljs-string"><span class="hljs-string">'pty'</span></span></code> </pre> <br><br><h2>  Installation </h2><br><br>  We start (xm create /path/to/freebsd.cfg), we connect via VNC.  If you do not have other domains with VNC, then the port will be 5900. If Dom0 is out of sight (for NAT, for example), then you can send an ssh tunnel on the local machine.  In a normal OS, this is done like this: <br><pre> <code class="bash hljs">ssh -L 5900:127.0.0.1:5900 xx.xx.xx.xx</code> </pre><br>  After that, you can connect to the domain (specify 127.0.0.1.10000 as the server).  It is better to configure the network with static, with DHCP there are problems.  During installation, you must specify that you want src.  The installation process should not cause difficulties, but I had a problem - the lvm partition I created was exactly 20gb, and when I indicated that all 20 should be allocated under /, the system asked for 64kb for the boot loader and for some reason these 64kb were not cut off from / and as a result I got an error about the lack of space.  By the way, about disco names: hda -&gt; ad0, sda -&gt; da0. <br><br><h2>  Putting the core </h2><br><br>  For FreeBSD to work in PV mode, you need to rebuild the kernel: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /sys/i386/conf/ config XEN <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../compile/XEN ; make cleandepend &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install</code> </pre><br><br>  Now we need to transfer the kernel from DomU to Dom0: <br><pre> <code class="bash hljs">scp /boot/kernel/kernel user@ip:/path</code> </pre><br><br>  In order to connect to the domain via the xm console, you must edit the file / etc / ttys: <br><pre> <code class="bash hljs">... xc0 <span class="hljs-string"><span class="hljs-string">"/usr/libexec/getty Pc"</span></span> vt100 on secure ttyv0 <span class="hljs-string"><span class="hljs-string">"/usr/libexec/getty Pc"</span></span> xterm on secure ttyv1 <span class="hljs-string"><span class="hljs-string">"/usr/libexec/getty Pc"</span></span> xterm on secure ttyv2 <span class="hljs-string"><span class="hljs-string">"/usr/libexec/getty Pc"</span></span> xterm on secure &lt;/p&gt;</code> </pre><br>  I leave ttyv1 turned on so that you can boot into HVM mode, press Alt + F1 and get the console, just in case. <br><br><h2>  Run in PV mode </h2><br><br>  freebsd.cfg for PV: <br><pre> <code class="python hljs">kernel = <span class="hljs-string"><span class="hljs-string">"/etc/xen/freebsd/kernel"</span></span> memory = <span class="hljs-number"><span class="hljs-number">256</span></span> name = <span class="hljs-string"><span class="hljs-string">"FreeBSD0"</span></span> vif = [ <span class="hljs-string"><span class="hljs-string">''</span></span> ] disk = [ <span class="hljs-string"><span class="hljs-string">'phy:/dev/tank/freebsd--disk,ioemu:hda,w'</span></span> ] extra = <span class="hljs-string"><span class="hljs-string">"boot_verbose=1"</span></span> extra += <span class="hljs-string"><span class="hljs-string">",vfs.root.mountfrom=ufs:/dev/ad0p2"</span></span> extra += <span class="hljs-string"><span class="hljs-string">",kern.hz=100"</span></span> pae=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  Now we need to correct the network configuration, since now the network card is called xn0, and not rl0.  Everything, at this stage you must have a fully working system. <br><br>  PS <br>  About errors please write in a personal. <br><br>  UPD. <br>  Disk Speed: <br><pre> <code class="hljs pgsql">%<span class="hljs-type"><span class="hljs-type">time</span></span> dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero bs=<span class="hljs-number"><span class="hljs-number">1024</span></span>k <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>=test count=<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-number"><span class="hljs-number">1073741824</span></span> bytes transferred <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">10.364163</span></span> secs (<span class="hljs-number"><span class="hljs-number">103601403</span></span> bytes/sec) <span class="hljs-number"><span class="hljs-number">0.000</span></span>u <span class="hljs-number"><span class="hljs-number">3.694</span></span>s <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">10.37</span></span> <span class="hljs-number"><span class="hljs-number">35.5</span></span>% <span class="hljs-number"><span class="hljs-number">25</span></span>+<span class="hljs-number"><span class="hljs-number">4753</span></span>k <span class="hljs-number"><span class="hljs-number">6</span></span>+<span class="hljs-number"><span class="hljs-number">8216</span></span>io <span class="hljs-number"><span class="hljs-number">0</span></span>pf+<span class="hljs-number"><span class="hljs-number">0</span></span>w %<span class="hljs-type"><span class="hljs-type">time</span></span> dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=test bs=<span class="hljs-number"><span class="hljs-number">1024</span></span>k <span class="hljs-keyword"><span class="hljs-keyword">of</span></span>=/dev/<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span> records <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-number"><span class="hljs-number">1073741824</span></span> bytes transferred <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">8.904045</span></span> secs (<span class="hljs-number"><span class="hljs-number">120590340</span></span> bytes/sec) <span class="hljs-number"><span class="hljs-number">0.000</span></span>u <span class="hljs-number"><span class="hljs-number">2.458</span></span>s <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">08.97</span></span> <span class="hljs-number"><span class="hljs-number">27.3</span></span>% <span class="hljs-number"><span class="hljs-number">25</span></span>+<span class="hljs-number"><span class="hljs-number">4906</span></span>k <span class="hljs-number"><span class="hljs-number">8225</span></span>+<span class="hljs-number"><span class="hljs-number">0</span></span>io <span class="hljs-number"><span class="hljs-number">3</span></span>pf+<span class="hljs-number"><span class="hljs-number">0</span></span>w</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/128420/">https://habr.com/ru/post/128420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128414/index.html">Creating an international startup</a></li>
<li><a href="../128415/index.html">Twitter expanded service monetization program</a></li>
<li><a href="../128416/index.html">Game developers will gather in Dnepropetrovsk on Ciklum Game Developers Saturday</a></li>
<li><a href="../128417/index.html">HTC Sensation XE with Beats Audio for the most demanding</a></li>
<li><a href="../128419/index.html">AMD Bulldozer New World Record Overclocking Processors</a></li>
<li><a href="../128422/index.html">Twitter bot on C #</a></li>
<li><a href="../128423/index.html">Simple synthesizer for Arduino</a></li>
<li><a href="../128424/index.html">Evernote extension for Chrome improved copying articles</a></li>
<li><a href="../128425/index.html">Itanium Poulson: what's new</a></li>
<li><a href="../128426/index.html">Master Part Chart with Highcharts and jQuery UI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>