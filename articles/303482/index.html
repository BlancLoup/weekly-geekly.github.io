<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ComputerVision (Ruby & OpenCV)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Author: Lyudmila Dezhkina, Senior Full Stack developer 

 OpenCV is a well-known open source computer vision library. I‚Äôll tell you what you can do wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ComputerVision (Ruby & OpenCV)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/7a2/b8e/7a7/7a2b8e7a7b324f5185df5f7753e8c8d9.png"><br>  <em>Author: Lyudmila Dezhkina, Senior Full Stack developer</em> <br><br>  OpenCV is a well-known open source computer vision library.  I‚Äôll tell you what you can do with OpenCV, how the library works, how to use it in Ruby.  I managed to participate in two projects where it was applied.  In both cases, we didn‚Äôt use Ruby in the final version, but Ruby is very convenient at the first stage when you need to create a prototype of a future system just to see how OpenCV will perform the required tasks.  If everything is in order, then the application is written with the same algorithm in another language.  And to use OpenCV on Ruby, there is a corresponding gem. <br><br>  The main parts of the library are image interpretation and machine learning algorithms.  The list of features provided by OpenCV is extensive: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  image interpretation; </li><li>  camera calibration by reference; </li><li>  elimination of optical distortion; </li><li>  the definition of similarity; </li><li>  analysis of the movement of the object; </li><li>  determining the shape of the object and tracking the object; </li><li>  3D reconstruction; </li><li>  object segmentation; </li><li>  gesture recognition. </li></ul><br><br>  Now OpenCV is used in many areas.  Here are some interesting examples: <br><br><ol><li>  Google: <br><ol><li>  Google self-driving car - in unmanned vehicles Google OpenCV is used to develop a prototype of the recognition of the environment; <br>  (Today, the constructed system is based primarily on LIDAR - due to the difficulties of recognition in poor lighting) </li><li>  Google Glass - in these glasses 3D-reconstruction of the image is built on OpenCV; </li><li>  Google Mobile; </li></ol><br></li><li>  Robotics and Arduino; </li><li>  Industrial production - sometimes a factory makes a part counting system or something like that on OpenCV. </li></ol><br><a name="habracut"></a><br><h2>  Is it difficult or interesting? </h2><br>  Although it is sometimes difficult to say which data can be considered really ‚Äúbig‚Äù, in the case of OpenCV there are no such doubts: for example, self-driving car can handle about 1 Gb / s by approximate calculations, and this is really big data.  For comparison, the human brain processes ~ 45 MB - 3Gb / s - it depends, in particular, on the illumination of the room. <br><br>  As for the numerous OpenCV algorithms, among them are both complex and simple.  There are, in particular, algorithms for filtering, tensors (in fact, one-dimensional arrays). <br><br>  Also, OpenCV uses machine learning and deep learning technologies, since the recognition is partially based on neural networks.  Deep learning and machine learning is a very interesting topic, which I recommend to study in courses on Coursera.  Regarding the topic of computer vision in general, I recommend this book: <br><img src="https://habrastorage.org/files/0ee/73f/71f/0ee73f71f573488da61257632f6321dd.png"><br><br><h2>  <strong>What does OpenCV consist of?</strong> </h2><br><img src="https://habrastorage.org/files/30f/6e7/12e/30f6e712e854462eba69710df2a42bf3.png"><br><br>  <strong>CXCORE</strong> (the core itself), oddly enough, is elementary in terms of programming.  It contains the basic data structures and algorithms: <br><br><ul><li>  basic operations on multidimensional numeric arrays ‚Äî they allow, for example, to multiply a matrix by a vector, to multiply two matrices, and so on; </li><li>  matrix algebra, mathematical functions, random number generators - to work with it, it is enough to know the name of the desired function, and that‚Äôs all; </li><li>  writing / restoring data structures to / from XML; </li><li>  basic functions of 2D graphics - with their help you can, for example, draw a snake. </li></ul><br><br>  <strong>CV</strong> is a module for image processing and computer vision.  It includes: <br><br><ul><li>  basic operations on images (filtering, geometric transformations, transformation of color spaces, etc.); </li><li>  image analysis (selection of distinctive features, morphology, contour search, histograms); </li><li>  motion analysis, tracking objects; </li><li>  detection of objects, in particular persons; </li><li>  camera calibration and elements of spatial structure recovery. </li></ul><br><br>  Geometric transformations, by the way, are a very important part of the library: when you are trying to build something, you often need to take into account the rotation and angle of the camera. <br><br>  <strong>HighGUI</strong> - a module for input / output of images and video, creating a user interface.  The module performs the following functions: <br><br><ul><li>  Capturing video from cameras and video files, reading / writing static images; </li><li>  functions for organizing a simple UI (all demo applications use HighGUI). </li></ul><br><br>  <strong>ML</strong> - built-in machine learning algorithms, working out of the box, although in the 3rd version they are gradually abandoned, because other companies are developing good machine learning algorithms (they will be discussed later). <br><br>  <strong>CvCam</strong> - everything you can do with video (camera capture, detection, slicing, etc.) <br><br>  <strong>Cvaux</strong> are experimental and outdated features: <br><br><ul><li>  spatial vision: stereocalibration, self-calibration; </li><li>  search stereo, clicks in the graphs; </li><li>  finding and describing facial features. </li></ul><br><br><h2>  Examples of patents or startups </h2><br>  A good example of one of the latest successful startups using OpenCV is the virtual fitting room from <a href="http://zugara.com/virtual-dressing-room-technology">Zugara</a> , which provides a really high conversion rate.  How does she work?  The algorithm is approximately as follows: it photographs the user and counts the distance to his face.  Then the user enters several of their sizes, and the fitting room calculates something from the clothes the customer likes.  There is, however, another significant part in this system - the AutoCAD-model: every thing before you try it on, undergoes a 3D reconstruction. <br><br>  The second good example of using OpenCV is the license plate recognition system on the roads.  The accuracy of such a system, however, is up to 90%, since much depends on the quality of the shooting, on the speed of the car, on how dirty the number is, etc. <br><br><h2>  Neural networks (learning mechanisms) </h2><br>  The second important part of OpenCV (after the one that is responsible for image processing) is machine learning.  In addition to the built-in OpenCV, now there are <a href="http://deeplearning4j.org/compare-dl4j-torch7-pylearn.html">several mechanisms for</a> machine learning: <br><br><ul><li>  Google's <strong>TensorFlow</strong> , built entirely on tensors; </li><li>  <strong>Theano</strong> , <strong>PyLearn</strong> <strong>2</strong> &amp;&amp; <strong>EcoSystem</strong> is one of the largest developments, very difficult to use; </li><li>  <strong>Torch</strong> - already outdated mechanism; </li><li>  <strong>Caffe</strong> is the best system for beginners to use.  By the way, it is not necessary to use it for recognition - you can apply it, for example, in the financial sphere.  So, Caffe is often used to prototype banking manipulations.  There are also biological systems built on it. </li></ul><br><br><h2>  The difficulties of building a system </h2><br>  When we build a similar system (even the same virtual fitting room or number recognition system), we have to deal with at least two dilemmas: <br><br><ul><li>  soft or hardware </li><li>  algorithm or neural network. </li></ul><br><br>  The dilemma of software and hardware is that, the worse the iron, the better the software needs to be developed in order to get a sensible result.  The second dilemma is the following - what is better to use in the program part: any algorithm or a neural network?  In fact, sometimes the neural network loses the algorithm.  I choose between the algorithm and the neural network as follows: if the neural network takes up more space than the algorithm, I choose an algorithm.  The algorithm is generally more reliable, and in simple cases I would choose it.  And sometimes a neural network cannot solve even a very simple task: for example, Rosenblatt‚Äôs perceptron cannot understand whether the point is above or below the line. <br><br><h2>  Character Recognition </h2><br>  Let's talk a little about character recognition, which may be necessary, for example, when creating a license plate recognition system. <br><br>  <strong>Tesseract</strong> <strong>OCR</strong> is open source software that automatically recognizes both a single letter and text immediately.  Tesseract is convenient because it is for any operating system, it works stably and is easily trained.  However, it has a significant drawback: it works very poorly with zamylennym, beaten, dirty and deformed text.  Therefore, Tesseract is hardly suitable for recognizing numbers, but it will very well cope with the recognition of plain text.  So h. Tesseract can be perfectly applied, for example, in document flow. <br><br>  <strong>K-nearest</strong> is a very easy to understand character recognition algorithm, which, despite its primitiveness, can often defeat not the most successful implementations of SVM or neural network methods. <br><br>  It works as follows: <br><br><ol><li>  pre-record a decent number of images of real characters that were previously manually divided into classes; </li><li>  enter the measure of the distance between the characters (if the image is binarized, the XOR operation will be optimal); </li><li>  then, when we try to recognize a character, we alternately calculate the distance between it and all the characters in the database.  Among the closest neighbors may be representatives of various classes.  Representatives of which class is more among neighbors, a recognizable symbol should be attributed to that class. </li></ol><br><br><h2>  OpenCV data types </h2><br>  It's simple. <br><br>  <code>CvPoint</code> - point (structure of two variables (x, y)) <br>  <code>CvSize</code> - size (structure of two variables (width, height)) <br>  <code>CvRect</code> - rectangle (structure of 4 variables (x, y, width, height)) <br>  <code>CvScalar</code> - scalar (4 doubles) <br>  <code>CvArr</code> - an array - it can be considered an ‚Äúabstract base class‚Äù for CvMat and then IplImage (CvArr -&gt; CvMat -&gt; IplImage) <br>  <code>CvMat</code> - matrix <br>  <code>IplImage</code> - image <br><br><br>  That's all the data types that are in OpenCV. <br><br><h2>  Loading pictures </h2><br>  This is what you can do in Ruby.  After you connect the library, you can upload a picture.  It is important that if you want to see it, you need to remember to bring it out the window. <br><br> <code>cvLoadImage( filename, int iscolor=CV_LOAD_IMAGE_COLOR ) <br> //    </code> <br> <br>  The parameters are the file name and image quality: <br><br><ul><li>  <code>filename</code> - file name </li><li>  <code>iscolor</code> - defines how to present a picture </li><li>  <code>iscolor &gt; 0</code> - </li></ul><br>  <code>iscolor == 0</code> - the image will be uploaded in GRAYSCALE format (grayscale) <br>  <code>iscolor &lt; 0</code> picture will be loaded as is <br><br> <code>cvNamedWindow("original",CV_WINDOW_AUTOSIZE); <br> //   <br> cvShowImage("original",image);</code> <br> <br><h2>  Information Available After Download </h2><br>  There are about 25 methods here, but I only use these: <br><br><ul><li> <code>image-&gt;nChannels //    (RGB,   OpenCV ‚Äî BGR ) (1-4);</code> </li> <li> <code>image-&gt;depth //    (     , );</code> </li> <li> <code>image-&gt;width //    ;</code> </li> <li> <code>image-&gt;height //    ;</code> </li> <li> <code>image-&gt;imageSize // ,   (==image-&gt;height*image-&gt;widthStep);</code> </li> <li> <code>image-&gt;widthStep //        (     ) ‚Äî        .</code> </li> </ul><br><br><h2>  Viola-Jones Method </h2><br>  This method of facial recognition, invented in 2005, is based on signs of Haar.  It is used in almost all cameras to identify individuals.  Here is how it works. <br><br><img src="https://habrastorage.org/files/09d/579/940/09d579940884451ea20d3dbe8fc3d8f3.png"><br><br>  The value of each feature is calculated as the sum of pixels in white rectangles, from which the sum of pixels in black areas is subtracted.  Rectangular signs are more primitive than steerable filter, <br><br>  and, despite the fact that they are sensitive to the vertical and horizontal features of images, the result of their search is more rude. <br><br>  And if to speak in human language, the face is taken and divided into two parts.  The area near the nose and under the eyes will be darker, the cheeks lighter, and so on. Imagine that each pixel of the image is a single vector value: with this, the number of gray and white pixels is calculated.  Based on this, it is concluded that it looks like a person or not. <br><br><h2>  Neural networks </h2><br><img src="https://habrastorage.org/files/b41/969/b9f/b41969b9f5ed419ab8f12202ceba200f.png"><br><br>  Neural networks are now divided into two types.  The first type is the old two- and three-level networks.  Such networks are trained by gradient methods with back propagation of errors.  When working with them, you take a vector, direct the function, after which, for example, the perceptron layer goes.  You have input (an image that has already been processed - for example, the necessary part of it is taken, and in the case of a number, it is cut into rectangles for each character of the number).  After that each pixel - vector is displayed, and we count transitions.  Actually, this is just a walk through the array.  This technology is already outdated. <br><br>  The newer networks of the second type are deep and convolutional, using the convolution operation.  The convolution operation shows the similarity of one function with a reflected and shifted copy of another.  All convolution in OpenCV occurs on a 2D filter: <br><br> <code>cvFilter2D( src, dst, kernel, CvPoint anchor CV_DEFAULT(cvPoint(-1,-1)))</code> <br> <br><h2>  Canny Boundary Detector </h2><br>  If we want to process images of faces or numbers, we need to calculate the boundaries of these images.  This is a very difficult task to be solved in OpenCV using a very old built-in algorithm - Canny 1986. <br><br>  Edges (borders) - such curves in the image, along which there is a sharp change in brightness or other types of inhomogeneities.  Simply put, the edge is a sharp transition or change in brightness. <br><br>  Causes of edges: <br><ul><li>  change in light; </li><li>  color change; </li><li>  change the depth of the scene (the orientation of the surface). </li></ul><br><br>  To use the algorithm, you need to specify where to look for the image and the erosion threshold - this is necessary, for example, to be able to find the car on a dark road. <br><br> <code>cvCanny( image, edges, threshold1, <br> threshold2, CV_DEFAULT(3) );</code> <br> <br>  <code>image</code> - single-channel image for processing (grayscale); <br>  <code>edges</code> - single-channel image to store the borders found by the function; <br>  <code>threshold1</code> - minimum threshold; <br>  <code>threshold2</code> - maximum threshold; <br>  <code>aperture_size</code> - size for the Sobel operator. <br><br>  Here's how the Canny algorithm works step by step: <br><br><ul><li>  Removes noise and unnecessary details from the image. </li><li>  Calculates image gradient. </li><li>  makes the edges thin (edge ‚Äã‚Äãthinning). </li><li>  links edge to contours (edge ‚Äã‚Äãlinking). </li></ul><br><br>  To those who have read this far (and I would like to believe that there are more than half of these), I want to say that the article is nothing more than an introductory character, I just wanted to share my conclusions.  Since I have no technical computer education, there may be inaccuracies - I will be glad to any amendments and comments. <br><br>  And I hope that the topic is relevant in connection with the advent of the era of robotics. </div><p>Source: <a href="https://habr.com/ru/post/303482/">https://habr.com/ru/post/303482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303472/index.html">Portrait of a participant of the ‚ÄúDarudar‚Äù - infographics poll</a></li>
<li><a href="../303474/index.html">Why do corporations work with startups? And why do startups work with large corporations?</a></li>
<li><a href="../303476/index.html">Writing a text game in Python / Ren'Py</a></li>
<li><a href="../303478/index.html">Stepic.org in Telegram: how we developed the bot and what came of it</a></li>
<li><a href="../303480/index.html">Project Tango from Google, or a new perception of the world?</a></li>
<li><a href="../303484/index.html">How we wrote helpdesk (part 3)</a></li>
<li><a href="../303486/index.html">Automation of software development: whether the "programmer" can turn into a "computer operator"</a></li>
<li><a href="../303488/index.html">Algorithm for computing the complex root of an arbitrary degree polynomial</a></li>
<li><a href="../303490/index.html">Telegram Call Notification</a></li>
<li><a href="../303492/index.html">Security Week 24: black market hijacked RDP, zyrodey in Flash, GMail refuses SSLv3 and RC4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>